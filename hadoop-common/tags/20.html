<h3><span class=" glyphicon glyphicon-tag"/>&nbspPublicFieldVerifier</h3><kbd>Verifies values related to public fields.</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.hadoop.fs.FileContextMainOperationsBaseTest </h4><pre class="type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testFileContextStatistics() throws IOException {
  FileContext.clearStatistics();
  final Path rootPath=getTestRootPath(fc,"test");
  final Path path=new Path(rootPath,"zoo");
  createFile(path);
  byte[] bb=new byte[data.length];
  FSDataInputStream fsdis=fc.open(path);
  try {
    fsdis.read(bb);
  }
  finally {
    fsdis.close();
  }
  assertArrayEquals(data,bb);
  FileContext.printStatistics();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.TestPath </h4><pre class="type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testGlobEscapeStatus() throws Exception {
  if (Shell.WINDOWS)   return;
  FileSystem lfs=FileSystem.getLocal(new Configuration());
  Path testRoot=lfs.makeQualified(new Path(System.getProperty("test.build.data","test/build/data"),"testPathGlob"));
  lfs.delete(testRoot,true);
  lfs.mkdirs(testRoot);
  assertTrue(lfs.isDirectory(testRoot));
  lfs.setWorkingDirectory(testRoot);
  Path paths[]=new Path[]{new Path(testRoot,"*/f"),new Path(testRoot,"d1/f"),new Path(testRoot,"d2/f")};
  Arrays.sort(paths);
  for (  Path p : paths) {
    lfs.create(p).close();
    assertTrue(lfs.exists(p));
  }
  FileStatus stats[]=lfs.listStatus(new Path(testRoot,"*"));
  assertEquals(1,stats.length);
  assertEquals(new Path(testRoot,"*/f"),stats[0].getPath());
  stats=lfs.globStatus(new Path(testRoot,"*"));
  Arrays.sort(stats);
  Path parentPaths[]=new Path[paths.length];
  for (int i=0; i < paths.length; i++) {
    parentPaths[i]=paths[i].getParent();
  }
  assertEquals(mergeStatuses(parentPaths),mergeStatuses(stats));
  stats=lfs.globStatus(new Path(testRoot,"\\*"));
  assertEquals(1,stats.length);
  assertEquals(new Path(testRoot,"*"),stats[0].getPath());
  stats=lfs.globStatus(new Path(testRoot,"*/f"));
  assertEquals(paths.length,stats.length);
  assertEquals(mergeStatuses(paths),mergeStatuses(stats));
  stats=lfs.globStatus(new Path(testRoot,"\\*/f"));
  assertEquals(1,stats.length);
  assertEquals(new Path(testRoot,"*/f"),stats[0].getPath());
  stats=lfs.globStatus(new Path(testRoot,"\\*/*"));
  assertEquals(1,stats.length);
  assertEquals(new Path(testRoot,"*/f"),stats[0].getPath());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestBlockReaderFactory </h4><pre class="type-9 type-7 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
/** 
 * Test shutting down the ShortCircuitCache while there are things in it.
 */
@Test public void testShortCircuitCacheShutdown() throws Exception {
  TemporarySocketDirectory sockDir=new TemporarySocketDirectory();
  Configuration conf=createShortCircuitConf("testShortCircuitCacheShutdown",sockDir);
  conf.set(DFS_CLIENT_CONTEXT,"testShortCircuitCacheShutdown");
  Configuration serverConf=new Configuration(conf);
  DFSInputStream.tcpReadsDisabledForTesting=true;
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(serverConf).numDataNodes(1).build();
  cluster.waitActive();
  final DistributedFileSystem fs=(DistributedFileSystem)FileSystem.get(cluster.getURI(0),conf);
  final String TEST_FILE="/test_file";
  final int TEST_FILE_LEN=4000;
  final int SEED=0xFADEC;
  DFSTestUtil.createFile(fs,new Path(TEST_FILE),TEST_FILE_LEN,(short)1,SEED);
  byte contents[]=DFSTestUtil.readFileBuffer(fs,new Path(TEST_FILE));
  byte expected[]=DFSTestUtil.calculateFileContentsFromSeed(SEED,TEST_FILE_LEN);
  Assert.assertTrue(Arrays.equals(contents,expected));
  final ShortCircuitCache cache=fs.dfs.getClientContext().getShortCircuitCache();
  cache.close();
  Assert.assertTrue(cache.getDfsClientShmManager().getDomainSocketWatcher().isClosed());
  cluster.shutdown();
}

</code></pre>

<br>
<pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that a client which does not support short-circuit reads using
 * shared memory can talk with a server which supports it.
 */
@Test public void testShortCircuitReadFromClientWithoutShm() throws Exception {
  TemporarySocketDirectory sockDir=new TemporarySocketDirectory();
  Configuration clientConf=createShortCircuitConf("testShortCircuitReadWithoutShm",sockDir);
  Configuration serverConf=new Configuration(clientConf);
  DFSInputStream.tcpReadsDisabledForTesting=true;
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(serverConf).numDataNodes(1).build();
  cluster.waitActive();
  clientConf.setInt(DFS_SHORT_CIRCUIT_SHARED_MEMORY_WATCHER_INTERRUPT_CHECK_MS,0);
  clientConf.set(DFS_CLIENT_CONTEXT,"testShortCircuitReadFromClientWithoutShm_clientContext");
  final DistributedFileSystem fs=(DistributedFileSystem)FileSystem.get(cluster.getURI(0),clientConf);
  final String TEST_FILE="/test_file";
  final int TEST_FILE_LEN=4000;
  final int SEED=0xFADEC;
  DFSTestUtil.createFile(fs,new Path(TEST_FILE),TEST_FILE_LEN,(short)1,SEED);
  byte contents[]=DFSTestUtil.readFileBuffer(fs,new Path(TEST_FILE));
  byte expected[]=DFSTestUtil.calculateFileContentsFromSeed(SEED,TEST_FILE_LEN);
  Assert.assertTrue(Arrays.equals(contents,expected));
  final ShortCircuitCache cache=fs.dfs.getClientContext().getShortCircuitCache();
  Assert.assertEquals(null,cache.getDfsClientShmManager());
  cluster.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDatanodeRegistration </h4><pre class="type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure the datanode manager does not do host lookup after registration,
 * especially for node reports.
 * @throws Exception
 */
@Test public void testDNSLookups() throws Exception {
  MonitorDNS sm=new MonitorDNS();
  System.setSecurityManager(sm);
  MiniDFSCluster cluster=null;
  try {
    HdfsConfiguration conf=new HdfsConfiguration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(8).build();
    cluster.waitActive();
    int initialLookups=sm.lookups;
    assertTrue("dns security manager is active",initialLookups != 0);
    DatanodeManager dm=cluster.getNamesystem().getBlockManager().getDatanodeManager();
    dm.refreshNodes(conf);
    assertEquals(initialLookups,sm.lookups);
    dm.refreshNodes(conf);
    assertEquals(initialLookups,sm.lookups);
    dm.getDatanodeListForReport(DatanodeReportType.ALL);
    assertEquals(initialLookups,sm.lookups);
    dm.getDatanodeListForReport(DatanodeReportType.LIVE);
    assertEquals(initialLookups,sm.lookups);
    dm.getDatanodeListForReport(DatanodeReportType.DEAD);
    assertEquals(initialLookups,sm.lookups);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
    System.setSecurityManager(null);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestFileAppend3 </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * TC11: Racing rename
 * @throws IOException an exception might be thrown
 */
@Test public void testTC11() throws Exception {
  final Path p=new Path("/TC11/foo");
  System.out.println("p=" + p);
  final int len1=(int)BLOCK_SIZE;
{
    FSDataOutputStream out=fs.create(p,false,buffersize,REPLICATION,BLOCK_SIZE);
    AppendTestUtil.write(out,0,len1);
    out.close();
  }
  FSDataOutputStream out=fs.append(p);
  final int len2=(int)BLOCK_SIZE / 2;
  AppendTestUtil.write(out,len1,len2);
  out.hflush();
  final Path pnew=new Path(p + ".new");
  assertTrue(fs.rename(p,pnew));
  out.close();
  final long len=fs.getFileStatus(pnew).getLen();
  final LocatedBlocks locatedblocks=fs.dfs.getNamenode().getBlockLocations(pnew.toString(),0L,len);
  final int numblock=locatedblocks.locatedBlockCount();
  for (int i=0; i < numblock; i++) {
    final LocatedBlock lb=locatedblocks.get(i);
    final ExtendedBlock blk=lb.getBlock();
    final long size=lb.getBlockSize();
    if (i < numblock - 1) {
      assertEquals(BLOCK_SIZE,size);
    }
    for (    DatanodeInfo datanodeinfo : lb.getLocations()) {
      final DataNode dn=cluster.getDataNode(datanodeinfo.getIpcPort());
      final Block metainfo=DataNodeTestUtils.getFSDataset(dn).getStoredBlock(blk.getBlockPoolId(),blk.getBlockId());
      assertEquals(size,metainfo.getNumBytes());
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * TC7: Corrupted replicas are present.
 * @throws IOException an exception might be thrown
 */
@Test public void testTC7() throws Exception {
  final short repl=2;
  final Path p=new Path("/TC7/foo");
  System.out.println("p=" + p);
  final int len1=(int)(BLOCK_SIZE / 2);
{
    FSDataOutputStream out=fs.create(p,false,buffersize,repl,BLOCK_SIZE);
    AppendTestUtil.write(out,0,len1);
    out.close();
  }
  DFSTestUtil.waitReplication(fs,p,repl);
  final LocatedBlocks locatedblocks=fs.dfs.getNamenode().getBlockLocations(p.toString(),0L,len1);
  assertEquals(1,locatedblocks.locatedBlockCount());
  final LocatedBlock lb=locatedblocks.get(0);
  final ExtendedBlock blk=lb.getBlock();
  assertEquals(len1,lb.getBlockSize());
  DatanodeInfo[] datanodeinfos=lb.getLocations();
  assertEquals(repl,datanodeinfos.length);
  final DataNode dn=cluster.getDataNode(datanodeinfos[0].getIpcPort());
  final File f=DataNodeTestUtils.getBlockFile(dn,blk.getBlockPoolId(),blk.getLocalBlock());
  final RandomAccessFile raf=new RandomAccessFile(f,"rw");
  AppendTestUtil.LOG.info("dn=" + dn + ", blk="+ blk+ " (length="+ blk.getNumBytes()+ ")");
  assertEquals(len1,raf.length());
  raf.setLength(0);
  raf.close();
  final int len2=(int)BLOCK_SIZE;
{
    FSDataOutputStream out=fs.append(p);
    AppendTestUtil.write(out,len1,len2);
    out.close();
  }
  AppendTestUtil.check(fs,p,len1 + len2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestFileCreation </h4><pre class="type-9 type-11 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create a file, write something, hflush but not close.
 * Then change lease period and wait for lease recovery.
 * Finally, read the block directly from each Datanode and verify the content.
 */
@Test public void testLeaseExpireHardLimit() throws Exception {
  System.out.println("testLeaseExpireHardLimit start");
  final long leasePeriod=1000;
  final int DATANODE_NUM=3;
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFS_NAMENODE_HEARTBEAT_RECHECK_INTERVAL_KEY,1000);
  conf.setInt(DFS_HEARTBEAT_INTERVAL_KEY,1);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(DATANODE_NUM).build();
  DistributedFileSystem dfs=null;
  try {
    cluster.waitActive();
    dfs=cluster.getFileSystem();
    final String f=DIR + "foo";
    final Path fpath=new Path(f);
    HdfsDataOutputStream out=create(dfs,fpath,DATANODE_NUM);
    out.write("something".getBytes());
    out.hflush();
    int actualRepl=out.getCurrentBlockReplication();
    assertTrue(f + " should be replicated to " + DATANODE_NUM+ " datanodes.",actualRepl == DATANODE_NUM);
    cluster.setLeasePeriod(leasePeriod,leasePeriod);
    try {
      Thread.sleep(5 * leasePeriod);
    }
 catch (    InterruptedException e) {
    }
    LocatedBlocks locations=dfs.dfs.getNamenode().getBlockLocations(f,0,Long.MAX_VALUE);
    assertEquals(1,locations.locatedBlockCount());
    LocatedBlock locatedblock=locations.getLocatedBlocks().get(0);
    int successcount=0;
    for (    DatanodeInfo datanodeinfo : locatedblock.getLocations()) {
      DataNode datanode=cluster.getDataNode(datanodeinfo.getIpcPort());
      ExtendedBlock blk=locatedblock.getBlock();
      Block b=DataNodeTestUtils.getFSDataset(datanode).getStoredBlock(blk.getBlockPoolId(),blk.getBlockId());
      final File blockfile=DataNodeTestUtils.getFile(datanode,blk.getBlockPoolId(),b.getBlockId());
      System.out.println("blockfile=" + blockfile);
      if (blockfile != null) {
        BufferedReader in=new BufferedReader(new FileReader(blockfile));
        assertEquals("something",in.readLine());
        in.close();
        successcount++;
      }
    }
    System.out.println("successcount=" + successcount);
    assertTrue(successcount > 0);
  }
  finally {
    IOUtils.closeStream(dfs);
    cluster.shutdown();
  }
  System.out.println("testLeaseExpireHardLimit successful");
}

</code></pre>

<br>
<pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that file leases are persisted across namenode restarts.
 */
@Test public void testFileCreationNamenodeRestart() throws IOException {
  Configuration conf=new HdfsConfiguration();
  final int MAX_IDLE_TIME=2000;
  conf.setInt("ipc.client.connection.maxidletime",MAX_IDLE_TIME);
  conf.setInt(DFS_NAMENODE_HEARTBEAT_RECHECK_INTERVAL_KEY,1000);
  conf.setInt(DFS_HEARTBEAT_INTERVAL_KEY,1);
  if (simulatedStorage) {
    SimulatedFSDataset.setFactory(conf);
  }
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  DistributedFileSystem fs=null;
  try {
    cluster.waitActive();
    fs=cluster.getFileSystem();
    final int nnport=cluster.getNameNodePort();
    Path file1=new Path("/filestatus.dat");
    HdfsDataOutputStream stm=create(fs,file1,1);
    System.out.println("testFileCreationNamenodeRestart: " + "Created file " + file1);
    assertEquals(file1 + " should be replicated to 1 datanode.",1,stm.getCurrentBlockReplication());
    writeFile(stm,numBlocks * blockSize);
    stm.hflush();
    assertEquals(file1 + " should still be replicated to 1 datanode.",1,stm.getCurrentBlockReplication());
    Path fileRenamed=new Path("/filestatusRenamed.dat");
    fs.rename(file1,fileRenamed);
    System.out.println("testFileCreationNamenodeRestart: " + "Renamed file " + file1 + " to "+ fileRenamed);
    file1=fileRenamed;
    Path file2=new Path("/filestatus2.dat");
    FSDataOutputStream stm2=createFile(fs,file2,1);
    System.out.println("testFileCreationNamenodeRestart: " + "Created file " + file2);
    Path file3=new Path("/user/home/fullpath.dat");
    FSDataOutputStream stm3=createFile(fs,file3,1);
    System.out.println("testFileCreationNamenodeRestart: " + "Created file " + file3);
    Path file4=new Path("/user/home/fullpath4.dat");
    FSDataOutputStream stm4=createFile(fs,file4,1);
    System.out.println("testFileCreationNamenodeRestart: " + "Created file " + file4);
    fs.mkdirs(new Path("/bin"));
    fs.rename(new Path("/user/home"),new Path("/bin"));
    Path file3new=new Path("/bin/home/fullpath.dat");
    System.out.println("testFileCreationNamenodeRestart: " + "Renamed file " + file3 + " to "+ file3new);
    Path file4new=new Path("/bin/home/fullpath4.dat");
    System.out.println("testFileCreationNamenodeRestart: " + "Renamed file " + file4 + " to "+ file4new);
    cluster.shutdown();
    try {
      Thread.sleep(2 * MAX_IDLE_TIME);
    }
 catch (    InterruptedException e) {
    }
    cluster=new MiniDFSCluster.Builder(conf).nameNodePort(nnport).format(false).build();
    cluster.waitActive();
    cluster.shutdown();
    try {
      Thread.sleep(5000);
    }
 catch (    InterruptedException e) {
    }
    cluster=new MiniDFSCluster.Builder(conf).nameNodePort(nnport).format(false).build();
    cluster.waitActive();
    fs=cluster.getFileSystem();
    DFSOutputStream dfstream=(DFSOutputStream)(stm.getWrappedStream());
    dfstream.setTestFilename(file1.toString());
    dfstream=(DFSOutputStream)(stm3.getWrappedStream());
    dfstream.setTestFilename(file3new.toString());
    dfstream=(DFSOutputStream)(stm4.getWrappedStream());
    dfstream.setTestFilename(file4new.toString());
    byte[] buffer=AppendTestUtil.randomBytes(seed,1);
    stm.write(buffer);
    stm.close();
    stm2.write(buffer);
    stm2.close();
    stm3.close();
    stm4.close();
    DFSClient client=fs.dfs;
    LocatedBlocks locations=client.getNamenode().getBlockLocations(file1.toString(),0,Long.MAX_VALUE);
    System.out.println("locations = " + locations.locatedBlockCount());
    assertTrue("Error blocks were not cleaned up for file " + file1,locations.locatedBlockCount() == 3);
    locations=client.getNamenode().getBlockLocations(file2.toString(),0,Long.MAX_VALUE);
    System.out.println("locations = " + locations.locatedBlockCount());
    assertTrue("Error blocks were not cleaned up for file " + file2,locations.locatedBlockCount() == 1);
  }
  finally {
    IOUtils.closeStream(fs);
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Test that the filesystem removes the last block from a file if its
 * lease expires.
 */
@Test public void testFileCreationError2() throws IOException {
  long leasePeriod=1000;
  System.out.println("testFileCreationError2 start");
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFS_NAMENODE_HEARTBEAT_RECHECK_INTERVAL_KEY,1000);
  conf.setInt(DFS_HEARTBEAT_INTERVAL_KEY,1);
  if (simulatedStorage) {
    SimulatedFSDataset.setFactory(conf);
  }
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  DistributedFileSystem dfs=null;
  try {
    cluster.waitActive();
    dfs=cluster.getFileSystem();
    DFSClient client=dfs.dfs;
    Path file1=new Path("/filestatus.dat");
    createFile(dfs,file1,1);
    System.out.println("testFileCreationError2: " + "Created file filestatus.dat with one replicas.");
    LocatedBlocks locations=client.getNamenode().getBlockLocations(file1.toString(),0,Long.MAX_VALUE);
    System.out.println("testFileCreationError2: " + "The file has " + locations.locatedBlockCount() + " blocks.");
    LocatedBlock location=client.getNamenode().addBlock(file1.toString(),client.clientName,null,null,INodeId.GRANDFATHER_INODE_ID,null);
    System.out.println("testFileCreationError2: " + "Added block " + location.getBlock());
    locations=client.getNamenode().getBlockLocations(file1.toString(),0,Long.MAX_VALUE);
    int count=locations.locatedBlockCount();
    System.out.println("testFileCreationError2: " + "The file now has " + count + " blocks.");
    cluster.setLeasePeriod(leasePeriod,leasePeriod);
    try {
      Thread.sleep(5 * leasePeriod);
    }
 catch (    InterruptedException e) {
    }
    locations=client.getNamenode().getBlockLocations(file1.toString(),0,Long.MAX_VALUE);
    System.out.println("testFileCreationError2: " + "locations = " + locations.locatedBlockCount());
    assertEquals(0,locations.locatedBlockCount());
    System.out.println("testFileCreationError2 successful");
  }
  finally {
    IOUtils.closeStream(dfs);
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestLeaseRecovery </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The following test first creates a file with a few blocks.
 * It randomly truncates the replica of the last block stored in each datanode.
 * Finally, it triggers block synchronization to synchronize all stored block.
 */
@Test public void testBlockSynchronization() throws Exception {
  final int ORG_FILE_SIZE=3000;
  Configuration conf=new HdfsConfiguration();
  conf.setLong(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,BLOCK_SIZE);
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(5).build();
    cluster.waitActive();
    DistributedFileSystem dfs=cluster.getFileSystem();
    String filestr="/foo";
    Path filepath=new Path(filestr);
    DFSTestUtil.createFile(dfs,filepath,ORG_FILE_SIZE,REPLICATION_NUM,0L);
    assertTrue(dfs.exists(filepath));
    DFSTestUtil.waitReplication(dfs,filepath,REPLICATION_NUM);
    LocatedBlock locatedblock=TestInterDatanodeProtocol.getLastLocatedBlock(dfs.dfs.getNamenode(),filestr);
    DatanodeInfo[] datanodeinfos=locatedblock.getLocations();
    assertEquals(REPLICATION_NUM,datanodeinfos.length);
    DataNode[] datanodes=new DataNode[REPLICATION_NUM];
    for (int i=0; i < REPLICATION_NUM; i++) {
      datanodes[i]=cluster.getDataNode(datanodeinfos[i].getIpcPort());
      assertTrue(datanodes[i] != null);
    }
    ExtendedBlock lastblock=locatedblock.getBlock();
    DataNode.LOG.info("newblocks=" + lastblock);
    for (int i=0; i < REPLICATION_NUM; i++) {
      checkMetaInfo(lastblock,datanodes[i]);
    }
    DataNode.LOG.info("dfs.dfs.clientName=" + dfs.dfs.clientName);
    cluster.getNameNodeRpc().append(filestr,dfs.dfs.clientName);
    waitLeaseRecovery(cluster);
    Block[] updatedmetainfo=new Block[REPLICATION_NUM];
    long oldSize=lastblock.getNumBytes();
    lastblock=TestInterDatanodeProtocol.getLastLocatedBlock(dfs.dfs.getNamenode(),filestr).getBlock();
    long currentGS=lastblock.getGenerationStamp();
    for (int i=0; i < REPLICATION_NUM; i++) {
      updatedmetainfo[i]=DataNodeTestUtils.getFSDataset(datanodes[i]).getStoredBlock(lastblock.getBlockPoolId(),lastblock.getBlockId());
      assertEquals(lastblock.getBlockId(),updatedmetainfo[i].getBlockId());
      assertEquals(oldSize,updatedmetainfo[i].getNumBytes());
      assertEquals(currentGS,updatedmetainfo[i].getGenerationStamp());
    }
    System.out.println("Testing that lease recovery cannot happen during safemode.");
    filestr="/foo.safemode";
    filepath=new Path(filestr);
    dfs.create(filepath,(short)1);
    cluster.getNameNodeRpc().setSafeMode(HdfsConstants.SafeModeAction.SAFEMODE_ENTER,false);
    assertTrue(dfs.dfs.exists(filestr));
    DFSTestUtil.waitReplication(dfs,filepath,(short)1);
    waitLeaseRecovery(cluster);
    LeaseManager lm=NameNodeAdapter.getLeaseManager(cluster.getNamesystem());
    assertTrue("Found " + lm.countLease() + " lease, expected 1",lm.countLease() == 1);
    cluster.getNameNodeRpc().setSafeMode(HdfsConstants.SafeModeAction.SAFEMODE_LEAVE,false);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestLeaseRecovery2 </h4><pre class="type-9 type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test makes the client does not renew its lease and also
 * set the hard lease expiration period to be short 1s. Thus triggering
 * lease expiration to happen while the client is still alive.
 * The test makes sure that the lease recovery completes and the client
 * fails if it continues to write to the file.
 * @throws Exception
 */
@Test public void testHardLeaseRecovery() throws Exception {
  String filestr="/hardLeaseRecovery";
  AppendTestUtil.LOG.info("filestr=" + filestr);
  Path filepath=new Path(filestr);
  FSDataOutputStream stm=dfs.create(filepath,true,BUF_SIZE,REPLICATION_NUM,BLOCK_SIZE);
  assertTrue(dfs.dfs.exists(filestr));
  int size=AppendTestUtil.nextInt(FILE_SIZE);
  AppendTestUtil.LOG.info("size=" + size);
  stm.write(buffer,0,size);
  AppendTestUtil.LOG.info("hflush");
  stm.hflush();
  AppendTestUtil.LOG.info("leasechecker.interruptAndJoin()");
  dfs.dfs.getLeaseRenewer().interruptAndJoin();
  cluster.setLeasePeriod(LONG_LEASE_PERIOD,SHORT_LEASE_PERIOD);
  LocatedBlocks locatedBlocks;
  do {
    Thread.sleep(SHORT_LEASE_PERIOD);
    locatedBlocks=dfs.dfs.getLocatedBlocks(filestr,0L,size);
  }
 while (locatedBlocks.isUnderConstruction());
  assertEquals(size,locatedBlocks.getFileLength());
  try {
    stm.write('b');
    stm.close();
    fail("Writer thread should have been killed");
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  AppendTestUtil.LOG.info("File size is good. Now validating sizes from datanodes...");
  AppendTestUtil.checkFullFile(dfs,filepath,size,buffer,filestr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestPersistBlocks </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRestartDfsWithAbandonedBlock() throws Exception {
  final Configuration conf=new HdfsConfiguration();
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,0);
  MiniDFSCluster cluster=null;
  long len=0;
  FSDataOutputStream stream;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
    FileSystem fs=cluster.getFileSystem();
    stream=fs.create(FILE_PATH,true,BLOCK_SIZE,(short)1,BLOCK_SIZE);
    stream.write(DATA_BEFORE_RESTART);
    stream.hflush();
    while (len < BLOCK_SIZE * (NUM_BLOCKS - 1)) {
      FileStatus status=fs.getFileStatus(FILE_PATH);
      len=status.getLen();
      Thread.sleep(100);
    }
    DFSClient dfsclient=DFSClientAdapter.getDFSClient((DistributedFileSystem)fs);
    HdfsFileStatus fileStatus=dfsclient.getNamenode().getFileInfo(FILE_NAME);
    LocatedBlocks blocks=dfsclient.getNamenode().getBlockLocations(FILE_NAME,0,BLOCK_SIZE * NUM_BLOCKS);
    assertEquals(NUM_BLOCKS,blocks.getLocatedBlocks().size());
    LocatedBlock b=blocks.getLastLocatedBlock();
    dfsclient.getNamenode().abandonBlock(b.getBlock(),fileStatus.getFileId(),FILE_NAME,dfsclient.clientName);
    cluster.restartNameNode();
    FileStatus status=fs.getFileStatus(FILE_PATH);
    assertTrue("Length incorrect: " + status.getLen(),status.getLen() == len - BLOCK_SIZE);
    FSDataInputStream readStream=fs.open(FILE_PATH);
    try {
      byte[] verifyBuf=new byte[DATA_BEFORE_RESTART.length - BLOCK_SIZE];
      IOUtils.readFully(readStream,verifyBuf,0,verifyBuf.length);
      byte[] expectedBuf=new byte[DATA_BEFORE_RESTART.length - BLOCK_SIZE];
      System.arraycopy(DATA_BEFORE_RESTART,0,expectedBuf,0,expectedBuf.length);
      assertArrayEquals(expectedBuf,verifyBuf);
    }
  finally {
      IOUtils.closeStream(readStream);
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testRestartWithPartialBlockHflushed() throws IOException {
  final Configuration conf=new HdfsConfiguration();
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,0);
  MiniDFSCluster cluster=null;
  FSDataOutputStream stream;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
    FileSystem fs=cluster.getFileSystem();
    NameNode.getAddress(conf).getPort();
    stream=fs.create(FILE_PATH,true,BLOCK_SIZE,(short)1,BLOCK_SIZE);
    stream.write(DATA_BEFORE_RESTART);
    stream.write((byte)1);
    stream.hflush();
    cluster.restartNameNode();
    stream.write((byte)2);
    stream.hflush();
    stream.close();
    assertEquals(DATA_BEFORE_RESTART.length + 2,fs.getFileStatus(FILE_PATH).getLen());
    FSDataInputStream readStream=fs.open(FILE_PATH);
    try {
      byte[] verifyBuf=new byte[DATA_BEFORE_RESTART.length + 2];
      IOUtils.readFully(readStream,verifyBuf,0,verifyBuf.length);
      byte[] expectedBuf=new byte[DATA_BEFORE_RESTART.length + 2];
      System.arraycopy(DATA_BEFORE_RESTART,0,expectedBuf,0,DATA_BEFORE_RESTART.length);
      System.arraycopy(new byte[]{1,2},0,expectedBuf,DATA_BEFORE_RESTART.length,2);
      assertArrayEquals(expectedBuf,verifyBuf);
    }
  finally {
      IOUtils.closeStream(readStream);
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testRestartWithAppend() throws IOException {
  final Configuration conf=new HdfsConfiguration();
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,0);
  MiniDFSCluster cluster=null;
  FSDataOutputStream stream;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
    FileSystem fs=cluster.getFileSystem();
    NameNode.getAddress(conf).getPort();
    stream=fs.create(FILE_PATH,true,BLOCK_SIZE,(short)1,BLOCK_SIZE);
    stream.write(DATA_BEFORE_RESTART,0,DATA_BEFORE_RESTART.length / 2);
    stream.close();
    stream=fs.append(FILE_PATH,BLOCK_SIZE);
    stream.write(DATA_BEFORE_RESTART,DATA_BEFORE_RESTART.length / 2,DATA_BEFORE_RESTART.length / 2);
    stream.close();
    assertEquals(DATA_BEFORE_RESTART.length,fs.getFileStatus(FILE_PATH).getLen());
    cluster.restartNameNode();
    assertEquals(DATA_BEFORE_RESTART.length,fs.getFileStatus(FILE_PATH).getLen());
    FSDataInputStream readStream=fs.open(FILE_PATH);
    try {
      byte[] verifyBuf=new byte[DATA_BEFORE_RESTART.length];
      IOUtils.readFully(readStream,verifyBuf,0,verifyBuf.length);
      assertArrayEquals(DATA_BEFORE_RESTART,verifyBuf);
    }
  finally {
      IOUtils.closeStream(readStream);
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.nfs.nfs3.TestWrites </h4><pre class="type-9 type-7 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testAlterWriteRequest() throws IOException {
  int len=20;
  byte[] data=new byte[len];
  ByteBuffer buffer=ByteBuffer.wrap(data);
  for (int i=0; i < len; i++) {
    buffer.put((byte)i);
  }
  buffer.flip();
  int originalCount=buffer.array().length;
  WRITE3Request request=new WRITE3Request(new FileHandle(),0,data.length,WriteStableHow.UNSTABLE,buffer);
  WriteCtx writeCtx1=new WriteCtx(request.getHandle(),request.getOffset(),request.getCount(),WriteCtx.INVALID_ORIGINAL_COUNT,request.getStableHow(),request.getData(),null,1,false,WriteCtx.DataState.NO_DUMP);
  Assert.assertTrue(writeCtx1.getData().array().length == originalCount);
  OpenFileCtx.alterWriteRequest(request,12);
  WriteCtx writeCtx2=new WriteCtx(request.getHandle(),request.getOffset(),request.getCount(),originalCount,request.getStableHow(),request.getData(),null,2,false,WriteCtx.DataState.NO_DUMP);
  ByteBuffer appendedData=writeCtx2.getData();
  int position=appendedData.position();
  int limit=appendedData.limit();
  Assert.assertTrue(position == 12);
  Assert.assertTrue(limit - position == 8);
  Assert.assertTrue(appendedData.get(position) == (byte)12);
  Assert.assertTrue(appendedData.get(position + 1) == (byte)13);
  Assert.assertTrue(appendedData.get(position + 2) == (byte)14);
  Assert.assertTrue(appendedData.get(position + 7) == (byte)19);
  buffer.position(0);
  request=new WRITE3Request(new FileHandle(),0,data.length,WriteStableHow.UNSTABLE,buffer);
  OpenFileCtx.alterWriteRequest(request,1);
  WriteCtx writeCtx3=new WriteCtx(request.getHandle(),request.getOffset(),request.getCount(),originalCount,request.getStableHow(),request.getData(),null,2,false,WriteCtx.DataState.NO_DUMP);
  appendedData=writeCtx3.getData();
  position=appendedData.position();
  limit=appendedData.limit();
  Assert.assertTrue(position == 1);
  Assert.assertTrue(limit - position == 19);
  Assert.assertTrue(appendedData.get(position) == (byte)1);
  Assert.assertTrue(appendedData.get(position + 18) == (byte)19);
  buffer.position(0);
  request=new WRITE3Request(new FileHandle(),0,data.length,WriteStableHow.UNSTABLE,buffer);
  OpenFileCtx.alterWriteRequest(request,19);
  WriteCtx writeCtx4=new WriteCtx(request.getHandle(),request.getOffset(),request.getCount(),originalCount,request.getStableHow(),request.getData(),null,2,false,WriteCtx.DataState.NO_DUMP);
  appendedData=writeCtx4.getData();
  position=appendedData.position();
  limit=appendedData.limit();
  Assert.assertTrue(position == 19);
  Assert.assertTrue(limit - position == 1);
  Assert.assertTrue(appendedData.get(position) == (byte)19);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.balancer.TestBalancerWithHANameNodes </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a cluster with even distribution, then a new empty node is added to
 * the cluster. Test start a cluster with specified number of nodes, and fills
 * it to be 30% full (with a single file replicated identically to all
 * datanodes); It then adds one new empty node and starts balancing.
 */
@Test(timeout=60000) public void testBalancerWithHANameNodes() throws Exception {
  Configuration conf=new HdfsConfiguration();
  TestBalancer.initConf(conf);
  long newNodeCapacity=TestBalancer.CAPACITY;
  String newNodeRack=TestBalancer.RACK2;
  String[] racks=new String[]{TestBalancer.RACK0,TestBalancer.RACK1};
  long[] capacities=new long[]{TestBalancer.CAPACITY,TestBalancer.CAPACITY};
  assertEquals(capacities.length,racks.length);
  int numOfDatanodes=capacities.length;
  NNConf nn1Conf=new MiniDFSNNTopology.NNConf("nn1");
  nn1Conf.setIpcPort(NameNode.DEFAULT_PORT);
  Configuration copiedConf=new Configuration(conf);
  cluster=new MiniDFSCluster.Builder(copiedConf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(capacities.length).racks(racks).simulatedCapacities(capacities).build();
  HATestUtil.setFailoverConfigurations(cluster,conf);
  try {
    cluster.waitActive();
    cluster.transitionToActive(1);
    Thread.sleep(500);
    client=NameNodeProxies.createProxy(conf,FileSystem.getDefaultUri(conf),ClientProtocol.class).getProxy();
    long totalCapacity=TestBalancer.sum(capacities);
    long totalUsedSpace=totalCapacity * 3 / 10;
    TestBalancer.createFile(cluster,TestBalancer.filePath,totalUsedSpace / numOfDatanodes,(short)numOfDatanodes,1);
    cluster.startDataNodes(conf,1,true,null,new String[]{newNodeRack},new long[]{newNodeCapacity});
    totalCapacity+=newNodeCapacity;
    TestBalancer.waitForHeartBeat(totalUsedSpace,totalCapacity,client,cluster);
    Collection<URI> namenodes=DFSUtil.getNsServiceRpcUris(conf);
    assertEquals(1,namenodes.size());
    assertTrue(namenodes.contains(HATestUtil.getLogicalUri(cluster)));
    final int r=Balancer.run(namenodes,Balancer.Parameters.DEFAULT,conf);
    assertEquals(ExitStatus.SUCCESS.getExitCode(),r);
    TestBalancer.waitForBalancer(totalUsedSpace,totalCapacity,client,cluster,Balancer.Parameters.DEFAULT);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.balancer.TestBalancerWithNodeGroup </h4><pre class="type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Create a cluster with even distribution, and a new empty node is added to
 * the cluster, then test node-group locality for balancer policy.
 */
@Test(timeout=60000) public void testBalancerWithNodeGroup() throws Exception {
  Configuration conf=createConf();
  long[] capacities=new long[]{CAPACITY,CAPACITY,CAPACITY,CAPACITY};
  String[] racks=new String[]{RACK0,RACK0,RACK1,RACK1};
  String[] nodeGroups=new String[]{NODEGROUP0,NODEGROUP0,NODEGROUP1,NODEGROUP2};
  int numOfDatanodes=capacities.length;
  assertEquals(numOfDatanodes,racks.length);
  assertEquals(numOfDatanodes,nodeGroups.length);
  MiniDFSCluster.Builder builder=new MiniDFSCluster.Builder(conf).numDataNodes(capacities.length).racks(racks).simulatedCapacities(capacities);
  MiniDFSClusterWithNodeGroup.setNodeGroups(nodeGroups);
  cluster=new MiniDFSClusterWithNodeGroup(builder);
  try {
    cluster.waitActive();
    client=NameNodeProxies.createProxy(conf,cluster.getFileSystem(0).getUri(),ClientProtocol.class).getProxy();
    long totalCapacity=TestBalancer.sum(capacities);
    long totalUsedSpace=totalCapacity * 2 / 10;
    TestBalancer.createFile(cluster,filePath,totalUsedSpace / (numOfDatanodes / 2),(short)(numOfDatanodes / 2),0);
    long newCapacity=CAPACITY;
    String newRack=RACK1;
    String newNodeGroup=NODEGROUP2;
    cluster.startDataNodes(conf,1,true,null,new String[]{newRack},new long[]{newCapacity},new String[]{newNodeGroup});
    totalCapacity+=newCapacity;
    runBalancer(conf,totalUsedSpace,totalCapacity);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Create a cluster with even distribution, and a new empty node is added to
 * the cluster, then test rack locality for balancer policy. 
 */
@Test(timeout=60000) public void testBalancerWithRackLocality() throws Exception {
  Configuration conf=createConf();
  long[] capacities=new long[]{CAPACITY,CAPACITY};
  String[] racks=new String[]{RACK0,RACK1};
  String[] nodeGroups=new String[]{NODEGROUP0,NODEGROUP1};
  int numOfDatanodes=capacities.length;
  assertEquals(numOfDatanodes,racks.length);
  MiniDFSCluster.Builder builder=new MiniDFSCluster.Builder(conf).numDataNodes(capacities.length).racks(racks).simulatedCapacities(capacities);
  MiniDFSClusterWithNodeGroup.setNodeGroups(nodeGroups);
  cluster=new MiniDFSClusterWithNodeGroup(builder);
  try {
    cluster.waitActive();
    client=NameNodeProxies.createProxy(conf,cluster.getFileSystem(0).getUri(),ClientProtocol.class).getProxy();
    long totalCapacity=TestBalancer.sum(capacities);
    long totalUsedSpace=totalCapacity * 3 / 10;
    long length=totalUsedSpace / numOfDatanodes;
    TestBalancer.createFile(cluster,filePath,length,(short)numOfDatanodes,0);
    LocatedBlocks lbs=client.getBlockLocations(filePath.toUri().getPath(),0,length);
    Set<ExtendedBlock> before=getBlocksOnRack(lbs.getLocatedBlocks(),RACK0);
    long newCapacity=CAPACITY;
    String newRack=RACK1;
    String newNodeGroup=NODEGROUP2;
    cluster.startDataNodes(conf,1,true,null,new String[]{newRack},new long[]{newCapacity},new String[]{newNodeGroup});
    totalCapacity+=newCapacity;
    runBalancerCanFinish(conf,totalUsedSpace,totalCapacity);
    lbs=client.getBlockLocations(filePath.toUri().getPath(),0,length);
    Set<ExtendedBlock> after=getBlocksOnRack(lbs.getLocatedBlocks(),RACK0);
    assertEquals(before,after);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Create a 4 nodes cluster: 2 nodes (n0, n1) in RACK0/NODEGROUP0, 1 node (n2)
 * in RACK1/NODEGROUP1 and 1 node (n3) in RACK1/NODEGROUP2. Fill the cluster 
 * to 60% and 3 replicas, so n2 and n3 will have replica for all blocks according
 * to replica placement policy with NodeGroup. As a result, n2 and n3 will be
 * filled with 80% (60% x 4 / 3), and no blocks can be migrated from n2 and n3
 * to n0 or n1 as balancer policy with node group. Thus, we expect the balancer
 * to end in 5 iterations without move block process.
 */
@Test(timeout=60000) public void testBalancerEndInNoMoveProgress() throws Exception {
  Configuration conf=createConf();
  long[] capacities=new long[]{CAPACITY,CAPACITY,CAPACITY,CAPACITY};
  String[] racks=new String[]{RACK0,RACK0,RACK1,RACK1};
  String[] nodeGroups=new String[]{NODEGROUP0,NODEGROUP0,NODEGROUP1,NODEGROUP2};
  int numOfDatanodes=capacities.length;
  assertEquals(numOfDatanodes,racks.length);
  assertEquals(numOfDatanodes,nodeGroups.length);
  MiniDFSCluster.Builder builder=new MiniDFSCluster.Builder(conf).numDataNodes(capacities.length).racks(racks).simulatedCapacities(capacities);
  MiniDFSClusterWithNodeGroup.setNodeGroups(nodeGroups);
  cluster=new MiniDFSClusterWithNodeGroup(builder);
  try {
    cluster.waitActive();
    client=NameNodeProxies.createProxy(conf,cluster.getFileSystem(0).getUri(),ClientProtocol.class).getProxy();
    long totalCapacity=TestBalancer.sum(capacities);
    long totalUsedSpace=totalCapacity * 6 / 10;
    TestBalancer.createFile(cluster,filePath,totalUsedSpace / 3,(short)(3),0);
    runBalancerCanFinish(conf,totalUsedSpace,totalCapacity);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestBlocksWithNotEnoughRacks </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCorruptBlockRereplicatedAcrossRacks() throws Exception {
  Configuration conf=getConf();
  short REPLICATION_FACTOR=2;
  int fileLen=512;
  final Path filePath=new Path("/testFile");
  String racks[]={"/rack1","/rack1","/rack2","/rack2"};
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(racks.length).racks(racks).build();
  final FSNamesystem ns=cluster.getNameNode().getNamesystem();
  try {
    final FileSystem fs=cluster.getFileSystem();
    DFSTestUtil.createFile(fs,filePath,fileLen,REPLICATION_FACTOR,1L);
    final String fileContent=DFSTestUtil.readFile(fs,filePath);
    ExtendedBlock b=DFSTestUtil.getFirstBlock(fs,filePath);
    DFSTestUtil.waitForReplication(cluster,b,2,REPLICATION_FACTOR,0);
    int dnToCorrupt=DFSTestUtil.firstDnWithBlock(cluster,b);
    assertTrue(MiniDFSCluster.corruptReplica(dnToCorrupt,b));
    cluster.restartDataNode(dnToCorrupt);
    DFSTestUtil.waitCorruptReplicas(fs,ns,filePath,b,1);
    DFSTestUtil.waitForReplication(cluster,b,2,REPLICATION_FACTOR,0);
    for (int i=0; i < racks.length; i++) {
      String blockContent=cluster.readBlockOnDataNode(i,b);
      if (blockContent != null && i != dnToCorrupt) {
        assertEquals("Corrupt replica",fileContent,blockContent);
      }
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReduceReplFactorDueToRejoinRespectsRackPolicy() throws Exception {
  Configuration conf=getConf();
  short REPLICATION_FACTOR=2;
  final Path filePath=new Path("/testFile");
  String racks[]={"/rack1","/rack1","/rack2"};
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(racks.length).racks(racks).build();
  final FSNamesystem ns=cluster.getNameNode().getNamesystem();
  final DatanodeManager dm=ns.getBlockManager().getDatanodeManager();
  try {
    final FileSystem fs=cluster.getFileSystem();
    DFSTestUtil.createFile(fs,filePath,1L,REPLICATION_FACTOR,1L);
    ExtendedBlock b=DFSTestUtil.getFirstBlock(fs,filePath);
    DFSTestUtil.waitForReplication(cluster,b,2,REPLICATION_FACTOR,0);
    ArrayList<DataNode> datanodes=cluster.getDataNodes();
    assertEquals(3,datanodes.size());
    DataNode dataNode=datanodes.get(2);
    DatanodeID dnId=dataNode.getDatanodeId();
    cluster.stopDataNode(2);
    dm.removeDatanode(dnId);
    DFSTestUtil.waitForReplication(cluster,b,1,REPLICATION_FACTOR,1);
    String rack2[]={"/rack2"};
    cluster.startDataNodes(conf,1,true,null,rack2);
    cluster.waitActive();
    DFSTestUtil.waitForReplication(cluster,b,2,REPLICATION_FACTOR,0);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicy </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChooseTargetWithMoreThanHalfStaleNodes() throws Exception {
  HdfsConfiguration conf=new HdfsConfiguration();
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_AVOID_STALE_DATANODE_FOR_WRITE_KEY,true);
  String[] hosts=new String[]{"host1","host2","host3","host4","host5","host6"};
  String[] racks=new String[]{"/d1/r1","/d1/r1","/d1/r2","/d1/r2","/d2/r3","/d2/r3"};
  MiniDFSCluster miniCluster=new MiniDFSCluster.Builder(conf).racks(racks).hosts(hosts).numDataNodes(hosts.length).build();
  miniCluster.waitActive();
  try {
    for (int i=0; i < 2; i++) {
      DataNode dn=miniCluster.getDataNodes().get(i);
      DataNodeTestUtils.setHeartbeatsDisabledForTests(dn,true);
      miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getDatanode(dn.getDatanodeId()).setLastUpdate(Time.now() - staleInterval - 1);
    }
    miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getHeartbeatManager().heartbeatCheck();
    int numStaleNodes=miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getNumStaleNodes();
    assertEquals(numStaleNodes,2);
    assertTrue(miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().shouldAvoidStaleDataNodesForWrite());
    DatanodeDescriptor staleNodeInfo=miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getDatanode(miniCluster.getDataNodes().get(0).getDatanodeId());
    BlockPlacementPolicy replicator=miniCluster.getNameNode().getNamesystem().getBlockManager().getBlockPlacementPolicy();
    DatanodeStorageInfo[] targets=replicator.chooseTarget(filename,3,staleNodeInfo,new ArrayList<DatanodeStorageInfo>(),false,null,BLOCK_SIZE,StorageType.DEFAULT);
    assertEquals(targets.length,3);
    assertFalse(isOnSameRack(targets[0],staleNodeInfo));
    for (int i=0; i < 4; i++) {
      DataNode dn=miniCluster.getDataNodes().get(i);
      DataNodeTestUtils.setHeartbeatsDisabledForTests(dn,true);
      miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getDatanode(dn.getDatanodeId()).setLastUpdate(Time.now() - staleInterval - 1);
    }
    miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getHeartbeatManager().heartbeatCheck();
    numStaleNodes=miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getNumStaleNodes();
    assertEquals(numStaleNodes,4);
    assertFalse(miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().shouldAvoidStaleDataNodesForWrite());
    targets=replicator.chooseTarget(filename,3,staleNodeInfo,new ArrayList<DatanodeStorageInfo>(),false,null,BLOCK_SIZE,StorageType.DEFAULT);
    assertEquals(targets.length,3);
    assertTrue(isOnSameRack(targets[0],staleNodeInfo));
    for (int i=2; i < 4; i++) {
      DataNode dn=miniCluster.getDataNodes().get(i);
      DataNodeTestUtils.setHeartbeatsDisabledForTests(dn,false);
      miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getDatanode(dn.getDatanodeId()).setLastUpdate(Time.now());
    }
    miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getHeartbeatManager().heartbeatCheck();
    numStaleNodes=miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getNumStaleNodes();
    assertEquals(numStaleNodes,2);
    assertTrue(miniCluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().shouldAvoidStaleDataNodesForWrite());
    targets=chooseTarget(3,staleNodeInfo);
    assertEquals(targets.length,3);
    assertFalse(isOnSameRack(targets[0],staleNodeInfo));
  }
  finally {
    miniCluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.datanode.TestDataNodeMultipleRegistrations </h4><pre class="type-9 type-7 type-10 type-1 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * starts single nn and single dn and verifies registration and handshake
 * @throws IOException
 */
@Test public void testFedSingleNN() throws IOException {
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nameNodePort(9927).build();
  try {
    NameNode nn1=cluster.getNameNode();
    assertNotNull("cannot create nn1",nn1);
    String bpid1=FSImageTestUtil.getFSImage(nn1).getBlockPoolID();
    String cid1=FSImageTestUtil.getFSImage(nn1).getClusterID();
    int lv1=FSImageTestUtil.getFSImage(nn1).getLayoutVersion();
    LOG.info("nn1: lv=" + lv1 + ";cid="+ cid1+ ";bpid="+ bpid1+ ";uri="+ nn1.getNameNodeAddress());
    DataNode dn=cluster.getDataNodes().get(0);
    final Map<String,Object> volInfos=dn.data.getVolumeInfoMap();
    Assert.assertTrue("No volumes in the fsdataset",volInfos.size() > 0);
    int i=0;
    for (    Map.Entry<String,Object> e : volInfos.entrySet()) {
      LOG.info("vol " + i++ + ") "+ e.getKey()+ ": "+ e.getValue());
    }
    assertEquals("number of volumes is wrong",2,volInfos.size());
    for (    BPOfferService bpos : dn.getAllBpOs()) {
      LOG.info("reg: bpid=" + "; name=" + bpos.bpRegistration + "; sid="+ bpos.bpRegistration.getDatanodeUuid()+ "; nna="+ getNNSocketAddress(bpos));
    }
    BPOfferService bpos1=dn.getAllBpOs()[0];
    bpos1.triggerBlockReportForTests();
    assertEquals("wrong nn address",getNNSocketAddress(bpos1),nn1.getNameNodeAddress());
    assertEquals("wrong bpid",bpos1.getBlockPoolId(),bpid1);
    assertEquals("wrong cid",dn.getClusterId(),cid1);
    cluster.shutdown();
    assertEquals(0,dn.getAllBpOs().length);
    cluster=null;
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-7 type-10 type-19 type-1 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * start multiple NNs and single DN and verifies per BP registrations and
 * handshakes.
 * @throws IOException
 */
@Test public void test2NNRegistration() throws IOException {
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleFederatedTopology(2)).build();
  try {
    cluster.waitActive();
    NameNode nn1=cluster.getNameNode(0);
    NameNode nn2=cluster.getNameNode(1);
    assertNotNull("cannot create nn1",nn1);
    assertNotNull("cannot create nn2",nn2);
    String bpid1=FSImageTestUtil.getFSImage(nn1).getBlockPoolID();
    String bpid2=FSImageTestUtil.getFSImage(nn2).getBlockPoolID();
    String cid1=FSImageTestUtil.getFSImage(nn1).getClusterID();
    String cid2=FSImageTestUtil.getFSImage(nn2).getClusterID();
    int lv1=FSImageTestUtil.getFSImage(nn1).getLayoutVersion();
    int lv2=FSImageTestUtil.getFSImage(nn2).getLayoutVersion();
    int ns1=FSImageTestUtil.getFSImage(nn1).getNamespaceID();
    int ns2=FSImageTestUtil.getFSImage(nn2).getNamespaceID();
    assertNotSame("namespace ids should be different",ns1,ns2);
    LOG.info("nn1: lv=" + lv1 + ";cid="+ cid1+ ";bpid="+ bpid1+ ";uri="+ nn1.getNameNodeAddress());
    LOG.info("nn2: lv=" + lv2 + ";cid="+ cid2+ ";bpid="+ bpid2+ ";uri="+ nn2.getNameNodeAddress());
    DataNode dn=cluster.getDataNodes().get(0);
    final Map<String,Object> volInfos=dn.data.getVolumeInfoMap();
    Assert.assertTrue("No volumes in the fsdataset",volInfos.size() > 0);
    int i=0;
    for (    Map.Entry<String,Object> e : volInfos.entrySet()) {
      LOG.info("vol " + i++ + ") "+ e.getKey()+ ": "+ e.getValue());
    }
    assertEquals("number of volumes is wrong",2,volInfos.size());
    for (    BPOfferService bpos : dn.getAllBpOs()) {
      LOG.info("BP: " + bpos);
    }
    BPOfferService bpos1=dn.getAllBpOs()[0];
    BPOfferService bpos2=dn.getAllBpOs()[1];
    if (getNNSocketAddress(bpos1).equals(nn2.getNameNodeAddress())) {
      BPOfferService tmp=bpos1;
      bpos1=bpos2;
      bpos2=tmp;
    }
    assertEquals("wrong nn address",getNNSocketAddress(bpos1),nn1.getNameNodeAddress());
    assertEquals("wrong nn address",getNNSocketAddress(bpos2),nn2.getNameNodeAddress());
    assertEquals("wrong bpid",bpos1.getBlockPoolId(),bpid1);
    assertEquals("wrong bpid",bpos2.getBlockPoolId(),bpid2);
    assertEquals("wrong cid",dn.getClusterId(),cid1);
    assertEquals("cid should be same",cid2,cid1);
    assertEquals("namespace should be same",bpos1.bpNSInfo.namespaceID,ns1);
    assertEquals("namespace should be same",bpos2.bpNSInfo.namespaceID,ns2);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.datanode.TestDiskError </h4><pre class="type-7 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
/** 
 * Checks whether {@link DataNode#checkDiskErrorAsync()} is being called or not.
 * Before refactoring the code the above function was not getting called 
 * @throws IOException, InterruptedException
 */
@Test public void testcheckDiskError() throws IOException, InterruptedException {
  if (cluster.getDataNodes().size() <= 0) {
    cluster.startDataNodes(conf,1,true,null,null);
    cluster.waitActive();
  }
  DataNode dataNode=cluster.getDataNodes().get(0);
  long slackTime=dataNode.checkDiskErrorInterval / 2;
  dataNode.checkDiskErrorAsync();
  Thread.sleep(dataNode.checkDiskErrorInterval);
  long lastDiskErrorCheck=dataNode.getLastDiskErrorCheck();
  assertTrue("Disk Error check is not performed within  " + dataNode.checkDiskErrorInterval + "  ms",((Time.monotonicNow() - lastDiskErrorCheck) < (dataNode.checkDiskErrorInterval + slackTime)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestCheckpoint </h4><pre class="type-9 type-7 type-10 type-19 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests checkpoint in HDFS.
 */
@Test public void testCheckpoint() throws IOException {
  Path file1=new Path("checkpoint.dat");
  Path file2=new Path("checkpoint2.dat");
  Configuration conf=new HdfsConfiguration();
  conf.set(DFSConfigKeys.DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY,"0.0.0.0:0");
  replication=(short)conf.getInt(DFSConfigKeys.DFS_REPLICATION_KEY,3);
  MiniDFSCluster cluster=null;
  FileSystem fileSys=null;
  SecondaryNameNode secondary=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(numDatanodes).build();
    cluster.waitActive();
    fileSys=cluster.getFileSystem();
    assertTrue(!fileSys.exists(file1));
    assertTrue(!fileSys.exists(file2));
    DFSTestUtil.createFile(fileSys,file1,fileSize,fileSize,blockSize,replication,seed);
    checkFile(fileSys,file1,replication);
    secondary=startSecondaryNameNode(conf);
    secondary.doCheckpoint();
    MetricsRecordBuilder rb=getMetrics(NN_METRICS);
    assertCounterGt("GetImageNumOps",0,rb);
    assertCounterGt("GetEditNumOps",0,rb);
    assertCounterGt("PutImageNumOps",0,rb);
    assertGaugeGt("GetImageAvgTime",0.0,rb);
    assertGaugeGt("GetEditAvgTime",0.0,rb);
    assertGaugeGt("PutImageAvgTime",0.0,rb);
  }
  finally {
    fileSys.close();
    cleanup(secondary);
    secondary=null;
    cleanup(cluster);
    cluster=null;
  }
  Path tmpDir=new Path("/tmp_tmp");
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(numDatanodes).format(false).build();
    cluster.waitActive();
    fileSys=cluster.getFileSystem();
    checkFile(fileSys,file1,replication);
    cleanupFile(fileSys,file1);
    DFSTestUtil.createFile(fileSys,file2,fileSize,fileSize,blockSize,replication,seed);
    checkFile(fileSys,file2,replication);
    secondary=startSecondaryNameNode(conf);
    secondary.doCheckpoint();
    FSDirectory secondaryFsDir=secondary.getFSNamesystem().dir;
    INode rootInMap=secondaryFsDir.getInode(secondaryFsDir.rootDir.getId());
    assertSame(rootInMap,secondaryFsDir.rootDir);
    fileSys.delete(tmpDir,true);
    fileSys.mkdirs(tmpDir);
    secondary.doCheckpoint();
  }
  finally {
    fileSys.close();
    cleanup(secondary);
    secondary=null;
    cleanup(cluster);
    cluster=null;
  }
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(numDatanodes).format(false).build();
  cluster.waitActive();
  fileSys=cluster.getFileSystem();
  assertTrue(!fileSys.exists(file1));
  assertTrue(fileSys.exists(tmpDir));
  try {
    checkFile(fileSys,file2,replication);
  }
  finally {
    fileSys.close();
    cluster.shutdown();
    cluster=null;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestEditLogRace </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests rolling edit logs while transactions are ongoing.
 */
@Test public void testEditLogRolling() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  FileSystem fileSys=null;
  AtomicReference<Throwable> caughtErr=new AtomicReference<Throwable>();
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATA_NODES).build();
    cluster.waitActive();
    fileSys=cluster.getFileSystem();
    final FSNamesystem namesystem=cluster.getNamesystem();
    FSImage fsimage=namesystem.getFSImage();
    StorageDirectory sd=fsimage.getStorage().getStorageDir(0);
    startTransactionWorkers(namesystem,caughtErr);
    long previousLogTxId=1;
    for (int i=0; i < NUM_ROLLS && caughtErr.get() == null; i++) {
      try {
        Thread.sleep(20);
      }
 catch (      InterruptedException e) {
      }
      LOG.info("Starting roll " + i + ".");
      CheckpointSignature sig=namesystem.rollEditLog();
      long nextLog=sig.curSegmentTxId;
      String logFileName=NNStorage.getFinalizedEditsFileName(previousLogTxId,nextLog - 1);
      previousLogTxId+=verifyEditLogs(namesystem,fsimage,logFileName,previousLogTxId);
      assertEquals(previousLogTxId,nextLog);
      File expectedLog=NNStorage.getInProgressEditsFile(sd,previousLogTxId);
      assertTrue("Expect " + expectedLog + " to exist",expectedLog.exists());
    }
  }
  finally {
    stopTransactionWorkers();
    if (caughtErr.get() != null) {
      throw new RuntimeException(caughtErr.get());
    }
    if (fileSys != null)     fileSys.close();
    if (cluster != null)     cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestFSImageWithSnapshot </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test when there is snapshot taken on root
 */
@Test public void testSnapshotOnRoot() throws Exception {
  final Path root=new Path("/");
  hdfs.allowSnapshot(root);
  hdfs.createSnapshot(root,"s1");
  cluster.shutdown();
  cluster=new MiniDFSCluster.Builder(conf).format(false).numDataNodes(REPLICATION).build();
  cluster.waitActive();
  fsn=cluster.getNamesystem();
  hdfs=cluster.getFileSystem();
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  hdfs.saveNamespace();
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
  cluster.shutdown();
  cluster=new MiniDFSCluster.Builder(conf).format(false).numDataNodes(REPLICATION).build();
  cluster.waitActive();
  fsn=cluster.getNamesystem();
  hdfs=cluster.getFileSystem();
  INodeDirectory rootNode=fsn.dir.getINode4Write(root.toString()).asDirectory();
  assertTrue("The children list of root should be empty",rootNode.getChildrenList(Snapshot.CURRENT_STATE_ID).isEmpty());
  List<DirectoryDiff> diffList=rootNode.getDiffs().asList();
  assertEquals(1,diffList.size());
  Snapshot s1=rootNode.getSnapshot(DFSUtil.string2Bytes("s1"));
  assertEquals(s1.getId(),diffList.get(0).getSnapshotId());
  assertEquals(1,fsn.getSnapshotManager().getNumSnapshottableDirs());
  SnapshottableDirectoryStatus[] sdirs=fsn.getSnapshotManager().getSnapshottableDirListing(null);
  assertEquals(root,sdirs[0].getFullPath());
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  hdfs.saveNamespace();
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
  cluster.shutdown();
  cluster=new MiniDFSCluster.Builder(conf).format(false).numDataNodes(REPLICATION).build();
  cluster.waitActive();
  fsn=cluster.getNamesystem();
  hdfs=cluster.getFileSystem();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestFavoredNodesEndToEnd </h4><pre class="type-9 type-13 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=180000) public void testWhenSomeNodesAreNotGood() throws Exception {
  final InetSocketAddress addrs[]=new InetSocketAddress[4];
  final String[] hosts=new String[addrs.length];
  for (int i=0; i < addrs.length; i++) {
    addrs[i]=datanodes.get(i).getXferAddress();
    hosts[i]=addrs[i].getAddress().getHostAddress() + ":" + addrs[i].getPort();
  }
  DatanodeInfo d=cluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getDatanodeByXferAddr(addrs[0].getAddress().getHostAddress(),addrs[0].getPort());
  d.setDecommissioned();
  Path p=new Path("/filename-foo-bar-baz");
  final short replication=(short)3;
  FSDataOutputStream out=dfs.create(p,FsPermission.getDefault(),true,4096,replication,4096L,null,addrs);
  out.write(SOME_BYTES);
  out.close();
  d.stopDecommission();
  BlockLocation[] locations=getBlockLocations(p);
  Assert.assertEquals(replication,locations[0].getNames().length);
  ;
  for (int i=0; i < replication; i++) {
    final String loc=locations[0].getNames()[i];
    int j=0;
    for (; j < hosts.length && !loc.equals(hosts[j]); j++)     ;
    Assert.assertTrue("j=" + j,j > 0);
    Assert.assertTrue("loc=" + loc + " not in host list "+ Arrays.asList(hosts)+ ", j="+ j,j < hosts.length);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestParallelImageWrite </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * check if DFS remains in proper condition after a restart 
 */
@Test public void testRestartDFS() throws Exception {
  final Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  FSNamesystem fsn=null;
  int numNamenodeDirs;
  DFSTestUtil files=new DFSTestUtil.Builder().setName("TestRestartDFS").setNumFiles(200).build();
  final String dir="/srcdat";
  final Path rootpath=new Path("/");
  final Path dirpath=new Path(dir);
  long rootmtime;
  FileStatus rootstatus;
  FileStatus dirstatus;
  try {
    cluster=new MiniDFSCluster.Builder(conf).format(true).numDataNodes(NUM_DATANODES).build();
    String[] nameNodeDirs=conf.getStrings(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY,new String[]{});
    numNamenodeDirs=nameNodeDirs.length;
    assertTrue("failed to get number of Namenode StorageDirs",numNamenodeDirs != 0);
    FileSystem fs=cluster.getFileSystem();
    files.createFiles(fs,dir);
    rootmtime=fs.getFileStatus(rootpath).getModificationTime();
    rootstatus=fs.getFileStatus(dirpath);
    dirstatus=fs.getFileStatus(dirpath);
    fs.setOwner(rootpath,rootstatus.getOwner() + "_XXX",null);
    fs.setOwner(dirpath,null,dirstatus.getGroup() + "_XXX");
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
  try {
    conf.setInt(DFSConfigKeys.DFS_NAMENODE_CHECKPOINT_TXNS_KEY,1);
    cluster=new MiniDFSCluster.Builder(conf).format(false).numDataNodes(NUM_DATANODES).build();
    fsn=cluster.getNamesystem();
    FileSystem fs=cluster.getFileSystem();
    assertTrue("Filesystem corrupted after restart.",files.checkFiles(fs,dir));
    final FileStatus newrootstatus=fs.getFileStatus(rootpath);
    assertEquals(rootmtime,newrootstatus.getModificationTime());
    assertEquals(rootstatus.getOwner() + "_XXX",newrootstatus.getOwner());
    assertEquals(rootstatus.getGroup(),newrootstatus.getGroup());
    final FileStatus newdirstatus=fs.getFileStatus(dirpath);
    assertEquals(dirstatus.getOwner(),newdirstatus.getOwner());
    assertEquals(dirstatus.getGroup() + "_XXX",newdirstatus.getGroup());
    rootmtime=fs.getFileStatus(rootpath).getModificationTime();
    final String checkAfterRestart=checkImages(fsn,numNamenodeDirs);
    files.cleanup(fs,dir);
    files.createFiles(fs,dir);
    fsn.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
    cluster.getNameNodeRpc().saveNamespace();
    final String checkAfterModify=checkImages(fsn,numNamenodeDirs);
    assertFalse("Modified namespace should change fsimage contents. " + "was: " + checkAfterRestart + " now: "+ checkAfterModify,checkAfterRestart.equals(checkAfterModify));
    fsn.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
    files.cleanup(fs,dir);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestSnapshotPathINodes </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test {@link INodeDirectory#getExistingPathINodes(byte[][],int,boolean)} 
 * for snapshot file while modifying file after snapshot.
 */
@Test(timeout=15000) public void testSnapshotPathINodesAfterModification() throws Exception {
  String[] names=INode.getPathNames(file1.toString());
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length);
  assertEquals(inodes[components.length - 1].getFullPathName(),file1.toString());
  final long modTime=inodes[inodes.length - 1].getModificationTime();
  hdfs.allowSnapshot(sub1);
  hdfs.createSnapshot(sub1,"s3");
  DFSTestUtil.appendFile(hdfs,file1,"the content for appending");
  String snapshotPath=sub1.toString() + "/.snapshot/s3/file1";
  names=INode.getPathNames(snapshotPath);
  components=INode.getPathComponents(names);
  INodesInPath ssNodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  INode[] ssInodes=ssNodesInPath.getINodes();
  assertEquals(ssInodes.length,components.length - 1);
  final Snapshot s3=getSnapshot(ssNodesInPath,"s3");
  assertSnapshot(ssNodesInPath,true,s3,3);
  INode snapshotFileNode=ssInodes[ssInodes.length - 1];
  assertEquals(snapshotFileNode.getLocalName(),file1.getName());
  assertTrue(snapshotFileNode.asFile().isWithSnapshot());
  assertEquals(modTime,snapshotFileNode.getModificationTime(ssNodesInPath.getPathSnapshotId()));
  names=INode.getPathNames(file1.toString());
  components=INode.getPathComponents(names);
  INodesInPath newNodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  assertSnapshot(newNodesInPath,false,s3,-1);
  INode[] newInodes=newNodesInPath.getINodes();
  assertEquals(newInodes.length,components.length);
  final int last=components.length - 1;
  assertEquals(newInodes[last].getFullPathName(),file1.toString());
  Assert.assertFalse(modTime == newInodes[last].getModificationTime());
  hdfs.deleteSnapshot(sub1,"s3");
  hdfs.disallowSnapshot(sub1);
}

</code></pre>

<br>
<pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test {@link INodeDirectory#getExistingPathINodes(byte[][],int,boolean)} 
 * for normal (non-snapshot) file.
 */
@Test(timeout=15000) public void testNonSnapshotPathINodes() throws Exception {
  String[] names=INode.getPathNames(file1.toString());
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length);
  assertSnapshot(nodesInPath,false,null,-1);
  assertTrue("file1=" + file1 + ", nodesInPath="+ nodesInPath,inodes[components.length - 1] != null);
  assertEquals(inodes[components.length - 1].getFullPathName(),file1.toString());
  assertEquals(inodes[components.length - 2].getFullPathName(),sub1.toString());
  assertEquals(inodes[components.length - 3].getFullPathName(),dir.toString());
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components,1,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,1);
  assertSnapshot(nodesInPath,false,null,-1);
  assertEquals(inodes[0].getFullPathName(),file1.toString());
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components,2,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,2);
  assertSnapshot(nodesInPath,false,null,-1);
  assertEquals(inodes[1].getFullPathName(),file1.toString());
  assertEquals(inodes[0].getFullPathName(),sub1.toString());
}

</code></pre>

<br>
<pre class="type-9 type-7 type-1 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test {@link INodeDirectory#getExistingPathINodes(byte[][],int,boolean)} 
 * for snapshot file while adding a new file after snapshot.
 */
@Test(timeout=15000) public void testSnapshotPathINodesWithAddedFile() throws Exception {
  hdfs.allowSnapshot(sub1);
  hdfs.createSnapshot(sub1,"s4");
  final Path file3=new Path(sub1,"file3");
  DFSTestUtil.createFile(hdfs,file3,1024,REPLICATION,seed);
{
    String snapshotPath=sub1.toString() + "/.snapshot/s4/file3";
    String[] names=INode.getPathNames(snapshotPath);
    byte[][] components=INode.getPathComponents(names);
    INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
    INode[] inodes=nodesInPath.getINodes();
    assertEquals(inodes.length,components.length - 1);
    assertEquals(nodesInPath.getNumNonNull(),components.length - 2);
    s4=getSnapshot(nodesInPath,"s4");
    assertSnapshot(nodesInPath,true,s4,3);
    assertNull(inodes[inodes.length - 1]);
  }
  String[] names=INode.getPathNames(file3.toString());
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length);
  assertSnapshot(nodesInPath,false,s4,-1);
  assertEquals(inodes[components.length - 1].getFullPathName(),file3.toString());
  assertEquals(inodes[components.length - 2].getFullPathName(),sub1.toString());
  assertEquals(inodes[components.length - 3].getFullPathName(),dir.toString());
  hdfs.deleteSnapshot(sub1,"s4");
  hdfs.disallowSnapshot(sub1);
}

</code></pre>

<br>
<pre class="type-9 type-13 type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test {@link INodeDirectory#getExistingPathINodes(byte[][],int,boolean)} 
 * for snapshot file.
 */
@Test(timeout=15000) public void testSnapshotPathINodes() throws Exception {
  hdfs.allowSnapshot(sub1);
  hdfs.createSnapshot(sub1,"s1");
  String snapshotPath=sub1.toString() + "/.snapshot/s1/file1";
  String[] names=INode.getPathNames(snapshotPath);
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length - 1);
  final Snapshot snapshot=getSnapshot(nodesInPath,"s1");
  assertSnapshot(nodesInPath,true,snapshot,3);
  INode snapshotFileNode=inodes[inodes.length - 1];
  assertINodeFile(snapshotFileNode,file1);
  assertTrue(snapshotFileNode.getParent().isWithSnapshot());
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components,1,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,1);
  assertSnapshot(nodesInPath,true,snapshot,-1);
  assertINodeFile(nodesInPath.getLastINode(),file1);
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components,2,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,2);
  assertSnapshot(nodesInPath,true,snapshot,0);
  assertINodeFile(nodesInPath.getLastINode(),file1);
  String dotSnapshotPath=sub1.toString() + "/.snapshot";
  names=INode.getPathNames(dotSnapshotPath);
  components=INode.getPathComponents(names);
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length - 1);
  assertSnapshot(nodesInPath,true,snapshot,-1);
  final INode last=nodesInPath.getLastINode();
  assertEquals(last.getFullPathName(),sub1.toString());
  assertFalse(last instanceof INodeFile);
  String[] invalidPathComponent={"invalidDir","foo",".snapshot","bar"};
  Path invalidPath=new Path(invalidPathComponent[0]);
  for (int i=1; i < invalidPathComponent.length; i++) {
    invalidPath=new Path(invalidPath,invalidPathComponent[i]);
    try {
      hdfs.getFileStatus(invalidPath);
      Assert.fail();
    }
 catch (    FileNotFoundException fnfe) {
      System.out.println("The exception is expected: " + fnfe);
    }
  }
  hdfs.deleteSnapshot(sub1,"s1");
  hdfs.disallowSnapshot(sub1);
}

</code></pre>

<br>
<pre class="type-9 type-7 type-10 type-1 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test {@link INodeDirectory#getExistingPathINodes(byte[][],int,boolean)} 
 * for snapshot file after deleting the original file.
 */
@Test(timeout=15000) public void testSnapshotPathINodesAfterDeletion() throws Exception {
  hdfs.allowSnapshot(sub1);
  hdfs.createSnapshot(sub1,"s2");
  hdfs.delete(file1,false);
  final Snapshot snapshot;
{
    String snapshotPath=sub1.toString() + "/.snapshot/s2/file1";
    String[] names=INode.getPathNames(snapshotPath);
    byte[][] components=INode.getPathComponents(names);
    INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
    INode[] inodes=nodesInPath.getINodes();
    assertEquals(inodes.length,components.length - 1);
    snapshot=getSnapshot(nodesInPath,"s2");
    assertSnapshot(nodesInPath,true,snapshot,3);
    final INode inode=inodes[inodes.length - 1];
    assertEquals(file1.getName(),inode.getLocalName());
    assertTrue(inode.asFile().isWithSnapshot());
  }
  String[] names=INode.getPathNames(file1.toString());
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length);
  assertEquals(nodesInPath.getNumNonNull(),components.length - 1);
  assertSnapshot(nodesInPath,false,snapshot,-1);
  assertNull(inodes[components.length - 1]);
  assertEquals(inodes[components.length - 2].getFullPathName(),sub1.toString());
  assertEquals(inodes[components.length - 3].getFullPathName(),dir.toString());
  hdfs.deleteSnapshot(sub1,"s2");
  hdfs.disallowSnapshot(sub1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.ha.TestQuotasWithHA </h4><pre class="type-9 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Test that quotas are properly tracked by the standby through
 * create, append, delete.
 */
@Test(timeout=60000) public void testQuotasTrackedOnStandby() throws Exception {
  fs.mkdirs(TEST_DIR);
  DistributedFileSystem dfs=(DistributedFileSystem)fs;
  dfs.setQuota(TEST_DIR,NS_QUOTA,DS_QUOTA);
  long expectedSize=3 * BLOCK_SIZE + BLOCK_SIZE / 2;
  DFSTestUtil.createFile(fs,TEST_FILE,expectedSize,(short)1,1L);
  HATestUtil.waitForStandbyToCatchUp(nn0,nn1);
  ContentSummary cs=nn1.getRpcServer().getContentSummary(TEST_DIR_STR);
  assertEquals(NS_QUOTA,cs.getQuota());
  assertEquals(DS_QUOTA,cs.getSpaceQuota());
  assertEquals(expectedSize,cs.getSpaceConsumed());
  assertEquals(1,cs.getDirectoryCount());
  assertEquals(1,cs.getFileCount());
  FSDataOutputStream stm=fs.append(TEST_FILE);
  try {
    byte[] data=new byte[(int)(BLOCK_SIZE * 3 / 2)];
    stm.write(data);
    expectedSize+=data.length;
  }
  finally {
    IOUtils.closeStream(stm);
  }
  HATestUtil.waitForStandbyToCatchUp(nn0,nn1);
  cs=nn1.getRpcServer().getContentSummary(TEST_DIR_STR);
  assertEquals(NS_QUOTA,cs.getQuota());
  assertEquals(DS_QUOTA,cs.getSpaceQuota());
  assertEquals(expectedSize,cs.getSpaceConsumed());
  assertEquals(1,cs.getDirectoryCount());
  assertEquals(1,cs.getFileCount());
  fs.delete(TEST_FILE,true);
  expectedSize=0;
  HATestUtil.waitForStandbyToCatchUp(nn0,nn1);
  cs=nn1.getRpcServer().getContentSummary(TEST_DIR_STR);
  assertEquals(NS_QUOTA,cs.getQuota());
  assertEquals(DS_QUOTA,cs.getSpaceQuota());
  assertEquals(expectedSize,cs.getSpaceConsumed());
  assertEquals(1,cs.getDirectoryCount());
  assertEquals(0,cs.getFileCount());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotFileLength </h4><pre class="type-9 type-7 type-21 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Verifies values related to public fields.
"></span><br>
/** 
 * Test that we cannot read a file beyond its snapshot length
 * when accessing it via a snapshot path.
 */
@Test(timeout=300000) public void testSnapshotfileLength() throws Exception {
  hdfs.mkdirs(sub);
  int bytesRead;
  byte[] buffer=new byte[BLOCKSIZE * 8];
  FSDataInputStream fis=null;
  FileStatus fileStatus=null;
  Path file1=new Path(sub,file1Name);
  DFSTestUtil.createFile(hdfs,file1,0,REPLICATION,SEED);
  DFSTestUtil.appendFile(hdfs,file1,BLOCKSIZE);
  hdfs.allowSnapshot(sub);
  hdfs.createSnapshot(sub,snapshot1);
  DFSTestUtil.appendFile(hdfs,file1,BLOCKSIZE);
  fileStatus=hdfs.getFileStatus(file1);
  assertThat(fileStatus.getLen(),is((long)BLOCKSIZE * 2));
  fis=hdfs.open(file1);
  bytesRead=fis.read(0,buffer,0,buffer.length);
  assertThat(bytesRead,is(BLOCKSIZE * 2));
  fis.close();
  Path file1snap1=SnapshotTestHelper.getSnapshotPath(sub,snapshot1,file1Name);
  fis=hdfs.open(file1snap1);
  fileStatus=hdfs.getFileStatus(file1snap1);
  assertThat(fileStatus.getLen(),is((long)BLOCKSIZE));
  bytesRead=fis.read(0,buffer,0,buffer.length);
  assertThat(bytesRead,is(BLOCKSIZE));
  fis.close();
}

</code></pre>

<br>
<pre class="type-9 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Adding as part of jira HDFS-5343
 * Test for checking the cat command on snapshot path it
 * cannot read a file beyond snapshot file length
 * @throws Exception
 */
@Test(timeout=600000) public void testSnapshotFileLengthWithCatCommand() throws Exception {
  FSDataInputStream fis=null;
  FileStatus fileStatus=null;
  int bytesRead;
  byte[] buffer=new byte[BLOCKSIZE * 8];
  hdfs.mkdirs(sub);
  Path file1=new Path(sub,file1Name);
  DFSTestUtil.createFile(hdfs,file1,BLOCKSIZE,REPLICATION,SEED);
  hdfs.allowSnapshot(sub);
  hdfs.createSnapshot(sub,snapshot1);
  DFSTestUtil.appendFile(hdfs,file1,BLOCKSIZE);
  fileStatus=hdfs.getFileStatus(file1);
  assertEquals("Unexpected file length",BLOCKSIZE * 2,fileStatus.getLen());
  fis=hdfs.open(file1);
  bytesRead=fis.read(buffer,0,buffer.length);
  assertEquals("Unexpected # bytes read",BLOCKSIZE * 2,bytesRead);
  fis.close();
  Path file1snap1=SnapshotTestHelper.getSnapshotPath(sub,snapshot1,file1Name);
  fis=hdfs.open(file1snap1);
  fileStatus=hdfs.getFileStatus(file1snap1);
  assertEquals(fileStatus.getLen(),BLOCKSIZE);
  bytesRead=fis.read(buffer,0,buffer.length);
  assertEquals("Unexpected # bytes read",BLOCKSIZE,bytesRead);
  fis.close();
  PrintStream outBackup=System.out;
  PrintStream errBackup=System.err;
  ByteArrayOutputStream bao=new ByteArrayOutputStream();
  System.setOut(new PrintStream(bao));
  System.setErr(new PrintStream(bao));
  FsShell shell=new FsShell();
  try {
    ToolRunner.run(conf,shell,new String[]{"-cat","/TestSnapshotFileLength/sub1/.snapshot/snapshot1/file1"});
    assertEquals("Unexpected # bytes from -cat",BLOCKSIZE,bao.size());
  }
  finally {
    System.setOut(outBackup);
    System.setErr(errBackup);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.startupprogress.TestStartupProgress </h4><pre class="type-7 type-1 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testStepSequence(){
  Step[] expectedSteps=new Step[]{new Step(INODES,"file1"),new Step(DELEGATION_KEYS,"file1"),new Step(INODES,"file2"),new Step(DELEGATION_KEYS,"file2"),new Step(INODES,"file3"),new Step(DELEGATION_KEYS,"file3")};
  List<Step> shuffledSteps=new ArrayList<Step>(Arrays.asList(expectedSteps));
  Collections.shuffle(shuffledSteps);
  startupProgress.beginPhase(SAVING_CHECKPOINT);
  for (  Step step : shuffledSteps) {
    startupProgress.beginStep(SAVING_CHECKPOINT,step);
  }
  List<Step> actualSteps=new ArrayList<Step>(expectedSteps.length);
  StartupProgressView view=startupProgress.createView();
  assertNotNull(view);
  for (  Step step : view.getSteps(SAVING_CHECKPOINT)) {
    actualSteps.add(step);
  }
  assertArrayEquals(expectedSteps,actualSteps.toArray());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.web.resources.TestWebHdfsDataLocality </h4><pre class="type-9 type-13 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testDataLocality() throws Exception {
  final Configuration conf=WebHdfsTestUtil.createConf();
  final String[] racks={RACK0,RACK0,RACK1,RACK1,RACK2,RACK2};
  final int nDataNodes=racks.length;
  LOG.info("nDataNodes=" + nDataNodes + ", racks="+ Arrays.asList(racks));
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(nDataNodes).racks(racks).build();
  try {
    cluster.waitActive();
    final DistributedFileSystem dfs=cluster.getFileSystem();
    final NameNode namenode=cluster.getNameNode();
    final DatanodeManager dm=namenode.getNamesystem().getBlockManager().getDatanodeManager();
    LOG.info("dm=" + dm);
    final long blocksize=DFSConfigKeys.DFS_BLOCK_SIZE_DEFAULT;
    final String f="/foo";
{
      for (int i=0; i < nDataNodes; i++) {
        final DataNode dn=cluster.getDataNodes().get(i);
        final String ipAddr=dm.getDatanode(dn.getDatanodeId()).getIpAddr();
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,PutOpParam.Op.CREATE,-1L,blocksize,null);
        Assert.assertEquals(ipAddr,chosen.getIpAddr());
      }
    }
    final Path p=new Path(f);
    final FSDataOutputStream out=dfs.create(p,(short)1);
    out.write(1);
    out.close();
    final LocatedBlocks locatedblocks=NameNodeAdapter.getBlockLocations(namenode,f,0,1);
    final List<LocatedBlock> lb=locatedblocks.getLocatedBlocks();
    Assert.assertEquals(1,lb.size());
    final DatanodeInfo[] locations=lb.get(0).getLocations();
    Assert.assertEquals(1,locations.length);
    final DatanodeInfo expected=locations[0];
{
      final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.GETFILECHECKSUM,-1L,blocksize,null);
      Assert.assertEquals(expected,chosen);
    }
{
      final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.OPEN,0,blocksize,null);
      Assert.assertEquals(expected,chosen);
    }
{
      final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,PostOpParam.Op.APPEND,-1L,blocksize,null);
      Assert.assertEquals(expected,chosen);
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testExcludeDataNodes() throws Exception {
  final Configuration conf=WebHdfsTestUtil.createConf();
  final String[] racks={RACK0,RACK0,RACK1,RACK1,RACK2,RACK2};
  final String[] hosts={"DataNode1","DataNode2","DataNode3","DataNode4","DataNode5","DataNode6"};
  final int nDataNodes=hosts.length;
  LOG.info("nDataNodes=" + nDataNodes + ", racks="+ Arrays.asList(racks)+ ", hosts="+ Arrays.asList(hosts));
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).hosts(hosts).numDataNodes(nDataNodes).racks(racks).build();
  try {
    cluster.waitActive();
    final DistributedFileSystem dfs=cluster.getFileSystem();
    final NameNode namenode=cluster.getNameNode();
    final DatanodeManager dm=namenode.getNamesystem().getBlockManager().getDatanodeManager();
    LOG.info("dm=" + dm);
    final long blocksize=DFSConfigKeys.DFS_BLOCK_SIZE_DEFAULT;
    final String f="/foo";
    final Path p=new Path(f);
    final FSDataOutputStream out=dfs.create(p,(short)3);
    out.write(1);
    out.close();
    final LocatedBlocks locatedblocks=NameNodeAdapter.getBlockLocations(namenode,f,0,1);
    final List<LocatedBlock> lb=locatedblocks.getLocatedBlocks();
    Assert.assertEquals(1,lb.size());
    final DatanodeInfo[] locations=lb.get(0).getLocations();
    Assert.assertEquals(3,locations.length);
    StringBuffer sb=new StringBuffer();
    for (int i=0; i < 2; i++) {
      sb.append(locations[i].getXferAddr());
{
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.GETFILECHECKSUM,-1L,blocksize,sb.toString());
        for (int j=0; j <= i; j++) {
          Assert.assertNotEquals(locations[j].getHostName(),chosen.getHostName());
        }
      }
{
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.OPEN,0,blocksize,sb.toString());
        for (int j=0; j <= i; j++) {
          Assert.assertNotEquals(locations[j].getHostName(),chosen.getHostName());
        }
      }
{
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,PostOpParam.Op.APPEND,-1L,blocksize,sb.toString());
        for (int j=0; j <= i; j++) {
          Assert.assertNotEquals(locations[j].getHostName(),chosen.getHostName());
        }
      }
      sb.append(",");
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.web.TestWebHDFSForHA </h4><pre class="type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testFailoverAfterOpen() throws IOException {
  Configuration conf=DFSTestUtil.newHAConfiguration(LOGICAL_NAME);
  conf.set(FS_DEFAULT_NAME_KEY,HdfsConstants.HDFS_URI_SCHEME + "://" + LOGICAL_NAME);
  MiniDFSCluster cluster=null;
  FileSystem fs=null;
  final Path p=new Path("/test");
  final byte[] data="Hello".getBytes();
  try {
    cluster=new MiniDFSCluster.Builder(conf).nnTopology(topo).numDataNodes(1).build();
    HATestUtil.setFailoverConfigurations(cluster,conf,LOGICAL_NAME);
    cluster.waitActive();
    fs=FileSystem.get(WEBHDFS_URI,conf);
    cluster.transitionToActive(1);
    FSDataOutputStream out=fs.create(p);
    cluster.shutdownNameNode(1);
    cluster.transitionToActive(0);
    out.write(data);
    out.close();
    FSDataInputStream in=fs.open(p);
    byte[] buf=new byte[data.length];
    IOUtils.readFully(in,buf,0,buf.length);
    Assert.assertArrayEquals(data,buf);
  }
  finally {
    IOUtils.cleanup(null,fs);
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.http.TestHttpServer </h4><pre class="type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the maximum number of threads cannot be exceeded. 
 */
@Test public void testMaxThreads() throws Exception {
  int clientThreads=MAX_THREADS * 10;
  Executor executor=Executors.newFixedThreadPool(clientThreads);
  final CountDownLatch ready=new CountDownLatch(clientThreads);
  final CountDownLatch start=new CountDownLatch(1);
  for (int i=0; i < clientThreads; i++) {
    executor.execute(new Runnable(){
      @Override public void run(){
        ready.countDown();
        try {
          start.await();
          assertEquals("a:b\nc:d\n",readOutput(new URL(baseUrl,"/echo?a=b&c=d")));
          int serverThreads=server.webServer.getThreadPool().getThreads();
          assertTrue("More threads are started than expected, Server Threads count: " + serverThreads,serverThreads <= MAX_THREADS);
          System.out.println("Number of threads = " + serverThreads + " which is less or equal than the max = "+ MAX_THREADS);
        }
 catch (        Exception e) {
        }
      }
    }
);
  }
  ready.await();
  start.countDown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.TestBytesWritable </h4><pre class="type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test was written as result of adding the new zero
 * copy constructor and set method to BytesWritable. These
 * methods allow users to specify the backing buffer of the
 * BytesWritable instance and a length. 
 */
@Test public void testZeroCopy(){
  byte[] bytes="brock".getBytes();
  BytesWritable zeroBuf=new BytesWritable(bytes,bytes.length);
  BytesWritable copyBuf=new BytesWritable(bytes);
  assertTrue("copy took place, backing array != array passed to constructor",bytes == zeroBuf.getBytes());
  assertTrue("length of BW should backing byte array",zeroBuf.getLength() == bytes.length);
  assertEquals("objects with same backing array should be equal",zeroBuf,copyBuf);
  assertEquals("string repr of objects with same backing array should be equal",zeroBuf.toString(),copyBuf.toString());
  assertTrue("compare order objects with same backing array should be equal",zeroBuf.compareTo(copyBuf) == 0);
  assertTrue("hash of objects with same backing array should be equal",zeroBuf.hashCode() == copyBuf.hashCode());
  byte[] buffer=new byte[bytes.length * 5];
  zeroBuf.set(buffer,0,buffer.length);
  zeroBuf.set(bytes,0,bytes.length);
  assertEquals("buffer created with (array, len) has bad contents",zeroBuf,copyBuf);
  assertTrue("buffer created with (array, len) has bad length",zeroBuf.getLength() == copyBuf.getLength());
}

</code></pre>

<br>
<pre class="type-13 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testCompare() throws Exception {
  byte[][] values=new byte[][]{"abc".getBytes(),"ad".getBytes(),"abcd".getBytes(),"".getBytes(),"b".getBytes()};
  BytesWritable[] buf=new BytesWritable[values.length];
  for (int i=0; i < values.length; ++i) {
    buf[i]=new BytesWritable(values[i]);
  }
  for (int i=0; i < values.length; ++i) {
    for (int j=0; j < values.length; ++j) {
      assertTrue(buf[i].compareTo(buf[j]) == -buf[j].compareTo(buf[i]));
      assertTrue((i == j) == (buf[i].compareTo(buf[j]) == 0));
    }
  }
  assertTrue(buf[0].compareTo(buf[1]) < 0);
  assertTrue(buf[1].compareTo(buf[2]) > 0);
  assertTrue(buf[2].compareTo(buf[3]) > 0);
  assertTrue(buf[3].compareTo(buf[4]) < 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.TestIOUtils </h4><pre class="type-13 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testWriteFully() throws IOException {
  final int INPUT_BUFFER_LEN=10000;
  final int HALFWAY=1 + (INPUT_BUFFER_LEN / 2);
  byte[] input=new byte[INPUT_BUFFER_LEN];
  for (int i=0; i < input.length; i++) {
    input[i]=(byte)(i & 0xff);
  }
  byte[] output=new byte[input.length];
  try {
    RandomAccessFile raf=new RandomAccessFile(TEST_FILE_NAME,"rw");
    FileChannel fc=raf.getChannel();
    ByteBuffer buf=ByteBuffer.wrap(input);
    IOUtils.writeFully(fc,buf);
    raf.seek(0);
    raf.read(output);
    for (int i=0; i < input.length; i++) {
      assertEquals(input[i],output[i]);
    }
    buf.rewind();
    IOUtils.writeFully(fc,buf,HALFWAY);
    for (int i=0; i < HALFWAY; i++) {
      assertEquals(input[i],output[i]);
    }
    raf.seek(0);
    raf.read(output);
    for (int i=HALFWAY; i < input.length; i++) {
      assertEquals(input[i - HALFWAY],output[i]);
    }
    raf.close();
  }
  finally {
    File f=new File(TEST_FILE_NAME);
    if (f.exists()) {
      f.delete();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.compress.lz4.TestLz4CompressorDecompressor </h4><pre class="type-9 type-2 type-7 type-10 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetInputWithBytesSizeMoreThenDefaultLz4CompressorByfferSize(){
  int BYTES_SIZE=1024 * 64 + 1;
  try {
    Lz4Compressor compressor=new Lz4Compressor();
    byte[] bytes=generate(BYTES_SIZE);
    assertTrue("needsInput error !!!",compressor.needsInput());
    compressor.setInput(bytes,0,bytes.length);
    byte[] emptyBytes=new byte[BYTES_SIZE];
    int csize=compressor.compress(emptyBytes,0,bytes.length);
    assertTrue("testSetInputWithBytesSizeMoreThenDefaultLz4CompressorByfferSize error !!!",csize != 0);
  }
 catch (  Exception ex) {
    fail("testSetInputWithBytesSizeMoreThenDefaultLz4CompressorByfferSize ex error !!!");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.ipc.TestCallQueueManager </h4><pre class="type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test(timeout=60000) public void testSwapUnderContention() throws InterruptedException {
  manager=new CallQueueManager<FakeCall>(queueClass,5000,"",null);
  ArrayList<Putter> producers=new ArrayList<Putter>();
  ArrayList<Taker> consumers=new ArrayList<Taker>();
  HashMap<Runnable,Thread> threads=new HashMap<Runnable,Thread>();
  for (int i=0; i < 50; i++) {
    Putter p=new Putter(manager,-1,-1);
    Thread pt=new Thread(p);
    producers.add(p);
    threads.put(p,pt);
    pt.start();
  }
  for (int i=0; i < 20; i++) {
    Taker t=new Taker(manager,-1,-1);
    Thread tt=new Thread(t);
    consumers.add(t);
    threads.put(t,tt);
    tt.start();
  }
  Thread.sleep(10);
  for (int i=0; i < 5; i++) {
    manager.swapQueue(queueClass,5000,"",null);
  }
  for (  Putter p : producers) {
    p.stop();
  }
  Thread.sleep(2000);
  assertEquals(0,manager.size());
  long totalCallsCreated=0;
  for (  Putter p : producers) {
    threads.get(p).interrupt();
  }
  for (  Putter p : producers) {
    threads.get(p).join();
    totalCallsCreated+=p.callsAdded;
  }
  long totalCallsConsumed=0;
  for (  Taker t : consumers) {
    threads.get(t).interrupt();
  }
  for (  Taker t : consumers) {
    threads.get(t).join();
    totalCallsConsumed+=t.callsTaken;
  }
  assertEquals(totalCallsConsumed,totalCallsCreated);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.ipc.TestIPC </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test if
 * (1) the rpc server uses the call id/retry provided by the rpc client, and
 * (2) the rpc client receives the same call id/retry from the rpc server.
 */
@Test(timeout=60000) public void testCallIdAndRetry() throws IOException {
  final CallInfo info=new CallInfo();
  final Client client=new Client(LongWritable.class,conf){
    @Override Call createCall(    RpcKind rpcKind,    Writable rpcRequest){
      final Call call=super.createCall(rpcKind,rpcRequest);
      info.id=call.id;
      info.retry=call.retry;
      return call;
    }
    @Override void checkResponse(    RpcResponseHeaderProto header) throws IOException {
      super.checkResponse(header);
      Assert.assertEquals(info.id,header.getCallId());
      Assert.assertEquals(info.retry,header.getRetryCount());
    }
  }
;
  final TestServer server=new TestServer(1,false);
  server.callListener=new Runnable(){
    @Override public void run(){
      Assert.assertEquals(info.id,Server.getCallId());
      Assert.assertEquals(info.retry,Server.getCallRetryCount());
    }
  }
;
  try {
    InetSocketAddress addr=NetUtils.getConnectAddress(server);
    server.start();
    final SerialCaller caller=new SerialCaller(client,addr,10);
    caller.run();
    assertFalse(caller.failed);
  }
  finally {
    client.stop();
    server.stop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestIFile </h4><pre class="type-9 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testIFileReaderWithCodec() throws Exception {
  Configuration conf=new Configuration();
  FileSystem localFs=FileSystem.getLocal(conf);
  FileSystem rfs=((LocalFileSystem)localFs).getRaw();
  Path path=new Path(new Path("build/test.ifile"),"data");
  DefaultCodec codec=new GzipCodec();
  codec.setConf(conf);
  FSDataOutputStream out=rfs.create(path);
  IFile.Writer<Text,Text> writer=new IFile.Writer<Text,Text>(conf,out,Text.class,Text.class,codec,null);
  writer.close();
  FSDataInputStream in=rfs.open(path);
  IFile.Reader<Text,Text> reader=new IFile.Reader<Text,Text>(conf,in,rfs.getFileStatus(path).getLen(),codec,null);
  reader.close();
  byte[] ab=new byte[100];
  int readed=reader.checksumIn.readWithChecksum(ab,0,ab.length);
  assertEquals(readed,reader.checksumIn.getChecksum().length);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestTextInputFormat </h4><pre class="type-7 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test(timeout=5000) public void testMRMaxLine() throws Exception {
  final int MAXPOS=1024 * 1024;
  final int MAXLINE=10 * 1024;
  final int BUF=64 * 1024;
  final InputStream infNull=new InputStream(){
    int position=0;
    final int MAXPOSBUF=1024 * 1024 + BUF;
    @Override public int read(){
      ++position;
      return 0;
    }
    @Override public int read(    byte[] b){
      assertTrue("Read too many bytes from the stream",position < MAXPOSBUF);
      Arrays.fill(b,(byte)0);
      position+=b.length;
      return b.length;
    }
    public void reset(){
      position=0;
    }
  }
;
  final LongWritable key=new LongWritable();
  final Text val=new Text();
  LOG.info("Reading a line from /dev/null");
  final Configuration conf=new Configuration(false);
  conf.setInt(org.apache.hadoop.mapreduce.lib.input.LineRecordReader.MAX_LINE_LENGTH,MAXLINE);
  conf.setInt("io.file.buffer.size",BUF);
  LineRecordReader lrr=new LineRecordReader(infNull,0,MAXPOS,conf);
  assertFalse("Read a line from null",lrr.next(key,val));
  infNull.reset();
  lrr=new LineRecordReader(infNull,0L,MAXLINE,MAXPOS);
  assertFalse("Read a line from null",lrr.next(key,val));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.app.TestMRClientService </h4><pre class="type-9 type-7 type-1 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  MRAppWithClientService app=new MRAppWithClientService(1,0,false);
  Configuration conf=new Configuration();
  Job job=app.submit(conf);
  app.waitForState(job,JobState.RUNNING);
  Assert.assertEquals("Num tasks not correct",1,job.getTasks().size());
  Iterator<Task> it=job.getTasks().values().iterator();
  Task task=it.next();
  app.waitForState(task,TaskState.RUNNING);
  TaskAttempt attempt=task.getAttempts().values().iterator().next();
  app.waitForState(attempt,TaskAttemptState.RUNNING);
  String diagnostic1="Diagnostic1";
  String diagnostic2="Diagnostic2";
  app.getContext().getEventHandler().handle(new TaskAttemptDiagnosticsUpdateEvent(attempt.getID(),diagnostic1));
  TaskAttemptStatus taskAttemptStatus=new TaskAttemptStatus();
  taskAttemptStatus.id=attempt.getID();
  taskAttemptStatus.progress=0.5f;
  taskAttemptStatus.stateString="RUNNING";
  taskAttemptStatus.taskState=TaskAttemptState.RUNNING;
  taskAttemptStatus.phase=Phase.MAP;
  app.getContext().getEventHandler().handle(new TaskAttemptStatusUpdateEvent(attempt.getID(),taskAttemptStatus));
  YarnRPC rpc=YarnRPC.create(conf);
  MRClientProtocol proxy=(MRClientProtocol)rpc.getProxy(MRClientProtocol.class,app.clientService.getBindAddress(),conf);
  GetCountersRequest gcRequest=recordFactory.newRecordInstance(GetCountersRequest.class);
  gcRequest.setJobId(job.getID());
  Assert.assertNotNull("Counters is null",proxy.getCounters(gcRequest).getCounters());
  GetJobReportRequest gjrRequest=recordFactory.newRecordInstance(GetJobReportRequest.class);
  gjrRequest.setJobId(job.getID());
  JobReport jr=proxy.getJobReport(gjrRequest).getJobReport();
  verifyJobReport(jr);
  GetTaskAttemptCompletionEventsRequest gtaceRequest=recordFactory.newRecordInstance(GetTaskAttemptCompletionEventsRequest.class);
  gtaceRequest.setJobId(job.getID());
  gtaceRequest.setFromEventId(0);
  gtaceRequest.setMaxEvents(10);
  Assert.assertNotNull("TaskCompletionEvents is null",proxy.getTaskAttemptCompletionEvents(gtaceRequest).getCompletionEventList());
  GetDiagnosticsRequest gdRequest=recordFactory.newRecordInstance(GetDiagnosticsRequest.class);
  gdRequest.setTaskAttemptId(attempt.getID());
  Assert.assertNotNull("Diagnostics is null",proxy.getDiagnostics(gdRequest).getDiagnosticsList());
  GetTaskAttemptReportRequest gtarRequest=recordFactory.newRecordInstance(GetTaskAttemptReportRequest.class);
  gtarRequest.setTaskAttemptId(attempt.getID());
  TaskAttemptReport tar=proxy.getTaskAttemptReport(gtarRequest).getTaskAttemptReport();
  verifyTaskAttemptReport(tar);
  GetTaskReportRequest gtrRequest=recordFactory.newRecordInstance(GetTaskReportRequest.class);
  gtrRequest.setTaskId(task.getID());
  Assert.assertNotNull("TaskReport is null",proxy.getTaskReport(gtrRequest).getTaskReport());
  GetTaskReportsRequest gtreportsRequest=recordFactory.newRecordInstance(GetTaskReportsRequest.class);
  gtreportsRequest.setJobId(job.getID());
  gtreportsRequest.setTaskType(TaskType.MAP);
  Assert.assertNotNull("TaskReports for map is null",proxy.getTaskReports(gtreportsRequest).getTaskReportList());
  gtreportsRequest=recordFactory.newRecordInstance(GetTaskReportsRequest.class);
  gtreportsRequest.setJobId(job.getID());
  gtreportsRequest.setTaskType(TaskType.REDUCE);
  Assert.assertNotNull("TaskReports for reduce is null",proxy.getTaskReports(gtreportsRequest).getTaskReportList());
  List<String> diag=proxy.getDiagnostics(gdRequest).getDiagnosticsList();
  Assert.assertEquals("Num diagnostics not correct",1,diag.size());
  Assert.assertEquals("Diag 1 not correct",diagnostic1,diag.get(0).toString());
  TaskReport taskReport=proxy.getTaskReport(gtrRequest).getTaskReport();
  Assert.assertEquals("Num diagnostics not correct",1,taskReport.getDiagnosticsCount());
  app.getContext().getEventHandler().handle(new TaskAttemptEvent(task.getAttempts().values().iterator().next().getID(),TaskAttemptEventType.TA_DONE));
  app.waitForState(job,JobState.SUCCEEDED);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.metrics2.util.TestSampleQuantiles </h4><pre class="type-9 type-13 type-7 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
/** 
 * Correctness test that checks that absolute error of the estimate is within
 * specified error bounds for some randomly permuted streams of items.
 */
@Test public void testQuantileError() throws IOException {
  final int count=100000;
  Random r=new Random(0xDEADDEAD);
  Long[] values=new Long[count];
  for (int i=0; i < count; i++) {
    values[i]=(long)(i + 1);
  }
  for (int i=0; i < 10; i++) {
    System.out.println("Starting run " + i);
    Collections.shuffle(Arrays.asList(values),r);
    estimator.clear();
    for (int j=0; j < count; j++) {
      estimator.insert(values[j]);
    }
    Map<Quantile,Long> snapshot;
    snapshot=estimator.snapshot();
    for (    Quantile q : quantiles) {
      long actual=(long)(q.quantile * count);
      long error=(long)(q.error * count);
      long estimate=snapshot.get(q);
      System.out.println(String.format("Expected %d with error %d, estimated %d",actual,error,estimate));
      assertTrue(estimate <= actual + error);
      assertTrue(estimate >= actual - error);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.net.TestSocketIOWithTimeout </h4><pre class="type-9 type-11 type-2 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSocketIOWithTimeout() throws Exception {
  Pipe pipe=Pipe.open();
  Pipe.SourceChannel source=pipe.source();
  Pipe.SinkChannel sink=pipe.sink();
  try {
    final InputStream in=new SocketInputStream(source,TIMEOUT);
    OutputStream out=new SocketOutputStream(sink,TIMEOUT);
    byte[] writeBytes=TEST_STRING.getBytes();
    byte[] readBytes=new byte[writeBytes.length];
    byte byteWithHighBit=(byte)0x80;
    out.write(writeBytes);
    out.write(byteWithHighBit);
    doIO(null,out,TIMEOUT);
    in.read(readBytes);
    assertTrue(Arrays.equals(writeBytes,readBytes));
    assertEquals(byteWithHighBit & 0xff,in.read());
    doIO(in,null,TIMEOUT);
    ((SocketInputStream)in).setTimeout(TIMEOUT * 2);
    doIO(in,null,TIMEOUT * 2);
    ((SocketInputStream)in).setTimeout(0);
    TestingThread thread=new TestingThread(ctx){
      @Override public void doWork() throws Exception {
        try {
          in.read();
          fail("Did not fail with interrupt");
        }
 catch (        InterruptedIOException ste) {
          LOG.info("Got expection while reading as expected : " + ste.getMessage());
        }
      }
    }
;
    ctx.addThread(thread);
    ctx.startThreads();
    Thread.sleep(1000);
    thread.interrupt();
    ctx.stop();
    assertTrue(source.isOpen());
    assertTrue(sink.isOpen());
    if (!Shell.WINDOWS && !Shell.PPC_64) {
      try {
        out.write(1);
        fail("Did not throw");
      }
 catch (      IOException ioe) {
        GenericTestUtils.assertExceptionContains("stream is closed",ioe);
      }
    }
    out.close();
    assertFalse(sink.isOpen());
    assertEquals(-1,in.read());
    in.close();
    assertFalse(source.isOpen());
  }
  finally {
    if (source != null) {
      source.close();
    }
    if (sink != null) {
      sink.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.net.unix.TestDomainSocket </h4><pre class="type-9 type-13 type-11 type-2 type-7 type-10 type-1 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test file descriptor passing.
 * @throws IOException
 */
@Test(timeout=180000) public void testFdPassing() throws Exception {
  final String TEST_PATH=new File(sockDir.getDir(),"test_sock").getAbsolutePath();
  final byte clientMsg1[]=new byte[]{0x11,0x22,0x33,0x44,0x55,0x66};
  final byte serverMsg1[]=new byte[]{0x31,0x30,0x32,0x34,0x31,0x33,0x44,0x1,0x1,0x1,0x1,0x1};
  final ArrayBlockingQueue<Throwable> threadResults=new ArrayBlockingQueue<Throwable>(2);
  final DomainSocket serv=DomainSocket.bindAndListen(TEST_PATH);
  final PassedFile passedFiles[]=new PassedFile[]{new PassedFile(1),new PassedFile(2)};
  final FileDescriptor passedFds[]=new FileDescriptor[passedFiles.length];
  for (int i=0; i < passedFiles.length; i++) {
    passedFds[i]=passedFiles[i].getInputStream().getFD();
  }
  Thread serverThread=new Thread(){
    public void run(){
      DomainSocket conn=null;
      try {
        conn=serv.accept();
        byte in1[]=new byte[clientMsg1.length];
        InputStream connInputStream=conn.getInputStream();
        IOUtils.readFully(connInputStream,in1,0,in1.length);
        Assert.assertTrue(Arrays.equals(clientMsg1,in1));
        DomainSocket domainConn=(DomainSocket)conn;
        domainConn.sendFileDescriptors(passedFds,serverMsg1,0,serverMsg1.length);
        conn.close();
      }
 catch (      Throwable e) {
        threadResults.add(e);
        Assert.fail(e.getMessage());
      }
      threadResults.add(new Success());
    }
  }
;
  serverThread.start();
  Thread clientThread=new Thread(){
    public void run(){
      try {
        DomainSocket client=DomainSocket.connect(TEST_PATH);
        OutputStream clientOutputStream=client.getOutputStream();
        InputStream clientInputStream=client.getInputStream();
        clientOutputStream.write(clientMsg1);
        DomainSocket domainConn=(DomainSocket)client;
        byte in1[]=new byte[serverMsg1.length];
        FileInputStream recvFis[]=new FileInputStream[passedFds.length];
        int r=domainConn.recvFileInputStreams(recvFis,in1,0,in1.length - 1);
        Assert.assertTrue(r > 0);
        IOUtils.readFully(clientInputStream,in1,r,in1.length - r);
        Assert.assertTrue(Arrays.equals(serverMsg1,in1));
        for (int i=0; i < passedFds.length; i++) {
          Assert.assertNotNull(recvFis[i]);
          passedFiles[i].checkInputStream(recvFis[i]);
        }
        for (        FileInputStream fis : recvFis) {
          fis.close();
        }
        client.close();
      }
 catch (      Throwable e) {
        threadResults.add(e);
      }
      threadResults.add(new Success());
    }
  }
;
  clientThread.start();
  for (int i=0; i < 2; i++) {
    Throwable t=threadResults.take();
    if (!(t instanceof Success)) {
      Assert.fail(t.getMessage() + ExceptionUtils.getStackTrace(t));
    }
  }
  serverThread.join(120000);
  clientThread.join(120000);
  serv.close();
  for (  PassedFile pf : passedFiles) {
    pf.cleanup();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.tools.TestHadoopArchives </h4><pre class="type-11 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadFileContent() throws Exception {
  fileList.add(createFile(inputPath,fs,"c c"));
  final Path sub1=new Path(inputPath,"sub 1");
  fs.mkdirs(sub1);
  fileList.add(createFile(inputPath,fs,sub1.getName(),"file x y z"));
  fileList.add(createFile(inputPath,fs,sub1.getName(),"file"));
  fileList.add(createFile(inputPath,fs,sub1.getName(),"x"));
  fileList.add(createFile(inputPath,fs,sub1.getName(),"y"));
  fileList.add(createFile(inputPath,fs,sub1.getName(),"z"));
  final Path sub2=new Path(inputPath,"sub 1 with suffix");
  fs.mkdirs(sub2);
  fileList.add(createFile(inputPath,fs,sub2.getName(),"z"));
  final byte[] binContent=prepareBin();
  fileList.add(createFile(inputPath,fs,binContent,sub2.getName(),"bin"));
  fileList.add(createFile(inputPath,fs,new byte[0],sub2.getName(),"zero-length"));
  final String fullHarPathStr=makeArchive();
  final HarFileSystem harFileSystem=new HarFileSystem(fs);
  try {
    final URI harUri=new URI(fullHarPathStr);
    harFileSystem.initialize(harUri,fs.getConf());
    int readFileCount=0;
    for (    final String pathStr0 : fileList) {
      final Path path=new Path(fullHarPathStr + Path.SEPARATOR + pathStr0);
      final String baseName=path.getName();
      final FileStatus status=harFileSystem.getFileStatus(path);
      if (status.isFile()) {
        final byte[] actualContentSimple=readAllSimple(harFileSystem.open(path),true);
        final byte[] actualContentBuffer=readAllWithBuffer(harFileSystem.open(path),true);
        assertArrayEquals(actualContentSimple,actualContentBuffer);
        final byte[] actualContentFully=readAllWithReadFully(actualContentSimple.length,harFileSystem.open(path),true);
        assertArrayEquals(actualContentSimple,actualContentFully);
        final byte[] actualContentSeek=readAllWithSeek(actualContentSimple.length,harFileSystem.open(path),true);
        assertArrayEquals(actualContentSimple,actualContentSeek);
        final byte[] actualContentRead4=readAllWithRead4(harFileSystem.open(path),true);
        assertArrayEquals(actualContentSimple,actualContentRead4);
        final byte[] actualContentSkip=readAllWithSkip(actualContentSimple.length,harFileSystem.open(path),harFileSystem.open(path),true);
        assertArrayEquals(actualContentSimple,actualContentSkip);
        if ("bin".equals(baseName)) {
          assertArrayEquals(binContent,actualContentSimple);
        }
 else         if ("zero-length".equals(baseName)) {
          assertEquals(0,actualContentSimple.length);
        }
 else {
          String actual=new String(actualContentSimple,"UTF-8");
          assertEquals(baseName,actual);
        }
        readFileCount++;
      }
    }
    assertEquals(fileList.size(),readFileCount);
  }
  finally {
    harFileSystem.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.tools.TestIntegration </h4><pre class="type-2 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=100000) public void testOverwrite(){
  byte[] contents1="contents1".getBytes();
  byte[] contents2="contents2".getBytes();
  Assert.assertEquals(contents1.length,contents2.length);
  try {
    addEntries(listFile,"srcdir");
    createWithContents("srcdir/file1",contents1);
    createWithContents("dstdir/file1",contents2);
    Path target=new Path(root + "/dstdir");
    runTest(listFile,target,false,false,false,true);
    checkResult(target,1,"file1");
    FSDataInputStream is=fs.open(new Path(root + "/dstdir/file1"));
    byte[] dstContents=new byte[contents1.length];
    is.readFully(dstContents);
    is.close();
    Assert.assertArrayEquals(contents1,dstContents);
  }
 catch (  IOException e) {
    LOG.error("Exception encountered while running distcp",e);
    Assert.fail("distcp failure");
  }
 finally {
    TestDistCpUtils.delete(fs,root);
    TestDistCpUtils.delete(fs,"target/tmp1");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.util.TestStringUtils </h4><pre class="type-13 type-2 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testTraditionalBinaryPrefix() throws Exception {
  String[] symbol={"k","m","g","t","p","e"};
  long m=1024;
  for (  String s : symbol) {
    assertEquals(0,string2long(0 + s));
    assertEquals(m,string2long(1 + s));
    m*=1024;
  }
  assertEquals(0L,string2long("0"));
  assertEquals(1024L,string2long("1k"));
  assertEquals(-1024L,string2long("-1k"));
  assertEquals(1259520L,string2long("1230K"));
  assertEquals(-1259520L,string2long("-1230K"));
  assertEquals(104857600L,string2long("100m"));
  assertEquals(-104857600L,string2long("-100M"));
  assertEquals(956703965184L,string2long("891g"));
  assertEquals(-956703965184L,string2long("-891G"));
  assertEquals(501377302265856L,string2long("456t"));
  assertEquals(-501377302265856L,string2long("-456T"));
  assertEquals(11258999068426240L,string2long("10p"));
  assertEquals(-11258999068426240L,string2long("-10P"));
  assertEquals(1152921504606846976L,string2long("1e"));
  assertEquals(-1152921504606846976L,string2long("-1E"));
  String tooLargeNumStr="10e";
  try {
    string2long(tooLargeNumStr);
    fail("Test passed for a number " + tooLargeNumStr + " too large");
  }
 catch (  IllegalArgumentException e) {
    assertEquals(tooLargeNumStr + " does not fit in a Long",e.getMessage());
  }
  String tooSmallNumStr="-10e";
  try {
    string2long(tooSmallNumStr);
    fail("Test passed for a number " + tooSmallNumStr + " too small");
  }
 catch (  IllegalArgumentException e) {
    assertEquals(tooSmallNumStr + " does not fit in a Long",e.getMessage());
  }
  String invalidFormatNumStr="10kb";
  char invalidPrefix='b';
  try {
    string2long(invalidFormatNumStr);
    fail("Test passed for a number " + invalidFormatNumStr + " has invalid format");
  }
 catch (  IllegalArgumentException e) {
    assertEquals("Invalid size prefix '" + invalidPrefix + "' in '"+ invalidFormatNumStr+ "'. Allowed prefixes are k, m, g, t, p, e(case insensitive)",e.getMessage());
  }
  assertEquals("0",long2String(0,null,2));
  for (int decimalPlace=0; decimalPlace < 2; decimalPlace++) {
    for (int n=1; n < TraditionalBinaryPrefix.KILO.value; n++) {
      assertEquals(n + "",long2String(n,null,decimalPlace));
      assertEquals(-n + "",long2String(-n,null,decimalPlace));
    }
    assertEquals("1 K",long2String(1L << 10,null,decimalPlace));
    assertEquals("-1 K",long2String(-1L << 10,null,decimalPlace));
  }
  assertEquals("8.00 E",long2String(Long.MAX_VALUE,null,2));
  assertEquals("8.00 E",long2String(Long.MAX_VALUE - 1,null,2));
  assertEquals("-8 E",long2String(Long.MIN_VALUE,null,2));
  assertEquals("-8.00 E",long2String(Long.MIN_VALUE + 1,null,2));
  final String[] zeros={" ",".0 ",".00 "};
  for (int decimalPlace=0; decimalPlace < zeros.length; decimalPlace++) {
    final String trailingZeros=zeros[decimalPlace];
    for (int e=11; e < Long.SIZE - 1; e++) {
      final TraditionalBinaryPrefix p=TraditionalBinaryPrefix.values()[e / 10 - 1];
{
        final long n=1L << e;
        final String expected=(n / p.value) + " " + p.symbol;
        assertEquals("n=" + n,expected,long2String(n,null,2));
      }
{
        final long n=(1L << e) + 1;
        final String expected=(n / p.value) + trailingZeros + p.symbol;
        assertEquals("n=" + n,expected,long2String(n,null,decimalPlace));
      }
{
        final long n=(1L << e) - 1;
        final String expected=((n + 1) / p.value) + trailingZeros + p.symbol;
        assertEquals("n=" + n,expected,long2String(n,null,decimalPlace));
      }
    }
  }
  assertEquals("1.50 K",long2String(3L << 9,null,2));
  assertEquals("1.5 K",long2String(3L << 9,null,1));
  assertEquals("1.50 M",long2String(3L << 19,null,2));
  assertEquals("2 M",long2String(3L << 19,null,0));
  assertEquals("3 G",long2String(3L << 30,null,2));
  assertEquals("0 B",StringUtils.byteDesc(0));
  assertEquals("-100 B",StringUtils.byteDesc(-100));
  assertEquals("1 KB",StringUtils.byteDesc(1024));
  assertEquals("1.50 KB",StringUtils.byteDesc(3L << 9));
  assertEquals("1.50 MB",StringUtils.byteDesc(3L << 19));
  assertEquals("3 GB",StringUtils.byteDesc(3L << 30));
  assertEquals("10%",StringUtils.formatPercent(0.1,0));
  assertEquals("10.0%",StringUtils.formatPercent(0.1,1));
  assertEquals("10.00%",StringUtils.formatPercent(0.1,2));
  assertEquals("1%",StringUtils.formatPercent(0.00543,0));
  assertEquals("0.5%",StringUtils.formatPercent(0.00543,1));
  assertEquals("0.54%",StringUtils.formatPercent(0.00543,2));
  assertEquals("0.543%",StringUtils.formatPercent(0.00543,3));
  assertEquals("0.5430%",StringUtils.formatPercent(0.00543,4));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.client.api.async.impl.TestAMRMClientAsync </h4><pre class="type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test(timeout=5000) public void testCallAMRMClientAsyncStopFromCallbackHandlerWithWaitFor() throws YarnException, IOException, InterruptedException {
  Configuration conf=new Configuration();
  final TestCallbackHandler2 callbackHandler=new TestCallbackHandler2();
  @SuppressWarnings("unchecked") AMRMClient<ContainerRequest> client=mock(AMRMClientImpl.class);
  List<ContainerStatus> completed=Arrays.asList(ContainerStatus.newInstance(newContainerId(0,0,0,0),ContainerState.COMPLETE,"",0));
  final AllocateResponse response=createAllocateResponse(completed,new ArrayList<Container>(),null);
  when(client.allocate(anyFloat())).thenReturn(response);
  AMRMClientAsync<ContainerRequest> asyncClient=AMRMClientAsync.createAMRMClientAsync(client,20,callbackHandler);
  callbackHandler.asynClient=asyncClient;
  asyncClient.init(conf);
  asyncClient.start();
  Supplier<Boolean> checker=new Supplier<Boolean>(){
    @Override public Boolean get(){
      return callbackHandler.notify;
    }
  }
;
  asyncClient.registerApplicationMaster("localhost",1234,null);
  asyncClient.waitFor(checker);
  Assert.assertTrue(checker.get());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.client.api.impl.TestAMRMClient </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAMRMClientMatchStorage() throws YarnException, IOException {
  AMRMClientImpl<ContainerRequest> amClient=null;
  try {
    amClient=(AMRMClientImpl<ContainerRequest>)AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    Priority priority1=Records.newRecord(Priority.class);
    priority1.setPriority(2);
    ContainerRequest storedContainer1=new ContainerRequest(capability,nodes,racks,priority);
    ContainerRequest storedContainer2=new ContainerRequest(capability,nodes,racks,priority);
    ContainerRequest storedContainer3=new ContainerRequest(capability,null,null,priority1);
    amClient.addContainerRequest(storedContainer1);
    amClient.addContainerRequest(storedContainer2);
    amClient.addContainerRequest(storedContainer3);
    int containersRequestedAny=amClient.remoteRequestsTable.get(priority).get(ResourceRequest.ANY).get(capability).remoteRequest.getNumContainers();
    assertEquals(2,containersRequestedAny);
    containersRequestedAny=amClient.remoteRequestsTable.get(priority1).get(ResourceRequest.ANY).get(capability).remoteRequest.getNumContainers();
    assertEquals(1,containersRequestedAny);
    List<? extends Collection<ContainerRequest>> matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority,ResourceRequest.ANY,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority1,rack,capability);
    assertTrue(matches.isEmpty());
    matches=amClient.getMatchingRequests(priority1,ResourceRequest.ANY,capability);
    verifyMatches(matches,1);
    amClient.removeContainerRequest(storedContainer3);
    matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,2);
    amClient.removeContainerRequest(storedContainer2);
    matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,1);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    verifyMatches(matches,1);
    ContainerRequest storedRequest=matches.get(0).iterator().next();
    assertEquals(storedContainer1,storedRequest);
    amClient.removeContainerRequest(storedContainer1);
    matches=amClient.getMatchingRequests(priority,ResourceRequest.ANY,capability);
    assertTrue(matches.isEmpty());
    matches=amClient.getMatchingRequests(priority1,ResourceRequest.ANY,capability);
    assertTrue(matches.isEmpty());
    assertTrue(amClient.remoteRequestsTable.isEmpty());
    amClient.addContainerRequest(storedContainer1);
    amClient.addContainerRequest(storedContainer3);
    int allocatedContainerCount=0;
    int iterationsLeft=3;
    while (allocatedContainerCount < 2 && iterationsLeft-- > 0) {
      Log.info(" == alloc " + allocatedContainerCount + " it left "+ iterationsLeft);
      AllocateResponse allocResponse=amClient.allocate(0.1f);
      assertEquals(0,amClient.ask.size());
      assertEquals(0,amClient.release.size());
      assertEquals(nodeCount,amClient.getClusterNodeCount());
      allocatedContainerCount+=allocResponse.getAllocatedContainers().size();
      for (      Container container : allocResponse.getAllocatedContainers()) {
        ContainerRequest expectedRequest=container.getPriority().equals(storedContainer1.getPriority()) ? storedContainer1 : storedContainer3;
        matches=amClient.getMatchingRequests(container.getPriority(),ResourceRequest.ANY,container.getResource());
        verifyMatches(matches,1);
        ContainerRequest matchedRequest=matches.get(0).iterator().next();
        assertEquals(matchedRequest,expectedRequest);
        amClient.removeContainerRequest(matchedRequest);
        amClient.releaseAssignedContainer(container.getId());
      }
      if (allocatedContainerCount < containersRequestedAny) {
        sleep(100);
      }
    }
    assertEquals(2,allocatedContainerCount);
    AllocateResponse allocResponse=amClient.allocate(0.1f);
    assertEquals(0,amClient.release.size());
    assertEquals(0,amClient.ask.size());
    assertEquals(0,allocResponse.getAllocatedContainers().size());
    assertTrue(amClient.remoteRequestsTable.isEmpty());
    amClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,null,null);
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.nodemanager.TestNodeStatusUpdater </h4><pre class="type-13 type-11 type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNMRegistration() throws InterruptedException {
  nm=new NodeManager(){
    @Override protected NodeStatusUpdater createNodeStatusUpdater(    Context context,    Dispatcher dispatcher,    NodeHealthCheckerService healthChecker){
      return new MyNodeStatusUpdater(context,dispatcher,healthChecker,metrics);
    }
  }
;
  YarnConfiguration conf=createNMConfig();
  nm.init(conf);
  Object[] services=nm.getServices().toArray();
  Object lastService=services[services.length - 1];
  Assert.assertTrue("last service is NOT the node status updater",lastService instanceof NodeStatusUpdater);
  new Thread(){
    public void run(){
      try {
        nm.start();
      }
 catch (      Throwable e) {
        TestNodeStatusUpdater.this.nmStartError=e;
        throw new YarnRuntimeException(e);
      }
    }
  }
.start();
  System.out.println(" ----- thread already started.." + nm.getServiceState());
  int waitCount=0;
  while (nm.getServiceState() == STATE.INITED && waitCount++ != 50) {
    LOG.info("Waiting for NM to start..");
    if (nmStartError != null) {
      LOG.error("Error during startup. ",nmStartError);
      Assert.fail(nmStartError.getCause().getMessage());
    }
    Thread.sleep(2000);
  }
  if (nm.getServiceState() != STATE.STARTED) {
    Assert.fail("NodeManager failed to start");
  }
  waitCount=0;
  while (heartBeatID <= 3 && waitCount++ != 200) {
    Thread.sleep(1000);
  }
  Assert.assertFalse(heartBeatID <= 3);
  Assert.assertEquals("Number of registered NMs is wrong!!",1,this.registeredNodes.size());
  nm.stop();
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testApplicationKeepAlive() throws Exception {
  MyNodeManager nm=new MyNodeManager();
  try {
    YarnConfiguration conf=createNMConfig();
    conf.setBoolean(YarnConfiguration.LOG_AGGREGATION_ENABLED,true);
    conf.setLong(YarnConfiguration.RM_NM_EXPIRY_INTERVAL_MS,4000l);
    nm.init(conf);
    nm.start();
    while (heartBeatID < 12) {
      Thread.sleep(1000l);
    }
    MyResourceTracker3 rt=(MyResourceTracker3)nm.getNodeStatusUpdater().getRMClient();
    rt.context.getApplications().remove(rt.appId);
    Assert.assertEquals(1,rt.keepAliveRequests.size());
    int numKeepAliveRequests=rt.keepAliveRequests.get(rt.appId).size();
    LOG.info("Number of Keep Alive Requests: [" + numKeepAliveRequests + "]");
    Assert.assertTrue(numKeepAliveRequests == 2 || numKeepAliveRequests == 3);
    while (heartBeatID < 20) {
      Thread.sleep(1000l);
    }
    int numKeepAliveRequests2=rt.keepAliveRequests.get(rt.appId).size();
    Assert.assertEquals(numKeepAliveRequests,numKeepAliveRequests2);
  }
  finally {
    if (nm.getServiceState() == STATE.STARTED)     nm.stop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.TestRMAdminService </h4><pre class="type-9 type-11 type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRMInitialsWithFileSystemBasedConfigurationProvider() throws Exception {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  final File excludeHostsFile=new File(tmpDir.toString(),"excludeHosts");
  if (excludeHostsFile.exists()) {
    excludeHostsFile.delete();
  }
  if (!excludeHostsFile.createNewFile()) {
    Assert.fail("Can not create " + "excludeHosts");
  }
  PrintWriter fileWriter=new PrintWriter(excludeHostsFile);
  fileWriter.write("0.0.0.0:123");
  fileWriter.close();
  uploadToRemoteFileSystem(new Path(excludeHostsFile.getAbsolutePath()));
  YarnConfiguration yarnConf=new YarnConfiguration();
  yarnConf.set(YarnConfiguration.YARN_ADMIN_ACL,"world:anyone:rwcda");
  yarnConf.set(YarnConfiguration.RM_NODES_EXCLUDE_FILE_PATH,this.workingPath + "/excludeHosts");
  uploadConfiguration(yarnConf,"yarn-site.xml");
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  csConf.set("yarn.scheduler.capacity.maximum-applications","5000");
  uploadConfiguration(csConf,"capacity-scheduler.xml");
  String aclsString="alice,bob users,wheel";
  Configuration newConf=new Configuration();
  newConf.set("security.applicationclient.protocol.acl",aclsString);
  uploadConfiguration(newConf,"hadoop-policy.xml");
  Configuration conf=new Configuration();
  conf.setBoolean(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION,true);
  conf.set("hadoop.proxyuser.test.groups","test_groups");
  conf.set("hadoop.proxyuser.test.hosts","test_hosts");
  conf.setClass(CommonConfigurationKeys.HADOOP_SECURITY_GROUP_MAPPING,MockUnixGroupsMapping.class,GroupMappingServiceProvider.class);
  uploadConfiguration(conf,"core-site.xml");
  MockUnixGroupsMapping.updateGroups();
  ResourceManager resourceManager=null;
  try {
    try {
      resourceManager=new ResourceManager();
      resourceManager.init(configuration);
      resourceManager.start();
    }
 catch (    Exception ex) {
      fail("Should not get any exceptions");
    }
    Set<String> excludeHosts=resourceManager.getRMContext().getNodesListManager().getHostsReader().getExcludedHosts();
    Assert.assertTrue(excludeHosts.size() == 1);
    Assert.assertTrue(excludeHosts.contains("0.0.0.0:123"));
    String aclStringAfter=resourceManager.adminService.getAccessControlList().getAclString().trim();
    Assert.assertEquals(aclStringAfter,"world:anyone:rwcda");
    CapacityScheduler cs=(CapacityScheduler)resourceManager.getRMContext().getScheduler();
    int maxAppsAfter=cs.getConfiguration().getMaximumSystemApplications();
    Assert.assertEquals(maxAppsAfter,5000);
    ServiceAuthorizationManager adminServiceServiceManager=resourceManager.adminService.getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(adminServiceServiceManager,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager clientRMServiceServiceManager=resourceManager.getRMContext().getClientRMService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(clientRMServiceServiceManager,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager appMasterService=resourceManager.getRMContext().getApplicationMasterService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(appMasterService,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager RTService=resourceManager.getRMContext().getResourceTrackerService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(RTService,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyGroups().get("hadoop.proxyuser.test.groups").size() == 1);
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyGroups().get("hadoop.proxyuser.test.groups").contains("test_groups"));
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyHosts().get("hadoop.proxyuser.test.hosts").size() == 1);
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyHosts().get("hadoop.proxyuser.test.hosts").contains("test_hosts"));
    List<String> groupAfter=Groups.getUserToGroupsMappingService(configuration).getGroups(UserGroupInformation.getCurrentUser().getUserName());
    Assert.assertTrue(groupAfter.contains("test_group_D") && groupAfter.contains("test_group_E") && groupAfter.contains("test_group_F")&& groupAfter.size() == 3);
  }
  finally {
    if (resourceManager != null) {
      resourceManager.stop();
    }
  }
}

</code></pre>

<br>
<pre class="type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAdminAclsWithFileSystemBasedConfigurationProvider() throws IOException, YarnException {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  uploadDefaultConfiguration();
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
  String aclStringBefore=rm.adminService.getAccessControlList().getAclString().trim();
  YarnConfiguration yarnConf=new YarnConfiguration();
  yarnConf.set(YarnConfiguration.YARN_ADMIN_ACL,"world:anyone:rwcda");
  uploadConfiguration(yarnConf,"yarn-site.xml");
  rm.adminService.refreshAdminAcls(RefreshAdminAclsRequest.newInstance());
  String aclStringAfter=rm.adminService.getAccessControlList().getAclString().trim();
  Assert.assertTrue(!aclStringAfter.equals(aclStringBefore));
  Assert.assertEquals(aclStringAfter,"world:anyone:rwcda");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.recovery.TestFSRMStateStore </h4><pre class="type-9 type-7 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test(timeout=60000) public void testFSRMStateStore() throws Exception {
  HdfsConfiguration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  try {
    fsTester=new TestFSRMStateStoreTester(cluster);
    FSDataOutputStream fsOut=null;
    FileSystemRMStateStore fileSystemRMStateStore=(FileSystemRMStateStore)fsTester.getRMStateStore();
    String appAttemptIdStr3="appattempt_1352994193343_0001_000003";
    ApplicationAttemptId attemptId3=ConverterUtils.toApplicationAttemptId(appAttemptIdStr3);
    Path appDir=fsTester.store.getAppDir(attemptId3.getApplicationId().toString());
    Path tempAppAttemptFile=new Path(appDir,attemptId3.toString() + ".tmp");
    fsOut=fileSystemRMStateStore.fs.create(tempAppAttemptFile,false);
    fsOut.write("Some random data ".getBytes());
    fsOut.close();
    testRMAppStateStore(fsTester);
    Assert.assertFalse(fsTester.workingDirPathURI.getFileSystem(conf).exists(tempAppAttemptFile));
    testRMDTSecretManagerStateStore(fsTester);
    testCheckVersion(fsTester);
    testEpoch(fsTester);
    testAppDeletion(fsTester);
    testDeleteStore(fsTester);
    testAMRMTokenSecretManagerStateStore(fsTester);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestAllocationFileLoaderService </h4><pre class="type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testBackwardsCompatibleAllocationFileParsing() throws Exception {
  Configuration conf=new Configuration();
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  AllocationFileLoaderService allocLoader=new AllocationFileLoaderService();
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<pool name=\"queueA\">");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</pool>");
  out.println("<pool name=\"queueB\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("<aclAdministerApps>alice,bob admins</aclAdministerApps>");
  out.println("</pool>");
  out.println("<pool name=\"queueC\">");
  out.println("<aclSubmitApps>alice,bob admins</aclSubmitApps>");
  out.println("</pool>");
  out.println("<pool name=\"queueD\">");
  out.println("<maxRunningApps>3</maxRunningApps>");
  out.println("</pool>");
  out.println("<pool name=\"queueE\">");
  out.println("<minSharePreemptionTimeout>60</minSharePreemptionTimeout>");
  out.println("</pool>");
  out.println("<queueMaxAppsDefault>15</queueMaxAppsDefault>");
  out.println("<userMaxAppsDefault>5</userMaxAppsDefault>");
  out.println("<user name=\"user1\">");
  out.println("<maxRunningApps>10</maxRunningApps>");
  out.println("</user>");
  out.println("<defaultMinSharePreemptionTimeout>120" + "</defaultMinSharePreemptionTimeout>");
  out.println("<fairSharePreemptionTimeout>300</fairSharePreemptionTimeout>");
  out.println("</allocations>");
  out.close();
  allocLoader.init(conf);
  ReloadListener confHolder=new ReloadListener();
  allocLoader.setReloadListener(confHolder);
  allocLoader.reloadAllocations();
  AllocationConfiguration queueConf=confHolder.allocConf;
  assertEquals(5,queueConf.getConfiguredQueues().get(FSQueueType.LEAF).size());
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(Resources.createResource(1024,0),queueConf.getMinResources("root.queueA"));
  assertEquals(Resources.createResource(2048,0),queueConf.getMinResources("root.queueB"));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root.queueC"));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root.queueD"));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root.queueE"));
  assertEquals(15,queueConf.getQueueMaxApps("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueA"));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueB"));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueC"));
  assertEquals(3,queueConf.getQueueMaxApps("root.queueD"));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueE"));
  assertEquals(10,queueConf.getUserMaxApps("user1"));
  assertEquals(5,queueConf.getUserMaxApps("user2"));
  assertEquals(" ",queueConf.getQueueAcl("root.queueA",QueueACL.ADMINISTER_QUEUE).getAclString());
  assertEquals(" ",queueConf.getQueueAcl("root.queueA",QueueACL.SUBMIT_APPLICATIONS).getAclString());
  assertEquals("alice,bob admins",queueConf.getQueueAcl("root.queueB",QueueACL.ADMINISTER_QUEUE).getAclString());
  assertEquals("alice,bob admins",queueConf.getQueueAcl("root.queueC",QueueACL.SUBMIT_APPLICATIONS).getAclString());
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueA"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueB"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueC"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueD"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueA"));
  assertEquals(60000,queueConf.getMinSharePreemptionTimeout("root.queueE"));
  assertEquals(300000,queueConf.getFairSharePreemptionTimeout());
}

</code></pre>

<br>
<pre class="type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testSimplePlacementPolicyFromConf() throws Exception {
  Configuration conf=new Configuration();
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  conf.setBoolean(FairSchedulerConfiguration.ALLOW_UNDECLARED_POOLS,false);
  conf.setBoolean(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,false);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("</allocations>");
  out.close();
  AllocationFileLoaderService allocLoader=new AllocationFileLoaderService();
  allocLoader.init(conf);
  ReloadListener confHolder=new ReloadListener();
  allocLoader.setReloadListener(confHolder);
  allocLoader.reloadAllocations();
  AllocationConfiguration allocConf=confHolder.allocConf;
  QueuePlacementPolicy placementPolicy=allocConf.getPlacementPolicy();
  List<QueuePlacementRule> rules=placementPolicy.getRules();
  assertEquals(2,rules.size());
  assertEquals(QueuePlacementRule.Specified.class,rules.get(0).getClass());
  assertEquals(false,rules.get(0).create);
  assertEquals(QueuePlacementRule.Default.class,rules.get(1).getClass());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllocationFileParsing() throws Exception {
  Configuration conf=new Configuration();
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  AllocationFileLoaderService allocLoader=new AllocationFileLoaderService();
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("<aclAdministerApps>alice,bob admins</aclAdministerApps>");
  out.println("<schedulingPolicy>fair</schedulingPolicy>");
  out.println("</queue>");
  out.println("<queue name=\"queueC\">");
  out.println("<aclSubmitApps>alice,bob admins</aclSubmitApps>");
  out.println("</queue>");
  out.println("<queue name=\"queueD\">");
  out.println("<maxRunningApps>3</maxRunningApps>");
  out.println("<maxAMShare>0.4</maxAMShare>");
  out.println("</queue>");
  out.println("<queue name=\"queueE\">");
  out.println("<minSharePreemptionTimeout>60</minSharePreemptionTimeout>");
  out.println("</queue>");
  out.println("<queue name=\"queueF\" type=\"parent\" >");
  out.println("</queue>");
  out.println("<queue name=\"queueG\">");
  out.println("   <queue name=\"queueH\">");
  out.println("   </queue>");
  out.println("</queue>");
  out.println("<queueMaxAppsDefault>15</queueMaxAppsDefault>");
  out.println("<userMaxAppsDefault>5</userMaxAppsDefault>");
  out.println("<queueMaxAMShareDefault>0.5f</queueMaxAMShareDefault>");
  out.println("<user name=\"user1\">");
  out.println("<maxRunningApps>10</maxRunningApps>");
  out.println("</user>");
  out.println("<defaultMinSharePreemptionTimeout>120" + "</defaultMinSharePreemptionTimeout>");
  out.println("<fairSharePreemptionTimeout>300</fairSharePreemptionTimeout>");
  out.println("<defaultQueueSchedulingPolicy>drf</defaultQueueSchedulingPolicy>");
  out.println("</allocations>");
  out.close();
  allocLoader.init(conf);
  ReloadListener confHolder=new ReloadListener();
  allocLoader.setReloadListener(confHolder);
  allocLoader.reloadAllocations();
  AllocationConfiguration queueConf=confHolder.allocConf;
  assertEquals(6,queueConf.getConfiguredQueues().get(FSQueueType.LEAF).size());
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(Resources.createResource(1024,0),queueConf.getMinResources("root.queueA"));
  assertEquals(Resources.createResource(2048,0),queueConf.getMinResources("root.queueB"));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root.queueC"));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root.queueD"));
  assertEquals(Resources.createResource(0),queueConf.getMinResources("root.queueE"));
  assertEquals(15,queueConf.getQueueMaxApps("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueA"));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueB"));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueC"));
  assertEquals(3,queueConf.getQueueMaxApps("root.queueD"));
  assertEquals(15,queueConf.getQueueMaxApps("root.queueE"));
  assertEquals(10,queueConf.getUserMaxApps("user1"));
  assertEquals(5,queueConf.getUserMaxApps("user2"));
  assertEquals(.5f,queueConf.getQueueMaxAMShare("root." + YarnConfiguration.DEFAULT_QUEUE_NAME),0.01);
  assertEquals(.5f,queueConf.getQueueMaxAMShare("root.queueA"),0.01);
  assertEquals(.5f,queueConf.getQueueMaxAMShare("root.queueB"),0.01);
  assertEquals(.5f,queueConf.getQueueMaxAMShare("root.queueC"),0.01);
  assertEquals(.4f,queueConf.getQueueMaxAMShare("root.queueD"),0.01);
  assertEquals(.5f,queueConf.getQueueMaxAMShare("root.queueE"),0.01);
  assertEquals("*",queueConf.getQueueAcl("root",QueueACL.ADMINISTER_QUEUE).getAclString());
  assertEquals("*",queueConf.getQueueAcl("root",QueueACL.SUBMIT_APPLICATIONS).getAclString());
  assertEquals(" ",queueConf.getQueueAcl("root.queueA",QueueACL.ADMINISTER_QUEUE).getAclString());
  assertEquals(" ",queueConf.getQueueAcl("root.queueA",QueueACL.SUBMIT_APPLICATIONS).getAclString());
  assertEquals("alice,bob admins",queueConf.getQueueAcl("root.queueB",QueueACL.ADMINISTER_QUEUE).getAclString());
  assertEquals("alice,bob admins",queueConf.getQueueAcl("root.queueC",QueueACL.SUBMIT_APPLICATIONS).getAclString());
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root." + YarnConfiguration.DEFAULT_QUEUE_NAME));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueA"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueB"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueC"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueD"));
  assertEquals(120000,queueConf.getMinSharePreemptionTimeout("root.queueA"));
  assertEquals(60000,queueConf.getMinSharePreemptionTimeout("root.queueE"));
  assertEquals(300000,queueConf.getFairSharePreemptionTimeout());
  assertTrue(queueConf.getConfiguredQueues().get(FSQueueType.PARENT).contains("root.queueF"));
  assertTrue(queueConf.getConfiguredQueues().get(FSQueueType.PARENT).contains("root.queueG"));
  assertTrue(queueConf.getConfiguredQueues().get(FSQueueType.LEAF).contains("root.queueG.queueH"));
  assertEquals(DominantResourceFairnessPolicy.NAME,queueConf.getSchedulingPolicy("root").getName());
  assertEquals(DominantResourceFairnessPolicy.NAME,queueConf.getSchedulingPolicy("root.queueA").getName());
  assertEquals(FairSharePolicy.NAME,queueConf.getSchedulingPolicy("root.queueB").getName());
  assertEquals(DominantResourceFairnessPolicy.NAME,queueConf.getSchedulingPolicy("root.newqueue").getName());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testReload() throws Exception {
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("  <queue name=\"queueA\">");
  out.println("    <maxRunningApps>1</maxRunningApps>");
  out.println("  </queue>");
  out.println("  <queue name=\"queueB\" />");
  out.println("  <queuePlacementPolicy>");
  out.println("    <rule name='default' />");
  out.println("  </queuePlacementPolicy>");
  out.println("</allocations>");
  out.close();
  MockClock clock=new MockClock();
  Configuration conf=new Configuration();
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  AllocationFileLoaderService allocLoader=new AllocationFileLoaderService(clock);
  allocLoader.reloadIntervalMs=5;
  allocLoader.init(conf);
  ReloadListener confHolder=new ReloadListener();
  allocLoader.setReloadListener(confHolder);
  allocLoader.reloadAllocations();
  AllocationConfiguration allocConf=confHolder.allocConf;
  QueuePlacementPolicy policy=allocConf.getPlacementPolicy();
  List<QueuePlacementRule> rules=policy.getRules();
  assertEquals(1,rules.size());
  assertEquals(QueuePlacementRule.Default.class,rules.get(0).getClass());
  assertEquals(1,allocConf.getQueueMaxApps("root.queueA"));
  assertEquals(2,allocConf.getConfiguredQueues().get(FSQueueType.LEAF).size());
  assertTrue(allocConf.getConfiguredQueues().get(FSQueueType.LEAF).contains("root.queueA"));
  assertTrue(allocConf.getConfiguredQueues().get(FSQueueType.LEAF).contains("root.queueB"));
  confHolder.allocConf=null;
  out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("  <queue name=\"queueB\">");
  out.println("    <maxRunningApps>3</maxRunningApps>");
  out.println("  </queue>");
  out.println("  <queuePlacementPolicy>");
  out.println("    <rule name='specified' />");
  out.println("    <rule name='nestedUserQueue' >");
  out.println("         <rule name='primaryGroup' />");
  out.println("    </rule>");
  out.println("    <rule name='default' />");
  out.println("  </queuePlacementPolicy>");
  out.println("</allocations>");
  out.close();
  clock.tick(System.currentTimeMillis() + AllocationFileLoaderService.ALLOC_RELOAD_WAIT_MS + 10000);
  allocLoader.start();
  while (confHolder.allocConf == null) {
    Thread.sleep(20);
  }
  allocConf=confHolder.allocConf;
  policy=allocConf.getPlacementPolicy();
  rules=policy.getRules();
  assertEquals(3,rules.size());
  assertEquals(QueuePlacementRule.Specified.class,rules.get(0).getClass());
  assertEquals(QueuePlacementRule.NestedUserQueue.class,rules.get(1).getClass());
  assertEquals(QueuePlacementRule.PrimaryGroup.class,((NestedUserQueue)(rules.get(1))).nestedRule.getClass());
  assertEquals(QueuePlacementRule.Default.class,rules.get(2).getClass());
  assertEquals(3,allocConf.getQueueMaxApps("root.queueB"));
  assertEquals(1,allocConf.getConfiguredQueues().get(FSQueueType.LEAF).size());
  assertTrue(allocConf.getConfiguredQueues().get(FSQueueType.LEAF).contains("root.queueB"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.utils.TestLeveldbIterator </h4><pre class="type-9 type-2 type-7 type-10 type-1 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionHandling() throws Exception {
  InvocationHandler rtExcHandler=new InvocationHandler(){
    @Override public Object invoke(    Object proxy,    Method method,    Object[] args) throws Throwable {
      throw new RuntimeException("forced runtime error");
    }
  }
;
  DBIterator dbiter=(DBIterator)Proxy.newProxyInstance(DBIterator.class.getClassLoader(),new Class[]{DBIterator.class},rtExcHandler);
  LeveldbIterator iter=new LeveldbIterator(dbiter);
  for (  CallInfo ci : RTEXC_METHODS) {
    Method method=iter.getClass().getMethod(ci.methodName,ci.argTypes);
    assertNotNull("unable to locate method " + ci.methodName,method);
    try {
      method.invoke(iter,ci.args);
      fail("operation should have thrown");
    }
 catch (    InvocationTargetException ite) {
      Throwable exc=ite.getTargetException();
      assertTrue("Method " + ci.methodName + " threw non-DBException: "+ exc,exc instanceof DBException);
      assertFalse("Method " + ci.methodName + " double-wrapped DBException",exc.getCause() instanceof DBException);
    }
  }
  try {
    iter.close();
    fail("operation shoul have thrown");
  }
 catch (  IOException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.webproxy.TestWebAppProxyServlet </h4><pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=5000) public void testWebAppProxyServlet() throws Exception {
  Configuration configuration=new Configuration();
  configuration.set(YarnConfiguration.PROXY_ADDRESS,"localhost:9090");
  configuration.setInt("hadoop.http.max.threads",5);
  WebAppProxyServerForTest proxy=new WebAppProxyServerForTest();
  proxy.init(configuration);
  proxy.start();
  int proxyPort=proxy.proxy.proxyServer.getConnectorAddress(0).getPort();
  AppReportFetcherForTest appReportFetcher=proxy.proxy.appReportFetcher;
  try {
    URL wrongUrl=new URL("http://localhost:" + proxyPort + "/proxy/app");
    HttpURLConnection proxyConn=(HttpURLConnection)wrongUrl.openConnection();
    proxyConn.connect();
    assertEquals(HttpURLConnection.HTTP_INTERNAL_ERROR,proxyConn.getResponseCode());
    URL url=new URL("http://localhost:" + proxyPort + "/proxy/application_00_0");
    proxyConn=(HttpURLConnection)url.openConnection();
    proxyConn.setRequestProperty("Cookie","checked_application_0_0000=true");
    proxyConn.connect();
    assertEquals(HttpURLConnection.HTTP_OK,proxyConn.getResponseCode());
    assertTrue(isResponseCookiePresent(proxyConn,"checked_application_0_0000","true"));
    appReportFetcher.answer=1;
    proxyConn=(HttpURLConnection)url.openConnection();
    proxyConn.setRequestProperty("Cookie","checked_application_0_0000=true");
    proxyConn.connect();
    assertEquals(HttpURLConnection.HTTP_NOT_FOUND,proxyConn.getResponseCode());
    assertFalse(isResponseCookiePresent(proxyConn,"checked_application_0_0000","true"));
    appReportFetcher.answer=4;
    proxyConn=(HttpURLConnection)url.openConnection();
    proxyConn.setRequestProperty("Cookie","checked_application_0_0000=true");
    proxyConn.connect();
    assertEquals(HttpURLConnection.HTTP_NOT_FOUND,proxyConn.getResponseCode());
    assertFalse(isResponseCookiePresent(proxyConn,"checked_application_0_0000","true"));
    appReportFetcher.answer=2;
    proxyConn=(HttpURLConnection)url.openConnection();
    proxyConn.connect();
    assertEquals(HttpURLConnection.HTTP_OK,proxyConn.getResponseCode());
    String s=readInputStream(proxyConn.getInputStream());
    assertTrue(s.contains("to continue to an Application Master web interface owned by"));
    assertTrue(s.contains("WARNING: The following page may not be safe!"));
    appReportFetcher.answer=3;
    proxyConn=(HttpURLConnection)url.openConnection();
    proxyConn.setRequestProperty("Cookie","checked_application_0_0000=true");
    proxyConn.connect();
    assertEquals(HttpURLConnection.HTTP_OK,proxyConn.getResponseCode());
  }
  finally {
    proxy.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.webproxy.amfilter.TestAmFilterInitializer </h4><pre class="type-1 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInitFilter(){
  MockFilterContainer con=new MockFilterContainer();
  Configuration conf=new Configuration(false);
  conf.set(YarnConfiguration.PROXY_ADDRESS,"host1:1000");
  AmFilterInitializer afi=new MockAmFilterInitializer();
  assertNull(con.givenParameters);
  afi.initFilter(con,conf);
  assertEquals(2,con.givenParameters.size());
  assertEquals("host1",con.givenParameters.get(AmIpFilter.PROXY_HOSTS));
  assertEquals("http://host1:1000/foo",con.givenParameters.get(AmIpFilter.PROXY_URI_BASES));
  con=new MockFilterContainer();
  conf=new Configuration(false);
  conf.set(YarnConfiguration.RM_WEBAPP_ADDRESS,"host2:2000");
  afi=new MockAmFilterInitializer();
  assertNull(con.givenParameters);
  afi.initFilter(con,conf);
  assertEquals(2,con.givenParameters.size());
  assertEquals("host2",con.givenParameters.get(AmIpFilter.PROXY_HOSTS));
  assertEquals("http://host2:2000/foo",con.givenParameters.get(AmIpFilter.PROXY_URI_BASES));
  con=new MockFilterContainer();
  conf=new Configuration(false);
  conf.setBoolean(YarnConfiguration.RM_HA_ENABLED,true);
  conf.set(YarnConfiguration.RM_HA_IDS,"rm1,rm2,rm3");
  conf.set(YarnConfiguration.RM_WEBAPP_ADDRESS + ".rm1","host2:2000");
  conf.set(YarnConfiguration.RM_WEBAPP_ADDRESS + ".rm2","host3:3000");
  conf.set(YarnConfiguration.RM_WEBAPP_ADDRESS + ".rm3","host4:4000");
  afi=new MockAmFilterInitializer();
  assertNull(con.givenParameters);
  afi.initFilter(con,conf);
  assertEquals(2,con.givenParameters.size());
  String[] proxyHosts=con.givenParameters.get(AmIpFilter.PROXY_HOSTS).split(AmIpFilter.PROXY_HOSTS_DELIMITER);
  assertEquals(3,proxyHosts.length);
  Arrays.sort(proxyHosts);
  assertEquals("host2",proxyHosts[0]);
  assertEquals("host3",proxyHosts[1]);
  assertEquals("host4",proxyHosts[2]);
  String[] proxyBases=con.givenParameters.get(AmIpFilter.PROXY_URI_BASES).split(AmIpFilter.PROXY_URI_BASES_DELIMITER);
  assertEquals(3,proxyBases.length);
  Arrays.sort(proxyBases);
  assertEquals("http://host2:2000/foo",proxyBases[0]);
  assertEquals("http://host3:3000/foo",proxyBases[1]);
  assertEquals("http://host4:4000/foo",proxyBases[2]);
  con=new MockFilterContainer();
  conf=new Configuration(false);
  conf.set(YarnConfiguration.YARN_HTTP_POLICY_KEY,HttpConfig.Policy.HTTPS_ONLY.toString());
  conf.setBoolean(YarnConfiguration.RM_HA_ENABLED,true);
  conf.set(YarnConfiguration.RM_HA_IDS,"rm1,rm2");
  conf.set(YarnConfiguration.RM_WEBAPP_HTTPS_ADDRESS + ".rm1","host5:5000");
  conf.set(YarnConfiguration.RM_WEBAPP_HTTPS_ADDRESS + ".rm2","host6:6000");
  afi=new MockAmFilterInitializer();
  assertNull(con.givenParameters);
  afi.initFilter(con,conf);
  assertEquals(2,con.givenParameters.size());
  proxyHosts=con.givenParameters.get(AmIpFilter.PROXY_HOSTS).split(AmIpFilter.PROXY_HOSTS_DELIMITER);
  assertEquals(2,proxyHosts.length);
  Arrays.sort(proxyHosts);
  assertEquals("host5",proxyHosts[0]);
  assertEquals("host6",proxyHosts[1]);
  proxyBases=con.givenParameters.get(AmIpFilter.PROXY_URI_BASES).split(AmIpFilter.PROXY_URI_BASES_DELIMITER);
  assertEquals(2,proxyBases.length);
  Arrays.sort(proxyBases);
  assertEquals("https://host5:5000/foo",proxyBases[0]);
  assertEquals("https://host6:6000/foo",proxyBases[1]);
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
