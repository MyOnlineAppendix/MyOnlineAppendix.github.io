<h3><span class=" glyphicon glyphicon-tag"/>&nbspIterativeVerifier</h3><kbd>Verifies assertions in iterations</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.hadoop.conf.TestConfServlet </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWriteXml() throws Exception {
  StringWriter sw=new StringWriter();
  ConfServlet.writeResponse(getTestConf(),sw,"xml");
  String xml=sw.toString();
  DocumentBuilderFactory docBuilderFactory=DocumentBuilderFactory.newInstance();
  DocumentBuilder builder=docBuilderFactory.newDocumentBuilder();
  Document doc=builder.parse(new InputSource(new StringReader(xml)));
  NodeList nameNodes=doc.getElementsByTagName("name");
  boolean foundSetting=false;
  for (int i=0; i < nameNodes.getLength(); i++) {
    Node nameNode=nameNodes.item(i);
    String key=nameNode.getTextContent();
    System.err.println("xml key: " + key);
    if (TEST_KEY.equals(key)) {
      foundSetting=true;
      Element propertyElem=(Element)nameNode.getParentNode();
      String val=propertyElem.getElementsByTagName("value").item(0).getTextContent();
      assertEquals(TEST_VAL,val);
    }
  }
  assertTrue(foundSetting);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.conf.TestConfigurationDeprecation </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Run a set of threads making changes to the deprecations
 * concurrently with another set of threads calling get()
 * and set() on Configuration objects.
 */
@SuppressWarnings("deprecation") @Test(timeout=60000) public void testConcurrentDeprecateAndManipulate() throws Exception {
  final int NUM_THREAD_IDS=10;
  final int NUM_KEYS_PER_THREAD=1000;
  ScheduledThreadPoolExecutor executor=new ScheduledThreadPoolExecutor(2 * NUM_THREAD_IDS,new ThreadFactoryBuilder().setDaemon(true).setNameFormat("testConcurrentDeprecateAndManipulate modification thread %d").build());
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicInteger highestModificationThreadId=new AtomicInteger(1);
  List<Future<Void>> futures=new LinkedList<Future<Void>>();
  for (int i=0; i < NUM_THREAD_IDS; i++) {
    futures.add(executor.schedule(new Callable<Void>(){
      @Override public Void call() throws Exception {
        latch.await();
        int threadIndex=highestModificationThreadId.addAndGet(1);
        for (int i=0; i < NUM_KEYS_PER_THREAD; i++) {
          String testKey=getTestKeyName(threadIndex,i);
          String testNewKey=testKey + ".new";
          Configuration.addDeprecations(new DeprecationDelta[]{new DeprecationDelta(testKey,testNewKey)});
        }
        return null;
      }
    }
,0,TimeUnit.SECONDS));
  }
  final AtomicInteger highestAccessThreadId=new AtomicInteger(1);
  for (int i=0; i < NUM_THREAD_IDS; i++) {
    futures.add(executor.schedule(new Callable<Void>(){
      @Override public Void call() throws Exception {
        Configuration conf=new Configuration();
        latch.await();
        int threadIndex=highestAccessThreadId.addAndGet(1);
        for (int i=0; i < NUM_KEYS_PER_THREAD; i++) {
          String testNewKey=getTestKeyName(threadIndex,i) + ".new";
          String value="value." + threadIndex + "."+ i;
          conf.set(testNewKey,value);
          Assert.assertEquals(value,conf.get(testNewKey));
        }
        return null;
      }
    }
,0,TimeUnit.SECONDS));
  }
  latch.countDown();
  for (  Future<Void> future : futures) {
    Uninterruptibles.getUninterruptibly(future);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.contrib.bkjournal.TestBookKeeperJournalManager </h4><pre class="type-13 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNumberOfTransactionsWithInprogressAtEnd() throws Exception {
  NamespaceInfo nsi=newNSInfo();
  BookKeeperJournalManager bkjm=new BookKeeperJournalManager(conf,BKJMUtil.createJournalURI("/hdfsjournal-inprogressAtEnd"),nsi);
  bkjm.format(nsi);
  long txid=1;
  for (long i=0; i < 3; i++) {
    long start=txid;
    EditLogOutputStream out=bkjm.startLogSegment(start,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
    for (long j=1; j <= DEFAULT_SEGMENT_SIZE; j++) {
      FSEditLogOp op=FSEditLogTestUtil.getNoOpInstance();
      op.setTransactionId(txid++);
      out.write(op);
    }
    out.close();
    bkjm.finalizeLogSegment(start,(txid - 1));
    assertNotNull(zkc.exists(bkjm.finalizedLedgerZNode(start,(txid - 1)),false));
  }
  long start=txid;
  EditLogOutputStream out=bkjm.startLogSegment(start,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
  for (long j=1; j <= DEFAULT_SEGMENT_SIZE / 2; j++) {
    FSEditLogOp op=FSEditLogTestUtil.getNoOpInstance();
    op.setTransactionId(txid++);
    out.write(op);
  }
  out.setReadyToFlush();
  out.flush();
  out.abort();
  out.close();
  long numTrans=bkjm.getNumberOfTransactions(1,true);
  assertEquals((txid - 1),numTrans);
}

</code></pre>

<br>
<pre class="type-13 type-2 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNumberOfTransactionsWithGaps() throws Exception {
  NamespaceInfo nsi=newNSInfo();
  BookKeeperJournalManager bkjm=new BookKeeperJournalManager(conf,BKJMUtil.createJournalURI("/hdfsjournal-gaps"),nsi);
  bkjm.format(nsi);
  long txid=1;
  for (long i=0; i < 3; i++) {
    long start=txid;
    EditLogOutputStream out=bkjm.startLogSegment(start,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
    for (long j=1; j <= DEFAULT_SEGMENT_SIZE; j++) {
      FSEditLogOp op=FSEditLogTestUtil.getNoOpInstance();
      op.setTransactionId(txid++);
      out.write(op);
    }
    out.close();
    bkjm.finalizeLogSegment(start,txid - 1);
    assertNotNull(zkc.exists(bkjm.finalizedLedgerZNode(start,txid - 1),false));
  }
  zkc.delete(bkjm.finalizedLedgerZNode(DEFAULT_SEGMENT_SIZE + 1,DEFAULT_SEGMENT_SIZE * 2),-1);
  long numTrans=bkjm.getNumberOfTransactions(1,true);
  assertEquals(DEFAULT_SEGMENT_SIZE,numTrans);
  try {
    numTrans=bkjm.getNumberOfTransactions(DEFAULT_SEGMENT_SIZE + 1,true);
    fail("Should have thrown corruption exception by this point");
  }
 catch (  JournalManager.CorruptionException ce) {
  }
  numTrans=bkjm.getNumberOfTransactions((DEFAULT_SEGMENT_SIZE * 2) + 1,true);
  assertEquals(DEFAULT_SEGMENT_SIZE,numTrans);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.FileContextURIBase </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testListStatus() throws Exception {
  final String hPrefix="test/hadoop";
  final String[] dirs={hPrefix + "/a",hPrefix + "/b",hPrefix + "/c",hPrefix + "/1",hPrefix + "/#@#@",hPrefix + "/&*#$#$@234"};
  ArrayList<Path> testDirs=new ArrayList<Path>();
  for (  String d : dirs) {
    if (!isTestableFileNameOnPlatform(d)) {
      continue;
    }
    testDirs.add(qualifiedPath(d,fc2));
  }
  Assert.assertFalse(exists(fc1,testDirs.get(0)));
  for (  Path path : testDirs) {
    fc1.mkdir(path,FsPermission.getDefault(),true);
  }
  FileStatus[] paths=fc1.util().listStatus(qualifiedPath("test",fc1));
  Assert.assertEquals(1,paths.length);
  Assert.assertEquals(qualifiedPath(hPrefix,fc1),paths[0].getPath());
  paths=fc1.util().listStatus(qualifiedPath(hPrefix,fc1));
  Assert.assertEquals(testDirs.size(),paths.length);
  for (int i=0; i < testDirs.size(); i++) {
    boolean found=false;
    for (int j=0; j < paths.length; j++) {
      if (qualifiedPath(testDirs.get(i).toString(),fc1).equals(paths[j].getPath())) {
        found=true;
      }
    }
    Assert.assertTrue(testDirs.get(i) + " not found",found);
  }
  paths=fc1.util().listStatus(qualifiedPath(dirs[0],fc1));
  Assert.assertEquals(0,paths.length);
  RemoteIterator<FileStatus> pathsItor=fc1.listStatus(qualifiedPath("test",fc1));
  Assert.assertEquals(qualifiedPath(hPrefix,fc1),pathsItor.next().getPath());
  Assert.assertFalse(pathsItor.hasNext());
  pathsItor=fc1.listStatus(qualifiedPath(hPrefix,fc1));
  int dirLen=0;
  for (; pathsItor.hasNext(); dirLen++) {
    boolean found=false;
    FileStatus stat=pathsItor.next();
    for (int j=0; j < dirs.length; j++) {
      if (qualifiedPath(dirs[j],fc1).equals(stat.getPath())) {
        found=true;
        break;
      }
    }
    Assert.assertTrue(stat.getPath() + " not found",found);
  }
  Assert.assertEquals(testDirs.size(),dirLen);
  pathsItor=fc1.listStatus(qualifiedPath(dirs[0],fc1));
  Assert.assertFalse(pathsItor.hasNext());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.TestHarFileSystemBasics </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testListLocatedStatus() throws Exception {
  String testHarPath=this.getClass().getResource("/test.har").getPath();
  URI uri=new URI("har://" + testHarPath);
  HarFileSystem hfs=new HarFileSystem(localFileSystem);
  hfs.initialize(uri,new Configuration());
  Set<String> expectedFileNames=new HashSet<String>();
  expectedFileNames.add("1.txt");
  expectedFileNames.add("2.txt");
  Path path=new Path("dir1");
  RemoteIterator<LocatedFileStatus> fileList=hfs.listLocatedStatus(path);
  while (fileList.hasNext()) {
    String fileName=fileList.next().getPath().getName();
    assertTrue(fileName + " not in expected files list",expectedFileNames.contains(fileName));
    expectedFileNames.remove(fileName);
  }
  assertEquals("Didn't find all of the expected file names: " + expectedFileNames,0,expectedFileNames.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.TestUrlStreamHandler </h4><pre class="type-9 type-13 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test opening and reading from an InputStream through a hdfs:// URL.
 * <p>
 * First generate a file with some content through the FileSystem API, then
 * try to open and read the file through the URL stream API.
 * @throws IOException
 */
@Test public void testDfsUrls() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  FsUrlStreamHandlerFactory factory=new org.apache.hadoop.fs.FsUrlStreamHandlerFactory();
  java.net.URL.setURLStreamHandlerFactory(factory);
  Path filePath=new Path("/thefile");
  try {
    byte[] fileContent=new byte[1024];
    for (int i=0; i < fileContent.length; ++i)     fileContent[i]=(byte)i;
    OutputStream os=fs.create(filePath);
    os.write(fileContent);
    os.close();
    URI uri=fs.getUri();
    URL fileURL=new URL(uri.getScheme(),uri.getHost(),uri.getPort(),filePath.toString());
    InputStream is=fileURL.openStream();
    assertNotNull(is);
    byte[] bytes=new byte[4096];
    assertEquals(1024,is.read(bytes));
    is.close();
    for (int i=0; i < fileContent.length; ++i)     assertEquals(fileContent[i],bytes[i]);
    fs.delete(filePath,false);
  }
  finally {
    fs.close();
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test opening and reading from an InputStream through a file:// URL.
 * @throws IOException
 * @throws URISyntaxException
 */
@Test public void testFileUrls() throws IOException, URISyntaxException {
  Configuration conf=new HdfsConfiguration();
  if (!TEST_ROOT_DIR.exists()) {
    if (!TEST_ROOT_DIR.mkdirs())     throw new IOException("Cannot create temporary directory: " + TEST_ROOT_DIR);
  }
  File tmpFile=new File(TEST_ROOT_DIR,"thefile");
  URI uri=tmpFile.toURI();
  FileSystem fs=FileSystem.get(uri,conf);
  try {
    byte[] fileContent=new byte[1024];
    for (int i=0; i < fileContent.length; ++i)     fileContent[i]=(byte)i;
    OutputStream os=fs.create(new Path(uri.getPath()));
    os.write(fileContent);
    os.close();
    URL fileURL=uri.toURL();
    InputStream is=fileURL.openStream();
    assertNotNull(is);
    byte[] bytes=new byte[4096];
    assertEquals(1024,is.read(bytes));
    is.close();
    for (int i=0; i < fileContent.length; ++i)     assertEquals(fileContent[i],bytes[i]);
    fs.delete(new Path(uri.getPath()),false);
  }
  finally {
    fs.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.azure.TestAzureConcurrentOutOfBandIo </h4><pre class="type-9 type-13 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadOOBWrites() throws Exception {
  byte[] dataBlockWrite=new byte[UPLOAD_BLOCK_SIZE];
  byte[] dataBlockRead=new byte[UPLOAD_BLOCK_SIZE];
  DataOutputStream outputStream=testAccount.getStore().storefile("WASB_String.txt",new PermissionStatus("","",FsPermission.getDefault()));
  Arrays.fill(dataBlockWrite,(byte)255);
  for (int i=0; i < NUMBER_OF_BLOCKS; i++) {
    outputStream.write(dataBlockWrite);
  }
  outputStream.flush();
  outputStream.close();
  DataBlockWriter writeBlockTask=new DataBlockWriter(testAccount,"WASB_String.txt");
  writeBlockTask.startWriting();
  int count=0;
  DataInputStream inputStream=null;
  for (int i=0; i < 5; i++) {
    try {
      inputStream=testAccount.getStore().retrieve("WASB_String.txt",0);
      count=0;
      int c=0;
      while (c >= 0) {
        c=inputStream.read(dataBlockRead,0,UPLOAD_BLOCK_SIZE);
        if (c < 0) {
          break;
        }
        count+=c;
      }
    }
 catch (    IOException e) {
      System.out.println(e.getCause().toString());
      e.printStackTrace();
      fail();
    }
    if (null != inputStream) {
      inputStream.close();
    }
  }
  writeBlockTask.stopWriting();
  assertEquals(NUMBER_OF_BLOCKS * UPLOAD_BLOCK_SIZE,count);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.azure.TestNativeAzureFileSystemConcurrency </h4><pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Tests running starting multiple threads all doing various File system
 * operations against the same FS.
 */
@Test public void testMultiThreadedOperation() throws Exception {
  for (int iter=0; iter < 10; iter++) {
    final int numThreads=20;
    Thread[] threads=new Thread[numThreads];
    final ConcurrentLinkedQueue<Throwable> exceptionsEncountered=new ConcurrentLinkedQueue<Throwable>();
    for (int i=0; i < numThreads; i++) {
      final Path threadLocalFile=new Path("/myFile" + i);
      threads[i]=new Thread(new Runnable(){
        @Override public void run(){
          try {
            assertTrue(!fs.exists(threadLocalFile));
            OutputStream output=fs.create(threadLocalFile);
            output.write(5);
            output.close();
            assertTrue(fs.exists(threadLocalFile));
            assertTrue(fs.listStatus(new Path("/")).length > 0);
          }
 catch (          Throwable ex) {
            exceptionsEncountered.add(ex);
          }
        }
      }
);
    }
    for (    Thread t : threads) {
      t.start();
    }
    for (    Thread t : threads) {
      t.join();
    }
    assertTrue("Encountered exceptions: " + StringUtils.join("\r\n",selectToString(exceptionsEncountered)),exceptionsEncountered.isEmpty());
    tearDown();
    setUp();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.contract.AbstractContractSeekTest </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPositionedBulkReadDoesntChangePosition() throws Throwable {
  describe("verify that a positioned read does not change the getPos() value");
  Path testSeekFile=path("bigseekfile.txt");
  byte[] block=dataset(65536,0,255);
  createFile(getFileSystem(),testSeekFile,false,block);
  instream=getFileSystem().open(testSeekFile);
  instream.seek(39999);
  assertTrue(-1 != instream.read());
  assertEquals(40000,instream.getPos());
  byte[] readBuffer=new byte[256];
  instream.read(128,readBuffer,0,readBuffer.length);
  assertEquals(40000,instream.getPos());
  assertEquals("@40000",block[40000],(byte)instream.read());
  for (int i=0; i < 256; i++) {
    assertEquals("@" + i,block[i + 128],readBuffer[i]);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.swift.TestSeek </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=SWIFT_TEST_TIMEOUT) public void testPositionedBulkReadDoesntChangePosition() throws Throwable {
  Path testSeekFile=new Path(testPath,"bigseekfile.txt");
  byte[] block=SwiftTestUtils.dataset(65536,0,255);
  createFile(testSeekFile,block);
  instream=fs.open(testSeekFile);
  instream.seek(39999);
  assertTrue(-1 != instream.read());
  assertEquals(40000,instream.getPos());
  byte[] readBuffer=new byte[256];
  instream.read(128,readBuffer,0,readBuffer.length);
  assertEquals(40000,instream.getPos());
  assertEquals("@40000",block[40000],(byte)instream.read());
  for (int i=0; i < 256; i++) {
    assertEquals("@" + i,block[i + 128],readBuffer[i]);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.fs.swift.scale.TestWriteManySmallFiles </h4><pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=SWIFT_BULK_IO_TEST_TIMEOUT) public void testScaledWriteThenRead() throws Throwable {
  Path dir=new Path("/test/manysmallfiles");
  Duration rm1=new Duration();
  fs.delete(dir,true);
  rm1.finished();
  fs.mkdirs(dir);
  Duration ls1=new Duration();
  fs.listStatus(dir);
  ls1.finished();
  long count=getOperationCount();
  SwiftTestUtils.noteAction("Beginning Write of " + count + " files ");
  DurationStats writeStats=new DurationStats("write");
  DurationStats readStats=new DurationStats("read");
  String format="%08d";
  for (long l=0; l < count; l++) {
    String name=String.format(format,l);
    Path p=new Path(dir,"part-" + name);
    Duration d=new Duration();
    SwiftTestUtils.writeTextFile(fs,p,name,false);
    d.finished();
    writeStats.add(d);
    Thread.sleep(1000);
  }
  SwiftTestUtils.noteAction("Beginning ls");
  Duration ls2=new Duration();
  FileStatus[] status2=(FileStatus[])fs.listStatus(dir);
  ls2.finished();
  assertEquals("Not enough entries in the directory",count,status2.length);
  SwiftTestUtils.noteAction("Beginning read");
  for (long l=0; l < count; l++) {
    String name=String.format(format,l);
    Path p=new Path(dir,"part-" + name);
    Duration d=new Duration();
    String result=SwiftTestUtils.readBytesToString(fs,p,name.length());
    assertEquals(name,result);
    d.finished();
    readStats.add(d);
  }
  SwiftTestUtils.noteAction("Beginning delete");
  Duration rm2=new Duration();
  fs.delete(dir,true);
  rm2.finished();
  LOG.info(String.format("'filesystem','%s'",fs.getUri()));
  LOG.info(writeStats.toString());
  LOG.info(readStats.toString());
  LOG.info(String.format("'rm1',%d,'ls1',%d",rm1.value(),ls1.value()));
  LOG.info(String.format("'rm2',%d,'ls2',%d",rm2.value(),ls2.value()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSAddressConfig </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDFSAddressConfig() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  cluster.waitActive();
  ArrayList<DataNode> dns=cluster.getDataNodes();
  DataNode dn=dns.get(0);
  String selfSocketAddr=dn.getXferAddress().toString();
  System.out.println("DN Self Socket Addr == " + selfSocketAddr);
  assertTrue(selfSocketAddr.contains("/127.0.0.1:"));
  for (int i=0; i < dns.size(); i++) {
    DataNodeProperties dnp=cluster.stopDataNode(i);
    assertNotNull("Should have been able to stop simulated datanode",dnp);
  }
  conf.unset(DFS_DATANODE_ADDRESS_KEY);
  conf.unset(DFS_DATANODE_HTTP_ADDRESS_KEY);
  conf.unset(DFS_DATANODE_IPC_ADDRESS_KEY);
  cluster.startDataNodes(conf,1,true,StartupOption.REGULAR,null,null,null,false,true);
  dns=cluster.getDataNodes();
  dn=dns.get(0);
  selfSocketAddr=dn.getXferAddress().toString();
  System.out.println("DN Self Socket Addr == " + selfSocketAddr);
  assertTrue(selfSocketAddr.contains("/127.0.0.1:"));
  for (int i=0; i < dns.size(); i++) {
    DataNodeProperties dnp=cluster.stopDataNode(i);
    assertNotNull("Should have been able to stop simulated datanode",dnp);
  }
  conf.set(DFS_DATANODE_ADDRESS_KEY,"0.0.0.0:0");
  conf.set(DFS_DATANODE_HTTP_ADDRESS_KEY,"0.0.0.0:0");
  conf.set(DFS_DATANODE_IPC_ADDRESS_KEY,"0.0.0.0:0");
  cluster.startDataNodes(conf,1,true,StartupOption.REGULAR,null,null,null,false,true);
  dns=cluster.getDataNodes();
  dn=dns.get(0);
  selfSocketAddr=dn.getXferAddress().toString();
  System.out.println("DN Self Socket Addr == " + selfSocketAddr);
  assertTrue(selfSocketAddr.contains("/0.0.0.0:"));
  cluster.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSClientRetries </h4><pre class="type-9 type-13 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that checksum failures are recovered from by the next read on the same
 * DFSInputStream. Corruption information is not persisted from read call to
 * read call, so the client should expect consecutive calls to behave the same
 * way. See HDFS-3067.
 */
@Test public void testRetryOnChecksumFailure() throws Exception {
  HdfsConfiguration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  try {
    final short REPL_FACTOR=1;
    final long FILE_LENGTH=512L;
    cluster.waitActive();
    FileSystem fs=cluster.getFileSystem();
    Path path=new Path("/corrupted");
    DFSTestUtil.createFile(fs,path,FILE_LENGTH,REPL_FACTOR,12345L);
    DFSTestUtil.waitReplication(fs,path,REPL_FACTOR);
    ExtendedBlock block=DFSTestUtil.getFirstBlock(fs,path);
    int blockFilesCorrupted=cluster.corruptBlockOnDataNodes(block);
    assertEquals("All replicas not corrupted",REPL_FACTOR,blockFilesCorrupted);
    InetSocketAddress nnAddr=new InetSocketAddress("localhost",cluster.getNameNodePort());
    DFSClient client=new DFSClient(nnAddr,conf);
    DFSInputStream dis=client.open(path.toString());
    byte[] arr=new byte[(int)FILE_LENGTH];
    for (int i=0; i < 2; ++i) {
      try {
        dis.read(arr,0,(int)FILE_LENGTH);
        fail("Expected ChecksumException not thrown");
      }
 catch (      Exception ex) {
        GenericTestUtils.assertExceptionContains("Checksum error",ex);
      }
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSRollback </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This test attempts to rollback the NameNode and DataNode under
 * a number of valid and invalid conditions.
 */
@Test public void testRollback() throws Exception {
  File[] baseDirs;
  UpgradeUtilities.initialize();
  StorageInfo storageInfo=null;
  for (int numDirs=1; numDirs <= 2; numDirs++) {
    conf=new HdfsConfiguration();
    conf.setInt(DFSConfigKeys.DFS_DATANODE_SCAN_PERIOD_HOURS_KEY,-1);
    conf=UpgradeUtilities.initializeStorageStateConf(numDirs,conf);
    String[] nameNodeDirs=conf.getStrings(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY);
    String[] dataNodeDirs=conf.getStrings(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY);
    log("Normal NameNode rollback",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    NameNode.doRollback(conf,false);
    checkResult(NAME_NODE,nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("Normal DataNode rollback",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    NameNode.doRollback(conf,false);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).format(false).manageDataDfsDirs(false).manageNameDfsDirs(false).dnStartupOption(StartupOption.ROLLBACK).build();
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"previous");
    cluster.startDataNodes(conf,1,false,StartupOption.ROLLBACK,null);
    checkResult(DATA_NODE,dataNodeDirs);
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("Normal BlockPool rollback",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    NameNode.doRollback(conf,false);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).format(false).manageDataDfsDirs(false).manageNameDfsDirs(false).dnStartupOption(StartupOption.ROLLBACK).build();
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    UpgradeUtilities.createBlockPoolStorageDirs(dataNodeDirs,"current",UpgradeUtilities.getCurrentBlockPoolID(cluster));
    UpgradeUtilities.createBlockPoolStorageDirs(dataNodeDirs,"previous",UpgradeUtilities.getCurrentBlockPoolID(cluster));
    storageInfo=new StorageInfo(HdfsConstants.DATANODE_LAYOUT_VERSION - 1,UpgradeUtilities.getCurrentNamespaceID(cluster),UpgradeUtilities.getCurrentClusterID(cluster),UpgradeUtilities.getCurrentFsscTime(cluster),NodeType.DATA_NODE);
    File[] dataCurrentDirs=new File[dataNodeDirs.length];
    for (int i=0; i < dataNodeDirs.length; i++) {
      dataCurrentDirs[i]=new File((new Path(dataNodeDirs[i] + "/current")).toString());
    }
    UpgradeUtilities.createDataNodeVersionFile(dataCurrentDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    cluster.startDataNodes(conf,1,false,StartupOption.ROLLBACK,null);
    assertTrue(cluster.isDataNodeUp());
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("NameNode rollback without existing previous dir",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    startNameNodeShouldFail("None of the storage directories contain previous fs state");
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("DataNode rollback without existing previous dir",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).format(false).manageDataDfsDirs(false).manageNameDfsDirs(false).startupOption(StartupOption.UPGRADE).build();
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    cluster.startDataNodes(conf,1,false,StartupOption.ROLLBACK,null);
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("DataNode rollback with future stored layout version in previous",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    NameNode.doRollback(conf,false);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).format(false).manageDataDfsDirs(false).manageNameDfsDirs(false).dnStartupOption(StartupOption.ROLLBACK).build();
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    baseDirs=UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"previous");
    storageInfo=new StorageInfo(Integer.MIN_VALUE,UpgradeUtilities.getCurrentNamespaceID(cluster),UpgradeUtilities.getCurrentClusterID(cluster),UpgradeUtilities.getCurrentFsscTime(cluster),NodeType.DATA_NODE);
    UpgradeUtilities.createDataNodeVersionFile(baseDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    startBlockPoolShouldFail(StartupOption.ROLLBACK,cluster.getNamesystem().getBlockPoolId());
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("DataNode rollback with newer fsscTime in previous",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    NameNode.doRollback(conf,false);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).format(false).manageDataDfsDirs(false).manageNameDfsDirs(false).dnStartupOption(StartupOption.ROLLBACK).build();
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    baseDirs=UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"previous");
    storageInfo=new StorageInfo(HdfsConstants.DATANODE_LAYOUT_VERSION,UpgradeUtilities.getCurrentNamespaceID(cluster),UpgradeUtilities.getCurrentClusterID(cluster),Long.MAX_VALUE,NodeType.DATA_NODE);
    UpgradeUtilities.createDataNodeVersionFile(baseDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    startBlockPoolShouldFail(StartupOption.ROLLBACK,cluster.getNamesystem().getBlockPoolId());
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("NameNode rollback with no edits file",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    baseDirs=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    deleteMatchingFiles(baseDirs,"edits.*");
    startNameNodeShouldFail("Gap in transactions");
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("NameNode rollback with no image file",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    baseDirs=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    deleteMatchingFiles(baseDirs,"fsimage_.*");
    startNameNodeShouldFail("No valid image files found");
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("NameNode rollback with corrupt version file",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    baseDirs=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    for (    File f : baseDirs) {
      UpgradeUtilities.corruptFile(new File(f,"VERSION"),"layoutVersion".getBytes(Charsets.UTF_8),"xxxxxxxxxxxxx".getBytes(Charsets.UTF_8));
    }
    startNameNodeShouldFail("file VERSION has layoutVersion missing");
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("NameNode rollback with old layout version in previous",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    baseDirs=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    storageInfo=new StorageInfo(1,UpgradeUtilities.getCurrentNamespaceID(null),UpgradeUtilities.getCurrentClusterID(null),UpgradeUtilities.getCurrentFsscTime(null),NodeType.NAME_NODE);
    UpgradeUtilities.createNameNodeVersionFile(conf,baseDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    startNameNodeShouldFail("Cannot rollback to storage version 1 using this version");
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSStartupVersions </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test ensures the appropriate response (successful or failure) from 
 * a Datanode when the system is started with differing version combinations. 
 * <pre>
 * For each 3-tuple in the cross product
 * ({oldLayoutVersion,currentLayoutVersion,futureLayoutVersion},
 * {currentNamespaceId,incorrectNamespaceId},
 * {pastFsscTime,currentFsscTime,futureFsscTime})
 * 1. Startup Namenode with version file containing 
 * (currentLayoutVersion,currentNamespaceId,currentFsscTime)
 * 2. Attempt to startup Datanode with version file containing 
 * this iterations version 3-tuple
 * </pre>
 */
@Test(timeout=300000) public void testVersions() throws Exception {
  UpgradeUtilities.initialize();
  Configuration conf=UpgradeUtilities.initializeStorageStateConf(1,new HdfsConfiguration());
  StorageData[] versions=initializeVersions();
  UpgradeUtilities.createNameNodeStorageDirs(conf.getStrings(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY),"current");
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).format(false).manageDataDfsDirs(false).manageNameDfsDirs(false).startupOption(StartupOption.REGULAR).build();
  StorageData nameNodeVersion=new StorageData(HdfsConstants.NAMENODE_LAYOUT_VERSION,UpgradeUtilities.getCurrentNamespaceID(cluster),UpgradeUtilities.getCurrentClusterID(cluster),UpgradeUtilities.getCurrentFsscTime(cluster),UpgradeUtilities.getCurrentBlockPoolID(cluster));
  log("NameNode version info",NAME_NODE,null,nameNodeVersion);
  String bpid=UpgradeUtilities.getCurrentBlockPoolID(cluster);
  for (int i=0; i < versions.length; i++) {
    File[] storage=UpgradeUtilities.createDataNodeStorageDirs(conf.getStrings(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY),"current");
    log("DataNode version info",DATA_NODE,i,versions[i]);
    UpgradeUtilities.createDataNodeVersionFile(storage,versions[i].storageInfo,bpid,versions[i].blockPoolId);
    try {
      cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
    }
 catch (    Exception ignore) {
    }
    assertTrue(cluster.getNameNode() != null);
    assertEquals(isVersionCompatible(nameNodeVersion,versions[i]),cluster.isDataNodeUp());
    cluster.shutdownDataNodes();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSStorageStateRecovery </h4><pre class="type-9 type-13 type-11 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This test iterates over the testCases table for Datanode storage and
 * attempts to startup the DataNode normally.
 */
@Test public void testDNStorageStates() throws Exception {
  String[] baseDirs;
  for (int numDirs=1; numDirs <= 2; numDirs++) {
    conf=new HdfsConfiguration();
    conf.setInt(DFSConfigKeys.DFS_DATANODE_SCAN_PERIOD_HOURS_KEY,-1);
    conf=UpgradeUtilities.initializeStorageStateConf(numDirs,conf);
    for (int i=0; i < NUM_DN_TEST_CASES; i++) {
      boolean[] testCase=testCases[i];
      boolean shouldRecover=testCase[SHOULD_RECOVER];
      boolean curAfterRecover=testCase[CURRENT_SHOULD_EXIST_AFTER_RECOVER];
      boolean prevAfterRecover=testCase[PREVIOUS_SHOULD_EXIST_AFTER_RECOVER];
      log("DATA_NODE recovery",numDirs,i,testCase);
      createNameNodeStorageState(new boolean[]{true,true,false,false,false});
      cluster=createCluster(conf);
      baseDirs=createDataNodeStorageState(testCase);
      if (!testCase[CURRENT_EXISTS] && !testCase[PREVIOUS_EXISTS] && !testCase[PREVIOUS_TMP_EXISTS]&& !testCase[REMOVED_TMP_EXISTS]) {
        cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
      }
 else {
        if (shouldRecover) {
          cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
          checkResultDataNode(baseDirs,curAfterRecover,prevAfterRecover);
        }
 else {
          cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
          assertFalse(cluster.getDataNodes().get(0).isDatanodeUp());
        }
      }
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-11 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This test iterates over the testCases table for block pool storage and
 * attempts to startup the DataNode normally.
 */
@Test public void testBlockPoolStorageStates() throws Exception {
  String[] baseDirs;
  String bpid=UpgradeUtilities.getCurrentBlockPoolID(null);
  for (int numDirs=1; numDirs <= 2; numDirs++) {
    conf=new HdfsConfiguration();
    conf.setInt("dfs.datanode.scan.period.hours",-1);
    conf=UpgradeUtilities.initializeStorageStateConf(numDirs,conf);
    for (int i=0; i < NUM_DN_TEST_CASES; i++) {
      boolean[] testCase=testCases[i];
      boolean shouldRecover=testCase[SHOULD_RECOVER];
      boolean curAfterRecover=testCase[CURRENT_SHOULD_EXIST_AFTER_RECOVER];
      boolean prevAfterRecover=testCase[PREVIOUS_SHOULD_EXIST_AFTER_RECOVER];
      log("BLOCK_POOL recovery",numDirs,i,testCase);
      createNameNodeStorageState(new boolean[]{true,true,false,false,false});
      cluster=createCluster(conf);
      baseDirs=createBlockPoolStorageState(bpid,testCase);
      if (!testCase[CURRENT_EXISTS] && !testCase[PREVIOUS_EXISTS] && !testCase[PREVIOUS_TMP_EXISTS]&& !testCase[REMOVED_TMP_EXISTS]) {
        cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
      }
 else {
        if (shouldRecover) {
          cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
          checkResultBlockPool(baseDirs,curAfterRecover,prevAfterRecover);
        }
 else {
          cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
          assertFalse(cluster.getDataNodes().get(0).isBPServiceAlive(bpid));
        }
      }
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-11 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * This test iterates over the testCases table and attempts
 * to startup the NameNode normally.
 */
@Test public void testNNStorageStates() throws Exception {
  String[] baseDirs;
  for (int numDirs=1; numDirs <= 2; numDirs++) {
    conf=new HdfsConfiguration();
    conf.setInt(DFSConfigKeys.DFS_DATANODE_SCAN_PERIOD_HOURS_KEY,-1);
    conf=UpgradeUtilities.initializeStorageStateConf(numDirs,conf);
    for (int i=0; i < NUM_NN_TEST_CASES; i++) {
      boolean[] testCase=testCases[i];
      boolean shouldRecover=testCase[SHOULD_RECOVER];
      boolean curAfterRecover=testCase[CURRENT_SHOULD_EXIST_AFTER_RECOVER];
      boolean prevAfterRecover=testCase[PREVIOUS_SHOULD_EXIST_AFTER_RECOVER];
      log("NAME_NODE recovery",numDirs,i,testCase);
      baseDirs=createNameNodeStorageState(testCase);
      if (shouldRecover) {
        cluster=createCluster(conf);
        checkResultNameNode(baseDirs,curAfterRecover,prevAfterRecover);
        cluster.shutdown();
      }
 else {
        try {
          cluster=createCluster(conf);
          throw new AssertionError("NameNode should have failed to start");
        }
 catch (        IOException expected) {
          if (!testCases[i][CURRENT_EXISTS] && !testCases[i][PREVIOUS_TMP_EXISTS] && !testCases[i][PREVIOUS_EXISTS]&& !testCases[i][REMOVED_TMP_EXISTS]) {
            assertTrue(expected.getLocalizedMessage().contains("NameNode is not formatted"));
          }
        }
      }
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSUpgrade </h4><pre class="type-13 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test attempts to upgrade the NameNode and DataNode under
 * a number of valid and invalid conditions.
 */
@Test(timeout=60000) public void testUpgrade() throws Exception {
  File[] baseDirs;
  StorageInfo storageInfo=null;
  for (int numDirs=1; numDirs <= 2; numDirs++) {
    conf=new HdfsConfiguration();
    conf=UpgradeUtilities.initializeStorageStateConf(numDirs,conf);
    String[] nameNodeDirs=conf.getStrings(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY);
    String[] dataNodeDirs=conf.getStrings(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY);
    log("Normal NameNode upgrade",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    cluster=createCluster();
    try {
      final DistributedFileSystem dfs=cluster.getFileSystem();
      dfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
      dfs.rollingUpgrade(RollingUpgradeAction.PREPARE);
      fail();
    }
 catch (    RemoteException re) {
      assertEquals(InconsistentFSStateException.class.getName(),re.getClassName());
      LOG.info("The exception is expected.",re);
    }
    checkNameNode(nameNodeDirs,EXPECTED_TXID);
    if (numDirs > 1)     TestParallelImageWrite.checkImages(cluster.getNamesystem(),numDirs);
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("Normal DataNode upgrade",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    cluster=createCluster();
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
    checkDataNode(dataNodeDirs,UpgradeUtilities.getCurrentBlockPoolID(null));
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("NameNode upgrade with existing previous dir",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"previous");
    startNameNodeShouldFail(StartupOption.UPGRADE);
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("DataNode upgrade with existing previous dir",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    cluster=createCluster();
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"previous");
    cluster.startDataNodes(conf,1,false,StartupOption.REGULAR,null);
    checkDataNode(dataNodeDirs,UpgradeUtilities.getCurrentBlockPoolID(null));
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("DataNode upgrade with future stored layout version in current",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    cluster=createCluster();
    baseDirs=UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    storageInfo=new StorageInfo(Integer.MIN_VALUE,UpgradeUtilities.getCurrentNamespaceID(cluster),UpgradeUtilities.getCurrentClusterID(cluster),UpgradeUtilities.getCurrentFsscTime(cluster),NodeType.DATA_NODE);
    UpgradeUtilities.createDataNodeVersionFile(baseDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    startBlockPoolShouldFail(StartupOption.REGULAR,UpgradeUtilities.getCurrentBlockPoolID(null));
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("DataNode upgrade with newer fsscTime in current",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    cluster=createCluster();
    baseDirs=UpgradeUtilities.createDataNodeStorageDirs(dataNodeDirs,"current");
    storageInfo=new StorageInfo(HdfsConstants.DATANODE_LAYOUT_VERSION,UpgradeUtilities.getCurrentNamespaceID(cluster),UpgradeUtilities.getCurrentClusterID(cluster),Long.MAX_VALUE,NodeType.DATA_NODE);
    UpgradeUtilities.createDataNodeVersionFile(baseDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    startBlockPoolShouldFail(StartupOption.REGULAR,UpgradeUtilities.getCurrentBlockPoolID(null));
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    UpgradeUtilities.createEmptyDirs(dataNodeDirs);
    log("NameNode upgrade with no edits file",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    deleteStorageFilesWithPrefix(nameNodeDirs,"edits_");
    startNameNodeShouldFail(StartupOption.UPGRADE);
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("NameNode upgrade with no image file",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    deleteStorageFilesWithPrefix(nameNodeDirs,"fsimage_");
    startNameNodeShouldFail(StartupOption.UPGRADE);
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("NameNode upgrade with corrupt version file",numDirs);
    baseDirs=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    for (    File f : baseDirs) {
      UpgradeUtilities.corruptFile(new File(f,"VERSION"),"layoutVersion".getBytes(Charsets.UTF_8),"xxxxxxxxxxxxx".getBytes(Charsets.UTF_8));
    }
    startNameNodeShouldFail(StartupOption.UPGRADE);
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("NameNode upgrade with old layout version in current",numDirs);
    baseDirs=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    storageInfo=new StorageInfo(Storage.LAST_UPGRADABLE_LAYOUT_VERSION + 1,UpgradeUtilities.getCurrentNamespaceID(null),UpgradeUtilities.getCurrentClusterID(null),UpgradeUtilities.getCurrentFsscTime(null),NodeType.NAME_NODE);
    UpgradeUtilities.createNameNodeVersionFile(conf,baseDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    startNameNodeShouldFail(StartupOption.UPGRADE);
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
    log("NameNode upgrade with future layout version in current",numDirs);
    baseDirs=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    storageInfo=new StorageInfo(Integer.MIN_VALUE,UpgradeUtilities.getCurrentNamespaceID(null),UpgradeUtilities.getCurrentClusterID(null),UpgradeUtilities.getCurrentFsscTime(null),NodeType.NAME_NODE);
    UpgradeUtilities.createNameNodeVersionFile(conf,baseDirs,storageInfo,UpgradeUtilities.getCurrentBlockPoolID(cluster));
    startNameNodeShouldFail(StartupOption.UPGRADE);
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
  }
  int numDirs=4;
{
    conf=new HdfsConfiguration();
    conf.setInt(DFSConfigKeys.DFS_DATANODE_SCAN_PERIOD_HOURS_KEY,-1);
    conf=UpgradeUtilities.initializeStorageStateConf(numDirs,conf);
    String[] nameNodeDirs=conf.getStrings(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY);
    log("Normal NameNode upgrade",numDirs);
    UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
    cluster=createCluster();
    try {
      final DistributedFileSystem dfs=cluster.getFileSystem();
      dfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
      dfs.rollingUpgrade(RollingUpgradeAction.PREPARE);
      fail();
    }
 catch (    RemoteException re) {
      assertEquals(InconsistentFSStateException.class.getName(),re.getClassName());
      LOG.info("The exception is expected.",re);
    }
    checkNameNode(nameNodeDirs,EXPECTED_TXID);
    TestParallelImageWrite.checkImages(cluster.getNamesystem(),numDirs);
    cluster.shutdown();
    UpgradeUtilities.createEmptyDirs(nameNodeDirs);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSUpgradeFromImage </h4><pre class="type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test upgrade from 2.0 image with a variety of .snapshot and .reserved
 * paths to test renaming on upgrade
 */
@Test public void testUpgradeFromRel2ReservedImage() throws Exception {
  unpackStorage(HADOOP2_RESERVED_IMAGE,HADOOP_DFS_DIR_TXT);
  MiniDFSCluster cluster=null;
  final Configuration conf=new Configuration();
  try {
    cluster=new MiniDFSCluster.Builder(conf).format(false).startupOption(StartupOption.UPGRADE).numDataNodes(0).build();
  }
 catch (  IllegalArgumentException e) {
    GenericTestUtils.assertExceptionContains("reserved path component in this version",e);
  }
 finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
  try {
    FSImageFormat.setRenameReservedPairs(".snapshot=.user-snapshot," + ".reserved=.my-reserved");
    cluster=new MiniDFSCluster.Builder(conf).format(false).startupOption(StartupOption.UPGRADE).numDataNodes(0).build();
    DistributedFileSystem dfs=cluster.getFileSystem();
    final String[] expected=new String[]{"/edits","/edits/.reserved","/edits/.user-snapshot","/edits/.user-snapshot/editsdir","/edits/.user-snapshot/editsdir/editscontents","/edits/.user-snapshot/editsdir/editsdir2","/image","/image/.reserved","/image/.user-snapshot","/image/.user-snapshot/imagedir","/image/.user-snapshot/imagedir/imagecontents","/image/.user-snapshot/imagedir/imagedir2","/.my-reserved","/.my-reserved/edits-touch","/.my-reserved/image-touch"};
    for (int i=0; i < 2; i++) {
      if (i == 1) {
        cluster.finalizeCluster(conf);
        cluster.restartNameNode(true);
      }
      ArrayList<Path> toList=new ArrayList<Path>();
      toList.add(new Path("/"));
      ArrayList<String> found=new ArrayList<String>();
      while (!toList.isEmpty()) {
        Path p=toList.remove(0);
        FileStatus[] statuses=dfs.listStatus(p);
        for (        FileStatus status : statuses) {
          final String path=status.getPath().toUri().getPath();
          System.out.println("Found path " + path);
          found.add(path);
          if (status.isDirectory()) {
            toList.add(status.getPath());
          }
        }
      }
      for (      String s : expected) {
        assertTrue("Did not find expected path " + s,found.contains(s));
      }
      assertEquals("Found an unexpected path while listing filesystem",found.size(),expected.length);
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test upgrade from a branch-1.2 image with reserved paths
 */
@Test public void testUpgradeFromRel1ReservedImage() throws Exception {
  unpackStorage(HADOOP1_RESERVED_IMAGE,HADOOP_DFS_DIR_TXT);
  MiniDFSCluster cluster=null;
  final Configuration conf=new Configuration();
  try {
    FSImageFormat.setRenameReservedPairs(".snapshot=.user-snapshot," + ".reserved=.my-reserved");
    cluster=new MiniDFSCluster.Builder(conf).format(false).startupOption(StartupOption.UPGRADE).numDataNodes(0).build();
    DistributedFileSystem dfs=cluster.getFileSystem();
    final String[] expected=new String[]{"/.my-reserved","/.user-snapshot","/.user-snapshot/.user-snapshot","/.user-snapshot/open","/dir1","/dir1/.user-snapshot","/dir2","/dir2/.user-snapshot","/user","/user/andrew","/user/andrew/.user-snapshot"};
    for (int i=0; i < 2; i++) {
      if (i == 1) {
        cluster.finalizeCluster(conf);
        cluster.restartNameNode(true);
      }
      ArrayList<Path> toList=new ArrayList<Path>();
      toList.add(new Path("/"));
      ArrayList<String> found=new ArrayList<String>();
      while (!toList.isEmpty()) {
        Path p=toList.remove(0);
        FileStatus[] statuses=dfs.listStatus(p);
        for (        FileStatus status : statuses) {
          final String path=status.getPath().toUri().getPath();
          System.out.println("Found path " + path);
          found.add(path);
          if (status.isDirectory()) {
            toList.add(status.getPath());
          }
        }
      }
      for (      String s : expected) {
        assertTrue("Did not find expected path " + s,found.contains(s));
      }
      assertEquals("Found an unexpected path while listing filesystem",found.size(),expected.length);
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test upgrade from a 0.23.11 image with reserved paths
 */
@Test public void testUpgradeFromRel023ReservedImage() throws Exception {
  unpackStorage(HADOOP023_RESERVED_IMAGE,HADOOP_DFS_DIR_TXT);
  MiniDFSCluster cluster=null;
  final Configuration conf=new Configuration();
  try {
    FSImageFormat.setRenameReservedPairs(".snapshot=.user-snapshot," + ".reserved=.my-reserved");
    cluster=new MiniDFSCluster.Builder(conf).format(false).startupOption(StartupOption.UPGRADE).numDataNodes(0).build();
    DistributedFileSystem dfs=cluster.getFileSystem();
    final String[] expected=new String[]{"/.user-snapshot","/dir1","/dir1/.user-snapshot","/dir2","/dir2/.user-snapshot"};
    for (int i=0; i < 2; i++) {
      if (i == 1) {
        cluster.finalizeCluster(conf);
        cluster.restartNameNode(true);
      }
      ArrayList<Path> toList=new ArrayList<Path>();
      toList.add(new Path("/"));
      ArrayList<String> found=new ArrayList<String>();
      while (!toList.isEmpty()) {
        Path p=toList.remove(0);
        FileStatus[] statuses=dfs.listStatus(p);
        for (        FileStatus status : statuses) {
          final String path=status.getPath().toUri().getPath();
          System.out.println("Found path " + path);
          found.add(path);
          if (status.isDirectory()) {
            toList.add(status.getPath());
          }
        }
      }
      for (      String s : expected) {
        assertTrue("Did not find expected path " + s,found.contains(s));
      }
      assertEquals("Found an unexpected path while listing filesystem",found.size(),expected.length);
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDatanodeBlockScanner </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDuplicateScans() throws Exception {
  long startTime=Time.monotonicNow();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(new Configuration()).numDataNodes(1).build();
  FileSystem fs=null;
  try {
    fs=cluster.getFileSystem();
    DataNode dataNode=cluster.getDataNodes().get(0);
    int infoPort=dataNode.getInfoPort();
    long scanTimeBefore=0, scanTimeAfter=0;
    for (int i=1; i < 10; i++) {
      Path fileName=new Path("/test" + i);
      DFSTestUtil.createFile(fs,fileName,1024,(short)1,1000L);
      waitForVerification(infoPort,fs,fileName,i,startTime,TIMEOUT);
      if (i > 1) {
        scanTimeAfter=DataNodeTestUtils.getLatestScanTime(dataNode,DFSTestUtil.getFirstBlock(fs,new Path("/test" + (i - 1))));
        assertFalse("scan time shoud not be 0",scanTimeAfter == 0);
        assertEquals("There should not be duplicate scan",scanTimeBefore,scanTimeAfter);
      }
      scanTimeBefore=DataNodeTestUtils.getLatestScanTime(dataNode,DFSTestUtil.getFirstBlock(fs,new Path("/test" + i)));
    }
    cluster.restartDataNode(0);
    Thread.sleep(10000);
    dataNode=cluster.getDataNodes().get(0);
    scanTimeAfter=DataNodeTestUtils.getLatestScanTime(dataNode,DFSTestUtil.getFirstBlock(fs,new Path("/test" + (9))));
    assertEquals("There should not be duplicate scan",scanTimeBefore,scanTimeAfter);
  }
  finally {
    IOUtils.closeStream(fs);
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDecommission </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a "registration name" in a host include file.
 * Registration names are DataNode names specified in the configuration by
 * dfs.datanode.hostname.  The DataNode will send this name to the NameNode
 * as part of its registration.  Registration names are helpful when you
 * want to override the normal first result of DNS resolution on the
 * NameNode.  For example, a given datanode IP may map to two hostnames,
 * and you may want to choose which hostname is used internally in the
 * cluster.
 * It is not recommended to use a registration name which is not also a
 * valid DNS hostname for the DataNode.  See HDFS-5237 for background.
 */
@Test(timeout=360000) public void testIncludeByRegistrationName() throws IOException, InterruptedException {
  Configuration hdfsConf=new Configuration(conf);
  final String registrationName="127.0.0.100";
  final String nonExistentDn="127.0.0.10";
  hdfsConf.set(DFSConfigKeys.DFS_DATANODE_HOST_NAME_KEY,registrationName);
  cluster=new MiniDFSCluster.Builder(hdfsConf).numDataNodes(1).checkDataNodeHostConfig(true).setupHostsFile(true).build();
  cluster.waitActive();
  ArrayList<String> nodes=new ArrayList<String>();
  nodes.add(nonExistentDn);
  writeConfigFile(hostsFile,nodes);
  refreshNodes(cluster.getNamesystem(0),hdfsConf);
  DFSClient client=getDfsClient(cluster.getNameNode(0),hdfsConf);
  while (true) {
    DatanodeInfo info[]=client.datanodeReport(DatanodeReportType.DEAD);
    if (info.length == 1) {
      break;
    }
    LOG.info("Waiting for datanode to be marked dead");
    Thread.sleep(HEARTBEAT_INTERVAL * 1000);
  }
  int dnPort=cluster.getDataNodes().get(0).getXferPort();
  nodes=new ArrayList<String>();
  nodes.add(registrationName + ":" + dnPort);
  writeConfigFile(hostsFile,nodes);
  refreshNodes(cluster.getNamesystem(0),hdfsConf);
  cluster.restartDataNode(0);
  while (true) {
    DatanodeInfo info[]=client.datanodeReport(DatanodeReportType.LIVE);
    if (info.length == 1) {
      Assert.assertFalse(info[0].isDecommissioned());
      Assert.assertFalse(info[0].isDecommissionInProgress());
      assertEquals(registrationName,info[0].getHostName());
      break;
    }
    LOG.info("Waiting for datanode to come back");
    Thread.sleep(HEARTBEAT_INTERVAL * 1000);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDistributedFileSystem </h4><pre class="type-13 type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFileChecksum() throws Exception {
  final long seed=RAN.nextLong();
  System.out.println("seed=" + seed);
  RAN.setSeed(seed);
  final Configuration conf=getTestConfiguration();
  conf.setBoolean(DFSConfigKeys.DFS_WEBHDFS_ENABLED_KEY,true);
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  final FileSystem hdfs=cluster.getFileSystem();
  final String nnAddr=conf.get(DFSConfigKeys.DFS_NAMENODE_HTTP_ADDRESS_KEY);
  final UserGroupInformation current=UserGroupInformation.getCurrentUser();
  final UserGroupInformation ugi=UserGroupInformation.createUserForTesting(current.getShortUserName() + "x",new String[]{"user"});
  try {
    hdfs.getFileChecksum(new Path("/test/TestNonExistingFile"));
    fail("Expecting FileNotFoundException");
  }
 catch (  FileNotFoundException e) {
    assertTrue("Not throwing the intended exception message",e.getMessage().contains("File does not exist: /test/TestNonExistingFile"));
  }
  try {
    Path path=new Path("/test/TestExistingDir/");
    hdfs.mkdirs(path);
    hdfs.getFileChecksum(path);
    fail("Expecting FileNotFoundException");
  }
 catch (  FileNotFoundException e) {
    assertTrue("Not throwing the intended exception message",e.getMessage().contains("Path is not a file: /test/TestExistingDir"));
  }
  final String webhdfsuri=WebHdfsFileSystem.SCHEME + "://" + nnAddr;
  System.out.println("webhdfsuri=" + webhdfsuri);
  final FileSystem webhdfs=ugi.doAs(new PrivilegedExceptionAction<FileSystem>(){
    @Override public FileSystem run() throws Exception {
      return new Path(webhdfsuri).getFileSystem(conf);
    }
  }
);
  final Path dir=new Path("/filechecksum");
  final int block_size=1024;
  final int buffer_size=conf.getInt(CommonConfigurationKeys.IO_FILE_BUFFER_SIZE_KEY,4096);
  conf.setInt(DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_KEY,512);
  for (int n=0; n < 5; n++) {
    final byte[] data=new byte[RAN.nextInt(block_size / 2 - 1) + n * block_size + 1];
    RAN.nextBytes(data);
    System.out.println("data.length=" + data.length);
    final Path foo=new Path(dir,"foo" + n);
{
      final FSDataOutputStream out=hdfs.create(foo,false,buffer_size,(short)2,block_size);
      out.write(data);
      out.close();
    }
    final FileChecksum hdfsfoocs=hdfs.getFileChecksum(foo);
    System.out.println("hdfsfoocs=" + hdfsfoocs);
    final FileChecksum webhdfsfoocs=webhdfs.getFileChecksum(foo);
    System.out.println("webhdfsfoocs=" + webhdfsfoocs);
    final Path webhdfsqualified=new Path(webhdfsuri + dir,"foo" + n);
    final FileChecksum webhdfs_qfoocs=webhdfs.getFileChecksum(webhdfsqualified);
    System.out.println("webhdfs_qfoocs=" + webhdfs_qfoocs);
    final Path zeroByteFile=new Path(dir,"zeroByteFile" + n);
{
      final FSDataOutputStream out=hdfs.create(zeroByteFile,false,buffer_size,(short)2,block_size);
      out.close();
    }
{
      final FileChecksum zeroChecksum=hdfs.getFileChecksum(zeroByteFile);
      assertEquals(zeroChecksum.toString(),"MD5-of-0MD5-of-0CRC32:70bc8f4b72a86921468bf8e8441dce51");
    }
    final Path bar=new Path(dir,"bar" + n);
{
      final FSDataOutputStream out=hdfs.create(bar,false,buffer_size,(short)2,block_size);
      out.write(data);
      out.close();
    }
{
      final FileChecksum barcs=hdfs.getFileChecksum(bar);
      final int barhashcode=barcs.hashCode();
      assertEquals(hdfsfoocs.hashCode(),barhashcode);
      assertEquals(hdfsfoocs,barcs);
      assertEquals(webhdfsfoocs.hashCode(),barhashcode);
      assertEquals(webhdfsfoocs,barcs);
      assertEquals(webhdfs_qfoocs.hashCode(),barhashcode);
      assertEquals(webhdfs_qfoocs,barcs);
    }
    hdfs.setPermission(dir,new FsPermission((short)0));
{
      try {
        webhdfs.getFileChecksum(webhdfsqualified);
        fail();
      }
 catch (      IOException ioe) {
        FileSystem.LOG.info("GOOD: getting an exception",ioe);
      }
    }
    hdfs.setPermission(dir,new FsPermission((short)0777));
  }
  cluster.shutdown();
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests the normal path of batching up BlockLocation[]s to be passed to a
 * single{@link DistributedFileSystem#getFileBlockStorageLocations(java.util.List)}call
 */
@Test(timeout=60000) public void testGetFileBlockStorageLocationsBatching() throws Exception {
  final Configuration conf=getTestConfiguration();
  ((Log4JLogger)ProtobufRpcEngine.LOG).getLogger().setLevel(Level.TRACE);
  ((Log4JLogger)BlockStorageLocationUtil.LOG).getLogger().setLevel(Level.TRACE);
  ((Log4JLogger)DFSClient.LOG).getLogger().setLevel(Level.TRACE);
  conf.setBoolean(DFSConfigKeys.DFS_HDFS_BLOCKS_METADATA_ENABLED,true);
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  try {
    final DistributedFileSystem fs=cluster.getFileSystem();
    final Path tmpFile1=new Path("/tmpfile1.dat");
    final Path tmpFile2=new Path("/tmpfile2.dat");
    DFSTestUtil.createFile(fs,tmpFile1,1024,(short)2,0xDEADDEADl);
    DFSTestUtil.createFile(fs,tmpFile2,1024,(short)2,0xDEADDEADl);
    GenericTestUtils.waitFor(new Supplier<Boolean>(){
      @Override public Boolean get(){
        try {
          List<BlockLocation> list=Lists.newArrayList();
          list.addAll(Arrays.asList(fs.getFileBlockLocations(tmpFile1,0,1024)));
          list.addAll(Arrays.asList(fs.getFileBlockLocations(tmpFile2,0,1024)));
          int totalRepl=0;
          for (          BlockLocation loc : list) {
            totalRepl+=loc.getHosts().length;
          }
          if (totalRepl == 4) {
            return true;
          }
        }
 catch (        IOException e) {
        }
        return false;
      }
    }
,500,30000);
    BlockLocation[] blockLocs1=fs.getFileBlockLocations(tmpFile1,0,1024);
    BlockLocation[] blockLocs2=fs.getFileBlockLocations(tmpFile2,0,1024);
    BlockLocation[] blockLocs=(BlockLocation[])ArrayUtils.addAll(blockLocs1,blockLocs2);
    BlockStorageLocation[] locs=fs.getFileBlockStorageLocations(Arrays.asList(blockLocs));
    int counter=0;
    for (    BlockStorageLocation l : locs) {
      for (int i=0; i < l.getVolumeIds().length; i++) {
        VolumeId id=l.getVolumeIds()[i];
        String name=l.getNames()[i];
        if (id != null) {
          System.out.println("Datanode " + name + " has block "+ counter+ " on volume id "+ id.toString());
        }
      }
      counter++;
    }
    assertEquals("Expected two HdfsBlockLocations for two 1-block files",2,locs.length);
    for (    BlockStorageLocation l : locs) {
      assertEquals("Expected two replicas for each block",2,l.getVolumeIds().length);
      for (int i=0; i < l.getVolumeIds().length; i++) {
        VolumeId id=l.getVolumeIds()[i];
        String name=l.getNames()[i];
        assertTrue("Expected block to be valid on datanode " + name,id != null);
      }
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestEncryptionZones </h4><pre class="type-9 type-13 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testCipherSuiteNegotiation() throws Exception {
  final HdfsAdmin dfsAdmin=new HdfsAdmin(FileSystem.getDefaultUri(conf),conf);
  final Path zone=new Path("/zone");
  fs.mkdirs(zone);
  dfsAdmin.createEncryptionZone(zone,TEST_KEY);
  DFSTestUtil.createFile(fs,new Path(zone,"success1"),0,(short)1,0xFEED);
  fs.getClient().cipherSuites=Lists.newArrayListWithCapacity(0);
  try {
    DFSTestUtil.createFile(fs,new Path(zone,"fail"),0,(short)1,0xFEED);
    fail("Created a file without specifying a CipherSuite!");
  }
 catch (  UnknownCipherSuiteException e) {
    assertExceptionContains("No cipher suites",e);
  }
  fs.getClient().cipherSuites=Lists.newArrayListWithCapacity(3);
  fs.getClient().cipherSuites.add(CipherSuite.UNKNOWN);
  fs.getClient().cipherSuites.add(CipherSuite.UNKNOWN);
  fs.getClient().cipherSuites.add(CipherSuite.UNKNOWN);
  try {
    DFSTestUtil.createFile(fs,new Path(zone,"fail"),0,(short)1,0xFEED);
    fail("Created a file without specifying a CipherSuite!");
  }
 catch (  UnknownCipherSuiteException e) {
    assertExceptionContains("No cipher suites",e);
  }
  fs.getClient().cipherSuites=Lists.newArrayListWithCapacity(3);
  fs.getClient().cipherSuites.add(CipherSuite.AES_CTR_NOPADDING);
  fs.getClient().cipherSuites.add(CipherSuite.UNKNOWN);
  fs.getClient().cipherSuites.add(CipherSuite.UNKNOWN);
  DFSTestUtil.createFile(fs,new Path(zone,"success2"),0,(short)1,0xFEED);
  fs.getClient().cipherSuites=Lists.newArrayListWithCapacity(3);
  fs.getClient().cipherSuites.add(CipherSuite.UNKNOWN);
  fs.getClient().cipherSuites.add(CipherSuite.UNKNOWN);
  fs.getClient().cipherSuites.add(CipherSuite.AES_CTR_NOPADDING);
  DFSTestUtil.createFile(fs,new Path(zone,"success3"),4096,(short)1,0xFEED);
  cluster.getNamesystem().getProvider().flush();
  KeyProvider provider=KeyProviderFactory.getProviders(conf).get(0);
  List<String> keys=provider.getKeys();
  assertEquals("Expected NN to have created one key per zone",1,keys.size());
  List<KeyProvider.KeyVersion> allVersions=Lists.newArrayList();
  for (  String key : keys) {
    List<KeyProvider.KeyVersion> versions=provider.getKeyVersions(key);
    assertEquals("Should only have one key version per key",1,versions.size());
    allVersions.addAll(versions);
  }
  for (int i=2; i <= 3; i++) {
    FileEncryptionInfo feInfo=getFileEncryptionInfo(new Path(zone.toString() + "/success" + i));
    assertEquals(feInfo.getCipherSuite(),CipherSuite.AES_CTR_NOPADDING);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestFileAppend </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Test that copy on write for blocks works correctly
 * @throws IOException an exception might be thrown
 */
@Test public void testCopyOnWrite() throws IOException {
  Configuration conf=new HdfsConfiguration();
  if (simulatedStorage) {
    SimulatedFSDataset.setFactory(conf);
  }
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  FileSystem fs=cluster.getFileSystem();
  InetSocketAddress addr=new InetSocketAddress("localhost",cluster.getNameNodePort());
  DFSClient client=new DFSClient(addr,conf);
  try {
    Path file1=new Path("/filestatus.dat");
    FSDataOutputStream stm=AppendTestUtil.createFile(fs,file1,1);
    writeFile(stm);
    stm.close();
    DataNode[] dn=cluster.listDataNodes();
    assertTrue("There should be only one datanode but found " + dn.length,dn.length == 1);
    LocatedBlocks locations=client.getNamenode().getBlockLocations(file1.toString(),0,Long.MAX_VALUE);
    List<LocatedBlock> blocks=locations.getLocatedBlocks();
    for (int i=0; i < blocks.size(); i=i + 2) {
      ExtendedBlock b=blocks.get(i).getBlock();
      final File f=DataNodeTestUtils.getFile(dn[0],b.getBlockPoolId(),b.getLocalBlock().getBlockId());
      File link=new File(f.toString() + ".link");
      System.out.println("Creating hardlink for File " + f + " to "+ link);
      HardLink.createHardLink(f,link);
    }
    for (int i=0; i < blocks.size(); i++) {
      ExtendedBlock b=blocks.get(i).getBlock();
      System.out.println("testCopyOnWrite detaching block " + b);
      assertTrue("Detaching block " + b + " should have returned true",DataNodeTestUtils.unlinkBlock(dn[0],b,1));
    }
    for (int i=0; i < blocks.size(); i++) {
      ExtendedBlock b=blocks.get(i).getBlock();
      System.out.println("testCopyOnWrite detaching block " + b);
      assertTrue("Detaching block " + b + " should have returned false",!DataNodeTestUtils.unlinkBlock(dn[0],b,1));
    }
  }
  finally {
    client.close();
    fs.close();
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestFileAppend3 </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * TC11: Racing rename
 * @throws IOException an exception might be thrown
 */
@Test public void testTC11() throws Exception {
  final Path p=new Path("/TC11/foo");
  System.out.println("p=" + p);
  final int len1=(int)BLOCK_SIZE;
{
    FSDataOutputStream out=fs.create(p,false,buffersize,REPLICATION,BLOCK_SIZE);
    AppendTestUtil.write(out,0,len1);
    out.close();
  }
  FSDataOutputStream out=fs.append(p);
  final int len2=(int)BLOCK_SIZE / 2;
  AppendTestUtil.write(out,len1,len2);
  out.hflush();
  final Path pnew=new Path(p + ".new");
  assertTrue(fs.rename(p,pnew));
  out.close();
  final long len=fs.getFileStatus(pnew).getLen();
  final LocatedBlocks locatedblocks=fs.dfs.getNamenode().getBlockLocations(pnew.toString(),0L,len);
  final int numblock=locatedblocks.locatedBlockCount();
  for (int i=0; i < numblock; i++) {
    final LocatedBlock lb=locatedblocks.get(i);
    final ExtendedBlock blk=lb.getBlock();
    final long size=lb.getBlockSize();
    if (i < numblock - 1) {
      assertEquals(BLOCK_SIZE,size);
    }
    for (    DatanodeInfo datanodeinfo : lb.getLocations()) {
      final DataNode dn=cluster.getDataNode(datanodeinfo.getIpcPort());
      final Block metainfo=DataNodeTestUtils.getFSDataset(dn).getStoredBlock(blk.getBlockPoolId(),blk.getBlockId());
      assertEquals(size,metainfo.getNumBytes());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestFileCorruption </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * check if DFS can handle corrupted blocks properly 
 */
@Test public void testFileCorruption() throws Exception {
  MiniDFSCluster cluster=null;
  DFSTestUtil util=new DFSTestUtil.Builder().setName("TestFileCorruption").setNumFiles(20).build();
  try {
    Configuration conf=new HdfsConfiguration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
    FileSystem fs=cluster.getFileSystem();
    util.createFiles(fs,"/srcdat");
    File storageDir=cluster.getInstanceStorageDir(2,0);
    String bpid=cluster.getNamesystem().getBlockPoolId();
    File data_dir=MiniDFSCluster.getFinalizedDir(storageDir,bpid);
    assertTrue("data directory does not exist",data_dir.exists());
    File[] blocks=data_dir.listFiles();
    assertTrue("Blocks do not exist in data-dir",(blocks != null) && (blocks.length > 0));
    for (int idx=0; idx < blocks.length; idx++) {
      if (!blocks[idx].getName().startsWith("blk_")) {
        continue;
      }
      System.out.println("Deliberately removing file " + blocks[idx].getName());
      assertTrue("Cannot remove file.",blocks[idx].delete());
    }
    assertTrue("Corrupted replicas not handled properly.",util.checkFiles(fs,"/srcdat"));
    util.cleanup(fs,"/srcdat");
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestFileCreation </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test creating two files at the same time. 
 */
@Test public void testConcurrentFileCreation() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  try {
    FileSystem fs=cluster.getFileSystem();
    Path[] p={new Path("/foo"),new Path("/bar")};
    FSDataOutputStream[] out={fs.create(p[0]),fs.create(p[1])};
    int i=0;
    for (; i < 100; i++) {
      out[0].write(i);
      out[1].write(i);
    }
    out[0].close();
    for (; i < 200; i++) {
      out[1].write(i);
    }
    out[1].close();
    FSDataInputStream[] in={fs.open(p[0]),fs.open(p[1])};
    for (i=0; i < 100; i++) {
      assertEquals(i,in[0].read());
    }
    for (i=0; i < 200; i++) {
      assertEquals(i,in[1].read());
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test creating a file whose data gets sync when closed
 */
@Test public void testFileCreationSyncOnClose() throws IOException {
  Configuration conf=new HdfsConfiguration();
  conf.setBoolean(DFS_DATANODE_SYNCONCLOSE_KEY,true);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  try {
    FileSystem fs=cluster.getFileSystem();
    Path[] p={new Path("/foo"),new Path("/bar")};
    FSDataOutputStream[] out={fs.create(p[0]),fs.create(p[1])};
    int i=0;
    for (; i < 100; i++) {
      out[0].write(i);
      out[1].write(i);
    }
    out[0].close();
    for (; i < 200; i++) {
      out[1].write(i);
    }
    out[1].close();
    FSDataInputStream[] in={fs.open(p[0]),fs.open(p[1])};
    for (i=0; i < 100; i++) {
      assertEquals(i,in[0].read());
    }
    for (i=0; i < 200; i++) {
      assertEquals(i,in[1].read());
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestFileCreationClient </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test lease recovery Triggered by DFSClient. 
 */
@Test public void testClientTriggeredLeaseRecovery() throws Exception {
  final int REPLICATION=3;
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFSConfigKeys.DFS_DATANODE_HANDLER_COUNT_KEY,1);
  conf.setInt(DFSConfigKeys.DFS_REPLICATION_KEY,REPLICATION);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(REPLICATION).build();
  try {
    final FileSystem fs=cluster.getFileSystem();
    final Path dir=new Path("/wrwelkj");
    SlowWriter[] slowwriters=new SlowWriter[10];
    for (int i=0; i < slowwriters.length; i++) {
      slowwriters[i]=new SlowWriter(fs,new Path(dir,"file" + i));
    }
    try {
      for (int i=0; i < slowwriters.length; i++) {
        slowwriters[i].start();
      }
      Thread.sleep(1000);
      cluster.stopDataNode(AppendTestUtil.nextInt(REPLICATION));
      System.out.println("Wait a few seconds");
      Thread.sleep(5000);
    }
  finally {
      for (int i=0; i < slowwriters.length; i++) {
        if (slowwriters[i] != null) {
          slowwriters[i].running=false;
          slowwriters[i].interrupt();
        }
      }
      for (int i=0; i < slowwriters.length; i++) {
        if (slowwriters[i] != null) {
          slowwriters[i].join();
        }
      }
    }
    System.out.println("Verify the file");
    for (int i=0; i < slowwriters.length; i++) {
      System.out.println(slowwriters[i].filepath + ": length=" + fs.getFileStatus(slowwriters[i].filepath).getLen());
      FSDataInputStream in=null;
      try {
        in=fs.open(slowwriters[i].filepath);
        for (int j=0, x; (x=in.read()) != -1; j++) {
          assertEquals(j,x);
        }
      }
  finally {
        IOUtils.closeStream(in);
      }
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestGetBlocks </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * test getBlocks 
 */
@Test public void testGetBlocks() throws Exception {
  final Configuration CONF=new HdfsConfiguration();
  final short REPLICATION_FACTOR=(short)2;
  final int DEFAULT_BLOCK_SIZE=1024;
  CONF.setLong(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,DEFAULT_BLOCK_SIZE);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(CONF).numDataNodes(REPLICATION_FACTOR).build();
  try {
    cluster.waitActive();
    long fileLen=2 * DEFAULT_BLOCK_SIZE;
    DFSTestUtil.createFile(cluster.getFileSystem(),new Path("/tmp.txt"),fileLen,REPLICATION_FACTOR,0L);
    List<LocatedBlock> locatedBlocks;
    DatanodeInfo[] dataNodes=null;
    boolean notWritten;
    do {
      final DFSClient dfsclient=new DFSClient(NameNode.getAddress(CONF),CONF);
      locatedBlocks=dfsclient.getNamenode().getBlockLocations("/tmp.txt",0,fileLen).getLocatedBlocks();
      assertEquals(2,locatedBlocks.size());
      notWritten=false;
      for (int i=0; i < 2; i++) {
        dataNodes=locatedBlocks.get(i).getLocations();
        if (dataNodes.length != REPLICATION_FACTOR) {
          notWritten=true;
          try {
            Thread.sleep(10);
          }
 catch (          InterruptedException e) {
          }
          break;
        }
      }
    }
 while (notWritten);
    InetSocketAddress addr=new InetSocketAddress("localhost",cluster.getNameNodePort());
    NamenodeProtocol namenode=NameNodeProxies.createProxy(CONF,NameNode.getUri(addr),NamenodeProtocol.class).getProxy();
    BlockWithLocations[] locs;
    locs=namenode.getBlocks(dataNodes[0],fileLen).getBlocks();
    assertEquals(locs.length,2);
    assertEquals(locs[0].getStorageIDs().length,2);
    assertEquals(locs[1].getStorageIDs().length,2);
    locs=namenode.getBlocks(dataNodes[0],DEFAULT_BLOCK_SIZE).getBlocks();
    assertEquals(locs.length,1);
    assertEquals(locs[0].getStorageIDs().length,2);
    locs=namenode.getBlocks(dataNodes[0],1).getBlocks();
    assertEquals(locs.length,1);
    assertEquals(locs[0].getStorageIDs().length,2);
    getBlocksWithException(namenode,dataNodes[0],0);
    getBlocksWithException(namenode,dataNodes[0],-1);
    DatanodeInfo info=DFSTestUtil.getDatanodeInfo("1.2.3.4");
    getBlocksWithException(namenode,info,2);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBlockKey(){
  Map<Block,Long> map=new HashMap<Block,Long>();
  final Random RAN=new Random();
  final long seed=RAN.nextLong();
  System.out.println("seed=" + seed);
  RAN.setSeed(seed);
  long[] blkids=new long[10];
  for (int i=0; i < blkids.length; i++) {
    blkids[i]=1000L + RAN.nextInt(100000);
    map.put(new Block(blkids[i],0,blkids[i]),blkids[i]);
  }
  System.out.println("map=" + map.toString().replace(",","\n  "));
  for (int i=0; i < blkids.length; i++) {
    Block b=new Block(blkids[i],0,GenerationStamp.GRANDFATHER_GENERATION_STAMP);
    Long v=map.get(b);
    System.out.println(b + " => " + v);
    assertEquals(blkids[i],v.longValue());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestLeaseRecovery </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The following test first creates a file with a few blocks.
 * It randomly truncates the replica of the last block stored in each datanode.
 * Finally, it triggers block synchronization to synchronize all stored block.
 */
@Test public void testBlockSynchronization() throws Exception {
  final int ORG_FILE_SIZE=3000;
  Configuration conf=new HdfsConfiguration();
  conf.setLong(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,BLOCK_SIZE);
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(5).build();
    cluster.waitActive();
    DistributedFileSystem dfs=cluster.getFileSystem();
    String filestr="/foo";
    Path filepath=new Path(filestr);
    DFSTestUtil.createFile(dfs,filepath,ORG_FILE_SIZE,REPLICATION_NUM,0L);
    assertTrue(dfs.exists(filepath));
    DFSTestUtil.waitReplication(dfs,filepath,REPLICATION_NUM);
    LocatedBlock locatedblock=TestInterDatanodeProtocol.getLastLocatedBlock(dfs.dfs.getNamenode(),filestr);
    DatanodeInfo[] datanodeinfos=locatedblock.getLocations();
    assertEquals(REPLICATION_NUM,datanodeinfos.length);
    DataNode[] datanodes=new DataNode[REPLICATION_NUM];
    for (int i=0; i < REPLICATION_NUM; i++) {
      datanodes[i]=cluster.getDataNode(datanodeinfos[i].getIpcPort());
      assertTrue(datanodes[i] != null);
    }
    ExtendedBlock lastblock=locatedblock.getBlock();
    DataNode.LOG.info("newblocks=" + lastblock);
    for (int i=0; i < REPLICATION_NUM; i++) {
      checkMetaInfo(lastblock,datanodes[i]);
    }
    DataNode.LOG.info("dfs.dfs.clientName=" + dfs.dfs.clientName);
    cluster.getNameNodeRpc().append(filestr,dfs.dfs.clientName);
    waitLeaseRecovery(cluster);
    Block[] updatedmetainfo=new Block[REPLICATION_NUM];
    long oldSize=lastblock.getNumBytes();
    lastblock=TestInterDatanodeProtocol.getLastLocatedBlock(dfs.dfs.getNamenode(),filestr).getBlock();
    long currentGS=lastblock.getGenerationStamp();
    for (int i=0; i < REPLICATION_NUM; i++) {
      updatedmetainfo[i]=DataNodeTestUtils.getFSDataset(datanodes[i]).getStoredBlock(lastblock.getBlockPoolId(),lastblock.getBlockId());
      assertEquals(lastblock.getBlockId(),updatedmetainfo[i].getBlockId());
      assertEquals(oldSize,updatedmetainfo[i].getNumBytes());
      assertEquals(currentGS,updatedmetainfo[i].getGenerationStamp());
    }
    System.out.println("Testing that lease recovery cannot happen during safemode.");
    filestr="/foo.safemode";
    filepath=new Path(filestr);
    dfs.create(filepath,(short)1);
    cluster.getNameNodeRpc().setSafeMode(HdfsConstants.SafeModeAction.SAFEMODE_ENTER,false);
    assertTrue(dfs.dfs.exists(filestr));
    DFSTestUtil.waitReplication(dfs,filepath,(short)1);
    waitLeaseRecovery(cluster);
    LeaseManager lm=NameNodeAdapter.getLeaseManager(cluster.getNamesystem());
    assertTrue("Found " + lm.countLease() + " lease, expected 1",lm.countLease() == 1);
    cluster.getNameNodeRpc().setSafeMode(HdfsConstants.SafeModeAction.SAFEMODE_LEAVE,false);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestLeaseRecovery2 </h4><pre class="type-9 type-13 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test makes the client does not renew its lease and also
 * set the soft lease expiration period to be short 1s. Thus triggering
 * soft lease expiration to happen immediately by having another client
 * trying to create the same file.
 * The test makes sure that the lease recovery completes.
 * @throws Exception
 */
@Test public void testSoftLeaseRecovery() throws Exception {
  Map<String,String[]> u2g_map=new HashMap<String,String[]>(1);
  u2g_map.put(fakeUsername,new String[]{fakeGroup});
  DFSTestUtil.updateConfWithFakeGroupMapping(conf,u2g_map);
  cluster.setLeasePeriod(HdfsConstants.LEASE_SOFTLIMIT_PERIOD,HdfsConstants.LEASE_HARDLIMIT_PERIOD);
  String filestr="/foo" + AppendTestUtil.nextInt();
  AppendTestUtil.LOG.info("filestr=" + filestr);
  Path filepath=new Path(filestr);
  FSDataOutputStream stm=dfs.create(filepath,true,BUF_SIZE,REPLICATION_NUM,BLOCK_SIZE);
  assertTrue(dfs.dfs.exists(filestr));
  int size=AppendTestUtil.nextInt(FILE_SIZE);
  AppendTestUtil.LOG.info("size=" + size);
  stm.write(buffer,0,size);
  AppendTestUtil.LOG.info("hflush");
  stm.hflush();
  AppendTestUtil.LOG.info("leasechecker.interruptAndJoin()");
  dfs.dfs.getLeaseRenewer().interruptAndJoin();
  cluster.setLeasePeriod(SHORT_LEASE_PERIOD,LONG_LEASE_PERIOD);
{
    UserGroupInformation ugi=UserGroupInformation.createUserForTesting(fakeUsername,new String[]{fakeGroup});
    FileSystem dfs2=DFSTestUtil.getFileSystemAs(ugi,conf);
    boolean done=false;
    for (int i=0; i < 10 && !done; i++) {
      AppendTestUtil.LOG.info("i=" + i);
      try {
        dfs2.create(filepath,false,BUF_SIZE,REPLICATION_NUM,BLOCK_SIZE);
        fail("Creation of an existing file should never succeed.");
      }
 catch (      FileAlreadyExistsException ex) {
        done=true;
      }
catch (      AlreadyBeingCreatedException ex) {
        AppendTestUtil.LOG.info("GOOD! got " + ex.getMessage());
      }
catch (      IOException ioe) {
        AppendTestUtil.LOG.warn("UNEXPECTED IOException",ioe);
      }
      if (!done) {
        AppendTestUtil.LOG.info("sleep " + 5000 + "ms");
        try {
          Thread.sleep(5000);
        }
 catch (        InterruptedException e) {
        }
      }
    }
    assertTrue(done);
  }
  AppendTestUtil.LOG.info("Lease for file " + filepath + " is recovered. "+ "Validating its contents now...");
  long fileSize=dfs.getFileStatus(filepath).getLen();
  assertTrue("File should be " + size + " bytes, but is actually "+ " found to be "+ fileSize+ " bytes",fileSize == size);
  AppendTestUtil.LOG.info("File size is good. " + "Now validating data and sizes from datanodes...");
  AppendTestUtil.checkFullFile(dfs,filepath,size,buffer,filestr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestPeerCache </h4><pre class="type-13 type-7 type-10 type-19 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEviction() throws Exception {
  final int CAPACITY=3;
  PeerCache cache=new PeerCache(CAPACITY,100000);
  DatanodeID dnIds[]=new DatanodeID[CAPACITY + 1];
  FakePeer peers[]=new FakePeer[CAPACITY + 1];
  for (int i=0; i < dnIds.length; ++i) {
    dnIds[i]=new DatanodeID("192.168.0.1","fakehostname_" + i,"fake_datanode_id_" + i,100,101,102,103);
    peers[i]=new FakePeer(dnIds[i],false);
  }
  for (int i=0; i < CAPACITY; ++i) {
    cache.put(dnIds[i],peers[i]);
  }
  assertEquals(CAPACITY,cache.size());
  cache.put(dnIds[CAPACITY],peers[CAPACITY]);
  assertEquals(CAPACITY,cache.size());
  assertSame(null,cache.get(dnIds[0],false));
  for (int i=1; i < CAPACITY; ++i) {
    Peer peer=cache.get(dnIds[i],false);
    assertSame(peers[i],peer);
    assertTrue(!peer.isClosed());
    peer.close();
  }
  assertEquals(1,cache.size());
  cache.close();
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDomainSocketPeers() throws Exception {
  final int CAPACITY=3;
  PeerCache cache=new PeerCache(CAPACITY,100000);
  DatanodeID dnId=new DatanodeID("192.168.0.1","fakehostname","fake_datanode_id",100,101,102,103);
  HashMultiset<FakePeer> peers=HashMultiset.create(CAPACITY);
  for (int i=0; i < CAPACITY; ++i) {
    FakePeer peer=new FakePeer(dnId,i == CAPACITY - 1);
    peers.add(peer);
    cache.put(dnId,peer);
  }
  assertEquals(CAPACITY,cache.size());
  Peer peer=cache.get(dnId,true);
  assertTrue(peer.getDomainSocket() != null);
  peers.remove(peer);
  peer=cache.get(dnId,true);
  assertTrue(peer == null);
  while (!peers.isEmpty()) {
    peer=cache.get(dnId,false);
    assertTrue(peer != null);
    assertTrue(!peer.isClosed());
    peers.remove(peer);
  }
  assertEquals(0,cache.size());
  cache.close();
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpiry() throws Exception {
  final int CAPACITY=3;
  final int EXPIRY_PERIOD=10;
  PeerCache cache=new PeerCache(CAPACITY,EXPIRY_PERIOD);
  DatanodeID dnIds[]=new DatanodeID[CAPACITY];
  FakePeer peers[]=new FakePeer[CAPACITY];
  for (int i=0; i < CAPACITY; ++i) {
    dnIds[i]=new DatanodeID("192.168.0.1","fakehostname_" + i,"fake_datanode_id",100,101,102,103);
    peers[i]=new FakePeer(dnIds[i],false);
  }
  for (int i=0; i < CAPACITY; ++i) {
    cache.put(dnIds[i],peers[i]);
  }
  Thread.sleep(EXPIRY_PERIOD * 50);
  assertEquals(0,cache.size());
  for (int i=0; i < CAPACITY; ++i) {
    assertTrue(peers[i].isClosed());
  }
  Thread.sleep(EXPIRY_PERIOD * 50);
  cache.close();
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiplePeersWithSameKey() throws Exception {
  final int CAPACITY=3;
  PeerCache cache=new PeerCache(CAPACITY,100000);
  DatanodeID dnId=new DatanodeID("192.168.0.1","fakehostname","fake_datanode_id",100,101,102,103);
  HashMultiset<FakePeer> peers=HashMultiset.create(CAPACITY);
  for (int i=0; i < CAPACITY; ++i) {
    FakePeer peer=new FakePeer(dnId,false);
    peers.add(peer);
    cache.put(dnId,peer);
  }
  assertEquals(CAPACITY,cache.size());
  while (!peers.isEmpty()) {
    Peer peer=cache.get(dnId,false);
    assertTrue(peer != null);
    assertTrue(!peer.isClosed());
    peers.remove(peer);
  }
  assertEquals(0,cache.size());
  cache.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestReplaceDatanodeOnFailure </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test DEFAULT ReplaceDatanodeOnFailure policy. 
 */
@Test public void testDefaultPolicy() throws Exception {
  final ReplaceDatanodeOnFailure p=ReplaceDatanodeOnFailure.DEFAULT;
  final DatanodeInfo[] infos=new DatanodeInfo[5];
  final DatanodeInfo[][] datanodes=new DatanodeInfo[infos.length + 1][];
  datanodes[0]=new DatanodeInfo[0];
  for (int i=0; i < infos.length; ) {
    infos[i]=DFSTestUtil.getLocalDatanodeInfo(50020 + i);
    i++;
    datanodes[i]=new DatanodeInfo[i];
    System.arraycopy(infos,0,datanodes[i],0,datanodes[i].length);
  }
  final boolean[] isAppend={true,true,false,false};
  final boolean[] isHflushed={true,false,true,false};
  for (short replication=1; replication <= infos.length; replication++) {
    for (int nExistings=0; nExistings < datanodes.length; nExistings++) {
      final DatanodeInfo[] existings=datanodes[nExistings];
      Assert.assertEquals(nExistings,existings.length);
      for (int i=0; i < isAppend.length; i++) {
        for (int j=0; j < isHflushed.length; j++) {
          final int half=replication / 2;
          final boolean enoughReplica=replication <= nExistings;
          final boolean noReplica=nExistings == 0;
          final boolean replicationL3=replication < 3;
          final boolean existingsLEhalf=nExistings <= half;
          final boolean isAH=isAppend[i] || isHflushed[j];
          final boolean expected;
          if (enoughReplica || noReplica || replicationL3) {
            expected=false;
          }
 else {
            expected=isAH || existingsLEhalf;
          }
          final boolean computed=p.satisfy(replication,existings,isAppend[i],isHflushed[j]);
          try {
            Assert.assertEquals(expected,computed);
          }
 catch (          AssertionError e) {
            final String s="replication=" + replication + "\nnExistings ="+ nExistings+ "\nisAppend   ="+ isAppend[i]+ "\nisHflushed ="+ isHflushed[j];
            throw new RuntimeException(s,e);
          }
        }
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test replace datanode on failure. 
 */
@Test public void testReplaceDatanodeOnFailure() throws Exception {
  final Configuration conf=new HdfsConfiguration();
  ReplaceDatanodeOnFailure.ALWAYS.write(conf);
  final String[] racks=new String[REPLICATION];
  Arrays.fill(racks,RACK0);
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).racks(racks).numDataNodes(REPLICATION).build();
  try {
    final DistributedFileSystem fs=cluster.getFileSystem();
    final Path dir=new Path(DIR);
    final SlowWriter[] slowwriters=new SlowWriter[10];
    for (int i=1; i <= slowwriters.length; i++) {
      slowwriters[i - 1]=new SlowWriter(fs,new Path(dir,"file" + i),i * 200L);
    }
    for (    SlowWriter s : slowwriters) {
      s.start();
    }
    sleepSeconds(1);
    cluster.startDataNodes(conf,2,true,null,new String[]{RACK1,RACK1});
    cluster.stopDataNode(AppendTestUtil.nextInt(REPLICATION));
    sleepSeconds(5);
    for (    SlowWriter s : slowwriters) {
      s.checkReplication();
      s.interruptRunning();
    }
    for (    SlowWriter s : slowwriters) {
      s.joinAndClose();
    }
    LOG.info("Verify the file");
    for (int i=0; i < slowwriters.length; i++) {
      LOG.info(slowwriters[i].filepath + ": length=" + fs.getFileStatus(slowwriters[i].filepath).getLen());
      FSDataInputStream in=null;
      try {
        in=fs.open(slowwriters[i].filepath);
        for (int j=0, x; (x=in.read()) != -1; j++) {
          Assert.assertEquals(j,x);
        }
      }
  finally {
        IOUtils.closeStream(in);
      }
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.TestReplication </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPendingReplicationRetry() throws IOException {
  MiniDFSCluster cluster=null;
  int numDataNodes=4;
  String testFile="/replication-test-file";
  Path testPath=new Path(testFile);
  byte buffer[]=new byte[1024];
  for (int i=0; i < buffer.length; i++) {
    buffer[i]='1';
  }
  try {
    Configuration conf=new HdfsConfiguration();
    conf.set(DFSConfigKeys.DFS_REPLICATION_KEY,Integer.toString(numDataNodes));
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(numDataNodes).build();
    cluster.waitActive();
    DFSClient dfsClient=new DFSClient(new InetSocketAddress("localhost",cluster.getNameNodePort()),conf);
    OutputStream out=cluster.getFileSystem().create(testPath);
    out.write(buffer);
    out.close();
    waitForBlockReplication(testFile,dfsClient.getNamenode(),numDataNodes,-1);
    ExtendedBlock block=dfsClient.getNamenode().getBlockLocations(testFile,0,Long.MAX_VALUE).get(0).getBlock();
    cluster.shutdown();
    cluster=null;
    for (int i=0; i < 25; i++) {
      buffer[i]='0';
    }
    int fileCount=0;
    for (int dnIndex=0; dnIndex < 3; dnIndex++) {
      File blockFile=MiniDFSCluster.getBlockFile(dnIndex,block);
      LOG.info("Checking for file " + blockFile);
      if (blockFile != null && blockFile.exists()) {
        if (fileCount == 0) {
          LOG.info("Deleting file " + blockFile);
          assertTrue(blockFile.delete());
        }
 else {
          LOG.info("Corrupting file " + blockFile);
          long len=blockFile.length();
          assertTrue(len > 50);
          RandomAccessFile blockOut=new RandomAccessFile(blockFile,"rw");
          try {
            blockOut.seek(len / 3);
            blockOut.write(buffer,0,25);
          }
  finally {
            blockOut.close();
          }
        }
        fileCount++;
      }
    }
    assertEquals(3,fileCount);
    LOG.info("Restarting minicluster after deleting a replica and corrupting 2 crcs");
    conf=new HdfsConfiguration();
    conf.set(DFSConfigKeys.DFS_REPLICATION_KEY,Integer.toString(numDataNodes));
    conf.set(DFSConfigKeys.DFS_NAMENODE_REPLICATION_PENDING_TIMEOUT_SEC_KEY,Integer.toString(2));
    conf.set("dfs.datanode.block.write.timeout.sec",Integer.toString(5));
    conf.set(DFSConfigKeys.DFS_NAMENODE_SAFEMODE_THRESHOLD_PCT_KEY,"0.75f");
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(numDataNodes * 2).format(false).build();
    cluster.waitActive();
    dfsClient=new DFSClient(new InetSocketAddress("localhost",cluster.getNameNodePort()),conf);
    waitForBlockReplication(testFile,dfsClient.getNamenode(),numDataNodes,-1);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.protocolPB.TestPBHelper </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testConvertBlockCommand(){
  Block[] blocks=new Block[]{new Block(21),new Block(22)};
  DatanodeInfo[][] dnInfos=new DatanodeInfo[][]{new DatanodeInfo[1],new DatanodeInfo[2]};
  dnInfos[0][0]=DFSTestUtil.getLocalDatanodeInfo();
  dnInfos[1][0]=DFSTestUtil.getLocalDatanodeInfo();
  dnInfos[1][1]=DFSTestUtil.getLocalDatanodeInfo();
  String[][] storageIDs={{"s00"},{"s10","s11"}};
  StorageType[][] storageTypes={{StorageType.DEFAULT},{StorageType.DEFAULT,StorageType.DEFAULT}};
  BlockCommand bc=new BlockCommand(DatanodeProtocol.DNA_TRANSFER,"bp1",blocks,dnInfos,storageTypes,storageIDs);
  BlockCommandProto bcProto=PBHelper.convert(bc);
  BlockCommand bc2=PBHelper.convert(bcProto);
  assertEquals(bc.getAction(),bc2.getAction());
  assertEquals(bc.getBlocks().length,bc2.getBlocks().length);
  Block[] blocks2=bc2.getBlocks();
  for (int i=0; i < blocks.length; i++) {
    assertEquals(blocks[i],blocks2[i]);
  }
  DatanodeInfo[][] dnInfos2=bc2.getTargets();
  assertEquals(dnInfos.length,dnInfos2.length);
  for (int i=0; i < dnInfos.length; i++) {
    DatanodeInfo[] d1=dnInfos[i];
    DatanodeInfo[] d2=dnInfos2[i];
    assertEquals(d1.length,d2.length);
    for (int j=0; j < d1.length; j++) {
      compare(d1[j],d2[j]);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.qjournal.client.TestEpochsAreUnique </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleThreaded() throws IOException {
  Configuration conf=new Configuration();
  MiniJournalCluster cluster=new MiniJournalCluster.Builder(conf).build();
  URI uri=cluster.getQuorumJournalURI(JID);
  QuorumJournalManager qjm=new QuorumJournalManager(conf,uri,FAKE_NSINFO);
  try {
    qjm.format(FAKE_NSINFO);
  }
  finally {
    qjm.close();
  }
  try {
    for (int i=0; i < 5; i++) {
      qjm=new QuorumJournalManager(conf,uri,FAKE_NSINFO);
      try {
        qjm.createNewUniqueEpoch();
        assertEquals(i + 1,qjm.getLoggerSetForTests().getEpoch());
      }
  finally {
        qjm.close();
      }
    }
    long prevEpoch=5;
    for (int i=0; i < 20; i++) {
      long newEpoch=-1;
      while (true) {
        qjm=new QuorumJournalManager(conf,uri,FAKE_NSINFO,new FaultyLoggerFactory());
        try {
          qjm.createNewUniqueEpoch();
          newEpoch=qjm.getLoggerSetForTests().getEpoch();
          break;
        }
 catch (        IOException ioe) {
        }
 finally {
          qjm.close();
        }
      }
      LOG.info("Created epoch " + newEpoch);
      assertTrue("New epoch " + newEpoch + " should be greater than previous "+ prevEpoch,newEpoch > prevEpoch);
      prevEpoch=newEpoch;
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.qjournal.client.TestQJMWithFaults </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Sets up two of the nodes to each drop a single RPC, at all
 * possible combinations of RPCs. This may result in the
 * active writer failing to write. After this point, a new writer
 * should be able to recover and continue writing without
 * data loss.
 */
@Test public void testRecoverAfterDoubleFailures() throws Exception {
  final long MAX_IPC_NUMBER=determineMaxIpcNumber();
  for (int failA=1; failA <= MAX_IPC_NUMBER; failA++) {
    for (int failB=1; failB <= MAX_IPC_NUMBER; failB++) {
      String injectionStr="(" + failA + ", "+ failB+ ")";
      LOG.info("\n\n-------------------------------------------\n" + "Beginning test, failing at " + injectionStr + "\n"+ "-------------------------------------------\n\n");
      MiniJournalCluster cluster=new MiniJournalCluster.Builder(conf).build();
      QuorumJournalManager qjm=null;
      try {
        qjm=createInjectableQJM(cluster);
        qjm.format(FAKE_NSINFO);
        List<AsyncLogger> loggers=qjm.getLoggerSetForTests().getLoggersForTests();
        failIpcNumber(loggers.get(0),failA);
        failIpcNumber(loggers.get(1),failB);
        int lastAckedTxn=doWorkload(cluster,qjm);
        if (lastAckedTxn < 6) {
          LOG.info("Failed after injecting failures at " + injectionStr + ". This is expected since we injected a failure in the "+ "majority.");
        }
        qjm.close();
        qjm=null;
        qjm=createInjectableQJM(cluster);
        long lastRecoveredTxn=QJMTestUtil.recoverAndReturnLastTxn(qjm);
        assertTrue(lastRecoveredTxn >= lastAckedTxn);
        writeSegment(cluster,qjm,lastRecoveredTxn + 1,3,true);
      }
 catch (      Throwable t) {
        throw new RuntimeException("Test failed with injection: " + injectionStr,t);
      }
 finally {
        cluster.shutdown();
        cluster=null;
        IOUtils.closeStream(qjm);
        qjm=null;
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
/** 
 * Test case in which three JournalNodes randomly flip flop between
 * up and down states every time they get an RPC.
 * The writer keeps track of the latest ACKed edit, and on every
 * recovery operation, ensures that it recovers at least to that
 * point or higher. Since at any given point, a majority of JNs
 * may be injecting faults, any writer operation is allowed to fail,
 * so long as the exception message indicates it failed due to injected
 * faults.
 * Given a random seed, the test should be entirely deterministic.
 */
@Test public void testRandomized() throws Exception {
  long seed;
  Long userSpecifiedSeed=Long.getLong(RAND_SEED_PROPERTY);
  if (userSpecifiedSeed != null) {
    LOG.info("Using seed specified in system property");
    seed=userSpecifiedSeed;
    ((Log4JLogger)ProtobufRpcEngine.LOG).getLogger().setLevel(Level.ALL);
  }
 else {
    seed=new Random().nextLong();
  }
  LOG.info("Random seed: " + seed);
  Random r=new Random(seed);
  MiniJournalCluster cluster=new MiniJournalCluster.Builder(conf).build();
  QuorumJournalManager qjmForInitialFormat=createInjectableQJM(cluster);
  qjmForInitialFormat.format(FAKE_NSINFO);
  qjmForInitialFormat.close();
  try {
    long txid=0;
    long lastAcked=0;
    for (int i=0; i < NUM_WRITER_ITERS; i++) {
      LOG.info("Starting writer " + i + "\n-------------------");
      QuorumJournalManager qjm=createRandomFaultyQJM(cluster,r);
      try {
        long recovered;
        try {
          recovered=QJMTestUtil.recoverAndReturnLastTxn(qjm);
        }
 catch (        Throwable t) {
          LOG.info("Failed recovery",t);
          checkException(t);
          continue;
        }
        assertTrue("Recovered only up to txnid " + recovered + " but had gotten an ack for "+ lastAcked,recovered >= lastAcked);
        txid=recovered + 1;
        if (txid > 100 && i % 10 == 1) {
          qjm.purgeLogsOlderThan(txid - 100);
        }
        Holder<Throwable> thrown=new Holder<Throwable>(null);
        for (int j=0; j < SEGMENTS_PER_WRITER; j++) {
          lastAcked=writeSegmentUntilCrash(cluster,qjm,txid,4,thrown);
          if (thrown.held != null) {
            LOG.info("Failed write",thrown.held);
            checkException(thrown.held);
            break;
          }
          txid+=4;
        }
      }
  finally {
        qjm.close();
      }
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.security.token.block.TestBlockToken </h4><pre class="type-9 type-13 type-11 type-2 type-7 type-15 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that fast repeated invocations of createClientDatanodeProtocolProxy
 * will not end up using up thousands of sockets. This is a regression test
 * for HDFS-1965.
 */
@Test public void testBlockTokenRpcLeak() throws Exception {
  Configuration conf=new Configuration();
  conf.set(HADOOP_SECURITY_AUTHENTICATION,"kerberos");
  UserGroupInformation.setConfiguration(conf);
  Assume.assumeTrue(FD_DIR.exists());
  BlockTokenSecretManager sm=new BlockTokenSecretManager(blockKeyUpdateInterval,blockTokenLifetime,0,"fake-pool",null);
  Token<BlockTokenIdentifier> token=sm.generateToken(block3,EnumSet.allOf(BlockTokenSecretManager.AccessMode.class));
  final Server server=createMockDatanode(sm,token,conf);
  server.start();
  final InetSocketAddress addr=NetUtils.getConnectAddress(server);
  DatanodeID fakeDnId=DFSTestUtil.getLocalDatanodeID(addr.getPort());
  ExtendedBlock b=new ExtendedBlock("fake-pool",new Block(12345L));
  LocatedBlock fakeBlock=new LocatedBlock(b,new DatanodeInfo[0]);
  fakeBlock.setBlockToken(token);
  ClientDatanodeProtocol proxyToNoWhere=RPC.getProxy(ClientDatanodeProtocol.class,ClientDatanodeProtocol.versionID,new InetSocketAddress("1.1.1.1",1),UserGroupInformation.createRemoteUser("junk"),conf,NetUtils.getDefaultSocketFactory(conf));
  ClientDatanodeProtocol proxy=null;
  int fdsAtStart=countOpenFileDescriptors();
  try {
    long endTime=Time.now() + 3000;
    while (Time.now() < endTime) {
      proxy=DFSUtil.createClientDatanodeProtocolProxy(fakeDnId,conf,1000,false,fakeBlock);
      assertEquals(block3.getBlockId(),proxy.getReplicaVisibleLength(block3));
      if (proxy != null) {
        RPC.stopProxy(proxy);
      }
      LOG.info("Num open fds:" + countOpenFileDescriptors());
    }
    int fdsAtEnd=countOpenFileDescriptors();
    if (fdsAtEnd - fdsAtStart > 50) {
      fail("Leaked " + (fdsAtEnd - fdsAtStart) + " fds!");
    }
  }
  finally {
    server.stop();
  }
  RPC.stopProxy(proxyToNoWhere);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestBlockInfo </h4><pre class="type-9 type-13 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBlockListMoveToHead() throws Exception {
  LOG.info("BlockInfo moveToHead tests...");
  final int MAX_BLOCKS=10;
  DatanodeStorageInfo dd=DFSTestUtil.createDatanodeStorageInfo("s1","1.1.1.1");
  ArrayList<Block> blockList=new ArrayList<Block>(MAX_BLOCKS);
  ArrayList<BlockInfo> blockInfoList=new ArrayList<BlockInfo>();
  int headIndex;
  int curIndex;
  LOG.info("Building block list...");
  for (int i=0; i < MAX_BLOCKS; i++) {
    blockList.add(new Block(i,0,GenerationStamp.LAST_RESERVED_STAMP));
    blockInfoList.add(new BlockInfo(blockList.get(i),3));
    dd.addBlock(blockInfoList.get(i));
    assertEquals("Find datanode should be 0",0,blockInfoList.get(i).findStorageInfo(dd));
  }
  LOG.info("Checking list length...");
  assertEquals("Length should be MAX_BLOCK",MAX_BLOCKS,dd.numBlocks());
  Iterator<BlockInfo> it=dd.getBlockIterator();
  int len=0;
  while (it.hasNext()) {
    it.next();
    len++;
  }
  assertEquals("There should be MAX_BLOCK blockInfo's",MAX_BLOCKS,len);
  headIndex=dd.getBlockListHeadForTesting().findStorageInfo(dd);
  LOG.info("Moving each block to the head of the list...");
  for (int i=0; i < MAX_BLOCKS; i++) {
    curIndex=blockInfoList.get(i).findStorageInfo(dd);
    headIndex=dd.moveBlockToHead(blockInfoList.get(i),curIndex,headIndex);
    assertEquals("Block should be at the head of the list now.",blockInfoList.get(i),dd.getBlockListHeadForTesting());
  }
  LOG.info("Moving head to the head...");
  BlockInfo temp=dd.getBlockListHeadForTesting();
  curIndex=0;
  headIndex=0;
  dd.moveBlockToHead(temp,curIndex,headIndex);
  assertEquals("Moving head to the head of the list shopuld not change the list",temp,dd.getBlockListHeadForTesting());
  LOG.info("Checking elements of the list...");
  temp=dd.getBlockListHeadForTesting();
  assertNotNull("Head should not be null",temp);
  int c=MAX_BLOCKS - 1;
  while (temp != null) {
    assertEquals("Expected element is not on the list",blockInfoList.get(c--),temp);
    temp=temp.getNext(0);
  }
  LOG.info("Moving random blocks to the head of the list...");
  headIndex=dd.getBlockListHeadForTesting().findStorageInfo(dd);
  Random rand=new Random();
  for (int i=0; i < MAX_BLOCKS; i++) {
    int j=rand.nextInt(MAX_BLOCKS);
    curIndex=blockInfoList.get(j).findStorageInfo(dd);
    headIndex=dd.moveBlockToHead(blockInfoList.get(j),curIndex,headIndex);
    assertEquals("Block should be at the head of the list now.",blockInfoList.get(j),dd.getBlockListHeadForTesting());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestBlocksWithNotEnoughRacks </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCorruptBlockRereplicatedAcrossRacks() throws Exception {
  Configuration conf=getConf();
  short REPLICATION_FACTOR=2;
  int fileLen=512;
  final Path filePath=new Path("/testFile");
  String racks[]={"/rack1","/rack1","/rack2","/rack2"};
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(racks.length).racks(racks).build();
  final FSNamesystem ns=cluster.getNameNode().getNamesystem();
  try {
    final FileSystem fs=cluster.getFileSystem();
    DFSTestUtil.createFile(fs,filePath,fileLen,REPLICATION_FACTOR,1L);
    final String fileContent=DFSTestUtil.readFile(fs,filePath);
    ExtendedBlock b=DFSTestUtil.getFirstBlock(fs,filePath);
    DFSTestUtil.waitForReplication(cluster,b,2,REPLICATION_FACTOR,0);
    int dnToCorrupt=DFSTestUtil.firstDnWithBlock(cluster,b);
    assertTrue(MiniDFSCluster.corruptReplica(dnToCorrupt,b));
    cluster.restartDataNode(dnToCorrupt);
    DFSTestUtil.waitCorruptReplicas(fs,ns,filePath,b,1);
    DFSTestUtil.waitForReplication(cluster,b,2,REPLICATION_FACTOR,0);
    for (int i=0; i < racks.length; i++) {
      String blockContent=cluster.readBlockOnDataNode(i,b);
      if (blockContent != null && i != dnToCorrupt) {
        assertEquals("Corrupt replica",fileContent,blockContent);
      }
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestDatanodeManager </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * This test sends a random sequence of node registrations and node removals
 * to the DatanodeManager (of nodes with different IDs and versions), and
 * checks that the DatanodeManager keeps a correct count of different software
 * versions at all times.
 */
@Test public void testNumVersionsReportedCorrect() throws IOException {
  FSNamesystem fsn=Mockito.mock(FSNamesystem.class);
  Mockito.when(fsn.hasWriteLock()).thenReturn(true);
  DatanodeManager dm=new DatanodeManager(Mockito.mock(BlockManager.class),fsn,new Configuration());
  Random rng=new Random();
  int seed=rng.nextInt();
  rng=new Random(seed);
  LOG.info("Using seed " + seed + " for testing");
  HashMap<String,DatanodeRegistration> sIdToDnReg=new HashMap<String,DatanodeRegistration>();
  for (int i=0; i < NUM_ITERATIONS; ++i) {
    if (rng.nextBoolean() && i % 3 == 0 && sIdToDnReg.size() != 0) {
      int randomIndex=rng.nextInt() % sIdToDnReg.size();
      Iterator<Map.Entry<String,DatanodeRegistration>> it=sIdToDnReg.entrySet().iterator();
      for (int j=0; j < randomIndex - 1; ++j) {
        it.next();
      }
      DatanodeRegistration toRemove=it.next().getValue();
      LOG.info("Removing node " + toRemove.getDatanodeUuid() + " ip "+ toRemove.getXferAddr()+ " version : "+ toRemove.getSoftwareVersion());
      dm.removeDatanode(toRemove);
      it.remove();
    }
 else {
      String storageID="someStorageID" + rng.nextInt(5000);
      DatanodeRegistration dr=Mockito.mock(DatanodeRegistration.class);
      Mockito.when(dr.getDatanodeUuid()).thenReturn(storageID);
      if (sIdToDnReg.containsKey(storageID)) {
        dr=sIdToDnReg.get(storageID);
        if (rng.nextBoolean()) {
          dr.setIpAddr(dr.getIpAddr() + "newIP");
        }
      }
 else {
        String ip="someIP" + storageID;
        Mockito.when(dr.getIpAddr()).thenReturn(ip);
        Mockito.when(dr.getXferAddr()).thenReturn(ip + ":9000");
        Mockito.when(dr.getXferPort()).thenReturn(9000);
      }
      Mockito.when(dr.getSoftwareVersion()).thenReturn("version" + rng.nextInt(5));
      LOG.info("Registering node storageID: " + dr.getDatanodeUuid() + ", version: "+ dr.getSoftwareVersion()+ ", IP address: "+ dr.getXferAddr());
      dm.registerDatanode(dr);
      sIdToDnReg.put(storageID,dr);
    }
    Map<String,Integer> mapToCheck=dm.getDatanodesSoftwareVersions();
    for (    Entry<String,DatanodeRegistration> it : sIdToDnReg.entrySet()) {
      String ver=it.getValue().getSoftwareVersion();
      if (!mapToCheck.containsKey(ver)) {
        throw new AssertionError("The correct number of datanodes of a " + "version was not found on iteration " + i);
      }
      mapToCheck.put(ver,mapToCheck.get(ver) - 1);
      if (mapToCheck.get(ver) == 0) {
        mapToCheck.remove(ver);
      }
    }
    for (    Entry<String,Integer> entry : mapToCheck.entrySet()) {
      LOG.info("Still in map: " + entry.getKey() + " has "+ entry.getValue());
    }
    assertEquals("The map of version counts returned by DatanodeManager was" + " not what it was expected to be on iteration " + i,0,mapToCheck.size());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestHost2NodesMap </h4><pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testContains() throws Exception {
  DatanodeDescriptor nodeNotInMap=DFSTestUtil.getDatanodeDescriptor("3.3.3.3","/d1/r4");
  for (int i=0; i < dataNodes.length; i++) {
    assertTrue(map.contains(dataNodes[i]));
  }
  assertFalse(map.contains(null));
  assertFalse(map.contains(nodeNotInMap));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestOverReplicatedBlocks </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test processOverReplicatedBlock can handle corrupt replicas fine.
 * It make sure that it won't treat corrupt replicas as valid ones 
 * thus prevents NN deleting valid replicas but keeping
 * corrupt ones.
 */
@Test public void testProcesOverReplicateBlock() throws Exception {
  Configuration conf=new HdfsConfiguration();
  conf.setLong(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY,1000L);
  conf.set(DFSConfigKeys.DFS_NAMENODE_REPLICATION_PENDING_TIMEOUT_SEC_KEY,Integer.toString(2));
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
  FileSystem fs=cluster.getFileSystem();
  try {
    final Path fileName=new Path("/foo1");
    DFSTestUtil.createFile(fs,fileName,2,(short)3,0L);
    DFSTestUtil.waitReplication(fs,fileName,(short)3);
    ExtendedBlock block=DFSTestUtil.getFirstBlock(fs,fileName);
    assertTrue(TestDatanodeBlockScanner.corruptReplica(block,0));
    DataNodeProperties dnProps=cluster.stopDataNode(0);
    File scanLog=new File(MiniDFSCluster.getFinalizedDir(cluster.getInstanceStorageDir(0,0),cluster.getNamesystem().getBlockPoolId()).getParent().toString() + "/../dncp_block_verification.log.prev");
    for (int i=0; !scanLog.delete(); i++) {
      assertTrue("Could not delete log file in one minute",i < 60);
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException ignored) {
      }
    }
    cluster.restartDataNode(dnProps);
    DFSTestUtil.waitReplication(fs,fileName,(short)2);
    String blockPoolId=cluster.getNamesystem().getBlockPoolId();
    final DatanodeID corruptDataNode=DataNodeTestUtils.getDNRegistrationForBP(cluster.getDataNodes().get(2),blockPoolId);
    final FSNamesystem namesystem=cluster.getNamesystem();
    final BlockManager bm=namesystem.getBlockManager();
    final HeartbeatManager hm=bm.getDatanodeManager().getHeartbeatManager();
    try {
      namesystem.writeLock();
synchronized (hm) {
        String corruptMachineName=corruptDataNode.getXferAddr();
        for (        DatanodeDescriptor datanode : hm.getDatanodes()) {
          if (!corruptMachineName.equals(datanode.getXferAddr())) {
            datanode.getStorageInfos()[0].setUtilizationForTesting(100L,100L,0,100L);
            datanode.updateHeartbeat(BlockManagerTestUtil.getStorageReportsForDatanode(datanode),0L,0L,0,0);
          }
        }
        NameNodeAdapter.setReplication(namesystem,fileName.toString(),(short)1);
        assertEquals(1,bm.countNodes(block.getLocalBlock()).liveReplicas());
      }
    }
  finally {
      namesystem.writeUnlock();
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestPendingReplication </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPendingReplication(){
  PendingReplicationBlocks pendingReplications;
  pendingReplications=new PendingReplicationBlocks(TIMEOUT * 1000);
  pendingReplications.start();
  DatanodeStorageInfo[] storages=DFSTestUtil.createDatanodeStorageInfos(10);
  for (int i=0; i < storages.length; i++) {
    Block block=new Block(i,i,0);
    DatanodeStorageInfo[] targets=new DatanodeStorageInfo[i];
    System.arraycopy(storages,0,targets,0,i);
    pendingReplications.increment(block,DatanodeStorageInfo.toDatanodeDescriptors(targets));
  }
  assertEquals("Size of pendingReplications ",10,pendingReplications.size());
  Block blk=new Block(8,8,0);
  pendingReplications.decrement(blk,storages[7].getDatanodeDescriptor());
  assertEquals("pendingReplications.getNumReplicas ",7,pendingReplications.getNumReplicas(blk));
  for (int i=0; i < 7; i++) {
    pendingReplications.decrement(blk,storages[i].getDatanodeDescriptor());
  }
  assertTrue(pendingReplications.size() == 9);
  pendingReplications.increment(blk,DatanodeStorageInfo.toDatanodeDescriptors(DFSTestUtil.createDatanodeStorageInfos(8)));
  assertTrue(pendingReplications.size() == 10);
  for (int i=0; i < 10; i++) {
    Block block=new Block(i,i,0);
    int numReplicas=pendingReplications.getNumReplicas(block);
    assertTrue(numReplicas == i);
  }
  assertTrue(pendingReplications.getTimedOutBlocks() == null);
  try {
    Thread.sleep(1000);
  }
 catch (  Exception e) {
  }
  for (int i=10; i < 15; i++) {
    Block block=new Block(i,i,0);
    pendingReplications.increment(block,DatanodeStorageInfo.toDatanodeDescriptors(DFSTestUtil.createDatanodeStorageInfos(i)));
  }
  assertTrue(pendingReplications.size() == 15);
  int loop=0;
  while (pendingReplications.size() > 0) {
    try {
      Thread.sleep(1000);
    }
 catch (    Exception e) {
    }
    loop++;
  }
  System.out.println("Had to wait for " + loop + " seconds for the lot to timeout");
  assertEquals("Size of pendingReplications ",0,pendingReplications.size());
  Block[] timedOut=pendingReplications.getTimedOutBlocks();
  assertTrue(timedOut != null && timedOut.length == 15);
  for (int i=0; i < timedOut.length; i++) {
    assertTrue(timedOut[i].getBlockId() < 15);
  }
  pendingReplications.stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicy </h4><pre class="type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this testcase, client is dataNodes[0], but dataNodes[0] is not qualified
 * to be chosen. So the 1st replica should be placed on dataNodes[1], 
 * the 2nd replica should be placed on a different rack,
 * the 3rd replica should be placed on the same rack as the 2nd replica,
 * and the rest should be placed on the third rack.
 * @throws Exception
 */
@Test public void testChooseTarget3() throws Exception {
  updateHeartbeatWithUsage(dataNodes[0],2 * HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,(HdfsConstants.MIN_BLOCKS_FOR_WRITE - 1) * BLOCK_SIZE,0L,0L,0L,0,0);
  DatanodeStorageInfo[] targets;
  targets=chooseTarget(0);
  assertEquals(targets.length,0);
  targets=chooseTarget(1);
  assertEquals(targets.length,1);
  assertEquals(storages[1],targets[0]);
  targets=chooseTarget(2);
  assertEquals(targets.length,2);
  assertEquals(storages[1],targets[0]);
  assertFalse(isOnSameRack(targets[0],targets[1]));
  targets=chooseTarget(3);
  assertEquals(targets.length,3);
  assertEquals(storages[1],targets[0]);
  assertTrue(isOnSameRack(targets[1],targets[2]));
  assertFalse(isOnSameRack(targets[0],targets[1]));
  targets=chooseTarget(4);
  assertEquals(targets.length,4);
  assertEquals(storages[1],targets[0]);
  for (int i=1; i < 4; i++) {
    assertFalse(isOnSameRack(targets[0],targets[i]));
  }
  assertTrue(isOnSameRack(targets[1],targets[2]) || isOnSameRack(targets[2],targets[3]));
  assertFalse(isOnSameRack(targets[1],targets[3]));
  updateHeartbeatWithUsage(dataNodes[0],2 * HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,0L,0L,0,0);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this testcase, client is dataNodes[0], but none of the nodes on rack 1
 * is qualified to be chosen. So the 1st replica should be placed on either
 * rack 2 or rack 3. 
 * the 2nd replica should be placed on a different rack,
 * the 3rd replica should be placed on the same rack as the 1st replica,
 * @throws Exception
 */
@Test public void testChoooseTarget4() throws Exception {
  for (int i=0; i < 2; i++) {
    updateHeartbeatWithUsage(dataNodes[i],2 * HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,(HdfsConstants.MIN_BLOCKS_FOR_WRITE - 1) * BLOCK_SIZE,0L,0L,0L,0,0);
  }
  DatanodeStorageInfo[] targets;
  targets=chooseTarget(0);
  assertEquals(targets.length,0);
  targets=chooseTarget(1);
  assertEquals(targets.length,1);
  assertFalse(isOnSameRack(targets[0],dataNodes[0]));
  targets=chooseTarget(2);
  assertEquals(targets.length,2);
  assertFalse(isOnSameRack(targets[0],dataNodes[0]));
  assertFalse(isOnSameRack(targets[0],targets[1]));
  targets=chooseTarget(3);
  assertEquals(targets.length,3);
  for (int i=0; i < 3; i++) {
    assertFalse(isOnSameRack(targets[i],dataNodes[0]));
  }
  assertTrue(isOnSameRack(targets[0],targets[1]) || isOnSameRack(targets[1],targets[2]));
  assertFalse(isOnSameRack(targets[0],targets[2]));
  for (int i=0; i < 2; i++) {
    updateHeartbeatWithUsage(dataNodes[i],2 * HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,0L,0L,0,0);
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this testcase, client is dataNodes[0], but the dataNodes[1] is
 * not allowed to be chosen. So the 1st replica should be
 * placed on dataNodes[0], the 2nd replica should be placed on a different
 * rack, the 3rd should be on same rack as the 2nd replica, and the rest
 * should be placed on a third rack.
 * @throws Exception
 */
@Test public void testChooseTarget2() throws Exception {
  Set<Node> excludedNodes;
  DatanodeStorageInfo[] targets;
  List<DatanodeStorageInfo> chosenNodes=new ArrayList<DatanodeStorageInfo>();
  excludedNodes=new HashSet<Node>();
  excludedNodes.add(dataNodes[1]);
  targets=chooseTarget(0,chosenNodes,excludedNodes);
  assertEquals(targets.length,0);
  excludedNodes.clear();
  chosenNodes.clear();
  excludedNodes.add(dataNodes[1]);
  targets=chooseTarget(1,chosenNodes,excludedNodes);
  assertEquals(targets.length,1);
  assertEquals(storages[0],targets[0]);
  excludedNodes.clear();
  chosenNodes.clear();
  excludedNodes.add(dataNodes[1]);
  targets=chooseTarget(2,chosenNodes,excludedNodes);
  assertEquals(targets.length,2);
  assertEquals(storages[0],targets[0]);
  assertFalse(isOnSameRack(targets[0],targets[1]));
  excludedNodes.clear();
  chosenNodes.clear();
  excludedNodes.add(dataNodes[1]);
  targets=chooseTarget(3,chosenNodes,excludedNodes);
  assertEquals(targets.length,3);
  assertEquals(storages[0],targets[0]);
  assertFalse(isOnSameRack(targets[0],targets[1]));
  assertTrue(isOnSameRack(targets[1],targets[2]));
  excludedNodes.clear();
  chosenNodes.clear();
  excludedNodes.add(dataNodes[1]);
  targets=chooseTarget(4,chosenNodes,excludedNodes);
  assertEquals(targets.length,4);
  assertEquals(storages[0],targets[0]);
  for (int i=1; i < 4; i++) {
    assertFalse(isOnSameRack(targets[0],targets[i]));
  }
  assertTrue(isOnSameRack(targets[1],targets[2]) || isOnSameRack(targets[2],targets[3]));
  assertFalse(isOnSameRack(targets[1],targets[3]));
  excludedNodes.clear();
  chosenNodes.clear();
  excludedNodes.add(dataNodes[1]);
  chosenNodes.add(storages[2]);
  targets=replicator.chooseTarget(filename,1,dataNodes[0],chosenNodes,true,excludedNodes,BLOCK_SIZE,StorageType.DEFAULT);
  System.out.println("targets=" + Arrays.asList(targets));
  assertEquals(2,targets.length);
  int i=0;
  for (; i < targets.length && !storages[2].equals(targets[i]); i++)   ;
  assertTrue(i < targets.length);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicyConsiderLoad </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that chooseTarget with considerLoad set to true correctly calculates
 * load with decommissioned nodes.
 */
@Test public void testChooseTargetWithDecomNodes() throws IOException {
  namenode.getNamesystem().writeLock();
  try {
    String blockPoolId=namenode.getNamesystem().getBlockPoolId();
    dnManager.handleHeartbeat(dnrList.get(3),BlockManagerTestUtil.getStorageReportsForDatanode(dataNodes[3]),blockPoolId,dataNodes[3].getCacheCapacity(),dataNodes[3].getCacheRemaining(),2,0,0);
    dnManager.handleHeartbeat(dnrList.get(4),BlockManagerTestUtil.getStorageReportsForDatanode(dataNodes[4]),blockPoolId,dataNodes[4].getCacheCapacity(),dataNodes[4].getCacheRemaining(),4,0,0);
    dnManager.handleHeartbeat(dnrList.get(5),BlockManagerTestUtil.getStorageReportsForDatanode(dataNodes[5]),blockPoolId,dataNodes[5].getCacheCapacity(),dataNodes[5].getCacheRemaining(),4,0,0);
    final int load=2 + 4 + 4;
    FSNamesystem fsn=namenode.getNamesystem();
    assertEquals((double)load / 6,fsn.getInServiceXceiverAverage(),EPSILON);
    for (int i=0; i < 3; i++) {
      DatanodeDescriptor d=dnManager.getDatanode(dnrList.get(i));
      dnManager.startDecommission(d);
      d.setDecommissioned();
    }
    assertEquals((double)load / 3,fsn.getInServiceXceiverAverage(),EPSILON);
    DatanodeStorageInfo[] targets=namenode.getNamesystem().getBlockManager().getBlockPlacementPolicy().chooseTarget("testFile.txt",3,dataNodes[0],new ArrayList<DatanodeStorageInfo>(),false,null,1024,StorageType.DEFAULT);
    assertEquals(3,targets.length);
    Set<DatanodeStorageInfo> targetSet=new HashSet<DatanodeStorageInfo>(Arrays.asList(targets));
    for (int i=3; i < storages.length; i++) {
      assertTrue(targetSet.contains(storages[i]));
    }
  }
  finally {
    dataNodes[0].stopDecommission();
    dataNodes[1].stopDecommission();
    dataNodes[2].stopDecommission();
    namenode.getNamesystem().writeUnlock();
  }
  NameNode.LOG.info("Done working on it");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicyWithNodeGroup </h4><pre class="type-9 type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChooseTargetWithDependencies() throws Exception {
  for (int i=0; i < NUM_OF_DATANODES; i++) {
    cluster.remove(dataNodes[i]);
  }
  for (int i=0; i < NUM_OF_DATANODES_MORE_TARGETS; i++) {
    DatanodeDescriptor node=dataNodesInMoreTargetsCase[i];
    if (cluster.contains(node)) {
      cluster.remove(node);
    }
  }
  Host2NodesMap host2DatanodeMap=namenode.getNamesystem().getBlockManager().getDatanodeManager().getHost2DatanodeMap();
  for (int i=0; i < NUM_OF_DATANODES_FOR_DEPENDENCIES; i++) {
    cluster.add(dataNodesForDependencies[i]);
    host2DatanodeMap.add(dataNodesForDependencies[i]);
  }
  dataNodesForDependencies[1].addDependentHostName(dataNodesForDependencies[2].getHostName());
  dataNodesForDependencies[2].addDependentHostName(dataNodesForDependencies[1].getHostName());
  dataNodesForDependencies[3].addDependentHostName(dataNodesForDependencies[4].getHostName());
  dataNodesForDependencies[4].addDependentHostName(dataNodesForDependencies[3].getHostName());
  for (int i=0; i < NUM_OF_DATANODES_FOR_DEPENDENCIES; i++) {
    updateHeartbeatWithUsage(dataNodesForDependencies[i],2 * HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,2 * HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,0L,0L,0,0);
  }
  List<DatanodeStorageInfo> chosenNodes=new ArrayList<DatanodeStorageInfo>();
  DatanodeStorageInfo[] targets;
  Set<Node> excludedNodes=new HashSet<Node>();
  excludedNodes.add(dataNodesForDependencies[5]);
  targets=chooseTarget(3,dataNodesForDependencies[1],chosenNodes,excludedNodes);
  assertEquals(targets.length,2);
  assertEquals(targets[0],storagesForDependencies[1]);
  assertTrue(targets[1].equals(storagesForDependencies[3]) || targets[1].equals(storagesForDependencies[4]));
  assertEquals(excludedNodes.size(),NUM_OF_DATANODES_FOR_DEPENDENCIES);
  for (int i=0; i < NUM_OF_DATANODES_FOR_DEPENDENCIES; i++) {
    assertTrue(excludedNodes.contains(dataNodesForDependencies[i]));
  }
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this testcase, client is dataNodes[0], but the dataNodes[1] is
 * not allowed to be chosen. So the 1st replica should be
 * placed on dataNodes[0], the 2nd replica should be placed on a different
 * rack, the 3rd should be on same rack as the 2nd replica but in different
 * node group, and the rest should be placed on a third rack.
 * @throws Exception
 */
@Test public void testChooseTarget2() throws Exception {
  DatanodeStorageInfo[] targets;
  BlockPlacementPolicyDefault repl=(BlockPlacementPolicyDefault)replicator;
  List<DatanodeStorageInfo> chosenNodes=new ArrayList<DatanodeStorageInfo>();
  Set<Node> excludedNodes=new HashSet<Node>();
  excludedNodes.add(dataNodes[1]);
  targets=repl.chooseTarget(filename,4,dataNodes[0],chosenNodes,false,excludedNodes,BLOCK_SIZE,StorageType.DEFAULT);
  assertEquals(targets.length,4);
  assertEquals(storages[0],targets[0]);
  assertTrue(cluster.isNodeGroupAware());
  for (int i=1; i < 4; i++) {
    assertFalse(isOnSameNodeGroup(targets[0],targets[i]));
  }
  assertTrue(isOnSameRack(targets[1],targets[2]) || isOnSameRack(targets[2],targets[3]));
  assertFalse(isOnSameRack(targets[1],targets[3]));
  excludedNodes.clear();
  chosenNodes.clear();
  excludedNodes.add(dataNodes[1]);
  chosenNodes.add(storages[2]);
  targets=repl.chooseTarget(filename,1,dataNodes[0],chosenNodes,true,excludedNodes,BLOCK_SIZE,StorageType.DEFAULT);
  System.out.println("targets=" + Arrays.asList(targets));
  assertEquals(2,targets.length);
  int i=0;
  for (; i < targets.length && !storages[2].equals(targets[i]); i++)   ;
  assertTrue(i < targets.length);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this testcase, client is dataNodes[0], but none of the nodes on rack 1
 * is qualified to be chosen. So the 1st replica should be placed on either
 * rack 2 or rack 3. 
 * the 2nd replica should be placed on a different rack,
 * the 3rd replica should be placed on the same rack as the 1st replica, but 
 * in different node group.
 * @throws Exception
 */
@Test public void testChooseTarget4() throws Exception {
  for (int i=0; i < 3; i++) {
    updateHeartbeatWithUsage(dataNodes[i],2 * HdfsConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,(HdfsConstants.MIN_BLOCKS_FOR_WRITE - 1) * BLOCK_SIZE,0L,0L,0L,0,0);
  }
  DatanodeStorageInfo[] targets;
  targets=chooseTarget(0);
  assertEquals(targets.length,0);
  targets=chooseTarget(1);
  assertEquals(targets.length,1);
  assertFalse(isOnSameRack(dataNodes[0],targets[0]));
  targets=chooseTarget(2);
  assertEquals(targets.length,2);
  assertFalse(isOnSameRack(dataNodes[0],targets[0]));
  assertFalse(isOnSameRack(targets[0],targets[1]));
  targets=chooseTarget(3);
  assertEquals(targets.length,3);
  for (int i=0; i < 3; i++) {
    assertFalse(isOnSameRack(dataNodes[0],targets[i]));
  }
  verifyNoTwoTargetsOnSameNodeGroup(targets);
  assertTrue(isOnSameRack(targets[0],targets[1]) || isOnSameRack(targets[1],targets[2]));
  assertFalse(isOnSameRack(targets[0],targets[2]));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.datanode.BlockReportTestBase </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test write a file, verifies and closes it. Then the length of the blocks
 * are messed up and BlockReport is forced.
 * The modification of blocks' length has to be ignored
 * @throws java.io.IOException on an error
 */
@Test(timeout=300000) public void blockReport_01() throws IOException {
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  Path filePath=new Path("/" + METHOD_NAME + ".dat");
  ArrayList<Block> blocks=prepareForRide(filePath,METHOD_NAME,FILE_SIZE);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Number of blocks allocated " + blocks.size());
  }
  long[] oldLengths=new long[blocks.size()];
  int tempLen;
  for (int i=0; i < blocks.size(); i++) {
    Block b=blocks.get(i);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Block " + b.getBlockName() + " before\t"+ "Size "+ b.getNumBytes());
    }
    oldLengths[i]=b.getNumBytes();
    if (LOG.isDebugEnabled()) {
      LOG.debug("Setting new length");
    }
    tempLen=rand.nextInt(BLOCK_SIZE);
    b.set(b.getBlockId(),tempLen,b.getGenerationStamp());
    if (LOG.isDebugEnabled()) {
      LOG.debug("Block " + b.getBlockName() + " after\t "+ "Size "+ b.getNumBytes());
    }
  }
  DataNode dn=cluster.getDataNodes().get(DN_N0);
  String poolId=cluster.getNamesystem().getBlockPoolId();
  DatanodeRegistration dnR=dn.getDNRegistrationForBP(poolId);
  StorageBlockReport[] reports=getBlockReports(dn,poolId,false,false);
  sendBlockReports(dnR,poolId,reports);
  List<LocatedBlock> blocksAfterReport=DFSTestUtil.getAllBlocks(fs.open(filePath));
  if (LOG.isDebugEnabled()) {
    LOG.debug("After mods: Number of blocks allocated " + blocksAfterReport.size());
  }
  for (int i=0; i < blocksAfterReport.size(); i++) {
    ExtendedBlock b=blocksAfterReport.get(i).getBlock();
    assertEquals("Length of " + i + "th block is incorrect",oldLengths[i],b.getNumBytes());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.datanode.TestRefreshNamenodes </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRefreshNamenodes() throws IOException {
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=null;
  try {
    MiniDFSNNTopology topology=new MiniDFSNNTopology().addNameservice(new NSConf("ns1").addNN(new NNConf(null).setIpcPort(nnPort1))).setFederation(true);
    cluster=new MiniDFSCluster.Builder(conf).nnTopology(topology).build();
    DataNode dn=cluster.getDataNodes().get(0);
    assertEquals(1,dn.getAllBpOs().length);
    cluster.addNameNode(conf,nnPort2);
    assertEquals(2,dn.getAllBpOs().length);
    cluster.addNameNode(conf,nnPort3);
    assertEquals(3,dn.getAllBpOs().length);
    cluster.addNameNode(conf,nnPort4);
    Set<InetSocketAddress> nnAddrsFromCluster=Sets.newHashSet();
    for (int i=0; i < 4; i++) {
      assertTrue(nnAddrsFromCluster.add(cluster.getNameNode(i).getNameNodeAddress()));
    }
    Set<InetSocketAddress> nnAddrsFromDN=Sets.newHashSet();
    for (    BPOfferService bpos : dn.getAllBpOs()) {
      for (      BPServiceActor bpsa : bpos.getBPServiceActors()) {
        assertTrue(nnAddrsFromDN.add(bpsa.getNNSocketAddress()));
      }
    }
    assertEquals("",Joiner.on(",").join(Sets.symmetricDifference(nnAddrsFromCluster,nnAddrsFromDN)));
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.datanode.TestSimulatedFSDataset </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWriteRead() throws IOException {
  final SimulatedFSDataset fsdataset=getSimulatedFSDataset();
  addSomeBlocks(fsdataset);
  for (int i=1; i <= NUMBLOCKS; ++i) {
    ExtendedBlock b=new ExtendedBlock(bpid,i,0,0);
    assertTrue(fsdataset.isValidBlock(b));
    assertEquals(blockIdToLen(i),fsdataset.getLength(b));
    checkBlockDataAndSize(fsdataset,b,blockIdToLen(i));
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidate() throws IOException {
  final SimulatedFSDataset fsdataset=getSimulatedFSDataset();
  int bytesAdded=addSomeBlocks(fsdataset);
  Block[] deleteBlocks=new Block[2];
  deleteBlocks[0]=new Block(1,0,0);
  deleteBlocks[1]=new Block(2,0,0);
  fsdataset.invalidate(bpid,deleteBlocks);
  checkInvalidBlock(new ExtendedBlock(bpid,deleteBlocks[0]));
  checkInvalidBlock(new ExtendedBlock(bpid,deleteBlocks[1]));
  long sizeDeleted=blockIdToLen(1) + blockIdToLen(2);
  assertEquals(bytesAdded - sizeDeleted,fsdataset.getDfsUsed());
  assertEquals(fsdataset.getCapacity() - bytesAdded + sizeDeleted,fsdataset.getRemaining());
  for (int i=3; i <= NUMBLOCKS; ++i) {
    Block b=new Block(i,0,0);
    assertTrue(fsdataset.isValidBlock(new ExtendedBlock(bpid,b)));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestDatanodeRestart </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRecoverReplicas() throws Exception {
  Configuration conf=new HdfsConfiguration();
  conf.setLong(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,1024L);
  conf.setInt(DFSConfigKeys.DFS_CLIENT_WRITE_PACKET_SIZE_KEY,512);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  cluster.waitActive();
  try {
    FileSystem fs=cluster.getFileSystem();
    for (int i=0; i < 4; i++) {
      Path fileName=new Path("/test" + i);
      DFSTestUtil.createFile(fs,fileName,1,(short)1,0L);
      DFSTestUtil.waitReplication(fs,fileName,(short)1);
    }
    String bpid=cluster.getNamesystem().getBlockPoolId();
    DataNode dn=cluster.getDataNodes().get(0);
    Iterator<ReplicaInfo> replicasItor=dataset(dn).volumeMap.replicas(bpid).iterator();
    ReplicaInfo replica=replicasItor.next();
    createUnlinkTmpFile(replica,true,true);
    createUnlinkTmpFile(replica,false,true);
    replica=replicasItor.next();
    createUnlinkTmpFile(replica,true,false);
    createUnlinkTmpFile(replica,false,false);
    replica=replicasItor.next();
    createUnlinkTmpFile(replica,true,true);
    createUnlinkTmpFile(replica,false,false);
    cluster.restartDataNodes();
    cluster.waitActive();
    dn=cluster.getDataNodes().get(0);
    Collection<ReplicaInfo> replicas=dataset(dn).volumeMap.replicas(bpid);
    Assert.assertEquals(4,replicas.size());
    replicasItor=replicas.iterator();
    while (replicasItor.hasNext()) {
      Assert.assertEquals(ReplicaState.FINALIZED,replicasItor.next().getState());
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestFsDatasetImpl </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddVolumes() throws IOException {
  final int numNewVolumes=3;
  final int numExistingVolumes=dataset.getVolumes().size();
  final int totalVolumes=numNewVolumes + numExistingVolumes;
  List<StorageLocation> newLocations=new ArrayList<StorageLocation>();
  for (int i=0; i < numNewVolumes; i++) {
    String path=BASE_DIR + "/newData" + i;
    newLocations.add(StorageLocation.parse(path));
    when(storage.getStorageDir(numExistingVolumes + i)).thenReturn(new Storage.StorageDirectory(new File(path)));
  }
  when(storage.getNumStorageDirs()).thenReturn(totalVolumes);
  dataset.addVolumes(newLocations);
  assertEquals(totalVolumes,dataset.getVolumes().size());
  for (int i=0; i < numNewVolumes; i++) {
    assertEquals(newLocations.get(i).getFile().getPath(),dataset.getVolumes().get(numExistingVolumes + i).getBasePath());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestBlockUnderConstruction </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test NameNode.getBlockLocations(..) on reading un-closed files.
 */
@Test public void testGetBlockLocations() throws IOException {
  final NamenodeProtocols namenode=cluster.getNameNodeRpc();
  final Path p=new Path(BASE_DIR,"file2.dat");
  final String src=p.toString();
  final FSDataOutputStream out=TestFileCreation.createFile(hdfs,p,3);
  int len=BLOCK_SIZE >>> 1;
  writeFile(p,out,len);
  for (int i=1; i < NUM_BLOCKS; ) {
    final LocatedBlocks lb=namenode.getBlockLocations(src,0,len);
    final List<LocatedBlock> blocks=lb.getLocatedBlocks();
    assertEquals(i,blocks.size());
    final Block b=blocks.get(blocks.size() - 1).getBlock().getLocalBlock();
    assertTrue(b instanceof BlockInfoUnderConstruction);
    if (++i < NUM_BLOCKS) {
      writeFile(p,out,BLOCK_SIZE);
      len+=BLOCK_SIZE;
    }
  }
  out.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestCacheDirectives </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testCacheManagerRestart() throws Exception {
  SecondaryNameNode secondary=null;
  try {
    conf.set(DFSConfigKeys.DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY,"0.0.0.0:0");
    secondary=new SecondaryNameNode(conf);
    final String pool="poolparty";
    String groupName="partygroup";
    FsPermission mode=new FsPermission((short)0777);
    long limit=747;
    dfs.addCachePool(new CachePoolInfo(pool).setGroupName(groupName).setMode(mode).setLimit(limit));
    RemoteIterator<CachePoolEntry> pit=dfs.listCachePools();
    assertTrue("No cache pools found",pit.hasNext());
    CachePoolInfo info=pit.next().getInfo();
    assertEquals(pool,info.getPoolName());
    assertEquals(groupName,info.getGroupName());
    assertEquals(mode,info.getMode());
    assertEquals(limit,(long)info.getLimit());
    assertFalse("Unexpected # of cache pools found",pit.hasNext());
    int numEntries=10;
    String entryPrefix="/party-";
    long prevId=-1;
    final Date expiry=new Date();
    for (int i=0; i < numEntries; i++) {
      prevId=dfs.addCacheDirective(new CacheDirectiveInfo.Builder().setPath(new Path(entryPrefix + i)).setPool(pool).setExpiration(CacheDirectiveInfo.Expiration.newAbsolute(expiry.getTime())).build());
    }
    RemoteIterator<CacheDirectiveEntry> dit=dfs.listCacheDirectives(null);
    for (int i=0; i < numEntries; i++) {
      assertTrue("Unexpected # of cache entries: " + i,dit.hasNext());
      CacheDirectiveInfo cd=dit.next().getInfo();
      assertEquals(i + 1,cd.getId().longValue());
      assertEquals(entryPrefix + i,cd.getPath().toUri().getPath());
      assertEquals(pool,cd.getPool());
    }
    assertFalse("Unexpected # of cache directives found",dit.hasNext());
    secondary.doCheckpoint();
    final String imagePool="imagePool";
    dfs.addCachePool(new CachePoolInfo(imagePool));
    prevId=dfs.addCacheDirective(new CacheDirectiveInfo.Builder().setPath(new Path("/image")).setPool(imagePool).build());
    dfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
    dfs.saveNamespace();
    dfs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
    boolean fetchImage=secondary.doCheckpoint();
    assertTrue("Secondary should have fetched a new fsimage from NameNode",fetchImage);
    dfs.removeCachePool(imagePool);
    cluster.restartNameNode();
    pit=dfs.listCachePools();
    assertTrue("No cache pools found",pit.hasNext());
    info=pit.next().getInfo();
    assertEquals(pool,info.getPoolName());
    assertEquals(pool,info.getPoolName());
    assertEquals(groupName,info.getGroupName());
    assertEquals(mode,info.getMode());
    assertEquals(limit,(long)info.getLimit());
    assertFalse("Unexpected # of cache pools found",pit.hasNext());
    dit=dfs.listCacheDirectives(null);
    for (int i=0; i < numEntries; i++) {
      assertTrue("Unexpected # of cache entries: " + i,dit.hasNext());
      CacheDirectiveInfo cd=dit.next().getInfo();
      assertEquals(i + 1,cd.getId().longValue());
      assertEquals(entryPrefix + i,cd.getPath().toUri().getPath());
      assertEquals(pool,cd.getPool());
      assertEquals(expiry.getTime(),cd.getExpiration().getMillis());
    }
    assertFalse("Unexpected # of cache directives found",dit.hasNext());
    long nextId=dfs.addCacheDirective(new CacheDirectiveInfo.Builder().setPath(new Path("/foobar")).setPool(pool).build());
    assertEquals(prevId + 1,nextId);
  }
  finally {
    if (secondary != null) {
      secondary.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestDecommissioningStatus </h4><pre class="type-13 type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests Decommissioning Status in DFS.
 */
@Test public void testDecommissionStatus() throws IOException, InterruptedException {
  InetSocketAddress addr=new InetSocketAddress("localhost",cluster.getNameNodePort());
  DFSClient client=new DFSClient(addr,conf);
  DatanodeInfo[] info=client.datanodeReport(DatanodeReportType.LIVE);
  assertEquals("Number of Datanodes ",2,info.length);
  DistributedFileSystem fileSys=cluster.getFileSystem();
  DFSAdmin admin=new DFSAdmin(cluster.getConfiguration(0));
  short replicas=2;
  Path file1=new Path("decommission.dat");
  DFSTestUtil.createFile(fileSys,file1,fileSize,fileSize,blockSize,replicas,seed);
  Path file2=new Path("decommission1.dat");
  FSDataOutputStream st1=writeIncompleteFile(fileSys,file2,replicas);
  Thread.sleep(5000);
  FSNamesystem fsn=cluster.getNamesystem();
  final DatanodeManager dm=fsn.getBlockManager().getDatanodeManager();
  for (int iteration=0; iteration < numDatanodes; iteration++) {
    String downnode=decommissionNode(fsn,client,localFileSys,iteration);
    dm.refreshNodes(conf);
    decommissionedNodes.add(downnode);
    Thread.sleep(5000);
    final List<DatanodeDescriptor> decommissioningNodes=dm.getDecommissioningNodes();
    if (iteration == 0) {
      assertEquals(decommissioningNodes.size(),1);
      DatanodeDescriptor decommNode=decommissioningNodes.get(0);
      checkDecommissionStatus(decommNode,4,0,2);
      checkDFSAdminDecommissionStatus(decommissioningNodes.subList(0,1),fileSys,admin);
    }
 else {
      assertEquals(decommissioningNodes.size(),2);
      DatanodeDescriptor decommNode1=decommissioningNodes.get(0);
      DatanodeDescriptor decommNode2=decommissioningNodes.get(1);
      checkDecommissionStatus(decommNode1,4,4,2);
      checkDecommissionStatus(decommNode2,4,4,2);
      checkDFSAdminDecommissionStatus(decommissioningNodes.subList(0,2),fileSys,admin);
    }
  }
  writeConfigFile(localFileSys,excludeFile,null);
  dm.refreshNodes(conf);
  st1.close();
  cleanupFile(fileSys,file1);
  cleanupFile(fileSys,file2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestEditLogRace </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests rolling edit logs while transactions are ongoing.
 */
@Test public void testEditLogRolling() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  FileSystem fileSys=null;
  AtomicReference<Throwable> caughtErr=new AtomicReference<Throwable>();
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATA_NODES).build();
    cluster.waitActive();
    fileSys=cluster.getFileSystem();
    final FSNamesystem namesystem=cluster.getNamesystem();
    FSImage fsimage=namesystem.getFSImage();
    StorageDirectory sd=fsimage.getStorage().getStorageDir(0);
    startTransactionWorkers(namesystem,caughtErr);
    long previousLogTxId=1;
    for (int i=0; i < NUM_ROLLS && caughtErr.get() == null; i++) {
      try {
        Thread.sleep(20);
      }
 catch (      InterruptedException e) {
      }
      LOG.info("Starting roll " + i + ".");
      CheckpointSignature sig=namesystem.rollEditLog();
      long nextLog=sig.curSegmentTxId;
      String logFileName=NNStorage.getFinalizedEditsFileName(previousLogTxId,nextLog - 1);
      previousLogTxId+=verifyEditLogs(namesystem,fsimage,logFileName,previousLogTxId);
      assertEquals(previousLogTxId,nextLog);
      File expectedLog=NNStorage.getInProgressEditsFile(sd,previousLogTxId);
      assertTrue("Expect " + expectedLog + " to exist",expectedLog.exists());
    }
  }
  finally {
    stopTransactionWorkers();
    if (caughtErr.get() != null) {
      throw new RuntimeException(caughtErr.get());
    }
    if (fileSys != null)     fileSys.close();
    if (cluster != null)     cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests saving fs image while transactions are ongoing.
 */
@Test public void testSaveNamespace() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  FileSystem fileSys=null;
  AtomicReference<Throwable> caughtErr=new AtomicReference<Throwable>();
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATA_NODES).build();
    cluster.waitActive();
    fileSys=cluster.getFileSystem();
    final FSNamesystem namesystem=cluster.getNamesystem();
    FSImage fsimage=namesystem.getFSImage();
    FSEditLog editLog=fsimage.getEditLog();
    startTransactionWorkers(namesystem,caughtErr);
    for (int i=0; i < NUM_SAVE_IMAGE && caughtErr.get() == null; i++) {
      try {
        Thread.sleep(20);
      }
 catch (      InterruptedException e) {
      }
      LOG.info("Save " + i + ": entering safe mode");
      namesystem.enterSafeMode(false);
      long logStartTxId=fsimage.getStorage().getMostRecentCheckpointTxId() + 1;
      verifyEditLogs(namesystem,fsimage,NNStorage.getInProgressEditsFileName(logStartTxId),logStartTxId);
      LOG.info("Save " + i + ": saving namespace");
      namesystem.saveNamespace();
      LOG.info("Save " + i + ": leaving safemode");
      long savedImageTxId=fsimage.getStorage().getMostRecentCheckpointTxId();
      verifyEditLogs(namesystem,fsimage,NNStorage.getFinalizedEditsFileName(logStartTxId,savedImageTxId),logStartTxId);
      assertEquals(fsimage.getStorage().getMostRecentCheckpointTxId(),editLog.getLastWrittenTxId() - 1);
      namesystem.leaveSafeMode();
      LOG.info("Save " + i + ": complete");
    }
  }
  finally {
    stopTransactionWorkers();
    if (caughtErr.get() != null) {
      throw new RuntimeException(caughtErr.get());
    }
    if (fileSys != null)     fileSys.close();
    if (cluster != null)     cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestFSDirectory </h4><pre class="type-13 type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testXAttrMultiAddRemoveErrors() throws Exception {
  List<XAttr> existingXAttrs=Lists.newArrayList();
  List<XAttr> toAdd=Lists.newArrayList();
  toAdd.add(generatedXAttrs.get(0));
  toAdd.add(generatedXAttrs.get(1));
  toAdd.add(generatedXAttrs.get(2));
  toAdd.add(generatedXAttrs.get(0));
  try {
    fsdir.setINodeXAttrs(existingXAttrs,toAdd,EnumSet.of(XAttrSetFlag.CREATE));
    fail("Specified the same xattr to be set twice");
  }
 catch (  IOException e) {
    GenericTestUtils.assertExceptionContains("Cannot specify the same " + "XAttr to be set",e);
  }
  toAdd.remove(generatedXAttrs.get(0));
  existingXAttrs.add(generatedXAttrs.get(0));
  try {
    fsdir.setINodeXAttrs(existingXAttrs,toAdd,EnumSet.of(XAttrSetFlag.CREATE));
    fail("Set XAttr that is already set without REPLACE flag");
  }
 catch (  IOException e) {
    GenericTestUtils.assertExceptionContains("already exists",e);
  }
  try {
    fsdir.setINodeXAttrs(existingXAttrs,toAdd,EnumSet.of(XAttrSetFlag.REPLACE));
    fail("Set XAttr that does not exist without the CREATE flag");
  }
 catch (  IOException e) {
    GenericTestUtils.assertExceptionContains("does not exist",e);
  }
  toAdd.remove(generatedXAttrs.get(0));
  List<XAttr> newXAttrs=fsdir.setINodeXAttrs(existingXAttrs,toAdd,EnumSet.of(XAttrSetFlag.CREATE));
  assertEquals("Unexpected toAdd size",2,toAdd.size());
  for (  XAttr x : toAdd) {
    assertTrue("Did not find added XAttr " + x,newXAttrs.contains(x));
  }
  existingXAttrs=newXAttrs;
  toAdd=Lists.newArrayList();
  for (int i=0; i < 3; i++) {
    XAttr xAttr=(new XAttr.Builder()).setNameSpace(XAttr.NameSpace.SYSTEM).setName("a" + i).setValue(new byte[]{(byte)(i * 2)}).build();
    toAdd.add(xAttr);
  }
  newXAttrs=fsdir.setINodeXAttrs(existingXAttrs,toAdd,EnumSet.of(XAttrSetFlag.REPLACE));
  assertEquals("Unexpected number of new XAttrs",3,newXAttrs.size());
  for (int i=0; i < 3; i++) {
    assertArrayEquals("Unexpected XAttr value",new byte[]{(byte)(i * 2)},newXAttrs.get(i).getValue());
  }
  existingXAttrs=newXAttrs;
  toAdd=Lists.newArrayList();
  for (int i=0; i < 4; i++) {
    toAdd.add(generatedXAttrs.get(i));
  }
  newXAttrs=fsdir.setINodeXAttrs(existingXAttrs,toAdd,EnumSet.of(XAttrSetFlag.CREATE,XAttrSetFlag.REPLACE));
  verifyXAttrsPresent(newXAttrs,4);
}

</code></pre>

<br>
<pre class="type-9 type-13 type-11 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Dump the tree, make some changes, and then dump the tree again. 
 */
@Test public void testDumpTree() throws Exception {
  final INode root=fsdir.getINode("/");
  LOG.info("Original tree");
  final StringBuffer b1=root.dumpTreeRecursively();
  System.out.println("b1=" + b1);
  final BufferedReader in=new BufferedReader(new StringReader(b1.toString()));
  String line=in.readLine();
  checkClassName(line);
  for (; (line=in.readLine()) != null; ) {
    line=line.trim();
    if (!line.isEmpty() && !line.contains("snapshot")) {
      assertTrue("line=" + line,line.startsWith(INodeDirectory.DUMPTREE_LAST_ITEM) || line.startsWith(INodeDirectory.DUMPTREE_EXCEPT_LAST_ITEM));
      checkClassName(line);
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test setting and removing multiple xattrs via single operations
 */
@Test(timeout=300000) public void testXAttrMultiSetRemove() throws Exception {
  List<XAttr> existingXAttrs=Lists.newArrayListWithCapacity(0);
  final Random rand=new Random(0xFEEDA);
  int numExpectedXAttrs=0;
  while (numExpectedXAttrs < numGeneratedXAttrs) {
    LOG.info("Currently have " + numExpectedXAttrs + " xattrs");
    final int numToAdd=rand.nextInt(5) + 1;
    List<XAttr> toAdd=Lists.newArrayListWithCapacity(numToAdd);
    for (int i=0; i < numToAdd; i++) {
      if (numExpectedXAttrs >= numGeneratedXAttrs) {
        break;
      }
      toAdd.add(generatedXAttrs.get(numExpectedXAttrs));
      numExpectedXAttrs++;
    }
    LOG.info("Attempting to add " + toAdd.size() + " XAttrs");
    for (int i=0; i < toAdd.size(); i++) {
      LOG.info("Will add XAttr " + toAdd.get(i));
    }
    List<XAttr> newXAttrs=fsdir.setINodeXAttrs(existingXAttrs,toAdd,EnumSet.of(XAttrSetFlag.CREATE));
    verifyXAttrsPresent(newXAttrs,numExpectedXAttrs);
    existingXAttrs=newXAttrs;
  }
  while (numExpectedXAttrs > 0) {
    LOG.info("Currently have " + numExpectedXAttrs + " xattrs");
    final int numToRemove=rand.nextInt(5) + 1;
    List<XAttr> toRemove=Lists.newArrayListWithCapacity(numToRemove);
    for (int i=0; i < numToRemove; i++) {
      if (numExpectedXAttrs == 0) {
        break;
      }
      toRemove.add(generatedXAttrs.get(numExpectedXAttrs - 1));
      numExpectedXAttrs--;
    }
    final int expectedNumToRemove=toRemove.size();
    LOG.info("Attempting to remove " + expectedNumToRemove + " XAttrs");
    List<XAttr> removedXAttrs=Lists.newArrayList();
    List<XAttr> newXAttrs=fsdir.filterINodeXAttrs(existingXAttrs,toRemove,removedXAttrs);
    assertEquals("Unexpected number of removed XAttrs",expectedNumToRemove,removedXAttrs.size());
    verifyXAttrsPresent(newXAttrs,numExpectedXAttrs);
    existingXAttrs=newXAttrs;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestFSEditLogLoader </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFSEditLogOpCodes() throws IOException {
  for (  FSEditLogOpCodes c : FSEditLogOpCodes.values()) {
    final byte code=c.getOpCode();
    assertEquals("c=" + c + ", code="+ code,c,FSEditLogOpCodes.fromByte(code));
  }
  for (int b=0; b < (1 << Byte.SIZE); b++) {
    final byte code=(byte)b;
    assertEquals("b=" + b + ", code="+ code,fromByte(code),FSEditLogOpCodes.fromByte(code));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestFavoredNodesEndToEnd </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=180000) public void testFavoredNodesEndToEnd() throws Exception {
  for (int i=0; i < NUM_FILES; i++) {
    Random rand=new Random(System.currentTimeMillis() + i);
    InetSocketAddress datanode[]=getDatanodes(rand);
    Path p=new Path("/filename" + i);
    FSDataOutputStream out=dfs.create(p,FsPermission.getDefault(),true,4096,(short)3,4096L,null,datanode);
    out.write(SOME_BYTES);
    out.close();
    BlockLocation[] locations=getBlockLocations(p);
    for (    BlockLocation loc : locations) {
      String[] hosts=loc.getNames();
      String[] hosts1=getStringForInetSocketAddrs(datanode);
      assertTrue(compareNodes(hosts,hosts1));
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=180000) public void testWhenSomeNodesAreNotGood() throws Exception {
  final InetSocketAddress addrs[]=new InetSocketAddress[4];
  final String[] hosts=new String[addrs.length];
  for (int i=0; i < addrs.length; i++) {
    addrs[i]=datanodes.get(i).getXferAddress();
    hosts[i]=addrs[i].getAddress().getHostAddress() + ":" + addrs[i].getPort();
  }
  DatanodeInfo d=cluster.getNameNode().getNamesystem().getBlockManager().getDatanodeManager().getDatanodeByXferAddr(addrs[0].getAddress().getHostAddress(),addrs[0].getPort());
  d.setDecommissioned();
  Path p=new Path("/filename-foo-bar-baz");
  final short replication=(short)3;
  FSDataOutputStream out=dfs.create(p,FsPermission.getDefault(),true,4096,replication,4096L,null,addrs);
  out.write(SOME_BYTES);
  out.close();
  d.stopDecommission();
  BlockLocation[] locations=getBlockLocations(p);
  Assert.assertEquals(replication,locations[0].getNames().length);
  ;
  for (int i=0; i < replication; i++) {
    final String loc=locations[0].getNames()[i];
    int j=0;
    for (; j < hosts.length && !loc.equals(hosts[j]); j++)     ;
    Assert.assertTrue("j=" + j,j > 0);
    Assert.assertTrue("loc=" + loc + " not in host list "+ Arrays.asList(hosts)+ ", j="+ j,j < hosts.length);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestFileJournalManager </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Make sure that in-progress streams aren't counted if we don't ask for
 * them.
 */
@Test public void testExcludeInProgressStreams() throws CorruptionException, IOException {
  File f=new File(TestEditLog.TEST_DIR + "/excludeinprogressstreams");
  NNStorage storage=setupEdits(Collections.<URI>singletonList(f.toURI()),10,false);
  StorageDirectory sd=storage.dirIterator(NameNodeDirType.EDITS).next();
  FileJournalManager jm=new FileJournalManager(conf,sd,storage);
  assertEquals(100,getNumberOfTransactions(jm,1,false,false));
  EditLogInputStream elis=getJournalInputStream(jm,90,false);
  try {
    FSEditLogOp lastReadOp=null;
    while ((lastReadOp=elis.readOp()) != null) {
      assertTrue(lastReadOp.getTransactionId() <= 100);
    }
  }
  finally {
    IOUtils.cleanup(LOG,elis);
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Make requests with starting transaction ids which don't match the beginning
 * txid of some log segments.
 * This should succeed.
 */
@Test public void testAskForTransactionsMidfile() throws IOException {
  File f=new File(TestEditLog.TEST_DIR + "/askfortransactionsmidfile");
  NNStorage storage=setupEdits(Collections.<URI>singletonList(f.toURI()),10);
  StorageDirectory sd=storage.dirIterator(NameNodeDirType.EDITS).next();
  FileJournalManager jm=new FileJournalManager(conf,sd,storage);
  final int TOTAL_TXIDS=10 * 11;
  for (int txid=1; txid <= TOTAL_TXIDS; txid++) {
    assertEquals((TOTAL_TXIDS - txid) + 1,getNumberOfTransactions(jm,txid,true,false));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestFsck </h4><pre class="type-9 type-13 type-11 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testFsckMoveAndDelete() throws Exception {
  final int MAX_MOVE_TRIES=5;
  DFSTestUtil util=new DFSTestUtil.Builder().setName("TestFsckMoveAndDelete").setNumFiles(5).build();
  MiniDFSCluster cluster=null;
  FileSystem fs=null;
  try {
    Configuration conf=new HdfsConfiguration();
    conf.setLong(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY,10000L);
    conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY,1);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(4).build();
    String topDir="/srcdat";
    fs=cluster.getFileSystem();
    cluster.waitActive();
    util.createFiles(fs,topDir);
    util.waitReplication(fs,topDir,(short)3);
    String outStr=runFsck(conf,0,true,"/");
    assertTrue(outStr.contains(NamenodeFsck.HEALTHY_STATUS));
    String[] fileNames=util.getFileNames(topDir);
    DFSClient dfsClient=new DFSClient(new InetSocketAddress("localhost",cluster.getNameNodePort()),conf);
    String corruptFileName=fileNames[0];
    ExtendedBlock block=dfsClient.getNamenode().getBlockLocations(corruptFileName,0,Long.MAX_VALUE).get(0).getBlock();
    for (int i=0; i < 4; i++) {
      File blockFile=MiniDFSCluster.getBlockFile(i,block);
      if (blockFile != null && blockFile.exists()) {
        assertTrue(blockFile.delete());
      }
    }
    outStr=runFsck(conf,1,false,"/");
    while (!outStr.contains(NamenodeFsck.CORRUPT_STATUS)) {
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException ignore) {
      }
      outStr=runFsck(conf,1,false,"/");
    }
    for (int i=0; i < MAX_MOVE_TRIES; i++) {
      outStr=runFsck(conf,1,true,"/","-move");
      assertTrue(outStr.contains(NamenodeFsck.CORRUPT_STATUS));
      String[] newFileNames=util.getFileNames(topDir);
      boolean found=false;
      for (      String f : newFileNames) {
        if (f.equals(corruptFileName)) {
          found=true;
          break;
        }
      }
      assertTrue(found);
    }
    outStr=runFsck(conf,1,true,"/","-move","-delete");
    assertTrue(outStr.contains(NamenodeFsck.CORRUPT_STATUS));
    outStr=runFsck(conf,0,true,"/");
    assertTrue(outStr.contains(NamenodeFsck.HEALTHY_STATUS));
    util.cleanup(fs,topDir);
    if (fs != null) {
      try {
        fs.close();
      }
 catch (      Exception e) {
      }
    }
    cluster.shutdown();
  }
  finally {
    if (fs != null) {
      try {
        fs.close();
      }
 catch (      Exception e) {
      }
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-11 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testFsckMove() throws Exception {
  Configuration conf=new HdfsConfiguration();
  final int DFS_BLOCK_SIZE=1024;
  final int NUM_DATANODES=4;
  conf.setLong(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,DFS_BLOCK_SIZE);
  conf.setLong(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY,10000L);
  conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY,1);
  DFSTestUtil util=new DFSTestUtil("TestFsck",5,3,(5 * DFS_BLOCK_SIZE) + (DFS_BLOCK_SIZE - 1),5 * DFS_BLOCK_SIZE);
  MiniDFSCluster cluster=null;
  FileSystem fs=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATANODES).build();
    String topDir="/srcdat";
    fs=cluster.getFileSystem();
    cluster.waitActive();
    util.createFiles(fs,topDir);
    util.waitReplication(fs,topDir,(short)3);
    String outStr=runFsck(conf,0,true,"/");
    assertTrue(outStr.contains(NamenodeFsck.HEALTHY_STATUS));
    DFSClient dfsClient=new DFSClient(new InetSocketAddress("localhost",cluster.getNameNodePort()),conf);
    String fileNames[]=util.getFileNames(topDir);
    CorruptedTestFile ctFiles[]=new CorruptedTestFile[]{new CorruptedTestFile(fileNames[0],Sets.newHashSet(0),dfsClient,NUM_DATANODES,DFS_BLOCK_SIZE),new CorruptedTestFile(fileNames[1],Sets.newHashSet(2,3),dfsClient,NUM_DATANODES,DFS_BLOCK_SIZE),new CorruptedTestFile(fileNames[2],Sets.newHashSet(4),dfsClient,NUM_DATANODES,DFS_BLOCK_SIZE),new CorruptedTestFile(fileNames[3],Sets.newHashSet(0,1,2,3),dfsClient,NUM_DATANODES,DFS_BLOCK_SIZE),new CorruptedTestFile(fileNames[4],Sets.newHashSet(1,2,3,4),dfsClient,NUM_DATANODES,DFS_BLOCK_SIZE)};
    int totalMissingBlocks=0;
    for (    CorruptedTestFile ctFile : ctFiles) {
      totalMissingBlocks+=ctFile.getTotalMissingBlocks();
    }
    for (    CorruptedTestFile ctFile : ctFiles) {
      ctFile.removeBlocks();
    }
    while (true) {
      outStr=runFsck(conf,1,false,"/");
      String numCorrupt=null;
      for (      String line : outStr.split(LINE_SEPARATOR)) {
        Matcher m=numCorruptBlocksPattern.matcher(line);
        if (m.matches()) {
          numCorrupt=m.group(1);
          break;
        }
      }
      if (numCorrupt == null) {
        throw new IOException("failed to find number of corrupt " + "blocks in fsck output.");
      }
      if (numCorrupt.equals(Integer.toString(totalMissingBlocks))) {
        assertTrue(outStr.contains(NamenodeFsck.CORRUPT_STATUS));
        break;
      }
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException ignore) {
      }
    }
    outStr=runFsck(conf,1,false,"/","-move");
    assertTrue(outStr.contains(NamenodeFsck.CORRUPT_STATUS));
    for (    CorruptedTestFile ctFile : ctFiles) {
      ctFile.checkSalvagedRemains();
    }
    outStr=runFsck(conf,1,true,"/","-delete");
    assertTrue(outStr.contains(NamenodeFsck.CORRUPT_STATUS));
    outStr=runFsck(conf,0,true,"/");
    assertTrue(outStr.contains(NamenodeFsck.HEALTHY_STATUS));
    util.cleanup(fs,topDir);
  }
  finally {
    if (fs != null) {
      try {
        fs.close();
      }
 catch (      Exception e) {
      }
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * check if option -list-corruptfiles of fsck command works properly 
 */
@Test public void testFsckListCorruptFilesBlocks() throws Exception {
  Configuration conf=new Configuration();
  conf.setLong(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY,1000);
  conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY,1);
  FileSystem fs=null;
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).build();
    cluster.waitActive();
    fs=cluster.getFileSystem();
    DFSTestUtil util=new DFSTestUtil.Builder().setName("testGetCorruptFiles").setNumFiles(3).setMaxLevels(1).setMaxSize(1024).build();
    util.createFiles(fs,"/corruptData",(short)1);
    util.waitReplication(fs,"/corruptData",(short)1);
    String outStr=runFsck(conf,0,false,"/corruptData","-list-corruptfileblocks");
    System.out.println("1. good fsck out: " + outStr);
    assertTrue(outStr.contains("has 0 CORRUPT files"));
    final String bpid=cluster.getNamesystem().getBlockPoolId();
    for (int i=0; i < 4; i++) {
      for (int j=0; j <= 1; j++) {
        File storageDir=cluster.getInstanceStorageDir(i,j);
        File data_dir=MiniDFSCluster.getFinalizedDir(storageDir,bpid);
        List<File> metadataFiles=MiniDFSCluster.getAllBlockMetadataFiles(data_dir);
        if (metadataFiles == null)         continue;
        for (        File metadataFile : metadataFiles) {
          File blockFile=Block.metaToBlockFile(metadataFile);
          assertTrue("Cannot remove file.",blockFile.delete());
          assertTrue("Cannot remove file.",metadataFile.delete());
        }
      }
    }
    final NamenodeProtocols namenode=cluster.getNameNodeRpc();
    CorruptFileBlocks corruptFileBlocks=namenode.listCorruptFileBlocks("/corruptData",null);
    int numCorrupt=corruptFileBlocks.getFiles().length;
    while (numCorrupt == 0) {
      Thread.sleep(1000);
      corruptFileBlocks=namenode.listCorruptFileBlocks("/corruptData",null);
      numCorrupt=corruptFileBlocks.getFiles().length;
    }
    outStr=runFsck(conf,-1,true,"/corruptData","-list-corruptfileblocks");
    System.out.println("2. bad fsck out: " + outStr);
    assertTrue(outStr.contains("has 3 CORRUPT files"));
    util.createFiles(fs,"/goodData");
    outStr=runFsck(conf,0,true,"/goodData","-list-corruptfileblocks");
    System.out.println("3. good fsck out: " + outStr);
    assertTrue(outStr.contains("has 0 CORRUPT files"));
    util.cleanup(fs,"/corruptData");
    util.cleanup(fs,"/goodData");
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestHDFSConcat </h4><pre class="type-13 type-2 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Concatenates 10 files into one
 * Verifies the final size, deletion of the file, number of blocks
 * @throws IOException
 */
@Test public void testConcat() throws IOException, InterruptedException {
  final int numFiles=10;
  long fileLen=blockSize * 3;
  HdfsFileStatus fStatus;
  FSDataInputStream stm;
  String trg=new String("/trg");
  Path trgPath=new Path(trg);
  DFSTestUtil.createFile(dfs,trgPath,fileLen,REPL_FACTOR,1);
  fStatus=nn.getFileInfo(trg);
  long trgLen=fStatus.getLen();
  long trgBlocks=nn.getBlockLocations(trg,0,trgLen).locatedBlockCount();
  Path[] files=new Path[numFiles];
  byte[][] bytes=new byte[numFiles][(int)fileLen];
  LocatedBlocks[] lblocks=new LocatedBlocks[numFiles];
  long[] lens=new long[numFiles];
  int i=0;
  for (i=0; i < files.length; i++) {
    files[i]=new Path("/file" + i);
    Path path=files[i];
    System.out.println("Creating file " + path);
    DFSTestUtil.createFile(dfs,path,fileLen,REPL_FACTOR,1);
    fStatus=nn.getFileInfo(path.toUri().getPath());
    lens[i]=fStatus.getLen();
    assertEquals(trgLen,lens[i]);
    lblocks[i]=nn.getBlockLocations(path.toUri().getPath(),0,lens[i]);
    stm=dfs.open(path);
    stm.readFully(0,bytes[i]);
    stm.close();
  }
  final UserGroupInformation user1=UserGroupInformation.createUserForTesting("theDoctor",new String[]{"tardis"});
  DistributedFileSystem hdfs=(DistributedFileSystem)DFSTestUtil.getFileSystemAs(user1,conf);
  try {
    hdfs.concat(trgPath,files);
    fail("Permission exception expected");
  }
 catch (  IOException ie) {
    System.out.println("Got expected exception for permissions:" + ie.getLocalizedMessage());
  }
  ContentSummary cBefore=dfs.getContentSummary(trgPath.getParent());
  dfs.concat(trgPath,files);
  ContentSummary cAfter=dfs.getContentSummary(trgPath.getParent());
  assertEquals(cBefore.getFileCount(),cAfter.getFileCount() + files.length);
  long totalLen=trgLen;
  long totalBlocks=trgBlocks;
  for (i=0; i < files.length; i++) {
    totalLen+=lens[i];
    totalBlocks+=lblocks[i].locatedBlockCount();
  }
  System.out.println("total len=" + totalLen + "; totalBlocks="+ totalBlocks);
  fStatus=nn.getFileInfo(trg);
  trgLen=fStatus.getLen();
  stm=dfs.open(trgPath);
  byte[] byteFileConcat=new byte[(int)trgLen];
  stm.readFully(0,byteFileConcat);
  stm.close();
  trgBlocks=nn.getBlockLocations(trg,0,trgLen).locatedBlockCount();
  assertEquals(trgBlocks,totalBlocks);
  assertEquals(trgLen,totalLen);
  for (  Path p : files) {
    fStatus=nn.getFileInfo(p.toUri().getPath());
    assertNull("File " + p + " still exists",fStatus);
    DFSTestUtil.createFile(dfs,p,fileLen,REPL_FACTOR,1);
  }
  checkFileContent(byteFileConcat,bytes);
  Path smallFile=new Path("/sfile");
  int sFileLen=10;
  DFSTestUtil.createFile(dfs,smallFile,sFileLen,REPL_FACTOR,1);
  dfs.concat(trgPath,new Path[]{smallFile});
  fStatus=nn.getFileInfo(trg);
  trgLen=fStatus.getLen();
  trgBlocks=nn.getBlockLocations(trg,0,trgLen).locatedBlockCount();
  assertEquals(trgBlocks,totalBlocks + 1);
  assertEquals(trgLen,totalLen + sFileLen);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestINodeFile </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testLocationLimitInListingOps() throws Exception {
  final Configuration conf=new Configuration();
  conf.setInt(DFSConfigKeys.DFS_LIST_LIMIT,9);
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
    cluster.waitActive();
    final DistributedFileSystem hdfs=cluster.getFileSystem();
    ArrayList<String> source=new ArrayList<String>();
    hdfs.mkdirs(new Path("/tmp1"));
    hdfs.mkdirs(new Path("/tmp2"));
    source.add("f1");
    source.add("f2");
    int numEntries=source.size();
    for (int j=0; j < numEntries; j++) {
      DFSTestUtil.createFile(hdfs,new Path("/tmp1/" + source.get(j)),4096,3 * 1024 - 100,1024,(short)3,0);
    }
    byte[] start=HdfsFileStatus.EMPTY_NAME;
    for (int j=0; j < numEntries; j++) {
      DirectoryListing dl=cluster.getNameNodeRpc().getListing("/tmp1",start,true);
      assertTrue(dl.getPartialListing().length == 1);
      for (int i=0; i < dl.getPartialListing().length; i++) {
        source.remove(dl.getPartialListing()[i].getLocalName());
      }
      start=dl.getLastName();
    }
    assertTrue(source.size() == 0);
    source.add("f1");
    source.add("f2");
    source.add("f3");
    source.add("f4");
    source.add("f5");
    source.add("f6");
    numEntries=source.size();
    for (int j=0; j < numEntries; j++) {
      DFSTestUtil.createFile(hdfs,new Path("/tmp2/" + source.get(j)),4096,3 * 1024 - 100,1024,(short)1,0);
    }
    start=HdfsFileStatus.EMPTY_NAME;
    for (int j=0; j < numEntries / 3; j++) {
      DirectoryListing dl=cluster.getNameNodeRpc().getListing("/tmp2",start,true);
      assertTrue(dl.getPartialListing().length == 3);
      for (int i=0; i < dl.getPartialListing().length; i++) {
        source.remove(dl.getPartialListing()[i].getLocalName());
      }
      start=dl.getLastName();
    }
    assertTrue(source.size() == 0);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestListCorruptFileBlocks </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Test if NN.listCorruptFiles() returns the right number of results.
 * The corrupt blocks are detected by the BlockPoolSliceScanner.
 * Also, test that DFS.listCorruptFileBlocks can make multiple successive
 * calls.
 */
@Test(timeout=300000) public void testMaxCorruptFiles() throws Exception {
  MiniDFSCluster cluster=null;
  try {
    Configuration conf=new HdfsConfiguration();
    conf.setInt(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY,3 * 1000);
    cluster=new MiniDFSCluster.Builder(conf).build();
    FileSystem fs=cluster.getFileSystem();
    final int maxCorruptFileBlocks=FSNamesystem.DEFAULT_MAX_CORRUPT_FILEBLOCKS_RETURNED;
    DFSTestUtil util=new DFSTestUtil.Builder().setName("testMaxCorruptFiles").setNumFiles(maxCorruptFileBlocks * 3).setMaxLevels(1).setMaxSize(512).build();
    util.createFiles(fs,"/srcdat2",(short)1);
    util.waitReplication(fs,"/srcdat2",(short)1);
    final NameNode namenode=cluster.getNameNode();
    Collection<FSNamesystem.CorruptFileBlockInfo> badFiles=namenode.getNamesystem().listCorruptFileBlocks("/srcdat2",null);
    assertTrue("Namenode has " + badFiles.size() + " corrupt files. Expecting none.",badFiles.size() == 0);
    final String bpid=cluster.getNamesystem().getBlockPoolId();
    for (int i=0; i < 4; i++) {
      for (int j=0; j <= 1; j++) {
        File storageDir=cluster.getInstanceStorageDir(i,j);
        File data_dir=MiniDFSCluster.getFinalizedDir(storageDir,bpid);
        LOG.info("Removing files from " + data_dir);
        List<File> metadataFiles=MiniDFSCluster.getAllBlockMetadataFiles(data_dir);
        if (metadataFiles == null)         continue;
        for (        File metadataFile : metadataFiles) {
          File blockFile=Block.metaToBlockFile(metadataFile);
          assertTrue("Cannot remove file.",blockFile.delete());
          assertTrue("Cannot remove file.",metadataFile.delete());
        }
      }
    }
    LOG.info("Restarting Datanode to trigger BlockPoolSliceScanner");
    cluster.restartDataNodes();
    cluster.waitActive();
    badFiles=namenode.getNamesystem().listCorruptFileBlocks("/srcdat2",null);
    while (badFiles.size() < maxCorruptFileBlocks) {
      LOG.info("# of corrupt files is: " + badFiles.size());
      Thread.sleep(10000);
      badFiles=namenode.getNamesystem().listCorruptFileBlocks("/srcdat2",null);
    }
    badFiles=namenode.getNamesystem().listCorruptFileBlocks("/srcdat2",null);
    LOG.info("Namenode has bad files. " + badFiles.size());
    assertTrue("Namenode has " + badFiles.size() + " bad files. Expecting "+ maxCorruptFileBlocks+ ".",badFiles.size() == maxCorruptFileBlocks);
    CorruptFileBlockIterator iter=(CorruptFileBlockIterator)fs.listCorruptFileBlocks(new Path("/srcdat2"));
    int corruptPaths=countPaths(iter);
    assertTrue("Expected more than " + maxCorruptFileBlocks + " corrupt file blocks but got "+ corruptPaths,corruptPaths > maxCorruptFileBlocks);
    assertTrue("Iterator should have made more than 1 call but made " + iter.getCallsMade(),iter.getCallsMade() > 1);
    util.cleanup(fs,"/srcdat2");
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=300000) public void testlistCorruptFileBlocks() throws Exception {
  Configuration conf=new Configuration();
  conf.setLong(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY,1000);
  conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY,1);
  FileSystem fs=null;
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).build();
    cluster.waitActive();
    fs=cluster.getFileSystem();
    DFSTestUtil util=new DFSTestUtil.Builder().setName("testGetCorruptFiles").setNumFiles(3).setMaxLevels(1).setMaxSize(1024).build();
    util.createFiles(fs,"/corruptData");
    final NameNode namenode=cluster.getNameNode();
    Collection<FSNamesystem.CorruptFileBlockInfo> corruptFileBlocks=namenode.getNamesystem().listCorruptFileBlocks("/corruptData",null);
    int numCorrupt=corruptFileBlocks.size();
    assertTrue(numCorrupt == 0);
    String bpid=cluster.getNamesystem().getBlockPoolId();
    for (int i=0; i < 4; i++) {
      for (int j=0; j <= 1; j++) {
        File storageDir=cluster.getInstanceStorageDir(i,j);
        File data_dir=MiniDFSCluster.getFinalizedDir(storageDir,bpid);
        List<File> metadataFiles=MiniDFSCluster.getAllBlockMetadataFiles(data_dir);
        if (metadataFiles == null)         continue;
        for (        File metadataFile : metadataFiles) {
          File blockFile=Block.metaToBlockFile(metadataFile);
          LOG.info("Deliberately removing file " + blockFile.getName());
          assertTrue("Cannot remove file.",blockFile.delete());
          LOG.info("Deliberately removing file " + metadataFile.getName());
          assertTrue("Cannot remove file.",metadataFile.delete());
        }
      }
    }
    int count=0;
    corruptFileBlocks=namenode.getNamesystem().listCorruptFileBlocks("/corruptData",null);
    numCorrupt=corruptFileBlocks.size();
    while (numCorrupt < 3) {
      Thread.sleep(1000);
      corruptFileBlocks=namenode.getNamesystem().listCorruptFileBlocks("/corruptData",null);
      numCorrupt=corruptFileBlocks.size();
      count++;
      if (count > 30)       break;
    }
    LOG.info("Namenode has bad files. " + numCorrupt);
    assertTrue(numCorrupt == 3);
    FSNamesystem.CorruptFileBlockInfo[] cfb=corruptFileBlocks.toArray(new FSNamesystem.CorruptFileBlockInfo[0]);
    String[] cookie=new String[]{"1"};
    Collection<FSNamesystem.CorruptFileBlockInfo> nextCorruptFileBlocks=namenode.getNamesystem().listCorruptFileBlocks("/corruptData",cookie);
    FSNamesystem.CorruptFileBlockInfo[] ncfb=nextCorruptFileBlocks.toArray(new FSNamesystem.CorruptFileBlockInfo[0]);
    numCorrupt=nextCorruptFileBlocks.size();
    assertTrue(numCorrupt == 2);
    assertTrue(ncfb[0].block.getBlockName().equalsIgnoreCase(cfb[1].block.getBlockName()));
    corruptFileBlocks=namenode.getNamesystem().listCorruptFileBlocks("/corruptData",cookie);
    numCorrupt=corruptFileBlocks.size();
    assertTrue(numCorrupt == 0);
    util.createFiles(fs,"/goodData");
    corruptFileBlocks=namenode.getNamesystem().listCorruptFileBlocks("/goodData",null);
    numCorrupt=corruptFileBlocks.size();
    assertTrue(numCorrupt == 0);
    util.cleanup(fs,"/corruptData");
    util.cleanup(fs,"/goodData");
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * test listCorruptFileBlocks in DistributedFileSystem
 */
@Test(timeout=300000) public void testlistCorruptFileBlocksDFS() throws Exception {
  Configuration conf=new Configuration();
  conf.setLong(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY,1000);
  conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY,1);
  FileSystem fs=null;
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).build();
    cluster.waitActive();
    fs=cluster.getFileSystem();
    DistributedFileSystem dfs=(DistributedFileSystem)fs;
    DFSTestUtil util=new DFSTestUtil.Builder().setName("testGetCorruptFiles").setNumFiles(3).setMaxLevels(1).setMaxSize(1024).build();
    util.createFiles(fs,"/corruptData");
    RemoteIterator<Path> corruptFileBlocks=dfs.listCorruptFileBlocks(new Path("/corruptData"));
    int numCorrupt=countPaths(corruptFileBlocks);
    assertTrue(numCorrupt == 0);
    String bpid=cluster.getNamesystem().getBlockPoolId();
    for (int i=0; i < 2; i++) {
      File storageDir=cluster.getInstanceStorageDir(0,i);
      File data_dir=MiniDFSCluster.getFinalizedDir(storageDir,bpid);
      List<File> metadataFiles=MiniDFSCluster.getAllBlockMetadataFiles(data_dir);
      if (metadataFiles == null)       continue;
      for (      File metadataFile : metadataFiles) {
        File blockFile=Block.metaToBlockFile(metadataFile);
        LOG.info("Deliberately removing file " + blockFile.getName());
        assertTrue("Cannot remove file.",blockFile.delete());
        LOG.info("Deliberately removing file " + metadataFile.getName());
        assertTrue("Cannot remove file.",metadataFile.delete());
      }
    }
    int count=0;
    corruptFileBlocks=dfs.listCorruptFileBlocks(new Path("/corruptData"));
    numCorrupt=countPaths(corruptFileBlocks);
    while (numCorrupt < 3) {
      Thread.sleep(1000);
      corruptFileBlocks=dfs.listCorruptFileBlocks(new Path("/corruptData"));
      numCorrupt=countPaths(corruptFileBlocks);
      count++;
      if (count > 30)       break;
    }
    LOG.info("Namenode has bad files. " + numCorrupt);
    assertTrue(numCorrupt == 3);
    util.cleanup(fs,"/corruptData");
    util.cleanup(fs,"/goodData");
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestMetaSave </h4><pre class="type-13 type-11 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Tests that metasave overwrites the output file (not append).
 */
@Test public void testMetaSaveOverwrite() throws Exception {
  namesystem.metaSave("metaSaveOverwrite.out.txt");
  namesystem.metaSave("metaSaveOverwrite.out.txt");
  FileInputStream fis=null;
  InputStreamReader isr=null;
  BufferedReader rdr=null;
  try {
    fis=new FileInputStream(getLogFile("metaSaveOverwrite.out.txt"));
    isr=new InputStreamReader(fis);
    rdr=new BufferedReader(isr);
    boolean foundLiveDatanodesLine=false;
    String line=rdr.readLine();
    while (line != null) {
      if (line.startsWith("Live Datanodes")) {
        if (foundLiveDatanodesLine) {
          fail("multiple Live Datanodes lines, output file not overwritten");
        }
        foundLiveDatanodesLine=true;
      }
      line=rdr.readLine();
    }
  }
  finally {
    IOUtils.cleanup(null,rdr,isr,fis);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestNamenodeCapacityReport </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testXceiverCount() throws Exception {
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFS_CLIENT_BLOCK_WRITE_LOCATEFOLLOWINGBLOCK_RETRIES_KEY,0);
  MiniDFSCluster cluster=null;
  final int nodes=8;
  final int fileCount=5;
  final short fileRepl=3;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(nodes).build();
    cluster.waitActive();
    final FSNamesystem namesystem=cluster.getNamesystem();
    final DatanodeManager dnm=namesystem.getBlockManager().getDatanodeManager();
    List<DataNode> datanodes=cluster.getDataNodes();
    final DistributedFileSystem fs=cluster.getFileSystem();
    triggerHeartbeats(datanodes);
    int expectedTotalLoad=nodes;
    int expectedInServiceNodes=nodes;
    int expectedInServiceLoad=nodes;
    assertEquals(nodes,namesystem.getNumLiveDataNodes());
    assertEquals(expectedInServiceNodes,namesystem.getNumDatanodesInService());
    assertEquals(expectedTotalLoad,namesystem.getTotalLoad());
    assertEquals((double)expectedInServiceLoad / expectedInServiceLoad,namesystem.getInServiceXceiverAverage(),EPSILON);
    for (int i=0; i < nodes / 2; i++) {
      DataNode dn=datanodes.get(i);
      DatanodeDescriptor dnd=dnm.getDatanode(dn.getDatanodeId());
      dn.shutdown();
      dnd.setLastUpdate(0L);
      BlockManagerTestUtil.checkHeartbeat(namesystem.getBlockManager());
      expectedInServiceNodes--;
      assertEquals(expectedInServiceNodes,namesystem.getNumLiveDataNodes());
      assertEquals(expectedInServiceNodes,namesystem.getNumDatanodesInService());
    }
    cluster.restartDataNodes();
    cluster.waitActive();
    datanodes=cluster.getDataNodes();
    expectedInServiceNodes=nodes;
    assertEquals(nodes,datanodes.size());
    assertEquals(nodes,namesystem.getNumLiveDataNodes());
    assertEquals(expectedInServiceNodes,namesystem.getNumDatanodesInService());
    assertEquals(expectedTotalLoad,namesystem.getTotalLoad());
    assertEquals((double)expectedInServiceLoad / expectedInServiceLoad,namesystem.getInServiceXceiverAverage(),EPSILON);
    DFSOutputStream[] streams=new DFSOutputStream[fileCount];
    for (int i=0; i < fileCount; i++) {
      streams[i]=(DFSOutputStream)fs.create(new Path("/f" + i),fileRepl).getWrappedStream();
      streams[i].write("1".getBytes());
      streams[i].hsync();
      expectedTotalLoad+=2 * fileRepl;
      expectedInServiceLoad+=2 * fileRepl;
    }
    triggerHeartbeats(datanodes);
    assertEquals(nodes,namesystem.getNumLiveDataNodes());
    assertEquals(expectedInServiceNodes,namesystem.getNumDatanodesInService());
    assertEquals(expectedTotalLoad,namesystem.getTotalLoad());
    assertEquals((double)expectedInServiceLoad / expectedInServiceNodes,namesystem.getInServiceXceiverAverage(),EPSILON);
    for (int i=0; i < fileRepl; i++) {
      expectedInServiceNodes--;
      DatanodeDescriptor dnd=dnm.getDatanode(datanodes.get(i).getDatanodeId());
      expectedInServiceLoad-=dnd.getXceiverCount();
      dnm.startDecommission(dnd);
      DataNodeTestUtils.triggerHeartbeat(datanodes.get(i));
      Thread.sleep(100);
      assertEquals(nodes,namesystem.getNumLiveDataNodes());
      assertEquals(expectedInServiceNodes,namesystem.getNumDatanodesInService());
      assertEquals(expectedTotalLoad,namesystem.getTotalLoad());
      assertEquals((double)expectedInServiceLoad / expectedInServiceNodes,namesystem.getInServiceXceiverAverage(),EPSILON);
    }
    for (int i=0; i < fileCount; i++) {
      int decomm=0;
      for (      DatanodeInfo dni : streams[i].getPipeline()) {
        DatanodeDescriptor dnd=dnm.getDatanode(dni);
        expectedTotalLoad-=2;
        if (dnd.isDecommissionInProgress() || dnd.isDecommissioned()) {
          decomm++;
        }
 else {
          expectedInServiceLoad-=2;
        }
      }
      try {
        streams[i].close();
      }
 catch (      IOException ioe) {
        if (decomm < fileRepl) {
          throw ioe;
        }
      }
      triggerHeartbeats(datanodes);
      assertEquals(nodes,namesystem.getNumLiveDataNodes());
      assertEquals(expectedInServiceNodes,namesystem.getNumDatanodesInService());
      assertEquals(expectedTotalLoad,namesystem.getTotalLoad());
      assertEquals((double)expectedInServiceLoad / expectedInServiceNodes,namesystem.getInServiceXceiverAverage(),EPSILON);
    }
    for (int i=0; i < nodes; i++) {
      DataNode dn=datanodes.get(i);
      dn.shutdown();
      DatanodeDescriptor dnDesc=dnm.getDatanode(dn.getDatanodeId());
      dnDesc.setLastUpdate(0L);
      BlockManagerTestUtil.checkHeartbeat(namesystem.getBlockManager());
      assertEquals(nodes - 1 - i,namesystem.getNumLiveDataNodes());
      if (i >= fileRepl) {
        expectedInServiceNodes--;
      }
      assertEquals(expectedInServiceNodes,namesystem.getNumDatanodesInService());
      double expectedXceiverAvg=(i == nodes - 1) ? 0.0 : 1.0;
      assertEquals((double)expectedXceiverAvg,namesystem.getInServiceXceiverAverage(),EPSILON);
    }
    assertEquals(0,namesystem.getNumLiveDataNodes());
    assertEquals(0,namesystem.getNumDatanodesInService());
    assertEquals(0.0,namesystem.getTotalLoad(),EPSILON);
    assertEquals(0.0,namesystem.getInServiceXceiverAverage(),EPSILON);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestNamenodeRetryCache </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * After run a set of operations, restart NN and check if the retry cache has
 * been rebuilt based on the editlog.
 */
@Test public void testRetryCacheRebuild() throws Exception {
  DFSTestUtil.runOperations(cluster,filesystem,conf,BlockSize,0);
  LightWeightCache<CacheEntry,CacheEntry> cacheSet=(LightWeightCache<CacheEntry,CacheEntry>)namesystem.getRetryCache().getCacheSet();
  assertEquals(23,cacheSet.size());
  Map<CacheEntry,CacheEntry> oldEntries=new HashMap<CacheEntry,CacheEntry>();
  Iterator<CacheEntry> iter=cacheSet.iterator();
  while (iter.hasNext()) {
    CacheEntry entry=iter.next();
    oldEntries.put(entry,entry);
  }
  cluster.restartNameNode();
  cluster.waitActive();
  namesystem=cluster.getNamesystem();
  assertTrue(namesystem.hasRetryCache());
  cacheSet=(LightWeightCache<CacheEntry,CacheEntry>)namesystem.getRetryCache().getCacheSet();
  assertEquals(23,cacheSet.size());
  iter=cacheSet.iterator();
  while (iter.hasNext()) {
    CacheEntry entry=iter.next();
    assertTrue(oldEntries.containsKey(entry));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestSequentialBlockId </h4><pre class="type-9 type-13 type-7 type-21 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Test that block IDs are generated sequentially.
 * @throws IOException
 */
@Test public void testBlockIdGeneration() throws IOException {
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFSConfigKeys.DFS_REPLICATION_KEY,1);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  try {
    cluster.waitActive();
    FileSystem fs=cluster.getFileSystem();
    Path path=new Path("testBlockIdGeneration.dat");
    DFSTestUtil.createFile(fs,path,IO_SIZE,BLOCK_SIZE * 10,BLOCK_SIZE,REPLICATION,SEED);
    List<LocatedBlock> blocks=DFSTestUtil.getAllBlocks(fs,path);
    LOG.info("Block0 id is " + blocks.get(0).getBlock().getBlockId());
    long nextBlockExpectedId=blocks.get(0).getBlock().getBlockId() + 1;
    for (int i=1; i < blocks.size(); ++i) {
      long nextBlockId=blocks.get(i).getBlock().getBlockId();
      LOG.info("Block" + i + " id is "+ nextBlockId);
      assertThat(nextBlockId,is(nextBlockExpectedId));
      ++nextBlockExpectedId;
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestSnapshotPathINodes </h4><pre class="type-9 type-13 type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test {@link INodeDirectory#getExistingPathINodes(byte[][],int,boolean)} 
 * for snapshot file.
 */
@Test(timeout=15000) public void testSnapshotPathINodes() throws Exception {
  hdfs.allowSnapshot(sub1);
  hdfs.createSnapshot(sub1,"s1");
  String snapshotPath=sub1.toString() + "/.snapshot/s1/file1";
  String[] names=INode.getPathNames(snapshotPath);
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length - 1);
  final Snapshot snapshot=getSnapshot(nodesInPath,"s1");
  assertSnapshot(nodesInPath,true,snapshot,3);
  INode snapshotFileNode=inodes[inodes.length - 1];
  assertINodeFile(snapshotFileNode,file1);
  assertTrue(snapshotFileNode.getParent().isWithSnapshot());
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components,1,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,1);
  assertSnapshot(nodesInPath,true,snapshot,-1);
  assertINodeFile(nodesInPath.getLastINode(),file1);
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components,2,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,2);
  assertSnapshot(nodesInPath,true,snapshot,0);
  assertINodeFile(nodesInPath.getLastINode(),file1);
  String dotSnapshotPath=sub1.toString() + "/.snapshot";
  names=INode.getPathNames(dotSnapshotPath);
  components=INode.getPathComponents(names);
  nodesInPath=INodesInPath.resolve(fsdir.rootDir,components);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length - 1);
  assertSnapshot(nodesInPath,true,snapshot,-1);
  final INode last=nodesInPath.getLastINode();
  assertEquals(last.getFullPathName(),sub1.toString());
  assertFalse(last instanceof INodeFile);
  String[] invalidPathComponent={"invalidDir","foo",".snapshot","bar"};
  Path invalidPath=new Path(invalidPathComponent[0]);
  for (int i=1; i < invalidPathComponent.length; i++) {
    invalidPath=new Path(invalidPath,invalidPathComponent[i]);
    try {
      hdfs.getFileStatus(invalidPath);
      Assert.fail();
    }
 catch (    FileNotFoundException fnfe) {
      System.out.println("The exception is expected: " + fnfe);
    }
  }
  hdfs.deleteSnapshot(sub1,"s1");
  hdfs.disallowSnapshot(sub1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.ha.TestDFSUpgradeWithHA </h4><pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
/** 
 * Make sure that an HA NN will start if a previous upgrade was in progress.
 */
@Test public void testStartingWithUpgradeInProgressSucceeds() throws Exception {
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(0).build();
    for (int i=0; i < 2; i++) {
      for (      URI uri : cluster.getNameDirs(i)) {
        File prevTmp=new File(new File(uri),Storage.STORAGE_TMP_PREVIOUS);
        LOG.info("creating previous tmp dir: " + prevTmp);
        assertTrue(prevTmp.mkdirs());
      }
    }
    cluster.restartNameNodes();
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.ha.TestEditLogTailer </h4><pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testTailer() throws IOException, InterruptedException, ServiceFailedException {
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFSConfigKeys.DFS_HA_TAILEDITS_PERIOD_KEY,1);
  HAUtil.setAllowStandbyReads(conf,true);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(0).build();
  cluster.waitActive();
  cluster.transitionToActive(0);
  NameNode nn1=cluster.getNameNode(0);
  NameNode nn2=cluster.getNameNode(1);
  try {
    for (int i=0; i < DIRS_TO_MAKE / 2; i++) {
      NameNodeAdapter.mkdirs(nn1,getDirPath(i),new PermissionStatus("test","test",new FsPermission((short)00755)),true);
    }
    HATestUtil.waitForStandbyToCatchUp(nn1,nn2);
    for (int i=0; i < DIRS_TO_MAKE / 2; i++) {
      assertTrue(NameNodeAdapter.getFileInfo(nn2,getDirPath(i),false).isDir());
    }
    for (int i=DIRS_TO_MAKE / 2; i < DIRS_TO_MAKE; i++) {
      NameNodeAdapter.mkdirs(nn1,getDirPath(i),new PermissionStatus("test","test",new FsPermission((short)00755)),true);
    }
    HATestUtil.waitForStandbyToCatchUp(nn1,nn2);
    for (int i=DIRS_TO_MAKE / 2; i < DIRS_TO_MAKE; i++) {
      assertTrue(NameNodeAdapter.getFileInfo(nn2,getDirPath(i),false).isDir());
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.ha.TestHAStateTransitions </h4><pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * The secret manager needs to start/stop - the invariant should be that
 * the secret manager runs if and only if the NN is active and not in
 * safe mode. As a state diagram, we need to test all of the following
 * transitions to make sure the secret manager is started when we transition
 * into state 4, but none of the others.
 * <pre>
 * SafeMode     Not SafeMode 
 * Standby   1 <------> 2
 * ^          ^
 * |          |
 * v          v
 * Active    3 <------> 4
 * </pre>
 */
@Test(timeout=60000) public void testSecretManagerState() throws Exception {
  Configuration conf=new Configuration();
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_DELEGATION_TOKEN_ALWAYS_USE_KEY,true);
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_DELEGATION_KEY_UPDATE_INTERVAL_KEY,50);
  conf.setInt(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,1024);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(1).waitSafeMode(false).build();
  try {
    cluster.transitionToActive(0);
    DFSTestUtil.createFile(cluster.getFileSystem(0),TEST_FILE_PATH,6000,(short)1,1L);
    cluster.getConfiguration(0).setInt(DFSConfigKeys.DFS_NAMENODE_SAFEMODE_EXTENSION_KEY,60000);
    cluster.restartNameNode(0);
    NameNode nn=cluster.getNameNode(0);
    banner("Started in state 1.");
    assertTrue(nn.isStandbyState());
    assertTrue(nn.isInSafeMode());
    assertFalse(isDTRunning(nn));
    banner("Transition 1->2. Should not start secret manager");
    NameNodeAdapter.leaveSafeMode(nn);
    assertTrue(nn.isStandbyState());
    assertFalse(nn.isInSafeMode());
    assertFalse(isDTRunning(nn));
    banner("Transition 2->1. Should not start secret manager.");
    NameNodeAdapter.enterSafeMode(nn,false);
    assertTrue(nn.isStandbyState());
    assertTrue(nn.isInSafeMode());
    assertFalse(isDTRunning(nn));
    banner("Transition 1->3. Should not start secret manager.");
    nn.getRpcServer().transitionToActive(REQ_INFO);
    assertFalse(nn.isStandbyState());
    assertTrue(nn.isInSafeMode());
    assertFalse(isDTRunning(nn));
    banner("Transition 3->1. Should not start secret manager.");
    nn.getRpcServer().transitionToStandby(REQ_INFO);
    assertTrue(nn.isStandbyState());
    assertTrue(nn.isInSafeMode());
    assertFalse(isDTRunning(nn));
    banner("Transition 1->3->4. Should start secret manager.");
    nn.getRpcServer().transitionToActive(REQ_INFO);
    NameNodeAdapter.leaveSafeMode(nn);
    assertFalse(nn.isStandbyState());
    assertFalse(nn.isInSafeMode());
    assertTrue(isDTRunning(nn));
    banner("Transition 4->3. Should stop secret manager");
    NameNodeAdapter.enterSafeMode(nn,false);
    assertFalse(nn.isStandbyState());
    assertTrue(nn.isInSafeMode());
    assertFalse(isDTRunning(nn));
    banner("Transition 3->4. Should start secret manager");
    NameNodeAdapter.leaveSafeMode(nn);
    assertFalse(nn.isStandbyState());
    assertFalse(nn.isInSafeMode());
    assertTrue(isDTRunning(nn));
    for (int i=0; i < 20; i++) {
      banner("Transition 4->2. Should stop secret manager.");
      nn.getRpcServer().transitionToStandby(REQ_INFO);
      assertTrue(nn.isStandbyState());
      assertFalse(nn.isInSafeMode());
      assertFalse(isDTRunning(nn));
      banner("Transition 2->4. Should start secret manager");
      nn.getRpcServer().transitionToActive(REQ_INFO);
      assertFalse(nn.isStandbyState());
      assertFalse(nn.isInSafeMode());
      assertTrue(isDTRunning(nn));
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * 1. Run a set of operations
 * 2. Trigger the NN failover
 * 3. Check the retry cache on the original standby NN
 */
@Test(timeout=60000) public void testRetryCacheOnStandbyNN() throws Exception {
  DFSTestUtil.runOperations(cluster,dfs,conf,BlockSize,0);
  FSNamesystem fsn0=cluster.getNamesystem(0);
  LightWeightCache<CacheEntry,CacheEntry> cacheSet=(LightWeightCache<CacheEntry,CacheEntry>)fsn0.getRetryCache().getCacheSet();
  assertEquals(23,cacheSet.size());
  Map<CacheEntry,CacheEntry> oldEntries=new HashMap<CacheEntry,CacheEntry>();
  Iterator<CacheEntry> iter=cacheSet.iterator();
  while (iter.hasNext()) {
    CacheEntry entry=iter.next();
    oldEntries.put(entry,entry);
  }
  cluster.getNameNode(0).getRpcServer().rollEditLog();
  cluster.getNameNode(1).getNamesystem().getEditLogTailer().doTailEdits();
  cluster.shutdownNameNode(0);
  cluster.transitionToActive(1);
  FSNamesystem fsn1=cluster.getNamesystem(1);
  cacheSet=(LightWeightCache<CacheEntry,CacheEntry>)fsn1.getRetryCache().getCacheSet();
  assertEquals(23,cacheSet.size());
  iter=cacheSet.iterator();
  while (iter.hasNext()) {
    CacheEntry entry=iter.next();
    assertTrue(oldEntries.containsKey(entry));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.snapshot.TestNestedSnapshots </h4><pre class="type-9 type-13 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the snapshot limit of a single snapshottable directory.
 * @throws Exception
 */
@Test(timeout=300000) public void testSnapshotLimit() throws Exception {
  final int step=1000;
  final String dirStr="/testSnapshotLimit/dir";
  final Path dir=new Path(dirStr);
  hdfs.mkdirs(dir,new FsPermission((short)0777));
  hdfs.allowSnapshot(dir);
  int s=0;
  for (; s < SNAPSHOT_LIMIT; s++) {
    final String snapshotName="s" + s;
    hdfs.createSnapshot(dir,snapshotName);
    if (s % step == 0) {
      final Path file=new Path(dirStr,"f" + s);
      DFSTestUtil.createFile(hdfs,file,BLOCKSIZE,REPLICATION,SEED);
    }
  }
  try {
    hdfs.createSnapshot(dir,"s" + s);
    Assert.fail("Expected to fail to create snapshot, but didn't.");
  }
 catch (  IOException ioe) {
    SnapshotTestHelper.LOG.info("The exception is expected.",ioe);
  }
  for (int f=0; f < SNAPSHOT_LIMIT; f+=step) {
    final String file="f" + f;
    s=RANDOM.nextInt(step);
    for (; s < SNAPSHOT_LIMIT; s+=RANDOM.nextInt(step)) {
      final Path p=SnapshotTestHelper.getSnapshotPath(dir,"s" + s,file);
      Assert.assertEquals(s > f,hdfs.exists(p));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotListing </h4><pre class="type-13 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test listing snapshots under a snapshottable directory
 */
@Test(timeout=15000) public void testListSnapshots() throws Exception {
  final Path snapshotsPath=new Path(dir,".snapshot");
  FileStatus[] stats=null;
  stats=hdfs.listStatus(new Path("/.snapshot"));
  assertEquals(0,stats.length);
  try {
    stats=hdfs.listStatus(snapshotsPath);
    fail("expect SnapshotException");
  }
 catch (  IOException e) {
    GenericTestUtils.assertExceptionContains("Directory is not a snapshottable directory: " + dir.toString(),e);
  }
  hdfs.allowSnapshot(dir);
  stats=hdfs.listStatus(snapshotsPath);
  assertEquals(0,stats.length);
  final int snapshotNum=5;
  for (int sNum=0; sNum < snapshotNum; sNum++) {
    hdfs.createSnapshot(dir,"s_" + sNum);
    stats=hdfs.listStatus(snapshotsPath);
    assertEquals(sNum + 1,stats.length);
    for (int i=0; i <= sNum; i++) {
      assertEquals("s_" + i,stats[i].getPath().getName());
    }
  }
  for (int sNum=snapshotNum - 1; sNum > 0; sNum--) {
    hdfs.deleteSnapshot(dir,"s_" + sNum);
    stats=hdfs.listStatus(snapshotsPath);
    assertEquals(sNum,stats.length);
    for (int i=0; i < sNum; i++) {
      assertEquals("s_" + i,stats[i].getPath().getName());
    }
  }
  hdfs.deleteSnapshot(dir,"s_0");
  stats=hdfs.listStatus(snapshotsPath);
  assertEquals(0,stats.length);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.snapshot.TestSnapshotReplication </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test replication number calculation for a file with snapshots.
 */
@Test(timeout=60000) public void testReplicationWithSnapshot() throws Exception {
  short fileRep=1;
  DFSTestUtil.createFile(hdfs,file1,BLOCKSIZE,fileRep,seed);
  Map<Path,Short> snapshotRepMap=new HashMap<Path,Short>();
  for (; fileRep < NUMDATANODE; ) {
    Path snapshotRoot=SnapshotTestHelper.createSnapshot(hdfs,sub1,"s" + fileRep);
    Path snapshot=new Path(snapshotRoot,file1.getName());
    assertEquals(fileRep,getINodeFile(snapshot).getFileReplication());
    snapshotRepMap.put(snapshot,fileRep);
    hdfs.setReplication(file1,++fileRep);
    checkFileReplication(file1,fileRep,fileRep);
    checkSnapshotFileReplication(file1,snapshotRepMap,fileRep);
  }
  hdfs.setReplication(file1,REPLICATION);
  checkFileReplication(file1,REPLICATION,(short)(NUMDATANODE - 1));
  checkSnapshotFileReplication(file1,snapshotRepMap,(short)(NUMDATANODE - 1));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.web.resources.TestWebHdfsDataLocality </h4><pre class="type-9 type-13 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testDataLocality() throws Exception {
  final Configuration conf=WebHdfsTestUtil.createConf();
  final String[] racks={RACK0,RACK0,RACK1,RACK1,RACK2,RACK2};
  final int nDataNodes=racks.length;
  LOG.info("nDataNodes=" + nDataNodes + ", racks="+ Arrays.asList(racks));
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(nDataNodes).racks(racks).build();
  try {
    cluster.waitActive();
    final DistributedFileSystem dfs=cluster.getFileSystem();
    final NameNode namenode=cluster.getNameNode();
    final DatanodeManager dm=namenode.getNamesystem().getBlockManager().getDatanodeManager();
    LOG.info("dm=" + dm);
    final long blocksize=DFSConfigKeys.DFS_BLOCK_SIZE_DEFAULT;
    final String f="/foo";
{
      for (int i=0; i < nDataNodes; i++) {
        final DataNode dn=cluster.getDataNodes().get(i);
        final String ipAddr=dm.getDatanode(dn.getDatanodeId()).getIpAddr();
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,PutOpParam.Op.CREATE,-1L,blocksize,null);
        Assert.assertEquals(ipAddr,chosen.getIpAddr());
      }
    }
    final Path p=new Path(f);
    final FSDataOutputStream out=dfs.create(p,(short)1);
    out.write(1);
    out.close();
    final LocatedBlocks locatedblocks=NameNodeAdapter.getBlockLocations(namenode,f,0,1);
    final List<LocatedBlock> lb=locatedblocks.getLocatedBlocks();
    Assert.assertEquals(1,lb.size());
    final DatanodeInfo[] locations=lb.get(0).getLocations();
    Assert.assertEquals(1,locations.length);
    final DatanodeInfo expected=locations[0];
{
      final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.GETFILECHECKSUM,-1L,blocksize,null);
      Assert.assertEquals(expected,chosen);
    }
{
      final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.OPEN,0,blocksize,null);
      Assert.assertEquals(expected,chosen);
    }
{
      final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,PostOpParam.Op.APPEND,-1L,blocksize,null);
      Assert.assertEquals(expected,chosen);
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testExcludeDataNodes() throws Exception {
  final Configuration conf=WebHdfsTestUtil.createConf();
  final String[] racks={RACK0,RACK0,RACK1,RACK1,RACK2,RACK2};
  final String[] hosts={"DataNode1","DataNode2","DataNode3","DataNode4","DataNode5","DataNode6"};
  final int nDataNodes=hosts.length;
  LOG.info("nDataNodes=" + nDataNodes + ", racks="+ Arrays.asList(racks)+ ", hosts="+ Arrays.asList(hosts));
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).hosts(hosts).numDataNodes(nDataNodes).racks(racks).build();
  try {
    cluster.waitActive();
    final DistributedFileSystem dfs=cluster.getFileSystem();
    final NameNode namenode=cluster.getNameNode();
    final DatanodeManager dm=namenode.getNamesystem().getBlockManager().getDatanodeManager();
    LOG.info("dm=" + dm);
    final long blocksize=DFSConfigKeys.DFS_BLOCK_SIZE_DEFAULT;
    final String f="/foo";
    final Path p=new Path(f);
    final FSDataOutputStream out=dfs.create(p,(short)3);
    out.write(1);
    out.close();
    final LocatedBlocks locatedblocks=NameNodeAdapter.getBlockLocations(namenode,f,0,1);
    final List<LocatedBlock> lb=locatedblocks.getLocatedBlocks();
    Assert.assertEquals(1,lb.size());
    final DatanodeInfo[] locations=lb.get(0).getLocations();
    Assert.assertEquals(3,locations.length);
    StringBuffer sb=new StringBuffer();
    for (int i=0; i < 2; i++) {
      sb.append(locations[i].getXferAddr());
{
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.GETFILECHECKSUM,-1L,blocksize,sb.toString());
        for (int j=0; j <= i; j++) {
          Assert.assertNotEquals(locations[j].getHostName(),chosen.getHostName());
        }
      }
{
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,GetOpParam.Op.OPEN,0,blocksize,sb.toString());
        for (int j=0; j <= i; j++) {
          Assert.assertNotEquals(locations[j].getHostName(),chosen.getHostName());
        }
      }
{
        final DatanodeInfo chosen=NamenodeWebHdfsMethods.chooseDatanode(namenode,f,PostOpParam.Op.APPEND,-1L,blocksize,sb.toString());
        for (int j=0; j <= i; j++) {
          Assert.assertNotEquals(locations[j].getHostName(),chosen.getHostName());
        }
      }
      sb.append(",");
    }
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.shortcircuit.TestShortCircuitShm </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAllocateSlots() throws Exception {
  File path=new File(TEST_BASE,"testAllocateSlots");
  path.mkdirs();
  SharedFileDescriptorFactory factory=SharedFileDescriptorFactory.create("shm_",new String[]{path.getAbsolutePath()});
  FileInputStream stream=factory.createDescriptor("testAllocateSlots",4096);
  ShortCircuitShm shm=new ShortCircuitShm(ShmId.createRandom(),stream);
  int numSlots=0;
  ArrayList<Slot> slots=new ArrayList<Slot>();
  while (!shm.isFull()) {
    Slot slot=shm.allocAndRegisterSlot(new ExtendedBlockId(123L,"test_bp1"));
    slots.add(slot);
    numSlots++;
  }
  LOG.info("allocated " + numSlots + " slots before running out.");
  int slotIdx=0;
  for (Iterator<Slot> iter=shm.slotIterator(); iter.hasNext(); ) {
    Assert.assertTrue(slots.contains(iter.next()));
  }
  for (  Slot slot : slots) {
    Assert.assertFalse(slot.addAnchor());
    Assert.assertEquals(slotIdx++,slot.getSlotIdx());
  }
  for (  Slot slot : slots) {
    slot.makeAnchorable();
  }
  for (  Slot slot : slots) {
    Assert.assertTrue(slot.addAnchor());
  }
  for (  Slot slot : slots) {
    slot.removeAnchor();
  }
  for (  Slot slot : slots) {
    shm.unregisterSlot(slot.getSlotIdx());
    slot.makeInvalid();
  }
  shm.free();
  stream.close();
  FileUtil.fullyDelete(path);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.util.TestBestEffortLongFile </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetSet() throws IOException {
  BestEffortLongFile f=new BestEffortLongFile(FILE,12345L);
  try {
    assertEquals(12345L,f.get());
    assertTrue(FILE.exists());
    Random r=new Random();
    for (int i=0; i < 100; i++) {
      long newVal=r.nextLong();
      f.set(newVal);
      assertEquals(newVal,f.get());
      BestEffortLongFile f2=new BestEffortLongFile(FILE,999L);
      try {
        assertEquals(newVal,f2.get());
      }
  finally {
        IOUtils.closeStream(f2);
      }
    }
  }
  finally {
    IOUtils.closeStream(f);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.util.TestLightWeightHashSet </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOther(){
  LOG.info("Test other");
  assertTrue(set.addAll(list));
  assertTrue(set.removeAll(list));
  assertTrue(set.isEmpty());
  List<Integer> sub=new LinkedList<Integer>();
  for (int i=0; i < 10; i++) {
    sub.add(list.get(i));
  }
  assertTrue(set.addAll(list));
  assertTrue(set.removeAll(sub));
  assertFalse(set.isEmpty());
  assertEquals(NUM - 10,set.size());
  for (  Integer i : sub) {
    assertFalse(set.contains(i));
  }
  assertFalse(set.containsAll(sub));
  List<Integer> sub2=new LinkedList<Integer>();
  for (int i=10; i < NUM; i++) {
    sub2.add(list.get(i));
  }
  assertTrue(set.containsAll(sub2));
  Integer[] array=set.toArray(new Integer[0]);
  assertEquals(NUM - 10,array.length);
  for (int i=0; i < array.length; i++) {
    assertTrue(sub2.contains(array[i]));
  }
  assertEquals(NUM - 10,set.size());
  Object[] array2=set.toArray();
  assertEquals(NUM - 10,array2.length);
  for (int i=0; i < array2.length; i++) {
    assertTrue(sub2.contains(array2[i]));
  }
  LOG.info("Test other - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPollNMultiArray(){
  LOG.info("Test pollN multi array");
  set.addAll(list);
  Integer[] poll=new Integer[10];
  poll=set.pollToArray(poll);
  assertEquals(10,poll.length);
  for (  Integer i : poll) {
    assertTrue(list.contains(i));
    assertFalse(set.contains(i));
  }
  poll=new Integer[NUM];
  poll=set.pollToArray(poll);
  assertEquals(NUM - 10,poll.length);
  for (int i=0; i < NUM - 10; i++) {
    assertTrue(list.contains(poll[i]));
  }
  assertTrue(set.isEmpty());
  assertEquals(0,set.size());
  set.addAll(list);
  poll=new Integer[NUM];
  poll=set.pollToArray(poll);
  assertTrue(set.isEmpty());
  assertEquals(0,set.size());
  assertEquals(NUM,poll.length);
  for (int i=0; i < NUM; i++) {
    assertTrue(list.contains(poll[i]));
  }
  set.addAll(list);
  poll=new Integer[0];
  poll=set.pollToArray(poll);
  for (int i=0; i < NUM; i++) {
    assertTrue(set.contains(list.get(i)));
  }
  assertEquals(0,poll.length);
  LOG.info("Test pollN multi array- DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPollAll(){
  LOG.info("Test poll all");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  List<Integer> poll=set.pollAll();
  assertEquals(0,set.size());
  assertTrue(set.isEmpty());
  for (int i=0; i < NUM; i++) {
    assertFalse(set.contains(list.get(i)));
  }
  for (  Integer i : poll) {
    assertTrue(list.contains(i));
  }
  Iterator<Integer> iter=set.iterator();
  assertFalse(iter.hasNext());
  LOG.info("Test poll all - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRemoveMulti(){
  LOG.info("Test remove multi");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  for (int i=0; i < NUM / 2; i++) {
    assertTrue(set.remove(list.get(i)));
  }
  for (int i=0; i < NUM / 2; i++) {
    assertFalse(set.contains(list.get(i)));
  }
  for (int i=NUM / 2; i < NUM; i++) {
    assertTrue(set.contains(list.get(i)));
  }
  LOG.info("Test remove multi - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRemoveAll(){
  LOG.info("Test remove all");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  for (int i=0; i < NUM; i++) {
    assertTrue(set.remove(list.get(i)));
  }
  for (int i=0; i < NUM; i++) {
    assertFalse(set.contains(list.get(i)));
  }
  Iterator<Integer> iter=set.iterator();
  assertFalse(iter.hasNext());
  assertTrue(set.isEmpty());
  LOG.info("Test remove all - DONE");
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiBasic(){
  LOG.info("Test multi element basic");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  assertEquals(list.size(),set.size());
  for (  Integer i : list) {
    assertTrue(set.contains(i));
  }
  for (  Integer i : list) {
    assertFalse(set.add(i));
  }
  for (  Integer i : list) {
    assertTrue(set.contains(i));
  }
  Iterator<Integer> iter=set.iterator();
  int num=0;
  while (iter.hasNext()) {
    Integer next=iter.next();
    assertNotNull(next);
    assertTrue(list.contains(next));
    num++;
  }
  assertEquals(list.size(),num);
  LOG.info("Test multi element basic - DONE");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.util.TestLightWeightLinkedSet </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPollMulti(){
  LOG.info("Test poll multi");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  for (int i=0; i < NUM / 2; i++) {
    assertEquals(list.get(i),set.pollFirst());
  }
  assertEquals(NUM / 2,set.size());
  for (int i=0; i < NUM / 2; i++) {
    assertFalse(set.contains(list.get(i)));
  }
  for (int i=NUM / 2; i < NUM; i++) {
    assertTrue(set.contains(list.get(i)));
  }
  Iterator<Integer> iter=set.iterator();
  int num=NUM / 2;
  while (iter.hasNext()) {
    assertEquals(list.get(num++),iter.next());
  }
  assertEquals(num,NUM);
  for (int i=0; i < NUM / 2; i++) {
    assertTrue(set.add(list.get(i)));
  }
  assertEquals(NUM,set.size());
  for (int i=NUM / 2; i < NUM; i++) {
    assertEquals(list.get(i),set.pollFirst());
  }
  for (int i=0; i < NUM / 2; i++) {
    assertEquals(list.get(i),set.pollFirst());
  }
  assertEquals(0,set.size());
  assertTrue(set.isEmpty());
  LOG.info("Test poll multi - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRemoveMulti(){
  LOG.info("Test remove multi");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  for (int i=0; i < NUM / 2; i++) {
    assertTrue(set.remove(list.get(i)));
  }
  for (int i=0; i < NUM / 2; i++) {
    assertFalse(set.contains(list.get(i)));
  }
  for (int i=NUM / 2; i < NUM; i++) {
    assertTrue(set.contains(list.get(i)));
  }
  Iterator<Integer> iter=set.iterator();
  int num=NUM / 2;
  while (iter.hasNext()) {
    assertEquals(list.get(num++),iter.next());
  }
  assertEquals(num,NUM);
  LOG.info("Test remove multi - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiBasic(){
  LOG.info("Test multi element basic");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  assertEquals(list.size(),set.size());
  for (  Integer i : list) {
    assertTrue(set.contains(i));
  }
  for (  Integer i : list) {
    assertFalse(set.add(i));
  }
  for (  Integer i : list) {
    assertTrue(set.contains(i));
  }
  Iterator<Integer> iter=set.iterator();
  int num=0;
  while (iter.hasNext()) {
    assertEquals(list.get(num++),iter.next());
  }
  assertEquals(list.size(),num);
  LOG.info("Test multi element basic - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPollAll(){
  LOG.info("Test poll all");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  while (set.pollFirst() != null)   ;
  assertEquals(0,set.size());
  assertTrue(set.isEmpty());
  for (int i=0; i < NUM; i++) {
    assertFalse(set.contains(list.get(i)));
  }
  Iterator<Integer> iter=set.iterator();
  assertFalse(iter.hasNext());
  LOG.info("Test poll all - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRemoveAll(){
  LOG.info("Test remove all");
  for (  Integer i : list) {
    assertTrue(set.add(i));
  }
  for (int i=0; i < NUM; i++) {
    assertTrue(set.remove(list.get(i)));
  }
  for (int i=0; i < NUM; i++) {
    assertFalse(set.contains(list.get(i)));
  }
  Iterator<Integer> iter=set.iterator();
  assertFalse(iter.hasNext());
  assertTrue(set.isEmpty());
  LOG.info("Test remove all - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOther(){
  LOG.info("Test other");
  assertTrue(set.addAll(list));
  Integer[] array=set.toArray(new Integer[0]);
  assertEquals(NUM,array.length);
  for (int i=0; i < array.length; i++) {
    assertTrue(list.contains(array[i]));
  }
  assertEquals(NUM,set.size());
  Object[] array2=set.toArray();
  assertEquals(NUM,array2.length);
  for (int i=0; i < array2.length; i++) {
    assertTrue(list.contains(array2[i]));
  }
  LOG.info("Test capacity - DONE");
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPollNMulti(){
  LOG.info("Test pollN multi");
  set.addAll(list);
  List<Integer> l=set.pollN(10);
  assertEquals(10,l.size());
  for (int i=0; i < 10; i++) {
    assertEquals(list.get(i),l.get(i));
  }
  l=set.pollN(1000);
  assertEquals(NUM - 10,l.size());
  for (int i=10; i < NUM; i++) {
    assertEquals(list.get(i),l.get(i - 10));
  }
  assertTrue(set.isEmpty());
  assertEquals(0,set.size());
  LOG.info("Test pollN multi - DONE");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.web.TestJsonUtil </h4><pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testToXAttrMap() throws IOException {
  String jsonString="{\"XAttrs\":[{\"name\":\"user.a1\",\"value\":\"0x313233\"}," + "{\"name\":\"user.a2\",\"value\":\"0x313131\"}]}";
  Map<?,?> json=(Map<?,?>)JSON.parse(jsonString);
  XAttr xAttr1=(new XAttr.Builder()).setNameSpace(XAttr.NameSpace.USER).setName("a1").setValue(XAttrCodec.decodeValue("0x313233")).build();
  XAttr xAttr2=(new XAttr.Builder()).setNameSpace(XAttr.NameSpace.USER).setName("a2").setValue(XAttrCodec.decodeValue("0x313131")).build();
  List<XAttr> xAttrs=Lists.newArrayList();
  xAttrs.add(xAttr1);
  xAttrs.add(xAttr2);
  Map<String,byte[]> xAttrMap=XAttrHelper.buildXAttrMap(xAttrs);
  Map<String,byte[]> parsedXAttrMap=JsonUtil.toXAttrs(json);
  Assert.assertEquals(xAttrMap.size(),parsedXAttrMap.size());
  Iterator<Entry<String,byte[]>> iter=xAttrMap.entrySet().iterator();
  while (iter.hasNext()) {
    Entry<String,byte[]> entry=iter.next();
    Assert.assertArrayEquals(entry.getValue(),parsedXAttrMap.get(entry.getKey()));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.web.TestWebHDFS </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testLargeDirectory() throws Exception {
  final Configuration conf=WebHdfsTestUtil.createConf();
  final int listLimit=2;
  conf.setInt(DFSConfigKeys.DFS_LIST_LIMIT,listLimit);
  FsPermission.setUMask(conf,new FsPermission((short)0077));
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
  try {
    cluster.waitActive();
    WebHdfsTestUtil.getWebHdfsFileSystem(conf,WebHdfsFileSystem.SCHEME).setPermission(new Path("/"),new FsPermission(FsAction.ALL,FsAction.ALL,FsAction.ALL));
    UserGroupInformation.setLoginUser(UserGroupInformation.createUserForTesting("not-superuser",new String[]{"not-supergroup"}));
    UserGroupInformation.createUserForTesting("me",new String[]{"my-group"}).doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws IOException, URISyntaxException {
        FileSystem fs=WebHdfsTestUtil.getWebHdfsFileSystem(conf,WebHdfsFileSystem.SCHEME);
        Path d=new Path("/my-dir");
        Assert.assertTrue(fs.mkdirs(d));
        for (int i=0; i < listLimit * 3; i++) {
          Path p=new Path(d,"file-" + i);
          Assert.assertTrue(fs.createNewFile(p));
        }
        Assert.assertEquals(listLimit * 3,fs.listStatus(d).length);
        return null;
      }
    }
);
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.web.TestWebHdfsWithMultipleNameNodes </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRedirect() throws Exception {
  final String dir="/testRedirect/";
  final String filename="file";
  final Path p=new Path(dir,filename);
  final String[] writeStrings=createStrings("write to webhdfs ","write");
  final String[] appendStrings=createStrings("append to webhdfs ","append");
  for (int i=0; i < webhdfs.length; i++) {
    final FSDataOutputStream out=webhdfs[i].create(p);
    out.write(writeStrings[i].getBytes());
    out.close();
  }
  for (int i=0; i < webhdfs.length; i++) {
    final long expected=writeStrings[i].length();
    Assert.assertEquals(expected,webhdfs[i].getFileStatus(p).getLen());
  }
  for (int i=0; i < webhdfs.length; i++) {
    final FSDataInputStream in=webhdfs[i].open(p);
    for (int c, j=0; (c=in.read()) != -1; j++) {
      Assert.assertEquals(writeStrings[i].charAt(j),c);
    }
    in.close();
  }
  for (int i=0; i < webhdfs.length; i++) {
    final FSDataOutputStream out=webhdfs[i].append(p);
    out.write(appendStrings[i].getBytes());
    out.close();
  }
  for (int i=0; i < webhdfs.length; i++) {
    final long expected=writeStrings[i].length() + appendStrings[i].length();
    Assert.assertEquals(expected,webhdfs[i].getFileStatus(p).getLen());
  }
  for (int i=0; i < webhdfs.length; i++) {
    final StringBuilder b=new StringBuilder();
    final FSDataInputStream in=webhdfs[i].open(p);
    for (int c; (c=in.read()) != -1; ) {
      b.append((char)c);
    }
    final int wlen=writeStrings[i].length();
    Assert.assertEquals(writeStrings[i],b.substring(0,wlen));
    Assert.assertEquals(appendStrings[i],b.substring(wlen));
    in.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hdfs.web.resources.TestParam </h4><pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testConcatSourcesParam(){
  final String[] strings={"/","/foo","/bar"};
  for (int n=0; n < strings.length; n++) {
    final String[] sub=new String[n];
    final Path[] paths=new Path[n];
    for (int i=0; i < paths.length; i++) {
      paths[i]=new Path(sub[i]=strings[i]);
    }
    final String expected=StringUtils.join(",",Arrays.asList(sub));
    final ConcatSourcesParam computed=new ConcatSourcesParam(paths);
    Assert.assertEquals(expected,computed.getValue());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.http.TestGlobalFilter </h4><pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testServletFilter() throws Exception {
  Configuration conf=new Configuration();
  conf.set(HttpServer2.FILTER_INITIALIZER_PROPERTY,RecordingFilter.Initializer.class.getName());
  HttpServer2 http=createTestServer(conf);
  http.start();
  final String fsckURL="/fsck";
  final String stacksURL="/stacks";
  final String ajspURL="/a.jsp";
  final String listPathsURL="/listPaths";
  final String dataURL="/data";
  final String streamFile="/streamFile";
  final String rootURL="/";
  final String allURL="/*";
  final String outURL="/static/a.out";
  final String logURL="/logs/a.log";
  final String[] urls={fsckURL,stacksURL,ajspURL,listPathsURL,dataURL,streamFile,rootURL,allURL,outURL,logURL};
  final String prefix="http://" + NetUtils.getHostPortString(http.getConnectorAddress(0));
  try {
    for (int i=0; i < urls.length; i++) {
      access(prefix + urls[i]);
    }
  }
  finally {
    http.stop();
  }
  LOG.info("RECORDS = " + RECORDS);
  for (int i=0; i < urls.length; i++) {
    assertTrue(RECORDS.remove(urls[i]));
  }
  assertTrue(RECORDS.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.http.TestPathFilter </h4><pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testPathSpecFilters() throws Exception {
  Configuration conf=new Configuration();
  conf.set(HttpServer2.FILTER_INITIALIZER_PROPERTY,RecordingFilter.Initializer.class.getName());
  String[] pathSpecs={"/path","/path/*"};
  HttpServer2 http=createTestServer(conf,pathSpecs);
  http.start();
  final String baseURL="/path";
  final String baseSlashURL="/path/";
  final String addedURL="/path/nodes";
  final String addedSlashURL="/path/nodes/";
  final String longURL="/path/nodes/foo/job";
  final String rootURL="/";
  final String allURL="/*";
  final String[] filteredUrls={baseURL,baseSlashURL,addedURL,addedSlashURL,longURL};
  final String[] notFilteredUrls={rootURL,allURL};
  final String prefix="http://" + NetUtils.getHostPortString(http.getConnectorAddress(0));
  try {
    for (int i=0; i < filteredUrls.length; i++) {
      access(prefix + filteredUrls[i]);
    }
    for (int i=0; i < notFilteredUrls.length; i++) {
      access(prefix + notFilteredUrls[i]);
    }
  }
  finally {
    http.stop();
  }
  LOG.info("RECORDS = " + RECORDS);
  for (int i=0; i < filteredUrls.length; i++) {
    assertTrue(RECORDS.remove(filteredUrls[i]));
  }
  assertTrue(RECORDS.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.http.TestServletFilter </h4><pre class="type-13 type-11 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testServletFilter() throws Exception {
  Configuration conf=new Configuration();
  conf.set(HttpServer2.FILTER_INITIALIZER_PROPERTY,SimpleFilter.Initializer.class.getName());
  HttpServer2 http=createTestServer(conf);
  http.start();
  final String fsckURL="/fsck";
  final String stacksURL="/stacks";
  final String ajspURL="/a.jsp";
  final String logURL="/logs/a.log";
  final String hadooplogoURL="/static/hadoop-logo.jpg";
  final String[] urls={fsckURL,stacksURL,ajspURL,logURL,hadooplogoURL};
  final Random ran=new Random();
  final int[] sequence=new int[50];
  for (int i=0; i < sequence.length; i++) {
    sequence[i]=ran.nextInt(urls.length);
  }
  final String prefix="http://" + NetUtils.getHostPortString(http.getConnectorAddress(0));
  try {
    for (int i=0; i < sequence.length; i++) {
      access(prefix + urls[sequence[i]]);
      if (sequence[i] == 0) {
        assertEquals(null,uri);
      }
 else {
        assertEquals(urls[sequence[i]],uri);
        uri=null;
      }
    }
  }
  finally {
    http.stop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.TestArrayPrimitiveWritable </h4><pre class="type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMany() throws IOException {
  for (  Object x : bigSet) {
    ObjectWritable.writeObject(out,x,x.getClass(),null,true);
    (new ArrayPrimitiveWritable(x)).write(out);
  }
  in.reset(out.getData(),out.getLength());
  for (int x=0; x < resultSet.length; ) {
    resultSet[x++]=ObjectWritable.readObject(in,null);
    ArrayPrimitiveWritable apw=new ArrayPrimitiveWritable();
    apw.readFields(in);
    resultSet[x++]=apw.get();
  }
  assertEquals(expectedResultSet.length,resultSet.length);
  for (int x=0; x < resultSet.length; x++) {
    assertEquals("ComponentType of array " + x,expectedResultSet[x].getClass().getComponentType(),resultSet[x].getClass().getComponentType());
  }
  assertTrue("In and Out arrays didn't match values",Arrays.deepEquals(expectedResultSet,resultSet));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.TestBytesWritable </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSizeChange() throws Exception {
  byte[] hadoop="hadoop".getBytes();
  BytesWritable buf=new BytesWritable(hadoop);
  int size=buf.getLength();
  int orig_capacity=buf.getCapacity();
  buf.setSize(size * 2);
  int new_capacity=buf.getCapacity();
  System.arraycopy(buf.getBytes(),0,buf.getBytes(),size,size);
  assertTrue(new_capacity >= size * 2);
  assertEquals(size * 2,buf.getLength());
  assertTrue(new_capacity != orig_capacity);
  buf.setSize(size * 4);
  assertTrue(new_capacity != buf.getCapacity());
  for (int i=0; i < size * 2; ++i) {
    assertEquals(hadoop[i % size],buf.getBytes()[i]);
  }
  assertEquals(size * 4,buf.copyBytes().length);
  buf.setCapacity(1);
  assertEquals(1,buf.getLength());
  assertEquals(hadoop[0],buf.getBytes()[0]);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testCompare() throws Exception {
  byte[][] values=new byte[][]{"abc".getBytes(),"ad".getBytes(),"abcd".getBytes(),"".getBytes(),"b".getBytes()};
  BytesWritable[] buf=new BytesWritable[values.length];
  for (int i=0; i < values.length; ++i) {
    buf[i]=new BytesWritable(values[i]);
  }
  for (int i=0; i < values.length; ++i) {
    for (int j=0; j < values.length; ++j) {
      assertTrue(buf[i].compareTo(buf[j]) == -buf[j].compareTo(buf[i]));
      assertTrue((i == j) == (buf[i].compareTo(buf[j]) == 0));
    }
  }
  assertTrue(buf[0].compareTo(buf[1]) < 0);
  assertTrue(buf[1].compareTo(buf[2]) > 0);
  assertTrue(buf[2].compareTo(buf[3]) > 0);
  assertTrue(buf[3].compareTo(buf[4]) < 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.TestIOUtils </h4><pre class="type-13 type-6 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testWriteFully() throws IOException {
  final int INPUT_BUFFER_LEN=10000;
  final int HALFWAY=1 + (INPUT_BUFFER_LEN / 2);
  byte[] input=new byte[INPUT_BUFFER_LEN];
  for (int i=0; i < input.length; i++) {
    input[i]=(byte)(i & 0xff);
  }
  byte[] output=new byte[input.length];
  try {
    RandomAccessFile raf=new RandomAccessFile(TEST_FILE_NAME,"rw");
    FileChannel fc=raf.getChannel();
    ByteBuffer buf=ByteBuffer.wrap(input);
    IOUtils.writeFully(fc,buf);
    raf.seek(0);
    raf.read(output);
    for (int i=0; i < input.length; i++) {
      assertEquals(input[i],output[i]);
    }
    buf.rewind();
    IOUtils.writeFully(fc,buf,HALFWAY);
    for (int i=0; i < HALFWAY; i++) {
      assertEquals(input[i],output[i]);
    }
    raf.seek(0);
    raf.read(output);
    for (int i=HALFWAY; i < input.length; i++) {
      assertEquals(input[i - HALFWAY],output[i]);
    }
    raf.close();
  }
  finally {
    File f=new File(TEST_FILE_NAME);
    if (f.exists()) {
      f.delete();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.TestMapFile </h4><pre class="type-9 type-13 type-2 type-7 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test {@code MapFile.Reader.next(key, value)} for iteration.
 */
@Test public void testReaderKeyIteration(){
  final String TEST_METHOD_KEY="testReaderKeyIteration.mapfile";
  int SIZE=10;
  int ITERATIONS=5;
  MapFile.Writer writer=null;
  MapFile.Reader reader=null;
  try {
    writer=createWriter(TEST_METHOD_KEY,IntWritable.class,Text.class);
    int start=0;
    for (int i=0; i < SIZE; i++)     writer.append(new IntWritable(i),new Text("Value:" + i));
    writer.close();
    reader=createReader(TEST_METHOD_KEY,IntWritable.class);
    Writable startValue=new Text("Value:" + start);
    int i=0;
    while (i++ < ITERATIONS) {
      IntWritable key=new IntWritable(start);
      Writable value=startValue;
      while (reader.next(key,value)) {
        assertNotNull(key);
        assertNotNull(value);
      }
      reader.reset();
    }
    assertTrue("reader seek error !!!",reader.seek(new IntWritable(SIZE / 2)));
    assertFalse("reader seek error !!!",reader.seek(new IntWritable(SIZE * 2)));
  }
 catch (  IOException ex) {
    fail("reader seek error !!!");
  }
 finally {
    IOUtils.cleanup(null,writer,reader);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.TestSortedMapWritable </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * the test 
 */
@Test @SuppressWarnings("unchecked") public void testSortedMapWritable(){
  Text[] keys={new Text("key1"),new Text("key2"),new Text("key3")};
  BytesWritable[] values={new BytesWritable("value1".getBytes()),new BytesWritable("value2".getBytes()),new BytesWritable("value3".getBytes())};
  SortedMapWritable inMap=new SortedMapWritable();
  for (int i=0; i < keys.length; i++) {
    inMap.put(keys[i],values[i]);
  }
  assertEquals(0,inMap.firstKey().compareTo(keys[0]));
  assertEquals(0,inMap.lastKey().compareTo(keys[2]));
  SortedMapWritable outMap=new SortedMapWritable(inMap);
  assertEquals(inMap.size(),outMap.size());
  for (  Map.Entry<WritableComparable,Writable> e : inMap.entrySet()) {
    assertTrue(outMap.containsKey(e.getKey()));
    assertEquals(0,((WritableComparable)outMap.get(e.getKey())).compareTo(e.getValue()));
  }
  Text[] maps={new Text("map1"),new Text("map2")};
  SortedMapWritable mapOfMaps=new SortedMapWritable();
  mapOfMaps.put(maps[0],inMap);
  mapOfMaps.put(maps[1],outMap);
  SortedMapWritable copyOfMapOfMaps=new SortedMapWritable(mapOfMaps);
  for (int i=0; i < maps.length; i++) {
    assertTrue(copyOfMapOfMaps.containsKey(maps[i]));
    SortedMapWritable a=(SortedMapWritable)mapOfMaps.get(maps[i]);
    SortedMapWritable b=(SortedMapWritable)copyOfMapOfMaps.get(maps[i]);
    assertEquals(a.size(),b.size());
    for (    Writable key : a.keySet()) {
      assertTrue(b.containsKey(key));
      WritableComparable aValue=(WritableComparable)a.get(key);
      WritableComparable bValue=(WritableComparable)b.get(key);
      assertEquals(0,aValue.compareTo(bValue));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.compress.TestCodec </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGzipLongOverflow() throws IOException {
  LOG.info("testGzipLongOverflow");
  Configuration conf=new Configuration();
  conf.setBoolean(CommonConfigurationKeys.IO_NATIVE_LIB_AVAILABLE_KEY,false);
  assertFalse("ZlibFactory is using native libs against request",ZlibFactory.isNativeZlibLoaded(conf));
  Decompressor zlibDecompressor=ZlibFactory.getZlibDecompressor(conf);
  assertNotNull("zlibDecompressor is null!",zlibDecompressor);
  assertTrue("ZlibFactory returned unexpected inflator",zlibDecompressor instanceof BuiltInZlibInflater);
  CodecPool.returnDecompressor(zlibDecompressor);
  String tmpDir=System.getProperty("test.build.data","/tmp/");
  Path f=new Path(new Path(tmpDir),"testGzipLongOverflow.bin.gz");
  BufferedWriter bw=new BufferedWriter(new OutputStreamWriter(new GZIPOutputStream(new FileOutputStream(f.toString()))));
  final int NBUF=1024 * 4 + 1;
  final char[] buf=new char[1024 * 1024];
  for (int i=0; i < buf.length; i++)   buf[i]='\0';
  for (int i=0; i < NBUF; i++) {
    bw.write(buf);
  }
  bw.close();
  CompressionCodecFactory ccf=new CompressionCodecFactory(conf);
  CompressionCodec codec=ccf.getCodec(f);
  Decompressor decompressor=CodecPool.getDecompressor(codec);
  FileSystem fs=FileSystem.getLocal(conf);
  InputStream is=fs.open(f);
  is=codec.createInputStream(is,decompressor);
  BufferedReader br=new BufferedReader(new InputStreamReader(is));
  for (int j=0; j < NBUF; j++) {
    int n=br.read(buf);
    assertEquals("got wrong read length!",n,buf.length);
    for (int i=0; i < buf.length; i++)     assertEquals("got wrong byte!",buf[i],'\0');
  }
  br.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.file.tfile.TestTFileComparator2 </h4><pre class="type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSortedLongWritable() throws IOException {
  Configuration conf=new Configuration();
  Path path=new Path(ROOT,name);
  FileSystem fs=path.getFileSystem(conf);
  FSDataOutputStream out=fs.create(path);
  try {
    TFile.Writer writer=new Writer(out,BLOCK_SIZE,"gz",jClassLongWritableComparator,conf);
    try {
      LongWritable key=new LongWritable(0);
      for (long i=0; i < NENTRY; ++i) {
        key.set(cube(i - NENTRY / 2));
        DataOutputStream dos=writer.prepareAppendKey(-1);
        try {
          key.write(dos);
        }
  finally {
          dos.close();
        }
        dos=writer.prepareAppendValue(-1);
        try {
          dos.write(buildValue(i).getBytes());
        }
  finally {
          dos.close();
        }
      }
    }
  finally {
      writer.close();
    }
  }
  finally {
    out.close();
  }
  FSDataInputStream in=fs.open(path);
  try {
    TFile.Reader reader=new TFile.Reader(in,fs.getFileStatus(path).getLen(),conf);
    try {
      TFile.Reader.Scanner scanner=reader.createScanner();
      long i=0;
      BytesWritable value=new BytesWritable();
      for (; !scanner.atEnd(); scanner.advance()) {
        scanner.entry().getValue(value);
        assertEquals(buildValue(i),new String(value.getBytes(),0,value.getLength()));
        ++i;
      }
    }
  finally {
      reader.close();
    }
  }
  finally {
    in.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.nativeio.TestNativeIO </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for races in fstat usage
 * NOTE: this test is likely to fail on RHEL 6.0 which has a non-threadsafe
 * implementation of getpwuid_r.
 */
@Test(timeout=30000) public void testMultiThreadedFstat() throws Exception {
  if (Path.WINDOWS) {
    return;
  }
  final FileOutputStream fos=new FileOutputStream(new File(TEST_DIR,"testfstat"));
  final AtomicReference<Throwable> thrown=new AtomicReference<Throwable>();
  List<Thread> statters=new ArrayList<Thread>();
  for (int i=0; i < 10; i++) {
    Thread statter=new Thread(){
      @Override public void run(){
        long et=Time.now() + 5000;
        while (Time.now() < et) {
          try {
            NativeIO.POSIX.Stat stat=NativeIO.POSIX.getFstat(fos.getFD());
            assertEquals(System.getProperty("user.name"),stat.getOwner());
            assertNotNull(stat.getGroup());
            assertTrue(!stat.getGroup().isEmpty());
            assertEquals("Stat mode field should indicate a regular file",NativeIO.POSIX.Stat.S_IFREG,stat.getMode() & NativeIO.POSIX.Stat.S_IFMT);
          }
 catch (          Throwable t) {
            thrown.set(t);
          }
        }
      }
    }
;
    statters.add(statter);
    statter.start();
  }
  for (  Thread t : statters) {
    t.join();
  }
  fos.close();
  if (thrown.get() != null) {
    throw new RuntimeException(thrown.get());
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that opens and closes a file 10000 times - this would crash with
 * "Too many open files" if we leaked fds using this access pattern.
 */
@Test(timeout=30000) public void testFDDoesntLeak() throws IOException {
  if (Path.WINDOWS) {
    return;
  }
  for (int i=0; i < 10000; i++) {
    FileDescriptor fd=NativeIO.POSIX.open(new File(TEST_DIR,"testNoFdLeak").getAbsolutePath(),NativeIO.POSIX.O_WRONLY | NativeIO.POSIX.O_CREAT,0700);
    assertNotNull(true);
    assertTrue(fd.valid());
    FileOutputStream fos=new FileOutputStream(fd);
    fos.write("foo".getBytes());
    fos.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.io.retry.TestFailoverProxy </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSucceedsTenTimesThenFailOver() throws UnreliableException, IOException, StandbyException {
  UnreliableInterface unreliable=(UnreliableInterface)RetryProxy.create(UnreliableInterface.class,newFlipFlopProxyProvider(),new FailOverOnceOnAnyExceptionPolicy());
  for (int i=0; i < 10; i++) {
    assertEquals("impl1",unreliable.succeedsTenTimesThenFailsReturningString());
  }
  assertEquals("impl2",unreliable.succeedsTenTimesThenFailsReturningString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.ipc.TestIPC </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testConnectionIdleTimeouts() throws Exception {
  ((Log4JLogger)Server.LOG).getLogger().setLevel(Level.DEBUG);
  final int maxIdle=1000;
  final int cleanupInterval=maxIdle * 3 / 4;
  final int killMax=3;
  final int clients=1 + killMax * 2;
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,maxIdle);
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_IDLETHRESHOLD_KEY,0);
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_KILL_MAX_KEY,killMax);
  conf.setInt(CommonConfigurationKeys.IPC_CLIENT_CONNECTION_IDLESCANINTERVAL_KEY,cleanupInterval);
  final CyclicBarrier firstCallBarrier=new CyclicBarrier(2);
  final CyclicBarrier callBarrier=new CyclicBarrier(clients);
  final CountDownLatch allCallLatch=new CountDownLatch(clients);
  final AtomicBoolean error=new AtomicBoolean();
  final TestServer server=new TestServer(clients,false);
  Thread[] threads=new Thread[clients];
  try {
    server.callListener=new Runnable(){
      AtomicBoolean first=new AtomicBoolean(true);
      @Override public void run(){
        try {
          allCallLatch.countDown();
          if (first.compareAndSet(true,false)) {
            firstCallBarrier.await();
          }
 else {
            callBarrier.await();
          }
        }
 catch (        Throwable t) {
          LOG.error(t);
          error.set(true);
        }
      }
    }
;
    server.start();
    final CountDownLatch callReturned=new CountDownLatch(clients - 1);
    final InetSocketAddress addr=NetUtils.getConnectAddress(server);
    final Configuration clientConf=new Configuration();
    clientConf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,10000);
    for (int i=0; i < clients; i++) {
      threads[i]=new Thread(new Runnable(){
        @Override public void run(){
          Client client=new Client(LongWritable.class,clientConf);
          try {
            client.call(new LongWritable(Thread.currentThread().getId()),addr,null,null,0,clientConf);
            callReturned.countDown();
            Thread.sleep(10000);
          }
 catch (          IOException e) {
            LOG.error(e);
          }
catch (          InterruptedException e) {
          }
        }
      }
);
      threads[i].start();
    }
    allCallLatch.await();
    assertFalse(error.get());
    assertEquals(clients,server.getNumOpenConnections());
    callBarrier.await();
    callReturned.await();
    assertEquals(clients,server.getNumOpenConnections());
    Thread.sleep(maxIdle * 2 - cleanupInterval);
    for (int i=clients; i > 1; i-=killMax) {
      Thread.sleep(cleanupInterval);
      assertFalse(error.get());
      assertEquals(i,server.getNumOpenConnections());
    }
    Thread.sleep(cleanupInterval);
    assertFalse(error.get());
    assertEquals(1,server.getNumOpenConnections());
    firstCallBarrier.await();
    Thread.sleep(maxIdle * 2);
    assertFalse(error.get());
    assertEquals(0,server.getNumOpenConnections());
  }
  finally {
    for (    Thread t : threads) {
      if (t != null) {
        t.interrupt();
        t.join();
      }
      server.stop();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that client generates a unique sequential call ID for each RPC call,
 * even if multiple threads are using the same client.
 * @throws InterruptedException 
 */
@Test(timeout=60000) public void testUniqueSequentialCallIds() throws IOException, InterruptedException {
  int serverThreads=10, callerCount=100, perCallerCallCount=100;
  TestServer server=new TestServer(serverThreads,false);
  final List<Integer> callIds=Collections.synchronizedList(new ArrayList<Integer>());
  server.callListener=new Runnable(){
    @Override public void run(){
      callIds.add(Server.getCallId());
    }
  }
;
  Client client=new Client(LongWritable.class,conf);
  try {
    InetSocketAddress addr=NetUtils.getConnectAddress(server);
    server.start();
    SerialCaller[] callers=new SerialCaller[callerCount];
    for (int i=0; i < callerCount; ++i) {
      callers[i]=new SerialCaller(client,addr,perCallerCallCount);
      callers[i].start();
    }
    for (int i=0; i < callerCount; ++i) {
      callers[i].join();
      assertFalse(callers[i].failed);
    }
  }
  finally {
    client.stop();
    server.stop();
  }
  int expectedCallCount=callerCount * perCallerCallCount;
  assertEquals(expectedCallCount,callIds.size());
  Collections.sort(callIds);
  final int startID=callIds.get(0).intValue();
  for (int i=0; i < expectedCallCount; ++i) {
    assertEquals(startID + i,callIds.get(i).intValue());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.ipc.TestWeightedRoundRobinMultiplexer </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCustomPattern(){
  Configuration conf=new Configuration();
  conf.setStrings("test.custom." + IPC_CALLQUEUE_WRRMUX_WEIGHTS_KEY,"1","1");
  mux=new WeightedRoundRobinMultiplexer(2,"test.custom",conf);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  conf.setStrings("test.custom." + IPC_CALLQUEUE_WRRMUX_WEIGHTS_KEY,"1","3","2");
  mux=new WeightedRoundRobinMultiplexer(3,"test.custom",conf);
  for (int i=0; i < 5; i++) {
    assertEquals(mux.getAndAdvanceCurrentIndex(),0);
    assertEquals(mux.getAndAdvanceCurrentIndex(),1);
    assertEquals(mux.getAndAdvanceCurrentIndex(),1);
    assertEquals(mux.getAndAdvanceCurrentIndex(),1);
    assertEquals(mux.getAndAdvanceCurrentIndex(),2);
    assertEquals(mux.getAndAdvanceCurrentIndex(),2);
  }
}

</code></pre>

<br>
<pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDefaultPattern(){
  mux=new WeightedRoundRobinMultiplexer(1,"",new Configuration());
  for (int i=0; i < 10; i++) {
    assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  }
  mux=new WeightedRoundRobinMultiplexer(2,"",new Configuration());
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  mux=new WeightedRoundRobinMultiplexer(3,"",new Configuration());
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),2);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  mux=new WeightedRoundRobinMultiplexer(4,"",new Configuration());
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),1);
  assertEquals(mux.getAndAdvanceCurrentIndex(),2);
  assertEquals(mux.getAndAdvanceCurrentIndex(),2);
  assertEquals(mux.getAndAdvanceCurrentIndex(),3);
  assertEquals(mux.getAndAdvanceCurrentIndex(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestCombineSequenceFileInputFormat </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testFormat() throws Exception {
  JobConf job=new JobConf(conf);
  Reporter reporter=Reporter.NULL;
  Random random=new Random();
  long seed=random.nextLong();
  LOG.info("seed = " + seed);
  random.setSeed(seed);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(job,workDir);
  final int length=10000;
  final int numFiles=10;
  createFiles(length,numFiles,random);
  InputFormat<IntWritable,BytesWritable> format=new CombineSequenceFileInputFormat<IntWritable,BytesWritable>();
  IntWritable key=new IntWritable();
  BytesWritable value=new BytesWritable();
  for (int i=0; i < 3; i++) {
    int numSplits=random.nextInt(length / (SequenceFile.SYNC_INTERVAL / 20)) + 1;
    LOG.info("splitting: requesting = " + numSplits);
    InputSplit[] splits=format.getSplits(job,numSplits);
    LOG.info("splitting: got =        " + splits.length);
    assertEquals("We got more than one splits!",1,splits.length);
    InputSplit split=splits[0];
    assertEquals("It should be CombineFileSplit",CombineFileSplit.class,split.getClass());
    BitSet bits=new BitSet(length);
    RecordReader<IntWritable,BytesWritable> reader=format.getRecordReader(split,job,reporter);
    try {
      while (reader.next(key,value)) {
        assertFalse("Key in multiple partitions.",bits.get(key.get()));
        bits.set(key.get());
      }
    }
  finally {
      reader.close();
    }
    assertEquals("Some keys in no partition.",length,bits.cardinality());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestCombineTextInputFormat </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testFormat() throws Exception {
  JobConf job=new JobConf(defaultConf);
  Random random=new Random();
  long seed=random.nextLong();
  LOG.info("seed = " + seed);
  random.setSeed(seed);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(job,workDir);
  final int length=10000;
  final int numFiles=10;
  createFiles(length,numFiles,random);
  CombineTextInputFormat format=new CombineTextInputFormat();
  LongWritable key=new LongWritable();
  Text value=new Text();
  for (int i=0; i < 3; i++) {
    int numSplits=random.nextInt(length / 20) + 1;
    LOG.info("splitting: requesting = " + numSplits);
    InputSplit[] splits=format.getSplits(job,numSplits);
    LOG.info("splitting: got =        " + splits.length);
    assertEquals("We got more than one splits!",1,splits.length);
    InputSplit split=splits[0];
    assertEquals("It should be CombineFileSplit",CombineFileSplit.class,split.getClass());
    BitSet bits=new BitSet(length);
    LOG.debug("split= " + split);
    RecordReader<LongWritable,Text> reader=format.getRecordReader(split,job,voidReporter);
    try {
      int count=0;
      while (reader.next(key,value)) {
        int v=Integer.parseInt(value.toString());
        LOG.debug("read " + v);
        if (bits.get(v)) {
          LOG.warn("conflict with " + v + " at position "+ reader.getPos());
        }
        assertFalse("Key in multiple partitions.",bits.get(v));
        bits.set(v);
        count++;
      }
      LOG.info("splits=" + split + " count="+ count);
    }
  finally {
      reader.close();
    }
    assertEquals("Some keys in no partition.",length,bits.cardinality());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestConcatenatedCompressedInput </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using the raw Inflater codec for reading gzip files.
 */
@Test public void testPrototypeInflaterGzip() throws IOException {
  CompressionCodec gzip=new GzipCodec();
  localFs.delete(workDir,true);
  System.out.println(COLOR_BR_BLUE + "testPrototypeInflaterGzip() using " + "non-native/Java Inflater and manual gzip header/trailer parsing"+ COLOR_NORMAL);
  final String fn="concat" + gzip.getDefaultExtension();
  Path fnLocal=new Path(System.getProperty("test.concat.data","/tmp"),fn);
  Path fnHDFS=new Path(workDir,fn);
  localFs.copyFromLocalFile(fnLocal,fnHDFS);
  final FileInputStream in=new FileInputStream(fnLocal.toString());
  assertEquals("concat bytes available",148,in.available());
  byte[] compressedBuf=new byte[256];
  int numBytesRead=in.read(compressedBuf,0,10);
  assertEquals("header bytes read",10,numBytesRead);
  assertEquals("1st byte",0x1f,compressedBuf[0] & 0xff);
  assertEquals("2nd byte",0x8b,compressedBuf[1] & 0xff);
  assertEquals("3rd byte (compression method)",8,compressedBuf[2] & 0xff);
  byte flags=(byte)(compressedBuf[3] & 0xff);
  if ((flags & 0x04) != 0) {
    numBytesRead=in.read(compressedBuf,0,2);
    assertEquals("XLEN bytes read",2,numBytesRead);
    int xlen=((compressedBuf[1] << 8) | compressedBuf[0]) & 0xffff;
    in.skip(xlen);
  }
  if ((flags & 0x08) != 0) {
    while ((numBytesRead=in.read()) != 0) {
      assertFalse("unexpected end-of-file while reading filename",numBytesRead == -1);
    }
  }
  if ((flags & 0x10) != 0) {
    while ((numBytesRead=in.read()) != 0) {
      assertFalse("unexpected end-of-file while reading comment",numBytesRead == -1);
    }
  }
  if ((flags & 0xe0) != 0) {
    assertTrue("reserved bits are set??",(flags & 0xe0) == 0);
  }
  if ((flags & 0x02) != 0) {
    numBytesRead=in.read(compressedBuf,0,2);
    assertEquals("CRC16 bytes read",2,numBytesRead);
    int crc16=((compressedBuf[1] << 8) | compressedBuf[0]) & 0xffff;
  }
  numBytesRead=in.read(compressedBuf);
  byte[] uncompressedBuf=new byte[256];
  Inflater inflater=new Inflater(true);
  inflater.setInput(compressedBuf,0,numBytesRead);
  try {
    int numBytesUncompressed=inflater.inflate(uncompressedBuf);
    String outString=new String(uncompressedBuf,0,numBytesUncompressed,"UTF-8");
    System.out.println("uncompressed data of first gzip member = [" + outString + "]");
  }
 catch (  java.util.zip.DataFormatException ex) {
    throw new IOException(ex.getMessage());
  }
  in.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestCounters </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify counter value works
 */
@SuppressWarnings("deprecation") @Test public void testCounterValue(){
  Counters counters=new Counters();
  final int NUMBER_TESTS=100;
  final int NUMBER_INC=10;
  final Random rand=new Random();
  for (int i=0; i < NUMBER_TESTS; i++) {
    long initValue=rand.nextInt();
    long expectedValue=initValue;
    Counter counter=counters.findCounter("foo","bar");
    counter.setValue(initValue);
    assertEquals("Counter value is not initialized correctly",expectedValue,counter.getValue());
    for (int j=0; j < NUMBER_INC; j++) {
      int incValue=rand.nextInt();
      counter.increment(incValue);
      expectedValue+=incValue;
      assertEquals("Counter value is not incremented correctly",expectedValue,counter.getValue());
    }
    expectedValue=rand.nextInt();
    counter.setValue(expectedValue);
    assertEquals("Counter value is not set correctly",expectedValue,counter.getValue());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestFadvisedFileRegion </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=100000) public void testCustomShuffleTransfer() throws IOException {
  File absLogDir=new File("target",TestFadvisedFileRegion.class.getSimpleName() + "LocDir").getAbsoluteFile();
  String testDirPath=StringUtils.join(Path.SEPARATOR,new String[]{absLogDir.getAbsolutePath(),"testCustomShuffleTransfer"});
  File testDir=new File(testDirPath);
  testDir.mkdirs();
  System.out.println(testDir.getAbsolutePath());
  File inFile=new File(testDir,"fileIn.out");
  File outFile=new File(testDir,"fileOut.out");
  byte[] initBuff=new byte[FILE_SIZE];
  Random rand=new Random();
  rand.nextBytes(initBuff);
  FileOutputStream out=new FileOutputStream(inFile);
  try {
    out.write(initBuff);
  }
  finally {
    IOUtils.cleanup(LOG,out);
  }
  int position=2 * 1024 * 1024;
  int count=4 * 1024 * 1024 - 1;
  RandomAccessFile inputFile=null;
  RandomAccessFile targetFile=null;
  WritableByteChannel target=null;
  FadvisedFileRegion fileRegion=null;
  try {
    inputFile=new RandomAccessFile(inFile.getAbsolutePath(),"r");
    targetFile=new RandomAccessFile(outFile.getAbsolutePath(),"rw");
    target=targetFile.getChannel();
    Assert.assertEquals(FILE_SIZE,inputFile.length());
    fileRegion=new FadvisedFileRegion(inputFile,position,count,false,0,null,null,1024,false);
    customShuffleTransferCornerCases(fileRegion,target,count);
    long pos=0;
    long size;
    while ((size=fileRegion.customShuffleTransfer(target,pos)) > 0) {
      pos+=size;
    }
    Assert.assertEquals(count,(int)pos);
    Assert.assertEquals(count,targetFile.length());
  }
  finally {
    if (fileRegion != null) {
      fileRegion.releaseExternalResources();
    }
    IOUtils.cleanup(LOG,target);
    IOUtils.cleanup(LOG,targetFile);
    IOUtils.cleanup(LOG,inputFile);
  }
  byte[] buff=new byte[FILE_SIZE];
  FileInputStream in=new FileInputStream(outFile);
  try {
    int total=in.read(buff,0,count);
    Assert.assertEquals(count,total);
    for (int i=0; i < count; i++) {
      Assert.assertEquals(initBuff[position + i],buff[i]);
    }
  }
  finally {
    IOUtils.cleanup(LOG,in);
  }
  inFile.delete();
  outFile.delete();
  testDir.delete();
  absLogDir.delete();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestMapRed </h4><pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNullKeys() throws Exception {
  JobConf conf=new JobConf(TestMapRed.class);
  FileSystem fs=FileSystem.getLocal(conf);
  HashSet<String> values=new HashSet<String>();
  String m="AAAAAAAAAAAAAA";
  for (int i=1; i < 11; ++i) {
    values.add(m);
    m=m.replace((char)('A' + i - 1),(char)('A' + i));
  }
  Path testdir=new Path(System.getProperty("test.build.data","/tmp")).makeQualified(fs);
  fs.delete(testdir,true);
  Path inFile=new Path(testdir,"nullin/blah");
  SequenceFile.Writer w=SequenceFile.createWriter(fs,conf,inFile,NullWritable.class,Text.class,SequenceFile.CompressionType.NONE);
  Text t=new Text();
  for (  String s : values) {
    t.set(s);
    w.append(NullWritable.get(),t);
  }
  w.close();
  FileInputFormat.setInputPaths(conf,inFile);
  FileOutputFormat.setOutputPath(conf,new Path(testdir,"nullout"));
  conf.setMapperClass(NullMapper.class);
  conf.setReducerClass(IdentityReducer.class);
  conf.setOutputKeyClass(NullWritable.class);
  conf.setOutputValueClass(Text.class);
  conf.setInputFormat(SequenceFileInputFormat.class);
  conf.setOutputFormat(SequenceFileOutputFormat.class);
  conf.setNumReduceTasks(1);
  conf.set(MRConfig.FRAMEWORK_NAME,MRConfig.LOCAL_FRAMEWORK_NAME);
  JobClient.runJob(conf);
  SequenceFile.Reader r=new SequenceFile.Reader(fs,new Path(testdir,"nullout/part-00000"),conf);
  m="AAAAAAAAAAAAAA";
  for (int i=1; r.next(NullWritable.get(),t); ++i) {
    assertTrue("Unexpected value: " + t,values.remove(t.toString()));
    m=m.replace((char)('A' + i - 1),(char)('A' + i));
  }
  assertTrue("Missing values: " + values.toString(),values.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestShuffleHandler </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * simulate a reducer that sends an invalid shuffle-header - sometimes a wrong
 * header_name and sometimes a wrong version
 * @throws Exception exception
 */
@Test(timeout=10000) public void testIncompatibleShuffleVersion() throws Exception {
  final int failureNum=3;
  Configuration conf=new Configuration();
  conf.setInt(ShuffleHandler.SHUFFLE_PORT_CONFIG_KEY,0);
  ShuffleHandler shuffleHandler=new ShuffleHandler();
  shuffleHandler.init(conf);
  shuffleHandler.start();
  URL url=new URL("http://127.0.0.1:" + shuffleHandler.getConfig().get(ShuffleHandler.SHUFFLE_PORT_CONFIG_KEY) + "/mapOutput?job=job_12345_1&reduce=1&map=attempt_12345_1_m_1_0");
  for (int i=0; i < failureNum; ++i) {
    HttpURLConnection conn=(HttpURLConnection)url.openConnection();
    conn.setRequestProperty(ShuffleHeader.HTTP_HEADER_NAME,i == 0 ? "mapreduce" : "other");
    conn.setRequestProperty(ShuffleHeader.HTTP_HEADER_VERSION,i == 1 ? "1.0.0" : "1.0.1");
    conn.connect();
    Assert.assertEquals(HttpURLConnection.HTTP_BAD_REQUEST,conn.getResponseCode());
  }
  shuffleHandler.stop();
  shuffleHandler.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.TestTextInputFormat </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=500000) public void testFormat() throws Exception {
  JobConf job=new JobConf(defaultConf);
  Path file=new Path(workDir,"test.txt");
  Reporter reporter=Reporter.NULL;
  int seed=new Random().nextInt();
  LOG.info("seed = " + seed);
  Random random=new Random(seed);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(job,workDir);
  for (int length=0; length < MAX_LENGTH; length+=random.nextInt(MAX_LENGTH / 10) + 1) {
    LOG.debug("creating; entries = " + length);
    Writer writer=new OutputStreamWriter(localFs.create(file));
    try {
      for (int i=0; i < length; i++) {
        writer.write(Integer.toString(i));
        writer.write("\n");
      }
    }
  finally {
      writer.close();
    }
    TextInputFormat format=new TextInputFormat();
    format.configure(job);
    LongWritable key=new LongWritable();
    Text value=new Text();
    for (int i=0; i < 3; i++) {
      int numSplits=random.nextInt(MAX_LENGTH / 20) + 1;
      LOG.debug("splitting: requesting = " + numSplits);
      InputSplit[] splits=format.getSplits(job,numSplits);
      LOG.debug("splitting: got =        " + splits.length);
      if (length == 0) {
        assertEquals("Files of length 0 are not returned from FileInputFormat.getSplits().",1,splits.length);
        assertEquals("Empty file length == 0",0,splits[0].getLength());
      }
      BitSet bits=new BitSet(length);
      for (int j=0; j < splits.length; j++) {
        LOG.debug("split[" + j + "]= "+ splits[j]);
        RecordReader<LongWritable,Text> reader=format.getRecordReader(splits[j],job,reporter);
        try {
          int count=0;
          while (reader.next(key,value)) {
            int v=Integer.parseInt(value.toString());
            LOG.debug("read " + v);
            if (bits.get(v)) {
              LOG.warn("conflict with " + v + " in split "+ j+ " at position "+ reader.getPos());
            }
            assertFalse("Key in multiple partitions.",bits.get(v));
            bits.set(v);
            count++;
          }
          LOG.debug("splits[" + j + "]="+ splits[j]+ " count="+ count);
        }
  finally {
          reader.close();
        }
      }
      assertEquals("Some keys in no partition.",length,bits.cardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test readLine for correct interpretation of maxLineLength
 * (returned string should be clipped at maxLineLength, and the
 * remaining bytes on the same line should be thrown out).
 * Also check that returned value matches the string length.
 * Varies buffer size to stress test.
 * @throws Exception
 */
@Test(timeout=5000) public void testMaxLineLength() throws Exception {
  final String STR="a\nbb\n\nccc\rdddd\r\neeeee";
  final int STRLENBYTES=STR.getBytes().length;
  Text out=new Text();
  for (int bufsz=1; bufsz < STRLENBYTES + 1; ++bufsz) {
    LineReader in=makeStream(STR,bufsz);
    int c=0;
    c+=in.readLine(out,1);
    assertEquals("line1 length, bufsz: " + bufsz,1,out.getLength());
    c+=in.readLine(out,1);
    assertEquals("line2 length, bufsz: " + bufsz,1,out.getLength());
    c+=in.readLine(out,1);
    assertEquals("line3 length, bufsz: " + bufsz,0,out.getLength());
    c+=in.readLine(out,3);
    assertEquals("line4 length, bufsz: " + bufsz,3,out.getLength());
    c+=in.readLine(out,10);
    assertEquals("line5 length, bufsz: " + bufsz,4,out.getLength());
    c+=in.readLine(out,8);
    assertEquals("line5 length, bufsz: " + bufsz,5,out.getLength());
    assertEquals("end of file, bufsz: " + bufsz,0,in.readLine(out));
    assertEquals("total bytes, bufsz: " + bufsz,c,STRLENBYTES);
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=900000) public void testSplitableCodecs() throws IOException {
  JobConf conf=new JobConf(defaultConf);
  int seed=new Random().nextInt();
  CompressionCodec codec=null;
  try {
    codec=(CompressionCodec)ReflectionUtils.newInstance(conf.getClassByName("org.apache.hadoop.io.compress.BZip2Codec"),conf);
  }
 catch (  ClassNotFoundException cnfe) {
    throw new IOException("Illegal codec!");
  }
  Path file=new Path(workDir,"test" + codec.getDefaultExtension());
  Reporter reporter=Reporter.NULL;
  LOG.info("seed = " + seed);
  Random random=new Random(seed);
  FileSystem localFs=FileSystem.getLocal(conf);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(conf,workDir);
  final int MAX_LENGTH=500000;
  for (int length=MAX_LENGTH / 2; length < MAX_LENGTH; length+=random.nextInt(MAX_LENGTH / 4) + 1) {
    LOG.info("creating; entries = " + length);
    Writer writer=new OutputStreamWriter(codec.createOutputStream(localFs.create(file)));
    try {
      for (int i=0; i < length; i++) {
        writer.write(Integer.toString(i));
        writer.write("\n");
      }
    }
  finally {
      writer.close();
    }
    TextInputFormat format=new TextInputFormat();
    format.configure(conf);
    LongWritable key=new LongWritable();
    Text value=new Text();
    for (int i=0; i < 3; i++) {
      int numSplits=random.nextInt(MAX_LENGTH / 2000) + 1;
      LOG.info("splitting: requesting = " + numSplits);
      InputSplit[] splits=format.getSplits(conf,numSplits);
      LOG.info("splitting: got =        " + splits.length);
      BitSet bits=new BitSet(length);
      for (int j=0; j < splits.length; j++) {
        LOG.debug("split[" + j + "]= "+ splits[j]);
        RecordReader<LongWritable,Text> reader=format.getRecordReader(splits[j],conf,reporter);
        try {
          int counter=0;
          while (reader.next(key,value)) {
            int v=Integer.parseInt(value.toString());
            LOG.debug("read " + v);
            if (bits.get(v)) {
              LOG.warn("conflict with " + v + " in split "+ j+ " at position "+ reader.getPos());
            }
            assertFalse("Key in multiple partitions.",bits.get(v));
            bits.set(v);
            counter++;
          }
          if (counter > 0) {
            LOG.info("splits[" + j + "]="+ splits[j]+ " count="+ counter);
          }
 else {
            LOG.debug("splits[" + j + "]="+ splits[j]+ " count="+ counter);
          }
        }
  finally {
          reader.close();
        }
      }
      assertEquals("Some keys in no partition.",length,bits.cardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test readLine for various kinds of line termination sequneces.
 * Varies buffer size to stress test.  Also check that returned
 * value matches the string length.
 * @throws Exception
 */
@Test(timeout=5000) public void testNewLines() throws Exception {
  final String STR="a\nbb\n\nccc\rdddd\r\r\r\n\r\neeeee";
  final int STRLENBYTES=STR.getBytes().length;
  Text out=new Text();
  for (int bufsz=1; bufsz < STRLENBYTES + 1; ++bufsz) {
    LineReader in=makeStream(STR,bufsz);
    int c=0;
    c+=in.readLine(out);
    assertEquals("line1 length, bufsz:" + bufsz,1,out.getLength());
    c+=in.readLine(out);
    assertEquals("line2 length, bufsz:" + bufsz,2,out.getLength());
    c+=in.readLine(out);
    assertEquals("line3 length, bufsz:" + bufsz,0,out.getLength());
    c+=in.readLine(out);
    assertEquals("line4 length, bufsz:" + bufsz,3,out.getLength());
    c+=in.readLine(out);
    assertEquals("line5 length, bufsz:" + bufsz,4,out.getLength());
    c+=in.readLine(out);
    assertEquals("line6 length, bufsz:" + bufsz,0,out.getLength());
    c+=in.readLine(out);
    assertEquals("line7 length, bufsz:" + bufsz,0,out.getLength());
    c+=in.readLine(out);
    assertEquals("line8 length, bufsz:" + bufsz,0,out.getLength());
    c+=in.readLine(out);
    assertEquals("line9 length, bufsz:" + bufsz,5,out.getLength());
    assertEquals("end of file, bufsz: " + bufsz,0,in.readLine(out));
    assertEquals("total bytes, bufsz: " + bufsz,c,STRLENBYTES);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.gridmix.TestGridMixClasses </h4><pre class="type-13 type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=3000) public void testLoadJobLoadRecordReader() throws Exception {
  LoadJob.LoadRecordReader test=new LoadJob.LoadRecordReader();
  Configuration conf=new Configuration();
  FileSystem fs1=mock(FileSystem.class);
  when(fs1.open((Path)anyObject())).thenReturn(new FakeFSDataInputStream(new FakeInputStream()));
  Path p1=mock(Path.class);
  when(p1.getFileSystem((JobConf)anyObject())).thenReturn(fs1);
  FileSystem fs2=mock(FileSystem.class);
  when(fs2.open((Path)anyObject())).thenReturn(new FakeFSDataInputStream(new FakeInputStream()));
  Path p2=mock(Path.class);
  when(p2.getFileSystem((JobConf)anyObject())).thenReturn(fs2);
  Path[] paths={p1,p2};
  long[] start={0,0};
  long[] lengths={1000,1000};
  String[] locations={"temp1","temp2"};
  CombineFileSplit cfsplit=new CombineFileSplit(paths,start,lengths,locations);
  double[] reduceBytes={100,100};
  double[] reduceRecords={2,2};
  long[] reduceOutputBytes={500,500};
  long[] reduceOutputRecords={2,2};
  ResourceUsageMetrics metrics=new ResourceUsageMetrics();
  ResourceUsageMetrics[] rMetrics={new ResourceUsageMetrics(),new ResourceUsageMetrics()};
  LoadSplit input=new LoadSplit(cfsplit,2,3,1500L,2L,3000L,2L,reduceBytes,reduceRecords,reduceOutputBytes,reduceOutputRecords,metrics,rMetrics);
  TaskAttemptID taskId=new TaskAttemptID();
  TaskAttemptContext ctx=new TaskAttemptContextImpl(conf,taskId);
  test.initialize(input,ctx);
  GridmixRecord gr=test.getCurrentValue();
  int counter=0;
  while (test.nextKeyValue()) {
    gr=test.getCurrentValue();
    if (counter == 0) {
      assertEquals(0.5,test.getProgress(),0.001);
    }
 else     if (counter == 1) {
      assertEquals(1.0,test.getProgress(),0.001);
    }
    assertEquals(1000,gr.getSize());
    counter++;
  }
  assertEquals(1000,gr.getSize());
  assertEquals(2,counter);
  test.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapred.gridmix.TestSleepJob </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMapTasksOnlySleepJobs() throws Exception {
  Configuration configuration=GridmixTestUtils.mrvl.getConfig();
  DebugJobProducer jobProducer=new DebugJobProducer(5,configuration);
  configuration.setBoolean(SleepJob.SLEEPJOB_MAPTASK_ONLY,true);
  UserGroupInformation ugi=UserGroupInformation.getLoginUser();
  JobStory story;
  int seq=1;
  while ((story=jobProducer.getNextJob()) != null) {
    GridmixJob gridmixJob=JobCreator.SLEEPJOB.createGridmixJob(configuration,0,story,new Path("ignored"),ugi,seq++);
    gridmixJob.buildSplits(null);
    Job job=gridmixJob.call();
    assertEquals(0,job.getNumReduceTasks());
  }
  jobProducer.close();
  assertEquals(6,seq);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.TestCounters </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify counter value works
 */
@Test public void testCounterValue(){
  final int NUMBER_TESTS=100;
  final int NUMBER_INC=10;
  final Random rand=new Random();
  for (int i=0; i < NUMBER_TESTS; i++) {
    long initValue=rand.nextInt();
    long expectedValue=initValue;
    Counter counter=new Counters().findCounter("test","foo");
    counter.setValue(initValue);
    assertEquals("Counter value is not initialized correctly",expectedValue,counter.getValue());
    for (int j=0; j < NUMBER_INC; j++) {
      int incValue=rand.nextInt();
      counter.increment(incValue);
      expectedValue+=incValue;
      assertEquals("Counter value is not incremented correctly",expectedValue,counter.getValue());
    }
    expectedValue=rand.nextInt();
    counter.setValue(expectedValue);
    assertEquals("Counter value is not set correctly",expectedValue,counter.getValue());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.lib.input.TestCombineSequenceFileInputFormat </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testFormat() throws IOException, InterruptedException {
  Job job=Job.getInstance(conf);
  Random random=new Random();
  long seed=random.nextLong();
  random.setSeed(seed);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(job,workDir);
  final int length=10000;
  final int numFiles=10;
  createFiles(length,numFiles,random,job);
  TaskAttemptContext context=MapReduceTestUtil.createDummyMapTaskAttemptContext(job.getConfiguration());
  InputFormat<IntWritable,BytesWritable> format=new CombineSequenceFileInputFormat<IntWritable,BytesWritable>();
  for (int i=0; i < 3; i++) {
    int numSplits=random.nextInt(length / (SequenceFile.SYNC_INTERVAL / 20)) + 1;
    LOG.info("splitting: requesting = " + numSplits);
    List<InputSplit> splits=format.getSplits(job);
    LOG.info("splitting: got =        " + splits.size());
    assertEquals("We got more than one splits!",1,splits.size());
    InputSplit split=splits.get(0);
    assertEquals("It should be CombineFileSplit",CombineFileSplit.class,split.getClass());
    BitSet bits=new BitSet(length);
    RecordReader<IntWritable,BytesWritable> reader=format.createRecordReader(split,context);
    MapContext<IntWritable,BytesWritable,IntWritable,BytesWritable> mcontext=new MapContextImpl<IntWritable,BytesWritable,IntWritable,BytesWritable>(job.getConfiguration(),context.getTaskAttemptID(),reader,null,null,MapReduceTestUtil.createDummyReporter(),split);
    reader.initialize(split,mcontext);
    assertEquals("reader class is CombineFileRecordReader.",CombineFileRecordReader.class,reader.getClass());
    try {
      while (reader.nextKeyValue()) {
        IntWritable key=reader.getCurrentKey();
        BytesWritable value=reader.getCurrentValue();
        assertNotNull("Value should not be null.",value);
        final int k=key.get();
        LOG.debug("read " + k);
        assertFalse("Key in multiple partitions.",bits.get(k));
        bits.set(k);
      }
    }
  finally {
      reader.close();
    }
    assertEquals("Some keys in no partition.",length,bits.cardinality());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.lib.input.TestCombineTextInputFormat </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testFormat() throws Exception {
  Job job=Job.getInstance(new Configuration(defaultConf));
  Random random=new Random();
  long seed=random.nextLong();
  LOG.info("seed = " + seed);
  random.setSeed(seed);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(job,workDir);
  final int length=10000;
  final int numFiles=10;
  createFiles(length,numFiles,random);
  CombineTextInputFormat format=new CombineTextInputFormat();
  for (int i=0; i < 3; i++) {
    int numSplits=random.nextInt(length / 20) + 1;
    LOG.info("splitting: requesting = " + numSplits);
    List<InputSplit> splits=format.getSplits(job);
    LOG.info("splitting: got =        " + splits.size());
    assertEquals("We got more than one splits!",1,splits.size());
    InputSplit split=splits.get(0);
    assertEquals("It should be CombineFileSplit",CombineFileSplit.class,split.getClass());
    BitSet bits=new BitSet(length);
    LOG.debug("split= " + split);
    TaskAttemptContext context=MapReduceTestUtil.createDummyMapTaskAttemptContext(job.getConfiguration());
    RecordReader<LongWritable,Text> reader=format.createRecordReader(split,context);
    assertEquals("reader class is CombineFileRecordReader.",CombineFileRecordReader.class,reader.getClass());
    MapContext<LongWritable,Text,LongWritable,Text> mcontext=new MapContextImpl<LongWritable,Text,LongWritable,Text>(job.getConfiguration(),context.getTaskAttemptID(),reader,null,null,MapReduceTestUtil.createDummyReporter(),split);
    reader.initialize(split,mcontext);
    try {
      int count=0;
      while (reader.nextKeyValue()) {
        LongWritable key=reader.getCurrentKey();
        assertNotNull("Key should not be null.",key);
        Text value=reader.getCurrentValue();
        final int v=Integer.parseInt(value.toString());
        LOG.debug("read " + v);
        assertFalse("Key in multiple partitions.",bits.get(v));
        bits.set(v);
        count++;
      }
      LOG.debug("split=" + split + " count="+ count);
    }
  finally {
      reader.close();
    }
    assertEquals("Some keys in no partition.",length,bits.cardinality());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.lib.input.TestMRCJCFileInputFormat </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test @SuppressWarnings({"rawtypes","unchecked"}) public void testLastInputSplitAtSplitBoundary() throws Exception {
  FileInputFormat fif=new FileInputFormatForTest(1024l * 1024 * 1024,128l * 1024 * 1024);
  Configuration conf=new Configuration();
  JobContext jobContext=mock(JobContext.class);
  when(jobContext.getConfiguration()).thenReturn(conf);
  List<InputSplit> splits=fif.getSplits(jobContext);
  assertEquals(8,splits.size());
  for (int i=0; i < splits.size(); i++) {
    InputSplit split=splits.get(i);
    assertEquals(("host" + i),split.getLocations()[0]);
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test @SuppressWarnings({"rawtypes","unchecked"}) public void testLastInputSplitExceedingSplitBoundary() throws Exception {
  FileInputFormat fif=new FileInputFormatForTest(1027l * 1024 * 1024,128l * 1024 * 1024);
  Configuration conf=new Configuration();
  JobContext jobContext=mock(JobContext.class);
  when(jobContext.getConfiguration()).thenReturn(conf);
  List<InputSplit> splits=fif.getSplits(jobContext);
  assertEquals(8,splits.size());
  for (int i=0; i < splits.size(); i++) {
    InputSplit split=splits.get(i);
    assertEquals(("host" + i),split.getLocations()[0]);
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test @SuppressWarnings({"rawtypes","unchecked"}) public void testLastInputSplitSingleSplit() throws Exception {
  FileInputFormat fif=new FileInputFormatForTest(100l * 1024 * 1024,128l * 1024 * 1024);
  Configuration conf=new Configuration();
  JobContext jobContext=mock(JobContext.class);
  when(jobContext.getConfiguration()).thenReturn(conf);
  List<InputSplit> splits=fif.getSplits(jobContext);
  assertEquals(1,splits.size());
  for (int i=0; i < splits.size(); i++) {
    InputSplit split=splits.get(i);
    assertEquals(("host" + i),split.getLocations()[0]);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.lib.input.TestMRKeyValueTextInputFormat </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSplitableCodecs() throws Exception {
  final Job job=Job.getInstance(defaultConf);
  final Configuration conf=job.getConfiguration();
  CompressionCodec codec=null;
  try {
    codec=(CompressionCodec)ReflectionUtils.newInstance(conf.getClassByName("org.apache.hadoop.io.compress.BZip2Codec"),conf);
  }
 catch (  ClassNotFoundException cnfe) {
    throw new IOException("Illegal codec!");
  }
  Path file=new Path(workDir,"test" + codec.getDefaultExtension());
  int seed=new Random().nextInt();
  LOG.info("seed = " + seed);
  Random random=new Random(seed);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(job,workDir);
  final int MAX_LENGTH=500000;
  FileInputFormat.setMaxInputSplitSize(job,MAX_LENGTH / 20);
  for (int length=0; length < MAX_LENGTH; length+=random.nextInt(MAX_LENGTH / 4) + 1) {
    LOG.info("creating; entries = " + length);
    Writer writer=new OutputStreamWriter(codec.createOutputStream(localFs.create(file)));
    try {
      for (int i=0; i < length; i++) {
        writer.write(Integer.toString(i * 2));
        writer.write("\t");
        writer.write(Integer.toString(i));
        writer.write("\n");
      }
    }
  finally {
      writer.close();
    }
    KeyValueTextInputFormat format=new KeyValueTextInputFormat();
    assertTrue("KVTIF claims not splittable",format.isSplitable(job,file));
    for (int i=0; i < 3; i++) {
      int numSplits=random.nextInt(MAX_LENGTH / 2000) + 1;
      LOG.info("splitting: requesting = " + numSplits);
      List<InputSplit> splits=format.getSplits(job);
      LOG.info("splitting: got =        " + splits.size());
      BitSet bits=new BitSet(length);
      for (int j=0; j < splits.size(); j++) {
        LOG.debug("split[" + j + "]= "+ splits.get(j));
        TaskAttemptContext context=MapReduceTestUtil.createDummyMapTaskAttemptContext(job.getConfiguration());
        RecordReader<Text,Text> reader=format.createRecordReader(splits.get(j),context);
        Class<?> clazz=reader.getClass();
        MapContext<Text,Text,Text,Text> mcontext=new MapContextImpl<Text,Text,Text,Text>(job.getConfiguration(),context.getTaskAttemptID(),reader,null,null,MapReduceTestUtil.createDummyReporter(),splits.get(j));
        reader.initialize(splits.get(j),mcontext);
        Text key=null;
        Text value=null;
        try {
          int count=0;
          while (reader.nextKeyValue()) {
            key=reader.getCurrentKey();
            value=reader.getCurrentValue();
            final int k=Integer.parseInt(key.toString());
            final int v=Integer.parseInt(value.toString());
            assertEquals("Bad key",0,k % 2);
            assertEquals("Mismatched key/value",k / 2,v);
            LOG.debug("read " + k + ","+ v);
            assertFalse(k + "," + v+ " in multiple partitions.",bits.get(v));
            bits.set(v);
            count++;
          }
          if (count > 0) {
            LOG.info("splits[" + j + "]="+ splits.get(j)+ " count="+ count);
          }
 else {
            LOG.debug("splits[" + j + "]="+ splits.get(j)+ " count="+ count);
          }
        }
  finally {
          reader.close();
        }
      }
      assertEquals("Some keys in no partition.",length,bits.cardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFormat() throws Exception {
  Job job=Job.getInstance(new Configuration(defaultConf));
  Path file=new Path(workDir,"test.txt");
  int seed=new Random().nextInt();
  LOG.info("seed = " + seed);
  Random random=new Random(seed);
  localFs.delete(workDir,true);
  FileInputFormat.setInputPaths(job,workDir);
  final int MAX_LENGTH=10000;
  for (int length=0; length < MAX_LENGTH; length+=random.nextInt(MAX_LENGTH / 10) + 1) {
    LOG.debug("creating; entries = " + length);
    Writer writer=new OutputStreamWriter(localFs.create(file));
    try {
      for (int i=0; i < length; i++) {
        writer.write(Integer.toString(i * 2));
        writer.write("\t");
        writer.write(Integer.toString(i));
        writer.write("\n");
      }
    }
  finally {
      writer.close();
    }
    KeyValueTextInputFormat format=new KeyValueTextInputFormat();
    for (int i=0; i < 3; i++) {
      int numSplits=random.nextInt(MAX_LENGTH / 20) + 1;
      LOG.debug("splitting: requesting = " + numSplits);
      List<InputSplit> splits=format.getSplits(job);
      LOG.debug("splitting: got =        " + splits.size());
      BitSet bits=new BitSet(length);
      for (int j=0; j < splits.size(); j++) {
        LOG.debug("split[" + j + "]= "+ splits.get(j));
        TaskAttemptContext context=MapReduceTestUtil.createDummyMapTaskAttemptContext(job.getConfiguration());
        RecordReader<Text,Text> reader=format.createRecordReader(splits.get(j),context);
        Class<?> clazz=reader.getClass();
        assertEquals("reader class is KeyValueLineRecordReader.",KeyValueLineRecordReader.class,clazz);
        MapContext<Text,Text,Text,Text> mcontext=new MapContextImpl<Text,Text,Text,Text>(job.getConfiguration(),context.getTaskAttemptID(),reader,null,null,MapReduceTestUtil.createDummyReporter(),splits.get(j));
        reader.initialize(splits.get(j),mcontext);
        Text key=null;
        Text value=null;
        try {
          int count=0;
          while (reader.nextKeyValue()) {
            key=reader.getCurrentKey();
            clazz=key.getClass();
            assertEquals("Key class is Text.",Text.class,clazz);
            value=reader.getCurrentValue();
            clazz=value.getClass();
            assertEquals("Value class is Text.",Text.class,clazz);
            final int k=Integer.parseInt(key.toString());
            final int v=Integer.parseInt(value.toString());
            assertEquals("Bad key",0,k % 2);
            assertEquals("Mismatched key/value",k / 2,v);
            LOG.debug("read " + v);
            assertFalse("Key in multiple partitions.",bits.get(v));
            bits.set(v);
            count++;
          }
          LOG.debug("splits[" + j + "]="+ splits.get(j)+ " count="+ count);
        }
  finally {
          reader.close();
        }
      }
      assertEquals("Some keys in no partition.",length,bits.cardinality());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.lib.partition.TestInputSampler </h4><pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify IntervalSampler contract, that samples are taken at regular
 * intervals from the given splits.
 */
@Test @SuppressWarnings("unchecked") public void testIntervalSampler() throws Exception {
  final int TOT_SPLITS=16;
  final int PER_SPLIT_SAMPLE=4;
  final int NUM_SAMPLES=TOT_SPLITS * PER_SPLIT_SAMPLE;
  final double FREQ=1.0 / TOT_SPLITS;
  InputSampler.Sampler<IntWritable,NullWritable> sampler=new InputSampler.IntervalSampler<IntWritable,NullWritable>(FREQ,NUM_SAMPLES);
  int inits[]=new int[TOT_SPLITS];
  for (int i=0; i < TOT_SPLITS; ++i) {
    inits[i]=i;
  }
  Job ignored=Job.getInstance();
  Object[] samples=sampler.getSample(new TestInputSamplerIF(NUM_SAMPLES,TOT_SPLITS,inits),ignored);
  assertEquals(NUM_SAMPLES,samples.length);
  Arrays.sort(samples,new IntWritable.Comparator());
  for (int i=0; i < NUM_SAMPLES; ++i) {
    assertEquals(i,((IntWritable)samples[i]).get());
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify IntervalSampler in mapred.lib.InputSampler, which is added back
 * for binary compatibility of M/R 1.x
 */
@Test(timeout=30000) @SuppressWarnings("unchecked") public void testMapredIntervalSampler() throws Exception {
  final int TOT_SPLITS=16;
  final int PER_SPLIT_SAMPLE=4;
  final int NUM_SAMPLES=TOT_SPLITS * PER_SPLIT_SAMPLE;
  final double FREQ=1.0 / TOT_SPLITS;
  org.apache.hadoop.mapred.lib.InputSampler.Sampler<IntWritable,NullWritable> sampler=new org.apache.hadoop.mapred.lib.InputSampler.IntervalSampler<IntWritable,NullWritable>(FREQ,NUM_SAMPLES);
  int inits[]=new int[TOT_SPLITS];
  for (int i=0; i < TOT_SPLITS; ++i) {
    inits[i]=i;
  }
  Job ignored=Job.getInstance();
  Object[] samples=sampler.getSample(new TestInputSamplerIF(NUM_SAMPLES,TOT_SPLITS,inits),ignored);
  assertEquals(NUM_SAMPLES,samples.length);
  Arrays.sort(samples,new IntWritable.Comparator());
  for (int i=0; i < NUM_SAMPLES; ++i) {
    assertEquals(i,((IntWritable)samples[i]).get());
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify SplitSampler contract, that an equal number of records are taken
 * from the first splits.
 */
@Test @SuppressWarnings("unchecked") public void testSplitSampler() throws Exception {
  final int TOT_SPLITS=15;
  final int NUM_SPLITS=5;
  final int STEP_SAMPLE=5;
  final int NUM_SAMPLES=NUM_SPLITS * STEP_SAMPLE;
  InputSampler.Sampler<IntWritable,NullWritable> sampler=new InputSampler.SplitSampler<IntWritable,NullWritable>(NUM_SAMPLES,NUM_SPLITS);
  int inits[]=new int[TOT_SPLITS];
  for (int i=0; i < TOT_SPLITS; ++i) {
    inits[i]=i * STEP_SAMPLE;
  }
  Job ignored=Job.getInstance();
  Object[] samples=sampler.getSample(new TestInputSamplerIF(100000,TOT_SPLITS,inits),ignored);
  assertEquals(NUM_SAMPLES,samples.length);
  Arrays.sort(samples,new IntWritable.Comparator());
  for (int i=0; i < NUM_SAMPLES; ++i) {
    assertEquals(i,((IntWritable)samples[i]).get());
  }
}

</code></pre>

<br>
<pre class="type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify SplitSampler contract in mapred.lib.InputSampler, which is added
 * back for binary compatibility of M/R 1.x
 */
@Test(timeout=30000) @SuppressWarnings("unchecked") public void testMapredSplitSampler() throws Exception {
  final int TOT_SPLITS=15;
  final int NUM_SPLITS=5;
  final int STEP_SAMPLE=5;
  final int NUM_SAMPLES=NUM_SPLITS * STEP_SAMPLE;
  org.apache.hadoop.mapred.lib.InputSampler.Sampler<IntWritable,NullWritable> sampler=new org.apache.hadoop.mapred.lib.InputSampler.SplitSampler<IntWritable,NullWritable>(NUM_SAMPLES,NUM_SPLITS);
  int inits[]=new int[TOT_SPLITS];
  for (int i=0; i < TOT_SPLITS; ++i) {
    inits[i]=i * STEP_SAMPLE;
  }
  Object[] samples=sampler.getSample(new TestMapredInputSamplerIF(100000,TOT_SPLITS,inits),new JobConf());
  assertEquals(NUM_SAMPLES,samples.length);
  Arrays.sort(samples,new IntWritable.Comparator());
  for (int i=0; i < NUM_SAMPLES; ++i) {
    assertEquals(i % STEP_SAMPLE + TOT_SPLITS * (i / STEP_SAMPLE),((IntWritable)samples[i]).get());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.task.reduce.TestMergeManager </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings({"unchecked","deprecation"}) @Test(timeout=10000) public void testOnDiskMerger() throws IOException, URISyntaxException, InterruptedException {
  JobConf jobConf=new JobConf();
  final int SORT_FACTOR=5;
  jobConf.setInt(MRJobConfig.IO_SORT_FACTOR,SORT_FACTOR);
  MapOutputFile mapOutputFile=new MROutputFiles();
  FileSystem fs=FileSystem.getLocal(jobConf);
  MergeManagerImpl<IntWritable,IntWritable> manager=new MergeManagerImpl<IntWritable,IntWritable>(null,jobConf,fs,null,null,null,null,null,null,null,null,null,null,mapOutputFile);
  MergeThread<MapOutput<IntWritable,IntWritable>,IntWritable,IntWritable> onDiskMerger=(MergeThread<MapOutput<IntWritable,IntWritable>,IntWritable,IntWritable>)Whitebox.getInternalState(manager,"onDiskMerger");
  int mergeFactor=(Integer)Whitebox.getInternalState(onDiskMerger,"mergeFactor");
  assertEquals(mergeFactor,SORT_FACTOR);
  onDiskMerger.suspend();
  Random rand=new Random();
  for (int i=0; i < 2 * SORT_FACTOR; ++i) {
    Path path=new Path("somePath");
    CompressAwarePath cap=new CompressAwarePath(path,1l,rand.nextInt());
    manager.closeOnDiskFile(cap);
  }
  LinkedList<List<CompressAwarePath>> pendingToBeMerged=(LinkedList<List<CompressAwarePath>>)Whitebox.getInternalState(onDiskMerger,"pendingToBeMerged");
  assertTrue("No inputs were added to list pending to merge",pendingToBeMerged.size() > 0);
  for (int i=0; i < pendingToBeMerged.size(); ++i) {
    List<CompressAwarePath> inputs=pendingToBeMerged.get(i);
    for (int j=1; j < inputs.size(); ++j) {
      assertTrue("Not enough / too many inputs were going to be merged",inputs.size() > 0 && inputs.size() <= SORT_FACTOR);
      assertTrue("Inputs to be merged were not sorted according to size: ",inputs.get(j).getCompressedSize() >= inputs.get(j - 1).getCompressedSize());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.TestMRJobs </h4><pre class="type-13 type-11 type-7 type-10 type-19 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=120000) public void testContainerRollingLog() throws IOException, InterruptedException, ClassNotFoundException {
  if (!(new File(MiniMRYarnCluster.APPJAR)).exists()) {
    LOG.info("MRAppJar " + MiniMRYarnCluster.APPJAR + " not found. Not running test.");
    return;
  }
  final SleepJob sleepJob=new SleepJob();
  final JobConf sleepConf=new JobConf(mrCluster.getConfig());
  sleepConf.set(MRJobConfig.MAP_LOG_LEVEL,Level.ALL.toString());
  final long userLogKb=4;
  sleepConf.setLong(MRJobConfig.TASK_USERLOG_LIMIT,userLogKb);
  sleepConf.setInt(MRJobConfig.TASK_LOG_BACKUPS,3);
  sleepConf.set(MRJobConfig.MR_AM_LOG_LEVEL,Level.ALL.toString());
  final long amLogKb=7;
  sleepConf.setLong(MRJobConfig.MR_AM_LOG_KB,amLogKb);
  sleepConf.setInt(MRJobConfig.MR_AM_LOG_BACKUPS,7);
  sleepJob.setConf(sleepConf);
  final Job job=sleepJob.createJob(1,0,1L,100,0L,0);
  job.setJarByClass(SleepJob.class);
  job.addFileToClassPath(APP_JAR);
  job.waitForCompletion(true);
  final JobId jobId=TypeConverter.toYarn(job.getJobID());
  final ApplicationId appID=jobId.getAppId();
  int pollElapsed=0;
  while (true) {
    Thread.sleep(1000);
    pollElapsed+=1000;
    if (TERMINAL_RM_APP_STATES.contains(mrCluster.getResourceManager().getRMContext().getRMApps().get(appID).getState())) {
      break;
    }
    if (pollElapsed >= 60000) {
      LOG.warn("application did not reach terminal state within 60 seconds");
      break;
    }
  }
  Assert.assertEquals(RMAppState.FINISHED,mrCluster.getResourceManager().getRMContext().getRMApps().get(appID).getState());
  final String appIdStr=appID.toString();
  final String appIdSuffix=appIdStr.substring("application_".length(),appIdStr.length());
  final String containerGlob="container_" + appIdSuffix + "_*_*";
  final String syslogGlob=appIdStr + Path.SEPARATOR + containerGlob+ Path.SEPARATOR+ TaskLog.LogName.SYSLOG;
  int numAppMasters=0;
  int numMapTasks=0;
  for (int i=0; i < NUM_NODE_MGRS; i++) {
    final Configuration nmConf=mrCluster.getNodeManager(i).getConfig();
    for (    String logDir : nmConf.getTrimmedStrings(YarnConfiguration.NM_LOG_DIRS)) {
      final Path absSyslogGlob=new Path(logDir + Path.SEPARATOR + syslogGlob);
      LOG.info("Checking for glob: " + absSyslogGlob);
      final FileStatus[] syslogs=localFs.globStatus(absSyslogGlob);
      for (      FileStatus slog : syslogs) {
        boolean foundAppMaster=job.isUber();
        final Path containerPathComponent=slog.getPath().getParent();
        if (!foundAppMaster) {
          final ContainerId cid=ConverterUtils.toContainerId(containerPathComponent.getName());
          foundAppMaster=(cid.getId() == 1);
        }
        final FileStatus[] sysSiblings=localFs.globStatus(new Path(containerPathComponent,TaskLog.LogName.SYSLOG + "*"));
        Arrays.sort(sysSiblings);
        if (foundAppMaster) {
          numAppMasters++;
        }
 else {
          numMapTasks++;
        }
        if (foundAppMaster) {
          Assert.assertSame("Unexpected number of AM sylog* files",sleepConf.getInt(MRJobConfig.MR_AM_LOG_BACKUPS,0) + 1,sysSiblings.length);
          Assert.assertTrue("AM syslog.1 length kb should be >= " + amLogKb,sysSiblings[1].getLen() >= amLogKb * 1024);
        }
 else {
          Assert.assertSame("Unexpected number of MR task sylog* files",sleepConf.getInt(MRJobConfig.TASK_LOG_BACKUPS,0) + 1,sysSiblings.length);
          Assert.assertTrue("MR syslog.1 length kb should be >= " + userLogKb,sysSiblings[1].getLen() >= userLogKb * 1024);
        }
      }
    }
  }
  Assert.assertEquals("No AppMaster log found!",1,numAppMasters);
  if (sleepConf.getBoolean(MRJobConfig.JOB_UBERTASK_ENABLE,false)) {
    Assert.assertEquals("MapTask log with uber found!",0,numMapTasks);
  }
 else {
    Assert.assertEquals("No MapTask log found!",1,numMapTasks);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.TestRMNMInfo </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRMNMInfo() throws Exception {
  if (!(new File(MiniMRYarnCluster.APPJAR)).exists()) {
    LOG.info("MRAppJar " + MiniMRYarnCluster.APPJAR + " not found. Not running test.");
    return;
  }
  RMContext rmc=mrCluster.getResourceManager().getRMContext();
  ResourceScheduler rms=mrCluster.getResourceManager().getResourceScheduler();
  RMNMInfo rmInfo=new RMNMInfo(rmc,rms);
  String liveNMs=rmInfo.getLiveNodeManagers();
  ObjectMapper mapper=new ObjectMapper();
  JsonNode jn=mapper.readTree(liveNMs);
  Assert.assertEquals("Unexpected number of live nodes:",NUMNODEMANAGERS,jn.size());
  Iterator<JsonNode> it=jn.iterator();
  while (it.hasNext()) {
    JsonNode n=it.next();
    Assert.assertNotNull(n.get("HostName"));
    Assert.assertNotNull(n.get("Rack"));
    Assert.assertTrue("Node " + n.get("NodeId") + " should be RUNNING",n.get("State").asText().contains("RUNNING"));
    Assert.assertNotNull(n.get("NodeHTTPAddress"));
    Assert.assertNotNull(n.get("LastHealthUpdate"));
    Assert.assertNotNull(n.get("HealthReport"));
    Assert.assertNotNull(n.get("NodeManagerVersion"));
    Assert.assertNotNull(n.get("NumContainers"));
    Assert.assertEquals(n.get("NodeId") + ": Unexpected number of used containers",0,n.get("NumContainers").asInt());
    Assert.assertEquals(n.get("NodeId") + ": Unexpected amount of used memory",0,n.get("UsedMemoryMB").asInt());
    Assert.assertNotNull(n.get("AvailableMemoryMB"));
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRMNMInfoMissmatch() throws Exception {
  RMContext rmc=mock(RMContext.class);
  ResourceScheduler rms=mock(ResourceScheduler.class);
  ConcurrentMap<NodeId,RMNode> map=new ConcurrentHashMap<NodeId,RMNode>();
  RMNode node=MockNodes.newNodeInfo(1,MockNodes.newResource(4 * 1024));
  map.put(node.getNodeID(),node);
  when(rmc.getRMNodes()).thenReturn(map);
  RMNMInfo rmInfo=new RMNMInfo(rmc,rms);
  String liveNMs=rmInfo.getLiveNodeManagers();
  ObjectMapper mapper=new ObjectMapper();
  JsonNode jn=mapper.readTree(liveNMs);
  Assert.assertEquals("Unexpected number of live nodes:",1,jn.size());
  Iterator<JsonNode> it=jn.iterator();
  while (it.hasNext()) {
    JsonNode n=it.next();
    Assert.assertNotNull(n.get("HostName"));
    Assert.assertNotNull(n.get("Rack"));
    Assert.assertTrue("Node " + n.get("NodeId") + " should be RUNNING",n.get("State").asText().contains("RUNNING"));
    Assert.assertNotNull(n.get("NodeHTTPAddress"));
    Assert.assertNotNull(n.get("LastHealthUpdate"));
    Assert.assertNotNull(n.get("HealthReport"));
    Assert.assertNotNull(n.get("NodeManagerVersion"));
    Assert.assertNull(n.get("NumContainers"));
    Assert.assertNull(n.get("UsedMemoryMB"));
    Assert.assertNull(n.get("AvailableMemoryMB"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.app.TestMRAppMaster </h4><pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testMRAppMasterMaxAppAttempts() throws IOException, InterruptedException {
  Boolean[] expectedBools=new Boolean[]{false,false,false};
  String applicationAttemptIdStr="appattempt_1317529182569_0004_000002";
  String containerIdStr="container_1317529182569_0004_000002_1";
  String userName="TestAppMasterUser";
  ApplicationAttemptId applicationAttemptId=ConverterUtils.toApplicationAttemptId(applicationAttemptIdStr);
  ContainerId containerId=ConverterUtils.toContainerId(containerIdStr);
  JobConf conf=new JobConf();
  conf.set(MRJobConfig.MR_AM_STAGING_DIR,stagingDir);
  File stagingDir=new File(MRApps.getStagingAreaDir(conf,userName).toString());
  stagingDir.mkdirs();
  for (int i=0; i < expectedBools.length; ++i) {
    MRAppMasterTest appMaster=new MRAppMasterTest(applicationAttemptId,containerId,"host",-1,-1,System.currentTimeMillis(),false,true);
    MRAppMaster.initAndStartAppMaster(appMaster,conf,userName);
    assertEquals("isLastAMRetry is correctly computed.",expectedBools[i],appMaster.isLastAMRetry());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.app.rm.TestRMContainerAllocator </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testIgnoreBlacklisting() throws Exception {
  LOG.info("Running testIgnoreBlacklisting");
  Configuration conf=new Configuration();
  conf.setBoolean(MRJobConfig.MR_AM_JOB_NODE_BLACKLISTING_ENABLE,true);
  conf.setInt(MRJobConfig.MAX_TASK_FAILURES_PER_TRACKER,1);
  conf.setInt(MRJobConfig.MR_AM_IGNORE_BLACKLISTING_BLACKLISTED_NODE_PERECENT,33);
  MyResourceManager rm=new MyResourceManager(conf);
  rm.start();
  DrainDispatcher dispatcher=(DrainDispatcher)rm.getRMContext().getDispatcher();
  RMApp app=rm.submitApp(1024);
  dispatcher.await();
  MockNM[] nodeManagers=new MockNM[10];
  int nmNum=0;
  List<TaskAttemptContainerAssignedEvent> assigned=null;
  nodeManagers[nmNum]=registerNodeManager(nmNum++,rm,dispatcher);
  nodeManagers[0].nodeHeartbeat(true);
  dispatcher.await();
  ApplicationAttemptId appAttemptId=app.getCurrentAppAttempt().getAppAttemptId();
  rm.sendAMLaunched(appAttemptId);
  dispatcher.await();
  JobId jobId=MRBuilderUtils.newJobId(appAttemptId.getApplicationId(),0);
  Job mockJob=mock(Job.class);
  when(mockJob.getReport()).thenReturn(MRBuilderUtils.newJobReport(jobId,"job","user",JobState.RUNNING,0,0,0,0,0,0,0,"jobfile",null,false,""));
  MyContainerAllocator allocator=new MyContainerAllocator(rm,conf,appAttemptId,mockJob);
  assigned=getContainerOnHost(jobId,1,1024,new String[]{"h1"},nodeManagers[0],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  LOG.info("Failing container _1 on H1 (Node should be blacklisted and" + " ignore blacklisting enabled");
  ContainerFailedEvent f1=createFailEvent(jobId,1,"h1",false);
  allocator.sendFailure(f1);
  assigned=getContainerOnHost(jobId,2,1024,new String[]{"h1"},nodeManagers[0],dispatcher,allocator,1,0,0,1,rm);
  Assert.assertEquals("No of assignments must be 0",0,assigned.size());
  assigned=getContainerOnHost(jobId,2,1024,new String[]{"h1"},nodeManagers[0],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  nodeManagers[nmNum]=registerNodeManager(nmNum++,rm,dispatcher);
  assigned=getContainerOnHost(jobId,3,1024,new String[]{"h2"},nodeManagers[1],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  nodeManagers[nmNum]=registerNodeManager(nmNum++,rm,dispatcher);
  assigned=getContainerOnHost(jobId,4,1024,new String[]{"h3"},nodeManagers[2],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  assigned=getContainerOnHost(jobId,5,1024,new String[]{"h1"},nodeManagers[0],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  nodeManagers[nmNum]=registerNodeManager(nmNum++,rm,dispatcher);
  assigned=getContainerOnHost(jobId,6,1024,new String[]{"h4"},nodeManagers[3],dispatcher,allocator,0,0,1,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  assigned=getContainerOnHost(jobId,7,1024,new String[]{"h1"},nodeManagers[0],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 0",0,assigned.size());
  ContainerFailedEvent f2=createFailEvent(jobId,3,"h2",false);
  allocator.sendFailure(f2);
  assigned=getContainerOnHost(jobId,8,1024,new String[]{"h1"},nodeManagers[0],dispatcher,allocator,1,0,0,2,rm);
  Assert.assertEquals("No of assignments must be 0",0,assigned.size());
  assigned=getContainerOnHost(jobId,8,1024,new String[]{"h1"},nodeManagers[0],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 2",2,assigned.size());
  assigned=getContainerOnHost(jobId,9,1024,new String[]{"h2"},nodeManagers[1],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  ContainerFailedEvent f3=createFailEvent(jobId,4,"h3",false);
  allocator.sendFailure(f3);
  nodeManagers[nmNum]=registerNodeManager(nmNum++,rm,dispatcher);
  assigned=getContainerOnHost(jobId,10,1024,new String[]{"h3"},nodeManagers[2],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  for (int i=0; i < 5; i++) {
    nodeManagers[nmNum]=registerNodeManager(nmNum++,rm,dispatcher);
    assigned=getContainerOnHost(jobId,11 + i,1024,new String[]{String.valueOf(5 + i)},nodeManagers[4 + i],dispatcher,allocator,0,0,(i == 4 ? 3 : 0),0,rm);
    Assert.assertEquals("No of assignments must be 1",1,assigned.size());
  }
  assigned=getContainerOnHost(jobId,20,1024,new String[]{"h3"},nodeManagers[2],dispatcher,allocator,0,0,0,0,rm);
  Assert.assertEquals("No of assignments must be 0",0,assigned.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.hs.TestJobHistory </h4><pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRefreshLoadedJobCache() throws Exception {
  HistoryFileManager historyManager=mock(HistoryFileManager.class);
  jobHistory=spy(new JobHistory());
  doReturn(historyManager).when(jobHistory).createHistoryFileManager();
  Configuration conf=new Configuration();
  conf.set(JHAdminConfig.MR_HISTORY_LOADED_JOB_CACHE_SIZE,"2");
  jobHistory.init(conf);
  jobHistory.start();
  CachedHistoryStorage storage=spy((CachedHistoryStorage)jobHistory.getHistoryStorage());
  Job[] jobs=new Job[3];
  JobId[] jobIds=new JobId[3];
  for (int i=0; i < 3; i++) {
    jobs[i]=mock(Job.class);
    jobIds[i]=mock(JobId.class);
    when(jobs[i].getID()).thenReturn(jobIds[i]);
  }
  HistoryFileInfo fileInfo=mock(HistoryFileInfo.class);
  when(historyManager.getFileInfo(any(JobId.class))).thenReturn(fileInfo);
  when(fileInfo.loadJob()).thenReturn(jobs[0]).thenReturn(jobs[1]).thenReturn(jobs[2]);
  for (int i=0; i < 3; i++) {
    storage.getFullJob(jobs[i].getID());
  }
  Map<JobId,Job> jobCache=storage.getLoadedJobCache();
  assertFalse(jobCache.containsKey(jobs[0].getID()));
  assertTrue(jobCache.containsKey(jobs[1].getID()) && jobCache.containsKey(jobs[2].getID()));
  conf.set(JHAdminConfig.MR_HISTORY_LOADED_JOB_CACHE_SIZE,"3");
  doReturn(conf).when(storage).createConf();
  when(fileInfo.loadJob()).thenReturn(jobs[0]).thenReturn(jobs[1]).thenReturn(jobs[2]);
  jobHistory.refreshLoadedJobCache();
  for (int i=0; i < 3; i++) {
    storage.getFullJob(jobs[i].getID());
  }
  jobCache=storage.getLoadedJobCache();
  for (int i=0; i < 3; i++) {
    assertTrue(jobCache.containsKey(jobs[i].getID()));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.hs.TestJobHistoryParsing </h4><pre class="type-13 type-7 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=50000) public void testScanningOldDirs() throws Exception {
  LOG.info("STARTING testScanningOldDirs");
  try {
    Configuration conf=new Configuration();
    conf.setClass(NET_TOPOLOGY_NODE_SWITCH_MAPPING_IMPL_KEY,MyResolver.class,DNSToSwitchMapping.class);
    RackResolver.init(conf);
    MRApp app=new MRAppWithHistory(1,1,true,this.getClass().getName(),true);
    app.submit(conf);
    Job job=app.getContext().getAllJobs().values().iterator().next();
    JobId jobId=job.getID();
    LOG.info("JOBID is " + TypeConverter.fromYarn(jobId).toString());
    app.waitForState(job,JobState.SUCCEEDED);
    app.waitForState(Service.STATE.STOPPED);
    HistoryFileManagerForTest hfm=new HistoryFileManagerForTest();
    hfm.init(conf);
    HistoryFileInfo fileInfo=hfm.getFileInfo(jobId);
    Assert.assertNotNull("Unable to locate job history",fileInfo);
    hfm.deleteJobFromJobListCache(fileInfo);
    final int msecPerSleep=10;
    int msecToSleep=10 * 1000;
    while (fileInfo.isMovePending() && msecToSleep > 0) {
      Assert.assertTrue(!fileInfo.didMoveFail());
      msecToSleep-=msecPerSleep;
      Thread.sleep(msecPerSleep);
    }
    Assert.assertTrue("Timeout waiting for history move",msecToSleep > 0);
    fileInfo=hfm.getFileInfo(jobId);
    hfm.stop();
    Assert.assertNotNull("Unable to locate old job history",fileInfo);
    Assert.assertTrue("HistoryFileManager not shutdown properly",hfm.moveToDoneExecutor.isTerminated());
  }
  finally {
    LOG.info("FINISHED testScanningOldDirs");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.hs.TestJobListCache </h4><pre class="type-13 type-11 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=1000) public void testEviction() throws InterruptedException {
  int maxSize=2;
  JobListCache cache=new JobListCache(maxSize,1000);
  JobId jobId1=MRBuilderUtils.newJobId(1,1,1);
  HistoryFileInfo fileInfo1=Mockito.mock(HistoryFileInfo.class);
  Mockito.when(fileInfo1.getJobId()).thenReturn(jobId1);
  JobId jobId2=MRBuilderUtils.newJobId(2,2,2);
  HistoryFileInfo fileInfo2=Mockito.mock(HistoryFileInfo.class);
  Mockito.when(fileInfo2.getJobId()).thenReturn(jobId2);
  JobId jobId3=MRBuilderUtils.newJobId(3,3,3);
  HistoryFileInfo fileInfo3=Mockito.mock(HistoryFileInfo.class);
  Mockito.when(fileInfo3.getJobId()).thenReturn(jobId3);
  cache.addIfAbsent(fileInfo1);
  cache.addIfAbsent(fileInfo2);
  cache.addIfAbsent(fileInfo3);
  Collection<HistoryFileInfo> values;
  for (int i=0; i < 9; i++) {
    values=cache.values();
    if (values.size() > maxSize) {
      Thread.sleep(100);
    }
 else {
      assertFalse("fileInfo1 should have been evicted",values.contains(fileInfo1));
      return;
    }
  }
  fail("JobListCache didn't delete the extra entry");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.mapreduce.v2.hs.server.TestHSAdminServer </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRefreshUserToGroupsMappings() throws Exception {
  String[] args=new String[]{"-refreshUserToGroupsMappings"};
  Groups groups=Groups.getUserToGroupsMappingService(conf);
  String user=UserGroupInformation.getCurrentUser().getUserName();
  System.out.println("first attempt:");
  List<String> g1=groups.getGroups(user);
  String[] str_groups=new String[g1.size()];
  g1.toArray(str_groups);
  System.out.println(Arrays.toString(str_groups));
  System.out.println("second attempt, should be same:");
  List<String> g2=groups.getGroups(user);
  g2.toArray(str_groups);
  System.out.println(Arrays.toString(str_groups));
  for (int i=0; i < g2.size(); i++) {
    assertEquals("Should be same group ",g1.get(i),g2.get(i));
  }
  hsAdminClient.run(args);
  System.out.println("third attempt(after refresh command), should be different:");
  List<String> g3=groups.getGroups(user);
  g3.toArray(str_groups);
  System.out.println(Arrays.toString(str_groups));
  for (int i=0; i < g3.size(); i++) {
    assertFalse("Should be different group: " + g1.get(i) + " and "+ g3.get(i),g1.get(i).equals(g3.get(i)));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.metrics2.impl.TestSinkQueue </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the consumeAll method
 * @throws Exception
 */
@Test public void testConsumeAll() throws Exception {
  final int capacity=64;
  final SinkQueue<Integer> q=new SinkQueue<Integer>(capacity);
  for (int i=0; i < capacity; ++i) {
    assertTrue("should enqueue",q.enqueue(i));
  }
  assertTrue("should not enqueue",!q.enqueue(capacity));
  final Runnable trigger=mock(Runnable.class);
  q.consumeAll(new Consumer<Integer>(){
    private int expected=0;
    @Override public void consume(    Integer e){
      assertEquals("element",expected++,(int)e);
      trigger.run();
    }
  }
);
  verify(trigger,times(capacity)).run();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.metrics2.lib.TestInterns </h4><pre class="type-13 type-11 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testInfoOverflow(){
  MetricsInfo i0=info("m0","m desc");
  for (int i=0; i < MAX_INFO_NAMES + 1; ++i) {
    info("m" + i,"m desc");
    if (i < MAX_INFO_NAMES) {
      assertSame("m0 is still there",i0,info("m0","m desc"));
    }
  }
  assertNotSame("m0 is gone",i0,info("m0","m desc"));
  MetricsInfo i1=info("m1","m desc");
  for (int i=0; i < MAX_INFO_DESCS; ++i) {
    info("m1","m desc" + i);
    if (i < MAX_INFO_DESCS - 1) {
      assertSame("i1 is still there",i1,info("m1","m desc"));
    }
  }
  assertNotSame("i1 is gone",i1,info("m1","m desc"));
}

</code></pre>

<br>
<pre class="type-13 type-11 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testTagOverflow(){
  MetricsTag t0=tag("t0","t desc","t value");
  for (int i=0; i < MAX_TAG_NAMES + 1; ++i) {
    tag("t" + i,"t desc","t value");
    if (i < MAX_TAG_NAMES) {
      assertSame("t0 still there",t0,tag("t0","t desc","t value"));
    }
  }
  assertNotSame("t0 is gone",t0,tag("t0","t desc","t value"));
  MetricsTag t1=tag("t1","t desc","t value");
  for (int i=0; i < MAX_TAG_VALUES; ++i) {
    tag("t1","t desc","t value" + i);
    if (i < MAX_TAG_VALUES - 1) {
      assertSame("t1 is still there",t1,tag("t1","t desc","t value"));
    }
  }
  assertNotSame("t1 is gone",t1,tag("t1","t desc","t value"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.metrics2.util.TestMetricsCache </h4><pre class="type-13 type-11 type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testOverflow(){
  MetricsCache cache=new MetricsCache();
  MetricsCache.Record cr;
  Collection<MetricsTag> t0=Arrays.asList(makeTag("t0","0"));
  for (int i=0; i < MetricsCache.MAX_RECS_PER_NAME_DEFAULT + 1; ++i) {
    cr=cache.update(makeRecord("r",Arrays.asList(makeTag("t" + i,"" + i)),Arrays.asList(makeMetric("m",i))));
    checkMetricValue("new metric value",cr,"m",i);
    if (i < MetricsCache.MAX_RECS_PER_NAME_DEFAULT) {
      assertNotNull("t0 is still there",cache.get("r",t0));
    }
  }
  assertNull("t0 is gone",cache.get("r",t0));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.metrics2.util.TestSampleQuantiles </h4><pre class="type-9 type-13 type-7 type-10 type-20 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
/** 
 * Correctness test that checks that absolute error of the estimate is within
 * specified error bounds for some randomly permuted streams of items.
 */
@Test public void testQuantileError() throws IOException {
  final int count=100000;
  Random r=new Random(0xDEADDEAD);
  Long[] values=new Long[count];
  for (int i=0; i < count; i++) {
    values[i]=(long)(i + 1);
  }
  for (int i=0; i < 10; i++) {
    System.out.println("Starting run " + i);
    Collections.shuffle(Arrays.asList(values),r);
    estimator.clear();
    for (int j=0; j < count; j++) {
      estimator.insert(values[j]);
    }
    Map<Quantile,Long> snapshot;
    snapshot=estimator.snapshot();
    for (    Quantile q : quantiles) {
      long actual=(long)(q.quantile * count);
      long error=(long)(q.error * count);
      long estimate=snapshot.get(q);
      System.out.println(String.format("Expected %d with error %d, estimated %d",actual,error,estimate));
      assertTrue(estimate <= actual + error);
      assertTrue(estimate >= actual - error);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.net.TestNetUtils </h4><pre class="type-9 type-13 type-11 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * Test for {@link NetUtils#isLocalAddress(java.net.InetAddress)}
 */
@Test public void testIsLocalAddress() throws Exception {
  assertTrue(NetUtils.isLocalAddress(InetAddress.getLocalHost()));
  Enumeration<NetworkInterface> interfaces=NetworkInterface.getNetworkInterfaces();
  if (interfaces != null) {
    while (interfaces.hasMoreElements()) {
      NetworkInterface i=interfaces.nextElement();
      Enumeration<InetAddress> addrs=i.getInetAddresses();
      if (addrs == null) {
        continue;
      }
      while (addrs.hasMoreElements()) {
        InetAddress addr=addrs.nextElement();
        assertTrue(NetUtils.isLocalAddress(addr));
      }
    }
  }
  assertFalse(NetUtils.isLocalAddress(InetAddress.getByName("8.8.8.8")));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.net.TestNetworkTopology </h4><pre class="type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testContains() throws Exception {
  DatanodeDescriptor nodeNotInMap=DFSTestUtil.getDatanodeDescriptor("8.8.8.8","/d2/r4");
  for (int i=0; i < dataNodes.length; i++) {
    assertTrue(cluster.contains(dataNodes[i]));
  }
  assertFalse(cluster.contains(nodeNotInMap));
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRemove() throws Exception {
  for (int i=0; i < dataNodes.length; i++) {
    cluster.remove(dataNodes[i]);
  }
  for (int i=0; i < dataNodes.length; i++) {
    assertFalse(cluster.contains(dataNodes[i]));
  }
  assertEquals(0,cluster.getNumOfLeaves());
  for (int i=0; i < dataNodes.length; i++) {
    cluster.add(dataNodes[i]);
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=180000) public void testInvalidNetworkTopologiesNotCachedInHdfs() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  try {
    String racks[]={"/a/b","/c"};
    String hosts[]={"foo1.example.com","foo2.example.com"};
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).racks(racks).hosts(hosts).build();
    cluster.waitActive();
    NamenodeProtocols nn=cluster.getNameNodeRpc();
    Assert.assertNotNull(nn);
    DatanodeInfo[] info;
    while (true) {
      info=nn.getDatanodeReport(DatanodeReportType.LIVE);
      Assert.assertFalse(info.length == 2);
      if (info.length == 1) {
        break;
      }
      Thread.sleep(1000);
    }
    int validIdx=info[0].getHostName().equals(hosts[0]) ? 0 : 1;
    int invalidIdx=validIdx == 1 ? 0 : 1;
    StaticMapping.addNodeToRack(hosts[invalidIdx],racks[validIdx]);
    LOG.info("datanode " + validIdx + " came up with network location "+ info[0].getNetworkLocation());
    cluster.restartDataNode(invalidIdx);
    Thread.sleep(5000);
    while (true) {
      info=nn.getDatanodeReport(DatanodeReportType.LIVE);
      if (info.length == 2) {
        break;
      }
      if (info.length == 0) {
        LOG.info("got no valid DNs");
      }
 else       if (info.length == 1) {
        LOG.info("got one valid DN: " + info[0].getHostName() + " (at "+ info[0].getNetworkLocation()+ ")");
      }
      Thread.sleep(1000);
    }
    Assert.assertEquals(info[0].getNetworkLocation(),info[1].getNetworkLocation());
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-11 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that chooseRandom works for an excluded rack.
 */
@Test public void testChooseRandomExcludedRack(){
  Map<Node,Integer> frequency=pickNodesAtRandom(100,"~" + "/d2");
  for (int j=0; j < dataNodes.length; j++) {
    int freq=frequency.get(dataNodes[j]);
    if (dataNodes[j].getNetworkLocation().startsWith("/d2")) {
      assertEquals(0,freq);
    }
 else {
      assertTrue(freq > 0);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.net.unix.TestDomainSocket </h4><pre class="type-9 type-13 type-11 type-2 type-7 type-10 type-1 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test file descriptor passing.
 * @throws IOException
 */
@Test(timeout=180000) public void testFdPassing() throws Exception {
  final String TEST_PATH=new File(sockDir.getDir(),"test_sock").getAbsolutePath();
  final byte clientMsg1[]=new byte[]{0x11,0x22,0x33,0x44,0x55,0x66};
  final byte serverMsg1[]=new byte[]{0x31,0x30,0x32,0x34,0x31,0x33,0x44,0x1,0x1,0x1,0x1,0x1};
  final ArrayBlockingQueue<Throwable> threadResults=new ArrayBlockingQueue<Throwable>(2);
  final DomainSocket serv=DomainSocket.bindAndListen(TEST_PATH);
  final PassedFile passedFiles[]=new PassedFile[]{new PassedFile(1),new PassedFile(2)};
  final FileDescriptor passedFds[]=new FileDescriptor[passedFiles.length];
  for (int i=0; i < passedFiles.length; i++) {
    passedFds[i]=passedFiles[i].getInputStream().getFD();
  }
  Thread serverThread=new Thread(){
    public void run(){
      DomainSocket conn=null;
      try {
        conn=serv.accept();
        byte in1[]=new byte[clientMsg1.length];
        InputStream connInputStream=conn.getInputStream();
        IOUtils.readFully(connInputStream,in1,0,in1.length);
        Assert.assertTrue(Arrays.equals(clientMsg1,in1));
        DomainSocket domainConn=(DomainSocket)conn;
        domainConn.sendFileDescriptors(passedFds,serverMsg1,0,serverMsg1.length);
        conn.close();
      }
 catch (      Throwable e) {
        threadResults.add(e);
        Assert.fail(e.getMessage());
      }
      threadResults.add(new Success());
    }
  }
;
  serverThread.start();
  Thread clientThread=new Thread(){
    public void run(){
      try {
        DomainSocket client=DomainSocket.connect(TEST_PATH);
        OutputStream clientOutputStream=client.getOutputStream();
        InputStream clientInputStream=client.getInputStream();
        clientOutputStream.write(clientMsg1);
        DomainSocket domainConn=(DomainSocket)client;
        byte in1[]=new byte[serverMsg1.length];
        FileInputStream recvFis[]=new FileInputStream[passedFds.length];
        int r=domainConn.recvFileInputStreams(recvFis,in1,0,in1.length - 1);
        Assert.assertTrue(r > 0);
        IOUtils.readFully(clientInputStream,in1,r,in1.length - r);
        Assert.assertTrue(Arrays.equals(serverMsg1,in1));
        for (int i=0; i < passedFds.length; i++) {
          Assert.assertNotNull(recvFis[i]);
          passedFiles[i].checkInputStream(recvFis[i]);
        }
        for (        FileInputStream fis : recvFis) {
          fis.close();
        }
        client.close();
      }
 catch (      Throwable e) {
        threadResults.add(e);
      }
      threadResults.add(new Success());
    }
  }
;
  clientThread.start();
  for (int i=0; i < 2; i++) {
    Throwable t=threadResults.take();
    if (!(t instanceof Success)) {
      Assert.fail(t.getMessage() + ExceptionUtils.getStackTrace(t));
    }
  }
  serverThread.join(120000);
  clientThread.join(120000);
  serv.close();
  for (  PassedFile pf : passedFiles) {
    pf.cleanup();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.oncrpc.TestRpcCallCache </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCacheFunctionality() throws UnknownHostException {
  RpcCallCache cache=new RpcCallCache("Test",10);
  int size=0;
  for (int clientId=0; clientId < 20; clientId++) {
    InetAddress clientIp=InetAddress.getByName("1.1.1." + clientId);
    System.out.println("Adding " + clientIp);
    cache.checkOrAddToCache(clientIp,0);
    size=Math.min(++size,10);
    System.out.println("Cache size " + cache.size());
    assertEquals(size,cache.size());
    int startEntry=Math.max(clientId - 10 + 1,0);
    Iterator<Entry<ClientRequest,CacheEntry>> iterator=cache.iterator();
    for (int i=0; i < size; i++) {
      ClientRequest key=iterator.next().getKey();
      System.out.println("Entry " + key.getClientId());
      assertEquals(InetAddress.getByName("1.1.1." + (startEntry + i)),key.getClientId());
    }
    for (int i=0; i < size; i++) {
      CacheEntry e=cache.checkOrAddToCache(InetAddress.getByName("1.1.1." + (startEntry + i)),0);
      assertNotNull(e);
      assertTrue(e.isInProgress());
      assertFalse(e.isCompleted());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.security.TestCredentials </h4><pre class="type-13 type-7 type-19 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddTokensToUGI(){
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("someone");
  Credentials creds=new Credentials();
  for (int i=0; i < service.length; i++) {
    creds.addToken(service[i],token[i]);
  }
  ugi.addCredentials(creds);
  creds=ugi.getCredentials();
  for (int i=0; i < service.length; i++) {
    assertSame(token[i],creds.getToken(service[i]));
  }
  assertEquals(service.length,creds.numberOfTokens());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.security.TestPermission </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFilePermission() throws Exception {
  final Configuration conf=new HdfsConfiguration();
  conf.setBoolean(DFSConfigKeys.DFS_PERMISSIONS_ENABLED_KEY,true);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
  cluster.waitActive();
  try {
    FileSystem nnfs=FileSystem.get(conf);
    assertFalse(nnfs.exists(CHILD_FILE1));
    try {
      nnfs.setOwner(CHILD_FILE1,"foo","bar");
      assertTrue(false);
    }
 catch (    java.io.FileNotFoundException e) {
      LOG.info("GOOD: got " + e);
    }
    try {
      nnfs.setPermission(CHILD_FILE1,new FsPermission((short)0777));
      assertTrue(false);
    }
 catch (    java.io.FileNotFoundException e) {
      LOG.info("GOOD: got " + e);
    }
    FSDataOutputStream out=nnfs.create(CHILD_FILE1,new FsPermission((short)0777),true,1024,(short)1,1024,null);
    FileStatus status=nnfs.getFileStatus(CHILD_FILE1);
    assertTrue(status.getPermission().toString().equals("rwxr-xr-x"));
    nnfs.delete(CHILD_FILE1,false);
    nnfs.mkdirs(CHILD_DIR1);
    out=nnfs.create(CHILD_FILE1);
    status=nnfs.getFileStatus(CHILD_FILE1);
    assertTrue(status.getPermission().toString().equals("rw-r--r--"));
    byte data[]=new byte[FILE_LEN];
    RAN.nextBytes(data);
    out.write(data);
    out.close();
    nnfs.setPermission(CHILD_FILE1,new FsPermission("700"));
    status=nnfs.getFileStatus(CHILD_FILE1);
    assertTrue(status.getPermission().toString().equals("rwx------"));
    byte dataIn[]=new byte[FILE_LEN];
    FSDataInputStream fin=nnfs.open(CHILD_FILE1);
    int bytesRead=fin.read(dataIn);
    assertTrue(bytesRead == FILE_LEN);
    for (int i=0; i < FILE_LEN; i++) {
      assertEquals(data[i],dataIn[i]);
    }
    nnfs.setPermission(CHILD_FILE1,new FsPermission("755"));
    status=nnfs.getFileStatus(CHILD_FILE1);
    assertTrue(status.getPermission().toString().equals("rwxr-xr-x"));
    nnfs.setPermission(CHILD_FILE1,new FsPermission("744"));
    status=nnfs.getFileStatus(CHILD_FILE1);
    assertTrue(status.getPermission().toString().equals("rwxr--r--"));
    nnfs.setPermission(CHILD_FILE1,new FsPermission("700"));
    UserGroupInformation userGroupInfo=UserGroupInformation.createUserForTesting(USER_NAME,GROUP_NAMES);
    FileSystem userfs=DFSTestUtil.getFileSystemAs(userGroupInfo,conf);
    userfs.mkdirs(CHILD_DIR1);
    assertTrue(!canMkdirs(userfs,CHILD_DIR2));
    assertTrue(!canCreate(userfs,CHILD_FILE2));
    assertTrue(!canOpen(userfs,CHILD_FILE1));
    nnfs.setPermission(ROOT_PATH,new FsPermission((short)0755));
    nnfs.setPermission(CHILD_DIR1,new FsPermission("777"));
    nnfs.setPermission(new Path("/"),new FsPermission((short)0777));
    final Path RENAME_PATH=new Path("/foo/bar");
    userfs.mkdirs(RENAME_PATH);
    assertTrue(canRename(userfs,RENAME_PATH,CHILD_DIR1));
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.security.TestRefreshUserMappings </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGroupMappingRefresh() throws Exception {
  DFSAdmin admin=new DFSAdmin(config);
  String[] args=new String[]{"-refreshUserToGroupsMappings"};
  Groups groups=Groups.getUserToGroupsMappingService(config);
  String user=UserGroupInformation.getCurrentUser().getUserName();
  System.out.println("first attempt:");
  List<String> g1=groups.getGroups(user);
  String[] str_groups=new String[g1.size()];
  g1.toArray(str_groups);
  System.out.println(Arrays.toString(str_groups));
  System.out.println("second attempt, should be same:");
  List<String> g2=groups.getGroups(user);
  g2.toArray(str_groups);
  System.out.println(Arrays.toString(str_groups));
  for (int i=0; i < g2.size(); i++) {
    assertEquals("Should be same group ",g1.get(i),g2.get(i));
  }
  admin.run(args);
  System.out.println("third attempt(after refresh command), should be different:");
  List<String> g3=groups.getGroups(user);
  g3.toArray(str_groups);
  System.out.println(Arrays.toString(str_groups));
  for (int i=0; i < g3.size(); i++) {
    assertFalse("Should be different group: " + g1.get(i) + " and "+ g3.get(i),g1.get(i).equals(g3.get(i)));
  }
  Thread.sleep(groupRefreshTimeoutSec * 1100);
  System.out.println("fourth attempt(after timeout), should be different:");
  List<String> g4=groups.getGroups(user);
  g4.toArray(str_groups);
  System.out.println(Arrays.toString(str_groups));
  for (int i=0; i < g4.size(); i++) {
    assertFalse("Should be different group ",g3.get(i).equals(g4.get(i)));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.security.TestUserGroupInformation </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * given user name - get all the groups.
 * Needs to happen before creating the test users
 */
@Test(timeout=30000) public void testGetServerSideGroups() throws IOException, InterruptedException {
  Process pp=Runtime.getRuntime().exec("whoami");
  BufferedReader br=new BufferedReader(new InputStreamReader(pp.getInputStream()));
  String userName=br.readLine().trim();
  if (Shell.WINDOWS) {
    int sp=userName.lastIndexOf('\\');
    if (sp != -1) {
      userName=userName.substring(sp + 1);
    }
    userName=userName.toLowerCase();
  }
  pp=Runtime.getRuntime().exec(Shell.WINDOWS ? Shell.WINUTILS + " groups -F" : "id -Gn");
  br=new BufferedReader(new InputStreamReader(pp.getInputStream()));
  String line=br.readLine();
  System.out.println(userName + ":" + line);
  Set<String> groups=new LinkedHashSet<String>();
  String[] tokens=line.split(Shell.TOKEN_SEPARATOR_REGEX);
  for (  String s : tokens) {
    groups.add(s);
  }
  final UserGroupInformation login=UserGroupInformation.getCurrentUser();
  String loginUserName=login.getShortUserName();
  if (Shell.WINDOWS) {
    loginUserName=loginUserName.toLowerCase();
  }
  assertEquals(userName,loginUserName);
  String[] gi=login.getGroupNames();
  assertEquals(groups.size(),gi.length);
  for (int i=0; i < gi.length; i++) {
    assertTrue(groups.contains(gi[i]));
  }
  final UserGroupInformation fakeUser=UserGroupInformation.createRemoteUser("foo.bar");
  fakeUser.doAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws IOException {
      UserGroupInformation current=UserGroupInformation.getCurrentUser();
      assertFalse(current.equals(login));
      assertEquals(current,fakeUser);
      assertEquals(0,current.getGroupNames().length);
      return null;
    }
  }
);
}

</code></pre>

<br>
<pre class="type-13 type-2 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks a race condition between getting and adding tokens for
 * the current user.  Calling UserGroupInformation.getCurrentUser() returns
 * a new object each time, so simply making these methods synchronized was not
 * enough to prevent race conditions and causing a
 * ConcurrentModificationException.  These methods are synchronized on the
 * Subject, which is the same object between UserGroupInformation instances.
 * This test tries to cause a CME, by exposing the race condition.  Previously
 * this test would fail every time; now it does not.
 */
@Test public void testTokenRaceCondition() throws Exception {
  UserGroupInformation userGroupInfo=UserGroupInformation.createUserForTesting(USER_NAME,GROUP_NAMES);
  userGroupInfo.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      assertNotEquals(UserGroupInformation.getLoginUser(),UserGroupInformation.getCurrentUser());
      GetTokenThread thread=new GetTokenThread();
      try {
        thread.start();
        for (int i=0; i < 100; i++) {
          @SuppressWarnings("unchecked") Token<? extends TokenIdentifier> t=mock(Token.class);
          when(t.getService()).thenReturn(new Text("t" + i));
          UserGroupInformation.getCurrentUser().addToken(t);
          assertNull("ConcurrentModificationException encountered",thread.cme);
        }
      }
 catch (      ConcurrentModificationException cme) {
        cme.printStackTrace();
        fail("ConcurrentModificationException encountered");
      }
 finally {
        thread.runThread=false;
        thread.join(5 * 1000);
      }
      return null;
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.security.token.delegation.TestDelegationToken </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParallelDelegationTokenCreation() throws Exception {
  final TestDelegationTokenSecretManager dtSecretManager=new TestDelegationTokenSecretManager(2000,24 * 60 * 60* 1000,7 * 24 * 60* 60* 1000,2000);
  try {
    dtSecretManager.startThreads();
    int numThreads=100;
    final int numTokensPerThread=100;
class tokenIssuerThread implements Runnable {
      @Override public void run(){
        for (int i=0; i < numTokensPerThread; i++) {
          generateDelegationToken(dtSecretManager,"auser","arenewer");
          try {
            Thread.sleep(250);
          }
 catch (          Exception e) {
          }
        }
      }
    }
    Thread[] issuers=new Thread[numThreads];
    for (int i=0; i < numThreads; i++) {
      issuers[i]=new Daemon(new tokenIssuerThread());
      issuers[i].start();
    }
    for (int i=0; i < numThreads; i++) {
      issuers[i].join();
    }
    Map<TestDelegationTokenIdentifier,DelegationTokenInformation> tokenCache=dtSecretManager.getAllTokens();
    Assert.assertEquals(numTokensPerThread * numThreads,tokenCache.size());
    Iterator<TestDelegationTokenIdentifier> iter=tokenCache.keySet().iterator();
    while (iter.hasNext()) {
      TestDelegationTokenIdentifier id=iter.next();
      DelegationTokenInformation info=tokenCache.get(id);
      Assert.assertTrue(info != null);
      DelegationKey key=dtSecretManager.getKey(id);
      Assert.assertTrue(key != null);
      byte[] storedPassword=dtSecretManager.retrievePassword(id);
      byte[] password=dtSecretManager.createPassword(id,key);
      Assert.assertTrue(Arrays.equals(password,storedPassword));
      dtSecretManager.verifyToken(id,password);
    }
  }
  finally {
    dtSecretManager.stopThreads();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.service.TestCompositeService </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCallSequence(){
  ServiceManager serviceManager=new ServiceManager("ServiceManager");
  for (int i=0; i < NUM_OF_SERVICES; i++) {
    CompositeServiceImpl service=new CompositeServiceImpl(i);
    serviceManager.addTestService(service);
  }
  CompositeServiceImpl[] services=serviceManager.getServices().toArray(new CompositeServiceImpl[0]);
  assertEquals("Number of registered services ",NUM_OF_SERVICES,services.length);
  Configuration conf=new Configuration();
  serviceManager.init(conf);
  assertInState(STATE.INITED,services);
  for (int i=0; i < NUM_OF_SERVICES; i++) {
    assertEquals("For " + services[i] + " service, init() call sequence number should have been ",i,services[i].getCallSequenceNumber());
  }
  resetServices(services);
  serviceManager.start();
  assertInState(STATE.STARTED,services);
  for (int i=0; i < NUM_OF_SERVICES; i++) {
    assertEquals("For " + services[i] + " service, start() call sequence number should have been ",i,services[i].getCallSequenceNumber());
  }
  resetServices(services);
  serviceManager.stop();
  assertInState(STATE.STOPPED,services);
  for (int i=0; i < NUM_OF_SERVICES; i++) {
    assertEquals("For " + services[i] + " service, stop() call sequence number should have been ",((NUM_OF_SERVICES - 1) - i),services[i].getCallSequenceNumber());
  }
  serviceManager.stop();
  for (int i=0; i < NUM_OF_SERVICES; i++) {
    assertEquals("For " + services[i] + " service, stop() call sequence number should have been ",((NUM_OF_SERVICES - 1) - i),services[i].getCallSequenceNumber());
  }
}

</code></pre>

<br>
<pre class="type-13 type-11 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServiceStartup(){
  ServiceManager serviceManager=new ServiceManager("ServiceManager");
  for (int i=0; i < NUM_OF_SERVICES; i++) {
    CompositeServiceImpl service=new CompositeServiceImpl(i);
    if (i == FAILED_SERVICE_SEQ_NUMBER) {
      service.setThrowExceptionOnStart(true);
    }
    serviceManager.addTestService(service);
  }
  CompositeServiceImpl[] services=serviceManager.getServices().toArray(new CompositeServiceImpl[0]);
  Configuration conf=new Configuration();
  serviceManager.init(conf);
  try {
    serviceManager.start();
    fail("Exception should have been thrown due to startup failure of last service");
  }
 catch (  ServiceTestRuntimeException e) {
    for (int i=0; i < NUM_OF_SERVICES - 1; i++) {
      if (i >= FAILED_SERVICE_SEQ_NUMBER && STOP_ONLY_STARTED_SERVICES) {
        assertEquals("Service state should have been ",STATE.INITED,services[NUM_OF_SERVICES - 1].getServiceState());
      }
 else {
        assertEquals("Service state should have been ",STATE.STOPPED,services[i].getServiceState());
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.streaming.TestAutoInputFormat </h4><pre class="type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings({"unchecked","deprecation"}) @Test public void testFormat() throws IOException {
  JobConf job=new JobConf(conf);
  FileSystem fs=FileSystem.getLocal(conf);
  Path dir=new Path(System.getProperty("test.build.data",".") + "/mapred");
  Path txtFile=new Path(dir,"auto.txt");
  Path seqFile=new Path(dir,"auto.seq");
  fs.delete(dir,true);
  FileInputFormat.setInputPaths(job,dir);
  Writer txtWriter=new OutputStreamWriter(fs.create(txtFile));
  try {
    for (int i=0; i < LINES_COUNT; i++) {
      txtWriter.write("" + (10 * i));
      txtWriter.write("\n");
    }
  }
  finally {
    txtWriter.close();
  }
  SequenceFile.Writer seqWriter=SequenceFile.createWriter(fs,conf,seqFile,IntWritable.class,LongWritable.class);
  try {
    for (int i=0; i < RECORDS_COUNT; i++) {
      IntWritable key=new IntWritable(11 * i);
      LongWritable value=new LongWritable(12 * i);
      seqWriter.append(key,value);
    }
  }
  finally {
    seqWriter.close();
  }
  AutoInputFormat format=new AutoInputFormat();
  InputSplit[] splits=format.getSplits(job,SPLITS_COUNT);
  for (  InputSplit split : splits) {
    RecordReader reader=format.getRecordReader(split,job,Reporter.NULL);
    Object key=reader.createKey();
    Object value=reader.createValue();
    try {
      while (reader.next(key,value)) {
        if (key instanceof LongWritable) {
          assertEquals("Wrong value class.",Text.class,value.getClass());
          assertTrue("Invalid value",Integer.parseInt(((Text)value).toString()) % 10 == 0);
        }
 else {
          assertEquals("Wrong key class.",IntWritable.class,key.getClass());
          assertEquals("Wrong value class.",LongWritable.class,value.getClass());
          assertTrue("Invalid key.",((IntWritable)key).get() % 11 == 0);
          assertTrue("Invalid value.",((LongWritable)value).get() % 12 == 0);
        }
      }
    }
  finally {
      reader.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.streaming.TestDumpTypedBytes </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDumping() throws Exception {
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  PrintStream psBackup=System.out;
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  PrintStream psOut=new PrintStream(out);
  System.setOut(psOut);
  DumpTypedBytes dumptb=new DumpTypedBytes(conf);
  try {
    Path root=new Path("/typedbytestest");
    assertTrue(fs.mkdirs(root));
    assertTrue(fs.exists(root));
    OutputStreamWriter writer=new OutputStreamWriter(fs.create(new Path(root,"test.txt")));
    try {
      for (int i=0; i < 100; i++) {
        writer.write("" + (10 * i) + "\n");
      }
    }
  finally {
      writer.close();
    }
    String[] args=new String[1];
    args[0]="/typedbytestest";
    int ret=dumptb.run(args);
    assertEquals("Return value != 0.",0,ret);
    ByteArrayInputStream in=new ByteArrayInputStream(out.toByteArray());
    TypedBytesInput tbinput=new TypedBytesInput(new DataInputStream(in));
    int counter=0;
    Object key=tbinput.read();
    while (key != null) {
      assertEquals(Long.class,key.getClass());
      Object value=tbinput.read();
      assertEquals(String.class,value.getClass());
      assertTrue("Invalid output.",Integer.parseInt(value.toString()) % 10 == 0);
      counter++;
      key=tbinput.read();
    }
    assertEquals("Wrong number of outputs.",100,counter);
  }
  finally {
    try {
      fs.close();
    }
 catch (    Exception e) {
    }
    System.setOut(psBackup);
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.streaming.TestLoadTypedBytes </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLoading() throws Exception {
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  TypedBytesOutput tboutput=new TypedBytesOutput(new DataOutputStream(out));
  for (int i=0; i < 100; i++) {
    tboutput.write(new Long(i));
    tboutput.write("" + (10 * i));
  }
  InputStream isBackup=System.in;
  ByteArrayInputStream in=new ByteArrayInputStream(out.toByteArray());
  System.setIn(in);
  LoadTypedBytes loadtb=new LoadTypedBytes(conf);
  try {
    Path root=new Path("/typedbytestest");
    assertTrue(fs.mkdirs(root));
    assertTrue(fs.exists(root));
    String[] args=new String[1];
    args[0]="/typedbytestest/test.seq";
    int ret=loadtb.run(args);
    assertEquals("Return value != 0.",0,ret);
    Path file=new Path(root,"test.seq");
    assertTrue(fs.exists(file));
    SequenceFile.Reader reader=new SequenceFile.Reader(fs,file,conf);
    int counter=0;
    TypedBytesWritable key=new TypedBytesWritable();
    TypedBytesWritable value=new TypedBytesWritable();
    while (reader.next(key,value)) {
      assertEquals(Long.class,key.getValue().getClass());
      assertEquals(String.class,value.getValue().getClass());
      assertTrue("Invalid record.",Integer.parseInt(value.toString()) % 10 == 0);
      counter++;
    }
    assertEquals("Wrong number of records.",100,counter);
  }
  finally {
    try {
      fs.close();
    }
 catch (    Exception e) {
    }
    System.setIn(isBackup);
    cluster.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.tools.mapred.lib.TestDynamicInputFormat </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetSplits() throws Exception {
  DistCpOptions options=getOptions();
  Configuration configuration=new Configuration();
  configuration.set("mapred.map.tasks",String.valueOf(options.getMaxMaps()));
  CopyListing.getCopyListing(configuration,CREDENTIALS,options).buildListing(new Path(cluster.getFileSystem().getUri().toString() + "/tmp/testDynInputFormat/fileList.seq"),options);
  JobContext jobContext=new JobContextImpl(configuration,new JobID());
  DynamicInputFormat<Text,CopyListingFileStatus> inputFormat=new DynamicInputFormat<Text,CopyListingFileStatus>();
  List<InputSplit> splits=inputFormat.getSplits(jobContext);
  int nFiles=0;
  int taskId=0;
  for (  InputSplit split : splits) {
    RecordReader<Text,CopyListingFileStatus> recordReader=inputFormat.createRecordReader(split,null);
    StubContext stubContext=new StubContext(jobContext.getConfiguration(),recordReader,taskId);
    final TaskAttemptContext taskAttemptContext=stubContext.getContext();
    recordReader.initialize(splits.get(0),taskAttemptContext);
    float previousProgressValue=0f;
    while (recordReader.nextKeyValue()) {
      CopyListingFileStatus fileStatus=recordReader.getCurrentValue();
      String source=fileStatus.getPath().toString();
      System.out.println(source);
      Assert.assertTrue(expectedFilePaths.contains(source));
      final float progress=recordReader.getProgress();
      Assert.assertTrue(progress >= previousProgressValue);
      Assert.assertTrue(progress >= 0.0f);
      Assert.assertTrue(progress <= 1.0f);
      previousProgressValue=progress;
      ++nFiles;
    }
    Assert.assertTrue(recordReader.getProgress() == 1.0f);
    ++taskId;
  }
  Assert.assertEquals(expectedFilePaths.size(),nFiles);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.tools.rumen.TestHistograms </h4><pre class="type-9 type-13 type-11 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * @throws IOExceptionThere should be files in the directory named by
 * ${test.build.data}/rumen/histogram-test .
 * There will be pairs of files, inputXxx.json and goldXxx.json .
 * We read the input file as a HistogramRawTestData in json. Then we
 * create a Histogram using the data field, and then a
 * LoggedDiscreteCDF using the percentiles and scale field. Finally,
 * we read the corresponding goldXxx.json as a LoggedDiscreteCDF and
 * deepCompare them.
 */
@Test public void testHistograms() throws IOException {
  final Configuration conf=new Configuration();
  final FileSystem lfs=FileSystem.getLocal(conf);
  final Path rootInputDir=new Path(System.getProperty("test.tools.input.dir","")).makeQualified(lfs);
  final Path rootInputFile=new Path(rootInputDir,"rumen/histogram-tests");
  FileStatus[] tests=lfs.listStatus(rootInputFile);
  for (int i=0; i < tests.length; ++i) {
    Path filePath=tests[i].getPath();
    String fileName=filePath.getName();
    if (fileName.startsWith("input")) {
      String testName=fileName.substring("input".length());
      Path goldFilePath=new Path(rootInputFile,"gold" + testName);
      assertTrue("Gold file dies not exist",lfs.exists(goldFilePath));
      LoggedDiscreteCDF newResult=histogramFileToCDF(filePath,lfs);
      System.out.println("Testing a Histogram for " + fileName);
      FSDataInputStream goldStream=lfs.open(goldFilePath);
      JsonObjectMapperParser<LoggedDiscreteCDF> parser=new JsonObjectMapperParser<LoggedDiscreteCDF>(goldStream,LoggedDiscreteCDF.class);
      try {
        LoggedDiscreteCDF dcdf=parser.getNext();
        dcdf.deepCompare(newResult,new TreePath(null,"<root>"));
      }
 catch (      DeepInequalityException e) {
        fail(e.path.toString());
      }
 finally {
        parser.close();
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.util.TestGSet </h4><pre class="type-13 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExceptionCases(){
{
    final LightWeightGSet<Integer,Integer> gset=new LightWeightGSet<Integer,Integer>(16);
    try {
      gset.contains(null);
      Assert.fail();
    }
 catch (    NullPointerException e) {
      LightWeightGSet.LOG.info("GOOD: getting " + e,e);
    }
  }
{
    final LightWeightGSet<Integer,Integer> gset=new LightWeightGSet<Integer,Integer>(16);
    try {
      gset.get(null);
      Assert.fail();
    }
 catch (    NullPointerException e) {
      LightWeightGSet.LOG.info("GOOD: getting " + e,e);
    }
  }
{
    final LightWeightGSet<Integer,Integer> gset=new LightWeightGSet<Integer,Integer>(16);
    try {
      gset.put(null);
      Assert.fail();
    }
 catch (    NullPointerException e) {
      LightWeightGSet.LOG.info("GOOD: getting " + e,e);
    }
    try {
      gset.put(1);
      Assert.fail();
    }
 catch (    IllegalArgumentException e) {
      LightWeightGSet.LOG.info("GOOD: getting " + e,e);
    }
  }
{
    final IntElement[] data=new IntElement[5];
    for (int i=0; i < data.length; i++) {
      data[i]=new IntElement(i,i);
    }
    for (int v=1; v < data.length - 1; v++) {
{
        final GSet<IntElement,IntElement> gset=createGSet(data);
        for (        IntElement i : gset) {
          if (i.value == v) {
            gset.remove(data[0]);
          }
        }
        try {
          for (          IntElement i : gset) {
            if (i.value == v) {
              gset.remove(data[1]);
            }
          }
          Assert.fail();
        }
 catch (        ConcurrentModificationException e) {
          LightWeightGSet.LOG.info("GOOD: getting " + e,e);
        }
      }
{
        final GSet<IntElement,IntElement> gset=createGSet(data);
        try {
          for (          IntElement i : gset) {
            if (i.value == v) {
              gset.put(data[0]);
            }
          }
          Assert.fail();
        }
 catch (        ConcurrentModificationException e) {
          LightWeightGSet.LOG.info("GOOD: getting " + e,e);
        }
      }
{
        final GSet<IntElement,IntElement> gset=createGSet(data);
        try {
          for (          IntElement i : gset) {
            if (i.value == v) {
              gset.put(data[3]);
            }
          }
          Assert.fail();
        }
 catch (        ConcurrentModificationException e) {
          LightWeightGSet.LOG.info("GOOD: getting " + e,e);
        }
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.util.TestIdentityHashStore </h4><pre class="type-13 type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAdditionsAndRemovals(){
  IdentityHashStore<Key,Integer> store=new IdentityHashStore<Key,Integer>(0);
  final int NUM_KEYS=1000;
  LOG.debug("generating " + NUM_KEYS + " keys");
  final List<Key> keys=new ArrayList<Key>(NUM_KEYS);
  for (int i=0; i < NUM_KEYS; i++) {
    keys.add(new Key("key " + i));
  }
  for (int i=0; i < NUM_KEYS; i++) {
    store.put(keys.get(i),i);
  }
  store.visitAll(new Visitor<Key,Integer>(){
    @Override public void accept(    Key k,    Integer v){
      Assert.assertTrue(keys.contains(k));
    }
  }
);
  for (int i=0; i < NUM_KEYS; i++) {
    Assert.assertEquals(Integer.valueOf(i),store.remove(keys.get(i)));
  }
  store.visitAll(new Visitor<Key,Integer>(){
    @Override public void accept(    Key k,    Integer v){
      Assert.fail("expected all entries to be removed");
    }
  }
);
  Assert.assertTrue("expected the store to be " + "empty, but found " + store.numElements() + " elements.",store.isEmpty());
  Assert.assertEquals(1024,store.capacity());
}

</code></pre>

<br>
<pre class="type-13 type-2 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testDuplicateInserts(){
  IdentityHashStore<Key,Integer> store=new IdentityHashStore<Key,Integer>(4);
  store.visitAll(new Visitor<Key,Integer>(){
    @Override public void accept(    Key k,    Integer v){
      Assert.fail("found key " + k + " in empty IdentityHashStore.");
    }
  }
);
  Assert.assertTrue(store.isEmpty());
  Key key1=new Key("key1");
  Integer value1=new Integer(100);
  Integer value2=new Integer(200);
  Integer value3=new Integer(300);
  store.put(key1,value1);
  Key equalToKey1=new Key("key1");
  Assert.assertNull(store.get(equalToKey1));
  Assert.assertTrue(!store.isEmpty());
  Assert.assertEquals(value1,store.get(key1));
  store.put(key1,value2);
  store.put(key1,value3);
  final List<Integer> allValues=new LinkedList<Integer>();
  store.visitAll(new Visitor<Key,Integer>(){
    @Override public void accept(    Key k,    Integer v){
      allValues.add(v);
    }
  }
);
  Assert.assertEquals(3,allValues.size());
  for (int i=0; i < 3; i++) {
    Integer value=store.remove(key1);
    Assert.assertTrue(allValues.remove(value));
  }
  Assert.assertNull(store.remove(key1));
  Assert.assertTrue(store.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.util.TestLightWeightGSet </h4><pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=60000) public void testRemoveSomeViaIterator(){
  ArrayList<Integer> list=getRandomList(100,123);
  LightWeightGSet<TestElement,TestElement> set=new LightWeightGSet<TestElement,TestElement>(16);
  for (  Integer i : list) {
    set.put(new TestElement(i));
  }
  long sum=0;
  for (Iterator<TestElement> iter=set.iterator(); iter.hasNext(); ) {
    sum+=iter.next().getVal();
  }
  long mode=sum / set.size();
  LOG.info("Removing all elements above " + mode);
  for (Iterator<TestElement> iter=set.iterator(); iter.hasNext(); ) {
    int item=iter.next().getVal();
    if (item > mode) {
      iter.remove();
    }
  }
  for (Iterator<TestElement> iter=set.iterator(); iter.hasNext(); ) {
    Assert.assertTrue(iter.next().getVal() <= mode);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.util.TestReflectionUtils </h4><pre class="type-9 type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testCacheDoesntLeak() throws Exception {
  int iterations=9999;
  for (int i=0; i < iterations; i++) {
    URLClassLoader loader=new URLClassLoader(new URL[0],getClass().getClassLoader());
    Class cl=Class.forName("org.apache.hadoop.util.TestReflectionUtils$LoadedInChild",false,loader);
    Object o=ReflectionUtils.newInstance(cl,null);
    assertEquals(cl,o.getClass());
  }
  System.gc();
  assertTrue(cacheSize() + " too big",cacheSize() < iterations);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.util.TestStringUtils </h4><pre class="type-13 type-2 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testTraditionalBinaryPrefix() throws Exception {
  String[] symbol={"k","m","g","t","p","e"};
  long m=1024;
  for (  String s : symbol) {
    assertEquals(0,string2long(0 + s));
    assertEquals(m,string2long(1 + s));
    m*=1024;
  }
  assertEquals(0L,string2long("0"));
  assertEquals(1024L,string2long("1k"));
  assertEquals(-1024L,string2long("-1k"));
  assertEquals(1259520L,string2long("1230K"));
  assertEquals(-1259520L,string2long("-1230K"));
  assertEquals(104857600L,string2long("100m"));
  assertEquals(-104857600L,string2long("-100M"));
  assertEquals(956703965184L,string2long("891g"));
  assertEquals(-956703965184L,string2long("-891G"));
  assertEquals(501377302265856L,string2long("456t"));
  assertEquals(-501377302265856L,string2long("-456T"));
  assertEquals(11258999068426240L,string2long("10p"));
  assertEquals(-11258999068426240L,string2long("-10P"));
  assertEquals(1152921504606846976L,string2long("1e"));
  assertEquals(-1152921504606846976L,string2long("-1E"));
  String tooLargeNumStr="10e";
  try {
    string2long(tooLargeNumStr);
    fail("Test passed for a number " + tooLargeNumStr + " too large");
  }
 catch (  IllegalArgumentException e) {
    assertEquals(tooLargeNumStr + " does not fit in a Long",e.getMessage());
  }
  String tooSmallNumStr="-10e";
  try {
    string2long(tooSmallNumStr);
    fail("Test passed for a number " + tooSmallNumStr + " too small");
  }
 catch (  IllegalArgumentException e) {
    assertEquals(tooSmallNumStr + " does not fit in a Long",e.getMessage());
  }
  String invalidFormatNumStr="10kb";
  char invalidPrefix='b';
  try {
    string2long(invalidFormatNumStr);
    fail("Test passed for a number " + invalidFormatNumStr + " has invalid format");
  }
 catch (  IllegalArgumentException e) {
    assertEquals("Invalid size prefix '" + invalidPrefix + "' in '"+ invalidFormatNumStr+ "'. Allowed prefixes are k, m, g, t, p, e(case insensitive)",e.getMessage());
  }
  assertEquals("0",long2String(0,null,2));
  for (int decimalPlace=0; decimalPlace < 2; decimalPlace++) {
    for (int n=1; n < TraditionalBinaryPrefix.KILO.value; n++) {
      assertEquals(n + "",long2String(n,null,decimalPlace));
      assertEquals(-n + "",long2String(-n,null,decimalPlace));
    }
    assertEquals("1 K",long2String(1L << 10,null,decimalPlace));
    assertEquals("-1 K",long2String(-1L << 10,null,decimalPlace));
  }
  assertEquals("8.00 E",long2String(Long.MAX_VALUE,null,2));
  assertEquals("8.00 E",long2String(Long.MAX_VALUE - 1,null,2));
  assertEquals("-8 E",long2String(Long.MIN_VALUE,null,2));
  assertEquals("-8.00 E",long2String(Long.MIN_VALUE + 1,null,2));
  final String[] zeros={" ",".0 ",".00 "};
  for (int decimalPlace=0; decimalPlace < zeros.length; decimalPlace++) {
    final String trailingZeros=zeros[decimalPlace];
    for (int e=11; e < Long.SIZE - 1; e++) {
      final TraditionalBinaryPrefix p=TraditionalBinaryPrefix.values()[e / 10 - 1];
{
        final long n=1L << e;
        final String expected=(n / p.value) + " " + p.symbol;
        assertEquals("n=" + n,expected,long2String(n,null,2));
      }
{
        final long n=(1L << e) + 1;
        final String expected=(n / p.value) + trailingZeros + p.symbol;
        assertEquals("n=" + n,expected,long2String(n,null,decimalPlace));
      }
{
        final long n=(1L << e) - 1;
        final String expected=((n + 1) / p.value) + trailingZeros + p.symbol;
        assertEquals("n=" + n,expected,long2String(n,null,decimalPlace));
      }
    }
  }
  assertEquals("1.50 K",long2String(3L << 9,null,2));
  assertEquals("1.5 K",long2String(3L << 9,null,1));
  assertEquals("1.50 M",long2String(3L << 19,null,2));
  assertEquals("2 M",long2String(3L << 19,null,0));
  assertEquals("3 G",long2String(3L << 30,null,2));
  assertEquals("0 B",StringUtils.byteDesc(0));
  assertEquals("-100 B",StringUtils.byteDesc(-100));
  assertEquals("1 KB",StringUtils.byteDesc(1024));
  assertEquals("1.50 KB",StringUtils.byteDesc(3L << 9));
  assertEquals("1.50 MB",StringUtils.byteDesc(3L << 19));
  assertEquals("3 GB",StringUtils.byteDesc(3L << 30));
  assertEquals("10%",StringUtils.formatPercent(0.1,0));
  assertEquals("10.0%",StringUtils.formatPercent(0.1,1));
  assertEquals("10.00%",StringUtils.formatPercent(0.1,2));
  assertEquals("1%",StringUtils.formatPercent(0.00543,0));
  assertEquals("0.5%",StringUtils.formatPercent(0.00543,1));
  assertEquals("0.54%",StringUtils.formatPercent(0.00543,2));
  assertEquals("0.543%",StringUtils.formatPercent(0.00543,3));
  assertEquals("0.5430%",StringUtils.formatPercent(0.00543,4));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.util.hash.TestHash </h4><pre class="type-9 type-13 type-7 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHash(){
  int iterations=30;
  assertTrue("testHash jenkins error !!!",Hash.JENKINS_HASH == Hash.parseHashType("jenkins"));
  assertTrue("testHash murmur error !!!",Hash.MURMUR_HASH == Hash.parseHashType("murmur"));
  assertTrue("testHash undefined",Hash.INVALID_HASH == Hash.parseHashType("undefined"));
  Configuration cfg=new Configuration();
  cfg.set("hadoop.util.hash.type","murmur");
  assertTrue("testHash",MurmurHash.getInstance() == Hash.getInstance(cfg));
  cfg=new Configuration();
  cfg.set("hadoop.util.hash.type","jenkins");
  assertTrue("testHash jenkins configuration error !!!",JenkinsHash.getInstance() == Hash.getInstance(cfg));
  cfg=new Configuration();
  assertTrue("testHash undefine configuration error !!!",MurmurHash.getInstance() == Hash.getInstance(cfg));
  assertTrue("testHash error jenkin getInstance !!!",JenkinsHash.getInstance() == Hash.getInstance(Hash.JENKINS_HASH));
  assertTrue("testHash error murmur getInstance !!!",MurmurHash.getInstance() == Hash.getInstance(Hash.MURMUR_HASH));
  assertNull("testHash error invalid getInstance !!!",Hash.getInstance(Hash.INVALID_HASH));
  int murmurHash=Hash.getInstance(Hash.MURMUR_HASH).hash(LINE.getBytes());
  for (int i=0; i < iterations; i++) {
    assertTrue("multiple evaluation murmur hash error !!!",murmurHash == Hash.getInstance(Hash.MURMUR_HASH).hash(LINE.getBytes()));
  }
  murmurHash=Hash.getInstance(Hash.MURMUR_HASH).hash(LINE.getBytes(),67);
  for (int i=0; i < iterations; i++) {
    assertTrue("multiple evaluation murmur hash error !!!",murmurHash == Hash.getInstance(Hash.MURMUR_HASH).hash(LINE.getBytes(),67));
  }
  int jenkinsHash=Hash.getInstance(Hash.JENKINS_HASH).hash(LINE.getBytes());
  for (int i=0; i < iterations; i++) {
    assertTrue("multiple evaluation jenkins hash error !!!",jenkinsHash == Hash.getInstance(Hash.JENKINS_HASH).hash(LINE.getBytes()));
  }
  jenkinsHash=Hash.getInstance(Hash.JENKINS_HASH).hash(LINE.getBytes(),67);
  for (int i=0; i < iterations; i++) {
    assertTrue("multiple evaluation jenkins hash error !!!",jenkinsHash == Hash.getInstance(Hash.JENKINS_HASH).hash(LINE.getBytes(),67));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.api.TestAllocateRequest </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAllcoateRequestWithIncrease(){
  List<ContainerResourceIncreaseRequest> incRequests=new ArrayList<ContainerResourceIncreaseRequest>();
  for (int i=0; i < 3; i++) {
    incRequests.add(ContainerResourceIncreaseRequest.newInstance(null,Resource.newInstance(0,i)));
  }
  AllocateRequest r=AllocateRequest.newInstance(123,0f,null,null,null,incRequests);
  AllocateRequestProto p=((AllocateRequestPBImpl)r).getProto();
  r=new AllocateRequestPBImpl(p);
  Assert.assertEquals(123,r.getResponseId());
  Assert.assertEquals(incRequests.size(),r.getIncreaseRequests().size());
  for (int i=0; i < incRequests.size(); i++) {
    Assert.assertEquals(r.getIncreaseRequests().get(i).getCapability().getVirtualCores(),incRequests.get(i).getCapability().getVirtualCores());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.api.TestAllocateResponse </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAllocateResponseWithIncDecContainers(){
  List<ContainerResourceIncrease> incContainers=new ArrayList<ContainerResourceIncrease>();
  List<ContainerResourceDecrease> decContainers=new ArrayList<ContainerResourceDecrease>();
  for (int i=0; i < 3; i++) {
    incContainers.add(ContainerResourceIncrease.newInstance(null,Resource.newInstance(1024,i),null));
  }
  for (int i=0; i < 5; i++) {
    decContainers.add(ContainerResourceDecrease.newInstance(null,Resource.newInstance(1024,i)));
  }
  AllocateResponse r=AllocateResponse.newInstance(3,new ArrayList<ContainerStatus>(),new ArrayList<Container>(),new ArrayList<NodeReport>(),null,AMCommand.AM_RESYNC,3,null,new ArrayList<NMToken>(),incContainers,decContainers);
  AllocateResponseProto p=((AllocateResponsePBImpl)r).getProto();
  r=new AllocateResponsePBImpl(p);
  Assert.assertEquals(incContainers.size(),r.getIncreasedContainers().size());
  Assert.assertEquals(decContainers.size(),r.getDecreasedContainers().size());
  for (int i=0; i < incContainers.size(); i++) {
    Assert.assertEquals(i,r.getIncreasedContainers().get(i).getCapability().getVirtualCores());
  }
  for (int i=0; i < decContainers.size(); i++) {
    Assert.assertEquals(i,r.getDecreasedContainers().get(i).getCapability().getVirtualCores());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.client.api.async.impl.TestAMRMClientAsync </h4><pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@SuppressWarnings("unchecked") @Test(timeout=10000) public void testAMRMClientAsync() throws Exception {
  Configuration conf=new Configuration();
  final AtomicBoolean heartbeatBlock=new AtomicBoolean(true);
  List<ContainerStatus> completed1=Arrays.asList(ContainerStatus.newInstance(newContainerId(0,0,0,0),ContainerState.COMPLETE,"",0));
  List<Container> allocated1=Arrays.asList(Container.newInstance(null,null,null,null,null,null));
  final AllocateResponse response1=createAllocateResponse(new ArrayList<ContainerStatus>(),allocated1,null);
  final AllocateResponse response2=createAllocateResponse(completed1,new ArrayList<Container>(),null);
  final AllocateResponse emptyResponse=createAllocateResponse(new ArrayList<ContainerStatus>(),new ArrayList<Container>(),null);
  TestCallbackHandler callbackHandler=new TestCallbackHandler();
  final AMRMClient<ContainerRequest> client=mock(AMRMClientImpl.class);
  final AtomicInteger secondHeartbeatSync=new AtomicInteger(0);
  when(client.allocate(anyFloat())).thenReturn(response1).thenAnswer(new Answer<AllocateResponse>(){
    @Override public AllocateResponse answer(    InvocationOnMock invocation) throws Throwable {
      secondHeartbeatSync.incrementAndGet();
      while (heartbeatBlock.get()) {
synchronized (heartbeatBlock) {
          heartbeatBlock.wait();
        }
      }
      secondHeartbeatSync.incrementAndGet();
      return response2;
    }
  }
).thenReturn(emptyResponse);
  when(client.registerApplicationMaster(anyString(),anyInt(),anyString())).thenReturn(null);
  when(client.getAvailableResources()).thenAnswer(new Answer<Resource>(){
    @Override public Resource answer(    InvocationOnMock invocation) throws Throwable {
synchronized (client) {
        Thread.sleep(10);
      }
      return null;
    }
  }
);
  AMRMClientAsync<ContainerRequest> asyncClient=AMRMClientAsync.createAMRMClientAsync(client,20,callbackHandler);
  asyncClient.init(conf);
  asyncClient.start();
  asyncClient.registerApplicationMaster("localhost",1234,null);
  while (secondHeartbeatSync.get() < 1) {
    Thread.sleep(10);
  }
  assert (secondHeartbeatSync.get() < 2);
  asyncClient.getAvailableResources();
  assert (secondHeartbeatSync.get() < 2);
synchronized (heartbeatBlock) {
    heartbeatBlock.set(false);
    heartbeatBlock.notifyAll();
  }
  Assert.assertEquals(null,callbackHandler.takeCompletedContainers());
  while (callbackHandler.takeAllocatedContainers() == null) {
    Assert.assertEquals(null,callbackHandler.takeCompletedContainers());
    Thread.sleep(10);
  }
  while (callbackHandler.takeCompletedContainers() == null) {
    Thread.sleep(10);
  }
  asyncClient.stop();
  Assert.assertEquals(null,callbackHandler.takeAllocatedContainers());
  Assert.assertEquals(null,callbackHandler.takeCompletedContainers());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.client.api.impl.TestAMRMClient </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAMRMClientMatchStorage() throws YarnException, IOException {
  AMRMClientImpl<ContainerRequest> amClient=null;
  try {
    amClient=(AMRMClientImpl<ContainerRequest>)AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    Priority priority1=Records.newRecord(Priority.class);
    priority1.setPriority(2);
    ContainerRequest storedContainer1=new ContainerRequest(capability,nodes,racks,priority);
    ContainerRequest storedContainer2=new ContainerRequest(capability,nodes,racks,priority);
    ContainerRequest storedContainer3=new ContainerRequest(capability,null,null,priority1);
    amClient.addContainerRequest(storedContainer1);
    amClient.addContainerRequest(storedContainer2);
    amClient.addContainerRequest(storedContainer3);
    int containersRequestedAny=amClient.remoteRequestsTable.get(priority).get(ResourceRequest.ANY).get(capability).remoteRequest.getNumContainers();
    assertEquals(2,containersRequestedAny);
    containersRequestedAny=amClient.remoteRequestsTable.get(priority1).get(ResourceRequest.ANY).get(capability).remoteRequest.getNumContainers();
    assertEquals(1,containersRequestedAny);
    List<? extends Collection<ContainerRequest>> matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority,ResourceRequest.ANY,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority1,rack,capability);
    assertTrue(matches.isEmpty());
    matches=amClient.getMatchingRequests(priority1,ResourceRequest.ANY,capability);
    verifyMatches(matches,1);
    amClient.removeContainerRequest(storedContainer3);
    matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,2);
    amClient.removeContainerRequest(storedContainer2);
    matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,1);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    verifyMatches(matches,1);
    ContainerRequest storedRequest=matches.get(0).iterator().next();
    assertEquals(storedContainer1,storedRequest);
    amClient.removeContainerRequest(storedContainer1);
    matches=amClient.getMatchingRequests(priority,ResourceRequest.ANY,capability);
    assertTrue(matches.isEmpty());
    matches=amClient.getMatchingRequests(priority1,ResourceRequest.ANY,capability);
    assertTrue(matches.isEmpty());
    assertTrue(amClient.remoteRequestsTable.isEmpty());
    amClient.addContainerRequest(storedContainer1);
    amClient.addContainerRequest(storedContainer3);
    int allocatedContainerCount=0;
    int iterationsLeft=3;
    while (allocatedContainerCount < 2 && iterationsLeft-- > 0) {
      Log.info(" == alloc " + allocatedContainerCount + " it left "+ iterationsLeft);
      AllocateResponse allocResponse=amClient.allocate(0.1f);
      assertEquals(0,amClient.ask.size());
      assertEquals(0,amClient.release.size());
      assertEquals(nodeCount,amClient.getClusterNodeCount());
      allocatedContainerCount+=allocResponse.getAllocatedContainers().size();
      for (      Container container : allocResponse.getAllocatedContainers()) {
        ContainerRequest expectedRequest=container.getPriority().equals(storedContainer1.getPriority()) ? storedContainer1 : storedContainer3;
        matches=amClient.getMatchingRequests(container.getPriority(),ResourceRequest.ANY,container.getResource());
        verifyMatches(matches,1);
        ContainerRequest matchedRequest=matches.get(0).iterator().next();
        assertEquals(matchedRequest,expectedRequest);
        amClient.removeContainerRequest(matchedRequest);
        amClient.releaseAssignedContainer(container.getId());
      }
      if (allocatedContainerCount < containersRequestedAny) {
        sleep(100);
      }
    }
    assertEquals(2,allocatedContainerCount);
    AllocateResponse allocResponse=amClient.allocate(0.1f);
    assertEquals(0,amClient.release.size());
    assertEquals(0,amClient.ask.size());
    assertEquals(0,allocResponse.getAllocatedContainers().size());
    assertTrue(amClient.remoteRequestsTable.isEmpty());
    amClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,null,null);
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.client.api.impl.TestYarnClient </h4><pre class="type-9 type-13 type-11 type-2 type-7 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testAMMRTokens() throws Exception {
  MiniYARNCluster cluster=new MiniYARNCluster("testMRAMTokens",1,1,1);
  YarnClient rmClient=null;
  try {
    cluster.init(new YarnConfiguration());
    cluster.start();
    final Configuration yarnConf=cluster.getConfig();
    rmClient=YarnClient.createYarnClient();
    rmClient.init(yarnConf);
    rmClient.start();
    ApplicationId appId=createApp(rmClient,false);
    waitTillAccepted(rmClient,appId);
    Assert.assertNull(rmClient.getAMRMToken(appId));
    appId=createApp(rmClient,true);
    waitTillAccepted(rmClient,appId);
    long start=System.currentTimeMillis();
    while (rmClient.getAMRMToken(appId) == null) {
      if (System.currentTimeMillis() - start > 20 * 1000) {
        Assert.fail("AMRM token is null");
      }
      Thread.sleep(100);
    }
    Assert.assertNotNull(rmClient.getAMRMToken(appId));
    UserGroupInformation other=UserGroupInformation.createUserForTesting("foo",new String[]{});
    appId=other.doAs(new PrivilegedExceptionAction<ApplicationId>(){
      @Override public ApplicationId run() throws Exception {
        YarnClient rmClient=YarnClient.createYarnClient();
        rmClient.init(yarnConf);
        rmClient.start();
        ApplicationId appId=createApp(rmClient,true);
        waitTillAccepted(rmClient,appId);
        long start=System.currentTimeMillis();
        while (rmClient.getAMRMToken(appId) == null) {
          if (System.currentTimeMillis() - start > 20 * 1000) {
            Assert.fail("AMRM token is null");
          }
          Thread.sleep(100);
        }
        Assert.assertNotNull(rmClient.getAMRMToken(appId));
        return appId;
      }
    }
);
    Assert.assertNull(rmClient.getAMRMToken(appId));
  }
  finally {
    if (rmClient != null) {
      rmClient.stop();
    }
    cluster.stop();
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("deprecation") @Test(timeout=30000) public void testSubmitApplication(){
  Configuration conf=new Configuration();
  conf.setLong(YarnConfiguration.YARN_CLIENT_APP_SUBMISSION_POLL_INTERVAL_MS,100);
  final YarnClient client=new MockYarnClient();
  client.init(conf);
  client.start();
  YarnApplicationState[] exitStates=new YarnApplicationState[]{YarnApplicationState.SUBMITTED,YarnApplicationState.ACCEPTED,YarnApplicationState.RUNNING,YarnApplicationState.FINISHED,YarnApplicationState.FAILED,YarnApplicationState.KILLED};
  ApplicationSubmissionContext contextWithoutApplicationId=mock(ApplicationSubmissionContext.class);
  try {
    client.submitApplication(contextWithoutApplicationId);
    Assert.fail("Should throw the ApplicationIdNotProvidedException");
  }
 catch (  YarnException e) {
    Assert.assertTrue(e instanceof ApplicationIdNotProvidedException);
    Assert.assertTrue(e.getMessage().contains("ApplicationId is not provided in ApplicationSubmissionContext"));
  }
catch (  IOException e) {
    Assert.fail("IOException is not expected.");
  }
  for (int i=0; i < exitStates.length; ++i) {
    ApplicationSubmissionContext context=mock(ApplicationSubmissionContext.class);
    ApplicationId applicationId=ApplicationId.newInstance(System.currentTimeMillis(),i);
    when(context.getApplicationId()).thenReturn(applicationId);
    ((MockYarnClient)client).setYarnApplicationState(exitStates[i]);
    try {
      client.submitApplication(context);
    }
 catch (    YarnException e) {
      Assert.fail("Exception is not expected.");
    }
catch (    IOException e) {
      Assert.fail("Exception is not expected.");
    }
    verify(((MockYarnClient)client).mockReport,times(4 * i + 4)).getYarnApplicationState();
  }
  client.stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.TestMemoryApplicationHistoryStore </h4><pre class="type-9 type-13 type-2 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadWriteApplicationAttemptHistory() throws Exception {
  ApplicationId appId=ApplicationId.newInstance(0,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  try {
    writeApplicationAttemptFinishData(appAttemptId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is stored before the start information"));
  }
  int numAppAttempts=5;
  writeApplicationStartData(appId);
  for (int i=1; i <= numAppAttempts; ++i) {
    appAttemptId=ApplicationAttemptId.newInstance(appId,i);
    writeApplicationAttemptStartData(appAttemptId);
    writeApplicationAttemptFinishData(appAttemptId);
  }
  Assert.assertEquals(numAppAttempts,store.getApplicationAttempts(appId).size());
  for (int i=1; i <= numAppAttempts; ++i) {
    appAttemptId=ApplicationAttemptId.newInstance(appId,i);
    ApplicationAttemptHistoryData data=store.getApplicationAttempt(appAttemptId);
    Assert.assertNotNull(data);
    Assert.assertEquals(appAttemptId.toString(),data.getHost());
    Assert.assertEquals(appAttemptId.toString(),data.getDiagnosticsInfo());
  }
  writeApplicationFinishData(appId);
  appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  try {
    writeApplicationAttemptStartData(appAttemptId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
  try {
    writeApplicationAttemptFinishData(appAttemptId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-2 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadWriteApplicationHistory() throws Exception {
  ApplicationId appId=ApplicationId.newInstance(0,1);
  try {
    writeApplicationFinishData(appId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is stored before the start information"));
  }
  int numApps=5;
  for (int i=1; i <= numApps; ++i) {
    appId=ApplicationId.newInstance(0,i);
    writeApplicationStartData(appId);
    writeApplicationFinishData(appId);
  }
  Assert.assertEquals(numApps,store.getAllApplications().size());
  for (int i=1; i <= numApps; ++i) {
    appId=ApplicationId.newInstance(0,i);
    ApplicationHistoryData data=store.getApplication(appId);
    Assert.assertNotNull(data);
    Assert.assertEquals(appId.toString(),data.getApplicationName());
    Assert.assertEquals(appId.toString(),data.getDiagnosticsInfo());
  }
  appId=ApplicationId.newInstance(0,1);
  try {
    writeApplicationStartData(appId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
  try {
    writeApplicationFinishData(appId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-2 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadWriteContainerHistory() throws Exception {
  ApplicationId appId=ApplicationId.newInstance(0,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  ContainerId containerId=ContainerId.newInstance(appAttemptId,1);
  try {
    writeContainerFinishData(containerId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is stored before the start information"));
  }
  writeApplicationAttemptStartData(appAttemptId);
  int numContainers=5;
  for (int i=1; i <= numContainers; ++i) {
    containerId=ContainerId.newInstance(appAttemptId,i);
    writeContainerStartData(containerId);
    writeContainerFinishData(containerId);
  }
  Assert.assertEquals(numContainers,store.getContainers(appAttemptId).size());
  for (int i=1; i <= numContainers; ++i) {
    containerId=ContainerId.newInstance(appAttemptId,i);
    ContainerHistoryData data=store.getContainer(containerId);
    Assert.assertNotNull(data);
    Assert.assertEquals(Priority.newInstance(containerId.getId()),data.getPriority());
    Assert.assertEquals(containerId.toString(),data.getDiagnosticsInfo());
  }
  ContainerHistoryData masterContainer=store.getAMContainer(appAttemptId);
  Assert.assertNotNull(masterContainer);
  Assert.assertEquals(ContainerId.newInstance(appAttemptId,1),masterContainer.getContainerId());
  writeApplicationAttemptFinishData(appAttemptId);
  containerId=ContainerId.newInstance(appAttemptId,1);
  try {
    writeContainerStartData(containerId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
  try {
    writeContainerFinishData(containerId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.nodemanager.TestNodeStatusUpdater </h4><pre class="type-13 type-11 type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNMRegistration() throws InterruptedException {
  nm=new NodeManager(){
    @Override protected NodeStatusUpdater createNodeStatusUpdater(    Context context,    Dispatcher dispatcher,    NodeHealthCheckerService healthChecker){
      return new MyNodeStatusUpdater(context,dispatcher,healthChecker,metrics);
    }
  }
;
  YarnConfiguration conf=createNMConfig();
  nm.init(conf);
  Object[] services=nm.getServices().toArray();
  Object lastService=services[services.length - 1];
  Assert.assertTrue("last service is NOT the node status updater",lastService instanceof NodeStatusUpdater);
  new Thread(){
    public void run(){
      try {
        nm.start();
      }
 catch (      Throwable e) {
        TestNodeStatusUpdater.this.nmStartError=e;
        throw new YarnRuntimeException(e);
      }
    }
  }
.start();
  System.out.println(" ----- thread already started.." + nm.getServiceState());
  int waitCount=0;
  while (nm.getServiceState() == STATE.INITED && waitCount++ != 50) {
    LOG.info("Waiting for NM to start..");
    if (nmStartError != null) {
      LOG.error("Error during startup. ",nmStartError);
      Assert.fail(nmStartError.getCause().getMessage());
    }
    Thread.sleep(2000);
  }
  if (nm.getServiceState() != STATE.STARTED) {
    Assert.fail("NodeManager failed to start");
  }
  waitCount=0;
  while (heartBeatID <= 3 && waitCount++ != 200) {
    Thread.sleep(1000);
  }
  Assert.assertFalse(heartBeatID <= 3);
  Assert.assertEquals("Number of registered NMs is wrong!!",1,this.registeredNodes.size());
  nm.stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.TestLocalCacheDirectoryManager </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=1000) public void testDirectoryStateChangeFromFullToNonFull(){
  YarnConfiguration conf=new YarnConfiguration();
  conf.set(YarnConfiguration.NM_LOCAL_CACHE_MAX_FILES_PER_DIRECTORY,"40");
  LocalCacheDirectoryManager dir=new LocalCacheDirectoryManager(conf);
  String rootPath="";
  String firstSubDir="0";
  for (int i=0; i < 4; i++) {
    Assert.assertEquals(rootPath,dir.getRelativePathForLocalization());
  }
  dir.decrementFileCountForPath(rootPath);
  dir.decrementFileCountForPath(rootPath);
  Assert.assertEquals(rootPath,dir.getRelativePathForLocalization());
  Assert.assertEquals(rootPath,dir.getRelativePathForLocalization());
  Assert.assertEquals(firstSubDir,dir.getRelativePathForLocalization());
}

</code></pre>

<br>
<pre class="type-9 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDirectoryConversion(){
  for (int i=0; i < 10000; ++i) {
    String path=Directory.getRelativePath(i);
    Assert.assertEquals("Incorrect conversion for " + i,i,Directory.getDirectoryNumber(path));
  }
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testHierarchicalSubDirectoryCreation(){
  YarnConfiguration conf=new YarnConfiguration();
  conf.set(YarnConfiguration.NM_LOCAL_CACHE_MAX_FILES_PER_DIRECTORY,"37");
  LocalCacheDirectoryManager hDir=new LocalCacheDirectoryManager(conf);
  Assert.assertTrue(hDir.getRelativePathForLocalization().isEmpty());
  for (int i=1; i <= 37 * 36 * 36; i++) {
    StringBuffer sb=new StringBuffer();
    String num=Integer.toString(i - 1,36);
    if (num.length() == 1) {
      sb.append(num.charAt(0));
    }
 else {
      sb.append(Integer.toString(Integer.parseInt(num.substring(0,1),36) - 1,36));
    }
    for (int j=1; j < num.length(); j++) {
      sb.append(Path.SEPARATOR).append(num.charAt(j));
    }
    Assert.assertEquals(sb.toString(),hDir.getRelativePathForLocalization());
  }
  String testPath1="4";
  String testPath2="2";
  hDir.decrementFileCountForPath(testPath1);
  hDir.decrementFileCountForPath(testPath2);
  Assert.assertEquals(testPath1,hDir.getRelativePathForLocalization());
  Assert.assertEquals(testPath2,hDir.getRelativePathForLocalization());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.TestLocalResourcesTrackerImpl </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-19 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=100000) @SuppressWarnings("unchecked") public void testHierarchicalLocalCacheDirectories(){
  String user="testuser";
  DrainDispatcher dispatcher=null;
  try {
    Configuration conf=new Configuration();
    conf.set(YarnConfiguration.NM_LOCAL_CACHE_MAX_FILES_PER_DIRECTORY,"37");
    dispatcher=createDispatcher(conf);
    EventHandler<LocalizerEvent> localizerEventHandler=mock(EventHandler.class);
    EventHandler<LocalizerEvent> containerEventHandler=mock(EventHandler.class);
    dispatcher.register(LocalizerEventType.class,localizerEventHandler);
    dispatcher.register(ContainerEventType.class,containerEventHandler);
    DeletionService mockDelService=mock(DeletionService.class);
    ConcurrentMap<LocalResourceRequest,LocalizedResource> localrsrc=new ConcurrentHashMap<LocalResourceRequest,LocalizedResource>();
    LocalResourcesTracker tracker=new LocalResourcesTrackerImpl(user,null,dispatcher,localrsrc,true,conf,new NMNullStateStoreService());
    Path localDir=new Path("/tmp");
    ContainerId cId1=BuilderUtils.newContainerId(1,1,1,1);
    LocalResourceRequest lr1=createLocalResourceRequest(user,1,1,LocalResourceVisibility.PUBLIC);
    LocalizerContext lc1=new LocalizerContext(user,cId1,null);
    ResourceEvent reqEvent1=new ResourceRequestEvent(lr1,LocalResourceVisibility.PUBLIC,lc1);
    tracker.handle(reqEvent1);
    Path hierarchicalPath1=tracker.getPathForLocalization(lr1,localDir).getParent();
    ResourceLocalizedEvent rle1=new ResourceLocalizedEvent(lr1,new Path(hierarchicalPath1.toUri().toString() + Path.SEPARATOR + "file1"),120);
    tracker.handle(rle1);
    LocalResourceRequest lr2=createLocalResourceRequest(user,3,3,LocalResourceVisibility.PUBLIC);
    ResourceEvent reqEvent2=new ResourceRequestEvent(lr2,LocalResourceVisibility.PUBLIC,lc1);
    tracker.handle(reqEvent2);
    Path hierarchicalPath2=tracker.getPathForLocalization(lr2,localDir).getParent();
    ResourceFailedLocalizationEvent rfe2=new ResourceFailedLocalizationEvent(lr2,new Exception("Test").toString());
    tracker.handle(rfe2);
    Assert.assertNotSame(hierarchicalPath1,hierarchicalPath2);
    LocalResourceRequest lr3=createLocalResourceRequest(user,2,2,LocalResourceVisibility.PUBLIC);
    ResourceEvent reqEvent3=new ResourceRequestEvent(lr3,LocalResourceVisibility.PUBLIC,lc1);
    tracker.handle(reqEvent3);
    Path hierarchicalPath3=tracker.getPathForLocalization(lr3,localDir).getParent();
    ResourceLocalizedEvent rle3=new ResourceLocalizedEvent(lr3,new Path(hierarchicalPath3.toUri().toString() + Path.SEPARATOR + "file3"),120);
    tracker.handle(rle3);
    Assert.assertEquals(hierarchicalPath3.toUri().toString(),hierarchicalPath1.toUri().toString() + Path.SEPARATOR + "0");
    ResourceEvent relEvent1=new ResourceReleaseEvent(lr1,cId1);
    tracker.handle(relEvent1);
    int resources=0;
    Iterator<LocalizedResource> iter=tracker.iterator();
    while (iter.hasNext()) {
      iter.next();
      resources++;
    }
    Assert.assertEquals(2,resources);
    iter=tracker.iterator();
    while (iter.hasNext()) {
      LocalizedResource rsrc=iter.next();
      if (rsrc.getRefCount() == 0) {
        Assert.assertTrue(tracker.remove(rsrc,mockDelService));
        resources--;
      }
    }
    Assert.assertEquals(1,resources);
  }
  finally {
    if (dispatcher != null) {
      dispatcher.stop();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.TestResourceLocalizationService </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) @SuppressWarnings("unchecked") public void testLocalResourcePath() throws Exception {
  DrainDispatcher dispatcher1=null;
  try {
    dispatcher1=new DrainDispatcher();
    String user="testuser";
    ApplicationId appId=BuilderUtils.newApplicationId(1,1);
    List<Path> localDirs=new ArrayList<Path>();
    String[] sDirs=new String[1];
    for (int i=0; i < 1; ++i) {
      localDirs.add(lfs.makeQualified(new Path(basedir,i + "")));
      sDirs[i]=localDirs.get(i).toString();
    }
    conf.setStrings(YarnConfiguration.NM_LOCAL_DIRS,sDirs);
    LocalDirsHandlerService localDirHandler=new LocalDirsHandlerService();
    localDirHandler.init(conf);
    EventHandler<ApplicationEvent> applicationBus=mock(EventHandler.class);
    dispatcher1.register(ApplicationEventType.class,applicationBus);
    EventHandler<ContainerEvent> containerBus=mock(EventHandler.class);
    dispatcher1.register(ContainerEventType.class,containerBus);
    ContainerExecutor exec=mock(ContainerExecutor.class);
    DeletionService delService=mock(DeletionService.class);
    LocalDirsHandlerService dirsHandler=new LocalDirsHandlerService();
    dirsHandler.init(conf);
    dispatcher1.init(conf);
    dispatcher1.start();
    ResourceLocalizationService rls=new ResourceLocalizationService(dispatcher1,exec,delService,localDirHandler,new NMNullStateStoreService());
    dispatcher1.register(LocalizationEventType.class,rls);
    rls.init(conf);
    rls.handle(createApplicationLocalizationEvent(user,appId));
    Container container1=createMockContainer(user,1);
    String localizerId1=container1.getContainerId().toString();
    rls.getPrivateLocalizers().put(localizerId1,rls.new LocalizerRunner(new LocalizerContext(user,container1.getContainerId(),null),localizerId1));
    LocalResourceRequest reqPriv=new LocalResourceRequest(new Path("file:///tmp1"),123L,LocalResourceType.FILE,LocalResourceVisibility.PRIVATE,"");
    List<LocalResourceRequest> privList=new ArrayList<LocalResourceRequest>();
    privList.add(reqPriv);
    LocalResourceRequest reqApp=new LocalResourceRequest(new Path("file:///tmp2"),123L,LocalResourceType.FILE,LocalResourceVisibility.APPLICATION,"");
    List<LocalResourceRequest> appList=new ArrayList<LocalResourceRequest>();
    appList.add(reqApp);
    Map<LocalResourceVisibility,Collection<LocalResourceRequest>> rsrcs=new HashMap<LocalResourceVisibility,Collection<LocalResourceRequest>>();
    rsrcs.put(LocalResourceVisibility.APPLICATION,appList);
    rsrcs.put(LocalResourceVisibility.PRIVATE,privList);
    dispatcher1.getEventHandler().handle(new ContainerLocalizationRequestEvent(container1,rsrcs));
    Assert.assertTrue(waitForPrivateDownloadToStart(rls,localizerId1,2,500));
    String userCachePath=StringUtils.join(Path.SEPARATOR,Arrays.asList(localDirs.get(0).toUri().getRawPath(),ContainerLocalizer.USERCACHE,user,ContainerLocalizer.FILECACHE));
    String userAppCachePath=StringUtils.join(Path.SEPARATOR,Arrays.asList(localDirs.get(0).toUri().getRawPath(),ContainerLocalizer.USERCACHE,user,ContainerLocalizer.APPCACHE,appId.toString(),ContainerLocalizer.FILECACHE));
    int returnedResources=0;
    boolean appRsrc=false, privRsrc=false;
    while (returnedResources < 2) {
      LocalizerHeartbeatResponse response=rls.heartbeat(createLocalizerStatus(localizerId1));
      for (      ResourceLocalizationSpec resourceSpec : response.getResourceSpecs()) {
        returnedResources++;
        Path destinationDirectory=new Path(resourceSpec.getDestinationDirectory().getFile());
        if (resourceSpec.getResource().getVisibility() == LocalResourceVisibility.APPLICATION) {
          appRsrc=true;
          Assert.assertEquals(userAppCachePath,destinationDirectory.getParent().toUri().toString());
        }
 else         if (resourceSpec.getResource().getVisibility() == LocalResourceVisibility.PRIVATE) {
          privRsrc=true;
          Assert.assertEquals(userCachePath,destinationDirectory.getParent().toUri().toString());
        }
 else {
          throw new Exception("Unexpected resource recevied.");
        }
      }
    }
    Assert.assertTrue(appRsrc && privRsrc);
  }
  finally {
    if (dispatcher1 != null) {
      dispatcher1.stop();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.TestAppManager </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testRMAppSubmitMaxAppAttempts() throws Exception {
  int[] globalMaxAppAttempts=new int[]{10,1};
  int[][] individualMaxAppAttempts=new int[][]{new int[]{9,10,11,0},new int[]{1,10,0,-1}};
  int[][] expectedNums=new int[][]{new int[]{9,10,10,10},new int[]{1,1,1,1}};
  for (int i=0; i < globalMaxAppAttempts.length; ++i) {
    for (int j=0; j < individualMaxAppAttempts.length; ++j) {
      ResourceScheduler scheduler=mockResourceScheduler();
      Configuration conf=new Configuration();
      conf.setInt(YarnConfiguration.RM_AM_MAX_ATTEMPTS,globalMaxAppAttempts[i]);
      ApplicationMasterService masterService=new ApplicationMasterService(rmContext,scheduler);
      TestRMAppManager appMonitor=new TestRMAppManager(rmContext,new ClientToAMTokenSecretManagerInRM(),scheduler,masterService,new ApplicationACLsManager(conf),conf);
      ApplicationId appID=MockApps.newAppID(i * 4 + j + 1);
      asContext.setApplicationId(appID);
      if (individualMaxAppAttempts[i][j] != 0) {
        asContext.setMaxAppAttempts(individualMaxAppAttempts[i][j]);
      }
      appMonitor.submitApplication(asContext,"test");
      RMApp app=rmContext.getRMApps().get(appID);
      Assert.assertEquals("max application attempts doesn't match",expectedNums[i][j],app.getMaxAppAttempts());
      int timeoutSecs=0;
      while ((getAppEventType() == RMAppEventType.KILL) && timeoutSecs++ < 20) {
        Thread.sleep(1000);
      }
      setAppEventType(RMAppEventType.KILL);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.rmapp.TestRMAppTransitions </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAppRunningFailed() throws IOException {
  LOG.info("--- START: testAppRunningFailed ---");
  RMApp application=testCreateAppRunning(null);
  RMAppAttempt appAttempt=application.getCurrentAppAttempt();
  int expectedAttemptId=1;
  Assert.assertEquals(expectedAttemptId,appAttempt.getAppAttemptId().getAttemptId());
  Assert.assertTrue(maxAppAttempts > 1);
  for (int i=1; i < maxAppAttempts; i++) {
    RMAppEvent event=new RMAppFailedAttemptEvent(application.getApplicationId(),RMAppEventType.ATTEMPT_FAILED,"",false);
    application.handle(event);
    rmDispatcher.await();
    assertAppState(RMAppState.ACCEPTED,application);
    appAttempt=application.getCurrentAppAttempt();
    Assert.assertEquals(++expectedAttemptId,appAttempt.getAppAttemptId().getAttemptId());
    event=new RMAppEvent(application.getApplicationId(),RMAppEventType.APP_ACCEPTED);
    application.handle(event);
    rmDispatcher.await();
    assertAppState(RMAppState.ACCEPTED,application);
    event=new RMAppEvent(application.getApplicationId(),RMAppEventType.ATTEMPT_REGISTERED);
    application.handle(event);
    rmDispatcher.await();
    assertAppState(RMAppState.RUNNING,application);
  }
  RMAppEvent event=new RMAppFailedAttemptEvent(application.getApplicationId(),RMAppEventType.ATTEMPT_FAILED,"",false);
  application.handle(event);
  rmDispatcher.await();
  sendAppUpdateSavedEvent(application);
  assertFailed(application,".*Failing the application.*");
  assertAppFinalStateSaved(application);
  event=new RMAppEvent(application.getApplicationId(),RMAppEventType.KILL);
  application.handle(event);
  rmDispatcher.await();
  assertFailed(application,".*Failing the application.*");
  assertAppFinalStateSaved(application);
  verifyApplicationFinished(RMAppState.FAILED);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.TestContainerAllocation </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=20000) public void testAMContainerAllocationWhenDNSUnavailable() throws Exception {
  MockRM rm1=new MockRM(conf){
    @Override protected RMSecretManagerService createRMSecretManagerService(){
      return new TestRMSecretManagerService(conf,rmContext);
    }
  }
;
  rm1.start();
  MockNM nm1=rm1.registerNode("unknownhost:1234",8000);
  SecurityUtilTestHelper.setTokenServiceUseIp(true);
  RMApp app1=rm1.submitApp(200);
  RMAppAttempt attempt=app1.getCurrentAppAttempt();
  nm1.nodeHeartbeat(true);
  while (numRetries <= 5) {
    nm1.nodeHeartbeat(true);
    Thread.sleep(1000);
    Assert.assertEquals(RMAppAttemptState.SCHEDULED,attempt.getAppAttemptState());
    System.out.println("Waiting for am container to be allocated.");
  }
  SecurityUtilTestHelper.setTokenServiceUseIp(false);
  rm1.waitForState(attempt.getAppAttemptId(),RMAppAttemptState.ALLOCATED);
  MockRM.launchAndRegisterAM(app1,rm1,nm1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestFSAppAttempt </h4><pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDelayScheduling(){
  FSLeafQueue queue=Mockito.mock(FSLeafQueue.class);
  Priority prio=Mockito.mock(Priority.class);
  Mockito.when(prio.getPriority()).thenReturn(1);
  double nodeLocalityThreshold=.5;
  double rackLocalityThreshold=.6;
  ApplicationAttemptId applicationAttemptId=createAppAttemptId(1,1);
  RMContext rmContext=resourceManager.getRMContext();
  FSAppAttempt schedulerApp=new FSAppAttempt(scheduler,applicationAttemptId,"user1",queue,null,rmContext);
  assertEquals(NodeType.NODE_LOCAL,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
  for (int i=0; i < 5; i++) {
    schedulerApp.addSchedulingOpportunity(prio);
    assertEquals(NodeType.NODE_LOCAL,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
  }
  schedulerApp.addSchedulingOpportunity(prio);
  assertEquals(NodeType.RACK_LOCAL,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
  schedulerApp.resetAllowedLocalityLevel(prio,NodeType.NODE_LOCAL);
  schedulerApp.resetSchedulingOpportunities(prio);
  assertEquals(NodeType.NODE_LOCAL,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
  for (int i=0; i < 5; i++) {
    schedulerApp.addSchedulingOpportunity(prio);
    assertEquals(NodeType.NODE_LOCAL,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
  }
  schedulerApp.addSchedulingOpportunity(prio);
  assertEquals(NodeType.RACK_LOCAL,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
  for (int i=0; i < 6; i++) {
    schedulerApp.addSchedulingOpportunity(prio);
    assertEquals(NodeType.RACK_LOCAL,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
  }
  schedulerApp.addSchedulingOpportunity(prio);
  assertEquals(NodeType.OFF_SWITCH,schedulerApp.getAllowedLocalityLevel(prio,10,nodeLocalityThreshold,rackLocalityThreshold));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestFairScheduler </h4><pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCancelStrictLocality() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",0);
  ResourceRequest nodeRequest=createResourceRequest(1024,node1.getHostName(),1,1,true);
  ResourceRequest rackRequest=createResourceRequest(1024,"rack1",1,1,false);
  ResourceRequest anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,1,false);
  createSchedulingRequestExistingApplication(nodeRequest,attId1);
  createSchedulingRequestExistingApplication(rackRequest,attId1);
  createSchedulingRequestExistingApplication(anyRequest,attId1);
  scheduler.update();
  NodeUpdateSchedulerEvent node2UpdateEvent=new NodeUpdateSchedulerEvent(node2);
  FSAppAttempt app=scheduler.getSchedulerApp(attId1);
  for (int i=0; i < 10; i++) {
    scheduler.handle(node2UpdateEvent);
    assertEquals(0,app.getLiveContainers().size());
  }
  List<ResourceRequest> update=Arrays.asList(createResourceRequest(1024,node1.getHostName(),1,0,true),createResourceRequest(1024,"rack1",1,0,true),createResourceRequest(1024,ResourceRequest.ANY,1,1,true));
  scheduler.allocate(attId1,update,new ArrayList<ContainerId>(),null,null);
  scheduler.handle(node2UpdateEvent);
  assertEquals(1,app.getLiveContainers().size());
}

</code></pre>

<br>
<pre class="type-9 type-13 type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test to verify the behavior of{@link FSQueue#assignContainer(FSSchedulerNode)})
 * Create two queues under root (fifoQueue and fairParent), and two queues
 * under fairParent (fairChild1 and fairChild2). Submit two apps to the
 * fifoQueue and one each to the fairChild* queues, all apps requiring 4
 * containers each of the total 16 container capacity
 * Assert the number of containers for each app after 4, 8, 12 and 16 updates.
 * @throws Exception
 */
@Test(timeout=5000) public void testAssignContainer() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  final String user="user1";
  final String fifoQueue="fifo";
  final String fairParent="fairParent";
  final String fairChild1=fairParent + ".fairChild1";
  final String fairChild2=fairParent + ".fairChild2";
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8192,8),1,"127.0.0.1");
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(8192,8),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent1);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,fifoQueue,user,4);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,fairChild1,user,4);
  ApplicationAttemptId attId3=createSchedulingRequest(1024,fairChild2,user,4);
  ApplicationAttemptId attId4=createSchedulingRequest(1024,fifoQueue,user,4);
  FSAppAttempt app1=scheduler.getSchedulerApp(attId1);
  FSAppAttempt app2=scheduler.getSchedulerApp(attId2);
  FSAppAttempt app3=scheduler.getSchedulerApp(attId3);
  FSAppAttempt app4=scheduler.getSchedulerApp(attId4);
  scheduler.getQueueManager().getLeafQueue(fifoQueue,true).setPolicy(SchedulingPolicy.parse("fifo"));
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent1=new NodeUpdateSchedulerEvent(node1);
  NodeUpdateSchedulerEvent updateEvent2=new NodeUpdateSchedulerEvent(node2);
  for (int i=0; i < 8; i++) {
    scheduler.handle(updateEvent1);
    scheduler.handle(updateEvent2);
    if ((i + 1) % 2 == 0) {
      String ERR="Wrong number of assigned containers after " + (i + 1) + " updates";
      if (i < 4) {
        assertEquals(ERR,(i + 1),app1.getLiveContainers().size());
        assertEquals(ERR,0,app4.getLiveContainers().size());
      }
 else {
        assertEquals(ERR,4,app1.getLiveContainers().size());
        assertEquals(ERR,(i - 3),app4.getLiveContainers().size());
      }
      assertEquals(ERR,(i + 1) / 2,app2.getLiveContainers().size());
      assertEquals(ERR,(i + 1) / 2,app3.getLiveContainers().size());
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStrictLocality() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",0);
  ResourceRequest nodeRequest=createResourceRequest(1024,node1.getHostName(),1,1,true);
  ResourceRequest rackRequest=createResourceRequest(1024,node1.getRackName(),1,1,false);
  ResourceRequest anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,1,false);
  createSchedulingRequestExistingApplication(nodeRequest,attId1);
  createSchedulingRequestExistingApplication(rackRequest,attId1);
  createSchedulingRequestExistingApplication(anyRequest,attId1);
  scheduler.update();
  NodeUpdateSchedulerEvent node1UpdateEvent=new NodeUpdateSchedulerEvent(node1);
  NodeUpdateSchedulerEvent node2UpdateEvent=new NodeUpdateSchedulerEvent(node2);
  FSAppAttempt app=scheduler.getSchedulerApp(attId1);
  for (int i=0; i < 10; i++) {
    scheduler.handle(node2UpdateEvent);
    assertEquals(0,app.getLiveContainers().size());
    assertEquals(0,app.getReservedContainers().size());
  }
  scheduler.handle(node1UpdateEvent);
  assertEquals(1,app.getLiveContainers().size());
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testHostPortNodeName() throws Exception {
  conf.setBoolean(YarnConfiguration.RM_SCHEDULER_INCLUDE_PORT_IN_NODE_NAME,true);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1",1);
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.1",2);
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",0);
  ResourceRequest nodeRequest=createResourceRequest(1024,node1.getNodeID().getHost() + ":" + node1.getNodeID().getPort(),1,1,true);
  ResourceRequest rackRequest=createResourceRequest(1024,node1.getRackName(),1,1,false);
  ResourceRequest anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,1,false);
  createSchedulingRequestExistingApplication(nodeRequest,attId1);
  createSchedulingRequestExistingApplication(rackRequest,attId1);
  createSchedulingRequestExistingApplication(anyRequest,attId1);
  scheduler.update();
  NodeUpdateSchedulerEvent node1UpdateEvent=new NodeUpdateSchedulerEvent(node1);
  NodeUpdateSchedulerEvent node2UpdateEvent=new NodeUpdateSchedulerEvent(node2);
  FSAppAttempt app=scheduler.getSchedulerApp(attId1);
  for (int i=0; i < 10; i++) {
    scheduler.handle(node2UpdateEvent);
    assertEquals(0,app.getLiveContainers().size());
    assertEquals(0,app.getReservedContainers().size());
  }
  scheduler.handle(node1UpdateEvent);
  assertEquals(1,app.getLiveContainers().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestFairSchedulerFairShare </h4><pre class="type-13 type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFairShareWithDRFMultipleActiveQueuesUnderDifferentParent() throws IOException {
  int nodeMem=16 * 1024;
  int nodeVCores=10;
  createClusterWithQueuesAndOneNode(nodeMem,nodeVCores,"drf");
  createSchedulingRequest(2 * 1024,"root.parentA.childA1","user1");
  createSchedulingRequest(3 * 1024,"root.parentA.childA2","user2");
  createSchedulingRequest(1 * 1024,"root.parentB.childB1","user3");
  createSchedulingRequest(1 * 1024,"root.default","user4");
  scheduler.update();
  for (int i=1; i <= 2; i++) {
    assertEquals(40,(double)scheduler.getQueueManager().getLeafQueue("root.parentA.childA" + i,false).getFairShare().getMemory() / nodeMem * 100,.9);
    assertEquals(40,(double)scheduler.getQueueManager().getLeafQueue("root.parentA.childA" + i,false).getFairShare().getVirtualCores() / nodeVCores * 100,.9);
  }
  assertEquals(10,(double)scheduler.getQueueManager().getLeafQueue("root.parentB.childB1",false).getFairShare().getMemory() / nodeMem * 100,.9);
  assertEquals(10,(double)scheduler.getQueueManager().getLeafQueue("root.parentB.childB1",false).getFairShare().getVirtualCores() / nodeVCores * 100,.9);
  Collection<FSLeafQueue> leafQueues=scheduler.getQueueManager().getLeafQueues();
  for (  FSLeafQueue leaf : leafQueues) {
    if (leaf.getName().startsWith("root.parentA")) {
      assertEquals(0.2,(double)leaf.getSteadyFairShare().getMemory() / nodeMem,0.001);
      assertEquals(0.2,(double)leaf.getSteadyFairShare().getVirtualCores() / nodeVCores,0.001);
    }
 else     if (leaf.getName().startsWith("root.parentB")) {
      assertEquals(0.05,(double)leaf.getSteadyFairShare().getMemory() / nodeMem,0.001);
      assertEquals(0.1,(double)leaf.getSteadyFairShare().getVirtualCores() / nodeVCores,0.001);
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFairShareMultipleActiveQueuesUnderSameParent() throws IOException {
  int nodeCapacity=16 * 1024;
  createClusterWithQueuesAndOneNode(nodeCapacity,"fair");
  createSchedulingRequest(2 * 1024,"root.parentA.childA1","user1");
  createSchedulingRequest(2 * 1024,"root.parentA.childA2","user2");
  createSchedulingRequest(2 * 1024,"root.parentA.childA3","user3");
  scheduler.update();
  for (int i=1; i <= 3; i++) {
    assertEquals(33,(double)scheduler.getQueueManager().getLeafQueue("root.parentA.childA" + i,false).getFairShare().getMemory() / nodeCapacity * 100,.9);
  }
  verifySteadyFairShareMemory(scheduler.getQueueManager().getLeafQueues(),nodeCapacity);
}

</code></pre>

<br>
<pre class="type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFairShareMultipleActiveQueuesUnderDifferentParent() throws IOException {
  int nodeCapacity=16 * 1024;
  createClusterWithQueuesAndOneNode(nodeCapacity,"fair");
  createSchedulingRequest(2 * 1024,"root.parentA.childA1","user1");
  createSchedulingRequest(3 * 1024,"root.parentA.childA2","user2");
  createSchedulingRequest(1 * 1024,"root.parentB.childB1","user3");
  createSchedulingRequest(1 * 1024,"root.default","user4");
  scheduler.update();
  for (int i=1; i <= 2; i++) {
    assertEquals(40,(double)scheduler.getQueueManager().getLeafQueue("root.parentA.childA" + i,false).getFairShare().getMemory() / nodeCapacity * 100,.9);
  }
  assertEquals(10,(double)scheduler.getQueueManager().getLeafQueue("root.parentB.childB1",false).getFairShare().getMemory() / nodeCapacity * 100,.9);
  verifySteadyFairShareMemory(scheduler.getQueueManager().getLeafQueues(),nodeCapacity);
}

</code></pre>

<br>
<pre class="type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFairShareResetsToZeroWhenAppsComplete() throws IOException {
  int nodeCapacity=16 * 1024;
  createClusterWithQueuesAndOneNode(nodeCapacity,"fair");
  ApplicationAttemptId app1=createSchedulingRequest(2 * 1024,"root.parentA.childA1","user1");
  ApplicationAttemptId app2=createSchedulingRequest(3 * 1024,"root.parentA.childA2","user2");
  scheduler.update();
  for (int i=1; i <= 2; i++) {
    assertEquals(50,(double)scheduler.getQueueManager().getLeafQueue("root.parentA.childA" + i,false).getFairShare().getMemory() / nodeCapacity * 100,.9);
  }
  AppAttemptRemovedSchedulerEvent appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(app1,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent1);
  scheduler.update();
  assertEquals(0,(double)scheduler.getQueueManager().getLeafQueue("root.parentA.childA1",false).getFairShare().getMemory() / nodeCapacity * 100,0);
  assertEquals(100,(double)scheduler.getQueueManager().getLeafQueue("root.parentA.childA2",false).getFairShare().getMemory() / nodeCapacity * 100,0.1);
  verifySteadyFairShareMemory(scheduler.getQueueManager().getLeafQueues(),nodeCapacity);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.security.TestDelegationTokenRenewer </h4><pre class="type-9 type-13 type-11 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAppRejectionWithCancelledDelegationToken() throws Exception {
  MyFS dfs=(MyFS)FileSystem.get(conf);
  LOG.info("dfs=" + (Object)dfs.hashCode() + ";conf="+ conf.hashCode());
  MyToken token=dfs.getDelegationToken("user1");
  token.cancelToken();
  Credentials ts=new Credentials();
  ts.addToken(token.getKind(),token);
  ApplicationId appId=BuilderUtils.newApplicationId(0,0);
  delegationTokenRenewer.addApplicationAsync(appId,ts,true);
  int waitCnt=20;
  while (waitCnt-- > 0) {
    if (!eventQueue.isEmpty()) {
      Event evt=eventQueue.take();
      if (evt.getType() == RMAppEventType.APP_REJECTED) {
        Assert.assertTrue(((RMAppEvent)evt).getApplicationId().equals(appId));
        return;
      }
    }
 else {
      Thread.sleep(500);
    }
  }
  fail("App submission with a cancelled token should have failed");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.webapp.TestRMWebServicesApps </h4><pre class="type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAppStatistics() throws JSONException, Exception {
  try {
    rm.start();
    MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",4096);
    Thread.sleep(1);
    RMApp app1=rm.submitApp(CONTAINER_MB,"",UserGroupInformation.getCurrentUser().getShortUserName(),null,false,null,2,null,"MAPREDUCE");
    amNodeManager.nodeHeartbeat(true);
    MockAM am=rm.sendAMLaunched(app1.getCurrentAppAttempt().getAppAttemptId());
    am.registerAppAttempt();
    am.unregisterAppAttempt();
    amNodeManager.nodeHeartbeat(app1.getCurrentAppAttempt().getAppAttemptId(),1,ContainerState.COMPLETE);
    rm.submitApp(CONTAINER_MB,"",UserGroupInformation.getCurrentUser().getShortUserName(),null,false,null,2,null,"MAPREDUCE");
    rm.submitApp(CONTAINER_MB,"",UserGroupInformation.getCurrentUser().getShortUserName(),null,false,null,2,null,"OTHER");
    WebResource r=resource();
    ClientResponse response=r.path("ws").path("v1").path("cluster").path("appstatistics").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    JSONObject json=response.getEntity(JSONObject.class);
    assertEquals("incorrect number of elements",1,json.length());
    JSONObject appsStatInfo=json.getJSONObject("appStatInfo");
    assertEquals("incorrect number of elements",1,appsStatInfo.length());
    JSONArray statItems=appsStatInfo.getJSONArray("statItem");
    assertEquals("incorrect number of elements",YarnApplicationState.values().length,statItems.length());
    for (int i=0; i < YarnApplicationState.values().length; ++i) {
      assertEquals("*",statItems.getJSONObject(0).getString("type"));
      if (statItems.getJSONObject(0).getString("state").equals("ACCEPTED")) {
        assertEquals("2",statItems.getJSONObject(0).getString("count"));
      }
 else       if (statItems.getJSONObject(0).getString("state").equals("FINISHED")) {
        assertEquals("1",statItems.getJSONObject(0).getString("count"));
      }
 else {
        assertEquals("0",statItems.getJSONObject(0).getString("count"));
      }
    }
    r=resource();
    response=r.path("ws").path("v1").path("cluster").path("appstatistics").queryParam("states",YarnApplicationState.ACCEPTED.toString()).accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    json=response.getEntity(JSONObject.class);
    assertEquals("incorrect number of elements",1,json.length());
    appsStatInfo=json.getJSONObject("appStatInfo");
    assertEquals("incorrect number of elements",1,appsStatInfo.length());
    statItems=appsStatInfo.getJSONArray("statItem");
    assertEquals("incorrect number of elements",1,statItems.length());
    assertEquals("ACCEPTED",statItems.getJSONObject(0).getString("state"));
    assertEquals("*",statItems.getJSONObject(0).getString("type"));
    assertEquals("2",statItems.getJSONObject(0).getString("count"));
    r=resource();
    response=r.path("ws").path("v1").path("cluster").path("appstatistics").queryParam("applicationTypes","MAPREDUCE").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    json=response.getEntity(JSONObject.class);
    assertEquals("incorrect number of elements",1,json.length());
    appsStatInfo=json.getJSONObject("appStatInfo");
    assertEquals("incorrect number of elements",1,appsStatInfo.length());
    statItems=appsStatInfo.getJSONArray("statItem");
    assertEquals("incorrect number of elements",YarnApplicationState.values().length,statItems.length());
    for (int i=0; i < YarnApplicationState.values().length; ++i) {
      assertEquals("mapreduce",statItems.getJSONObject(0).getString("type"));
      if (statItems.getJSONObject(0).getString("state").equals("ACCEPTED")) {
        assertEquals("1",statItems.getJSONObject(0).getString("count"));
      }
 else       if (statItems.getJSONObject(0).getString("state").equals("FINISHED")) {
        assertEquals("1",statItems.getJSONObject(0).getString("count"));
      }
 else {
        assertEquals("0",statItems.getJSONObject(0).getString("count"));
      }
    }
    r=resource();
    response=r.path("ws").path("v1").path("cluster").path("appstatistics").queryParam("applicationTypes","MAPREDUCE,OTHER").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(Status.BAD_REQUEST,response.getClientResponseStatus());
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    json=response.getEntity(JSONObject.class);
    assertEquals("incorrect number of elements",1,json.length());
    JSONObject exception=json.getJSONObject("RemoteException");
    assertEquals("incorrect number of elements",3,exception.length());
    String message=exception.getString("message");
    String type=exception.getString("exception");
    String className=exception.getString("javaClassName");
    WebServicesTestUtils.checkStringContains("exception message","we temporarily support at most one applicationType",message);
    WebServicesTestUtils.checkStringEqual("exception type","BadRequestException",type);
    WebServicesTestUtils.checkStringEqual("exception className","org.apache.hadoop.yarn.webapp.BadRequestException",className);
    r=resource();
    response=r.path("ws").path("v1").path("cluster").path("appstatistics").queryParam("states",YarnApplicationState.FINISHED.toString() + "," + YarnApplicationState.ACCEPTED.toString()).queryParam("applicationTypes","MAPREDUCE").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    json=response.getEntity(JSONObject.class);
    assertEquals("incorrect number of elements",1,json.length());
    appsStatInfo=json.getJSONObject("appStatInfo");
    assertEquals("incorrect number of elements",1,appsStatInfo.length());
    statItems=appsStatInfo.getJSONArray("statItem");
    assertEquals("incorrect number of elements",2,statItems.length());
    JSONObject statItem1=statItems.getJSONObject(0);
    JSONObject statItem2=statItems.getJSONObject(1);
    assertTrue((statItem1.getString("state").equals("ACCEPTED") && statItem2.getString("state").equals("FINISHED")) || (statItem2.getString("state").equals("ACCEPTED") && statItem1.getString("state").equals("FINISHED")));
    assertEquals("mapreduce",statItem1.getString("type"));
    assertEquals("1",statItem1.getString("count"));
    assertEquals("mapreduce",statItem2.getString("type"));
    assertEquals("1",statItem2.getString("count"));
    r=resource();
    response=r.path("ws").path("v1").path("cluster").path("appstatistics").queryParam("states","wrong_state").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(Status.BAD_REQUEST,response.getClientResponseStatus());
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    json=response.getEntity(JSONObject.class);
    assertEquals("incorrect number of elements",1,json.length());
    exception=json.getJSONObject("RemoteException");
    assertEquals("incorrect number of elements",3,exception.length());
    message=exception.getString("message");
    type=exception.getString("exception");
    className=exception.getString("javaClassName");
    WebServicesTestUtils.checkStringContains("exception message","Invalid application-state wrong_state",message);
    WebServicesTestUtils.checkStringEqual("exception type","BadRequestException",type);
    WebServicesTestUtils.checkStringEqual("exception className","org.apache.hadoop.yarn.webapp.BadRequestException",className);
  }
  finally {
    rm.stop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.webapp.TestRMWebServicesAppsModification </h4><pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=90000) public void testSingleAppKill() throws Exception {
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  String[] mediaTypes={MediaType.APPLICATION_JSON,MediaType.APPLICATION_XML};
  MediaType[] contentTypes={MediaType.APPLICATION_JSON_TYPE,MediaType.APPLICATION_XML_TYPE};
  for (  String mediaType : mediaTypes) {
    for (    MediaType contentType : contentTypes) {
      RMApp app=rm.submitApp(CONTAINER_MB,"",webserviceUserName);
      amNodeManager.nodeHeartbeat(true);
      ClientResponse response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").accept(mediaType).get(ClientResponse.class);
      AppState targetState=new AppState(YarnApplicationState.KILLED.toString());
      Object entity;
      if (contentType == MediaType.APPLICATION_JSON_TYPE) {
        entity=appStateToJSON(targetState);
      }
 else {
        entity=targetState;
      }
      response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").entity(entity,contentType).accept(mediaType).put(ClientResponse.class);
      if (!isAuthenticationEnabled()) {
        assertEquals(Status.UNAUTHORIZED,response.getClientResponseStatus());
        continue;
      }
      assertEquals(Status.ACCEPTED,response.getClientResponseStatus());
      if (mediaType == MediaType.APPLICATION_JSON) {
        verifyAppStateJson(response,RMAppState.KILLING,RMAppState.ACCEPTED);
      }
 else {
        verifyAppStateXML(response,RMAppState.KILLING,RMAppState.ACCEPTED);
      }
      String locationHeaderValue=response.getHeaders().getFirst(HttpHeaders.LOCATION);
      Client c=Client.create();
      WebResource tmp=c.resource(locationHeaderValue);
      if (isAuthenticationEnabled()) {
        tmp=tmp.queryParam("user.name",webserviceUserName);
      }
      response=tmp.get(ClientResponse.class);
      assertEquals(Status.OK,response.getClientResponseStatus());
      assertTrue(locationHeaderValue.endsWith("/ws/v1/cluster/apps/" + app.getApplicationId().toString() + "/state"));
      while (true) {
        Thread.sleep(100);
        response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").accept(mediaType).entity(entity,contentType).put(ClientResponse.class);
        assertTrue((response.getClientResponseStatus() == Status.ACCEPTED) || (response.getClientResponseStatus() == Status.OK));
        if (response.getClientResponseStatus() == Status.OK) {
          assertEquals(RMAppState.KILLED,app.getState());
          if (mediaType == MediaType.APPLICATION_JSON) {
            verifyAppStateJson(response,RMAppState.KILLED);
          }
 else {
            verifyAppStateXML(response,RMAppState.KILLED);
          }
          break;
        }
      }
    }
  }
  rm.stop();
  return;
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.webapp.TestRMWebServicesCapacitySched </h4><pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPerUserResourcesJSON() throws Exception {
  rm.start();
  try {
    rm.submitApp(10,"app1","user1",null,"b1");
    rm.submitApp(20,"app2","user2",null,"b1");
    WebResource r=resource();
    ClientResponse response=r.path("ws").path("v1").path("cluster").path("scheduler/").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    JSONObject json=response.getEntity(JSONObject.class);
    JSONObject schedulerInfo=json.getJSONObject("scheduler").getJSONObject("schedulerInfo");
    JSONObject b1=getSubQueue(getSubQueue(schedulerInfo,"b"),"b1");
    JSONArray users=b1.getJSONObject("users").getJSONArray("user");
    for (int i=0; i < 2; ++i) {
      JSONObject user=users.getJSONObject(i);
      assertTrue("User isn't user1 or user2",user.getString("username").equals("user1") || user.getString("username").equals("user2"));
      user.getInt("numActiveApplications");
      user.getInt("numPendingApplications");
      checkResourcesUsed(user);
    }
  }
  finally {
    rm.stop();
  }
}

</code></pre>

<br>
<pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test per user resources and resourcesUsed elements in the web services XML
 * @throws Exception
 */
@Test public void testPerUserResourcesXML() throws Exception {
  rm.start();
  try {
    rm.submitApp(10,"app1","user1",null,"b1");
    rm.submitApp(20,"app2","user2",null,"b1");
    WebResource r=resource();
    ClientResponse response=r.path("ws/v1/cluster/scheduler").accept(MediaType.APPLICATION_XML).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_XML_TYPE,response.getType());
    String xml=response.getEntity(String.class);
    DocumentBuilder db=DocumentBuilderFactory.newInstance().newDocumentBuilder();
    InputSource is=new InputSource();
    is.setCharacterStream(new StringReader(xml));
    Document dom=db.parse(is);
    NodeList allUsers=dom.getElementsByTagName("users");
    for (int i=0; i < allUsers.getLength(); ++i) {
      Node perUserResources=allUsers.item(i);
      String queueName=getChildNodeByName(perUserResources.getParentNode(),"queueName").getTextContent();
      if (queueName.equals("b1")) {
        assertEquals(2,perUserResources.getChildNodes().getLength());
        NodeList users=perUserResources.getChildNodes();
        for (int j=0; j < users.getLength(); ++j) {
          Node user=users.item(j);
          String username=getChildNodeByName(user,"username").getTextContent();
          assertTrue(username.equals("user1") || username.equals("user2"));
          Integer.parseInt(getChildNodeByName(getChildNodeByName(user,"resourcesUsed"),"memory").getTextContent());
          Integer.parseInt(getChildNodeByName(user,"numActiveApplications").getTextContent());
          Integer.parseInt(getChildNodeByName(user,"numPendingApplications").getTextContent());
        }
      }
 else {
        assertEquals(0,perUserResources.getChildNodes().getLength());
      }
    }
    NodeList allResourcesUsed=dom.getElementsByTagName("resourcesUsed");
    for (int i=0; i < allResourcesUsed.getLength(); ++i) {
      Node resourcesUsed=allResourcesUsed.item(i);
      Integer.parseInt(getChildNodeByName(resourcesUsed,"memory").getTextContent());
      Integer.parseInt(getChildNodeByName(resourcesUsed,"vCores").getTextContent());
    }
  }
  finally {
    rm.stop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.sls.TestSLSRunner </h4><pre class="type-13 type-11 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test @SuppressWarnings("all") public void testSimulatorRunning() throws Exception {
  File tempDir=new File("target",UUID.randomUUID().toString());
  final List<Throwable> exceptionList=Collections.synchronizedList(new ArrayList<Throwable>());
  Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler(){
    @Override public void uncaughtException(    Thread t,    Throwable e){
      exceptionList.add(e);
    }
  }
);
  File slsOutputDir=new File(tempDir.getAbsolutePath() + "/slsoutput/");
  String args[]=new String[]{"-inputrumen","src/main/data/2jobs2min-rumen-jh.json","-output",slsOutputDir.getAbsolutePath()};
  SLSRunner.main(args);
  int count=20;
  while (count >= 0) {
    Thread.sleep(1000);
    if (!exceptionList.isEmpty()) {
      SLSRunner.getRunner().stop();
      Assert.fail("TestSLSRunner catched exception from child thread " + "(TaskRunner.Task): " + exceptionList.get(0).getMessage());
      break;
    }
    count--;
  }
  SLSRunner.getRunner().stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.util.TestProcfsBasedProcessTree </h4><pre class="type-9 type-13 type-11 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testProcessTree() throws Exception {
  try {
    Assert.assertTrue(ProcfsBasedProcessTree.isAvailable());
  }
 catch (  Exception e) {
    LOG.info(StringUtils.stringifyException(e));
    Assert.assertTrue("ProcfsBaseProcessTree should be available on Linux",false);
    return;
  }
  Random rm=new Random();
  File tempFile=new File(TEST_ROOT_DIR,getClass().getName() + "_shellScript_" + rm.nextInt()+ ".sh");
  tempFile.deleteOnExit();
  shellScript=TEST_ROOT_DIR + File.separator + tempFile.getName();
  tempFile=new File(TEST_ROOT_DIR,getClass().getName() + "_pidFile_" + rm.nextInt()+ ".pid");
  tempFile.deleteOnExit();
  pidFile=TEST_ROOT_DIR + File.separator + tempFile.getName();
  lowestDescendant=TEST_ROOT_DIR + File.separator + "lowestDescendantPidFile";
  try {
    FileWriter fWriter=new FileWriter(shellScript);
    fWriter.write("# rogue task\n" + "sleep 1\n" + "echo hello\n"+ "if [ $1 -ne 0 ]\n"+ "then\n"+ " sh " + shellScript + " $(($1-1))\n"+ "else\n"+ " echo $$ > "+ lowestDescendant+ "\n"+ " while true\n do\n"+ "  sleep 5\n"+ " done\n"+ "fi");
    fWriter.close();
  }
 catch (  IOException ioe) {
    LOG.info("Error: " + ioe);
    return;
  }
  Thread t=new RogueTaskThread();
  t.start();
  String pid=getRogueTaskPID();
  LOG.info("Root process pid: " + pid);
  ProcfsBasedProcessTree p=createProcessTree(pid);
  p.updateProcessTree();
  LOG.info("ProcessTree: " + p.toString());
  File leaf=new File(lowestDescendant);
  while (!leaf.exists()) {
    try {
      Thread.sleep(500);
    }
 catch (    InterruptedException ie) {
      break;
    }
  }
  p.updateProcessTree();
  LOG.info("ProcessTree: " + p.toString());
  String processTreeDump=p.getProcessTreeDump();
  destroyProcessTree(pid);
  boolean isAlive=true;
  for (int tries=100; tries > 0; tries--) {
    if (isSetsidAvailable()) {
      isAlive=isAnyProcessInTreeAlive(p);
    }
 else {
      isAlive=isAlive(pid);
    }
    if (!isAlive) {
      break;
    }
    Thread.sleep(100);
  }
  if (isAlive) {
    fail("ProcessTree shouldn't be alive");
  }
  LOG.info("Process-tree dump follows: \n" + processTreeDump);
  Assert.assertTrue("Process-tree dump doesn't start with a proper header",processTreeDump.startsWith("\t|- PID PPID PGRPID SESSID CMD_NAME " + "USER_MODE_TIME(MILLIS) SYSTEM_TIME(MILLIS) VMEM_USAGE(BYTES) " + "RSSMEM_USAGE(PAGES) FULL_CMD_LINE\n"));
  for (int i=N; i >= 0; i--) {
    String cmdLineDump="\\|- [0-9]+ [0-9]+ [0-9]+ [0-9]+ \\(sh\\)" + " [0-9]+ [0-9]+ [0-9]+ [0-9]+ sh " + shellScript + " "+ i;
    Pattern pat=Pattern.compile(cmdLineDump);
    Matcher mat=pat.matcher(processTreeDump);
    Assert.assertTrue("Process-tree dump doesn't contain the cmdLineDump of " + i + "th process!",mat.find());
  }
  try {
    t.join(2000);
    LOG.info("RogueTaskThread successfully joined.");
  }
 catch (  InterruptedException ie) {
    LOG.info("Interrupted while joining RogueTaskThread.");
  }
  p.updateProcessTree();
  Assert.assertFalse("ProcessTree must have been gone",isAlive(pid));
  Assert.assertTrue("Cumulative vmem for the gone-process is " + p.getCumulativeVmem() + " . It should be zero.",p.getCumulativeVmem() == 0);
  Assert.assertTrue(p.toString().equals("[ ]"));
}

</code></pre>

<br>
<pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Test the correctness of process-tree dump.
 * @throws IOException
 */
@Test(timeout=30000) public void testProcessTreeDump() throws IOException {
  String[] pids={"100","200","300","400","500","600"};
  File procfsRootDir=new File(TEST_ROOT_DIR,"proc");
  try {
    setupProcfsRootDir(procfsRootDir);
    setupPidDirs(procfsRootDir,pids);
    int numProcesses=pids.length;
    ProcessStatInfo[] procInfos=new ProcessStatInfo[numProcesses];
    procInfos[0]=new ProcessStatInfo(new String[]{"100","proc1","1","100","100","100000","100","1000","200"});
    procInfos[1]=new ProcessStatInfo(new String[]{"200","proc2","100","100","100","200000","200","2000","400"});
    procInfos[2]=new ProcessStatInfo(new String[]{"300","proc3","200","100","100","300000","300","3000","600"});
    procInfos[3]=new ProcessStatInfo(new String[]{"400","proc4","200","100","100","400000","400","4000","800"});
    procInfos[4]=new ProcessStatInfo(new String[]{"500","proc5","400","100","100","400000","400","4000","800"});
    procInfos[5]=new ProcessStatInfo(new String[]{"600","proc6","1","1","1","400000","400","4000","800"});
    ProcessTreeSmapMemInfo[] memInfos=new ProcessTreeSmapMemInfo[6];
    memInfos[0]=new ProcessTreeSmapMemInfo("100");
    memInfos[1]=new ProcessTreeSmapMemInfo("200");
    memInfos[2]=new ProcessTreeSmapMemInfo("300");
    memInfos[3]=new ProcessTreeSmapMemInfo("400");
    memInfos[4]=new ProcessTreeSmapMemInfo("500");
    memInfos[5]=new ProcessTreeSmapMemInfo("600");
    String[] cmdLines=new String[numProcesses];
    cmdLines[0]="proc1 arg1 arg2";
    cmdLines[1]="proc2 arg3 arg4";
    cmdLines[2]="proc3 arg5 arg6";
    cmdLines[3]="proc4 arg7 arg8";
    cmdLines[4]="proc5 arg9 arg10";
    cmdLines[5]="proc6 arg11 arg12";
    createMemoryMappingInfo(memInfos);
    writeStatFiles(procfsRootDir,pids,procInfos,memInfos);
    writeCmdLineFiles(procfsRootDir,pids,cmdLines);
    ProcfsBasedProcessTree processTree=createProcessTree("100",procfsRootDir.getAbsolutePath());
    processTree.updateProcessTree();
    String processTreeDump=processTree.getProcessTreeDump();
    LOG.info("Process-tree dump follows: \n" + processTreeDump);
    Assert.assertTrue("Process-tree dump doesn't start with a proper header",processTreeDump.startsWith("\t|- PID PPID PGRPID SESSID CMD_NAME " + "USER_MODE_TIME(MILLIS) SYSTEM_TIME(MILLIS) VMEM_USAGE(BYTES) " + "RSSMEM_USAGE(PAGES) FULL_CMD_LINE\n"));
    for (int i=0; i < 5; i++) {
      ProcessStatInfo p=procInfos[i];
      Assert.assertTrue("Process-tree dump doesn't contain the cmdLineDump of process " + p.pid,processTreeDump.contains("\t|- " + p.pid + " "+ p.ppid+ " "+ p.pgrpId+ " "+ p.session+ " ("+ p.name+ ") "+ p.utime+ " "+ p.stime+ " "+ p.vmem+ " "+ p.rssmemPage+ " "+ cmdLines[i]));
    }
    ProcessStatInfo p=procInfos[5];
    Assert.assertFalse("Process-tree dump shouldn't contain the cmdLineDump of process " + p.pid,processTreeDump.contains("\t|- " + p.pid + " "+ p.ppid+ " "+ p.pgrpId+ " "+ p.session+ " ("+ p.name+ ") "+ p.utime+ " "+ p.stime+ " "+ p.vmem+ " "+ cmdLines[5]));
  }
  finally {
    FileUtil.fullyDelete(procfsRootDir);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.webapp.TestWebApp </h4><pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServePathsNoName(){
  WebApp app=WebApps.$for("",this).start();
  assertEquals("/",app.getRedirectPath());
  String[] expectedPaths={"/*"};
  String[] pathSpecs=app.getServePathSpecs();
  assertEquals(1,pathSpecs.length);
  for (int i=0; i < expectedPaths.length; i++) {
    assertTrue(ArrayUtils.contains(pathSpecs,expectedPaths[i]));
  }
  app.stop();
}

</code></pre>

<br>
<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServePaths(){
  WebApp app=WebApps.$for("test",this).start();
  assertEquals("/test",app.getRedirectPath());
  String[] expectedPaths={"/test","/test/*"};
  String[] pathSpecs=app.getServePathSpecs();
  assertEquals(2,pathSpecs.length);
  for (int i=0; i < expectedPaths.length; i++) {
    assertTrue(ArrayUtils.contains(pathSpecs,expectedPaths[i]));
  }
  app.stop();
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
