<h3 style="margin:0px">Class: org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.TestContainerLaunch (16 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="21"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('21')" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements"><kbd id="tag-21"class="label-info"style="display: inline-block;font-size:7pt" >ConditionMatcher&nbsp;(4)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Sets implicit assumptions "><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >AssumptionSetter&nbsp;(4)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSpecialCharSymlinks() throws IOException {
  File shellFile=null;
  File tempFile=null;
  String badSymlink=Shell.WINDOWS ? "foo@zz_#!-+bar.cmd" : "foo@zz%_#*&!-+= bar()";
  File symLinkFile=null;
  try {
    shellFile=Shell.appendScriptExtension(tmpDir,"hello");
    tempFile=Shell.appendScriptExtension(tmpDir,"temp");
    String timeoutCommand=Shell.WINDOWS ? "@echo \"hello\"" : "echo \"hello\"";
    PrintWriter writer=new PrintWriter(new FileOutputStream(shellFile));
    FileUtil.setExecutable(shellFile,true);
    writer.println(timeoutCommand);
    writer.close();
    Map<Path,List<String>> resources=new HashMap<Path,List<String>>();
    Path path=new Path(shellFile.getAbsolutePath());
    resources.put(path,Arrays.asList(badSymlink));
    FileOutputStream fos=new FileOutputStream(tempFile);
    Map<String,String> env=new HashMap<String,String>();
    List<String> commands=new ArrayList<String>();
    if (Shell.WINDOWS) {
      commands.add("cmd");
      commands.add("/c");
      commands.add("\"" + badSymlink + "\"");
    }
 else {
      commands.add("/bin/sh ./\\\"" + badSymlink + "\\\"");
    }
    ContainerLaunch.writeLaunchEnv(fos,env,resources,commands);
    fos.flush();
    fos.close();
    FileUtil.setExecutable(tempFile,true);
    Shell.ShellCommandExecutor shexc=new Shell.ShellCommandExecutor(new String[]{tempFile.getAbsolutePath()},tmpDir);
    shexc.execute();
    assertEquals(shexc.getExitCode(),0);
    assert (shexc.getOutput().contains("hello"));
    symLinkFile=new File(tmpDir,badSymlink);
  }
  finally {
    if (shellFile != null && shellFile.exists()) {
      shellFile.delete();
    }
    if (tempFile != null && tempFile.exists()) {
      tempFile.delete();
    }
    if (symLinkFile != null && symLinkFile.exists()) {
      symLinkFile.delete();
    }
  }
}

</code></pre>

<pre class="type-9 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testInvalidEnvSyntaxDiagnostics() throws IOException {
  File shellFile=null;
  try {
    shellFile=Shell.appendScriptExtension(tmpDir,"hello");
    Map<Path,List<String>> resources=new HashMap<Path,List<String>>();
    FileOutputStream fos=new FileOutputStream(shellFile);
    FileUtil.setExecutable(shellFile,true);
    Map<String,String> env=new HashMap<String,String>();
    env.put("APPLICATION_WORKFLOW_CONTEXT","{\"workflowId\":\"609f91c5cd83\"," + "\"workflowName\":\"\n\ninsert table " + "\npartition (cd_education_status)\nselect cd_demo_sk, cd_gender, ");
    List<String> commands=new ArrayList<String>();
    ContainerLaunch.writeLaunchEnv(fos,env,resources,commands);
    fos.flush();
    fos.close();
    Map<String,String> cmdEnv=new HashMap<String,String>();
    cmdEnv.put("LANG","C");
    Shell.ShellCommandExecutor shexc=new Shell.ShellCommandExecutor(new String[]{shellFile.getAbsolutePath()},tmpDir,cmdEnv);
    String diagnostics=null;
    try {
      shexc.execute();
      Assert.fail("Should catch exception");
    }
 catch (    ExitCodeException e) {
      diagnostics=e.getMessage();
    }
    Assert.assertTrue(diagnostics.contains(Shell.WINDOWS ? "is not recognized as an internal or external command" : "command not found"));
    Assert.assertTrue(shexc.getExitCode() != 0);
  }
  finally {
    if (shellFile != null && shellFile.exists()) {
      shellFile.delete();
    }
  }
}

</code></pre>

<pre class="type-2 type-15 type-6 type-21 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testWindowsShellScriptBuilderMkdir() throws IOException {
  String mkDirCmd="@if not exist \"\" mkdir \"\"";
  Assume.assumeTrue(Shell.WINDOWS);
  assertEquals(8191,Shell.WINDOWS_MAX_SHELL_LENGHT);
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.mkdir(new Path(org.apache.commons.lang.StringUtils.repeat("A",1024)));
  builder.mkdir(new Path(org.apache.commons.lang.StringUtils.repeat("E",(Shell.WINDOWS_MAX_SHELL_LENGHT - mkDirCmd.length()) / 2)));
  try {
    builder.mkdir(new Path(org.apache.commons.lang.StringUtils.repeat("X",(Shell.WINDOWS_MAX_SHELL_LENGHT - mkDirCmd.length()) / 2 + 1)));
    fail("long mkdir was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setup() throws IOException {
  conf.setClass(YarnConfiguration.NM_CONTAINER_MON_RESOURCE_CALCULATOR,LinuxResourceCalculatorPlugin.class,ResourceCalculatorPlugin.class);
  super.setup();
}

</code></pre>

<pre class="type-9 type-2 type-7 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testInvalidSymlinkDiagnostics() throws IOException {
  File shellFile=null;
  File tempFile=null;
  String symLink=Shell.WINDOWS ? "test.cmd" : "test";
  File symLinkFile=null;
  try {
    shellFile=Shell.appendScriptExtension(tmpDir,"hello");
    tempFile=Shell.appendScriptExtension(tmpDir,"temp");
    String timeoutCommand=Shell.WINDOWS ? "@echo \"hello\"" : "echo \"hello\"";
    PrintWriter writer=new PrintWriter(new FileOutputStream(shellFile));
    FileUtil.setExecutable(shellFile,true);
    writer.println(timeoutCommand);
    writer.close();
    Map<Path,List<String>> resources=new HashMap<Path,List<String>>();
    Path invalidPath=new Path(shellFile.getAbsolutePath() + "randomPath");
    resources.put(invalidPath,Arrays.asList(symLink));
    FileOutputStream fos=new FileOutputStream(tempFile);
    Map<String,String> env=new HashMap<String,String>();
    List<String> commands=new ArrayList<String>();
    if (Shell.WINDOWS) {
      commands.add("cmd");
      commands.add("/c");
      commands.add("\"" + symLink + "\"");
    }
 else {
      commands.add("/bin/sh ./\\\"" + symLink + "\\\"");
    }
    ContainerLaunch.writeLaunchEnv(fos,env,resources,commands);
    fos.flush();
    fos.close();
    FileUtil.setExecutable(tempFile,true);
    Shell.ShellCommandExecutor shexc=new Shell.ShellCommandExecutor(new String[]{tempFile.getAbsolutePath()},tmpDir);
    String diagnostics=null;
    try {
      shexc.execute();
      Assert.fail("Should catch exception");
    }
 catch (    ExitCodeException e) {
      diagnostics=e.getMessage();
    }
    Assert.assertNotNull(diagnostics);
    Assert.assertTrue(shexc.getExitCode() != 0);
    symLinkFile=new File(tmpDir,symLink);
  }
  finally {
    if (shellFile != null && shellFile.exists()) {
      shellFile.delete();
    }
    if (tempFile != null && tempFile.exists()) {
      tempFile.delete();
    }
    if (symLinkFile != null && symLinkFile.exists()) {
      symLinkFile.delete();
    }
  }
}

</code></pre>

<pre class="type-2 type-15 type-6 type-21 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testWindowsShellScriptBuilderLink() throws IOException {
  Assume.assumeTrue(Shell.WINDOWS);
  String linkCmd="@" + Shell.WINUTILS + " symlink \"\" \"\"";
  assertEquals(8191,Shell.WINDOWS_MAX_SHELL_LENGHT);
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.link(new Path(org.apache.commons.lang.StringUtils.repeat("A",1024)),new Path(org.apache.commons.lang.StringUtils.repeat("B",1024)));
  builder.link(new Path(org.apache.commons.lang.StringUtils.repeat("E",(Shell.WINDOWS_MAX_SHELL_LENGHT - linkCmd.length()) / 2)),new Path(org.apache.commons.lang.StringUtils.repeat("F",(Shell.WINDOWS_MAX_SHELL_LENGHT - linkCmd.length()) / 2)));
  try {
    builder.link(new Path(org.apache.commons.lang.StringUtils.repeat("X",(Shell.WINDOWS_MAX_SHELL_LENGHT - linkCmd.length()) / 2 + 1)),new Path(org.apache.commons.lang.StringUtils.repeat("Y",(Shell.WINDOWS_MAX_SHELL_LENGHT - linkCmd.length()) / 2) + 1));
    fail("long link was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
}

</code></pre>

<pre class="type-2 type-15 type-6 type-21 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testWindowsShellScriptBuilderCommand() throws IOException {
  String callCmd="@call ";
  Assume.assumeTrue(Shell.WINDOWS);
  assertEquals(8191,Shell.WINDOWS_MAX_SHELL_LENGHT);
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("A",1024)));
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("E",Shell.WINDOWS_MAX_SHELL_LENGHT - callCmd.length())));
  try {
    builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("X",Shell.WINDOWS_MAX_SHELL_LENGHT - callCmd.length() + 1)));
    fail("longCommand was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("A",1024),org.apache.commons.lang.StringUtils.repeat("A",1024),org.apache.commons.lang.StringUtils.repeat("A",1024)));
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("E",4095),org.apache.commons.lang.StringUtils.repeat("E",2047),org.apache.commons.lang.StringUtils.repeat("E",2047 - callCmd.length())));
  try {
    builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("X",4095),org.apache.commons.lang.StringUtils.repeat("X",2047),org.apache.commons.lang.StringUtils.repeat("X",2048 - callCmd.length())));
    fail("long commands was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
}

</code></pre>

<pre class="type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("rawtypes") @Test(timeout=10000) public void testCallFailureWithNullLocalizedResources(){
  Container container=mock(Container.class);
  when(container.getContainerId()).thenReturn(ContainerId.newInstance(ApplicationAttemptId.newInstance(ApplicationId.newInstance(System.currentTimeMillis(),1),1),1));
  ContainerLaunchContext clc=mock(ContainerLaunchContext.class);
  when(clc.getCommands()).thenReturn(Collections.<String>emptyList());
  when(container.getLaunchContext()).thenReturn(clc);
  when(container.getLocalizedResources()).thenReturn(null);
  Dispatcher dispatcher=mock(Dispatcher.class);
  EventHandler eventHandler=new EventHandler(){
    public void handle(    Event event){
      Assert.assertTrue(event instanceof ContainerExitEvent);
      ContainerExitEvent exitEvent=(ContainerExitEvent)event;
      Assert.assertEquals(ContainerEventType.CONTAINER_EXITED_WITH_FAILURE,exitEvent.getType());
    }
  }
;
  when(dispatcher.getEventHandler()).thenReturn(eventHandler);
  ContainerLaunch launch=new ContainerLaunch(context,new Configuration(),dispatcher,exec,null,container,dirsHandler,containerManager);
  launch.call();
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testAuxiliaryServiceHelper() throws Exception {
  Map<String,String> env=new HashMap<String,String>();
  String serviceName="testAuxiliaryService";
  ByteBuffer bb=ByteBuffer.wrap("testAuxiliaryService".getBytes());
  AuxiliaryServiceHelper.setServiceDataIntoEnv(serviceName,bb,env);
  Assert.assertEquals(bb,AuxiliaryServiceHelper.getServiceDataFromEnv(serviceName,env));
}

</code></pre>

<pre class="type-2 type-15 type-6 type-21 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testWindowsShellScriptBuilderEnv() throws IOException {
  Assume.assumeTrue(Shell.WINDOWS);
  assertEquals(8191,Shell.WINDOWS_MAX_SHELL_LENGHT);
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.env("somekey",org.apache.commons.lang.StringUtils.repeat("A",1024));
  builder.env("somekey",org.apache.commons.lang.StringUtils.repeat("A",Shell.WINDOWS_MAX_SHELL_LENGHT - ("@set somekey=").length()));
  try {
    builder.env("somekey",org.apache.commons.lang.StringUtils.repeat("A",Shell.WINDOWS_MAX_SHELL_LENGHT - ("@set somekey=").length()) + 1);
    fail("long env was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
}

</code></pre>

<pre class="type-9 type-11 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=10000) public void testEnvExpansion() throws IOException {
  Path logPath=new Path("/nm/container/logs");
  String input=Apps.crossPlatformify("HADOOP_HOME") + "/share/hadoop/common/*" + ApplicationConstants.CLASS_PATH_SEPARATOR+ Apps.crossPlatformify("HADOOP_HOME")+ "/share/hadoop/common/lib/*"+ ApplicationConstants.CLASS_PATH_SEPARATOR+ Apps.crossPlatformify("HADOOP_LOG_HOME")+ ApplicationConstants.LOG_DIR_EXPANSION_VAR;
  String res=ContainerLaunch.expandEnvironment(input,logPath);
  if (Shell.WINDOWS) {
    Assert.assertEquals("%HADOOP_HOME%/share/hadoop/common/*;" + "%HADOOP_HOME%/share/hadoop/common/lib/*;" + "%HADOOP_LOG_HOME%/nm/container/logs",res);
  }
 else {
    Assert.assertEquals("$HADOOP_HOME/share/hadoop/common/*:" + "$HADOOP_HOME/share/hadoop/common/lib/*:" + "$HADOOP_LOG_HOME/nm/container/logs",res);
  }
  System.out.println(res);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that script exists with non-zero exit code when command fails.
 * @throws IOException
 */
@Test(timeout=10000) public void testShellScriptBuilderNonZeroExitCode() throws IOException {
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.command(Arrays.asList(new String[]{"unknownCommand"}));
  File shellFile=Shell.appendScriptExtension(tmpDir,"testShellScriptBuilderError");
  PrintStream writer=new PrintStream(new FileOutputStream(shellFile));
  builder.write(writer);
  writer.close();
  try {
    FileUtil.setExecutable(shellFile,true);
    Shell.ShellCommandExecutor shexc=new Shell.ShellCommandExecutor(new String[]{shellFile.getAbsolutePath()},tmpDir);
    try {
      shexc.execute();
      fail("builder shell command was expected to throw");
    }
 catch (    IOException e) {
      System.out.println("Received an expected exception: " + e.getMessage());
    }
  }
  finally {
    FileUtil.fullyDelete(shellFile);
  }
}

</code></pre>

<pre class="type-9 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testContainerLaunchStdoutAndStderrDiagnostics() throws IOException {
  File shellFile=null;
  try {
    shellFile=Shell.appendScriptExtension(tmpDir,"hello");
    String command=Shell.WINDOWS ? "@echo \"hello\" & @echo \"error\" 1>&2 & exit /b 2" : "echo \"hello\"; echo \"error\" 1>&2; exit 2;";
    PrintWriter writer=new PrintWriter(new FileOutputStream(shellFile));
    FileUtil.setExecutable(shellFile,true);
    writer.println(command);
    writer.close();
    Map<Path,List<String>> resources=new HashMap<Path,List<String>>();
    FileOutputStream fos=new FileOutputStream(shellFile,true);
    Map<String,String> env=new HashMap<String,String>();
    List<String> commands=new ArrayList<String>();
    commands.add(command);
    ContainerLaunch.writeLaunchEnv(fos,env,resources,commands);
    fos.flush();
    fos.close();
    Shell.ShellCommandExecutor shexc=new Shell.ShellCommandExecutor(new String[]{shellFile.getAbsolutePath()},tmpDir);
    String diagnostics=null;
    try {
      shexc.execute();
      Assert.fail("Should catch exception");
    }
 catch (    ExitCodeException e) {
      diagnostics=e.getMessage();
    }
    Assert.assertTrue(diagnostics.contains("error"));
    Assert.assertTrue(shexc.getOutput().contains("hello"));
    Assert.assertTrue(shexc.getExitCode() == 2);
  }
  finally {
    if (shellFile != null && shellFile.exists()) {
      shellFile.delete();
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * See if environment variable is forwarded using sanitizeEnv.
 * @throws Exception
 */
@Test(timeout=60000) public void testContainerEnvVariables() throws Exception {
  containerManager.start();
  ContainerLaunchContext containerLaunchContext=recordFactory.newRecordInstance(ContainerLaunchContext.class);
  ApplicationId appId=ApplicationId.newInstance(0,0);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  ContainerId cId=ContainerId.newInstance(appAttemptId,0);
  Map<String,String> userSetEnv=new HashMap<String,String>();
  userSetEnv.put(Environment.CONTAINER_ID.name(),"user_set_container_id");
  userSetEnv.put(Environment.NM_HOST.name(),"user_set_NM_HOST");
  userSetEnv.put(Environment.NM_PORT.name(),"user_set_NM_PORT");
  userSetEnv.put(Environment.NM_HTTP_PORT.name(),"user_set_NM_HTTP_PORT");
  userSetEnv.put(Environment.LOCAL_DIRS.name(),"user_set_LOCAL_DIR");
  userSetEnv.put(Environment.USER.key(),"user_set_" + Environment.USER.key());
  userSetEnv.put(Environment.LOGNAME.name(),"user_set_LOGNAME");
  userSetEnv.put(Environment.PWD.name(),"user_set_PWD");
  userSetEnv.put(Environment.HOME.name(),"user_set_HOME");
  containerLaunchContext.setEnvironment(userSetEnv);
  File scriptFile=Shell.appendScriptExtension(tmpDir,"scriptFile");
  PrintWriter fileWriter=new PrintWriter(scriptFile);
  File processStartFile=new File(tmpDir,"env_vars.txt").getAbsoluteFile();
  if (Shell.WINDOWS) {
    fileWriter.println("@echo " + Environment.CONTAINER_ID.$() + "> "+ processStartFile);
    fileWriter.println("@echo " + Environment.NM_HOST.$() + ">> "+ processStartFile);
    fileWriter.println("@echo " + Environment.NM_PORT.$() + ">> "+ processStartFile);
    fileWriter.println("@echo " + Environment.NM_HTTP_PORT.$() + ">> "+ processStartFile);
    fileWriter.println("@echo " + Environment.LOCAL_DIRS.$() + ">> "+ processStartFile);
    fileWriter.println("@echo " + Environment.USER.$() + ">> "+ processStartFile);
    fileWriter.println("@echo " + Environment.LOGNAME.$() + ">> "+ processStartFile);
    fileWriter.println("@echo " + Environment.PWD.$() + ">> "+ processStartFile);
    fileWriter.println("@echo " + Environment.HOME.$() + ">> "+ processStartFile);
    for (    String serviceName : containerManager.getAuxServiceMetaData().keySet()) {
      fileWriter.println("@echo %" + AuxiliaryServiceHelper.NM_AUX_SERVICE + serviceName+ "%>> "+ processStartFile);
    }
    fileWriter.println("@echo " + cId + ">> "+ processStartFile);
    fileWriter.println("@ping -n 100 127.0.0.1 >nul");
  }
 else {
    fileWriter.write("\numask 0");
    fileWriter.write("\necho $" + Environment.CONTAINER_ID.name() + " > "+ processStartFile);
    fileWriter.write("\necho $" + Environment.NM_HOST.name() + " >> "+ processStartFile);
    fileWriter.write("\necho $" + Environment.NM_PORT.name() + " >> "+ processStartFile);
    fileWriter.write("\necho $" + Environment.NM_HTTP_PORT.name() + " >> "+ processStartFile);
    fileWriter.write("\necho $" + Environment.LOCAL_DIRS.name() + " >> "+ processStartFile);
    fileWriter.write("\necho $" + Environment.USER.name() + " >> "+ processStartFile);
    fileWriter.write("\necho $" + Environment.LOGNAME.name() + " >> "+ processStartFile);
    fileWriter.write("\necho $" + Environment.PWD.name() + " >> "+ processStartFile);
    fileWriter.write("\necho $" + Environment.HOME.name() + " >> "+ processStartFile);
    for (    String serviceName : containerManager.getAuxServiceMetaData().keySet()) {
      fileWriter.write("\necho $" + AuxiliaryServiceHelper.NM_AUX_SERVICE + serviceName+ " >> "+ processStartFile);
    }
    fileWriter.write("\necho $$ >> " + processStartFile);
    fileWriter.write("\nexec sleep 100");
  }
  fileWriter.close();
  URL resource_alpha=ConverterUtils.getYarnUrlFromPath(localFS.makeQualified(new Path(scriptFile.getAbsolutePath())));
  LocalResource rsrc_alpha=recordFactory.newRecordInstance(LocalResource.class);
  rsrc_alpha.setResource(resource_alpha);
  rsrc_alpha.setSize(-1);
  rsrc_alpha.setVisibility(LocalResourceVisibility.APPLICATION);
  rsrc_alpha.setType(LocalResourceType.FILE);
  rsrc_alpha.setTimestamp(scriptFile.lastModified());
  String destinationFile="dest_file";
  Map<String,LocalResource> localResources=new HashMap<String,LocalResource>();
  localResources.put(destinationFile,rsrc_alpha);
  containerLaunchContext.setLocalResources(localResources);
  List<String> commands=Arrays.asList(Shell.getRunScriptCommand(scriptFile));
  containerLaunchContext.setCommands(commands);
  StartContainerRequest scRequest=StartContainerRequest.newInstance(containerLaunchContext,createContainerToken(cId,Priority.newInstance(0),0));
  List<StartContainerRequest> list=new ArrayList<StartContainerRequest>();
  list.add(scRequest);
  StartContainersRequest allRequests=StartContainersRequest.newInstance(list);
  containerManager.startContainers(allRequests);
  int timeoutSecs=0;
  while (!processStartFile.exists() && timeoutSecs++ < 20) {
    Thread.sleep(1000);
    LOG.info("Waiting for process start-file to be created");
  }
  Assert.assertTrue("ProcessStartFile doesn't exist!",processStartFile.exists());
  List<String> localDirs=dirsHandler.getLocalDirs();
  List<String> logDirs=dirsHandler.getLogDirs();
  List<Path> appDirs=new ArrayList<Path>(localDirs.size());
  for (  String localDir : localDirs) {
    Path usersdir=new Path(localDir,ContainerLocalizer.USERCACHE);
    Path userdir=new Path(usersdir,user);
    Path appsdir=new Path(userdir,ContainerLocalizer.APPCACHE);
    appDirs.add(new Path(appsdir,appId.toString()));
  }
  List<String> containerLogDirs=new ArrayList<String>();
  String relativeContainerLogDir=ContainerLaunch.getRelativeContainerLogDir(appId.toString(),cId.toString());
  for (  String logDir : logDirs) {
    containerLogDirs.add(logDir + Path.SEPARATOR + relativeContainerLogDir);
  }
  BufferedReader reader=new BufferedReader(new FileReader(processStartFile));
  Assert.assertEquals(cId.toString(),reader.readLine());
  Assert.assertEquals(context.getNodeId().getHost(),reader.readLine());
  Assert.assertEquals(String.valueOf(context.getNodeId().getPort()),reader.readLine());
  Assert.assertEquals(String.valueOf(HTTP_PORT),reader.readLine());
  Assert.assertEquals(StringUtils.join(",",appDirs),reader.readLine());
  Assert.assertEquals(user,reader.readLine());
  Assert.assertEquals(user,reader.readLine());
  String obtainedPWD=reader.readLine();
  boolean found=false;
  for (  Path localDir : appDirs) {
    if (new Path(localDir,cId.toString()).toString().equals(obtainedPWD)) {
      found=true;
      break;
    }
  }
  Assert.assertTrue("Wrong local-dir found : " + obtainedPWD,found);
  Assert.assertEquals(conf.get(YarnConfiguration.NM_USER_HOME_DIR,YarnConfiguration.DEFAULT_NM_USER_HOME_DIR),reader.readLine());
  for (  String serviceName : containerManager.getAuxServiceMetaData().keySet()) {
    Assert.assertEquals(containerManager.getAuxServiceMetaData().get(serviceName),ByteBuffer.wrap(Base64.decodeBase64(reader.readLine().getBytes())));
  }
  Assert.assertEquals(cId.toString(),containerLaunchContext.getEnvironment().get(Environment.CONTAINER_ID.name()));
  Assert.assertEquals(context.getNodeId().getHost(),containerLaunchContext.getEnvironment().get(Environment.NM_HOST.name()));
  Assert.assertEquals(String.valueOf(context.getNodeId().getPort()),containerLaunchContext.getEnvironment().get(Environment.NM_PORT.name()));
  Assert.assertEquals(String.valueOf(HTTP_PORT),containerLaunchContext.getEnvironment().get(Environment.NM_HTTP_PORT.name()));
  Assert.assertEquals(StringUtils.join(",",appDirs),containerLaunchContext.getEnvironment().get(Environment.LOCAL_DIRS.name()));
  Assert.assertEquals(StringUtils.join(",",containerLogDirs),containerLaunchContext.getEnvironment().get(Environment.LOG_DIRS.name()));
  Assert.assertEquals(user,containerLaunchContext.getEnvironment().get(Environment.USER.name()));
  Assert.assertEquals(user,containerLaunchContext.getEnvironment().get(Environment.LOGNAME.name()));
  found=false;
  obtainedPWD=containerLaunchContext.getEnvironment().get(Environment.PWD.name());
  for (  Path localDir : appDirs) {
    if (new Path(localDir,cId.toString()).toString().equals(obtainedPWD)) {
      found=true;
      break;
    }
  }
  Assert.assertTrue("Wrong local-dir found : " + obtainedPWD,found);
  Assert.assertEquals(conf.get(YarnConfiguration.NM_USER_HOME_DIR,YarnConfiguration.DEFAULT_NM_USER_HOME_DIR),containerLaunchContext.getEnvironment().get(Environment.HOME.name()));
  String pid=reader.readLine().trim();
  Assert.assertEquals(null,reader.readLine());
  Assert.assertTrue("Process is not alive!",DefaultContainerExecutor.containerIsAlive(pid));
  Assert.assertTrue("Process is not alive!",DefaultContainerExecutor.containerIsAlive(pid));
  List<ContainerId> containerIds=new ArrayList<ContainerId>();
  containerIds.add(cId);
  StopContainersRequest stopRequest=StopContainersRequest.newInstance(containerIds);
  containerManager.stopContainers(stopRequest);
  BaseContainerManagerTest.waitForContainerState(containerManager,cId,ContainerState.COMPLETE);
  GetContainerStatusesRequest gcsRequest=GetContainerStatusesRequest.newInstance(containerIds);
  ContainerStatus containerStatus=containerManager.getContainerStatuses(gcsRequest).getContainerStatuses().get(0);
  int expectedExitCode=ContainerExitStatus.KILLED_BY_APPMASTER;
  Assert.assertEquals(expectedExitCode,containerStatus.getExitStatus());
  Assert.assertFalse("Process is still alive!",DefaultContainerExecutor.containerIsAlive(pid));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testImmediateKill() throws Exception {
  internalKillTest(false);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testDelayedKill() throws Exception {
  internalKillTest(true);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
