<h3 style="margin:0px">Class: org.apache.hadoop.yarn.client.api.impl.TestAMRMClient (11 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(2)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="20"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('20')" data-toggle="tooltip" title="Verifies values related to public fields."><kbd id="tag-20"class="label-info"style="display: inline-block;font-size:7pt" >PublicFieldVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="19"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('19')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-19"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAMRMClientMatchingFit() throws YarnException, IOException {
  AMRMClient<ContainerRequest> amClient=null;
  try {
    amClient=AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    Resource capability1=Resource.newInstance(1024,2);
    Resource capability2=Resource.newInstance(1024,1);
    Resource capability3=Resource.newInstance(1000,2);
    Resource capability4=Resource.newInstance(2000,1);
    Resource capability5=Resource.newInstance(1000,3);
    Resource capability6=Resource.newInstance(2000,1);
    Resource capability7=Resource.newInstance(2000,1);
    ContainerRequest storedContainer1=new ContainerRequest(capability1,nodes,racks,priority);
    ContainerRequest storedContainer2=new ContainerRequest(capability2,nodes,racks,priority);
    ContainerRequest storedContainer3=new ContainerRequest(capability3,nodes,racks,priority);
    ContainerRequest storedContainer4=new ContainerRequest(capability4,nodes,racks,priority);
    ContainerRequest storedContainer5=new ContainerRequest(capability5,nodes,racks,priority);
    ContainerRequest storedContainer6=new ContainerRequest(capability6,nodes,racks,priority);
    ContainerRequest storedContainer7=new ContainerRequest(capability7,nodes,racks,priority2,false);
    amClient.addContainerRequest(storedContainer1);
    amClient.addContainerRequest(storedContainer2);
    amClient.addContainerRequest(storedContainer3);
    amClient.addContainerRequest(storedContainer4);
    amClient.addContainerRequest(storedContainer5);
    amClient.addContainerRequest(storedContainer6);
    amClient.addContainerRequest(storedContainer7);
    List<? extends Collection<ContainerRequest>> matches;
    ContainerRequest storedRequest;
    Resource testCapability1=Resource.newInstance(1024,2);
    matches=amClient.getMatchingRequests(priority,node,testCapability1);
    verifyMatches(matches,1);
    storedRequest=matches.get(0).iterator().next();
    assertEquals(storedContainer1,storedRequest);
    amClient.removeContainerRequest(storedContainer1);
    Resource testCapability2=Resource.newInstance(2000,1);
    matches=amClient.getMatchingRequests(priority,node,testCapability2);
    verifyMatches(matches,2);
    int i=0;
    for (    ContainerRequest storedRequest1 : matches.get(0)) {
      if (i++ == 0) {
        assertEquals(storedContainer4,storedRequest1);
      }
 else {
        assertEquals(storedContainer6,storedRequest1);
      }
    }
    amClient.removeContainerRequest(storedContainer6);
    Resource testCapability3=Resource.newInstance(4000,4);
    matches=amClient.getMatchingRequests(priority,node,testCapability3);
    assert (matches.size() == 4);
    Resource testCapability4=Resource.newInstance(1024,2);
    matches=amClient.getMatchingRequests(priority,node,testCapability4);
    assert (matches.size() == 2);
    for (    Collection<ContainerRequest> testSet : matches) {
      assertEquals(1,testSet.size());
      ContainerRequest testRequest=testSet.iterator().next();
      assertTrue(testRequest != storedContainer4);
      assertTrue(testRequest != storedContainer5);
      assert (testRequest == storedContainer2 || testRequest == storedContainer3);
    }
    Resource testCapability5=Resource.newInstance(512,4);
    matches=amClient.getMatchingRequests(priority,node,testCapability5);
    assert (matches.size() == 0);
    Resource testCapability7=Resource.newInstance(2000,1);
    matches=amClient.getMatchingRequests(priority2,ResourceRequest.ANY,testCapability7);
    assert (matches.size() == 0);
    matches=amClient.getMatchingRequests(priority2,node,testCapability7);
    assert (matches.size() == 1);
    amClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,null,null);
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<pre class="type-7 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test(timeout=60000) public void testAMRMClient() throws YarnException, IOException {
  AMRMClient<ContainerRequest> amClient=null;
  try {
    amClient=AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.setNMTokenCache(new NMTokenCache());
    Assert.assertNotSame(NMTokenCache.getSingleton(),amClient.getNMTokenCache());
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    testAllocation((AMRMClientImpl<ContainerRequest>)amClient);
    amClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,null,null);
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testWaitFor() throws InterruptedException {
  AMRMClientImpl<ContainerRequest> amClient=null;
  CountDownSupplier countDownChecker=new CountDownSupplier();
  try {
    amClient=(AMRMClientImpl<ContainerRequest>)AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(new YarnConfiguration());
    amClient.start();
    amClient.waitFor(countDownChecker,1000);
    assertEquals(3,countDownChecker.counter);
  }
  finally {
    if (amClient != null) {
      amClient.stop();
    }
  }
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void cancelApp() throws YarnException, IOException {
  yarnClient.killApplication(attemptId.getApplicationId());
  attemptId=null;
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void tearDown(){
  if (yarnClient != null && yarnClient.getServiceState() == STATE.STARTED) {
    yarnClient.stop();
  }
  if (yarnCluster != null && yarnCluster.getServiceState() == STATE.STARTED) {
    yarnCluster.stop();
  }
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void startApp() throws Exception {
  ApplicationSubmissionContext appContext=yarnClient.createApplication().getApplicationSubmissionContext();
  ApplicationId appId=appContext.getApplicationId();
  appContext.setApplicationName("Test");
  Priority pri=Records.newRecord(Priority.class);
  pri.setPriority(0);
  appContext.setPriority(pri);
  appContext.setQueue("default");
  ContainerLaunchContext amContainer=BuilderUtils.newContainerLaunchContext(Collections.<String,LocalResource>emptyMap(),new HashMap<String,String>(),Arrays.asList("sleep","100"),new HashMap<String,ByteBuffer>(),null,new HashMap<ApplicationAccessType,String>());
  appContext.setAMContainerSpec(amContainer);
  appContext.setResource(Resource.newInstance(1024,1));
  SubmitApplicationRequest appRequest=Records.newRecord(SubmitApplicationRequest.class);
  appRequest.setApplicationSubmissionContext(appContext);
  yarnClient.submitApplication(appContext);
  RMAppAttempt appAttempt=null;
  while (true) {
    ApplicationReport appReport=yarnClient.getApplicationReport(appId);
    if (appReport.getYarnApplicationState() == YarnApplicationState.ACCEPTED) {
      attemptId=appReport.getCurrentApplicationAttemptId();
      appAttempt=yarnCluster.getResourceManager().getRMContext().getRMApps().get(attemptId.getApplicationId()).getCurrentAppAttempt();
      while (true) {
        if (appAttempt.getAppAttemptState() == RMAppAttemptState.LAUNCHED) {
          break;
        }
      }
      break;
    }
  }
  UserGroupInformation.setLoginUser(UserGroupInformation.createRemoteUser(UserGroupInformation.getCurrentUser().getUserName()));
  UserGroupInformation.getCurrentUser().addToken(appAttempt.getAMRMToken());
}

</code></pre>

<pre class="type-9 type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAllocationWithBlacklist() throws YarnException, IOException {
  AMRMClientImpl<ContainerRequest> amClient=null;
  try {
    amClient=(AMRMClientImpl<ContainerRequest>)AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    assertEquals(0,amClient.ask.size());
    assertEquals(0,amClient.release.size());
    ContainerRequest storedContainer1=new ContainerRequest(capability,nodes,racks,priority);
    amClient.addContainerRequest(storedContainer1);
    assertEquals(3,amClient.ask.size());
    assertEquals(0,amClient.release.size());
    List<String> localNodeBlacklist=new ArrayList<String>();
    localNodeBlacklist.add(node);
    amClient.updateBlacklist(localNodeBlacklist,null);
    int allocatedContainerCount=getAllocatedContainersNumber(amClient,DEFAULT_ITERATION);
    assertEquals(0,allocatedContainerCount);
    amClient.updateBlacklist(null,localNodeBlacklist);
    ContainerRequest storedContainer2=new ContainerRequest(capability,nodes,racks,priority);
    amClient.addContainerRequest(storedContainer2);
    allocatedContainerCount=getAllocatedContainersNumber(amClient,DEFAULT_ITERATION);
    assertEquals(2,allocatedContainerCount);
    assertTrue(amClient.blacklistAdditions.isEmpty());
    assertTrue(amClient.blacklistRemovals.isEmpty());
    ContainerRequest invalidContainerRequest=new ContainerRequest(Resource.newInstance(-1024,1),nodes,racks,priority);
    amClient.addContainerRequest(invalidContainerRequest);
    amClient.updateBlacklist(localNodeBlacklist,null);
    try {
      amClient.allocate(0.1f);
      fail("there should be an exception here.");
    }
 catch (    Exception e) {
      assertEquals(1,amClient.blacklistAdditions.size());
    }
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testAMRMClientWithBlacklist() throws YarnException, IOException {
  AMRMClientImpl<ContainerRequest> amClient=null;
  try {
    amClient=(AMRMClientImpl<ContainerRequest>)AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    String[] nodes={"node1","node2","node3"};
    List<String> nodeList01=new ArrayList<String>();
    nodeList01.add(nodes[0]);
    nodeList01.add(nodes[1]);
    amClient.updateBlacklist(nodeList01,null);
    assertEquals(2,amClient.blacklistAdditions.size());
    assertEquals(0,amClient.blacklistRemovals.size());
    List<String> nodeList02=new ArrayList<String>();
    nodeList02.add(nodes[0]);
    nodeList02.add(nodes[2]);
    amClient.updateBlacklist(nodeList02,null);
    assertEquals(3,amClient.blacklistAdditions.size());
    assertEquals(0,amClient.blacklistRemovals.size());
    List<String> nodeList12=new ArrayList<String>();
    nodeList12.add(nodes[1]);
    nodeList12.add(nodes[2]);
    amClient.updateBlacklist(null,nodeList12);
    assertEquals(1,amClient.blacklistAdditions.size());
    assertEquals(2,amClient.blacklistRemovals.size());
    List<String> nodeList1=new ArrayList<String>();
    nodeList1.add(nodes[1]);
    amClient.updateBlacklist(nodeList1,null);
    assertEquals(2,amClient.blacklistAdditions.size());
    assertEquals(1,amClient.blacklistRemovals.size());
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<pre class="type-2 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAMRMClientOnAMRMTokenRollOver() throws YarnException, IOException {
  AMRMClient<ContainerRequest> amClient=null;
  try {
    AMRMTokenSecretManager amrmTokenSecretManager=yarnCluster.getResourceManager().getRMContext().getAMRMTokenSecretManager();
    amClient=AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(conf);
    amClient.start();
    Long startTime=System.currentTimeMillis();
    amClient.registerApplicationMaster("Host",10000,"");
    org.apache.hadoop.security.token.Token<AMRMTokenIdentifier> amrmToken_1=getAMRMToken();
    Assert.assertNotNull(amrmToken_1);
    Assert.assertEquals(amrmToken_1.decodeIdentifier().getKeyId(),amrmTokenSecretManager.getMasterKey().getMasterKey().getKeyId());
    while (System.currentTimeMillis() - startTime < rolling_interval_sec * 1000) {
      amClient.allocate(0.1f);
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
    }
    amClient.allocate(0.1f);
    org.apache.hadoop.security.token.Token<AMRMTokenIdentifier> amrmToken_2=getAMRMToken();
    Assert.assertNotNull(amrmToken_2);
    Assert.assertEquals(amrmToken_2.decodeIdentifier().getKeyId(),amrmTokenSecretManager.getMasterKey().getMasterKey().getKeyId());
    Assert.assertNotEquals(amrmToken_1,amrmToken_2);
    amClient.allocate(0.1f);
    while (true) {
      if (amrmToken_2.decodeIdentifier().getKeyId() != amrmTokenSecretManager.getCurrnetMasterKeyData().getMasterKey().getKeyId()) {
        if (amrmTokenSecretManager.getNextMasterKeyData() == null) {
          break;
        }
 else         if (amrmToken_2.decodeIdentifier().getKeyId() != amrmTokenSecretManager.getNextMasterKeyData().getMasterKey().getKeyId()) {
          break;
        }
      }
      amClient.allocate(0.1f);
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException e) {
      }
    }
    try {
      UserGroupInformation testUser=UserGroupInformation.createRemoteUser("testUser");
      SecurityUtil.setTokenService(amrmToken_2,yarnCluster.getResourceManager().getApplicationMasterService().getBindAddress());
      testUser.addToken(amrmToken_2);
      testUser.doAs(new PrivilegedAction<ApplicationMasterProtocol>(){
        @Override public ApplicationMasterProtocol run(){
          return (ApplicationMasterProtocol)YarnRPC.create(conf).getProxy(ApplicationMasterProtocol.class,yarnCluster.getResourceManager().getApplicationMasterService().getBindAddress(),conf);
        }
      }
).allocate(Records.newRecord(AllocateRequest.class));
      Assert.fail("The old Token should not work");
    }
 catch (    Exception ex) {
      Assert.assertTrue(ex instanceof InvalidToken);
      Assert.assertTrue(ex.getMessage().contains("Invalid AMRMToken from " + amrmToken_2.decodeIdentifier().getApplicationAttemptId()));
    }
    amClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,null,null);
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAMRMClientMatchingFitInferredRack() throws YarnException, IOException {
  AMRMClientImpl<ContainerRequest> amClient=null;
  try {
    amClient=new AMRMClientImpl<ContainerRequest>();
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    Resource capability=Resource.newInstance(1024,2);
    ContainerRequest storedContainer1=new ContainerRequest(capability,nodes,null,priority);
    amClient.addContainerRequest(storedContainer1);
    List<? extends Collection<ContainerRequest>> matches;
    ContainerRequest storedRequest;
    matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,1);
    storedRequest=matches.get(0).iterator().next();
    assertEquals(storedContainer1,storedRequest);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    verifyMatches(matches,1);
    storedRequest=matches.get(0).iterator().next();
    assertEquals(storedContainer1,storedRequest);
    amClient.removeContainerRequest(storedContainer1);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    assertTrue(matches.isEmpty());
    amClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,null,null);
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<pre class="type-9 type-13 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAMRMClientMatchStorage() throws YarnException, IOException {
  AMRMClientImpl<ContainerRequest> amClient=null;
  try {
    amClient=(AMRMClientImpl<ContainerRequest>)AMRMClient.<ContainerRequest>createAMRMClient();
    amClient.init(conf);
    amClient.start();
    amClient.registerApplicationMaster("Host",10000,"");
    Priority priority1=Records.newRecord(Priority.class);
    priority1.setPriority(2);
    ContainerRequest storedContainer1=new ContainerRequest(capability,nodes,racks,priority);
    ContainerRequest storedContainer2=new ContainerRequest(capability,nodes,racks,priority);
    ContainerRequest storedContainer3=new ContainerRequest(capability,null,null,priority1);
    amClient.addContainerRequest(storedContainer1);
    amClient.addContainerRequest(storedContainer2);
    amClient.addContainerRequest(storedContainer3);
    int containersRequestedAny=amClient.remoteRequestsTable.get(priority).get(ResourceRequest.ANY).get(capability).remoteRequest.getNumContainers();
    assertEquals(2,containersRequestedAny);
    containersRequestedAny=amClient.remoteRequestsTable.get(priority1).get(ResourceRequest.ANY).get(capability).remoteRequest.getNumContainers();
    assertEquals(1,containersRequestedAny);
    List<? extends Collection<ContainerRequest>> matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority,ResourceRequest.ANY,capability);
    verifyMatches(matches,2);
    matches=amClient.getMatchingRequests(priority1,rack,capability);
    assertTrue(matches.isEmpty());
    matches=amClient.getMatchingRequests(priority1,ResourceRequest.ANY,capability);
    verifyMatches(matches,1);
    amClient.removeContainerRequest(storedContainer3);
    matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,2);
    amClient.removeContainerRequest(storedContainer2);
    matches=amClient.getMatchingRequests(priority,node,capability);
    verifyMatches(matches,1);
    matches=amClient.getMatchingRequests(priority,rack,capability);
    verifyMatches(matches,1);
    ContainerRequest storedRequest=matches.get(0).iterator().next();
    assertEquals(storedContainer1,storedRequest);
    amClient.removeContainerRequest(storedContainer1);
    matches=amClient.getMatchingRequests(priority,ResourceRequest.ANY,capability);
    assertTrue(matches.isEmpty());
    matches=amClient.getMatchingRequests(priority1,ResourceRequest.ANY,capability);
    assertTrue(matches.isEmpty());
    assertTrue(amClient.remoteRequestsTable.isEmpty());
    amClient.addContainerRequest(storedContainer1);
    amClient.addContainerRequest(storedContainer3);
    int allocatedContainerCount=0;
    int iterationsLeft=3;
    while (allocatedContainerCount < 2 && iterationsLeft-- > 0) {
      Log.info(" == alloc " + allocatedContainerCount + " it left "+ iterationsLeft);
      AllocateResponse allocResponse=amClient.allocate(0.1f);
      assertEquals(0,amClient.ask.size());
      assertEquals(0,amClient.release.size());
      assertEquals(nodeCount,amClient.getClusterNodeCount());
      allocatedContainerCount+=allocResponse.getAllocatedContainers().size();
      for (      Container container : allocResponse.getAllocatedContainers()) {
        ContainerRequest expectedRequest=container.getPriority().equals(storedContainer1.getPriority()) ? storedContainer1 : storedContainer3;
        matches=amClient.getMatchingRequests(container.getPriority(),ResourceRequest.ANY,container.getResource());
        verifyMatches(matches,1);
        ContainerRequest matchedRequest=matches.get(0).iterator().next();
        assertEquals(matchedRequest,expectedRequest);
        amClient.removeContainerRequest(matchedRequest);
        amClient.releaseAssignedContainer(container.getId());
      }
      if (allocatedContainerCount < containersRequestedAny) {
        sleep(100);
      }
    }
    assertEquals(2,allocatedContainerCount);
    AllocateResponse allocResponse=amClient.allocate(0.1f);
    assertEquals(0,amClient.release.size());
    assertEquals(0,amClient.ask.size());
    assertEquals(0,allocResponse.getAllocatedContainers().size());
    assertTrue(amClient.remoteRequestsTable.isEmpty());
    amClient.unregisterApplicationMaster(FinalApplicationStatus.SUCCEEDED,null,null);
  }
  finally {
    if (amClient != null && amClient.getServiceState() == STATE.STARTED) {
      amClient.stop();
    }
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
