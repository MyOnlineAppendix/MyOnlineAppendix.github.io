<h3 style="margin:0px">Class: org.apache.hadoop.hdfs.TestDFSShell (31 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(19)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(19)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(18)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(15)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(8)</kbd></button>&nbsp;<button id="21"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('21')" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements"><kbd id="tag-21"class="label-info"style="display: inline-block;font-size:7pt" >ConditionMatcher&nbsp;(3)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testFilePermissions() throws IOException {
  Configuration conf=new HdfsConfiguration();
  FileSystem fs=FileSystem.getLocal(conf);
  testChmod(conf,fs,(new File(TEST_ROOT_DIR,"chmodTest")).getAbsolutePath());
  conf.set(DFSConfigKeys.DFS_PERMISSIONS_ENABLED_KEY,"true");
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  fs=cluster.getFileSystem();
  testChmod(conf,fs,"/tmp/chmodTest");
  FsShell shell=new FsShell();
  shell.setConf(conf);
  fs=cluster.getFileSystem();
  String file="/tmp/chownTest";
  Path path=new Path(file);
  Path parent=new Path("/tmp");
  Path root=new Path("/");
  TestDFSShell.writeFile(fs,path);
  runCmd(shell,"-chgrp","-R","herbivores","/*","unknownFile*");
  confirmOwner(null,"herbivores",fs,parent,path);
  runCmd(shell,"-chgrp","mammals",file);
  confirmOwner(null,"mammals",fs,path);
  runCmd(shell,"-chown","-R",":reptiles","/");
  confirmOwner(null,"reptiles",fs,root,parent,path);
  runCmd(shell,"-chown","python:","/nonExistentFile",file);
  confirmOwner("python","reptiles",fs,path);
  runCmd(shell,"-chown","-R","hadoop:toys","unknownFile","/");
  confirmOwner("hadoop","toys",fs,root,parent,path);
  runCmd(shell,"-chown","hdfs.user",file);
  confirmOwner("hdfs.user",null,fs,path);
  runCmd(shell,"-chown","_Hdfs.User-10:_hadoop.users--",file);
  confirmOwner("_Hdfs.User-10","_hadoop.users--",fs,path);
  runCmd(shell,"-chown","hdfs/hadoop-core@apache.org:asf-projects",file);
  confirmOwner("hdfs/hadoop-core@apache.org","asf-projects",fs,path);
  runCmd(shell,"-chgrp","hadoop-core@apache.org/100",file);
  confirmOwner(null,"hadoop-core@apache.org/100",fs,path);
  cluster.shutdown();
}

</code></pre>

<pre class="type-9 type-7 type-10 type-21 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testAppendToFile() throws Exception {
  final int inputFileLength=1024 * 1024;
  File testRoot=new File(TEST_ROOT_DIR,"testAppendtoFileDir");
  testRoot.mkdirs();
  File file1=new File(testRoot,"file1");
  File file2=new File(testRoot,"file2");
  createLocalFileWithRandomData(inputFileLength,file1);
  createLocalFileWithRandomData(inputFileLength,file2);
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  cluster.waitActive();
  try {
    FileSystem dfs=cluster.getFileSystem();
    assertTrue("Not a HDFS: " + dfs.getUri(),dfs instanceof DistributedFileSystem);
    Path remoteFile=new Path("/remoteFile");
    FsShell shell=new FsShell();
    shell.setConf(conf);
    String[] argv=new String[]{"-appendToFile",file1.toString(),file2.toString(),remoteFile.toString()};
    int res=ToolRunner.run(shell,argv);
    assertThat(res,is(0));
    assertThat(dfs.getFileStatus(remoteFile).getLen(),is((long)inputFileLength * 2));
    res=ToolRunner.run(shell,argv);
    assertThat(res,is(0));
    assertThat(dfs.getFileStatus(remoteFile).getLen(),is((long)inputFileLength * 4));
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testGet() throws IOException {
  DFSTestUtil.setLogLevel2All(FSInputChecker.LOG);
  final String fname="testGet.txt";
  Path root=new Path("/test/get");
  final Path remotef=new Path(root,fname);
  final Configuration conf=new HdfsConfiguration();
  conf.setInt(DFSConfigKeys.DFS_CLIENT_RETRY_WINDOW_BASE,10);
  TestGetRunner runner=new TestGetRunner(){
    private int count=0;
    private final FsShell shell=new FsShell(conf);
    public String run(    int exitcode,    String... options) throws IOException {
      String dst=new File(TEST_ROOT_DIR,fname + ++count).getAbsolutePath();
      String[] args=new String[options.length + 3];
      args[0]="-get";
      args[args.length - 2]=remotef.toString();
      args[args.length - 1]=dst;
      for (int i=0; i < options.length; i++) {
        args[i + 1]=options[i];
      }
      show("args=" + Arrays.asList(args));
      try {
        assertEquals(exitcode,shell.run(args));
      }
 catch (      Exception e) {
        assertTrue(StringUtils.stringifyException(e),false);
      }
      return exitcode == 0 ? DFSTestUtil.readFile(new File(dst)) : null;
    }
  }
;
  File localf=createLocalFile(new File(TEST_ROOT_DIR,fname));
  MiniDFSCluster cluster=null;
  DistributedFileSystem dfs=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).format(true).build();
    dfs=cluster.getFileSystem();
    mkdir(dfs,root);
    dfs.copyFromLocalFile(false,false,new Path(localf.getPath()),remotef);
    String localfcontent=DFSTestUtil.readFile(localf);
    assertEquals(localfcontent,runner.run(0));
    assertEquals(localfcontent,runner.run(0,"-ignoreCrc"));
    List<File> files=getBlockFiles(cluster);
    dfs.close();
    cluster.shutdown();
    show("files=" + files);
    corrupt(files);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).format(false).build();
    dfs=cluster.getFileSystem();
    assertEquals(null,runner.run(1));
    String corruptedcontent=runner.run(0,"-ignoreCrc");
    assertEquals(localfcontent.substring(1),corruptedcontent.substring(1));
    assertEquals(localfcontent.charAt(0) + 1,corruptedcontent.charAt(0));
  }
  finally {
    if (null != dfs) {
      try {
        dfs.close();
      }
 catch (      Exception e) {
      }
    }
    if (null != cluster) {
      cluster.shutdown();
    }
    localf.delete();
  }
}

</code></pre>

<pre class="type-9 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to make sure that user namespace xattrs can be set only if path has
 * access and for sticky directorries, only owner/privileged user can write.
 * Trusted namespace xattrs can be set only with privileged users.
 * As user1: Create a directory (/foo) as user1, chown it to user1 (and
 * user1's group), grant rwx to "other".
 * As user2: Set an xattr (should pass with path access).
 * As user1: Set an xattr (should pass).
 * As user2: Read the xattr (should pass). Remove the xattr (should pass with
 * path access).
 * As user1: Read the xattr (should pass). Remove the xattr (should pass).
 * As user1: Change permissions only to owner
 * As User2: Set an Xattr (Should fail set with no path access) Remove an
 * Xattr (Should fail with no path access)
 * As SuperUser: Set an Xattr with Trusted (Should pass)
 */
@Test(timeout=30000) public void testSetXAttrPermissionAsDifferentOwner() throws Exception {
  final String USER1="user1";
  final String GROUP1="supergroup";
  final UserGroupInformation user1=UserGroupInformation.createUserForTesting(USER1,new String[]{GROUP1});
  final UserGroupInformation user2=UserGroupInformation.createUserForTesting("user2",new String[]{"mygroup2"});
  final UserGroupInformation SUPERUSER=UserGroupInformation.getCurrentUser();
  MiniDFSCluster cluster=null;
  PrintStream bak=null;
  try {
    final Configuration conf=new HdfsConfiguration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    final FileSystem fs=cluster.getFileSystem();
    fs.setOwner(new Path("/"),USER1,GROUP1);
    bak=System.err;
    final FsShell fshell=new FsShell(conf);
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    System.setErr(new PrintStream(out));
    user1.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        final int ret=ToolRunner.run(fshell,new String[]{"-mkdir","/foo"});
        assertEquals("Return should be 0",0,ret);
        out.reset();
        return null;
      }
    }
);
    user1.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        final int ret=ToolRunner.run(fshell,new String[]{"-chmod","707","/foo"});
        assertEquals("Return should be 0",0,ret);
        out.reset();
        return null;
      }
    }
);
    user2.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        final int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-n","user.a1","-v","1234","/foo"});
        assertEquals("Returned should be 0",0,ret);
        out.reset();
        return null;
      }
    }
);
    user1.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        final int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-n","user.a1","-v","1234","/foo"});
        assertEquals("Returned should be 0",0,ret);
        out.reset();
        return null;
      }
    }
);
    user2.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        int ret=ToolRunner.run(fshell,new String[]{"-getfattr","-n","user.a1","/foo"});
        assertEquals("Returned should be 0",0,ret);
        out.reset();
        ret=ToolRunner.run(fshell,new String[]{"-setfattr","-x","user.a1","/foo"});
        assertEquals("Returned should be 0",0,ret);
        out.reset();
        return null;
      }
    }
);
    user1.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        return null;
      }
    }
);
    user1.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        final int ret=ToolRunner.run(fshell,new String[]{"-chmod","700","/foo"});
        assertEquals("Return should be 0",0,ret);
        out.reset();
        return null;
      }
    }
);
    user2.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-n","user.a2","/foo"});
        assertEquals("Returned should be 1",1,ret);
        final String str=out.toString();
        assertTrue("Permission denied printed",str.indexOf("Permission denied") != -1);
        out.reset();
        return null;
      }
    }
);
    user2.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-x","user.a2","/foo"});
        assertEquals("Returned should be 1",1,ret);
        final String str=out.toString();
        assertTrue("Permission denied printed",str.indexOf("Permission denied") != -1);
        out.reset();
        return null;
      }
    }
);
    SUPERUSER.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-n","trusted.a3","/foo"});
        assertEquals("Returned should be 0",0,ret);
        out.reset();
        return null;
      }
    }
);
  }
  finally {
    if (bak != null) {
      System.setErr(bak);
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that server trash configuration is respected even when the
 * client configuration is set.
 */
@Test(timeout=30000) public void testServerConfigRespectedWithClient() throws Exception {
  deleteFileUsingTrash(true,true);
}

</code></pre>

<pre class="type-9 type-7 type-10 type-21 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testAppendToFileBadArgs() throws Exception {
  final int inputFileLength=1024 * 1024;
  File testRoot=new File(TEST_ROOT_DIR,"testAppendToFileBadArgsDir");
  testRoot.mkdirs();
  File file1=new File(testRoot,"file1");
  createLocalFileWithRandomData(inputFileLength,file1);
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  cluster.waitActive();
  try {
    FileSystem dfs=cluster.getFileSystem();
    assertTrue("Not a HDFS: " + dfs.getUri(),dfs instanceof DistributedFileSystem);
    FsShell shell=new FsShell();
    shell.setConf(conf);
    String[] argv=new String[]{"-appendToFile",file1.toString()};
    int res=ToolRunner.run(shell,argv);
    assertThat(res,not(0));
    Path remoteFile=new Path("/remoteFile");
    argv=new String[]{"-appendToFile",file1.toString(),"-",remoteFile.toString()};
    res=ToolRunner.run(shell,argv);
    assertThat(res,not(0));
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testRecursiveRm() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  assertTrue("Not a HDFS: " + fs.getUri(),fs instanceof DistributedFileSystem);
  try {
    fs.mkdirs(new Path(new Path("parent"),"child"));
    try {
      fs.delete(new Path("parent"),false);
      assert (false);
    }
 catch (    IOException e) {
    }
    try {
      fs.delete(new Path("parent"),true);
    }
 catch (    IOException e) {
      assert (false);
    }
  }
  finally {
    try {
      fs.close();
    }
 catch (    IOException e) {
    }
    ;
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that the client trash configuration is respected when
 * the server configuration is not set.
 */
@Test(timeout=30000) public void testClientConfigRespected() throws Exception {
  deleteFileUsingTrash(false,true);
}

</code></pre>

<pre class="type-9 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testPut() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  assertTrue("Not a HDFS: " + fs.getUri(),fs instanceof DistributedFileSystem);
  final DistributedFileSystem dfs=(DistributedFileSystem)fs;
  try {
    new File(TEST_ROOT_DIR,".f1.crc").delete();
    new File(TEST_ROOT_DIR,".f2.crc").delete();
    final File f1=createLocalFile(new File(TEST_ROOT_DIR,"f1"));
    final File f2=createLocalFile(new File(TEST_ROOT_DIR,"f2"));
    final Path root=mkdir(dfs,new Path("/test/put"));
    final Path dst=new Path(root,"dst");
    show("begin");
    final Thread copy2ndFileThread=new Thread(){
      @Override public void run(){
        try {
          show("copy local " + f2 + " to remote "+ dst);
          dfs.copyFromLocalFile(false,false,new Path(f2.getPath()),dst);
        }
 catch (        IOException ioe) {
          show("good " + StringUtils.stringifyException(ioe));
          return;
        }
        assertTrue(false);
      }
    }
;
    SecurityManager sm=System.getSecurityManager();
    System.out.println("SecurityManager = " + sm);
    System.setSecurityManager(new SecurityManager(){
      private boolean firstTime=true;
      @Override public void checkPermission(      Permission perm){
        if (firstTime) {
          Thread t=Thread.currentThread();
          if (!t.toString().contains("DataNode")) {
            String s="" + Arrays.asList(t.getStackTrace());
            if (s.contains("FileUtil.copyContent")) {
              firstTime=false;
              copy2ndFileThread.start();
              try {
                Thread.sleep(5000);
              }
 catch (              InterruptedException e) {
              }
            }
          }
        }
      }
    }
);
    show("copy local " + f1 + " to remote "+ dst);
    dfs.copyFromLocalFile(false,false,new Path(f1.getPath()),dst);
    show("done");
    try {
      copy2ndFileThread.join();
    }
 catch (    InterruptedException e) {
    }
    System.setSecurityManager(sm);
    final Path destmultiple=mkdir(dfs,new Path("/test/putmultiple"));
    Path[] srcs=new Path[2];
    srcs[0]=new Path(f1.getPath());
    srcs[1]=new Path(f2.getPath());
    dfs.copyFromLocalFile(false,false,srcs,destmultiple);
    srcs[0]=new Path(destmultiple,"f1");
    srcs[1]=new Path(destmultiple,"f2");
    assertTrue(dfs.exists(srcs[0]));
    assertTrue(dfs.exists(srcs[1]));
    final Path destmultiple2=mkdir(dfs,new Path("/test/movemultiple"));
    srcs[0]=new Path(f1.getPath());
    srcs[1]=new Path(f2.getPath());
    dfs.moveFromLocalFile(srcs,destmultiple2);
    assertFalse(f1.exists());
    assertFalse(f2.exists());
    srcs[0]=new Path(destmultiple2,"f1");
    srcs[1]=new Path(destmultiple2,"f2");
    assertTrue(dfs.exists(srcs[0]));
    assertTrue(dfs.exists(srcs[1]));
    f1.delete();
    f2.delete();
  }
  finally {
    try {
      dfs.close();
    }
 catch (    Exception e) {
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testDu() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  DistributedFileSystem fs=cluster.getFileSystem();
  PrintStream psBackup=System.out;
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  PrintStream psOut=new PrintStream(out);
  System.setOut(psOut);
  FsShell shell=new FsShell();
  shell.setConf(conf);
  try {
    Path myPath=new Path("/test/dir");
    assertTrue(fs.mkdirs(myPath));
    assertTrue(fs.exists(myPath));
    Path myFile=new Path("/test/dir/file");
    writeFile(fs,myFile);
    assertTrue(fs.exists(myFile));
    Path myFile2=new Path("/test/dir/file2");
    writeFile(fs,myFile2);
    assertTrue(fs.exists(myFile2));
    String[] args=new String[2];
    args[0]="-du";
    args[1]="/test/dir";
    int val=-1;
    try {
      val=shell.run(args);
    }
 catch (    Exception e) {
      System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
    }
    assertTrue(val == 0);
    String returnString=out.toString();
    out.reset();
    assertTrue(returnString.contains("22"));
    assertTrue(returnString.contains("23"));
  }
  finally {
    System.setOut(psBackup);
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testURIPaths() throws Exception {
  Configuration srcConf=new HdfsConfiguration();
  Configuration dstConf=new HdfsConfiguration();
  MiniDFSCluster srcCluster=null;
  MiniDFSCluster dstCluster=null;
  File bak=new File(PathUtils.getTestDir(getClass()),"dfs_tmp_uri");
  bak.mkdirs();
  try {
    srcCluster=new MiniDFSCluster.Builder(srcConf).numDataNodes(2).build();
    dstConf.set(MiniDFSCluster.HDFS_MINIDFS_BASEDIR,bak.getAbsolutePath());
    dstCluster=new MiniDFSCluster.Builder(dstConf).numDataNodes(2).build();
    FileSystem srcFs=srcCluster.getFileSystem();
    FileSystem dstFs=dstCluster.getFileSystem();
    FsShell shell=new FsShell();
    shell.setConf(srcConf);
    String[] argv=new String[2];
    argv[0]="-ls";
    argv[1]=dstFs.getUri().toString() + "/";
    int ret=ToolRunner.run(shell,argv);
    assertEquals("ls works on remote uri ",0,ret);
    dstFs.mkdirs(new Path("/hadoopdir"));
    argv=new String[2];
    argv[0]="-rmr";
    argv[1]=dstFs.getUri().toString() + "/hadoopdir";
    ret=ToolRunner.run(shell,argv);
    assertEquals("-rmr works on remote uri " + argv[1],0,ret);
    argv[0]="-du";
    argv[1]=dstFs.getUri().toString() + "/";
    ret=ToolRunner.run(shell,argv);
    assertEquals("du works on remote uri ",0,ret);
    File furi=new File(TEST_ROOT_DIR,"furi");
    createLocalFile(furi);
    argv=new String[3];
    argv[0]="-put";
    argv[1]=furi.toURI().toString();
    argv[2]=dstFs.getUri().toString() + "/furi";
    ret=ToolRunner.run(shell,argv);
    assertEquals(" put is working ",0,ret);
    argv[0]="-cp";
    argv[1]=dstFs.getUri().toString() + "/furi";
    argv[2]=srcFs.getUri().toString() + "/furi";
    ret=ToolRunner.run(shell,argv);
    assertEquals(" cp is working ",0,ret);
    assertTrue(srcFs.exists(new Path("/furi")));
    argv=new String[2];
    argv[0]="-cat";
    argv[1]=dstFs.getUri().toString() + "/furi";
    ret=ToolRunner.run(shell,argv);
    assertEquals(" cat is working ",0,ret);
    dstFs.delete(new Path("/furi"),true);
    dstFs.delete(new Path("/hadoopdir"),true);
    String file="/tmp/chownTest";
    Path path=new Path(file);
    Path parent=new Path("/tmp");
    Path root=new Path("/");
    TestDFSShell.writeFile(dstFs,path);
    runCmd(shell,"-chgrp","-R","herbivores",dstFs.getUri().toString() + "/*");
    confirmOwner(null,"herbivores",dstFs,parent,path);
    runCmd(shell,"-chown","-R",":reptiles",dstFs.getUri().toString() + "/");
    confirmOwner(null,"reptiles",dstFs,root,parent,path);
    argv[0]="-cat";
    argv[1]="hdfs:///furi";
    ret=ToolRunner.run(shell,argv);
    assertEquals(" default works for cat",0,ret);
    argv[0]="-ls";
    argv[1]="hdfs:///";
    ret=ToolRunner.run(shell,argv);
    assertEquals("default works for ls ",0,ret);
    argv[0]="-rmr";
    argv[1]="hdfs:///furi";
    ret=ToolRunner.run(shell,argv);
    assertEquals("default works for rm/rmr",0,ret);
  }
  finally {
    if (null != srcCluster) {
      srcCluster.shutdown();
    }
    if (null != dstCluster) {
      dstCluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testSetXAttrCaseSensitivity() throws Exception {
  UserGroupInformation user=UserGroupInformation.createUserForTesting("user",new String[]{"mygroup"});
  MiniDFSCluster cluster=null;
  PrintStream bak=null;
  try {
    final Configuration conf=new HdfsConfiguration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    FileSystem fs=cluster.getFileSystem();
    Path p=new Path("/mydir");
    fs.mkdirs(p);
    bak=System.err;
    final FsShell fshell=new FsShell(conf);
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    System.setOut(new PrintStream(out));
    doSetXattr(out,fshell,new String[]{"-setfattr","-n","User.Foo","/mydir"},new String[]{"-getfattr","-d","/mydir"},new String[]{"user.Foo"},new String[]{});
    doSetXattr(out,fshell,new String[]{"-setfattr","-n","user.FOO","/mydir"},new String[]{"-getfattr","-d","/mydir"},new String[]{"user.Foo","user.FOO"},new String[]{});
    doSetXattr(out,fshell,new String[]{"-setfattr","-n","USER.foo","/mydir"},new String[]{"-getfattr","-d","/mydir"},new String[]{"user.Foo","user.FOO","user.foo"},new String[]{});
    doSetXattr(out,fshell,new String[]{"-setfattr","-n","USER.fOo","-v","myval","/mydir"},new String[]{"-getfattr","-d","/mydir"},new String[]{"user.Foo","user.FOO","user.foo","user.fOo=\"myval\""},new String[]{"user.Foo=","user.FOO=","user.foo="});
    doSetXattr(out,fshell,new String[]{"-setfattr","-x","useR.foo","/mydir"},new String[]{"-getfattr","-d","/mydir"},new String[]{"user.Foo","user.FOO"},new String[]{"foo"});
    doSetXattr(out,fshell,new String[]{"-setfattr","-x","USER.FOO","/mydir"},new String[]{"-getfattr","-d","/mydir"},new String[]{"user.Foo"},new String[]{"FOO"});
    doSetXattr(out,fshell,new String[]{"-setfattr","-x","useR.Foo","/mydir"},new String[]{"-getfattr","-n","User.Foo","/mydir"},new String[]{},new String[]{"Foo"});
  }
  finally {
    if (bak != null) {
      System.setOut(bak);
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests various options of DFSShell.
 */
@Test(timeout=120000) public void testDFSShell() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  assertTrue("Not a HDFS: " + fs.getUri(),fs instanceof DistributedFileSystem);
  DistributedFileSystem fileSys=(DistributedFileSystem)fs;
  FsShell shell=new FsShell();
  shell.setConf(conf);
  try {
    Path myPath=new Path("/test/mkdirs");
    assertTrue(fileSys.mkdirs(myPath));
    assertTrue(fileSys.exists(myPath));
    assertTrue(fileSys.mkdirs(myPath));
    Path myFile=new Path("/test/mkdirs/myFile");
    writeFile(fileSys,myFile);
    assertTrue(fileSys.exists(myFile));
    Path myFile2=new Path("/test/mkdirs/myFile2");
    writeFile(fileSys,myFile2);
    assertTrue(fileSys.exists(myFile2));
{
      String[] args=new String[2];
      args[0]="-rm";
      args[1]="/test/mkdirs/myFile*";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertTrue(val == 0);
      assertFalse(fileSys.exists(myFile));
      assertFalse(fileSys.exists(myFile2));
      writeFile(fileSys,myFile);
      assertTrue(fileSys.exists(myFile));
      writeFile(fileSys,myFile2);
      assertTrue(fileSys.exists(myFile2));
    }
{
      String[] args=new String[3];
      args[0]="-cat";
      args[1]="/test/mkdirs/myFile";
      args[2]="/test/mkdirs/myFile2";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run: " + StringUtils.stringifyException(e));
      }
      assertTrue(val == 0);
    }
    fileSys.delete(myFile2,true);
{
      String[] args=new String[2];
      args[0]="-cat";
      args[1]="/test/mkdirs/myFile1";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertTrue(val != 0);
    }
{
      String[] args=new String[2];
      args[0]="-rm";
      args[1]="/test/mkdirs/myFile1";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertTrue(val != 0);
    }
{
      String[] args=new String[2];
      args[0]="-rm";
      args[1]="/test/mkdirs/myFile";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertTrue(val == 0);
    }
{
      String[] args;
      int val;
      args=new String[3];
      args[0]="-test";
      args[1]="-e";
      args[2]="/test/mkdirs/noFileHere";
      val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
      args[1]="-z";
      val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
      args=new String[2];
      args[0]="-touchz";
      args[1]="/test/mkdirs/isFileHere";
      val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(0,val);
      args=new String[2];
      args[0]="-touchz";
      args[1]="/test/mkdirs/thisDirNotExists/isFileHere";
      val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
      args=new String[3];
      args[0]="-test";
      args[1]="-e";
      args[2]="/test/mkdirs/isFileHere";
      val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(0,val);
      args[1]="-d";
      val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
      args[1]="-z";
      val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(0,val);
    }
{
      String[] args=new String[2];
      args[0]="-mkdir";
      args[1]="/test/dir1";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(0,val);
      String[] args1=new String[3];
      args1[0]="-cp";
      args1[1]="/test/dir1";
      args1[2]="/test/dir1/dir2";
      val=0;
      try {
        val=shell.run(args1);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
      args1[0]="-cp";
      args1[1]="/test/dir1";
      args1[2]="/test/dir1foo";
      val=-1;
      try {
        val=shell.run(args1);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(0,val);
    }
{
      String[] args=new String[3];
      args[0]="-test";
      args[1]="-f";
      args[2]="/test/mkdirs/noFileHere";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
    }
{
      String[] args=new String[3];
      args[0]="-test";
      args[1]="-f";
      args[2]="/test/mkdirs";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
    }
{
      writeFile(fileSys,myFile);
      assertTrue(fileSys.exists(myFile));
      String[] args=new String[3];
      args[0]="-test";
      args[1]="-f";
      args[2]=myFile.toString();
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(0,val);
    }
{
      String[] args=new String[3];
      args[0]="-test";
      args[1]="-s";
      args[2]="/test/mkdirs/noFileHere";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
    }
{
      String[] args=new String[3];
      args[0]="-test";
      args[1]="-s";
      args[2]="/test/mkdirs/isFileHere";
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(1,val);
    }
{
      String[] args=new String[3];
      args[0]="-test";
      args[1]="-s";
      args[2]=myFile.toString();
      int val=-1;
      try {
        val=shell.run(args);
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      assertEquals(0,val);
    }
  }
  finally {
    try {
      fileSys.close();
    }
 catch (    Exception e) {
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that trash is disabled by default.
 */
@Test(timeout=30000) public void testNoTrashConfig() throws Exception {
  deleteFileUsingTrash(false,false);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * default setting is file:// which is not a DFS
 * so DFSAdmin should throw and catch InvalidArgumentException
 * and return -1 exit code.
 * @throws Exception
 */
@Test(timeout=30000) public void testInvalidShell() throws Exception {
  Configuration conf=new Configuration();
  DFSAdmin admin=new DFSAdmin();
  admin.setConf(conf);
  int res=admin.run(new String[]{"-refreshNodes"});
  assertEquals("expected to fail -1",res,-1);
}

</code></pre>

<pre class="type-9 type-7 type-21 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
"></span><br>
@Test(timeout=30000) public void testSetrep() throws Exception {
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).format(true).build();
  FsShell shell=null;
  FileSystem fs=null;
  final String testdir1="/tmp/TestDFSShell-testSetrep-" + counter.getAndIncrement();
  final String testdir2=testdir1 + "/nestedDir";
  final Path hdfsFile1=new Path(testdir1,"testFileForSetrep");
  final Path hdfsFile2=new Path(testdir2,"testFileForSetrep");
  final Short oldRepFactor=new Short((short)1);
  final Short newRepFactor=new Short((short)3);
  try {
    String[] argv;
    cluster.waitActive();
    fs=cluster.getFileSystem();
    assertThat(fs.mkdirs(new Path(testdir2)),is(true));
    shell=new FsShell(conf);
    fs.create(hdfsFile1,true).close();
    fs.create(hdfsFile2,true).close();
    argv=new String[]{"-setrep",newRepFactor.toString(),hdfsFile1.toString()};
    assertThat(shell.run(argv),is(SUCCESS));
    assertThat(fs.getFileStatus(hdfsFile1).getReplication(),is(newRepFactor));
    assertThat(fs.getFileStatus(hdfsFile2).getReplication(),is(oldRepFactor));
    argv=new String[]{"-setrep",newRepFactor.toString(),testdir1};
    assertThat(shell.run(argv),is(SUCCESS));
    assertThat(fs.getFileStatus(hdfsFile1).getReplication(),is(newRepFactor));
    assertThat(fs.getFileStatus(hdfsFile2).getReplication(),is(newRepFactor));
  }
  finally {
    if (shell != null) {
      shell.close();
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testSetXAttrPermission() throws Exception {
  UserGroupInformation user=UserGroupInformation.createUserForTesting("user",new String[]{"mygroup"});
  MiniDFSCluster cluster=null;
  PrintStream bak=null;
  try {
    final Configuration conf=new HdfsConfiguration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    FileSystem fs=cluster.getFileSystem();
    Path p=new Path("/foo");
    fs.mkdirs(p);
    bak=System.err;
    final FsShell fshell=new FsShell(conf);
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    System.setErr(new PrintStream(out));
    fs.setPermission(p,new FsPermission((short)0700));
    user.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-n","user.a1","-v","1234","/foo"});
        assertEquals("Returned should be 1",1,ret);
        String str=out.toString();
        assertTrue("Permission denied printed",str.indexOf("Permission denied") != -1);
        out.reset();
        return null;
      }
    }
);
    int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-n","user.a1","-v","1234","/foo"});
    assertEquals("Returned should be 0",0,ret);
    out.reset();
    fs.setPermission(p,new FsPermission((short)0750));
    user.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        int ret=ToolRunner.run(fshell,new String[]{"-getfattr","-n","user.a1","/foo"});
        assertEquals("Returned should be 1",1,ret);
        String str=out.toString();
        assertTrue("Permission denied printed",str.indexOf("Permission denied") != -1);
        out.reset();
        ret=ToolRunner.run(fshell,new String[]{"-setfattr","-x","user.a1","/foo"});
        assertEquals("Returned should be 1",1,ret);
        str=out.toString();
        assertTrue("Permission denied printed",str.indexOf("Permission denied") != -1);
        out.reset();
        return null;
      }
    }
);
  }
  finally {
    if (bak != null) {
      System.setErr(bak);
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testCount() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  DistributedFileSystem dfs=cluster.getFileSystem();
  FsShell shell=new FsShell();
  shell.setConf(conf);
  try {
    String root=createTree(dfs,"count");
    runCount(root,2,4,shell);
    runCount(root + "2",2,1,shell);
    runCount(root + "2/f1",0,1,shell);
    runCount(root + "2/sub",1,0,shell);
    final FileSystem localfs=FileSystem.getLocal(conf);
    Path localpath=new Path(TEST_ROOT_DIR,"testcount");
    localpath=localpath.makeQualified(localfs.getUri(),localfs.getWorkingDirectory());
    localfs.mkdirs(localpath);
    final String localstr=localpath.toString();
    System.out.println("localstr=" + localstr);
    runCount(localstr,1,0,shell);
    assertEquals(0,runCmd(shell,"-count",root,localstr));
  }
  finally {
    try {
      dfs.close();
    }
 catch (    Exception e) {
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testCopyCommandsWithForceOption() throws Exception {
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).format(true).build();
  FsShell shell=null;
  FileSystem fs=null;
  final File localFile=new File(TEST_ROOT_DIR,"testFileForPut");
  final String localfilepath=new Path(localFile.getAbsolutePath()).toUri().toString();
  final String testdir="/tmp/TestDFSShell-testCopyCommandsWithForceOption-" + counter.getAndIncrement();
  final Path hdfsTestDir=new Path(testdir);
  try {
    fs=cluster.getFileSystem();
    fs.mkdirs(hdfsTestDir);
    localFile.createNewFile();
    writeFile(fs,new Path(testdir,"testFileForPut"));
    shell=new FsShell();
    String[] argv=new String[]{"-put","-f",localfilepath,testdir};
    int res=ToolRunner.run(shell,argv);
    assertEquals("put -f is not working",SUCCESS,res);
    argv=new String[]{"-put",localfilepath,testdir};
    res=ToolRunner.run(shell,argv);
    assertEquals("put command itself is able to overwrite the file",ERROR,res);
    argv=new String[]{"-copyFromLocal","-f",localfilepath,testdir};
    res=ToolRunner.run(shell,argv);
    assertEquals("copyFromLocal -f is not working",SUCCESS,res);
    argv=new String[]{"-copyFromLocal",localfilepath,testdir};
    res=ToolRunner.run(shell,argv);
    assertEquals("copyFromLocal command itself is able to overwrite the file",ERROR,res);
    argv=new String[]{"-cp","-f",localfilepath,testdir};
    res=ToolRunner.run(shell,argv);
    assertEquals("cp -f is not working",SUCCESS,res);
    argv=new String[]{"-cp",localfilepath,testdir};
    res=ToolRunner.run(shell,argv);
    assertEquals("cp command itself is able to overwrite the file",ERROR,res);
  }
  finally {
    if (null != shell)     shell.close();
    if (localFile.exists())     localFile.delete();
    if (null != fs) {
      fs.delete(hdfsTestDir,true);
      fs.close();
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testRemoteException() throws Exception {
  UserGroupInformation tmpUGI=UserGroupInformation.createUserForTesting("tmpname",new String[]{"mygroup"});
  MiniDFSCluster dfs=null;
  PrintStream bak=null;
  try {
    final Configuration conf=new HdfsConfiguration();
    dfs=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
    FileSystem fs=dfs.getFileSystem();
    Path p=new Path("/foo");
    fs.mkdirs(p);
    fs.setPermission(p,new FsPermission((short)0700));
    bak=System.err;
    tmpUGI.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        FsShell fshell=new FsShell(conf);
        ByteArrayOutputStream out=new ByteArrayOutputStream();
        PrintStream tmp=new PrintStream(out);
        System.setErr(tmp);
        String[] args=new String[2];
        args[0]="-ls";
        args[1]="/foo";
        int ret=ToolRunner.run(fshell,args);
        assertEquals("returned should be 1",1,ret);
        String str=out.toString();
        assertTrue("permission denied printed",str.indexOf("Permission denied") != -1);
        out.reset();
        return null;
      }
    }
);
  }
  finally {
    if (bak != null) {
      System.setErr(bak);
    }
    if (dfs != null) {
      dfs.shutdown();
    }
  }
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testZeroSizeFile() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  assertTrue("Not a HDFS: " + fs.getUri(),fs instanceof DistributedFileSystem);
  final DistributedFileSystem dfs=(DistributedFileSystem)fs;
  try {
    final File f1=new File(TEST_ROOT_DIR,"f1");
    assertTrue(!f1.exists());
    assertTrue(f1.createNewFile());
    assertTrue(f1.exists());
    assertTrue(f1.isFile());
    assertEquals(0L,f1.length());
    final Path root=mkdir(dfs,new Path("/test/zeroSizeFile"));
    final Path remotef=new Path(root,"dst");
    show("copy local " + f1 + " to remote "+ remotef);
    dfs.copyFromLocalFile(false,false,new Path(f1.getPath()),remotef);
    show("Block size = " + dfs.getFileStatus(remotef).getBlockSize());
    final File f2=new File(TEST_ROOT_DIR,"f2");
    assertTrue(!f2.exists());
    dfs.copyToLocalFile(remotef,new Path(f2.getPath()));
    assertTrue(f2.exists());
    assertTrue(f2.isFile());
    assertEquals(0L,f2.length());
    f1.delete();
    f2.delete();
  }
  finally {
    try {
      dfs.close();
    }
 catch (    Exception e) {
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * check command error outputs and exit statuses. 
 */
@Test(timeout=30000) public void testErrOutPut() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  PrintStream bak=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
    FileSystem srcFs=cluster.getFileSystem();
    Path root=new Path("/nonexistentfile");
    bak=System.err;
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    PrintStream tmp=new PrintStream(out);
    System.setErr(tmp);
    String[] argv=new String[2];
    argv[0]="-cat";
    argv[1]=root.toUri().getPath();
    int ret=ToolRunner.run(new FsShell(),argv);
    assertEquals(" -cat returned 1 ",1,ret);
    String returned=out.toString();
    assertTrue("cat does not print exceptions ",(returned.lastIndexOf("Exception") == -1));
    out.reset();
    argv[0]="-rm";
    argv[1]=root.toString();
    FsShell shell=new FsShell();
    shell.setConf(conf);
    ret=ToolRunner.run(shell,argv);
    assertEquals(" -rm returned 1 ",1,ret);
    returned=out.toString();
    out.reset();
    assertTrue("rm prints reasonable error ",(returned.lastIndexOf("No such file or directory") != -1));
    argv[0]="-rmr";
    argv[1]=root.toString();
    ret=ToolRunner.run(shell,argv);
    assertEquals(" -rmr returned 1",1,ret);
    returned=out.toString();
    assertTrue("rmr prints reasonable error ",(returned.lastIndexOf("No such file or directory") != -1));
    out.reset();
    argv[0]="-du";
    argv[1]="/nonexistentfile";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertTrue(" -du prints reasonable error ",(returned.lastIndexOf("No such file or directory") != -1));
    out.reset();
    argv[0]="-dus";
    argv[1]="/nonexistentfile";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertTrue(" -dus prints reasonable error",(returned.lastIndexOf("No such file or directory") != -1));
    out.reset();
    argv[0]="-ls";
    argv[1]="/nonexistenfile";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertTrue(" -ls does not return Found 0 items",(returned.lastIndexOf("Found 0") == -1));
    out.reset();
    argv[0]="-ls";
    argv[1]="/nonexistentfile";
    ret=ToolRunner.run(shell,argv);
    assertEquals(" -lsr should fail ",1,ret);
    out.reset();
    srcFs.mkdirs(new Path("/testdir"));
    argv[0]="-ls";
    argv[1]="/testdir";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertTrue(" -ls does not print out anything ",(returned.lastIndexOf("Found 0") == -1));
    out.reset();
    argv[0]="-ls";
    argv[1]="/user/nonxistant/*";
    ret=ToolRunner.run(shell,argv);
    assertEquals(" -ls on nonexistent glob returns 1",1,ret);
    out.reset();
    argv[0]="-mkdir";
    argv[1]="/testdir";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertEquals(" -mkdir returned 1 ",1,ret);
    assertTrue(" -mkdir returned File exists",(returned.lastIndexOf("File exists") != -1));
    Path testFile=new Path("/testfile");
    OutputStream outtmp=srcFs.create(testFile);
    outtmp.write(testFile.toString().getBytes());
    outtmp.close();
    out.reset();
    argv[0]="-mkdir";
    argv[1]="/testfile";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertEquals(" -mkdir returned 1",1,ret);
    assertTrue(" -mkdir returned this is a file ",(returned.lastIndexOf("not a directory") != -1));
    out.reset();
    argv=new String[3];
    argv[0]="-mv";
    argv[1]="/testfile";
    argv[2]="file";
    ret=ToolRunner.run(shell,argv);
    assertEquals("mv failed to rename",1,ret);
    out.reset();
    argv=new String[3];
    argv[0]="-mv";
    argv[1]="/testfile";
    argv[2]="/testfiletest";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertTrue("no output from rename",(returned.lastIndexOf("Renamed") == -1));
    out.reset();
    argv[0]="-mv";
    argv[1]="/testfile";
    argv[2]="/testfiletmp";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertTrue(" unix like output",(returned.lastIndexOf("No such file or") != -1));
    out.reset();
    argv=new String[1];
    argv[0]="-du";
    srcFs.mkdirs(srcFs.getHomeDirectory());
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertEquals(" no error ",0,ret);
    assertTrue("empty path specified",(returned.lastIndexOf("empty string") == -1));
    out.reset();
    argv=new String[3];
    argv[0]="-test";
    argv[1]="-d";
    argv[2]="/no/such/dir";
    ret=ToolRunner.run(shell,argv);
    returned=out.toString();
    assertEquals(" -test -d wrong result ",1,ret);
    assertTrue(returned.isEmpty());
  }
  finally {
    if (bak != null) {
      System.setErr(bak);
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testCopyToLocal() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  assertTrue("Not a HDFS: " + fs.getUri(),fs instanceof DistributedFileSystem);
  DistributedFileSystem dfs=(DistributedFileSystem)fs;
  FsShell shell=new FsShell();
  shell.setConf(conf);
  try {
    String root=createTree(dfs,"copyToLocal");
{
      try {
        assertEquals(0,runCmd(shell,"-copyToLocal",root + "*",TEST_ROOT_DIR));
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      File localroot=new File(TEST_ROOT_DIR,"copyToLocal");
      File localroot2=new File(TEST_ROOT_DIR,"copyToLocal2");
      File f1=new File(localroot,"f1");
      assertTrue("Copying failed.",f1.isFile());
      File f2=new File(localroot,"f2");
      assertTrue("Copying failed.",f2.isFile());
      File sub=new File(localroot,"sub");
      assertTrue("Copying failed.",sub.isDirectory());
      File f3=new File(sub,"f3");
      assertTrue("Copying failed.",f3.isFile());
      File f4=new File(sub,"f4");
      assertTrue("Copying failed.",f4.isFile());
      File f5=new File(localroot2,"f1");
      assertTrue("Copying failed.",f5.isFile());
      f1.delete();
      f2.delete();
      f3.delete();
      f4.delete();
      f5.delete();
      sub.delete();
    }
{
      String[] args={"-copyToLocal","nosuchfile",TEST_ROOT_DIR};
      try {
        assertEquals(1,shell.run(args));
      }
 catch (      Exception e) {
        System.err.println("Exception raised from DFSShell.run " + e.getLocalizedMessage());
      }
      File f6=new File(TEST_ROOT_DIR,"nosuchfile");
      assertTrue(!f6.exists());
    }
  }
  finally {
    try {
      dfs.close();
    }
 catch (    Exception e) {
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=120000) public void testCopyCommandsToDirectoryWithPreserveOption() throws Exception {
  Configuration conf=new Configuration();
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_XATTRS_ENABLED_KEY,true);
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_ACLS_ENABLED_KEY,true);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).format(true).build();
  FsShell shell=null;
  FileSystem fs=null;
  final String testdir="/tmp/TestDFSShell-testCopyCommandsToDirectoryWithPreserveOption-" + counter.getAndIncrement();
  final Path hdfsTestDir=new Path(testdir);
  try {
    fs=cluster.getFileSystem();
    fs.mkdirs(hdfsTestDir);
    Path srcDir=new Path(hdfsTestDir,"srcDir");
    fs.mkdirs(srcDir);
    fs.setAcl(srcDir,Lists.newArrayList(aclEntry(ACCESS,USER,ALL),aclEntry(ACCESS,USER,"foo",ALL),aclEntry(ACCESS,GROUP,READ_EXECUTE),aclEntry(DEFAULT,GROUP,"bar",READ_EXECUTE),aclEntry(ACCESS,OTHER,EXECUTE)));
    fs.setPermission(srcDir,new FsPermission(ALL,READ_EXECUTE,EXECUTE,true));
    Path srcFile=new Path(srcDir,"srcFile");
    fs.create(srcFile).close();
    FileStatus status=fs.getFileStatus(srcDir);
    final long mtime=status.getModificationTime();
    final long atime=status.getAccessTime();
    final String owner=status.getOwner();
    final String group=status.getGroup();
    final FsPermission perm=status.getPermission();
    fs.setXAttr(srcDir,USER_A1,USER_A1_VALUE);
    fs.setXAttr(srcDir,TRUSTED_A1,TRUSTED_A1_VALUE);
    shell=new FsShell(conf);
    Path targetDir1=new Path(hdfsTestDir,"targetDir1");
    String[] argv=new String[]{"-cp","-p",srcDir.toUri().toString(),targetDir1.toUri().toString()};
    int ret=ToolRunner.run(shell,argv);
    assertEquals("cp -p is not working",SUCCESS,ret);
    FileStatus targetStatus=fs.getFileStatus(targetDir1);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    FsPermission targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    Map<String,byte[]> xattrs=fs.getXAttrs(targetDir1);
    assertTrue(xattrs.isEmpty());
    List<AclEntry> acls=fs.getAclStatus(targetDir1).getEntries();
    assertTrue(acls.isEmpty());
    assertFalse(targetPerm.getAclBit());
    Path targetDir2=new Path(hdfsTestDir,"targetDir2");
    argv=new String[]{"-cp","-ptop",srcDir.toUri().toString(),targetDir2.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptop is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(targetDir2);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(targetDir2);
    assertTrue(xattrs.isEmpty());
    acls=fs.getAclStatus(targetDir2).getEntries();
    assertTrue(acls.isEmpty());
    assertFalse(targetPerm.getAclBit());
    Path targetDir3=new Path(hdfsTestDir,"targetDir3");
    argv=new String[]{"-cp","-ptopx",srcDir.toUri().toString(),targetDir3.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptopx is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(targetDir3);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(targetDir3);
    assertEquals(xattrs.size(),2);
    assertArrayEquals(USER_A1_VALUE,xattrs.get(USER_A1));
    assertArrayEquals(TRUSTED_A1_VALUE,xattrs.get(TRUSTED_A1));
    acls=fs.getAclStatus(targetDir3).getEntries();
    assertTrue(acls.isEmpty());
    assertFalse(targetPerm.getAclBit());
    Path targetDir4=new Path(hdfsTestDir,"targetDir4");
    argv=new String[]{"-cp","-ptopa",srcDir.toUri().toString(),targetDir4.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptopa is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(targetDir4);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(targetDir4);
    assertTrue(xattrs.isEmpty());
    acls=fs.getAclStatus(targetDir4).getEntries();
    assertFalse(acls.isEmpty());
    assertTrue(targetPerm.getAclBit());
    assertEquals(fs.getAclStatus(srcDir),fs.getAclStatus(targetDir4));
    Path targetDir5=new Path(hdfsTestDir,"targetDir5");
    argv=new String[]{"-cp","-ptoa",srcDir.toUri().toString(),targetDir5.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptoa is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(targetDir5);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(targetDir5);
    assertTrue(xattrs.isEmpty());
    acls=fs.getAclStatus(targetDir5).getEntries();
    assertFalse(acls.isEmpty());
    assertTrue(targetPerm.getAclBit());
    assertEquals(fs.getAclStatus(srcDir),fs.getAclStatus(targetDir5));
  }
  finally {
    if (shell != null) {
      shell.close();
    }
    if (fs != null) {
      fs.delete(hdfsTestDir,true);
      fs.close();
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=120000) public void testCopyCommandsPreserveAclAndStickyBit() throws Exception {
  Configuration conf=new Configuration();
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_ACLS_ENABLED_KEY,true);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).format(true).build();
  FsShell shell=null;
  FileSystem fs=null;
  final String testdir="/tmp/TestDFSShell-testCopyCommandsPreserveAclAndStickyBit-" + counter.getAndIncrement();
  final Path hdfsTestDir=new Path(testdir);
  try {
    fs=cluster.getFileSystem();
    fs.mkdirs(hdfsTestDir);
    Path src=new Path(hdfsTestDir,"srcfile");
    fs.create(src).close();
    fs.setAcl(src,Lists.newArrayList(aclEntry(ACCESS,USER,ALL),aclEntry(ACCESS,USER,"foo",ALL),aclEntry(ACCESS,GROUP,READ_EXECUTE),aclEntry(ACCESS,GROUP,"bar",READ_EXECUTE),aclEntry(ACCESS,OTHER,EXECUTE)));
    fs.setPermission(src,new FsPermission(ALL,READ_EXECUTE,EXECUTE,true));
    FileStatus status=fs.getFileStatus(src);
    final long mtime=status.getModificationTime();
    final long atime=status.getAccessTime();
    final String owner=status.getOwner();
    final String group=status.getGroup();
    final FsPermission perm=status.getPermission();
    shell=new FsShell(conf);
    Path target1=new Path(hdfsTestDir,"targetfile1");
    String[] argv=new String[]{"-cp","-p",src.toUri().toString(),target1.toUri().toString()};
    int ret=ToolRunner.run(shell,argv);
    assertEquals("cp is not working",SUCCESS,ret);
    FileStatus targetStatus=fs.getFileStatus(target1);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    FsPermission targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    List<AclEntry> acls=fs.getAclStatus(target1).getEntries();
    assertTrue(acls.isEmpty());
    assertFalse(targetPerm.getAclBit());
    Path target2=new Path(hdfsTestDir,"targetfile2");
    argv=new String[]{"-cp","-ptopa",src.toUri().toString(),target2.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptopa is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(target2);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    acls=fs.getAclStatus(target2).getEntries();
    assertFalse(acls.isEmpty());
    assertTrue(targetPerm.getAclBit());
    assertEquals(fs.getAclStatus(src),fs.getAclStatus(target2));
  }
  finally {
    if (null != shell) {
      shell.close();
    }
    if (null != fs) {
      fs.delete(hdfsTestDir,true);
      fs.close();
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testText() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
    final FileSystem dfs=cluster.getFileSystem();
    textTest(new Path("/texttest").makeQualified(dfs.getUri(),dfs.getWorkingDirectory()),conf);
    conf.set("fs.defaultFS",dfs.getUri().toString());
    final FileSystem lfs=FileSystem.getLocal(conf);
    textTest(new Path(TEST_ROOT_DIR,"texttest").makeQualified(lfs.getUri(),lfs.getWorkingDirectory()),conf);
  }
  finally {
    if (null != cluster) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=120000) public void testCopyCommandsWithRawXAttrs() throws Exception {
  final Configuration conf=new Configuration();
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_XATTRS_ENABLED_KEY,true);
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).format(true).build();
  FsShell shell=null;
  FileSystem fs=null;
  final String testdir="/tmp/TestDFSShell-testCopyCommandsWithRawXAttrs-" + counter.getAndIncrement();
  final Path hdfsTestDir=new Path(testdir);
  final Path rawHdfsTestDir=new Path("/.reserved/raw" + testdir);
  try {
    fs=cluster.getFileSystem();
    fs.mkdirs(hdfsTestDir);
    final Path src=new Path(hdfsTestDir,"srcfile");
    final String rawSrcBase="/.reserved/raw" + testdir;
    final Path rawSrc=new Path(rawSrcBase,"srcfile");
    fs.create(src).close();
    final Path srcDir=new Path(hdfsTestDir,"srcdir");
    final Path rawSrcDir=new Path("/.reserved/raw" + testdir,"srcdir");
    fs.mkdirs(srcDir);
    final Path srcDirFile=new Path(srcDir,"srcfile");
    final Path rawSrcDirFile=new Path("/.reserved/raw" + srcDirFile);
    fs.create(srcDirFile).close();
    final Path[] paths={rawSrc,rawSrcDir,rawSrcDirFile};
    final String[] xattrNames={USER_A1,RAW_A1};
    final byte[][] xattrVals={USER_A1_VALUE,RAW_A1_VALUE};
    for (int i=0; i < paths.length; i++) {
      for (int j=0; j < xattrNames.length; j++) {
        fs.setXAttr(paths[i],xattrNames[j],xattrVals[j]);
      }
    }
    shell=new FsShell(conf);
    doTestCopyCommandsWithRawXAttrs(shell,fs,src,hdfsTestDir,false);
    doTestCopyCommandsWithRawXAttrs(shell,fs,rawSrc,hdfsTestDir,false);
    doTestCopyCommandsWithRawXAttrs(shell,fs,src,rawHdfsTestDir,false);
    doTestCopyCommandsWithRawXAttrs(shell,fs,rawSrc,rawHdfsTestDir,true);
    final Path savedWd=fs.getWorkingDirectory();
    try {
      fs.setWorkingDirectory(new Path(rawSrcBase));
      final Path relRawSrc=new Path("../srcfile");
      final Path relRawHdfsTestDir=new Path("..");
      doTestCopyCommandsWithRawXAttrs(shell,fs,relRawSrc,relRawHdfsTestDir,true);
    }
  finally {
      fs.setWorkingDirectory(savedWd);
    }
    doTestCopyCommandsWithRawXAttrs(shell,fs,srcDir,hdfsTestDir,false);
    doTestCopyCommandsWithRawXAttrs(shell,fs,rawSrcDir,hdfsTestDir,false);
    doTestCopyCommandsWithRawXAttrs(shell,fs,srcDir,rawHdfsTestDir,false);
    doTestCopyCommandsWithRawXAttrs(shell,fs,rawSrcDir,rawHdfsTestDir,true);
    final String relRawSrcDir="./.reserved/../.reserved/raw/../raw" + testdir + "/srcdir";
    final String relRawDstDir="./.reserved/../.reserved/raw/../raw" + testdir;
    doTestCopyCommandsWithRawXAttrs(shell,fs,new Path(relRawSrcDir),new Path(relRawDstDir),true);
  }
  finally {
    if (null != shell) {
      shell.close();
    }
    if (null != fs) {
      fs.delete(hdfsTestDir,true);
      fs.close();
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that the server trash configuration is respected when
 * the client configuration is not set.
 */
@Test(timeout=30000) public void testServerConfigRespected() throws Exception {
  deleteFileUsingTrash(true,false);
}

</code></pre>

<pre class="type-9 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=120000) public void testGetFAttrErrors() throws Exception {
  final UserGroupInformation user=UserGroupInformation.createUserForTesting("user",new String[]{"mygroup"});
  MiniDFSCluster cluster=null;
  PrintStream bakErr=null;
  try {
    final Configuration conf=new HdfsConfiguration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    final FileSystem fs=cluster.getFileSystem();
    final Path p=new Path("/foo");
    fs.mkdirs(p);
    bakErr=System.err;
    final FsShell fshell=new FsShell(conf);
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    System.setErr(new PrintStream(out));
    fs.setPermission(p,new FsPermission((short)0700));
{
      final int ret=ToolRunner.run(fshell,new String[]{"-setfattr","-n","user.a1","-v","1234","/foo"});
      assertEquals("Returned should be 0",0,ret);
      out.reset();
    }
    user.doAs(new PrivilegedExceptionAction(){
      @Override public Object run() throws Exception {
        int ret=ToolRunner.run(fshell,new String[]{"-getfattr","-n","user.a1","/foo"});
        String str=out.toString();
        assertTrue("xattr value was incorrectly returned",str.indexOf("1234") == -1);
        out.reset();
        return null;
      }
    }
);
{
      final int ret=ToolRunner.run(fshell,new String[]{"-getfattr","-n","user.nonexistent","/foo"});
      String str=out.toString();
      assertTrue("xattr value was incorrectly returned",str.indexOf("getfattr: At least one of the attributes provided was not found") >= 0);
      out.reset();
    }
  }
  finally {
    if (bakErr != null) {
      System.setErr(bakErr);
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=120000) public void testCopyCommandsWithPreserveOption() throws Exception {
  Configuration conf=new Configuration();
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_XATTRS_ENABLED_KEY,true);
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_ACLS_ENABLED_KEY,true);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).format(true).build();
  FsShell shell=null;
  FileSystem fs=null;
  final String testdir="/tmp/TestDFSShell-testCopyCommandsWithPreserveOption-" + counter.getAndIncrement();
  final Path hdfsTestDir=new Path(testdir);
  try {
    fs=cluster.getFileSystem();
    fs.mkdirs(hdfsTestDir);
    Path src=new Path(hdfsTestDir,"srcfile");
    fs.create(src).close();
    fs.setAcl(src,Lists.newArrayList(aclEntry(ACCESS,USER,ALL),aclEntry(ACCESS,USER,"foo",ALL),aclEntry(ACCESS,GROUP,READ_EXECUTE),aclEntry(ACCESS,GROUP,"bar",READ_EXECUTE),aclEntry(ACCESS,OTHER,EXECUTE)));
    FileStatus status=fs.getFileStatus(src);
    final long mtime=status.getModificationTime();
    final long atime=status.getAccessTime();
    final String owner=status.getOwner();
    final String group=status.getGroup();
    final FsPermission perm=status.getPermission();
    fs.setXAttr(src,USER_A1,USER_A1_VALUE);
    fs.setXAttr(src,TRUSTED_A1,TRUSTED_A1_VALUE);
    shell=new FsShell(conf);
    Path target1=new Path(hdfsTestDir,"targetfile1");
    String[] argv=new String[]{"-cp","-p",src.toUri().toString(),target1.toUri().toString()};
    int ret=ToolRunner.run(shell,argv);
    assertEquals("cp -p is not working",SUCCESS,ret);
    FileStatus targetStatus=fs.getFileStatus(target1);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    FsPermission targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    Map<String,byte[]> xattrs=fs.getXAttrs(target1);
    assertTrue(xattrs.isEmpty());
    List<AclEntry> acls=fs.getAclStatus(target1).getEntries();
    assertTrue(acls.isEmpty());
    assertFalse(targetPerm.getAclBit());
    Path target2=new Path(hdfsTestDir,"targetfile2");
    argv=new String[]{"-cp","-ptop",src.toUri().toString(),target2.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptop is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(target2);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(target2);
    assertTrue(xattrs.isEmpty());
    acls=fs.getAclStatus(target2).getEntries();
    assertTrue(acls.isEmpty());
    assertFalse(targetPerm.getAclBit());
    Path target3=new Path(hdfsTestDir,"targetfile3");
    argv=new String[]{"-cp","-ptopx",src.toUri().toString(),target3.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptopx is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(target3);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(target3);
    assertEquals(xattrs.size(),2);
    assertArrayEquals(USER_A1_VALUE,xattrs.get(USER_A1));
    assertArrayEquals(TRUSTED_A1_VALUE,xattrs.get(TRUSTED_A1));
    acls=fs.getAclStatus(target3).getEntries();
    assertTrue(acls.isEmpty());
    assertFalse(targetPerm.getAclBit());
    Path target4=new Path(hdfsTestDir,"targetfile4");
    argv=new String[]{"-cp","-ptopa",src.toUri().toString(),target4.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptopa is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(target4);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(target4);
    assertTrue(xattrs.isEmpty());
    acls=fs.getAclStatus(target4).getEntries();
    assertFalse(acls.isEmpty());
    assertTrue(targetPerm.getAclBit());
    assertEquals(fs.getAclStatus(src),fs.getAclStatus(target4));
    Path target5=new Path(hdfsTestDir,"targetfile5");
    argv=new String[]{"-cp","-ptoa",src.toUri().toString(),target5.toUri().toString()};
    ret=ToolRunner.run(shell,argv);
    assertEquals("cp -ptoa is not working",SUCCESS,ret);
    targetStatus=fs.getFileStatus(target5);
    assertEquals(mtime,targetStatus.getModificationTime());
    assertEquals(atime,targetStatus.getAccessTime());
    assertEquals(owner,targetStatus.getOwner());
    assertEquals(group,targetStatus.getGroup());
    targetPerm=targetStatus.getPermission();
    assertTrue(perm.equals(targetPerm));
    xattrs=fs.getXAttrs(target5);
    assertTrue(xattrs.isEmpty());
    acls=fs.getAclStatus(target5).getEntries();
    assertFalse(acls.isEmpty());
    assertTrue(targetPerm.getAclBit());
    assertEquals(fs.getAclStatus(src),fs.getAclStatus(target5));
  }
  finally {
    if (null != shell) {
      shell.close();
    }
    if (null != fs) {
      fs.delete(hdfsTestDir,true);
      fs.close();
    }
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testLsr() throws Exception {
  final Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  DistributedFileSystem dfs=cluster.getFileSystem();
  try {
    final String root=createTree(dfs,"lsr");
    dfs.mkdirs(new Path(root,"zzz"));
    runLsr(new FsShell(conf),root,0);
    final Path sub=new Path(root,"sub");
    dfs.setPermission(sub,new FsPermission((short)0));
    final UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
    final String tmpusername=ugi.getShortUserName() + "1";
    UserGroupInformation tmpUGI=UserGroupInformation.createUserForTesting(tmpusername,new String[]{tmpusername});
    String results=tmpUGI.doAs(new PrivilegedExceptionAction<String>(){
      @Override public String run() throws Exception {
        return runLsr(new FsShell(conf),root,1);
      }
    }
);
    assertTrue(results.contains("zzz"));
  }
  finally {
    cluster.shutdown();
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
