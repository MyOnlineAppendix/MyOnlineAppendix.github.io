<h3 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.webapp.TestRMWebServicesAppsModification (10 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Sets implicit assumptions "><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >AssumptionSetter&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetNewApplication() throws Exception {
  rm.start();
  String mediaTypes[]={MediaType.APPLICATION_JSON,MediaType.APPLICATION_XML};
  for (  String acceptMedia : mediaTypes) {
    testGetNewApplication(acceptMedia);
  }
  rm.stop();
  return;
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetNewApplicationAndSubmit() throws Exception {
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  amNodeManager.nodeHeartbeat(true);
  String mediaTypes[]={MediaType.APPLICATION_JSON,MediaType.APPLICATION_XML};
  for (  String acceptMedia : mediaTypes) {
    for (    String contentMedia : mediaTypes) {
      testAppSubmit(acceptMedia,contentMedia);
      testAppSubmitErrors(acceptMedia,contentMedia);
    }
  }
  rm.stop();
  return;
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After @Override public void tearDown() throws Exception {
  if (rm != null) {
    rm.stop();
  }
  super.tearDown();
}

</code></pre>

<pre class="type-9 type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSingleAppKillInvalidState() throws Exception {
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  String[] mediaTypes={MediaType.APPLICATION_JSON,MediaType.APPLICATION_XML};
  MediaType[] contentTypes={MediaType.APPLICATION_JSON_TYPE,MediaType.APPLICATION_XML_TYPE};
  String[] targetStates={YarnApplicationState.FINISHED.toString(),"blah"};
  for (  String mediaType : mediaTypes) {
    for (    MediaType contentType : contentTypes) {
      for (      String targetStateString : targetStates) {
        RMApp app=rm.submitApp(CONTAINER_MB,"",webserviceUserName);
        amNodeManager.nodeHeartbeat(true);
        ClientResponse response;
        AppState targetState=new AppState(targetStateString);
        Object entity;
        if (contentType == MediaType.APPLICATION_JSON_TYPE) {
          entity=appStateToJSON(targetState);
        }
 else {
          entity=targetState;
        }
        response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").entity(entity,contentType).accept(mediaType).put(ClientResponse.class);
        if (!isAuthenticationEnabled()) {
          assertEquals(Status.UNAUTHORIZED,response.getClientResponseStatus());
          continue;
        }
        assertEquals(Status.BAD_REQUEST,response.getClientResponseStatus());
      }
    }
  }
  rm.stop();
  return;
}

</code></pre>

<pre class="type-9 type-13 type-11 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=90000) public void testSingleAppKill() throws Exception {
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  String[] mediaTypes={MediaType.APPLICATION_JSON,MediaType.APPLICATION_XML};
  MediaType[] contentTypes={MediaType.APPLICATION_JSON_TYPE,MediaType.APPLICATION_XML_TYPE};
  for (  String mediaType : mediaTypes) {
    for (    MediaType contentType : contentTypes) {
      RMApp app=rm.submitApp(CONTAINER_MB,"",webserviceUserName);
      amNodeManager.nodeHeartbeat(true);
      ClientResponse response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").accept(mediaType).get(ClientResponse.class);
      AppState targetState=new AppState(YarnApplicationState.KILLED.toString());
      Object entity;
      if (contentType == MediaType.APPLICATION_JSON_TYPE) {
        entity=appStateToJSON(targetState);
      }
 else {
        entity=targetState;
      }
      response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").entity(entity,contentType).accept(mediaType).put(ClientResponse.class);
      if (!isAuthenticationEnabled()) {
        assertEquals(Status.UNAUTHORIZED,response.getClientResponseStatus());
        continue;
      }
      assertEquals(Status.ACCEPTED,response.getClientResponseStatus());
      if (mediaType == MediaType.APPLICATION_JSON) {
        verifyAppStateJson(response,RMAppState.KILLING,RMAppState.ACCEPTED);
      }
 else {
        verifyAppStateXML(response,RMAppState.KILLING,RMAppState.ACCEPTED);
      }
      String locationHeaderValue=response.getHeaders().getFirst(HttpHeaders.LOCATION);
      Client c=Client.create();
      WebResource tmp=c.resource(locationHeaderValue);
      if (isAuthenticationEnabled()) {
        tmp=tmp.queryParam("user.name",webserviceUserName);
      }
      response=tmp.get(ClientResponse.class);
      assertEquals(Status.OK,response.getClientResponseStatus());
      assertTrue(locationHeaderValue.endsWith("/ws/v1/cluster/apps/" + app.getApplicationId().toString() + "/state"));
      while (true) {
        Thread.sleep(100);
        response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").accept(mediaType).entity(entity,contentType).put(ClientResponse.class);
        assertTrue((response.getClientResponseStatus() == Status.ACCEPTED) || (response.getClientResponseStatus() == Status.OK));
        if (response.getClientResponseStatus() == Status.OK) {
          assertEquals(RMAppState.KILLED,app.getState());
          if (mediaType == MediaType.APPLICATION_JSON) {
            verifyAppStateJson(response,RMAppState.KILLED);
          }
 else {
            verifyAppStateXML(response,RMAppState.KILLED);
          }
          break;
        }
      }
    }
  }
  rm.stop();
  return;
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before @Override public void setUp() throws Exception {
  super.setUp();
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSingleAppState() throws Exception {
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  String[] mediaTypes={MediaType.APPLICATION_JSON,MediaType.APPLICATION_XML};
  for (  String mediaType : mediaTypes) {
    RMApp app=rm.submitApp(CONTAINER_MB,"",webserviceUserName);
    amNodeManager.nodeHeartbeat(true);
    ClientResponse response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").accept(mediaType).get(ClientResponse.class);
    assertEquals(Status.OK,response.getClientResponseStatus());
    if (mediaType == MediaType.APPLICATION_JSON) {
      verifyAppStateJson(response,RMAppState.ACCEPTED);
    }
 else     if (mediaType == MediaType.APPLICATION_XML) {
      verifyAppStateXML(response,RMAppState.ACCEPTED);
    }
  }
  rm.stop();
}

</code></pre>

<pre class="type-9 type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSingleAppKillInvalidId() throws Exception {
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  amNodeManager.nodeHeartbeat(true);
  String[] testAppIds={"application_1391705042196_0001","random_string"};
  for (  String testAppId : testAppIds) {
    AppState info=new AppState("KILLED");
    ClientResponse response=this.constructWebResource("apps",testAppId,"state").accept(MediaType.APPLICATION_XML).entity(info,MediaType.APPLICATION_XML).put(ClientResponse.class);
    if (!isAuthenticationEnabled()) {
      assertEquals(Status.UNAUTHORIZED,response.getClientResponseStatus());
      continue;
    }
    assertEquals(Status.NOT_FOUND,response.getClientResponseStatus());
  }
  rm.stop();
  return;
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAppSubmitBadJsonAndXML() throws Exception {
  String urlPath="apps";
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  amNodeManager.nodeHeartbeat(true);
  ApplicationSubmissionContextInfo appInfo=new ApplicationSubmissionContextInfo();
  appInfo.setApplicationName("test");
  appInfo.setPriority(3);
  appInfo.setMaxAppAttempts(2);
  appInfo.setQueue("testqueue");
  appInfo.setApplicationType("test-type");
  HashMap<String,LocalResourceInfo> lr=new HashMap<String,LocalResourceInfo>();
  LocalResourceInfo y=new LocalResourceInfo();
  y.setUrl(new URI("http://www.test.com/file.txt"));
  y.setSize(100);
  y.setTimestamp(System.currentTimeMillis());
  y.setType(LocalResourceType.FILE);
  y.setVisibility(LocalResourceVisibility.APPLICATION);
  lr.put("example",y);
  appInfo.getContainerLaunchContextInfo().setResources(lr);
  appInfo.getResource().setMemory(1024);
  appInfo.getResource().setvCores(1);
  String body="<?xml version=\"1.0\" encoding=\"UTF-8\" " + "standalone=\"yes\"?><blah/>";
  ClientResponse response=this.constructWebResource(urlPath).accept(MediaType.APPLICATION_XML).entity(body,MediaType.APPLICATION_XML).post(ClientResponse.class);
  assertEquals(Status.BAD_REQUEST,response.getClientResponseStatus());
  body="{\"a\" : \"b\"}";
  response=this.constructWebResource(urlPath).accept(MediaType.APPLICATION_XML).entity(body,MediaType.APPLICATION_JSON).post(ClientResponse.class);
  validateResponseStatus(response,Status.BAD_REQUEST);
  rm.stop();
}

</code></pre>

<pre class="type-15 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Sets implicit assumptions 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testSingleAppKillUnauthorized() throws Exception {
  boolean isCapacityScheduler=rm.getResourceScheduler() instanceof CapacityScheduler;
  assumeTrue("Currently this test is only supported on CapacityScheduler",isCapacityScheduler);
  CapacitySchedulerConfiguration csconf=new CapacitySchedulerConfiguration();
  csconf.setAcl("root",QueueACL.ADMINISTER_QUEUE,"someuser");
  csconf.setAcl("root.default",QueueACL.ADMINISTER_QUEUE,"someuser");
  rm.getResourceScheduler().reinitialize(csconf,rm.getRMContext());
  rm.start();
  MockNM amNodeManager=rm.registerNode("127.0.0.1:1234",2048);
  String[] mediaTypes={MediaType.APPLICATION_JSON,MediaType.APPLICATION_XML};
  for (  String mediaType : mediaTypes) {
    RMApp app=rm.submitApp(CONTAINER_MB,"test","someuser");
    amNodeManager.nodeHeartbeat(true);
    ClientResponse response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").accept(mediaType).get(ClientResponse.class);
    AppState info=response.getEntity(AppState.class);
    info.setState(YarnApplicationState.KILLED.toString());
    response=this.constructWebResource("apps",app.getApplicationId().toString(),"state").accept(mediaType).entity(info,MediaType.APPLICATION_XML).put(ClientResponse.class);
    validateResponseStatus(response,Status.FORBIDDEN);
  }
  rm.stop();
  return;
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
