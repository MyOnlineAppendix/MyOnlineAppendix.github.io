<h3 style="margin:0px">Class: org.apache.hadoop.security.TestUserGroupInformation (36 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(21)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(18)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(8)</kbd></button>&nbsp;<button id="19"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('19')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-19"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testProxyLogin() throws IOException {
  tryLoginAuthenticationMethod(AuthenticationMethod.PROXY,false);
}

</code></pre>

<pre class="type-7 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@SuppressWarnings("unchecked") @Test(timeout=30000) public <T extends TokenIdentifier>void testGetCreds() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("someone");
  Text service=new Text("service");
  Token<T> t1=mock(Token.class);
  when(t1.getService()).thenReturn(service);
  Token<T> t2=mock(Token.class);
  when(t2.getService()).thenReturn(new Text("service2"));
  Token<T> t3=mock(Token.class);
  when(t3.getService()).thenReturn(service);
  ugi.addToken(t1);
  ugi.addToken(t2);
  checkTokens(ugi,t1,t2);
  Credentials creds=ugi.getCredentials();
  creds.addToken(t3.getService(),t3);
  assertSame(t3,creds.getToken(service));
  checkTokens(ugi,t1,t2);
}

</code></pre>

<pre class="type-9 type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * given user name - get all the groups.
 * Needs to happen before creating the test users
 */
@Test(timeout=30000) public void testGetServerSideGroups() throws IOException, InterruptedException {
  Process pp=Runtime.getRuntime().exec("whoami");
  BufferedReader br=new BufferedReader(new InputStreamReader(pp.getInputStream()));
  String userName=br.readLine().trim();
  if (Shell.WINDOWS) {
    int sp=userName.lastIndexOf('\\');
    if (sp != -1) {
      userName=userName.substring(sp + 1);
    }
    userName=userName.toLowerCase();
  }
  pp=Runtime.getRuntime().exec(Shell.WINDOWS ? Shell.WINUTILS + " groups -F" : "id -Gn");
  br=new BufferedReader(new InputStreamReader(pp.getInputStream()));
  String line=br.readLine();
  System.out.println(userName + ":" + line);
  Set<String> groups=new LinkedHashSet<String>();
  String[] tokens=line.split(Shell.TOKEN_SEPARATOR_REGEX);
  for (  String s : tokens) {
    groups.add(s);
  }
  final UserGroupInformation login=UserGroupInformation.getCurrentUser();
  String loginUserName=login.getShortUserName();
  if (Shell.WINDOWS) {
    loginUserName=loginUserName.toLowerCase();
  }
  assertEquals(userName,loginUserName);
  String[] gi=login.getGroupNames();
  assertEquals(groups.size(),gi.length);
  for (int i=0; i < gi.length; i++) {
    assertTrue(groups.contains(gi[i]));
  }
  final UserGroupInformation fakeUser=UserGroupInformation.createRemoteUser("foo.bar");
  fakeUser.doAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws IOException {
      UserGroupInformation current=UserGroupInformation.getCurrentUser();
      assertFalse(current.equals(login));
      assertEquals(current,fakeUser);
      assertEquals(0,current.getGroupNames().length);
      return null;
    }
  }
);
}

</code></pre>

<pre class="type-9 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testGetUGIFromSubject() throws Exception {
  KerberosPrincipal p=new KerberosPrincipal("guest");
  Subject subject=new Subject();
  subject.getPrincipals().add(p);
  UserGroupInformation ugi=UserGroupInformation.getUGIFromSubject(subject);
  assertNotNull(ugi);
  assertEquals("guest@DEFAULT.REALM",ugi.getUserName());
}

</code></pre>

<pre class="type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testEnsureInitWithRules() throws IOException {
  String rules="RULE:[1:RULE1]";
  UserGroupInformation.reset();
  assertFalse(KerberosName.hasRulesBeenSet());
  UserGroupInformation.createUserForTesting("someone",new String[0]);
  assertTrue(KerberosName.hasRulesBeenSet());
  UserGroupInformation.reset();
  KerberosName.setRules(rules);
  assertTrue(KerberosName.hasRulesBeenSet());
  assertEquals(rules,KerberosName.getRules());
  UserGroupInformation.createUserForTesting("someone",new String[0]);
  assertEquals(rules,KerberosName.getRules());
}

</code></pre>

<pre class="type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testSetConfigWithRules(){
  String[] rules={"RULE:[1:TEST1]","RULE:[1:TEST2]","RULE:[1:TEST3]"};
  UserGroupInformation.reset();
  assertFalse(KerberosName.hasRulesBeenSet());
  KerberosName.setRules(rules[0]);
  assertTrue(KerberosName.hasRulesBeenSet());
  assertEquals(rules[0],KerberosName.getRules());
  UserGroupInformation.createUserForTesting("someone",new String[0]);
  assertEquals(rules[0],KerberosName.getRules());
  conf.set(HADOOP_SECURITY_AUTH_TO_LOCAL,rules[1]);
  UserGroupInformation.setConfiguration(conf);
  assertEquals(rules[1],KerberosName.getRules());
  conf.set(HADOOP_SECURITY_AUTH_TO_LOCAL,rules[2]);
  UserGroupInformation.setConfiguration(conf);
  assertEquals(rules[2],KerberosName.getRules());
  UserGroupInformation.createUserForTesting("someone",new String[0]);
  assertEquals(rules[2],KerberosName.getRules());
}

</code></pre>

<pre class="type-2 type-7 type-10 type-19 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test(timeout=30000) public <T extends TokenIdentifier>void testUGITokens() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createUserForTesting("TheDoctor",new String[]{"TheTARDIS"});
  Token<T> t1=mock(Token.class);
  when(t1.getService()).thenReturn(new Text("t1"));
  Token<T> t2=mock(Token.class);
  when(t2.getService()).thenReturn(new Text("t2"));
  Credentials creds=new Credentials();
  byte[] secretKey=new byte[]{};
  Text secretName=new Text("shhh");
  creds.addSecretKey(secretName,secretKey);
  ugi.addToken(t1);
  ugi.addToken(t2);
  ugi.addCredentials(creds);
  Collection<Token<? extends TokenIdentifier>> z=ugi.getTokens();
  assertTrue(z.contains(t1));
  assertTrue(z.contains(t2));
  assertEquals(2,z.size());
  Credentials ugiCreds=ugi.getCredentials();
  assertSame(secretKey,ugiCreds.getSecretKey(secretName));
  assertEquals(1,ugiCreds.numberOfSecretKeys());
  try {
    z.remove(t1);
    fail("Shouldn't be able to modify token collection from UGI");
  }
 catch (  UnsupportedOperationException uoe) {
  }
  Collection<Token<? extends TokenIdentifier>> otherSet=ugi.doAs(new PrivilegedExceptionAction<Collection<Token<?>>>(){
    @Override public Collection<Token<?>> run() throws IOException {
      return UserGroupInformation.getCurrentUser().getTokens();
    }
  }
);
  assertTrue(otherSet.contains(t1));
  assertTrue(otherSet.contains(t2));
}

</code></pre>

<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Test hasSufficientTimeElapsed method 
 */
@Test(timeout=30000) public void testHasSufficientTimeElapsed() throws Exception {
  Method method=UserGroupInformation.class.getDeclaredMethod("hasSufficientTimeElapsed",long.class);
  method.setAccessible(true);
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  User user=ugi.getSubject().getPrincipals(User.class).iterator().next();
  long now=System.currentTimeMillis();
  user.setLastLogin(now - 2 * 60 * 1000);
  assertTrue((Boolean)method.invoke(ugi,now));
  user.setLastLogin(now - 30 * 1000);
  assertFalse((Boolean)method.invoke(ugi,now));
  Configuration conf2=new Configuration(conf);
  conf2.setLong(CommonConfigurationKeysPublic.HADOOP_KERBEROS_MIN_SECONDS_BEFORE_RELOGIN,10 * 60);
  UserGroupInformation.setConfiguration(conf2);
  user.setLastLogin(now - 15 * 60 * 1000);
  assertTrue((Boolean)method.invoke(ugi,now));
  user.setLastLogin(now - 6 * 60 * 1000);
  assertFalse((Boolean)method.invoke(ugi,now));
  UserGroupInformation.setConfiguration(conf);
  method.setAccessible(false);
}

</code></pre>

<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testLoginModuleCommit() throws Exception {
  UserGroupInformation loginUgi=UserGroupInformation.getLoginUser();
  User user1=loginUgi.getSubject().getPrincipals(User.class).iterator().next();
  LoginContext login=user1.getLogin();
  login.logout();
  login.login();
  User user2=loginUgi.getSubject().getPrincipals(User.class).iterator().next();
  Assert.assertTrue(user1 == user2);
}

</code></pre>

<pre class="type-7 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@SuppressWarnings("unchecked") @Test(timeout=30000) public <T extends TokenIdentifier>void testAddNamedToken() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("someone");
  Token<T> t1=mock(Token.class);
  Text service1=new Text("t1");
  Text service2=new Text("t2");
  when(t1.getService()).thenReturn(service1);
  ugi.addToken(service1,t1);
  assertSame(t1,ugi.getCredentials().getToken(service1));
  ugi.addToken(service2,t1);
  assertSame(t1,ugi.getCredentials().getToken(service1));
  assertSame(t1,ugi.getCredentials().getToken(service2));
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test login method 
 */
@Test(timeout=30000) public void testLogin() throws Exception {
  conf.set(HADOOP_USER_GROUP_METRICS_PERCENTILES_INTERVALS,String.valueOf(PERCENTILES_INTERVAL));
  UserGroupInformation.setConfiguration(conf);
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  assertEquals(UserGroupInformation.getCurrentUser(),UserGroupInformation.getLoginUser());
  assertTrue(ugi.getGroupNames().length >= 1);
  verifyGroupMetrics(1);
  UserGroupInformation userGroupInfo=UserGroupInformation.createUserForTesting(USER_NAME,GROUP_NAMES);
  UserGroupInformation curUGI=userGroupInfo.doAs(new PrivilegedExceptionAction<UserGroupInformation>(){
    @Override public UserGroupInformation run() throws IOException {
      return UserGroupInformation.getCurrentUser();
    }
  }
);
  assertEquals(curUGI,userGroupInfo);
  assertFalse(curUGI.equals(UserGroupInformation.getLoginUser()));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testTokenLogin() throws IOException {
  tryLoginAuthenticationMethod(AuthenticationMethod.TOKEN,false);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * In some scenario, such as HA, delegation tokens are associated with a
 * logical name. The tokens are cloned and are associated with the
 * physical address of the server where the service is provided.
 * This test ensures cloned delegated tokens are locally used
 * and are not returned in {@link UserGroupInformation#getCredentials()}
 */
@Test public void testPrivateTokenExclusion() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  TestTokenIdentifier tokenId=new TestTokenIdentifier();
  Token<TestTokenIdentifier> token=new Token<TestTokenIdentifier>(tokenId.getBytes(),"password".getBytes(),tokenId.getKind(),null);
  ugi.addToken(new Text("regular-token"),token);
  ugi.addToken(new Text("private-token"),new Token.PrivateToken<TestTokenIdentifier>(token));
  ugi.addToken(new Text("private-token1"),new Token.PrivateToken<TestTokenIdentifier>(token));
  Collection<Token<? extends TokenIdentifier>> tokens=ugi.getCredentials().getAllTokens();
  assertEquals(1,tokens.size());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testGettingGroups() throws Exception {
  UserGroupInformation uugi=UserGroupInformation.createUserForTesting(USER_NAME,GROUP_NAMES);
  assertEquals(USER_NAME,uugi.getUserName());
  assertArrayEquals(new String[]{GROUP1_NAME,GROUP2_NAME,GROUP3_NAME},uugi.getGroupNames());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@SuppressWarnings("unchecked") @Test(timeout=30000) public <T extends TokenIdentifier>void testAddToken() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("someone");
  Token<T> t1=mock(Token.class);
  Token<T> t2=mock(Token.class);
  Token<T> t3=mock(Token.class);
  ugi.addToken(t1);
  checkTokens(ugi,t1);
  ugi.addToken(t2);
  checkTokens(ugi,t2);
  when(t1.getService()).thenReturn(new Text("t1"));
  ugi.addToken(t1);
  checkTokens(ugi,t1,t2);
  when(t3.getService()).thenReturn(new Text("t1"));
  ugi.addToken(t3);
  checkTokens(ugi,t2,t3);
  when(t1.getService()).thenReturn(new Text("t1.1"));
  ugi.addToken(t1);
  checkTokens(ugi,t1,t2,t3);
  ugi.addToken(t1);
  checkTokens(ugi,t1,t2,t3);
}

</code></pre>

<pre class="type-7 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test(timeout=30000) public <T extends TokenIdentifier>void testGetCredsNotSame() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("someone");
  Credentials creds=ugi.getCredentials();
  assertNotSame(creds,ugi.getCredentials());
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setupUgi(){
  conf=new Configuration();
  UserGroupInformation.reset();
  UserGroupInformation.setConfiguration(conf);
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testUGIAuthMethodInRealUser() throws Exception {
  final UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  UserGroupInformation proxyUgi=UserGroupInformation.createProxyUser("proxy",ugi);
  final AuthenticationMethod am=AuthenticationMethod.KERBEROS;
  ugi.setAuthenticationMethod(am);
  Assert.assertEquals(am,ugi.getAuthenticationMethod());
  Assert.assertEquals(AuthenticationMethod.PROXY,proxyUgi.getAuthenticationMethod());
  Assert.assertEquals(am,UserGroupInformation.getRealAuthenticationMethod(proxyUgi));
  proxyUgi.doAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws IOException {
      Assert.assertEquals(AuthenticationMethod.PROXY,UserGroupInformation.getCurrentUser().getAuthenticationMethod());
      Assert.assertEquals(am,UserGroupInformation.getCurrentUser().getRealUser().getAuthenticationMethod());
      return null;
    }
  }
);
  UserGroupInformation proxyUgi2=new UserGroupInformation(proxyUgi.getSubject());
  proxyUgi2.setAuthenticationMethod(AuthenticationMethod.PROXY);
  Assert.assertEquals(proxyUgi,proxyUgi2);
  UserGroupInformation realugi=UserGroupInformation.getCurrentUser();
  UserGroupInformation proxyUgi3=UserGroupInformation.createProxyUser("proxyAnother",realugi);
  UserGroupInformation proxyUgi4=new UserGroupInformation(proxyUgi3.getSubject());
  Assert.assertEquals(proxyUgi3,proxyUgi4);
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testEqualsWithRealUser() throws Exception {
  UserGroupInformation realUgi1=UserGroupInformation.createUserForTesting("RealUser",GROUP_NAMES);
  UserGroupInformation proxyUgi1=UserGroupInformation.createProxyUser(USER_NAME,realUgi1);
  UserGroupInformation proxyUgi2=new UserGroupInformation(proxyUgi1.getSubject());
  UserGroupInformation remoteUgi=UserGroupInformation.createRemoteUser(USER_NAME);
  assertEquals(proxyUgi1,proxyUgi2);
  assertFalse(remoteUgi.equals(proxyUgi1));
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testUGIAuthMethod() throws Exception {
  final UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  final AuthenticationMethod am=AuthenticationMethod.KERBEROS;
  ugi.setAuthenticationMethod(am);
  Assert.assertEquals(am,ugi.getAuthenticationMethod());
  ugi.doAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws IOException {
      Assert.assertEquals(am,UserGroupInformation.getCurrentUser().getAuthenticationMethod());
      return null;
    }
  }
);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
"></span><br>
/** 
 * Test for the case that UserGroupInformation.getCurrentUser()
 * is called when the AccessControlContext has a Subject associated
 * with it, but that Subject was not created by Hadoop (ie it has no
 * associated User principal)
 */
@Test(timeout=30000) public void testUGIUnderNonHadoopContext() throws Exception {
  Subject nonHadoopSubject=new Subject();
  Subject.doAs(nonHadoopSubject,new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws IOException {
      UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
      assertNotNull(ugi);
      return null;
    }
  }
);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * test constructor 
 */
@Test(timeout=30000) public void testConstructorWithKerberosRules() throws Exception {
  SecurityUtil.setAuthenticationMethod(AuthenticationMethod.KERBEROS,conf);
  conf.set(HADOOP_SECURITY_AUTH_TO_LOCAL,"RULE:[2:$1@$0](.*@OTHER.REALM)s/(.*)@.*/other-$1/" + "RULE:[1:$1@$0](.*@OTHER.REALM)s/(.*)@.*/other-$1/" + "DEFAULT");
  UserGroupInformation.setConfiguration(conf);
  testConstructorSuccess("user1","user1");
  testConstructorSuccess("user2@DEFAULT.REALM","user2");
  testConstructorSuccess("user3/cron@DEFAULT.REALM","user3");
  testConstructorSuccess("user4@OTHER.REALM","other-user4");
  testConstructorSuccess("user5/cron@OTHER.REALM","other-user5");
  testConstructorFailures(null);
  testConstructorFailures("");
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testCreateRemoteUser(){
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("user1");
  assertEquals(AuthenticationMethod.SIMPLE,ugi.getAuthenticationMethod());
  assertTrue(ugi.toString().contains("(auth:SIMPLE)"));
  ugi=UserGroupInformation.createRemoteUser("user1",AuthMethod.KERBEROS);
  assertEquals(AuthenticationMethod.KERBEROS,ugi.getAuthenticationMethod());
  assertTrue(ugi.toString().contains("(auth:KERBEROS)"));
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testTokenIdentifiers() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createUserForTesting("TheDoctor",new String[]{"TheTARDIS"});
  TokenIdentifier t1=mock(TokenIdentifier.class);
  TokenIdentifier t2=mock(TokenIdentifier.class);
  ugi.addTokenIdentifier(t1);
  ugi.addTokenIdentifier(t2);
  Collection<TokenIdentifier> z=ugi.getTokenIdentifiers();
  assertTrue(z.contains(t1));
  assertTrue(z.contains(t2));
  assertEquals(2,z.size());
  Collection<TokenIdentifier> otherSet=ugi.doAs(new PrivilegedExceptionAction<Collection<TokenIdentifier>>(){
    @Override public Collection<TokenIdentifier> run() throws IOException {
      return UserGroupInformation.getCurrentUser().getTokenIdentifiers();
    }
  }
);
  assertTrue(otherSet.contains(t1));
  assertTrue(otherSet.contains(t2));
  assertEquals(2,otherSet.size());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * test constructor 
 */
@Test(timeout=30000) public void testConstructor() throws Exception {
  testConstructorSuccess("user1","user1");
  testConstructorSuccess("user2@DEFAULT.REALM","user2");
  testConstructorSuccess("user3/cron@DEFAULT.REALM","user3");
  testConstructorSuccess("user4@OTHER.REALM","user4");
  testConstructorSuccess("user5/cron@OTHER.REALM","user5");
  testConstructorFailures(null);
  testConstructorFailures("");
}

</code></pre>

<pre class="type-7 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@SuppressWarnings("unchecked") @Test(timeout=30000) public <T extends TokenIdentifier>void testAddCreds() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("someone");
  Text service=new Text("service");
  Token<T> t1=mock(Token.class);
  when(t1.getService()).thenReturn(service);
  Token<T> t2=mock(Token.class);
  when(t2.getService()).thenReturn(new Text("service2"));
  byte[] secret=new byte[]{};
  Text secretKey=new Text("sshhh");
  Credentials creds=new Credentials();
  creds.addToken(t1.getService(),t1);
  creds.addToken(t2.getService(),t2);
  creds.addSecretKey(secretKey,secret);
  ugi.addCredentials(creds);
  checkTokens(ugi,t1,t2);
  assertSame(secret,ugi.getCredentials().getSecretKey(secretKey));
}

</code></pre>

<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testLoginObjectInSubject() throws Exception {
  UserGroupInformation loginUgi=UserGroupInformation.getLoginUser();
  UserGroupInformation anotherUgi=new UserGroupInformation(loginUgi.getSubject());
  LoginContext login1=loginUgi.getSubject().getPrincipals(User.class).iterator().next().getLogin();
  LoginContext login2=anotherUgi.getSubject().getPrincipals(User.class).iterator().next().getLogin();
  Assert.assertTrue(login1 == login2);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * test constructor 
 */
@Test(timeout=30000) public void testConstructorWithKerberos() throws Exception {
  SecurityUtil.setAuthenticationMethod(AuthenticationMethod.KERBEROS,conf);
  UserGroupInformation.setConfiguration(conf);
  testConstructorSuccess("user1","user1");
  testConstructorSuccess("user2@DEFAULT.REALM","user2");
  testConstructorSuccess("user3/cron@DEFAULT.REALM","user3");
  testConstructorFailures("user4@OTHER.REALM");
  testConstructorFailures("user5/cron@OTHER.REALM");
  testConstructorFailures(null);
  testConstructorFailures("");
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000) public void testSimpleLogin() throws IOException {
  tryLoginAuthenticationMethod(AuthenticationMethod.SIMPLE,true);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * test constructor 
 */
@Test(timeout=30000) public void testConstructorWithRules() throws Exception {
  conf.set(HADOOP_SECURITY_AUTH_TO_LOCAL,"RULE:[1:$1@$0](.*@OTHER.REALM)s/(.*)@.*/other-$1/");
  UserGroupInformation.setConfiguration(conf);
  testConstructorSuccess("user1","user1");
  testConstructorSuccess("user4@OTHER.REALM","other-user4");
  testConstructorFailures("user2@DEFAULT.REALM");
  testConstructorFailures("user3/cron@DEFAULT.REALM");
  testConstructorFailures("user5/cron@OTHER.REALM");
  testConstructorFailures(null);
  testConstructorFailures("");
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void resetUgi(){
  UserGroupInformation.setLoginUser(null);
}

</code></pre>

<pre class="type-13 type-2 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks a race condition between getting and adding tokens for
 * the current user.  Calling UserGroupInformation.getCurrentUser() returns
 * a new object each time, so simply making these methods synchronized was not
 * enough to prevent race conditions and causing a
 * ConcurrentModificationException.  These methods are synchronized on the
 * Subject, which is the same object between UserGroupInformation instances.
 * This test tries to cause a CME, by exposing the race condition.  Previously
 * this test would fail every time; now it does not.
 */
@Test public void testTokenRaceCondition() throws Exception {
  UserGroupInformation userGroupInfo=UserGroupInformation.createUserForTesting(USER_NAME,GROUP_NAMES);
  userGroupInfo.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      assertNotEquals(UserGroupInformation.getLoginUser(),UserGroupInformation.getCurrentUser());
      GetTokenThread thread=new GetTokenThread();
      try {
        thread.start();
        for (int i=0; i < 100; i++) {
          @SuppressWarnings("unchecked") Token<? extends TokenIdentifier> t=mock(Token.class);
          when(t.getService()).thenReturn(new Text("t" + i));
          UserGroupInformation.getCurrentUser().addToken(t);
          assertNull("ConcurrentModificationException encountered",thread.cme);
        }
      }
 catch (      ConcurrentModificationException cme) {
        cme.printStackTrace();
        fail("ConcurrentModificationException encountered");
      }
 finally {
        thread.runThread=false;
        thread.join(5 * 1000);
      }
      return null;
    }
  }
);
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testGetRealAuthenticationMethod(){
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("user1");
  ugi.setAuthenticationMethod(AuthenticationMethod.SIMPLE);
  assertEquals(AuthenticationMethod.SIMPLE,ugi.getAuthenticationMethod());
  assertEquals(AuthenticationMethod.SIMPLE,ugi.getRealAuthenticationMethod());
  ugi=UserGroupInformation.createProxyUser("user2",ugi);
  assertEquals(AuthenticationMethod.PROXY,ugi.getAuthenticationMethod());
  assertEquals(AuthenticationMethod.SIMPLE,ugi.getRealAuthenticationMethod());
}

</code></pre>

<pre class="type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testTestAuthMethod() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  for (  AuthenticationMethod am : AuthenticationMethod.values()) {
    if (am.getAuthMethod() != null) {
      ugi.setAuthenticationMethod(am.getAuthMethod());
      assertEquals(am,ugi.getAuthenticationMethod());
    }
  }
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=1000) public void testSetLoginUser() throws IOException {
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("test-user");
  UserGroupInformation.setLoginUser(ugi);
  assertEquals(ugi,UserGroupInformation.getLoginUser());
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testEquals() throws Exception {
  UserGroupInformation uugi=UserGroupInformation.createUserForTesting(USER_NAME,GROUP_NAMES);
  assertEquals(uugi,uugi);
  UserGroupInformation ugi2=UserGroupInformation.createUserForTesting(USER_NAME,GROUP_NAMES);
  assertFalse(uugi.equals(ugi2));
  assertFalse(uugi.hashCode() == ugi2.hashCode());
  UserGroupInformation ugi3=new UserGroupInformation(uugi.getSubject());
  assertEquals(uugi,ugi3);
  assertEquals(uugi.hashCode(),ugi3.hashCode());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
