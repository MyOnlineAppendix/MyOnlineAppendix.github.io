<h3 style="margin:0px">Class: org.apache.hadoop.io.nativeio.TestNativeIO (19 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Sets implicit assumptions "><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >AssumptionSetter&nbsp;(6)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(2)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test basic chmod operation
 */
@Test(timeout=30000) public void testChmod() throws Exception {
  if (Path.WINDOWS) {
    return;
  }
  try {
    NativeIO.POSIX.chmod("/this/file/doesnt/exist",777);
    fail("Chmod of non-existent file didn't fail");
  }
 catch (  NativeIOException nioe) {
    assertEquals(Errno.ENOENT,nioe.getErrno());
  }
  File toChmod=new File(TEST_DIR,"testChmod");
  assertTrue("Create test subject",toChmod.exists() || toChmod.mkdir());
  NativeIO.POSIX.chmod(toChmod.getAbsolutePath(),0777);
  assertPermissions(toChmod,0777);
  NativeIO.POSIX.chmod(toChmod.getAbsolutePath(),0000);
  assertPermissions(toChmod,0000);
  NativeIO.POSIX.chmod(toChmod.getAbsolutePath(),0644);
  assertPermissions(toChmod,0644);
}

</code></pre>

<pre class="type-2 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testOpenWithCreate() throws Exception {
  if (Path.WINDOWS) {
    return;
  }
  LOG.info("Test creating a file with O_CREAT");
  FileDescriptor fd=NativeIO.POSIX.open(new File(TEST_DIR,"testWorkingOpen").getAbsolutePath(),NativeIO.POSIX.O_WRONLY | NativeIO.POSIX.O_CREAT,0700);
  assertNotNull(true);
  assertTrue(fd.valid());
  FileOutputStream fos=new FileOutputStream(fd);
  fos.write("foo".getBytes());
  fos.close();
  assertFalse(fd.valid());
  LOG.info("Test exclusive create");
  try {
    fd=NativeIO.POSIX.open(new File(TEST_DIR,"testWorkingOpen").getAbsolutePath(),NativeIO.POSIX.O_WRONLY | NativeIO.POSIX.O_CREAT | NativeIO.POSIX.O_EXCL,0700);
    fail("Was able to create existing file with O_EXCL");
  }
 catch (  NativeIOException nioe) {
    LOG.info("Got expected exception for failed exclusive create",nioe);
    assertEquals(Errno.EEXIST,nioe.getErrno());
  }
}

</code></pre>

<pre class="type-9 type-13 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for races in fstat usage
 * NOTE: this test is likely to fail on RHEL 6.0 which has a non-threadsafe
 * implementation of getpwuid_r.
 */
@Test(timeout=30000) public void testMultiThreadedFstat() throws Exception {
  if (Path.WINDOWS) {
    return;
  }
  final FileOutputStream fos=new FileOutputStream(new File(TEST_DIR,"testfstat"));
  final AtomicReference<Throwable> thrown=new AtomicReference<Throwable>();
  List<Thread> statters=new ArrayList<Thread>();
  for (int i=0; i < 10; i++) {
    Thread statter=new Thread(){
      @Override public void run(){
        long et=Time.now() + 5000;
        while (Time.now() < et) {
          try {
            NativeIO.POSIX.Stat stat=NativeIO.POSIX.getFstat(fos.getFD());
            assertEquals(System.getProperty("user.name"),stat.getOwner());
            assertNotNull(stat.getGroup());
            assertTrue(!stat.getGroup().isEmpty());
            assertEquals("Stat mode field should indicate a regular file",NativeIO.POSIX.Stat.S_IFREG,stat.getMode() & NativeIO.POSIX.Stat.S_IFMT);
          }
 catch (          Throwable t) {
            thrown.set(t);
          }
        }
      }
    }
;
    statters.add(statter);
    statter.start();
  }
  for (  Thread t : statters) {
    t.join();
  }
  fos.close();
  if (thrown.get() != null) {
    throw new RuntimeException(thrown.get());
  }
}

</code></pre>

<pre class="type-9 type-15 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testMlock() throws Exception {
  assumeTrue(NativeIO.isAvailable());
  final File TEST_FILE=new File(new File(System.getProperty("test.build.data","build/test/data")),"testMlockFile");
  final int BUF_LEN=12289;
  byte buf[]=new byte[BUF_LEN];
  int bufSum=0;
  for (int i=0; i < buf.length; i++) {
    buf[i]=(byte)(i % 60);
    bufSum+=buf[i];
  }
  FileOutputStream fos=new FileOutputStream(TEST_FILE);
  try {
    fos.write(buf);
    fos.getChannel().force(true);
  }
  finally {
    fos.close();
  }
  FileInputStream fis=null;
  FileChannel channel=null;
  try {
    fis=new FileInputStream(TEST_FILE);
    channel=fis.getChannel();
    long fileSize=channel.size();
    MappedByteBuffer mapbuf=channel.map(MapMode.READ_ONLY,0,fileSize);
    NativeIO.POSIX.mlock(mapbuf,fileSize);
    int sum=0;
    for (int i=0; i < fileSize; i++) {
      sum+=mapbuf.get(i);
    }
    assertEquals("Expected sums to be equal",bufSum,sum);
    NativeIO.POSIX.munmap(mapbuf);
  }
  finally {
    if (channel != null) {
      channel.close();
    }
    if (fis != null) {
      fis.close();
    }
  }
}

</code></pre>

<pre class="type-9 type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testSetFilePointer() throws Exception {
  if (!Path.WINDOWS) {
    return;
  }
  LOG.info("Set a file pointer on Windows");
  try {
    File testfile=new File(TEST_DIR,"testSetFilePointer");
    assertTrue("Create test subject",testfile.exists() || testfile.createNewFile());
    FileWriter writer=new FileWriter(testfile);
    try {
      for (int i=0; i < 200; i++)       if (i < 100)       writer.write('a');
 else       writer.write('b');
      writer.flush();
    }
 catch (    Exception writerException) {
      fail("Got unexpected exception: " + writerException.getMessage());
    }
 finally {
      writer.close();
    }
    FileDescriptor fd=NativeIO.Windows.createFile(testfile.getCanonicalPath(),NativeIO.Windows.GENERIC_READ,NativeIO.Windows.FILE_SHARE_READ | NativeIO.Windows.FILE_SHARE_WRITE | NativeIO.Windows.FILE_SHARE_DELETE,NativeIO.Windows.OPEN_EXISTING);
    NativeIO.Windows.setFilePointer(fd,120,NativeIO.Windows.FILE_BEGIN);
    FileReader reader=new FileReader(fd);
    try {
      int c=reader.read();
      assertTrue("Unexpected character: " + c,c == 'b');
    }
 catch (    Exception readerException) {
      fail("Got unexpected exception: " + readerException.getMessage());
    }
 finally {
      reader.close();
    }
  }
 catch (  Exception e) {
    fail("Got unexpected exception: " + e.getMessage());
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Validate access checks on Windows 
 */
@Test(timeout=30000) public void testAccess() throws Exception {
  if (!Path.WINDOWS) {
    return;
  }
  File testFile=new File(TEST_DIR,"testfileaccess");
  assertTrue(testFile.createNewFile());
  FileUtil.setReadable(testFile,false);
  assertFalse(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_READ));
  FileUtil.setReadable(testFile,true);
  assertTrue(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_READ));
  FileUtil.setWritable(testFile,false);
  assertFalse(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_WRITE));
  FileUtil.setWritable(testFile,true);
  assertTrue(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_WRITE));
  FileUtil.setExecutable(testFile,false);
  assertFalse(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_EXECUTE));
  FileUtil.setExecutable(testFile,true);
  assertTrue(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_EXECUTE));
  String testFileRelativePath="";
  for (int i=0; i < 15; ++i) {
    testFileRelativePath+="testfileaccessfolder\\";
  }
  testFileRelativePath+="testfileaccess";
  testFile=new File(TEST_DIR,testFileRelativePath);
  assertTrue(testFile.getParentFile().mkdirs());
  assertTrue(testFile.createNewFile());
  FileUtil.setReadable(testFile,false);
  assertFalse(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_READ));
  FileUtil.setReadable(testFile,true);
  assertTrue(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_READ));
  FileUtil.setWritable(testFile,false);
  assertFalse(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_WRITE));
  FileUtil.setWritable(testFile,true);
  assertTrue(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_WRITE));
  FileUtil.setExecutable(testFile,false);
  assertFalse(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_EXECUTE));
  FileUtil.setExecutable(testFile,true);
  assertTrue(NativeIO.Windows.access(testFile.getAbsolutePath(),NativeIO.Windows.AccessRight.ACCESS_EXECUTE));
}

</code></pre>

<pre class="type-11 type-2 type-7 type-10 type-15 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testRenameTo() throws Exception {
  final File TEST_DIR=new File(new File(System.getProperty("test.build.data","build/test/data")),"renameTest");
  assumeTrue(TEST_DIR.mkdirs());
  File nonExistentFile=new File(TEST_DIR,"nonexistent");
  File targetFile=new File(TEST_DIR,"target");
  try {
    NativeIO.renameTo(nonExistentFile,targetFile);
    Assert.fail();
  }
 catch (  NativeIOException e) {
    if (Path.WINDOWS) {
      Assert.assertEquals(String.format("The system cannot find the file specified.%n"),e.getMessage());
    }
 else {
      Assert.assertEquals(Errno.ENOENT,e.getErrno());
    }
  }
  File sourceFile=new File(TEST_DIR,"source");
  Assert.assertTrue(sourceFile.createNewFile());
  NativeIO.renameTo(sourceFile,sourceFile);
  NativeIO.renameTo(sourceFile,targetFile);
  sourceFile=new File(TEST_DIR,"source");
  Assert.assertTrue(sourceFile.createNewFile());
  File badTarget=new File(targetFile,"subdir");
  try {
    NativeIO.renameTo(sourceFile,badTarget);
    Assert.fail();
  }
 catch (  NativeIOException e) {
    if (Path.WINDOWS) {
      Assert.assertEquals(String.format("The parameter is incorrect.%n"),e.getMessage());
    }
 else {
      Assert.assertEquals(Errno.ENOTDIR,e.getErrno());
    }
  }
  FileUtils.deleteQuietly(TEST_DIR);
}

</code></pre>

<pre class="type-2 type-15 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testSyncFileRange() throws Exception {
  FileOutputStream fos=new FileOutputStream(new File(TEST_DIR,"testSyncFileRange"));
  try {
    fos.write("foo".getBytes());
    NativeIO.POSIX.sync_file_range(fos.getFD(),0,1024,NativeIO.POSIX.SYNC_FILE_RANGE_WRITE);
  }
 catch (  UnsupportedOperationException uoe) {
    assumeTrue(false);
  }
 finally {
    fos.close();
  }
  try {
    NativeIO.POSIX.sync_file_range(fos.getFD(),0,1024,NativeIO.POSIX.SYNC_FILE_RANGE_WRITE);
    fail("Did not throw on bad file");
  }
 catch (  NativeIOException nioe) {
    assertEquals(Errno.EBADF,nioe.getErrno());
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testGetUserName() throws IOException {
  if (Path.WINDOWS) {
    return;
  }
  assertFalse(NativeIO.POSIX.getUserName(0).isEmpty());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testFstatClosedFd() throws Exception {
  FileOutputStream fos=new FileOutputStream(new File(TEST_DIR,"testfstat2"));
  fos.close();
  try {
    NativeIO.POSIX.Stat stat=NativeIO.POSIX.getFstat(fos.getFD());
  }
 catch (  NativeIOException nioe) {
    LOG.info("Got expected exception",nioe);
    assertEquals(Errno.EBADF,nioe.getErrno());
  }
}

</code></pre>

<pre class="type-8 type-15 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void checkLoaded(){
  assumeTrue(NativeCodeLoader.isNativeCodeLoaded());
}

</code></pre>

<pre class="type-2 type-15 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testPosixFadvise() throws Exception {
  if (Path.WINDOWS) {
    return;
  }
  FileInputStream fis=new FileInputStream("/dev/zero");
  try {
    NativeIO.POSIX.posix_fadvise(fis.getFD(),0,0,NativeIO.POSIX.POSIX_FADV_SEQUENTIAL);
  }
 catch (  UnsupportedOperationException uoe) {
    assumeTrue(false);
  }
catch (  NativeIOException nioe) {
  }
 finally {
    fis.close();
  }
  try {
    NativeIO.POSIX.posix_fadvise(fis.getFD(),0,1024,NativeIO.POSIX.POSIX_FADV_SEQUENTIAL);
    fail("Did not throw on bad file");
  }
 catch (  NativeIOException nioe) {
    assertEquals(Errno.EBADF,nioe.getErrno());
  }
  try {
    NativeIO.POSIX.posix_fadvise(null,0,1024,NativeIO.POSIX.POSIX_FADV_SEQUENTIAL);
    fail("Did not throw on null file");
  }
 catch (  NullPointerException npe) {
  }
}

</code></pre>

<pre class="type-9 type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testCreateFile() throws Exception {
  if (!Path.WINDOWS) {
    return;
  }
  LOG.info("Open a file on Windows with SHARE_DELETE shared mode");
  try {
    File testfile=new File(TEST_DIR,"testCreateFile");
    assertTrue("Create test subject",testfile.exists() || testfile.createNewFile());
    FileDescriptor fd=NativeIO.Windows.createFile(testfile.getCanonicalPath(),NativeIO.Windows.GENERIC_READ,NativeIO.Windows.FILE_SHARE_READ | NativeIO.Windows.FILE_SHARE_WRITE | NativeIO.Windows.FILE_SHARE_DELETE,NativeIO.Windows.OPEN_EXISTING);
    FileInputStream fin=new FileInputStream(fd);
    try {
      fin.read();
      File newfile=new File(TEST_DIR,"testRenamedFile");
      boolean renamed=testfile.renameTo(newfile);
      assertTrue("Rename failed.",renamed);
      fin.read();
    }
 catch (    Exception e) {
      fail("Got unexpected exception: " + e.getMessage());
    }
 finally {
      fin.close();
    }
  }
 catch (  Exception e) {
    fail("Got unexpected exception: " + e.getMessage());
  }
}

</code></pre>

<pre class="type-13 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that opens and closes a file 10000 times - this would crash with
 * "Too many open files" if we leaked fds using this access pattern.
 */
@Test(timeout=30000) public void testFDDoesntLeak() throws IOException {
  if (Path.WINDOWS) {
    return;
  }
  for (int i=0; i < 10000; i++) {
    FileDescriptor fd=NativeIO.POSIX.open(new File(TEST_DIR,"testNoFdLeak").getAbsolutePath(),NativeIO.POSIX.O_WRONLY | NativeIO.POSIX.O_CREAT,0700);
    assertNotNull(true);
    assertTrue(fd.valid());
    FileOutputStream fos=new FileOutputStream(fd);
    fos.write("foo".getBytes());
    fos.close();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testFstat() throws Exception {
  FileOutputStream fos=new FileOutputStream(new File(TEST_DIR,"testfstat"));
  NativeIO.POSIX.Stat stat=NativeIO.POSIX.getFstat(fos.getFD());
  fos.close();
  LOG.info("Stat: " + String.valueOf(stat));
  String owner=stat.getOwner();
  String expectedOwner=System.getProperty("user.name");
  if (Path.WINDOWS) {
    UserGroupInformation ugi=UserGroupInformation.createRemoteUser(expectedOwner);
    final String adminsGroupString="Administrators";
    if (Arrays.asList(ugi.getGroupNames()).contains(adminsGroupString)) {
      expectedOwner=adminsGroupString;
    }
  }
  assertEquals(expectedOwner,owner);
  assertNotNull(stat.getGroup());
  assertTrue(!stat.getGroup().isEmpty());
  assertEquals("Stat mode field should indicate a regular file",NativeIO.POSIX.Stat.S_IFREG,stat.getMode() & NativeIO.POSIX.Stat.S_IFMT);
}

</code></pre>

<pre class="type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testOpenMissingWithoutCreate() throws Exception {
  if (Path.WINDOWS) {
    return;
  }
  LOG.info("Open a missing file without O_CREAT and it should fail");
  try {
    FileDescriptor fd=NativeIO.POSIX.open(new File(TEST_DIR,"doesntexist").getAbsolutePath(),NativeIO.POSIX.O_WRONLY,0700);
    fail("Able to open a new file without O_CREAT");
  }
 catch (  NativeIOException nioe) {
    LOG.info("Got expected exception",nioe);
    assertEquals(Errno.ENOENT,nioe.getErrno());
  }
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setupTestDir(){
  FileUtil.fullyDelete(TEST_DIR);
  TEST_DIR.mkdirs();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testGetGroupName() throws IOException {
  if (Path.WINDOWS) {
    return;
  }
  assertFalse(NativeIO.POSIX.getGroupName(0).isEmpty());
}

</code></pre>

<pre class="type-15 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Sets implicit assumptions 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=10000) public void testGetMemlockLimit() throws Exception {
  assumeTrue(NativeIO.isAvailable());
  NativeIO.getMemlockLimit();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
