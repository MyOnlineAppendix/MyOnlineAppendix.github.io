<h3 style="margin:0px">Class: org.apache.hadoop.security.token.delegation.web.TestWebDelegationToken (11 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExternalDelegationTokenSecretManager() throws Exception {
  DummyDelegationTokenSecretManager secretMgr=new DummyDelegationTokenSecretManager();
  final Server jetty=createJettyServer();
  Context context=new Context();
  context.setContextPath("/foo");
  jetty.setHandler(context);
  context.addFilter(new FilterHolder(AFilter.class),"/*",0);
  context.addServlet(new ServletHolder(PingServlet.class),"/bar");
  try {
    secretMgr.startThreads();
    context.setAttribute(DelegationTokenAuthenticationFilter.DELEGATION_TOKEN_SECRET_MANAGER_ATTR,secretMgr);
    jetty.start();
    URL authURL=new URL(getJettyURL() + "/foo/bar?authenticated=foo");
    DelegationTokenAuthenticatedURL.Token token=new DelegationTokenAuthenticatedURL.Token();
    DelegationTokenAuthenticatedURL aUrl=new DelegationTokenAuthenticatedURL();
    aUrl.getDelegationToken(authURL,token,FOO_USER);
    Assert.assertNotNull(token.getDelegationToken());
    Assert.assertEquals(new Text("fooKind"),token.getDelegationToken().getKind());
  }
  finally {
    jetty.stop();
    secretMgr.stopThreads();
  }
}

</code></pre>

<pre class="type-2 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDelegationTokenAuthenticatorCalls() throws Exception {
  final Server jetty=createJettyServer();
  Context context=new Context();
  context.setContextPath("/foo");
  jetty.setHandler(context);
  context.addFilter(new FilterHolder(AFilter.class),"/*",0);
  context.addServlet(new ServletHolder(PingServlet.class),"/bar");
  try {
    jetty.start();
    URL nonAuthURL=new URL(getJettyURL() + "/foo/bar");
    URL authURL=new URL(getJettyURL() + "/foo/bar?authenticated=foo");
    URL authURL2=new URL(getJettyURL() + "/foo/bar?authenticated=bar");
    DelegationTokenAuthenticatedURL.Token token=new DelegationTokenAuthenticatedURL.Token();
    DelegationTokenAuthenticatedURL aUrl=new DelegationTokenAuthenticatedURL();
    try {
      aUrl.getDelegationToken(nonAuthURL,token,FOO_USER);
      Assert.fail();
    }
 catch (    Exception ex) {
      Assert.assertTrue(ex.getMessage().contains("401"));
    }
    aUrl.getDelegationToken(authURL,token,FOO_USER);
    Assert.assertNotNull(token.getDelegationToken());
    Assert.assertEquals(new Text("token-kind"),token.getDelegationToken().getKind());
    aUrl.renewDelegationToken(authURL,token);
    try {
      aUrl.renewDelegationToken(nonAuthURL,token);
      Assert.fail();
    }
 catch (    Exception ex) {
      Assert.assertTrue(ex.getMessage().contains("401"));
    }
    aUrl.getDelegationToken(authURL,token,FOO_USER);
    try {
      aUrl.renewDelegationToken(authURL2,token);
      Assert.fail();
    }
 catch (    Exception ex) {
      Assert.assertTrue(ex.getMessage().contains("403"));
    }
    aUrl.getDelegationToken(authURL,token,FOO_USER);
    aUrl.cancelDelegationToken(authURL,token);
    aUrl.getDelegationToken(authURL,token,FOO_USER);
    aUrl.cancelDelegationToken(nonAuthURL,token);
    aUrl.getDelegationToken(authURL,token,FOO_USER);
    try {
      aUrl.renewDelegationToken(nonAuthURL,token);
    }
 catch (    Exception ex) {
      Assert.assertTrue(ex.getMessage().contains("401"));
    }
  }
  finally {
    jetty.stop();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDelegationTokenAuthenticationURLWithNoDTFilter() throws Exception {
  testDelegationTokenAuthenticatedURLWithNoDT(NoDTFilter.class);
}

</code></pre>

<pre class="type-9 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRawHttpCalls() throws Exception {
  final Server jetty=createJettyServer();
  Context context=new Context();
  context.setContextPath("/foo");
  jetty.setHandler(context);
  context.addFilter(new FilterHolder(AFilter.class),"/*",0);
  context.addServlet(new ServletHolder(PingServlet.class),"/bar");
  try {
    jetty.start();
    URL nonAuthURL=new URL(getJettyURL() + "/foo/bar");
    URL authURL=new URL(getJettyURL() + "/foo/bar?authenticated=foo");
    HttpURLConnection conn=(HttpURLConnection)nonAuthURL.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_UNAUTHORIZED,conn.getResponseCode());
    conn=(HttpURLConnection)authURL.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    URL url=new URL(nonAuthURL.toExternalForm() + "?op=GETDELEGATIONTOKEN");
    conn=(HttpURLConnection)url.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_UNAUTHORIZED,conn.getResponseCode());
    url=new URL(authURL.toExternalForm() + "&op=GETDELEGATIONTOKEN&renewer=foo");
    conn=(HttpURLConnection)url.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    ObjectMapper mapper=new ObjectMapper();
    Map map=mapper.readValue(conn.getInputStream(),Map.class);
    String dt=(String)((Map)map.get("Token")).get("urlString");
    Assert.assertNotNull(dt);
    url=new URL(nonAuthURL.toExternalForm() + "?delegation=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    url=new URL(authURL.toExternalForm() + "&delegation=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    url=new URL(nonAuthURL.toExternalForm() + "?op=RENEWDELEGATIONTOKEN&token=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    conn.setRequestMethod("PUT");
    Assert.assertEquals(HttpURLConnection.HTTP_UNAUTHORIZED,conn.getResponseCode());
    url=new URL(authURL.toExternalForm() + "&op=RENEWDELEGATIONTOKEN&token=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    conn.setRequestMethod("PUT");
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    url=new URL(getJettyURL() + "/foo/bar?authenticated=bar&op=RENEWDELEGATIONTOKEN&token=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    conn.setRequestMethod("PUT");
    Assert.assertEquals(HttpURLConnection.HTTP_FORBIDDEN,conn.getResponseCode());
    url=new URL(nonAuthURL.toExternalForm() + "?op=CANCELDELEGATIONTOKEN&token=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    conn.setRequestMethod("PUT");
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    url=new URL(nonAuthURL.toExternalForm() + "?op=CANCELDELEGATIONTOKEN&token=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    conn.setRequestMethod("PUT");
    Assert.assertEquals(HttpURLConnection.HTTP_NOT_FOUND,conn.getResponseCode());
    url=new URL(authURL.toExternalForm() + "&op=GETDELEGATIONTOKEN&renewer=foo");
    conn=(HttpURLConnection)url.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    mapper=new ObjectMapper();
    map=mapper.readValue(conn.getInputStream(),Map.class);
    dt=(String)((Map)map.get("Token")).get("urlString");
    Assert.assertNotNull(dt);
    url=new URL(authURL.toExternalForm() + "&op=CANCELDELEGATIONTOKEN&token=" + dt);
    conn=(HttpURLConnection)url.openConnection();
    conn.setRequestMethod("PUT");
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
  }
  finally {
    jetty.stop();
  }
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void cleanUp() throws Exception {
  jetty.stop();
  org.apache.hadoop.conf.Configuration conf=new org.apache.hadoop.conf.Configuration();
  UserGroupInformation.setConfiguration(conf);
}

</code></pre>

<pre class="type-2 type-7 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosDelegationTokenAuthenticator() throws Exception {
  org.apache.hadoop.conf.Configuration conf=new org.apache.hadoop.conf.Configuration();
  conf.set("hadoop.security.authentication","kerberos");
  UserGroupInformation.setConfiguration(conf);
  File testDir=new File("target/" + UUID.randomUUID().toString());
  Assert.assertTrue(testDir.mkdirs());
  MiniKdc kdc=new MiniKdc(MiniKdc.createConf(),testDir);
  final Server jetty=createJettyServer();
  Context context=new Context();
  context.setContextPath("/foo");
  jetty.setHandler(context);
  context.addFilter(new FilterHolder(KDTAFilter.class),"/*",0);
  context.addServlet(new ServletHolder(UserServlet.class),"/bar");
  try {
    kdc.start();
    File keytabFile=new File(testDir,"test.keytab");
    kdc.createPrincipal(keytabFile,"client","HTTP/localhost");
    KDTAFilter.keytabFile=keytabFile.getAbsolutePath();
    jetty.start();
    final DelegationTokenAuthenticatedURL.Token token=new DelegationTokenAuthenticatedURL.Token();
    final DelegationTokenAuthenticatedURL aUrl=new DelegationTokenAuthenticatedURL();
    final URL url=new URL(getJettyURL() + "/foo/bar");
    try {
      aUrl.getDelegationToken(url,token,FOO_USER);
      Assert.fail();
    }
 catch (    AuthenticationException ex) {
      Assert.assertTrue(ex.getMessage().contains("GSSException"));
    }
    doAsKerberosUser("client",keytabFile.getAbsolutePath(),new Callable<Void>(){
      @Override public Void call() throws Exception {
        aUrl.getDelegationToken(url,token,"client");
        Assert.assertNotNull(token.getDelegationToken());
        aUrl.renewDelegationToken(url,token);
        Assert.assertNotNull(token.getDelegationToken());
        aUrl.getDelegationToken(url,token,FOO_USER);
        Assert.assertNotNull(token.getDelegationToken());
        try {
          aUrl.renewDelegationToken(url,token);
          Assert.fail();
        }
 catch (        Exception ex) {
          Assert.assertTrue(ex.getMessage().contains("403"));
        }
        aUrl.getDelegationToken(url,token,FOO_USER);
        aUrl.cancelDelegationToken(url,token);
        Assert.assertNull(token.getDelegationToken());
        return null;
      }
    }
);
  }
  finally {
    jetty.stop();
    kdc.stop();
  }
}

</code></pre>

<pre class="type-9 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFallbackToPseudoDelegationTokenAuthenticator() throws Exception {
  final Server jetty=createJettyServer();
  Context context=new Context();
  context.setContextPath("/foo");
  jetty.setHandler(context);
  context.addFilter(new FilterHolder(PseudoDTAFilter.class),"/*",0);
  context.addServlet(new ServletHolder(UserServlet.class),"/bar");
  try {
    jetty.start();
    final URL url=new URL(getJettyURL() + "/foo/bar");
    UserGroupInformation ugi=UserGroupInformation.createRemoteUser(FOO_USER);
    ugi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        DelegationTokenAuthenticatedURL.Token token=new DelegationTokenAuthenticatedURL.Token();
        DelegationTokenAuthenticatedURL aUrl=new DelegationTokenAuthenticatedURL();
        HttpURLConnection conn=aUrl.openConnection(url,token);
        Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
        List<String> ret=IOUtils.readLines(conn.getInputStream());
        Assert.assertEquals(1,ret.size());
        Assert.assertEquals(FOO_USER,ret.get(0));
        aUrl.getDelegationToken(url,token,FOO_USER);
        Assert.assertNotNull(token.getDelegationToken());
        Assert.assertEquals(new Text("token-kind"),token.getDelegationToken().getKind());
        return null;
      }
    }
);
  }
  finally {
    jetty.stop();
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHttpUGI() throws Exception {
  final Server jetty=createJettyServer();
  Context context=new Context();
  context.setContextPath("/foo");
  jetty.setHandler(context);
  context.addFilter(new FilterHolder(PseudoDTAFilter.class),"/*",0);
  context.addServlet(new ServletHolder(UGIServlet.class),"/bar");
  try {
    jetty.start();
    final URL url=new URL(getJettyURL() + "/foo/bar");
    UserGroupInformation ugi=UserGroupInformation.createRemoteUser(FOO_USER);
    ugi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        DelegationTokenAuthenticatedURL.Token token=new DelegationTokenAuthenticatedURL.Token();
        DelegationTokenAuthenticatedURL aUrl=new DelegationTokenAuthenticatedURL();
        HttpURLConnection conn=aUrl.openConnection(url,token);
        Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
        List<String> ret=IOUtils.readLines(conn.getInputStream());
        Assert.assertEquals(1,ret.size());
        Assert.assertEquals("remoteuser=" + FOO_USER + ":ugi="+ FOO_USER,ret.get(0));
        conn=aUrl.openConnection(url,token,OK_USER);
        Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
        ret=IOUtils.readLines(conn.getInputStream());
        Assert.assertEquals(1,ret.size());
        Assert.assertEquals("realugi=" + FOO_USER + ":remoteuser="+ OK_USER+ ":ugi="+ OK_USER,ret.get(0));
        return null;
      }
    }
);
  }
  finally {
    jetty.stop();
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testProxyUser() throws Exception {
  final Server jetty=createJettyServer();
  Context context=new Context();
  context.setContextPath("/foo");
  jetty.setHandler(context);
  context.addFilter(new FilterHolder(PseudoDTAFilter.class),"/*",0);
  context.addServlet(new ServletHolder(UserServlet.class),"/bar");
  try {
    jetty.start();
    final URL url=new URL(getJettyURL() + "/foo/bar");
    UserGroupInformation ugi=UserGroupInformation.createRemoteUser(FOO_USER);
    ugi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        DelegationTokenAuthenticatedURL.Token token=new DelegationTokenAuthenticatedURL.Token();
        DelegationTokenAuthenticatedURL aUrl=new DelegationTokenAuthenticatedURL();
        HttpURLConnection conn=aUrl.openConnection(url,token,OK_USER);
        Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
        List<String> ret=IOUtils.readLines(conn.getInputStream());
        Assert.assertEquals(1,ret.size());
        Assert.assertEquals(OK_USER,ret.get(0));
        conn=aUrl.openConnection(url,token,FAIL_USER);
        Assert.assertEquals(HttpURLConnection.HTTP_FORBIDDEN,conn.getResponseCode());
        aUrl.getDelegationToken(url,token,FOO_USER);
        UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
        ugi.addToken(token.getDelegationToken());
        token=new DelegationTokenAuthenticatedURL.Token();
        conn=aUrl.openConnection(url,token,OK_USER);
        Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
        ret=IOUtils.readLines(conn.getInputStream());
        Assert.assertEquals(1,ret.size());
        Assert.assertEquals(FOO_USER,ret.get(0));
        return null;
      }
    }
);
  }
  finally {
    jetty.stop();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDelegationTokenAuthenticationURLWithNoDTHandler() throws Exception {
  testDelegationTokenAuthenticatedURLWithNoDT(NoDTHandlerDTAFilter.class);
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  org.apache.hadoop.conf.Configuration conf=new org.apache.hadoop.conf.Configuration();
  UserGroupInformation.setConfiguration(conf);
  jetty=createJettyServer();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
