<h3 style="margin:0px">Class: org.apache.hadoop.ipc.TestIPC (31 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(18)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="20"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('20')" data-toggle="tooltip" title="Verifies values related to public fields."><kbd id="tag-20"class="label-info"style="display: inline-block;font-size:7pt" >PublicFieldVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Sets implicit assumptions "><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >AssumptionSetter&nbsp;(1)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test the retry count while used in a retry proxy.
 */
@Test(timeout=60000) public void testRetryProxy() throws IOException {
  final Client client=new Client(LongWritable.class,conf);
  final TestServer server=new TestServer(1,false);
  server.callListener=new Runnable(){
    private int retryCount=0;
    @Override public void run(){
      Assert.assertEquals(retryCount++,Server.getCallRetryCount());
    }
  }
;
  final int totalRetry=10000;
  DummyProtocol proxy=(DummyProtocol)Proxy.newProxyInstance(DummyProtocol.class.getClassLoader(),new Class[]{DummyProtocol.class},new TestInvocationHandler(client,server,totalRetry));
  DummyProtocol retryProxy=(DummyProtocol)RetryProxy.create(DummyProtocol.class,proxy,RetryPolicies.RETRY_FOREVER);
  try {
    server.start();
    retryProxy.dummyRun();
    Assert.assertEquals(TestInvocationHandler.retry,totalRetry + 1);
  }
  finally {
    Client.setCallIdAndRetryCount(0,0);
    client.stop();
    server.stop();
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=60000) public void testIpcConnectTimeout() throws IOException {
  Server server=new TestServer(1,true);
  InetSocketAddress addr=NetUtils.getConnectAddress(server);
  Client.setConnectTimeout(conf,100);
  Client client=new Client(LongWritable.class,conf);
  try {
    client.call(new LongWritable(RANDOM.nextLong()),addr,null,null,MIN_SLEEP_TIME * 2,conf);
    fail("Expected an exception to have been thrown");
  }
 catch (  SocketTimeoutException e) {
    LOG.info("Get a SocketTimeoutException ",e);
  }
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=30000,expected=IOException.class) public void testIpcAfterStopping() throws IOException {
  Server server=new TestServer(5,false);
  InetSocketAddress addr=NetUtils.getConnectAddress(server);
  server.start();
  Client client=new Client(LongWritable.class,conf);
  client.call(new LongWritable(RANDOM.nextLong()),addr,null,null,MIN_SLEEP_TIME,0,conf);
  client.stop();
  client.call(new LongWritable(RANDOM.nextLong()),addr,null,null,MIN_SLEEP_TIME,0,conf);
}

</code></pre>

<pre class="type-9 type-2 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testStandAloneClient() throws IOException {
  Client client=new Client(LongWritable.class,conf);
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",10);
  try {
    client.call(new LongWritable(RANDOM.nextLong()),address,null,null,0,conf);
    fail("Expected an exception to have been thrown");
  }
 catch (  IOException e) {
    String message=e.getMessage();
    String addressText=address.getHostName() + ":" + address.getPort();
    assertTrue("Did not find " + addressText + " in "+ message,message.contains(addressText));
    Throwable cause=e.getCause();
    assertNotNull("No nested exception in " + e,cause);
    String causeText=cause.getMessage();
    assertTrue("Did not find " + causeText + " in "+ message,message.contains(causeText));
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test case that fails a write, but only after taking enough time
 * that a ping should have been sent. This is a reproducer for a
 * deadlock seen in one iteration of HADOOP-6762.
 */
@Test(timeout=60000) public void testIOEOnWriteAfterPingClient() throws Exception {
  Client.setPingInterval(conf,100);
  try {
    WRITABLE_FAULTS_SLEEP=1000;
    doErrorTest(IOEOnWriteWritable.class,LongWritable.class,LongWritable.class,LongWritable.class);
  }
  finally {
    WRITABLE_FAULTS_SLEEP=0;
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test if the rpc server gets the retry count from client.
 */
@Test(timeout=60000) public void testCallRetryCount() throws IOException {
  final int retryCount=255;
  final Client client=new Client(LongWritable.class,conf);
  Client.setCallIdAndRetryCount(Client.nextCallId(),255);
  final TestServer server=new TestServer(1,false);
  server.callListener=new Runnable(){
    @Override public void run(){
      Assert.assertEquals(retryCount,Server.getCallRetryCount());
    }
  }
;
  try {
    InetSocketAddress addr=NetUtils.getConnectAddress(server);
    server.start();
    final SerialCaller caller=new SerialCaller(client,addr,10);
    caller.run();
    assertFalse(caller.failed);
  }
  finally {
    client.stop();
    server.stop();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testIOEOnServerReadParam() throws Exception {
  doErrorTest(LongWritable.class,IOEOnReadWritable.class,LongWritable.class,LongWritable.class);
}

</code></pre>

<pre class="type-10 type-15 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that file descriptors aren't leaked by starting
 * and stopping IPC servers.
 */
@Test(timeout=60000) public void testSocketLeak() throws IOException {
  Assume.assumeTrue(FD_DIR.exists());
  long startFds=countOpenFileDescriptors();
  for (int i=0; i < 50; i++) {
    Server server=new TestServer(1,true);
    server.start();
    server.stop();
  }
  long endFds=countOpenFileDescriptors();
  assertTrue("Leaked " + (endFds - startFds) + " file descriptors",endFds - startFds < 20);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Check service class byte in IPC header is correct on wire.
 */
@Test(timeout=60000) public void testIpcWithServiceClass() throws IOException {
  Server server=new TestServer(5,false);
  InetSocketAddress addr=NetUtils.getConnectAddress(server);
  server.start();
  Client.setConnectTimeout(conf,10000);
  callAndVerify(server,addr,0,true);
  callAndVerify(server,addr,-128,true);
  callAndVerify(server,addr,-129,false);
  callAndVerify(server,addr,127,true);
  callAndVerify(server,addr,128,false);
  server.stop();
}

</code></pre>

<pre class="type-13 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testConnectionIdleTimeouts() throws Exception {
  ((Log4JLogger)Server.LOG).getLogger().setLevel(Level.DEBUG);
  final int maxIdle=1000;
  final int cleanupInterval=maxIdle * 3 / 4;
  final int killMax=3;
  final int clients=1 + killMax * 2;
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,maxIdle);
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_IDLETHRESHOLD_KEY,0);
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_KILL_MAX_KEY,killMax);
  conf.setInt(CommonConfigurationKeys.IPC_CLIENT_CONNECTION_IDLESCANINTERVAL_KEY,cleanupInterval);
  final CyclicBarrier firstCallBarrier=new CyclicBarrier(2);
  final CyclicBarrier callBarrier=new CyclicBarrier(clients);
  final CountDownLatch allCallLatch=new CountDownLatch(clients);
  final AtomicBoolean error=new AtomicBoolean();
  final TestServer server=new TestServer(clients,false);
  Thread[] threads=new Thread[clients];
  try {
    server.callListener=new Runnable(){
      AtomicBoolean first=new AtomicBoolean(true);
      @Override public void run(){
        try {
          allCallLatch.countDown();
          if (first.compareAndSet(true,false)) {
            firstCallBarrier.await();
          }
 else {
            callBarrier.await();
          }
        }
 catch (        Throwable t) {
          LOG.error(t);
          error.set(true);
        }
      }
    }
;
    server.start();
    final CountDownLatch callReturned=new CountDownLatch(clients - 1);
    final InetSocketAddress addr=NetUtils.getConnectAddress(server);
    final Configuration clientConf=new Configuration();
    clientConf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,10000);
    for (int i=0; i < clients; i++) {
      threads[i]=new Thread(new Runnable(){
        @Override public void run(){
          Client client=new Client(LongWritable.class,clientConf);
          try {
            client.call(new LongWritable(Thread.currentThread().getId()),addr,null,null,0,clientConf);
            callReturned.countDown();
            Thread.sleep(10000);
          }
 catch (          IOException e) {
            LOG.error(e);
          }
catch (          InterruptedException e) {
          }
        }
      }
);
      threads[i].start();
    }
    allCallLatch.await();
    assertFalse(error.get());
    assertEquals(clients,server.getNumOpenConnections());
    callBarrier.await();
    callReturned.await();
    assertEquals(clients,server.getNumOpenConnections());
    Thread.sleep(maxIdle * 2 - cleanupInterval);
    for (int i=clients; i > 1; i-=killMax) {
      Thread.sleep(cleanupInterval);
      assertFalse(error.get());
      assertEquals(i,server.getNumOpenConnections());
    }
    Thread.sleep(cleanupInterval);
    assertFalse(error.get());
    assertEquals(1,server.getNumOpenConnections());
    firstCallBarrier.await();
    Thread.sleep(maxIdle * 2);
    assertFalse(error.get());
    assertEquals(0,server.getNumOpenConnections());
  }
  finally {
    for (    Thread t : threads) {
      if (t != null) {
        t.interrupt();
        t.join();
      }
      server.stop();
    }
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Check that reader queueing works
 * @throws BrokenBarrierException 
 * @throws InterruptedException 
 */
@Test(timeout=60000) public void testIpcWithReaderQueuing() throws Exception {
  for (int i=0; i < 10; i++) {
    checkBlocking(1,1,1);
  }
  for (int i=0; i < 10; i++) {
    checkBlocking(4,5,2);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testRTEOnServerWriteResponse() throws Exception {
  doErrorTest(LongWritable.class,LongWritable.class,RTEOnWriteWritable.class,LongWritable.class);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=60000) public void testIpcTimeout() throws IOException {
  Server server=new TestServer(1,true);
  InetSocketAddress addr=NetUtils.getConnectAddress(server);
  server.start();
  Client client=new Client(LongWritable.class,conf);
  try {
    client.call(new LongWritable(RANDOM.nextLong()),addr,null,null,MIN_SLEEP_TIME / 2,conf);
    fail("Expected an exception to have been thrown");
  }
 catch (  SocketTimeoutException e) {
    LOG.info("Get a SocketTimeoutException ",e);
  }
  client.call(new LongWritable(RANDOM.nextLong()),addr,null,null,3 * PING_INTERVAL + MIN_SLEEP_TIME,conf);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testIpcFromHadoop0_21_0() throws IOException {
  doIpcVersionTest(NetworkTraces.HADOOP_0_21_0_RPC_DUMP,NetworkTraces.RESPONSE_TO_HADOOP_0_21_0_RPC);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testRTEOnClientWriteParam() throws Exception {
  doErrorTest(RTEOnWriteWritable.class,LongWritable.class,LongWritable.class,LongWritable.class);
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test if
 * (1) the rpc server uses the call id/retry provided by the rpc client, and
 * (2) the rpc client receives the same call id/retry from the rpc server.
 */
@Test(timeout=60000) public void testCallIdAndRetry() throws IOException {
  final CallInfo info=new CallInfo();
  final Client client=new Client(LongWritable.class,conf){
    @Override Call createCall(    RpcKind rpcKind,    Writable rpcRequest){
      final Call call=super.createCall(rpcKind,rpcRequest);
      info.id=call.id;
      info.retry=call.retry;
      return call;
    }
    @Override void checkResponse(    RpcResponseHeaderProto header) throws IOException {
      super.checkResponse(header);
      Assert.assertEquals(info.id,header.getCallId());
      Assert.assertEquals(info.retry,header.getRetryCount());
    }
  }
;
  final TestServer server=new TestServer(1,false);
  server.callListener=new Runnable(){
    @Override public void run(){
      Assert.assertEquals(info.id,Server.getCallId());
      Assert.assertEquals(info.retry,Server.getCallRetryCount());
    }
  }
;
  try {
    InetSocketAddress addr=NetUtils.getConnectAddress(server);
    server.start();
    final SerialCaller caller=new SerialCaller(client,addr,10);
    caller.run();
    assertFalse(caller.failed);
  }
  finally {
    client.stop();
    server.stop();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test if the rpc server gets the default retry count (0) from client.
 */
@Test(timeout=60000) public void testInitialCallRetryCount() throws IOException {
  final Client client=new Client(LongWritable.class,conf);
  final TestServer server=new TestServer(1,false);
  server.callListener=new Runnable(){
    @Override public void run(){
      Assert.assertEquals(0,Server.getCallRetryCount());
    }
  }
;
  try {
    InetSocketAddress addr=NetUtils.getConnectAddress(server);
    server.start();
    final SerialCaller caller=new SerialCaller(client,addr,10);
    caller.run();
    assertFalse(caller.failed);
  }
  finally {
    client.stop();
    server.stop();
  }
}

</code></pre>

<pre class="type-9 type-13 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that client generates a unique sequential call ID for each RPC call,
 * even if multiple threads are using the same client.
 * @throws InterruptedException 
 */
@Test(timeout=60000) public void testUniqueSequentialCallIds() throws IOException, InterruptedException {
  int serverThreads=10, callerCount=100, perCallerCallCount=100;
  TestServer server=new TestServer(serverThreads,false);
  final List<Integer> callIds=Collections.synchronizedList(new ArrayList<Integer>());
  server.callListener=new Runnable(){
    @Override public void run(){
      callIds.add(Server.getCallId());
    }
  }
;
  Client client=new Client(LongWritable.class,conf);
  try {
    InetSocketAddress addr=NetUtils.getConnectAddress(server);
    server.start();
    SerialCaller[] callers=new SerialCaller[callerCount];
    for (int i=0; i < callerCount; ++i) {
      callers[i]=new SerialCaller(client,addr,perCallerCallCount);
      callers[i].start();
    }
    for (int i=0; i < callerCount; ++i) {
      callers[i].join();
      assertFalse(callers[i].failed);
    }
  }
  finally {
    client.stop();
    server.stop();
  }
  int expectedCallCount=callerCount * perCallerCallCount;
  assertEquals(expectedCallCount,callIds.size());
  Collections.sort(callIds);
  final int startID=callIds.get(0).intValue();
  for (int i=0; i < expectedCallCount; ++i) {
    assertEquals(startID + i,callIds.get(i).intValue());
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testSerial() throws IOException, InterruptedException {
  internalTestSerial(3,false,2,5,100);
  internalTestSerial(3,true,2,5,10);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testIOEOnServerWriteResponse() throws Exception {
  doErrorTest(LongWritable.class,LongWritable.class,IOEOnWriteWritable.class,LongWritable.class);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testIOEOnClientWriteParam() throws Exception {
  doErrorTest(IOEOnWriteWritable.class,LongWritable.class,LongWritable.class,LongWritable.class);
}

</code></pre>

<pre class="type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that, if the socket factory throws an IOE, it properly propagates
 * to the client.
 */
@Test(timeout=60000) public void testSocketFactoryException() throws IOException {
  SocketFactory mockFactory=mock(SocketFactory.class);
  doThrow(new IOException("Injected fault")).when(mockFactory).createSocket();
  Client client=new Client(LongWritable.class,conf,mockFactory);
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",10);
  try {
    client.call(new LongWritable(RANDOM.nextLong()),address,null,null,0,conf);
    fail("Expected an exception to have been thrown");
  }
 catch (  IOException e) {
    assertTrue(e.getMessage().contains("Injected fault"));
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testIpcFromHadoop0_20_3() throws IOException {
  doIpcVersionTest(NetworkTraces.HADOOP_0_20_3_RPC_DUMP,NetworkTraces.RESPONSE_TO_HADOOP_0_20_3_RPC);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testIOEOnClientReadResponse() throws Exception {
  doErrorTest(LongWritable.class,LongWritable.class,LongWritable.class,IOEOnReadWritable.class);
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setupConf(){
  conf=new Configuration();
  Client.setPingInterval(conf,PING_INTERVAL);
}

</code></pre>

<pre class="type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that, if a RuntimeException is thrown after creating a socket
 * but before successfully connecting to the IPC server, that the
 * failure is handled properly. This is a regression test for
 * HADOOP-7428.
 */
@Test(timeout=60000) public void testRTEDuringConnectionSetup() throws IOException {
  SocketFactory spyFactory=spy(NetUtils.getDefaultSocketFactory(conf));
  Mockito.doAnswer(new Answer<Socket>(){
    @Override public Socket answer(    InvocationOnMock invocation) throws Throwable {
      Socket s=spy((Socket)invocation.callRealMethod());
      doThrow(new RuntimeException("Injected fault")).when(s).setSoTimeout(anyInt());
      return s;
    }
  }
).when(spyFactory).createSocket();
  Server server=new TestServer(1,true);
  server.start();
  try {
    InetSocketAddress address=NetUtils.getConnectAddress(server);
    Client client=new Client(LongWritable.class,conf,spyFactory);
    try {
      client.call(new LongWritable(RANDOM.nextLong()),address,null,null,0,conf);
      fail("Expected an exception to have been thrown");
    }
 catch (    Exception e) {
      LOG.info("caught expected exception",e);
      assertTrue(StringUtils.stringifyException(e).contains("Injected fault"));
    }
    Mockito.reset(spyFactory);
    client.call(new LongWritable(RANDOM.nextLong()),address,null,null,0,conf);
  }
  finally {
    server.stop();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testHttpGetResponse() throws IOException {
  doIpcVersionTest("GET / HTTP/1.0\r\n\r\n".getBytes(),Server.RECEIVED_HTTP_REQ_RESPONSE.getBytes());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testRTEOnServerReadParam() throws Exception {
  doErrorTest(LongWritable.class,RTEOnReadWritable.class,LongWritable.class,LongWritable.class);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testRTEOnClientReadResponse() throws Exception {
  doErrorTest(LongWritable.class,LongWritable.class,LongWritable.class,RTEOnReadWritable.class);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testConnectionRetriesOnSocketTimeoutExceptions() throws IOException {
  Configuration conf=new Configuration();
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_ON_SOCKET_TIMEOUTS_KEY,0);
  assertRetriesOnSocketTimeouts(conf,1);
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_ON_SOCKET_TIMEOUTS_KEY,3);
  assertRetriesOnSocketTimeouts(conf,4);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testIpcFromHadoop_0_18_13() throws IOException {
  doIpcVersionTest(NetworkTraces.HADOOP_0_18_3_RPC_DUMP,NetworkTraces.RESPONSE_TO_HADOOP_0_18_3_RPC);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
