<h3 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.TestClientRMService (21 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(6)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="19"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('19')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-19"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testForceKillNonExistingApplication() throws YarnException {
  RMContext rmContext=mock(RMContext.class);
  when(rmContext.getRMApps()).thenReturn(new ConcurrentHashMap<ApplicationId,RMApp>());
  ClientRMService rmService=new ClientRMService(rmContext,null,null,null,null,null);
  ApplicationId applicationId=BuilderUtils.newApplicationId(System.currentTimeMillis(),0);
  KillApplicationRequest request=KillApplicationRequest.newInstance(applicationId);
  try {
    rmService.forceKillApplication(request);
    Assert.fail();
  }
 catch (  ApplicationNotFoundException ex) {
    Assert.assertEquals(ex.getMessage(),"Trying to kill an absent " + "application " + request.getApplicationId());
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTokenCancellationByOwner() throws Exception {
  RMContext rmContext=mock(RMContext.class);
  final ClientRMService rmService=new ClientRMService(rmContext,null,null,null,null,dtsm);
  testerKerb.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      checkTokenCancellation(rmService,testerKerb,other);
      return null;
    }
  }
);
  owner.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      checkTokenCancellation(owner,other);
      return null;
    }
  }
);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=4000) public void testConcurrentAppSubmit() throws IOException, InterruptedException, BrokenBarrierException, YarnException {
  YarnScheduler yarnScheduler=mockYarnScheduler();
  RMContext rmContext=mock(RMContext.class);
  mockRMContext(yarnScheduler,rmContext);
  RMStateStore stateStore=mock(RMStateStore.class);
  when(rmContext.getStateStore()).thenReturn(stateStore);
  RMAppManager appManager=new RMAppManager(rmContext,yarnScheduler,null,mock(ApplicationACLsManager.class),new Configuration());
  final ApplicationId appId1=getApplicationId(100);
  final ApplicationId appId2=getApplicationId(101);
  final SubmitApplicationRequest submitRequest1=mockSubmitAppRequest(appId1,null,null);
  final SubmitApplicationRequest submitRequest2=mockSubmitAppRequest(appId2,null,null);
  final CyclicBarrier startBarrier=new CyclicBarrier(2);
  final CyclicBarrier endBarrier=new CyclicBarrier(2);
  @SuppressWarnings("rawtypes") EventHandler eventHandler=new EventHandler(){
    @Override public void handle(    Event rawEvent){
      if (rawEvent instanceof RMAppEvent) {
        RMAppEvent event=(RMAppEvent)rawEvent;
        if (event.getApplicationId().equals(appId1)) {
          try {
            startBarrier.await();
            endBarrier.await();
          }
 catch (          BrokenBarrierException e) {
            LOG.warn("Broken Barrier",e);
          }
catch (          InterruptedException e) {
            LOG.warn("Interrupted while awaiting barriers",e);
          }
        }
      }
    }
  }
;
  when(rmContext.getDispatcher().getEventHandler()).thenReturn(eventHandler);
  final ClientRMService rmService=new ClientRMService(rmContext,yarnScheduler,appManager,null,null,null);
  Thread t=new Thread(){
    @Override public void run(){
      try {
        rmService.submitApplication(submitRequest1);
      }
 catch (      YarnException e) {
      }
    }
  }
;
  t.start();
  startBarrier.await();
  rmService.submitApplication(submitRequest2);
  endBarrier.await();
  t.join();
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetQueueInfo() throws Exception {
  YarnScheduler yarnScheduler=mock(YarnScheduler.class);
  RMContext rmContext=mock(RMContext.class);
  mockRMContext(yarnScheduler,rmContext);
  ClientRMService rmService=new ClientRMService(rmContext,yarnScheduler,null,null,null,null);
  GetQueueInfoRequest request=recordFactory.newRecordInstance(GetQueueInfoRequest.class);
  request.setQueueName("testqueue");
  request.setIncludeApplications(true);
  GetQueueInfoResponse queueInfo=rmService.getQueueInfo(request);
  List<ApplicationReport> applications=queueInfo.getQueueInfo().getApplications();
  Assert.assertEquals(2,applications.size());
  request.setQueueName("nonexistentqueue");
  request.setIncludeApplications(true);
  queueInfo=rmService.getQueueInfo(request);
}

</code></pre>

<pre class="type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetApplicationReport() throws YarnException {
  RMContext rmContext=mock(RMContext.class);
  when(rmContext.getRMApps()).thenReturn(new ConcurrentHashMap<ApplicationId,RMApp>());
  ClientRMService rmService=new ClientRMService(rmContext,null,null,null,null,null);
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(null);
  GetApplicationReportRequest request=recordFactory.newRecordInstance(GetApplicationReportRequest.class);
  request.setApplicationId(ApplicationId.newInstance(0,0));
  try {
    rmService.getApplicationReport(request);
    Assert.fail();
  }
 catch (  ApplicationNotFoundException ex) {
    Assert.assertEquals(ex.getMessage(),"Application with id '" + request.getApplicationId() + "' doesn't exist in RM.");
  }
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetApplicationResourceUsageReportDummy() throws YarnException, IOException {
  ApplicationAttemptId attemptId=getApplicationAttemptId(1);
  YarnScheduler yarnScheduler=mockYarnScheduler();
  RMContext rmContext=mock(RMContext.class);
  mockRMContext(yarnScheduler,rmContext);
  when(rmContext.getDispatcher().getEventHandler()).thenReturn(new EventHandler<Event>(){
    public void handle(    Event event){
    }
  }
);
  ApplicationSubmissionContext asContext=mock(ApplicationSubmissionContext.class);
  YarnConfiguration config=new YarnConfiguration();
  RMAppAttemptImpl rmAppAttemptImpl=new RMAppAttemptImpl(attemptId,rmContext,yarnScheduler,null,asContext,config,false);
  ApplicationResourceUsageReport report=rmAppAttemptImpl.getApplicationResourceUsageReport();
  assertEquals(report,RMServerUtils.DUMMY_APPLICATION_RESOURCE_USAGE_REPORT);
}

</code></pre>

<pre class="type-9 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetContainerReport() throws YarnException, IOException {
  ClientRMService rmService=createRMService();
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(null);
  GetContainerReportRequest request=recordFactory.newRecordInstance(GetContainerReportRequest.class);
  ApplicationAttemptId attemptId=ApplicationAttemptId.newInstance(ApplicationId.newInstance(123456,1),1);
  ContainerId containerId=ContainerId.newInstance(attemptId,1);
  request.setContainerId(containerId);
  try {
    GetContainerReportResponse response=rmService.getContainerReport(request);
    Assert.assertEquals(containerId,response.getContainerReport().getContainerId());
  }
 catch (  ApplicationNotFoundException ex) {
    Assert.fail(ex.getMessage());
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTokenRenewalByLoginUser() throws Exception {
  UserGroupInformation.getLoginUser().doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      checkTokenRenewal(owner,owner);
      checkTokenRenewal(owner,other);
      return null;
    }
  }
);
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testForceKillApplication() throws Exception {
  YarnConfiguration conf=new YarnConfiguration();
  MockRM rm=new MockRM();
  rm.init(conf);
  rm.start();
  ClientRMService rmService=rm.getClientRMService();
  GetApplicationsRequest getRequest=GetApplicationsRequest.newInstance(EnumSet.of(YarnApplicationState.KILLED));
  RMApp app1=rm.submitApp(1024);
  RMApp app2=rm.submitApp(1024,true);
  assertEquals("Incorrect number of apps in the RM",0,rmService.getApplications(getRequest).getApplicationList().size());
  KillApplicationRequest killRequest1=KillApplicationRequest.newInstance(app1.getApplicationId());
  KillApplicationRequest killRequest2=KillApplicationRequest.newInstance(app2.getApplicationId());
  int killAttemptCount=0;
  for (int i=0; i < 100; i++) {
    KillApplicationResponse killResponse1=rmService.forceKillApplication(killRequest1);
    killAttemptCount++;
    if (killResponse1.getIsKillCompleted()) {
      break;
    }
    Thread.sleep(10);
  }
  assertTrue("Kill attempt count should be greater than 1 for managed AMs",killAttemptCount > 1);
  assertEquals("Incorrect number of apps in the RM",1,rmService.getApplications(getRequest).getApplicationList().size());
  KillApplicationResponse killResponse2=rmService.forceKillApplication(killRequest2);
  assertTrue("Killing UnmanagedAM should falsely acknowledge true",killResponse2.getIsKillCompleted());
  for (int i=0; i < 100; i++) {
    if (2 == rmService.getApplications(getRequest).getApplicationList().size()) {
      break;
    }
    Thread.sleep(10);
  }
  assertEquals("Incorrect number of apps in the RM",2,rmService.getApplications(getRequest).getApplicationList().size());
}

</code></pre>

<pre class="type-9 type-2 type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) @SuppressWarnings("rawtypes") public void testAppSubmit() throws Exception {
  YarnScheduler yarnScheduler=mockYarnScheduler();
  RMContext rmContext=mock(RMContext.class);
  mockRMContext(yarnScheduler,rmContext);
  RMStateStore stateStore=mock(RMStateStore.class);
  when(rmContext.getStateStore()).thenReturn(stateStore);
  RMAppManager appManager=new RMAppManager(rmContext,yarnScheduler,null,mock(ApplicationACLsManager.class),new Configuration());
  when(rmContext.getDispatcher().getEventHandler()).thenReturn(new EventHandler<Event>(){
    public void handle(    Event event){
    }
  }
);
  ApplicationId appId1=getApplicationId(100);
  ApplicationACLsManager mockAclsManager=mock(ApplicationACLsManager.class);
  when(mockAclsManager.checkAccess(UserGroupInformation.getCurrentUser(),ApplicationAccessType.VIEW_APP,null,appId1)).thenReturn(true);
  QueueACLsManager mockQueueACLsManager=mock(QueueACLsManager.class);
  when(mockQueueACLsManager.checkAccess(any(UserGroupInformation.class),any(QueueACL.class),anyString())).thenReturn(true);
  ClientRMService rmService=new ClientRMService(rmContext,yarnScheduler,appManager,mockAclsManager,mockQueueACLsManager,null);
  SubmitApplicationRequest submitRequest1=mockSubmitAppRequest(appId1,null,null);
  try {
    rmService.submitApplication(submitRequest1);
  }
 catch (  YarnException e) {
    Assert.fail("Exception is not expected.");
  }
  RMApp app1=rmContext.getRMApps().get(appId1);
  Assert.assertNotNull("app doesn't exist",app1);
  Assert.assertEquals("app name doesn't match",YarnConfiguration.DEFAULT_APPLICATION_NAME,app1.getName());
  Assert.assertEquals("app queue doesn't match",YarnConfiguration.DEFAULT_QUEUE_NAME,app1.getQueue());
  String name=MockApps.newAppName();
  String queue=MockApps.newQueue();
  ApplicationId appId2=getApplicationId(101);
  SubmitApplicationRequest submitRequest2=mockSubmitAppRequest(appId2,name,queue);
  submitRequest2.getApplicationSubmissionContext().setApplicationType("matchType");
  try {
    rmService.submitApplication(submitRequest2);
  }
 catch (  YarnException e) {
    Assert.fail("Exception is not expected.");
  }
  RMApp app2=rmContext.getRMApps().get(appId2);
  Assert.assertNotNull("app doesn't exist",app2);
  Assert.assertEquals("app name doesn't match",name,app2.getName());
  Assert.assertEquals("app queue doesn't match",queue,app2.getQueue());
  try {
    rmService.submitApplication(submitRequest2);
  }
 catch (  YarnException e) {
    Assert.fail("Exception is not expected.");
  }
  GetApplicationsRequest getAllAppsRequest=GetApplicationsRequest.newInstance(new HashSet<String>());
  GetApplicationsResponse getAllApplicationsResponse=rmService.getApplications(getAllAppsRequest);
  Assert.assertEquals(5,getAllApplicationsResponse.getApplicationList().size());
  Set<String> appTypes=new HashSet<String>();
  appTypes.add("matchType");
  getAllAppsRequest=GetApplicationsRequest.newInstance(appTypes);
  getAllApplicationsResponse=rmService.getApplications(getAllAppsRequest);
  Assert.assertEquals(1,getAllApplicationsResponse.getApplicationList().size());
  Assert.assertEquals(appId2,getAllApplicationsResponse.getApplicationList().get(0).getApplicationId());
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ApplicationNotFoundException.class) public void testMoveAbsentApplication() throws YarnException {
  RMContext rmContext=mock(RMContext.class);
  when(rmContext.getRMApps()).thenReturn(new ConcurrentHashMap<ApplicationId,RMApp>());
  ClientRMService rmService=new ClientRMService(rmContext,null,null,null,null,null);
  ApplicationId applicationId=BuilderUtils.newApplicationId(System.currentTimeMillis(),0);
  MoveApplicationAcrossQueuesRequest request=MoveApplicationAcrossQueuesRequest.newInstance(applicationId,"newqueue");
  rmService.moveApplicationAcrossQueues(request);
}

</code></pre>

<pre class="type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenRenewalWrongUser() throws Exception {
  try {
    owner.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        try {
          checkTokenRenewal(owner,other);
          return null;
        }
 catch (        YarnException ex) {
          Assert.assertTrue(ex.getMessage().contains(owner.getUserName() + " tries to renew a token with renewer " + other.getUserName()));
          throw ex;
        }
      }
    }
);
  }
 catch (  Exception e) {
    return;
  }
  Assert.fail("renew should have failed");
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTokenCancellationByRenewer() throws Exception {
  RMContext rmContext=mock(RMContext.class);
  final ClientRMService rmService=new ClientRMService(rmContext,null,null,null,null,dtsm);
  testerKerb.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      checkTokenCancellation(rmService,owner,testerKerb);
      return null;
    }
  }
);
  other.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      checkTokenCancellation(owner,other);
      return null;
    }
  }
);
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void teardownSecretManager(){
  if (dtsm != null) {
    dtsm.stopThreads();
  }
}

</code></pre>

<pre class="type-9 type-7 type-19 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetClusterNodes() throws Exception {
  MockRM rm=new MockRM(){
    protected ClientRMService createClientRMService(){
      return new ClientRMService(this.rmContext,scheduler,this.rmAppManager,this.applicationACLsManager,this.queueACLsManager,this.getRMContext().getRMDelegationTokenSecretManager());
    }
  }
;
  rm.start();
  MockNM node=rm.registerNode("host1:1234",1024);
  rm.sendNodeStarted(node);
  node.nodeHeartbeat(true);
  MockNM lostNode=rm.registerNode("host2:1235",1024);
  rm.sendNodeStarted(lostNode);
  lostNode.nodeHeartbeat(true);
  rm.NMwaitForState(lostNode.getNodeId(),NodeState.RUNNING);
  rm.sendNodeLost(lostNode);
  Configuration conf=new Configuration();
  YarnRPC rpc=YarnRPC.create(conf);
  InetSocketAddress rmAddress=rm.getClientRMService().getBindAddress();
  LOG.info("Connecting to ResourceManager at " + rmAddress);
  ApplicationClientProtocol client=(ApplicationClientProtocol)rpc.getProxy(ApplicationClientProtocol.class,rmAddress,conf);
  GetClusterNodesRequest request=GetClusterNodesRequest.newInstance(EnumSet.of(NodeState.RUNNING));
  List<NodeReport> nodeReports=client.getClusterNodes(request).getNodeReports();
  Assert.assertEquals(1,nodeReports.size());
  Assert.assertNotSame("Node is expected to be healthy!",NodeState.UNHEALTHY,nodeReports.get(0).getNodeState());
  node.nodeHeartbeat(false);
  nodeReports=client.getClusterNodes(request).getNodeReports();
  Assert.assertEquals("Unhealthy nodes should not show up by default",0,nodeReports.size());
  request=GetClusterNodesRequest.newInstance(EnumSet.of(NodeState.UNHEALTHY));
  nodeReports=client.getClusterNodes(request).getNodeReports();
  Assert.assertEquals(1,nodeReports.size());
  Assert.assertEquals("Node is expected to be unhealthy!",NodeState.UNHEALTHY,nodeReports.get(0).getNodeState());
  rm.registerNode("host3:1236",1024);
  request=GetClusterNodesRequest.newInstance(EnumSet.allOf(NodeState.class));
  nodeReports=client.getClusterNodes(request).getNodeReports();
  Assert.assertEquals(3,nodeReports.size());
}

</code></pre>

<pre class="type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetApplicationAttemptReport() throws YarnException, IOException {
  ClientRMService rmService=createRMService();
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(null);
  GetApplicationAttemptReportRequest request=recordFactory.newRecordInstance(GetApplicationAttemptReportRequest.class);
  ApplicationAttemptId attemptId=ApplicationAttemptId.newInstance(ApplicationId.newInstance(123456,1),1);
  request.setApplicationAttemptId(attemptId);
  try {
    GetApplicationAttemptReportResponse response=rmService.getApplicationAttemptReport(request);
    Assert.assertEquals(attemptId,response.getApplicationAttemptReport().getApplicationAttemptId());
  }
 catch (  ApplicationNotFoundException ex) {
    Assert.fail(ex.getMessage());
  }
}

</code></pre>

<pre class="type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetApplicationAttempts() throws YarnException, IOException {
  ClientRMService rmService=createRMService();
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(null);
  GetApplicationAttemptsRequest request=recordFactory.newRecordInstance(GetApplicationAttemptsRequest.class);
  ApplicationAttemptId attemptId=ApplicationAttemptId.newInstance(ApplicationId.newInstance(123456,1),1);
  request.setApplicationId(ApplicationId.newInstance(123456,1));
  try {
    GetApplicationAttemptsResponse response=rmService.getApplicationAttempts(request);
    Assert.assertEquals(1,response.getApplicationAttemptList().size());
    Assert.assertEquals(attemptId,response.getApplicationAttemptList().get(0).getApplicationAttemptId());
  }
 catch (  ApplicationNotFoundException ex) {
    Assert.fail(ex.getMessage());
  }
}

</code></pre>

<pre class="type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenCancellationByWrongUser(){
  RMContext rmContext=mock(RMContext.class);
  final ClientRMService rmService=new ClientRMService(rmContext,null,null,null,null,dtsm);
  UserGroupInformation[] kerbTestOwners={owner,other,tester,ownerKerb,otherKerb};
  UserGroupInformation[] kerbTestRenewers={owner,other,ownerKerb,otherKerb};
  for (  final UserGroupInformation tokOwner : kerbTestOwners) {
    for (    final UserGroupInformation tokRenewer : kerbTestRenewers) {
      try {
        testerKerb.doAs(new PrivilegedExceptionAction<Void>(){
          @Override public Void run() throws Exception {
            try {
              checkTokenCancellation(rmService,tokOwner,tokRenewer);
              Assert.fail("We should not reach here; token owner = " + tokOwner.getUserName() + ", renewer = "+ tokRenewer.getUserName());
              return null;
            }
 catch (            YarnException e) {
              Assert.assertTrue(e.getMessage().contains(testerKerb.getUserName() + " is not authorized to cancel the token"));
              return null;
            }
          }
        }
);
      }
 catch (      Exception e) {
        Assert.fail("Unexpected exception; " + e.getMessage());
      }
    }
  }
  UserGroupInformation[] simpleTestOwners={owner,other,ownerKerb,otherKerb,testerKerb};
  UserGroupInformation[] simpleTestRenewers={owner,other,ownerKerb,otherKerb};
  for (  final UserGroupInformation tokOwner : simpleTestOwners) {
    for (    final UserGroupInformation tokRenewer : simpleTestRenewers) {
      try {
        tester.doAs(new PrivilegedExceptionAction<Void>(){
          @Override public Void run() throws Exception {
            try {
              checkTokenCancellation(tokOwner,tokRenewer);
              Assert.fail("We should not reach here; token owner = " + tokOwner.getUserName() + ", renewer = "+ tokRenewer.getUserName());
              return null;
            }
 catch (            YarnException ex) {
              Assert.assertTrue(ex.getMessage().contains(tester.getUserName() + " is not authorized to cancel the token"));
              return null;
            }
          }
        }
);
      }
 catch (      Exception e) {
        Assert.fail("Unexpected exception; " + e.getMessage());
      }
    }
  }
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetApplications() throws IOException, YarnException {
  YarnScheduler yarnScheduler=mockYarnScheduler();
  RMContext rmContext=mock(RMContext.class);
  mockRMContext(yarnScheduler,rmContext);
  RMStateStore stateStore=mock(RMStateStore.class);
  when(rmContext.getStateStore()).thenReturn(stateStore);
  RMAppManager appManager=new RMAppManager(rmContext,yarnScheduler,null,mock(ApplicationACLsManager.class),new Configuration());
  when(rmContext.getDispatcher().getEventHandler()).thenReturn(new EventHandler<Event>(){
    public void handle(    Event event){
    }
  }
);
  ApplicationACLsManager mockAclsManager=mock(ApplicationACLsManager.class);
  QueueACLsManager mockQueueACLsManager=mock(QueueACLsManager.class);
  when(mockQueueACLsManager.checkAccess(any(UserGroupInformation.class),any(QueueACL.class),anyString())).thenReturn(true);
  ClientRMService rmService=new ClientRMService(rmContext,yarnScheduler,appManager,mockAclsManager,mockQueueACLsManager,null);
  String[] queues={QUEUE_1,QUEUE_2};
  String[] appNames={MockApps.newAppName(),MockApps.newAppName(),MockApps.newAppName()};
  ApplicationId[] appIds={getApplicationId(101),getApplicationId(102),getApplicationId(103)};
  List<String> tags=Arrays.asList("Tag1","Tag2","Tag3");
  long[] submitTimeMillis=new long[3];
  for (int i=0; i < appIds.length; i++) {
    ApplicationId appId=appIds[i];
    when(mockAclsManager.checkAccess(UserGroupInformation.getCurrentUser(),ApplicationAccessType.VIEW_APP,null,appId)).thenReturn(true);
    SubmitApplicationRequest submitRequest=mockSubmitAppRequest(appId,appNames[i],queues[i % queues.length],new HashSet<String>(tags.subList(0,i + 1)));
    rmService.submitApplication(submitRequest);
    submitTimeMillis[i]=System.currentTimeMillis();
  }
  GetApplicationsRequest request=GetApplicationsRequest.newInstance();
  assertEquals("Incorrect total number of apps",6,rmService.getApplications(request).getApplicationList().size());
  request.setLimit(1L);
  assertEquals("Failed to limit applications",1,rmService.getApplications(request).getApplicationList().size());
  request=GetApplicationsRequest.newInstance();
  request.setStartRange(submitTimeMillis[0],System.currentTimeMillis());
  assertEquals("Incorrect number of matching start range",2,rmService.getApplications(request).getApplicationList().size());
  request.setStartRange(submitTimeMillis[1],System.currentTimeMillis());
  assertEquals("Incorrect number of matching start range",1,rmService.getApplications(request).getApplicationList().size());
  request.setStartRange(submitTimeMillis[2],System.currentTimeMillis());
  assertEquals("Incorrect number of matching start range",0,rmService.getApplications(request).getApplicationList().size());
  request=GetApplicationsRequest.newInstance();
  Set<String> queueSet=new HashSet<String>();
  request.setQueues(queueSet);
  queueSet.add(queues[0]);
  assertEquals("Incorrect number of applications in queue",2,rmService.getApplications(request).getApplicationList().size());
  assertEquals("Incorrect number of applications in queue",2,rmService.getApplications(request,false).getApplicationList().size());
  queueSet.add(queues[1]);
  assertEquals("Incorrect number of applications in queue",3,rmService.getApplications(request).getApplicationList().size());
  request=GetApplicationsRequest.newInstance();
  Set<String> userSet=new HashSet<String>();
  request.setUsers(userSet);
  userSet.add("random-user-name");
  assertEquals("Incorrect number of applications for user",0,rmService.getApplications(request).getApplicationList().size());
  userSet.add(UserGroupInformation.getCurrentUser().getShortUserName());
  assertEquals("Incorrect number of applications for user",3,rmService.getApplications(request).getApplicationList().size());
  request=GetApplicationsRequest.newInstance(ApplicationsRequestScope.ALL,null,null,null,null,null,null,null,null);
  Set<String> tagSet=new HashSet<String>();
  request.setApplicationTags(tagSet);
  assertEquals("Incorrect number of matching tags",6,rmService.getApplications(request).getApplicationList().size());
  tagSet=Sets.newHashSet(tags.get(0));
  request.setApplicationTags(tagSet);
  assertEquals("Incorrect number of matching tags",3,rmService.getApplications(request).getApplicationList().size());
  tagSet=Sets.newHashSet(tags.get(1));
  request.setApplicationTags(tagSet);
  assertEquals("Incorrect number of matching tags",2,rmService.getApplications(request).getApplicationList().size());
  tagSet=Sets.newHashSet(tags.get(2));
  request.setApplicationTags(tagSet);
  assertEquals("Incorrect number of matching tags",1,rmService.getApplications(request).getApplicationList().size());
  request=GetApplicationsRequest.newInstance(ApplicationsRequestScope.VIEWABLE);
  assertEquals("Incorrect number of applications for the scope",6,rmService.getApplications(request).getApplicationList().size());
  request=GetApplicationsRequest.newInstance(ApplicationsRequestScope.OWN);
  assertEquals("Incorrect number of applications for the scope",3,rmService.getApplications(request).getApplicationList().size());
}

</code></pre>

<pre class="type-9 type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetContainers() throws YarnException, IOException {
  ClientRMService rmService=createRMService();
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(null);
  GetContainersRequest request=recordFactory.newRecordInstance(GetContainersRequest.class);
  ApplicationAttemptId attemptId=ApplicationAttemptId.newInstance(ApplicationId.newInstance(123456,1),1);
  ContainerId containerId=ContainerId.newInstance(attemptId,1);
  request.setApplicationAttemptId(attemptId);
  try {
    GetContainersResponse response=rmService.getContainers(request);
    Assert.assertEquals(containerId,response.getContainerList().get(0).getContainerId());
  }
 catch (  ApplicationNotFoundException ex) {
    Assert.fail(ex.getMessage());
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTokenRenewalByOwner() throws Exception {
  owner.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      checkTokenRenewal(owner,owner);
      return null;
    }
  }
);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
