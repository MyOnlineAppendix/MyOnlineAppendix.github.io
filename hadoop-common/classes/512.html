<h3 style="margin:0px">Class: org.apache.hadoop.hdfs.server.namenode.TestINodeFile (22 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(14)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(4)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="19"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('19')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-19"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFilesInGetListingOps() throws Exception {
  final Configuration conf=new Configuration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    final DistributedFileSystem hdfs=cluster.getFileSystem();
    final FSDirectory fsdir=cluster.getNamesystem().getFSDirectory();
    hdfs.mkdirs(new Path("/tmp"));
    DFSTestUtil.createFile(hdfs,new Path("/tmp/f1"),0,(short)1,0);
    DFSTestUtil.createFile(hdfs,new Path("/tmp/f2"),0,(short)1,0);
    DFSTestUtil.createFile(hdfs,new Path("/tmp/f3"),0,(short)1,0);
    DirectoryListing dl=cluster.getNameNodeRpc().getListing("/tmp",HdfsFileStatus.EMPTY_NAME,false);
    assertTrue(dl.getPartialListing().length == 3);
    String f2=new String("f2");
    dl=cluster.getNameNodeRpc().getListing("/tmp",f2.getBytes(),false);
    assertTrue(dl.getPartialListing().length == 1);
    INode f2INode=fsdir.getINode("/tmp/f2");
    String f2InodePath="/.reserved/.inodes/" + f2INode.getId();
    dl=cluster.getNameNodeRpc().getListing("/tmp",f2InodePath.getBytes(),false);
    assertTrue(dl.getPartialListing().length == 1);
    hdfs.delete(new Path("/tmp/f2"),false);
    try {
      dl=cluster.getNameNodeRpc().getListing("/tmp",f2InodePath.getBytes(),false);
      fail("Didn't get exception for the deleted startAfter token.");
    }
 catch (    IOException e) {
      assertTrue(e instanceof DirectoryListingStartAfterNotFoundException);
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-9 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPreferredBlockSizeUpperBound(){
  replication=3;
  preferredBlockSize=BLKSIZE_MAXVALUE;
  INodeFile inf=createINodeFile(replication,preferredBlockSize);
  assertEquals("True has to be returned in this case",BLKSIZE_MAXVALUE,inf.getPreferredBlockSize());
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFileUnderConstruction(){
  replication=3;
  final INodeFile file=new INodeFile(INodeId.GRANDFATHER_INODE_ID,null,perm,0L,0L,null,replication,1024L);
  assertFalse(file.isUnderConstruction());
  final String clientName="client";
  final String clientMachine="machine";
  file.toUnderConstruction(clientName,clientMachine);
  assertTrue(file.isUnderConstruction());
  FileUnderConstructionFeature uc=file.getFileUnderConstructionFeature();
  assertEquals(clientName,uc.getClientName());
  assertEquals(clientMachine,uc.getClientMachine());
  file.toCompleteFile(Time.now());
  assertFalse(file.isUnderConstruction());
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests for addressing files using /.reserved/.inodes/<inodeID> in file system
 * operations.
 */
@Test public void testInodeIdBasedPaths() throws Exception {
  Configuration conf=new Configuration();
  conf.setInt(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_DEFAULT);
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_ACLS_ENABLED_KEY,true);
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    DistributedFileSystem fs=cluster.getFileSystem();
    NamenodeProtocols nnRpc=cluster.getNameNodeRpc();
    Path baseDir=getInodePath(INodeId.ROOT_INODE_ID,"testInodeIdBasedPaths");
    Path baseDirRegPath=new Path("/testInodeIdBasedPaths");
    fs.mkdirs(baseDir);
    fs.exists(baseDir);
    long baseDirFileId=nnRpc.getFileInfo(baseDir.toString()).getFileId();
    Path testFileInodePath=getInodePath(baseDirFileId,"test1");
    Path testFileRegularPath=new Path(baseDir,"test1");
    final int testFileBlockSize=1024;
    FileSystemTestHelper.createFile(fs,testFileInodePath,1,testFileBlockSize);
    assertTrue(fs.exists(testFileInodePath));
    FsPermission perm=new FsPermission((short)0666);
    fs.setPermission(testFileInodePath,perm);
    FileStatus fileStatus=fs.getFileStatus(testFileInodePath);
    assertEquals(perm,fileStatus.getPermission());
    fs.setOwner(testFileInodePath,fileStatus.getOwner(),fileStatus.getGroup());
    fs.setTimes(testFileInodePath,0,0);
    fileStatus=fs.getFileStatus(testFileInodePath);
    assertEquals(0,fileStatus.getModificationTime());
    assertEquals(0,fileStatus.getAccessTime());
    fs.setReplication(testFileInodePath,(short)3);
    fileStatus=fs.getFileStatus(testFileInodePath);
    assertEquals(3,fileStatus.getReplication());
    fs.setReplication(testFileInodePath,(short)1);
    assertEquals(testFileBlockSize,nnRpc.getPreferredBlockSize(testFileInodePath.toString()));
{
      fs.isFileClosed(testFileInodePath);
      fs.getAclStatus(testFileInodePath);
      fs.getXAttrs(testFileInodePath);
      fs.listXAttrs(testFileInodePath);
      fs.access(testFileInodePath,FsAction.READ_WRITE);
    }
    String invalidTarget=new Path(baseDir,"invalidTarget").toString();
    String link=new Path(baseDir,"link").toString();
    testInvalidSymlinkTarget(nnRpc,invalidTarget,link);
    String validTarget="/validtarget";
    testValidSymlinkTarget(nnRpc,validTarget,link);
    fs.append(testFileInodePath);
    fs.recoverLease(testFileInodePath);
    LocatedBlocks l1=nnRpc.getBlockLocations(testFileInodePath.toString(),0,Long.MAX_VALUE);
    LocatedBlocks l2=nnRpc.getBlockLocations(testFileRegularPath.toString(),0,Long.MAX_VALUE);
    checkEquals(l1,l2);
    Path renameDst=getInodePath(baseDirFileId,"test2");
    fileStatus=fs.getFileStatus(testFileInodePath);
    fs.rename(testFileInodePath,renameDst);
    fs.rename(renameDst,testFileInodePath);
    assertEquals(fileStatus,fs.getFileStatus(testFileInodePath));
    fs.rename(testFileInodePath,renameDst,Rename.OVERWRITE);
    fs.rename(renameDst,testFileInodePath,Rename.OVERWRITE);
    assertEquals(fileStatus,fs.getFileStatus(testFileInodePath));
    assertEquals(fs.getContentSummary(testFileRegularPath).toString(),fs.getContentSummary(testFileInodePath).toString());
    checkEquals(fs.listFiles(baseDirRegPath,false),fs.listFiles(baseDir,false));
    fs.delete(testFileInodePath,true);
    assertFalse(fs.exists(testFileInodePath));
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-9 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test for the Replication value. Sets a value and checks if it was set
 * correct.
 */
@Test public void testReplication(){
  replication=3;
  preferredBlockSize=128 * 1024 * 1024;
  INodeFile inf=createINodeFile(replication,preferredBlockSize);
  assertEquals("True has to be returned in this case",replication,inf.getFileReplication());
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test verifies inode ID counter and inode map functionality.
 */
@Test public void testInodeId() throws IOException {
  Configuration conf=new Configuration();
  conf.setInt(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_DEFAULT);
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    FSNamesystem fsn=cluster.getNamesystem();
    long lastId=fsn.getLastInodeId();
    int inodeCount=1;
    long expectedLastInodeId=INodeId.ROOT_INODE_ID;
    assertEquals(fsn.dir.rootDir.getId(),INodeId.ROOT_INODE_ID);
    assertEquals(expectedLastInodeId,lastId);
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    FileSystem fs=cluster.getFileSystem();
    Path path=new Path("/test1");
    assertTrue(fs.mkdirs(path));
    assertEquals(++expectedLastInodeId,fsn.getLastInodeId());
    assertEquals(++inodeCount,fsn.dir.getInodeMapSize());
    NamenodeProtocols nnrpc=cluster.getNameNodeRpc();
    DFSTestUtil.createFile(fs,new Path("/test1/file"),1024,(short)1,0);
    assertEquals(++expectedLastInodeId,fsn.getLastInodeId());
    assertEquals(++inodeCount,fsn.dir.getInodeMapSize());
    HdfsFileStatus fileStatus=nnrpc.getFileInfo("/test1/file");
    assertEquals(expectedLastInodeId,fileStatus.getFileId());
    Path renamedPath=new Path("/test2");
    assertTrue(fs.rename(path,renamedPath));
    assertEquals(expectedLastInodeId,fsn.getLastInodeId());
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    assertTrue(fs.delete(renamedPath,true));
    inodeCount-=2;
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    String file1="/test1/file1";
    String file2="/test1/file2";
    DFSTestUtil.createFile(fs,new Path(file1),512,(short)1,0);
    DFSTestUtil.createFile(fs,new Path(file2),512,(short)1,0);
    inodeCount+=3;
    expectedLastInodeId+=3;
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    assertEquals(expectedLastInodeId,fsn.getLastInodeId());
    nnrpc.concat(file2,new String[]{file1});
    inodeCount--;
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    assertEquals(expectedLastInodeId,fsn.getLastInodeId());
    assertTrue(fs.delete(new Path("/test1"),true));
    inodeCount-=2;
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    cluster.restartNameNode();
    cluster.waitActive();
    fsn=cluster.getNamesystem();
    assertEquals(expectedLastInodeId,fsn.getLastInodeId());
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    DFSTestUtil.createFile(fs,new Path("/test2/file2"),1024,(short)1,0);
    expectedLastInodeId+=2;
    inodeCount+=2;
    assertEquals(expectedLastInodeId,fsn.getLastInodeId());
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    FSDataOutputStream outStream=fs.create(new Path("/test3/file"));
    assertTrue(outStream != null);
    expectedLastInodeId+=2;
    inodeCount+=2;
    assertEquals(expectedLastInodeId,fsn.getLastInodeId());
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
    fsn.enterSafeMode(false);
    fsn.saveNamespace();
    fsn.leaveSafeMode();
    outStream.close();
    cluster.restartNameNode();
    cluster.waitActive();
    fsn=cluster.getNamesystem();
    assertEquals(expectedLastInodeId,fsn.getLastInodeId());
    assertEquals(inodeCount,fsn.dir.getInodeMapSize());
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=120000) public void testWriteToDeletedFile() throws IOException {
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  cluster.waitActive();
  FileSystem fs=cluster.getFileSystem();
  Path path=new Path("/test1");
  assertTrue(fs.mkdirs(path));
  int size=conf.getInt(DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_KEY,512);
  byte[] data=new byte[size];
  Path filePath=new Path("/test1/file");
  FSDataOutputStream fos=fs.create(filePath);
  fs.delete(filePath,false);
  try {
    fos.write(data,0,data.length);
    fos.hflush();
    fail("Write should fail after delete");
  }
 catch (  Exception e) {
  }
 finally {
    cluster.shutdown();
  }
}

</code></pre>

<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Check /.reserved path is reserved and cannot be created.
 */
@Test public void testReservedFileNames() throws IOException {
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    FileSystem fs=cluster.getFileSystem();
    ensureReservedFileNamesCannotBeCreated(fs,"/.reserved",false);
    ensureReservedFileNamesCannotBeCreated(fs,"/.reserved",false);
    Path reservedPath=new Path("/.reserved");
    FSDirectory.CHECK_RESERVED_FILE_NAMES=false;
    fs.mkdirs(reservedPath);
    assertTrue(fs.isDirectory(reservedPath));
    ensureReservedFileNamesCannotBeLoaded(cluster);
    FSDirectory.CHECK_RESERVED_FILE_NAMES=false;
    ensureClusterRestartSucceeds(cluster);
    fs.delete(reservedPath,true);
    DFSTestUtil.createFile(fs,reservedPath,10,(short)1,0L);
    assertTrue(!fs.isDirectory(reservedPath));
    ensureReservedFileNamesCannotBeLoaded(cluster);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * IllegalArgumentException is expected for setting below lower bound
 * for PreferredBlockSize.
 * @throws IllegalArgumentException as the result
 */
@Test(expected=IllegalArgumentException.class) public void testPreferredBlockSizeBelowLowerBound() throws IllegalArgumentException {
  replication=3;
  preferredBlockSize=-1;
  createINodeFile(replication,preferredBlockSize);
}

</code></pre>

<pre class="type-9 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDotdotInodePath() throws Exception {
  final Configuration conf=new Configuration();
  MiniDFSCluster cluster=null;
  DFSClient client=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    final DistributedFileSystem hdfs=cluster.getFileSystem();
    final FSDirectory fsdir=cluster.getNamesystem().getFSDirectory();
    final Path dir=new Path("/dir");
    hdfs.mkdirs(dir);
    long dirId=fsdir.getINode(dir.toString()).getId();
    long parentId=fsdir.getINode("/").getId();
    String testPath="/.reserved/.inodes/" + dirId + "/..";
    client=new DFSClient(NameNode.getAddress(conf),conf);
    HdfsFileStatus status=client.getFileInfo(testPath);
    assertTrue(parentId == status.getFileId());
    testPath="/.reserved/.inodes/" + parentId + "/..";
    status=client.getFileInfo(testPath);
    assertTrue(parentId == status.getFileId());
  }
  finally {
    IOUtils.cleanup(LOG,client);
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testXAttrFeature(){
  replication=3;
  preferredBlockSize=128 * 1024 * 1024;
  INodeFile inf=createINodeFile(replication,preferredBlockSize);
  ImmutableList.Builder<XAttr> builder=new ImmutableList.Builder<XAttr>();
  XAttr xAttr=new XAttr.Builder().setNameSpace(XAttr.NameSpace.USER).setName("a1").setValue(new byte[]{0x31,0x32,0x33}).build();
  builder.add(xAttr);
  XAttrFeature f=new XAttrFeature(builder.build());
  inf.addXAttrFeature(f);
  XAttrFeature f1=inf.getXAttrFeature();
  assertEquals(xAttr,f1.getXAttrs().get(0));
  inf.removeXAttrFeature();
  f1=inf.getXAttrFeature();
  assertEquals(f1,null);
}

</code></pre>

<pre class="type-9 type-2 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests for {@link FSDirectory#resolvePath(String,byte[][],FSDirectory)}
 */
@Test public void testInodePath() throws IOException {
  String path="/a/b/c";
  INode inode=createTreeOfInodes(path);
  FSDirectory fsd=Mockito.mock(FSDirectory.class);
  Mockito.doReturn(inode).when(fsd).getInode(Mockito.anyLong());
  assertEquals("/test",FSDirectory.resolvePath("/test",null,fsd));
  byte[][] components=INode.getPathComponents(path);
  String resolvedPath=FSDirectory.resolvePath(path,components,fsd);
  assertEquals(path,resolvedPath);
  components=INode.getPathComponents("/.reserved/.inodes/1");
  resolvedPath=FSDirectory.resolvePath(path,components,fsd);
  assertEquals(path,resolvedPath);
  components=INode.getPathComponents("/.reserved/.inodes/1/");
  assertEquals(path,resolvedPath);
  components=INode.getPathComponents("/.reserved/.inodes/1/d/e/f");
  resolvedPath=FSDirectory.resolvePath(path,components,fsd);
  assertEquals("/a/b/c/d/e/f",resolvedPath);
  String testPath="/.reserved/.inodes";
  components=INode.getPathComponents(testPath);
  resolvedPath=FSDirectory.resolvePath(testPath,components,fsd);
  assertEquals(testPath,resolvedPath);
  testPath="/.reserved/.inodes/" + INodeId.ROOT_INODE_ID;
  components=INode.getPathComponents(testPath);
  resolvedPath=FSDirectory.resolvePath(testPath,components,fsd);
  assertEquals("/",resolvedPath);
  testPath="/.invalid/.inodes/1";
  components=INode.getPathComponents(testPath);
  resolvedPath=FSDirectory.resolvePath(testPath,components,fsd);
  assertEquals(testPath,resolvedPath);
  Mockito.doReturn(null).when(fsd).getInode(Mockito.anyLong());
  testPath="/.reserved/.inodes/1234";
  components=INode.getPathComponents(testPath);
  try {
    String realPath=FSDirectory.resolvePath(testPath,components,fsd);
    fail("Path should not be resolved:" + realPath);
  }
 catch (  IOException e) {
    assertTrue(e instanceof FileNotFoundException);
  }
}

</code></pre>

<pre class="type-9 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the static {@link INodeFile#valueOf(INode,String)}and {@link INodeFileUnderConstruction#valueOf(INode,String)} methods.
 * @throws IOException 
 */
@Test public void testValueOf() throws IOException {
  final String path="/testValueOf";
  final short replication=3;
{
    final INode from=null;
    try {
      INodeFile.valueOf(from,path);
      fail();
    }
 catch (    FileNotFoundException fnfe) {
      assertTrue(fnfe.getMessage().contains("File does not exist"));
    }
    try {
      INodeDirectory.valueOf(from,path);
      fail();
    }
 catch (    FileNotFoundException e) {
      assertTrue(e.getMessage().contains("Directory does not exist"));
    }
  }
{
    final INode from=createINodeFile(replication,preferredBlockSize);
    final INodeFile f=INodeFile.valueOf(from,path);
    assertTrue(f == from);
    try {
      INodeDirectory.valueOf(from,path);
      fail();
    }
 catch (    PathIsNotDirectoryException e) {
    }
  }
{
    final INode from=new INodeFile(INodeId.GRANDFATHER_INODE_ID,null,perm,0L,0L,null,replication,1024L);
    from.asFile().toUnderConstruction("client","machine");
    final INodeFile f=INodeFile.valueOf(from,path);
    assertTrue(f == from);
    try {
      INodeDirectory.valueOf(from,path);
      fail();
    }
 catch (    PathIsNotDirectoryException expected) {
    }
  }
{
    final INode from=new INodeDirectory(INodeId.GRANDFATHER_INODE_ID,null,perm,0L);
    try {
      INodeFile.valueOf(from,path);
      fail();
    }
 catch (    FileNotFoundException fnfe) {
      assertTrue(fnfe.getMessage().contains("Path is not a file"));
    }
    final INodeDirectory d=INodeDirectory.valueOf(from,path);
    assertTrue(d == from);
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetFullPathName(){
  replication=3;
  preferredBlockSize=128 * 1024 * 1024;
  INodeFile inf=createINodeFile(replication,preferredBlockSize);
  inf.setLocalName(DFSUtil.string2Bytes("f"));
  INodeDirectory root=new INodeDirectory(INodeId.GRANDFATHER_INODE_ID,INodeDirectory.ROOT_NAME,perm,0L);
  INodeDirectory dir=new INodeDirectory(INodeId.GRANDFATHER_INODE_ID,DFSUtil.string2Bytes("d"),perm,0L);
  assertEquals("f",inf.getFullPathName());
  dir.addChild(inf);
  assertEquals("d" + Path.SEPARATOR + "f",inf.getFullPathName());
  root.addChild(dir);
  assertEquals(Path.SEPARATOR + "d" + Path.SEPARATOR+ "f",inf.getFullPathName());
  assertEquals(Path.SEPARATOR + "d",dir.getFullPathName());
  assertEquals(Path.SEPARATOR,root.getFullPathName());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testConcatBlocks(){
  INodeFile origFile=createINodeFiles(1,"origfile")[0];
  assertEquals("Number of blocks didn't match",origFile.numBlocks(),1L);
  INodeFile[] appendFiles=createINodeFiles(4,"appendfile");
  origFile.concatBlocks(appendFiles);
  assertEquals("Number of blocks didn't match",origFile.numBlocks(),5L);
}

</code></pre>

<pre class="type-9 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test for the PreferredBlockSize value. Sets a value and checks if it was
 * set correct.
 */
@Test public void testPreferredBlockSize(){
  replication=3;
  preferredBlockSize=128 * 1024 * 1024;
  INodeFile inf=createINodeFile(replication,preferredBlockSize);
  assertEquals("True has to be returned in this case",preferredBlockSize,inf.getPreferredBlockSize());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test for {@link FSDirectory#getPathComponents(INode)}
 */
@Test public void testGetPathFromInode() throws QuotaExceededException {
  String path="/a/b/c";
  INode inode=createTreeOfInodes(path);
  byte[][] expected=INode.getPathComponents(path);
  byte[][] actual=FSDirectory.getPathComponents(inode);
  DFSTestUtil.checkComponentsEquals(expected,actual);
}

</code></pre>

<pre class="type-9 type-13 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testLocationLimitInListingOps() throws Exception {
  final Configuration conf=new Configuration();
  conf.setInt(DFSConfigKeys.DFS_LIST_LIMIT,9);
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
    cluster.waitActive();
    final DistributedFileSystem hdfs=cluster.getFileSystem();
    ArrayList<String> source=new ArrayList<String>();
    hdfs.mkdirs(new Path("/tmp1"));
    hdfs.mkdirs(new Path("/tmp2"));
    source.add("f1");
    source.add("f2");
    int numEntries=source.size();
    for (int j=0; j < numEntries; j++) {
      DFSTestUtil.createFile(hdfs,new Path("/tmp1/" + source.get(j)),4096,3 * 1024 - 100,1024,(short)3,0);
    }
    byte[] start=HdfsFileStatus.EMPTY_NAME;
    for (int j=0; j < numEntries; j++) {
      DirectoryListing dl=cluster.getNameNodeRpc().getListing("/tmp1",start,true);
      assertTrue(dl.getPartialListing().length == 1);
      for (int i=0; i < dl.getPartialListing().length; i++) {
        source.remove(dl.getPartialListing()[i].getLocalName());
      }
      start=dl.getLastName();
    }
    assertTrue(source.size() == 0);
    source.add("f1");
    source.add("f2");
    source.add("f3");
    source.add("f4");
    source.add("f5");
    source.add("f6");
    numEntries=source.size();
    for (int j=0; j < numEntries; j++) {
      DFSTestUtil.createFile(hdfs,new Path("/tmp2/" + source.get(j)),4096,3 * 1024 - 100,1024,(short)1,0);
    }
    start=HdfsFileStatus.EMPTY_NAME;
    for (int j=0; j < numEntries / 3; j++) {
      DirectoryListing dl=cluster.getNameNodeRpc().getListing("/tmp2",start,true);
      assertTrue(dl.getPartialListing().length == 3);
      for (int i=0; i < dl.getPartialListing().length; i++) {
        source.remove(dl.getPartialListing()[i].getLocalName());
      }
      start=dl.getLastName();
    }
    assertTrue(source.size() == 0);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * IllegalArgumentException is expected for setting above upper bound
 * for PreferredBlockSize.
 * @throws IllegalArgumentException as the result
 */
@Test(expected=IllegalArgumentException.class) public void testPreferredBlockSizeAboveUpperBound() throws IllegalArgumentException {
  replication=3;
  preferredBlockSize=BLKSIZE_MAXVALUE + 1;
  createINodeFile(replication,preferredBlockSize);
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * IllegalArgumentException is expected for setting below lower bound
 * for Replication.
 * @throws IllegalArgumentException as the result
 */
@Test(expected=IllegalArgumentException.class) public void testReplicationBelowLowerBound() throws IllegalArgumentException {
  replication=-1;
  preferredBlockSize=128 * 1024 * 1024;
  createINodeFile(replication,preferredBlockSize);
}

</code></pre>

<pre class="type-9 type-7 type-10 type-19 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test whether the inode in inodeMap has been replaced after regular inode
 * replacement
 */
@Test public void testInodeReplacement() throws Exception {
  final Configuration conf=new Configuration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive();
    final DistributedFileSystem hdfs=cluster.getFileSystem();
    final FSDirectory fsdir=cluster.getNamesystem().getFSDirectory();
    final Path dir=new Path("/dir");
    hdfs.mkdirs(dir);
    INodeDirectory dirNode=getDir(fsdir,dir);
    INode dirNodeFromNode=fsdir.getInode(dirNode.getId());
    assertSame(dirNode,dirNodeFromNode);
    hdfs.setQuota(dir,Long.MAX_VALUE - 1,Long.MAX_VALUE - 1);
    dirNode=getDir(fsdir,dir);
    assertTrue(dirNode.isWithQuota());
    dirNodeFromNode=fsdir.getInode(dirNode.getId());
    assertSame(dirNode,dirNodeFromNode);
    hdfs.setQuota(dir,-1,-1);
    dirNode=getDir(fsdir,dir);
    dirNodeFromNode=fsdir.getInode(dirNode.getId());
    assertSame(dirNode,dirNodeFromNode);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * FSDirectory#unprotectedSetQuota creates a new INodeDirectoryWithQuota to
 * replace the original INodeDirectory. Before HDFS-4243, the parent field of
 * all the children INodes of the target INodeDirectory is not changed to
 * point to the new INodeDirectoryWithQuota. This testcase tests this
 * scenario.
 */
@Test public void testGetFullPathNameAfterSetQuota() throws Exception {
  long fileLen=1024;
  replication=3;
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(replication).build();
    cluster.waitActive();
    FSNamesystem fsn=cluster.getNamesystem();
    FSDirectory fsdir=fsn.getFSDirectory();
    DistributedFileSystem dfs=cluster.getFileSystem();
    final Path dir=new Path("/dir");
    final Path file=new Path(dir,"file");
    DFSTestUtil.createFile(dfs,file,fileLen,replication,0L);
    INode fnode=fsdir.getINode(file.toString());
    assertEquals(file.toString(),fnode.getFullPathName());
    dfs.setQuota(dir,Long.MAX_VALUE - 1,replication * fileLen * 10);
    INodeDirectory dirNode=getDir(fsdir,dir);
    assertEquals(dir.toString(),dirNode.getFullPathName());
    assertTrue(dirNode.isWithQuota());
    final Path newDir=new Path("/newdir");
    final Path newFile=new Path(newDir,"file");
    dfs.rename(dir,newDir,Options.Rename.OVERWRITE);
    fnode=fsdir.getINode(newFile.toString());
    assertEquals(newFile.toString(),fnode.getFullPathName());
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
