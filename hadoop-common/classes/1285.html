<h3 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.monitor.capacity.TestProportionalCapacityPreemptionPolicy (19 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(16)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPreemptSkippedAMContainers(){
  int[][] qData=new int[][]{{100,10,90},{100,100,100},{100,100,0},{70,20,90},{0,0,0},{5,4,1},{-1,5,5},{2,0,0}};
  setAMContainer=true;
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(5)).handle(argThat(new IsPreemptionRequestFor(appD)));
  verify(mDisp,times(5)).handle(argThat(new IsPreemptionRequestFor(appC)));
  verify(mDisp,times(4)).handle(argThat(new IsPreemptionRequestFor(appB)));
  verify(mDisp,times(4)).handle(argThat(new IsPreemptionRequestFor(appA)));
  setAMContainer=false;
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testProportionalPreemption(){
  int[][] qData=new int[][]{{100,10,40,20,30},{100,100,100,100,100},{100,30,60,10,0},{45,20,5,20,0},{0,0,0,0,0},{3,1,1,1,0},{-1,1,1,1,1},{4,0,0,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(16)).handle(argThat(new IsPreemptionRequestFor(appA)));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testHierarchical(){
  int[][] qData=new int[][]{{200,100,50,50,100,10,90},{200,200,200,200,200,200,200},{200,110,60,50,90,90,0},{10,0,0,0,10,0,10},{0,0,0,0,0,0,0},{4,2,1,1,2,1,1},{-1,-1,1,1,-1,1,1},{2,2,0,0,2,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(10)).handle(argThat(new IsPreemptionRequestFor(appA)));
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpireKill(){
  final long killTime=10000L;
  int[][] qData=new int[][]{{100,40,40,20},{100,100,100,100},{100,0,60,40},{10,10,0,0},{0,0,0,0},{3,1,1,1},{-1,1,1,1},{3,0,0,0}};
  conf.setLong(WAIT_TIME_BEFORE_KILL,killTime);
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  when(mClock.getTime()).thenReturn(0L);
  policy.editSchedule();
  verify(mDisp,times(10)).handle(argThat(new IsPreemptionRequestFor(appC)));
  when(mClock.getTime()).thenReturn(killTime / 2);
  policy.editSchedule();
  verify(mDisp,times(20)).handle(argThat(new IsPreemptionRequestFor(appC)));
  when(mClock.getTime()).thenReturn(killTime + 1);
  policy.editSchedule();
  verify(mDisp,times(30)).handle(evtCaptor.capture());
  List<ContainerPreemptEvent> events=evtCaptor.getAllValues();
  for (  ContainerPreemptEvent e : events.subList(20,30)) {
    assertEquals(appC,e.getAppId());
    assertEquals(KILL_CONTAINER,e.getType());
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOverCapacityImbalance(){
  int[][] qData=new int[][]{{100,40,40,20},{100,100,100,100},{100,55,45,0},{20,10,10,0},{0,0,0,0},{2,1,1,0},{-1,1,1,0},{3,0,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(5)).handle(argThat(new IsPreemptionRequestFor(appA)));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testIgnore(){
  int[][] qData=new int[][]{{100,40,40,20},{100,100,100,100},{100,0,60,40},{0,0,0,0},{0,0,0,0},{3,1,1,1},{-1,1,1,1},{3,0,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,never()).handle(isA(ContainerPreemptEvent.class));
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before @SuppressWarnings("unchecked") public void setup(){
  conf=new Configuration(false);
  conf.setLong(WAIT_TIME_BEFORE_KILL,10000);
  conf.setLong(MONITORING_INTERVAL,3000);
  conf.setFloat(TOTAL_PREEMPTION_PER_ROUND,(float)1.0);
  conf.setFloat(NATURAL_TERMINATION_FACTOR,(float)1.0);
  mClock=mock(Clock.class);
  mCS=mock(CapacityScheduler.class);
  when(mCS.getResourceCalculator()).thenReturn(rc);
  mDisp=mock(EventHandler.class);
  rand=new Random();
  long seed=rand.nextLong();
  System.out.println(name.getMethodName() + " SEED: " + seed);
  rand.setSeed(seed);
  appAlloc=0;
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNaturalTermination(){
  int[][] qData=new int[][]{{100,40,40,20},{100,100,100,100},{100,55,45,0},{20,10,10,0},{0,0,0,0},{2,1,1,0},{-1,1,1,0},{3,0,0,0}};
  conf.setFloat(NATURAL_TERMINATION_FACTOR,(float)0.1);
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,never()).handle(isA(ContainerPreemptEvent.class));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMaxCap(){
  int[][] qData=new int[][]{{100,40,40,20},{100,100,45,100},{100,55,45,0},{20,10,10,0},{0,0,0,0},{2,1,1,0},{-1,1,1,0},{3,0,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,never()).handle(argThat(new IsPreemptionRequestFor(appA)));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testZeroGuar(){
  int[][] qData=new int[][]{{200,100,0,99,100,10,90},{200,200,200,200,200,200,200},{170,80,60,20,90,90,0},{10,0,0,0,10,0,10},{0,0,0,0,0,0,0},{4,2,1,1,2,1,1},{-1,-1,1,1,-1,1,1},{2,2,0,0,2,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,never()).handle(argThat(new IsPreemptionRequestFor(appA)));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testHierarchicalLarge(){
  int[][] qData=new int[][]{{400,200,60,140,100,70,30,100,10,90},{400,400,400,400,400,400,400,400,400,400},{400,210,70,140,100,50,50,90,90,0},{10,0,0,0,0,0,0,0,0,15},{0,0,0,0,0,0,0,0,0,0},{6,2,1,1,2,1,1,2,1,1},{-1,-1,1,1,-1,1,1,-1,1,1},{3,2,0,0,2,0,0,2,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(9)).handle(argThat(new IsPreemptionRequestFor(appA)));
  verify(mDisp,times(4)).handle(argThat(new IsPreemptionRequestFor(appE)));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testObserveOnly(){
  int[][] qData=new int[][]{{100,40,40,20},{100,100,100,100},{100,90,10,0},{80,10,20,50},{0,0,0,0},{2,1,1,0},{-1,1,1,0},{3,0,0,0}};
  conf.setBoolean(OBSERVE_ONLY,true);
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,never()).handle(isA(ContainerPreemptEvent.class));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPreemptCycle(){
  int[][] qData=new int[][]{{100,40,40,20},{100,100,100,100},{100,0,60,40},{10,10,0,0},{0,0,0,0},{3,1,1,1},{-1,1,1,1},{3,0,0,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(10)).handle(argThat(new IsPreemptionRequestFor(appC)));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testZeroGuarOverCap(){
  int[][] qData=new int[][]{{200,100,0,99,0,100,100},{200,200,200,200,200,200,200},{170,170,60,20,90,0,0},{85,50,30,10,10,20,20},{0,0,0,0,0,0,0},{4,3,1,1,1,1,1},{-1,-1,1,1,1,-1,1},{2,3,0,0,0,1,0}};
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(14)).handle(argThat(new IsPreemptionRequestFor(appC)));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSkipAMContainer(){
  int[][] qData=new int[][]{{100,50,50},{100,100,100},{100,100,0},{70,20,50},{0,0,0},{5,4,1},{-1,1,1},{2,0,0}};
  setAMContainer=true;
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(24)).handle(argThat(new IsPreemptionRequestFor(appD)));
  verify(mDisp,times(24)).handle(argThat(new IsPreemptionRequestFor(appC)));
  verify(mDisp,times(2)).handle(argThat(new IsPreemptionRequestFor(appB)));
  setAMContainer=false;
}

</code></pre>

<pre class="type-11 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyInitializeAfterSchedulerInitialized(){
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.RM_SCHEDULER_MONITOR_POLICIES,ProportionalCapacityPreemptionPolicy.class.getCanonicalName());
  conf.setBoolean(YarnConfiguration.RM_SCHEDULER_ENABLE_MONITORS,true);
  @SuppressWarnings("resource") MockRM rm=new MockRM(conf);
  rm.init(conf);
  for (  Service service : rm.getRMActiveService().getServices()) {
    if (service instanceof SchedulingMonitor) {
      ProportionalCapacityPreemptionPolicy policy=(ProportionalCapacityPreemptionPolicy)((SchedulingMonitor)service).getSchedulingEditPolicy();
      assertNotNull(policy.getResourceCalculator());
      return;
    }
  }
  fail("Failed to find SchedulingMonitor service, please check what happened");
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeadzone(){
  int[][] qData=new int[][]{{100,40,40,20},{100,100,100,100},{100,39,43,21},{10,10,0,0},{0,0,0,0},{3,1,1,1},{-1,1,1,1},{3,0,0,0}};
  conf.setFloat(MAX_IGNORED_OVER_CAPACITY,(float)0.1);
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,never()).handle(isA(ContainerPreemptEvent.class));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAMResourcePercentForSkippedAMContainers(){
  int[][] qData=new int[][]{{100,10,90},{100,100,100},{100,100,0},{70,20,90},{0,0,0},{5,4,1},{-1,5,5},{2,0,0}};
  setAMContainer=true;
  setAMResourcePercent=0.5f;
  ProportionalCapacityPreemptionPolicy policy=buildPolicy(qData);
  policy.editSchedule();
  verify(mDisp,times(5)).handle(argThat(new IsPreemptionRequestFor(appD)));
  verify(mDisp,times(5)).handle(argThat(new IsPreemptionRequestFor(appC)));
  verify(mDisp,times(4)).handle(argThat(new IsPreemptionRequestFor(appB)));
  verify(mDisp,times(4)).handle(argThat(new IsPreemptionRequestFor(appA)));
  setAMContainer=false;
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testContainerOrdering(){
  List<RMContainer> containers=new ArrayList<RMContainer>();
  ApplicationAttemptId appAttId=ApplicationAttemptId.newInstance(ApplicationId.newInstance(TS,10),0);
  RMContainer rm1=mockContainer(appAttId,5,mock(Resource.class),3);
  RMContainer rm2=mockContainer(appAttId,3,mock(Resource.class),3);
  RMContainer rm3=mockContainer(appAttId,2,mock(Resource.class),2);
  RMContainer rm4=mockContainer(appAttId,1,mock(Resource.class),2);
  RMContainer rm5=mockContainer(appAttId,4,mock(Resource.class),1);
  containers.add(rm3);
  containers.add(rm2);
  containers.add(rm1);
  containers.add(rm5);
  containers.add(rm4);
  ProportionalCapacityPreemptionPolicy.sortContainers(containers);
  assert containers.get(0).equals(rm1);
  assert containers.get(1).equals(rm2);
  assert containers.get(2).equals(rm3);
  assert containers.get(3).equals(rm4);
  assert containers.get(4).equals(rm5);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
