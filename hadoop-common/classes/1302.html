<h3 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.TestCapacityScheduler (30 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(19)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(17)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(8)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMoveAppSuccess() throws Exception {
  ResourceScheduler scheduler=resourceManager.getResourceScheduler();
  String host_0="host_0";
  NodeManager nm_0=registerNode(host_0,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(5 * GB,1));
  String host_1="host_1";
  NodeManager nm_1=registerNode(host_1,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(5 * GB,1));
  Priority priority_0=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(0);
  Priority priority_1=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(1);
  Application application_0=new Application("user_0","a1",resourceManager);
  application_0.submit();
  application_0.addNodeManager(host_0,1234,nm_0);
  application_0.addNodeManager(host_1,1234,nm_1);
  Resource capability_0_0=Resources.createResource(3 * GB,1);
  application_0.addResourceRequestSpec(priority_1,capability_0_0);
  Resource capability_0_1=Resources.createResource(2 * GB,1);
  application_0.addResourceRequestSpec(priority_0,capability_0_1);
  Task task_0_0=new Task(application_0,priority_1,new String[]{host_0,host_1});
  application_0.addTask(task_0_0);
  Application application_1=new Application("user_1","b2",resourceManager);
  application_1.submit();
  application_1.addNodeManager(host_0,1234,nm_0);
  application_1.addNodeManager(host_1,1234,nm_1);
  Resource capability_1_0=Resources.createResource(1 * GB,1);
  application_1.addResourceRequestSpec(priority_1,capability_1_0);
  Resource capability_1_1=Resources.createResource(2 * GB,1);
  application_1.addResourceRequestSpec(priority_0,capability_1_1);
  Task task_1_0=new Task(application_1,priority_1,new String[]{host_0,host_1});
  application_1.addTask(task_1_0);
  application_0.schedule();
  application_1.schedule();
  scheduler.moveApplication(application_0.getApplicationId(),"b2");
  nodeUpdate(nm_0);
  nodeUpdate(nm_1);
  application_0.schedule();
  checkApplicationResourceUsage(0 * GB,application_0);
  application_1.schedule();
  checkApplicationResourceUsage(1 * GB,application_1);
  checkNodeResourceUsage(1 * GB,nm_0);
  checkNodeResourceUsage(0 * GB,nm_1);
  scheduler.moveApplication(application_0.getApplicationId(),"a2");
  application_0.schedule();
  nodeUpdate(nm_1);
  application_0.schedule();
  checkApplicationResourceUsage(3 * GB,application_0);
  checkNodeResourceUsage(1 * GB,nm_0);
  checkNodeResourceUsage(3 * GB,nm_1);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testAllocateDoesNotBlockOnSchedulerLock() throws Exception {
  final YarnConfiguration conf=new YarnConfiguration();
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  MyContainerManager containerManager=new MyContainerManager();
  final MockRMWithAMS rm=new MockRMWithAMS(conf,containerManager);
  rm.start();
  MockNM nm1=rm.registerNode("localhost:1234",5120);
  Map<ApplicationAccessType,String> acls=new HashMap<ApplicationAccessType,String>(2);
  acls.put(ApplicationAccessType.VIEW_APP,"*");
  RMApp app=rm.submitApp(1024,"appname","appuser",acls);
  nm1.nodeHeartbeat(true);
  RMAppAttempt attempt=app.getCurrentAppAttempt();
  ApplicationAttemptId applicationAttemptId=attempt.getAppAttemptId();
  int msecToWait=10000;
  int msecToSleep=100;
  while (attempt.getAppAttemptState() != RMAppAttemptState.LAUNCHED && msecToWait > 0) {
    LOG.info("Waiting for AppAttempt to reach LAUNCHED state. " + "Current state is " + attempt.getAppAttemptState());
    Thread.sleep(msecToSleep);
    msecToWait-=msecToSleep;
  }
  Assert.assertEquals(attempt.getAppAttemptState(),RMAppAttemptState.LAUNCHED);
  final YarnRPC rpc=YarnRPC.create(conf);
  UserGroupInformation currentUser=UserGroupInformation.createRemoteUser(applicationAttemptId.toString());
  Credentials credentials=containerManager.getContainerCredentials();
  final InetSocketAddress rmBindAddress=rm.getApplicationMasterService().getBindAddress();
  Token<? extends TokenIdentifier> amRMToken=MockRMWithAMS.setupAndReturnAMRMToken(rmBindAddress,credentials.getAllTokens());
  currentUser.addToken(amRMToken);
  ApplicationMasterProtocol client=currentUser.doAs(new PrivilegedAction<ApplicationMasterProtocol>(){
    @Override public ApplicationMasterProtocol run(){
      return (ApplicationMasterProtocol)rpc.getProxy(ApplicationMasterProtocol.class,rmBindAddress,conf);
    }
  }
);
  RegisterApplicationMasterRequest request=RegisterApplicationMasterRequest.newInstance("localhost",12345,"");
  client.registerApplicationMaster(request);
  final CapacityScheduler cs=(CapacityScheduler)rm.getResourceScheduler();
  final CyclicBarrier barrier=new CyclicBarrier(2);
  Thread otherThread=new Thread(new Runnable(){
    @Override public void run(){
synchronized (cs) {
        try {
          barrier.await();
          barrier.await();
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
catch (        BrokenBarrierException e) {
          e.printStackTrace();
        }
      }
    }
  }
);
  otherThread.start();
  barrier.await();
  AllocateRequest allocateRequest=AllocateRequest.newInstance(0,0.0f,null,null,null);
  client.allocate(allocateRequest);
  barrier.await();
  otherThread.join();
  rm.stop();
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReconnectedNode() throws Exception {
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(csConf);
  CapacityScheduler cs=new CapacityScheduler();
  cs.setConf(new YarnConfiguration());
  cs.setRMContext(resourceManager.getRMContext());
  cs.init(csConf);
  cs.start();
  cs.reinitialize(csConf,new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(csConf),new NMTokenSecretManagerInRM(csConf),new ClientToAMTokenSecretManagerInRM(),null));
  RMNode n1=MockNodes.newNodeInfo(0,MockNodes.newResource(4 * GB),1);
  RMNode n2=MockNodes.newNodeInfo(0,MockNodes.newResource(2 * GB),2);
  cs.handle(new NodeAddedSchedulerEvent(n1));
  cs.handle(new NodeAddedSchedulerEvent(n2));
  Assert.assertEquals(6 * GB,cs.getClusterResource().getMemory());
  n1=MockNodes.newNodeInfo(0,MockNodes.newResource(2 * GB),1);
  cs.handle(new NodeRemovedSchedulerEvent(n1));
  cs.handle(new NodeAddedSchedulerEvent(n1));
  Assert.assertEquals(4 * GB,cs.getClusterResource().getMemory());
  cs.stop();
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRefreshQueuesWithNewQueue() throws Exception {
  CapacityScheduler cs=new CapacityScheduler();
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(conf);
  cs.setConf(new YarnConfiguration());
  cs.setRMContext(resourceManager.getRMContext());
  cs.init(conf);
  cs.start();
  cs.reinitialize(conf,new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(conf),new NMTokenSecretManagerInRM(conf),new ClientToAMTokenSecretManagerInRM(),null));
  checkQueueCapacities(cs,A_CAPACITY,B_CAPACITY);
  String B4=B + ".b4";
  float B4_CAPACITY=10;
  B3_CAPACITY-=B4_CAPACITY;
  try {
    conf.setCapacity(A,80f);
    conf.setCapacity(B,20f);
    conf.setQueues(B,new String[]{"b1","b2","b3","b4"});
    conf.setCapacity(B1,B1_CAPACITY);
    conf.setCapacity(B2,B2_CAPACITY);
    conf.setCapacity(B3,B3_CAPACITY);
    conf.setCapacity(B4,B4_CAPACITY);
    cs.reinitialize(conf,mockContext);
    checkQueueCapacities(cs,80f,20f);
    CSQueue rootQueue=cs.getRootQueue();
    CSQueue queueB=findQueue(rootQueue,B);
    CSQueue queueB4=findQueue(queueB,B4);
    assertEquals(queueB,queueB4.getParent());
  }
  finally {
    B3_CAPACITY+=B4_CAPACITY;
    cs.stop();
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveAppSameParent() throws Exception {
  MockRM rm=setUpMove();
  AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
  RMApp app=rm.submitApp(GB,"test-move-1","user_0",null,"a1");
  ApplicationAttemptId appAttemptId=rm.getApplicationReport(app.getApplicationId()).getCurrentApplicationAttemptId();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  String queue=scheduler.getApplicationAttempt(appsInA1.get(0)).getQueue().getQueueName();
  Assert.assertTrue(queue.equals("a1"));
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  List<ApplicationAttemptId> appsInA2=scheduler.getAppsInQueue("a2");
  assertTrue(appsInA2.isEmpty());
  scheduler.moveApplication(app.getApplicationId(),"a2");
  appsInA2=scheduler.getAppsInQueue("a2");
  assertEquals(1,appsInA2.size());
  queue=scheduler.getApplicationAttempt(appsInA2.get(0)).getQueue().getQueueName();
  Assert.assertTrue(queue.equals("a2"));
  appsInA1=scheduler.getAppsInQueue("a1");
  assertTrue(appsInA1.isEmpty());
  appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  rm.stop();
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAsyncScheduling() throws Exception {
  Configuration conf=new Configuration();
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  MockRM rm=new MockRM(conf);
  rm.start();
  CapacityScheduler cs=(CapacityScheduler)rm.getResourceScheduler();
  final int NODES=100;
  for (int i=0; i < NODES; ++i) {
    String host="192.168.1." + i;
    RMNode node=MockNodes.newNodeInfo(0,MockNodes.newResource(4 * GB),1,host);
    cs.handle(new NodeAddedSchedulerEvent(node));
  }
  for (int i=0; i < NODES; ++i) {
    CapacityScheduler.schedule(cs);
  }
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMoveAppQueueMetricsCheck() throws Exception {
  ResourceScheduler scheduler=resourceManager.getResourceScheduler();
  String host_0="host_0";
  NodeManager nm_0=registerNode(host_0,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(5 * GB,1));
  String host_1="host_1";
  NodeManager nm_1=registerNode(host_1,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(5 * GB,1));
  Priority priority_0=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(0);
  Priority priority_1=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(1);
  Application application_0=new Application("user_0","a1",resourceManager);
  application_0.submit();
  application_0.addNodeManager(host_0,1234,nm_0);
  application_0.addNodeManager(host_1,1234,nm_1);
  Resource capability_0_0=Resources.createResource(3 * GB,1);
  application_0.addResourceRequestSpec(priority_1,capability_0_0);
  Resource capability_0_1=Resources.createResource(2 * GB,1);
  application_0.addResourceRequestSpec(priority_0,capability_0_1);
  Task task_0_0=new Task(application_0,priority_1,new String[]{host_0,host_1});
  application_0.addTask(task_0_0);
  Application application_1=new Application("user_1","b2",resourceManager);
  application_1.submit();
  application_1.addNodeManager(host_0,1234,nm_0);
  application_1.addNodeManager(host_1,1234,nm_1);
  Resource capability_1_0=Resources.createResource(1 * GB,1);
  application_1.addResourceRequestSpec(priority_1,capability_1_0);
  Resource capability_1_1=Resources.createResource(2 * GB,1);
  application_1.addResourceRequestSpec(priority_0,capability_1_1);
  Task task_1_0=new Task(application_1,priority_1,new String[]{host_0,host_1});
  application_1.addTask(task_1_0);
  application_0.schedule();
  application_1.schedule();
  nodeUpdate(nm_0);
  nodeUpdate(nm_1);
  CapacityScheduler cs=(CapacityScheduler)resourceManager.getResourceScheduler();
  CSQueue origRootQ=cs.getRootQueue();
  CapacitySchedulerInfo oldInfo=new CapacitySchedulerInfo(origRootQ);
  int origNumAppsA=getNumAppsInQueue("a",origRootQ.getChildQueues());
  int origNumAppsRoot=origRootQ.getNumApplications();
  scheduler.moveApplication(application_0.getApplicationId(),"a2");
  CSQueue newRootQ=cs.getRootQueue();
  int newNumAppsA=getNumAppsInQueue("a",newRootQ.getChildQueues());
  int newNumAppsRoot=newRootQ.getNumApplications();
  CapacitySchedulerInfo newInfo=new CapacitySchedulerInfo(newRootQ);
  CapacitySchedulerLeafQueueInfo origOldA1=(CapacitySchedulerLeafQueueInfo)getQueueInfo("a1",oldInfo.getQueues());
  CapacitySchedulerLeafQueueInfo origNewA1=(CapacitySchedulerLeafQueueInfo)getQueueInfo("a1",newInfo.getQueues());
  CapacitySchedulerLeafQueueInfo targetOldA2=(CapacitySchedulerLeafQueueInfo)getQueueInfo("a2",oldInfo.getQueues());
  CapacitySchedulerLeafQueueInfo targetNewA2=(CapacitySchedulerLeafQueueInfo)getQueueInfo("a2",newInfo.getQueues());
  assertEquals(1,origOldA1.getNumApplications());
  assertEquals(1,origNumAppsA);
  assertEquals(2,origNumAppsRoot);
  assertEquals(0,origNewA1.getNumApplications());
  assertEquals(1,newNumAppsA);
  assertEquals(2,newNumAppsRoot);
  assertEquals(3 * GB,origOldA1.getResourcesUsed().getMemory());
  assertEquals(1,origOldA1.getResourcesUsed().getvCores());
  assertEquals(0,origNewA1.getResourcesUsed().getMemory());
  assertEquals(0,origNewA1.getResourcesUsed().getvCores());
  assertEquals(3 * GB,targetNewA2.getResourcesUsed().getMemory());
  assertEquals(1,targetNewA2.getResourcesUsed().getvCores());
  assertEquals(0,targetOldA2.getNumApplications());
  assertEquals(0,targetOldA2.getResourcesUsed().getMemory());
  assertEquals(0,targetOldA2.getResourcesUsed().getvCores());
  assertEquals(1,targetNewA2.getNumApplications());
  assertEquals(1,origOldA1.getNumContainers());
  assertEquals(0,origNewA1.getNumContainers());
  assertEquals(1,targetNewA2.getNumContainers());
  assertEquals(0,targetOldA2.getNumContainers());
  assertEquals(3 * GB,origOldA1.getUsers().getUsersList().get(0).getResourcesUsed().getMemory());
  assertEquals(1,origOldA1.getUsers().getUsersList().get(0).getResourcesUsed().getvCores());
  assertEquals(0,origNewA1.getUsers().getUsersList().size());
  assertEquals(3 * GB,targetNewA2.getUsers().getUsersList().get(0).getResourcesUsed().getMemory());
  assertEquals(1,targetNewA2.getUsers().getUsersList().get(0).getResourcesUsed().getvCores());
  application_0.schedule();
  checkApplicationResourceUsage(3 * GB,application_0);
  application_1.schedule();
  checkApplicationResourceUsage(1 * GB,application_1);
  checkNodeResourceUsage(4 * GB,nm_0);
  checkNodeResourceUsage(0 * GB,nm_1);
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveAllApps() throws Exception {
  MockRM rm=setUpMove();
  AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
  RMApp app=rm.submitApp(GB,"test-move-1","user_0",null,"a1");
  ApplicationAttemptId appAttemptId=rm.getApplicationReport(app.getApplicationId()).getCurrentApplicationAttemptId();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  String queue=scheduler.getApplicationAttempt(appsInA1.get(0)).getQueue().getQueueName();
  Assert.assertTrue(queue.equals("a1"));
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  List<ApplicationAttemptId> appsInB1=scheduler.getAppsInQueue("b1");
  assertTrue(appsInB1.isEmpty());
  List<ApplicationAttemptId> appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.isEmpty());
  scheduler.moveAllApps("a1","b1");
  Thread.sleep(1000);
  appsInB1=scheduler.getAppsInQueue("b1");
  assertEquals(1,appsInB1.size());
  queue=scheduler.getApplicationAttempt(appsInB1.get(0)).getQueue().getQueueName();
  Assert.assertTrue(queue.equals("b1"));
  appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.contains(appAttemptId));
  assertEquals(1,appsInB.size());
  appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  appsInA1=scheduler.getAppsInQueue("a1");
  assertTrue(appsInA1.isEmpty());
  appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.isEmpty());
  rm.stop();
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=120000) public void testPreemptionInfo() throws Exception {
  Configuration conf=new Configuration();
  conf.setInt(YarnConfiguration.RM_AM_MAX_ATTEMPTS,3);
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  int CONTAINER_MEMORY=1024;
  MockRM rm1=new MockRM(conf);
  rm1.start();
  CapacityScheduler cs=(CapacityScheduler)rm1.getResourceScheduler();
  MockNM nm1=new MockNM("127.0.0.1:1234",15120,rm1.getResourceTrackerService());
  nm1.registerNode();
  RMApp app0=rm1.submitApp(CONTAINER_MEMORY);
  MockAM am0=launchAM(app0,rm1,nm1);
  FiCaSchedulerApp schedulerAppAttempt=cs.getSchedulerApplications().get(app0.getApplicationId()).getCurrentAppAttempt();
  List<Container> allocatedContainers=am0.allocateAndWaitForContainers(3,CONTAINER_MEMORY,nm1);
  for (  Container c : allocatedContainers) {
    cs.killContainer(schedulerAppAttempt.getRMContainer(c.getId()));
  }
  waitForAppPreemptionInfo(app0,Resource.newInstance(CONTAINER_MEMORY * 3,3),0,3,Resource.newInstance(CONTAINER_MEMORY * 3,3),false,3);
  cs.killContainer(schedulerAppAttempt.getRMContainer(app0.getCurrentAppAttempt().getMasterContainer().getId()));
  waitForNewAttemptCreated(app0,am0.getApplicationAttemptId());
  waitForAppPreemptionInfo(app0,Resource.newInstance(CONTAINER_MEMORY * 4,4),1,3,Resource.newInstance(0,0),false,0);
  MockAM am1=launchAM(app0,rm1,nm1);
  schedulerAppAttempt=cs.getSchedulerApplications().get(app0.getApplicationId()).getCurrentAppAttempt();
  allocatedContainers=am1.allocateAndWaitForContainers(3,CONTAINER_MEMORY,nm1);
  for (  Container c : allocatedContainers) {
    cs.killContainer(schedulerAppAttempt.getRMContainer(c.getId()));
  }
  waitForAppPreemptionInfo(app0,Resource.newInstance(CONTAINER_MEMORY * 7,7),1,6,Resource.newInstance(CONTAINER_MEMORY * 3,3),false,3);
  rm1.stop();
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKillAllAppsInQueue() throws Exception {
  MockRM rm=setUpMove();
  AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
  RMApp app=rm.submitApp(GB,"test-move-1","user_0",null,"a1");
  ApplicationAttemptId appAttemptId=rm.getApplicationReport(app.getApplicationId()).getCurrentApplicationAttemptId();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  String queue=scheduler.getApplicationAttempt(appsInA1.get(0)).getQueue().getQueueName();
  Assert.assertTrue(queue.equals("a1"));
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  scheduler.killAllAppsInQueue("a1");
  rm.waitForState(app.getApplicationId(),RMAppState.KILLED);
  appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.isEmpty());
  appsInA1=scheduler.getAppsInQueue("a1");
  assertTrue(appsInA1.isEmpty());
  appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.isEmpty());
  rm.stop();
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMaximumCapacitySetup(){
  float delta=0.0000001f;
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  assertEquals(CapacitySchedulerConfiguration.MAXIMUM_CAPACITY_VALUE,conf.getMaximumCapacity(A),delta);
  conf.setMaximumCapacity(A,50.0f);
  assertEquals(50.0f,conf.getMaximumCapacity(A),delta);
  conf.setMaximumCapacity(A,-1);
  assertEquals(CapacitySchedulerConfiguration.MAXIMUM_CAPACITY_VALUE,conf.getMaximumCapacity(A),delta);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNumClusterNodes() throws Exception {
  YarnConfiguration conf=new YarnConfiguration();
  CapacityScheduler cs=new CapacityScheduler();
  cs.setConf(conf);
  RMContextImpl rmContext=new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(conf),new NMTokenSecretManagerInRM(conf),new ClientToAMTokenSecretManagerInRM(),null);
  cs.setRMContext(rmContext);
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(csConf);
  cs.init(csConf);
  cs.start();
  assertEquals(0,cs.getNumClusterNodes());
  RMNode n1=MockNodes.newNodeInfo(0,MockNodes.newResource(4 * GB),1);
  RMNode n2=MockNodes.newNodeInfo(0,MockNodes.newResource(2 * GB),2);
  cs.handle(new NodeAddedSchedulerEvent(n1));
  cs.handle(new NodeAddedSchedulerEvent(n2));
  assertEquals(2,cs.getNumClusterNodes());
  cs.handle(new NodeRemovedSchedulerEvent(n1));
  assertEquals(1,cs.getNumClusterNodes());
  cs.handle(new NodeAddedSchedulerEvent(n1));
  assertEquals(2,cs.getNumClusterNodes());
  cs.handle(new NodeRemovedSchedulerEvent(n2));
  cs.handle(new NodeRemovedSchedulerEvent(n1));
  assertEquals(0,cs.getNumClusterNodes());
  cs.stop();
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveAppBasic() throws Exception {
  MockRM rm=setUpMove();
  AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
  RMApp app=rm.submitApp(GB,"test-move-1","user_0",null,"a1");
  ApplicationAttemptId appAttemptId=rm.getApplicationReport(app.getApplicationId()).getCurrentApplicationAttemptId();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  String queue=scheduler.getApplicationAttempt(appsInA1.get(0)).getQueue().getQueueName();
  Assert.assertTrue(queue.equals("a1"));
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  List<ApplicationAttemptId> appsInB1=scheduler.getAppsInQueue("b1");
  assertTrue(appsInB1.isEmpty());
  List<ApplicationAttemptId> appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.isEmpty());
  scheduler.moveApplication(app.getApplicationId(),"b1");
  appsInB1=scheduler.getAppsInQueue("b1");
  assertEquals(1,appsInB1.size());
  queue=scheduler.getApplicationAttempt(appsInB1.get(0)).getQueue().getQueueName();
  Assert.assertTrue(queue.equals("b1"));
  appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.contains(appAttemptId));
  assertEquals(1,appsInB.size());
  appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  appsInA1=scheduler.getAppsInQueue("a1");
  assertTrue(appsInA1.isEmpty());
  appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.isEmpty());
  rm.stop();
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=YarnException.class) public void testMoveAppViolateQueueState() throws Exception {
  resourceManager=new ResourceManager();
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(csConf);
  StringBuilder qState=new StringBuilder();
  qState.append(CapacitySchedulerConfiguration.PREFIX).append(B).append(CapacitySchedulerConfiguration.DOT).append(CapacitySchedulerConfiguration.STATE);
  csConf.set(qState.toString(),QueueState.STOPPED.name());
  YarnConfiguration conf=new YarnConfiguration(csConf);
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  resourceManager.init(conf);
  resourceManager.getRMContext().getContainerTokenSecretManager().rollMasterKey();
  resourceManager.getRMContext().getNMTokenSecretManager().rollMasterKey();
  ((AsyncDispatcher)resourceManager.getRMContext().getDispatcher()).start();
  mockContext=mock(RMContext.class);
  when(mockContext.getConfigurationProvider()).thenReturn(new LocalConfigurationProvider());
  ResourceScheduler scheduler=resourceManager.getResourceScheduler();
  String host_0="host_0";
  NodeManager nm_0=registerNode(host_0,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(6 * GB,1));
  Priority priority_0=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(0);
  Priority priority_1=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(1);
  Application application_0=new Application("user_0","a1",resourceManager);
  application_0.submit();
  application_0.addNodeManager(host_0,1234,nm_0);
  Resource capability_0_0=Resources.createResource(3 * GB,1);
  application_0.addResourceRequestSpec(priority_1,capability_0_0);
  Resource capability_0_1=Resources.createResource(2 * GB,1);
  application_0.addResourceRequestSpec(priority_0,capability_0_1);
  Task task_0_0=new Task(application_0,priority_1,new String[]{host_0});
  application_0.addTask(task_0_0);
  application_0.schedule();
  nodeUpdate(nm_0);
  application_0.schedule();
  checkApplicationResourceUsage(3 * GB,application_0);
  checkNodeResourceUsage(3 * GB,nm_0);
  scheduler.moveApplication(application_0.getApplicationId(),"b1");
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddAndRemoveAppFromCapacityScheduler() throws Exception {
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(conf);
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  MockRM rm=new MockRM(conf);
  @SuppressWarnings("unchecked") AbstractYarnScheduler<SchedulerApplicationAttempt,SchedulerNode> cs=(AbstractYarnScheduler<SchedulerApplicationAttempt,SchedulerNode>)rm.getResourceScheduler();
  SchedulerApplication<SchedulerApplicationAttempt> app=TestSchedulerUtils.verifyAppAddedAndRemovedFromScheduler(cs.getSchedulerApplications(),cs,"a1");
  Assert.assertEquals("a1",app.getQueue().getQueueName());
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown() throws Exception {
  if (resourceManager != null) {
    resourceManager.stop();
  }
}

</code></pre>

<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=5000) public void testApplicationComparator(){
  CapacityScheduler cs=new CapacityScheduler();
  Comparator<FiCaSchedulerApp> appComparator=cs.getApplicationComparator();
  ApplicationId id1=ApplicationId.newInstance(1,1);
  ApplicationId id2=ApplicationId.newInstance(1,2);
  ApplicationId id3=ApplicationId.newInstance(2,1);
  FiCaSchedulerApp app1=Mockito.mock(FiCaSchedulerApp.class);
  when(app1.getApplicationId()).thenReturn(id1);
  FiCaSchedulerApp app2=Mockito.mock(FiCaSchedulerApp.class);
  when(app2.getApplicationId()).thenReturn(id2);
  FiCaSchedulerApp app3=Mockito.mock(FiCaSchedulerApp.class);
  when(app3.getApplicationId()).thenReturn(id3);
  assertTrue(appComparator.compare(app1,app2) < 0);
  assertTrue(appComparator.compare(app1,app3) < 0);
  assertTrue(appComparator.compare(app2,app3) < 0);
}

</code></pre>

<pre class="type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testConfValidation() throws Exception {
  ResourceScheduler scheduler=new CapacityScheduler();
  scheduler.setRMContext(resourceManager.getRMContext());
  Configuration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_MB,2048);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,1024);
  try {
    scheduler.reinitialize(conf,mockContext);
    fail("Exception is expected because the min memory allocation is" + " larger than the max memory allocation.");
  }
 catch (  YarnRuntimeException e) {
    assertTrue("The thrown exception is not the expected one.",e.getMessage().startsWith("Invalid resource scheduler memory"));
  }
  conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_VCORES,2);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,1);
  try {
    scheduler.reinitialize(conf,mockContext);
    fail("Exception is expected because the min vcores allocation is" + " larger than the max vcores allocation.");
  }
 catch (  YarnRuntimeException e) {
    assertTrue("The thrown exception is not the expected one.",e.getMessage().startsWith("Invalid resource scheduler vcores"));
  }
}

</code></pre>

<pre class="type-9 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testRecoverRequestAfterPreemption() throws Exception {
  Configuration conf=new Configuration();
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  MockRM rm1=new MockRM(conf);
  rm1.start();
  MockNM nm1=rm1.registerNode("127.0.0.1:1234",8000);
  RMApp app1=rm1.submitApp(1024);
  MockAM am1=MockRM.launchAndRegisterAM(app1,rm1,nm1);
  CapacityScheduler cs=(CapacityScheduler)rm1.getResourceScheduler();
  am1.allocate("127.0.0.1",1024,1,new ArrayList<ContainerId>());
  ContainerId containerId1=ContainerId.newInstance(am1.getApplicationAttemptId(),2);
  rm1.waitForState(nm1,containerId1,RMContainerState.ALLOCATED);
  RMContainer rmContainer=cs.getRMContainer(containerId1);
  List<ResourceRequest> requests=rmContainer.getResourceRequests();
  FiCaSchedulerApp app=cs.getApplicationAttempt(am1.getApplicationAttemptId());
  FiCaSchedulerNode node=cs.getNode(rmContainer.getAllocatedNode());
  for (  ResourceRequest request : requests) {
    if (request.getResourceName().equals(node.getRackName()) || request.getResourceName().equals(ResourceRequest.ANY)) {
      continue;
    }
    Assert.assertNull(app.getResourceRequest(request.getPriority(),request.getResourceName()));
  }
  cs.killContainer(rmContainer);
  Assert.assertEquals(3,requests.size());
  for (  ResourceRequest request : requests) {
    Assert.assertEquals(1,app.getResourceRequest(request.getPriority(),request.getResourceName()).getNumContainers());
  }
  ContainerId containerId2=ContainerId.newInstance(am1.getApplicationAttemptId(),3);
  rm1.waitForState(nm1,containerId2,RMContainerState.ALLOCATED);
  List<Container> containers=am1.allocate(new ArrayList<ResourceRequest>(),new ArrayList<ContainerId>()).getAllocatedContainers();
  Assert.assertTrue(containers.size() == 1);
}

</code></pre>

<pre class="type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveAllAppsInvalidDestination() throws Exception {
  MockRM rm=setUpMove();
  AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
  RMApp app=rm.submitApp(GB,"test-move-1","user_0",null,"a1");
  ApplicationAttemptId appAttemptId=rm.getApplicationReport(app.getApplicationId()).getCurrentApplicationAttemptId();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  List<ApplicationAttemptId> appsInB1=scheduler.getAppsInQueue("b1");
  assertTrue(appsInB1.isEmpty());
  List<ApplicationAttemptId> appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.isEmpty());
  try {
    scheduler.moveAllApps("a1","DOES_NOT_EXIST");
    Assert.fail();
  }
 catch (  YarnException e) {
  }
  appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  appsInB1=scheduler.getAppsInQueue("b1");
  assertTrue(appsInB1.isEmpty());
  appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.isEmpty());
  rm.stop();
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRefreshQueues() throws Exception {
  CapacityScheduler cs=new CapacityScheduler();
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  RMContextImpl rmContext=new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(conf),new NMTokenSecretManagerInRM(conf),new ClientToAMTokenSecretManagerInRM(),null);
  setupQueueConfiguration(conf);
  cs.setConf(new YarnConfiguration());
  cs.setRMContext(resourceManager.getRMContext());
  cs.init(conf);
  cs.start();
  cs.reinitialize(conf,rmContext);
  checkQueueCapacities(cs,A_CAPACITY,B_CAPACITY);
  conf.setCapacity(A,80f);
  conf.setCapacity(B,20f);
  cs.reinitialize(conf,mockContext);
  checkQueueCapacities(cs,80f,20f);
  cs.stop();
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCapacityScheduler() throws Exception {
  LOG.info("--- START: testCapacityScheduler ---");
  String host_0="host_0";
  org.apache.hadoop.yarn.server.resourcemanager.NodeManager nm_0=registerNode(host_0,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(4 * GB,1));
  String host_1="host_1";
  org.apache.hadoop.yarn.server.resourcemanager.NodeManager nm_1=registerNode(host_1,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(2 * GB,1));
  Priority priority_0=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(0);
  Priority priority_1=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(1);
  Application application_0=new Application("user_0","a1",resourceManager);
  application_0.submit();
  application_0.addNodeManager(host_0,1234,nm_0);
  application_0.addNodeManager(host_1,1234,nm_1);
  Resource capability_0_0=Resources.createResource(1 * GB,1);
  application_0.addResourceRequestSpec(priority_1,capability_0_0);
  Resource capability_0_1=Resources.createResource(2 * GB,1);
  application_0.addResourceRequestSpec(priority_0,capability_0_1);
  Task task_0_0=new Task(application_0,priority_1,new String[]{host_0,host_1});
  application_0.addTask(task_0_0);
  Application application_1=new Application("user_1","b2",resourceManager);
  application_1.submit();
  application_1.addNodeManager(host_0,1234,nm_0);
  application_1.addNodeManager(host_1,1234,nm_1);
  Resource capability_1_0=Resources.createResource(3 * GB,1);
  application_1.addResourceRequestSpec(priority_1,capability_1_0);
  Resource capability_1_1=Resources.createResource(2 * GB,1);
  application_1.addResourceRequestSpec(priority_0,capability_1_1);
  Task task_1_0=new Task(application_1,priority_1,new String[]{host_0,host_1});
  application_1.addTask(task_1_0);
  application_0.schedule();
  application_1.schedule();
  LOG.info("Kick!");
  nodeUpdate(nm_0);
  nodeUpdate(nm_1);
  application_0.schedule();
  checkApplicationResourceUsage(1 * GB,application_0);
  application_1.schedule();
  checkApplicationResourceUsage(3 * GB,application_1);
  checkNodeResourceUsage(4 * GB,nm_0);
  checkNodeResourceUsage(0 * GB,nm_1);
  LOG.info("Adding new tasks...");
  Task task_1_1=new Task(application_1,priority_0,new String[]{ResourceRequest.ANY});
  application_1.addTask(task_1_1);
  application_1.schedule();
  Task task_0_1=new Task(application_0,priority_0,new String[]{host_0,host_1});
  application_0.addTask(task_0_1);
  application_0.schedule();
  LOG.info("Sending hb from " + nm_0.getHostName());
  nodeUpdate(nm_0);
  LOG.info("Sending hb from " + nm_1.getHostName());
  nodeUpdate(nm_1);
  LOG.info("Trying to allocate...");
  application_0.schedule();
  checkApplicationResourceUsage(1 * GB,application_0);
  application_1.schedule();
  checkApplicationResourceUsage(5 * GB,application_1);
  nodeUpdate(nm_0);
  nodeUpdate(nm_1);
  checkNodeResourceUsage(4 * GB,nm_0);
  checkNodeResourceUsage(2 * GB,nm_1);
  LOG.info("--- END: testCapacityScheduler ---");
}

</code></pre>

<pre class="type-9 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@SuppressWarnings("resource") @Test public void testBlackListNodes() throws Exception {
  Configuration conf=new Configuration();
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  MockRM rm=new MockRM(conf);
  rm.start();
  CapacityScheduler cs=(CapacityScheduler)rm.getResourceScheduler();
  String host="127.0.0.1";
  RMNode node=MockNodes.newNodeInfo(0,MockNodes.newResource(4 * GB),1,host);
  cs.handle(new NodeAddedSchedulerEvent(node));
  ApplicationId appId=BuilderUtils.newApplicationId(100,1);
  ApplicationAttemptId appAttemptId=BuilderUtils.newApplicationAttemptId(appId,1);
  SchedulerEvent addAppEvent=new AppAddedSchedulerEvent(appId,"default","user");
  cs.handle(addAppEvent);
  SchedulerEvent addAttemptEvent=new AppAttemptAddedSchedulerEvent(appAttemptId,false);
  cs.handle(addAttemptEvent);
  cs.allocate(appAttemptId,Collections.<ResourceRequest>emptyList(),Collections.<ContainerId>emptyList(),Collections.singletonList(host),null);
  Assert.assertTrue(cs.getApplicationAttempt(appAttemptId).isBlacklisted(host));
  cs.allocate(appAttemptId,Collections.<ResourceRequest>emptyList(),Collections.<ContainerId>emptyList(),null,Collections.singletonList(host));
  Assert.assertFalse(cs.getApplicationAttempt(appAttemptId).isBlacklisted(host));
  rm.stop();
}

</code></pre>

<pre class="type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCapacitySchedulerInfo() throws Exception {
  QueueInfo queueInfo=resourceManager.getResourceScheduler().getQueueInfo("a",true,true);
  Assert.assertEquals(queueInfo.getQueueName(),"a");
  Assert.assertEquals(queueInfo.getChildQueues().size(),2);
  List<QueueUserACLInfo> userACLInfo=resourceManager.getResourceScheduler().getQueueUserAclInfo();
  Assert.assertNotNull(userACLInfo);
  for (  QueueUserACLInfo queueUserACLInfo : userACLInfo) {
    Assert.assertEquals(getQueueCount(userACLInfo,queueUserACLInfo.getQueueName()),1);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMoveAppForMoveToQueueWithFreeCap() throws Exception {
  ResourceScheduler scheduler=resourceManager.getResourceScheduler();
  String host_0="host_0";
  NodeManager nm_0=registerNode(host_0,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(4 * GB,1));
  String host_1="host_1";
  NodeManager nm_1=registerNode(host_1,1234,2345,NetworkTopology.DEFAULT_RACK,Resources.createResource(2 * GB,1));
  Priority priority_0=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(0);
  Priority priority_1=org.apache.hadoop.yarn.server.resourcemanager.resource.Priority.create(1);
  Application application_0=new Application("user_0","a1",resourceManager);
  application_0.submit();
  application_0.addNodeManager(host_0,1234,nm_0);
  application_0.addNodeManager(host_1,1234,nm_1);
  Resource capability_0_0=Resources.createResource(1 * GB,1);
  application_0.addResourceRequestSpec(priority_1,capability_0_0);
  Resource capability_0_1=Resources.createResource(2 * GB,1);
  application_0.addResourceRequestSpec(priority_0,capability_0_1);
  Task task_0_0=new Task(application_0,priority_1,new String[]{host_0,host_1});
  application_0.addTask(task_0_0);
  Application application_1=new Application("user_1","b2",resourceManager);
  application_1.submit();
  application_1.addNodeManager(host_0,1234,nm_0);
  application_1.addNodeManager(host_1,1234,nm_1);
  Resource capability_1_0=Resources.createResource(1 * GB,1);
  application_1.addResourceRequestSpec(priority_1,capability_1_0);
  Resource capability_1_1=Resources.createResource(2 * GB,1);
  application_1.addResourceRequestSpec(priority_0,capability_1_1);
  Task task_1_0=new Task(application_1,priority_1,new String[]{host_0,host_1});
  application_1.addTask(task_1_0);
  application_0.schedule();
  application_1.schedule();
  nodeUpdate(nm_0);
  nodeUpdate(nm_1);
  application_0.schedule();
  checkApplicationResourceUsage(1 * GB,application_0);
  application_1.schedule();
  checkApplicationResourceUsage(1 * GB,application_1);
  checkNodeResourceUsage(2 * GB,nm_0);
  checkNodeResourceUsage(0 * GB,nm_1);
  scheduler.moveApplication(application_0.getApplicationId(),"b1");
  Task task_1_1=new Task(application_1,priority_0,new String[]{ResourceRequest.ANY});
  application_1.addTask(task_1_1);
  application_1.schedule();
  Task task_0_1=new Task(application_0,priority_0,new String[]{host_0,host_1});
  application_0.addTask(task_0_1);
  application_0.schedule();
  nodeUpdate(nm_0);
  nodeUpdate(nm_1);
  application_1.schedule();
  checkApplicationResourceUsage(3 * GB,application_1);
  application_0.schedule();
  checkApplicationResourceUsage(3 * GB,application_0);
  checkNodeResourceUsage(4 * GB,nm_0);
  checkNodeResourceUsage(2 * GB,nm_1);
}

</code></pre>

<pre class="type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveAllAppsInvalidSource() throws Exception {
  MockRM rm=setUpMove();
  AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
  RMApp app=rm.submitApp(GB,"test-move-1","user_0",null,"a1");
  ApplicationAttemptId appAttemptId=rm.getApplicationReport(app.getApplicationId()).getCurrentApplicationAttemptId();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  List<ApplicationAttemptId> appsInB1=scheduler.getAppsInQueue("b1");
  assertTrue(appsInB1.isEmpty());
  List<ApplicationAttemptId> appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.isEmpty());
  try {
    scheduler.moveAllApps("DOES_NOT_EXIST","b1");
    Assert.fail();
  }
 catch (  YarnException e) {
  }
  appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  appsInB1=scheduler.getAppsInQueue("b1");
  assertTrue(appsInB1.isEmpty());
  appsInB=scheduler.getAppsInQueue("b");
  assertTrue(appsInB.isEmpty());
  rm.stop();
}

</code></pre>

<pre class="type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetAppsInQueue() throws Exception {
  Application application_0=new Application("user_0","a1",resourceManager);
  application_0.submit();
  Application application_1=new Application("user_0","a2",resourceManager);
  application_1.submit();
  Application application_2=new Application("user_0","b2",resourceManager);
  application_2.submit();
  ResourceScheduler scheduler=resourceManager.getResourceScheduler();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(application_0.getApplicationAttemptId()));
  assertTrue(appsInA.contains(application_1.getApplicationAttemptId()));
  assertEquals(2,appsInA.size());
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(application_0.getApplicationAttemptId()));
  assertTrue(appsInRoot.contains(application_1.getApplicationAttemptId()));
  assertTrue(appsInRoot.contains(application_2.getApplicationAttemptId()));
  assertEquals(3,appsInRoot.size());
  Assert.assertNull(scheduler.getAppsInQueue("nonexistentqueue"));
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that parseQueue throws an exception when two leaf queues have the
 * same name
 * @throws IOException
 */
@Test(expected=IOException.class) public void testParseQueue() throws IOException {
  CapacityScheduler cs=new CapacityScheduler();
  cs.setConf(new YarnConfiguration());
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(conf);
  conf.setQueues(CapacitySchedulerConfiguration.ROOT + ".a.a1",new String[]{"b1"});
  conf.setCapacity(CapacitySchedulerConfiguration.ROOT + ".a.a1.b1",100.0f);
  conf.setUserLimitFactor(CapacitySchedulerConfiguration.ROOT + ".a.a1.b1",100.0f);
  cs.reinitialize(conf,new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(conf),new NMTokenSecretManagerInRM(conf),new ClientToAMTokenSecretManagerInRM(),null));
}

</code></pre>

<pre class="type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKillAllAppsInvalidSource() throws Exception {
  MockRM rm=setUpMove();
  AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
  RMApp app=rm.submitApp(GB,"test-move-1","user_0",null,"a1");
  ApplicationAttemptId appAttemptId=rm.getApplicationReport(app.getApplicationId()).getCurrentApplicationAttemptId();
  List<ApplicationAttemptId> appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  List<ApplicationAttemptId> appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  List<ApplicationAttemptId> appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  try {
    scheduler.killAllAppsInQueue("DOES_NOT_EXIST");
    Assert.fail();
  }
 catch (  YarnException e) {
  }
  appsInA1=scheduler.getAppsInQueue("a1");
  assertEquals(1,appsInA1.size());
  appsInA=scheduler.getAppsInQueue("a");
  assertTrue(appsInA.contains(appAttemptId));
  assertEquals(1,appsInA.size());
  appsInRoot=scheduler.getAppsInQueue("root");
  assertTrue(appsInRoot.contains(appAttemptId));
  assertEquals(1,appsInRoot.size());
  rm.stop();
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  resourceManager=new ResourceManager();
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(csConf);
  YarnConfiguration conf=new YarnConfiguration(csConf);
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  resourceManager.init(conf);
  resourceManager.getRMContext().getContainerTokenSecretManager().rollMasterKey();
  resourceManager.getRMContext().getNMTokenSecretManager().rollMasterKey();
  ((AsyncDispatcher)resourceManager.getRMContext().getDispatcher()).start();
  mockContext=mock(RMContext.class);
  when(mockContext.getConfigurationProvider()).thenReturn(new LocalConfigurationProvider());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
