<h3 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestFairScheduler (76 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(65)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(46)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(28)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(17)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(4)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="19"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('19')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-19"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBasicDRFAssignment() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,BuilderUtils.newResource(8192,5));
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  ApplicationAttemptId appAttId1=createSchedulingRequest(2048,1,"queue1","user1",2);
  FSAppAttempt app1=scheduler.getSchedulerApp(appAttId1);
  ApplicationAttemptId appAttId2=createSchedulingRequest(1024,2,"queue1","user1",2);
  FSAppAttempt app2=scheduler.getSchedulerApp(appAttId2);
  DominantResourceFairnessPolicy drfPolicy=new DominantResourceFairnessPolicy();
  drfPolicy.initialize(scheduler.getClusterResource());
  scheduler.getQueueManager().getQueue("queue1").setPolicy(drfPolicy);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app1.getLiveContainers().size());
  Assert.assertEquals(0,app2.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app1.getLiveContainers().size());
  Assert.assertEquals(1,app2.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(2,app1.getLiveContainers().size());
  Assert.assertEquals(1,app2.getLiveContainers().size());
}

</code></pre>

<pre class="type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=2000) public void testLoadConfigurationOnInitialize() throws IOException {
  conf.setBoolean(FairSchedulerConfiguration.ASSIGN_MULTIPLE,true);
  conf.setInt(FairSchedulerConfiguration.MAX_ASSIGN,3);
  conf.setBoolean(FairSchedulerConfiguration.SIZE_BASED_WEIGHT,true);
  conf.setDouble(FairSchedulerConfiguration.LOCALITY_THRESHOLD_NODE,.5);
  conf.setDouble(FairSchedulerConfiguration.LOCALITY_THRESHOLD_RACK,.7);
  conf.setBoolean(FairSchedulerConfiguration.CONTINUOUS_SCHEDULING_ENABLED,true);
  conf.setInt(FairSchedulerConfiguration.CONTINUOUS_SCHEDULING_SLEEP_MS,10);
  conf.setInt(FairSchedulerConfiguration.LOCALITY_DELAY_RACK_MS,5000);
  conf.setInt(FairSchedulerConfiguration.LOCALITY_DELAY_NODE_MS,5000);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,1024);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_MB,512);
  conf.setInt(FairSchedulerConfiguration.RM_SCHEDULER_INCREMENT_ALLOCATION_MB,128);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  Assert.assertEquals(true,scheduler.assignMultiple);
  Assert.assertEquals(3,scheduler.maxAssign);
  Assert.assertEquals(true,scheduler.sizeBasedWeight);
  Assert.assertEquals(.5,scheduler.nodeLocalityThreshold,.01);
  Assert.assertEquals(.7,scheduler.rackLocalityThreshold,.01);
  Assert.assertTrue("The continuous scheduling should be enabled",scheduler.continuousSchedulingEnabled);
  Assert.assertEquals(10,scheduler.continuousSchedulingSleepMs);
  Assert.assertEquals(5000,scheduler.nodeLocalityDelayMs);
  Assert.assertEquals(5000,scheduler.rackLocalityDelayMs);
  Assert.assertEquals(1024,scheduler.getMaximumResourceCapability().getMemory());
  Assert.assertEquals(512,scheduler.getMinimumResourceCapability().getMemory());
  Assert.assertEquals(128,scheduler.getIncrementResourceCapability().getMemory());
}

</code></pre>

<pre class="type-9 type-7 type-10 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=5000) public void testRecoverRequestAfterPreemption() throws Exception {
  conf.setLong(FairSchedulerConfiguration.WAIT_TIME_BEFORE_KILL,10);
  MockClock clock=new MockClock();
  scheduler.setClock(clock);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  Priority priority=Priority.newInstance(20);
  String host="127.0.0.1";
  int GB=1024;
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(16 * 1024,4),0,host);
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  List<ResourceRequest> ask=new ArrayList<ResourceRequest>();
  ResourceRequest nodeLocalRequest=createResourceRequest(GB,1,host,priority.getPriority(),1,true);
  ResourceRequest rackLocalRequest=createResourceRequest(GB,1,node.getRackName(),priority.getPriority(),1,true);
  ResourceRequest offRackRequest=createResourceRequest(GB,1,ResourceRequest.ANY,priority.getPriority(),1,true);
  ask.add(nodeLocalRequest);
  ask.add(rackLocalRequest);
  ask.add(offRackRequest);
  ApplicationAttemptId appAttemptId=createSchedulingRequest("queueA","user1",ask);
  scheduler.update();
  NodeUpdateSchedulerEvent nodeUpdate=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeUpdate);
  assertEquals(1,scheduler.getSchedulerApp(appAttemptId).getLiveContainers().size());
  FSAppAttempt app=scheduler.getSchedulerApp(appAttemptId);
  Assert.assertNull(app.getResourceRequest(priority,host));
  ContainerId containerId1=ContainerId.newInstance(appAttemptId,1);
  RMContainer rmContainer=app.getRMContainer(containerId1);
  scheduler.warnOrKillContainer(rmContainer);
  clock.tick(5);
  scheduler.warnOrKillContainer(rmContainer);
  List<ResourceRequest> requests=rmContainer.getResourceRequests();
  Assert.assertEquals(3,requests.size());
  for (  ResourceRequest request : requests) {
    Assert.assertEquals(1,app.getResourceRequest(priority,request.getResourceName()).getNumContainers());
  }
  scheduler.update();
  scheduler.handle(nodeUpdate);
  List<Container> containers=scheduler.allocate(appAttemptId,Collections.<ResourceRequest>emptyList(),Collections.<ContainerId>emptyList(),null,null).getContainers();
  Assert.assertTrue(containers.size() == 1);
}

</code></pre>

<pre class="type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=5000) public void testChoiceOfPreemptedContainers() throws Exception {
  conf.setLong(FairSchedulerConfiguration.PREEMPTION_INTERVAL,5000);
  conf.setLong(FairSchedulerConfiguration.WAIT_TIME_BEFORE_KILL,10000);
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE + ".allocation.file",ALLOC_FILE);
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"false");
  MockClock clock=new MockClock();
  scheduler.setClock(clock);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<weight>.25</weight>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<weight>.25</weight>");
  out.println("</queue>");
  out.println("<queue name=\"queueC\">");
  out.println("<weight>.25</weight>");
  out.println("</queue>");
  out.println("<queue name=\"default\">");
  out.println("<weight>.25</weight>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(4 * 1024,4),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(4 * 1024,4),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId app1=createSchedulingRequest(1 * 1024,1,"queueA","user1",1,1);
  createSchedulingRequestExistingApplication(1 * 1024,1,2,app1);
  ApplicationAttemptId app2=createSchedulingRequest(1 * 1024,1,"queueA","user1",1,3);
  createSchedulingRequestExistingApplication(1 * 1024,1,4,app2);
  ApplicationAttemptId app3=createSchedulingRequest(1 * 1024,1,"queueB","user1",1,1);
  createSchedulingRequestExistingApplication(1 * 1024,1,2,app3);
  ApplicationAttemptId app4=createSchedulingRequest(1 * 1024,1,"queueB","user1",1,3);
  createSchedulingRequestExistingApplication(1 * 1024,1,4,app4);
  scheduler.update();
  scheduler.getQueueManager().getLeafQueue("queueA",true).setPolicy(SchedulingPolicy.parse("fifo"));
  scheduler.getQueueManager().getLeafQueue("queueB",true).setPolicy(SchedulingPolicy.parse("fair"));
  NodeUpdateSchedulerEvent nodeUpdate1=new NodeUpdateSchedulerEvent(node1);
  NodeUpdateSchedulerEvent nodeUpdate2=new NodeUpdateSchedulerEvent(node2);
  for (int i=0; i < 4; i++) {
    scheduler.handle(nodeUpdate1);
    scheduler.handle(nodeUpdate2);
  }
  assertEquals(2,scheduler.getSchedulerApp(app1).getLiveContainers().size());
  assertEquals(2,scheduler.getSchedulerApp(app2).getLiveContainers().size());
  assertEquals(2,scheduler.getSchedulerApp(app3).getLiveContainers().size());
  assertEquals(2,scheduler.getSchedulerApp(app4).getLiveContainers().size());
  createSchedulingRequest(1 * 1024,1,"queueC","user1",1,1);
  createSchedulingRequest(1 * 1024,1,"queueC","user1",1,1);
  createSchedulingRequest(1 * 1024,1,"default","user1",1,1);
  createSchedulingRequest(1 * 1024,1,"default","user1",1,1);
  scheduler.update();
  scheduler.preemptResources(Resources.createResource(2 * 1024));
  assertEquals(2,scheduler.getSchedulerApp(app1).getLiveContainers().size());
  assertEquals(2,scheduler.getSchedulerApp(app3).getLiveContainers().size());
  assertTrue("App2 should have container to be preempted",!Collections.disjoint(scheduler.getSchedulerApp(app2).getLiveContainers(),scheduler.getSchedulerApp(app2).getPreemptionContainers()));
  assertTrue("App4 should have container to be preempted",!Collections.disjoint(scheduler.getSchedulerApp(app2).getLiveContainers(),scheduler.getSchedulerApp(app2).getPreemptionContainers()));
  clock.tick(15);
  scheduler.preemptResources(Resources.createResource(2 * 1024));
  assertEquals(1,scheduler.getSchedulerApp(app2).getLiveContainers().size());
  assertEquals(1,scheduler.getSchedulerApp(app4).getLiveContainers().size());
  Set<RMContainer> set=new HashSet<RMContainer>();
  for (  RMContainer container : scheduler.getSchedulerApp(app2).getLiveContainers()) {
    if (container.getAllocatedPriority().getPriority() == 4) {
      set.add(container);
    }
  }
  for (  RMContainer container : scheduler.getSchedulerApp(app4).getLiveContainers()) {
    if (container.getAllocatedPriority().getPriority() == 4) {
      set.add(container);
    }
  }
  assertTrue("Containers with priority=4 in app2 and app4 should be " + "preempted.",set.isEmpty());
  scheduler.preemptResources(Resources.createResource(2 * 1024));
  clock.tick(15);
  scheduler.preemptResources(Resources.createResource(2 * 1024));
  assertEquals(2,scheduler.getSchedulerApp(app1).getLiveContainers().size());
  assertEquals(0,scheduler.getSchedulerApp(app2).getLiveContainers().size());
  assertEquals(1,scheduler.getSchedulerApp(app3).getLiveContainers().size());
  assertEquals(1,scheduler.getSchedulerApp(app4).getLiveContainers().size());
  scheduler.preemptResources(Resources.createResource(2 * 1024));
  assertTrue("App1 should have no container to be preempted",scheduler.getSchedulerApp(app1).getPreemptionContainers().isEmpty());
  assertTrue("App2 should have no container to be preempted",scheduler.getSchedulerApp(app2).getPreemptionContainers().isEmpty());
  assertTrue("App3 should have no container to be preempted",scheduler.getSchedulerApp(app3).getPreemptionContainers().isEmpty());
  assertTrue("App4 should have no container to be preempted",scheduler.getSchedulerApp(app4).getPreemptionContainers().isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveMakesAppRunnable() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueMgr=scheduler.getQueueManager();
  FSLeafQueue oldQueue=queueMgr.getLeafQueue("queue1",true);
  FSLeafQueue targetQueue=queueMgr.getLeafQueue("queue2",true);
  scheduler.getAllocationConfiguration().queueMaxApps.put("root.queue1",0);
  ApplicationAttemptId appAttId=createSchedulingRequest(1024,1,"queue1","user1",3);
  FSAppAttempt app=scheduler.getSchedulerApp(appAttId);
  assertTrue(oldQueue.getNonRunnableAppSchedulables().contains(app));
  scheduler.moveApplication(appAttId.getApplicationId(),"queue2");
  assertFalse(oldQueue.getNonRunnableAppSchedulables().contains(app));
  assertFalse(targetQueue.getNonRunnableAppSchedulables().contains(app));
  assertTrue(targetQueue.getRunnableAppSchedulables().contains(app));
  assertEquals(1,targetQueue.getNumRunnableApps());
  assertEquals(1,queueMgr.getRootQueue().getNumRunnableApps());
}

</code></pre>

<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCancelStrictLocality() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",0);
  ResourceRequest nodeRequest=createResourceRequest(1024,node1.getHostName(),1,1,true);
  ResourceRequest rackRequest=createResourceRequest(1024,"rack1",1,1,false);
  ResourceRequest anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,1,false);
  createSchedulingRequestExistingApplication(nodeRequest,attId1);
  createSchedulingRequestExistingApplication(rackRequest,attId1);
  createSchedulingRequestExistingApplication(anyRequest,attId1);
  scheduler.update();
  NodeUpdateSchedulerEvent node2UpdateEvent=new NodeUpdateSchedulerEvent(node2);
  FSAppAttempt app=scheduler.getSchedulerApp(attId1);
  for (int i=0; i < 10; i++) {
    scheduler.handle(node2UpdateEvent);
    assertEquals(0,app.getLiveContainers().size());
  }
  List<ResourceRequest> update=Arrays.asList(createResourceRequest(1024,node1.getHostName(),1,0,true),createResourceRequest(1024,"rack1",1,0,true),createResourceRequest(1024,ResourceRequest.ANY,1,1,true));
  scheduler.allocate(attId1,update,new ArrayList<ContainerId>(),null,null);
  scheduler.handle(node2UpdateEvent);
  assertEquals(1,app.getLiveContainers().size());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testQueueMaxAMShare() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queue1\">");
  out.println("<maxAMShare>0.2</maxAMShare>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(20480,20),0,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  scheduler.update();
  FSLeafQueue queue1=scheduler.getQueueManager().getLeafQueue("queue1",true);
  assertEquals("Queue queue1's fair share should be 0",0,queue1.getFairShare().getMemory());
  createSchedulingRequest(1 * 1024,"root.default","user1");
  scheduler.update();
  scheduler.handle(updateEvent);
  Resource amResource1=Resource.newInstance(1024,1);
  Resource amResource2=Resource.newInstance(2048,2);
  Resource amResource3=Resource.newInstance(1860,2);
  int amPriority=RMAppAttemptImpl.AM_CONTAINER_PRIORITY.getPriority();
  ApplicationAttemptId attId1=createAppAttemptId(1,1);
  createApplicationWithAMResource(attId1,"queue1","user1",amResource1);
  createSchedulingRequestExistingApplication(1024,1,amPriority,attId1);
  FSAppAttempt app1=scheduler.getSchedulerApp(attId1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application1's AM requests 1024 MB memory",1024,app1.getAMResource().getMemory());
  assertEquals("Application1's AM should be running",1,app1.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 1024 MB memory",1024,queue1.getAmResourceUsage().getMemory());
  ApplicationAttemptId attId2=createAppAttemptId(2,1);
  createApplicationWithAMResource(attId2,"queue1","user1",amResource1);
  createSchedulingRequestExistingApplication(1024,1,amPriority,attId2);
  FSAppAttempt app2=scheduler.getSchedulerApp(attId2);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application2's AM requests 1024 MB memory",1024,app2.getAMResource().getMemory());
  assertEquals("Application2's AM should be running",1,app2.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  ApplicationAttemptId attId3=createAppAttemptId(3,1);
  createApplicationWithAMResource(attId3,"queue1","user1",amResource1);
  createSchedulingRequestExistingApplication(1024,1,amPriority,attId3);
  FSAppAttempt app3=scheduler.getSchedulerApp(attId3);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application3's AM requests 1024 MB memory",1024,app3.getAMResource().getMemory());
  assertEquals("Application3's AM should not be running",0,app3.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  createSchedulingRequestExistingApplication(1024,1,attId1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application1 should have two running containers",2,app1.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  AppAttemptRemovedSchedulerEvent appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(attId1,RMAppAttemptState.FINISHED,false);
  scheduler.update();
  scheduler.handle(appRemovedEvent1);
  scheduler.handle(updateEvent);
  assertEquals("Application1's AM should be finished",0,app1.getLiveContainers().size());
  assertEquals("Application3's AM should be running",1,app3.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  ApplicationAttemptId attId4=createAppAttemptId(4,1);
  createApplicationWithAMResource(attId4,"queue1","user1",amResource2);
  createSchedulingRequestExistingApplication(2048,2,amPriority,attId4);
  FSAppAttempt app4=scheduler.getSchedulerApp(attId4);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application4's AM requests 2048 MB memory",2048,app4.getAMResource().getMemory());
  assertEquals("Application4's AM should not be running",0,app4.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  ApplicationAttemptId attId5=createAppAttemptId(5,1);
  createApplicationWithAMResource(attId5,"queue1","user1",amResource2);
  createSchedulingRequestExistingApplication(2048,2,amPriority,attId5);
  FSAppAttempt app5=scheduler.getSchedulerApp(attId5);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application5's AM requests 2048 MB memory",2048,app5.getAMResource().getMemory());
  assertEquals("Application5's AM should not be running",0,app5.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  AppAttemptRemovedSchedulerEvent appRemovedEvent4=new AppAttemptRemovedSchedulerEvent(attId4,RMAppAttemptState.KILLED,false);
  scheduler.handle(appRemovedEvent4);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application5's AM should not be running",0,app5.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  AppAttemptRemovedSchedulerEvent appRemovedEvent2=new AppAttemptRemovedSchedulerEvent(attId2,RMAppAttemptState.FINISHED,false);
  AppAttemptRemovedSchedulerEvent appRemovedEvent3=new AppAttemptRemovedSchedulerEvent(attId3,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent2);
  scheduler.handle(appRemovedEvent3);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application2's AM should be finished",0,app2.getLiveContainers().size());
  assertEquals("Application3's AM should be finished",0,app3.getLiveContainers().size());
  assertEquals("Application5's AM should be running",1,app5.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  ApplicationAttemptId attId6=createAppAttemptId(6,1);
  createApplicationWithAMResource(attId6,"queue1","user1",amResource3);
  createSchedulingRequestExistingApplication(1860,2,amPriority,attId6);
  FSAppAttempt app6=scheduler.getSchedulerApp(attId6);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application6's AM should not be running",0,app6.getLiveContainers().size());
  assertEquals("Application6's AM requests 2048 MB memory",2048,app6.getAMResource().getMemory());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  AppAttemptRemovedSchedulerEvent appRemovedEvent5=new AppAttemptRemovedSchedulerEvent(attId5,RMAppAttemptState.FINISHED,false);
  AppAttemptRemovedSchedulerEvent appRemovedEvent6=new AppAttemptRemovedSchedulerEvent(attId6,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent5);
  scheduler.handle(appRemovedEvent6);
  scheduler.update();
  assertEquals("Queue1's AM resource usage should be 0",0,queue1.getAmResourceUsage().getMemory());
}

</code></pre>

<pre class="type-9 type-13 type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test to verify the behavior of{@link FSQueue#assignContainer(FSSchedulerNode)})
 * Create two queues under root (fifoQueue and fairParent), and two queues
 * under fairParent (fairChild1 and fairChild2). Submit two apps to the
 * fifoQueue and one each to the fairChild* queues, all apps requiring 4
 * containers each of the total 16 container capacity
 * Assert the number of containers for each app after 4, 8, 12 and 16 updates.
 * @throws Exception
 */
@Test(timeout=5000) public void testAssignContainer() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  final String user="user1";
  final String fifoQueue="fifo";
  final String fairParent="fairParent";
  final String fairChild1=fairParent + ".fairChild1";
  final String fairChild2=fairParent + ".fairChild2";
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8192,8),1,"127.0.0.1");
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(8192,8),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent1);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,fifoQueue,user,4);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,fairChild1,user,4);
  ApplicationAttemptId attId3=createSchedulingRequest(1024,fairChild2,user,4);
  ApplicationAttemptId attId4=createSchedulingRequest(1024,fifoQueue,user,4);
  FSAppAttempt app1=scheduler.getSchedulerApp(attId1);
  FSAppAttempt app2=scheduler.getSchedulerApp(attId2);
  FSAppAttempt app3=scheduler.getSchedulerApp(attId3);
  FSAppAttempt app4=scheduler.getSchedulerApp(attId4);
  scheduler.getQueueManager().getLeafQueue(fifoQueue,true).setPolicy(SchedulingPolicy.parse("fifo"));
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent1=new NodeUpdateSchedulerEvent(node1);
  NodeUpdateSchedulerEvent updateEvent2=new NodeUpdateSchedulerEvent(node2);
  for (int i=0; i < 8; i++) {
    scheduler.handle(updateEvent1);
    scheduler.handle(updateEvent2);
    if ((i + 1) % 2 == 0) {
      String ERR="Wrong number of assigned containers after " + (i + 1) + " updates";
      if (i < 4) {
        assertEquals(ERR,(i + 1),app1.getLiveContainers().size());
        assertEquals(ERR,0,app4.getLiveContainers().size());
      }
 else {
        assertEquals(ERR,4,app1.getLiveContainers().size());
        assertEquals(ERR,(i - 3),app4.getLiveContainers().size());
      }
      assertEquals(ERR,(i + 1) / 2,app2.getLiveContainers().size());
      assertEquals(ERR,(i + 1) / 2,app3.getLiveContainers().size());
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLowestCommonAncestorDeeperHierarchy() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  FSQueue aQueue=mock(FSLeafQueue.class);
  FSQueue bQueue=mock(FSLeafQueue.class);
  FSQueue a1Queue=mock(FSLeafQueue.class);
  FSQueue b1Queue=mock(FSLeafQueue.class);
  when(a1Queue.getName()).thenReturn("root.queue1.a.a1");
  when(b1Queue.getName()).thenReturn("root.queue1.b.b1");
  when(aQueue.getChildQueues()).thenReturn(Arrays.asList(a1Queue));
  when(bQueue.getChildQueues()).thenReturn(Arrays.asList(b1Queue));
  QueueManager queueManager=scheduler.getQueueManager();
  FSParentQueue queue1=queueManager.getParentQueue("queue1",true);
  queue1.addChildQueue(aQueue);
  queue1.addChildQueue(bQueue);
  FSQueue ancestorQueue=scheduler.findLowestCommonAncestorQueue(a1Queue,b1Queue);
  assertEquals(ancestorQueue,queue1);
}

</code></pre>

<pre class="type-2 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testContinuousSchedulingWithNodeRemoved() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  Assert.assertTrue("Continuous scheduling should be disabled.",!scheduler.isContinuousSchedulingEnabled());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8 * 1024,8),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(8 * 1024,8),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  Assert.assertEquals("We should have two alive nodes.",2,scheduler.getNumClusterNodes());
  NodeRemovedSchedulerEvent removeNode1=new NodeRemovedSchedulerEvent(node1);
  scheduler.handle(removeNode1);
  Assert.assertEquals("We should only have one alive node.",1,scheduler.getNumClusterNodes());
  try {
    scheduler.continuousSchedulingAttempt();
  }
 catch (  Exception e) {
    fail("Exception happened when doing continuous scheduling. " + e.toString());
  }
}

</code></pre>

<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStrictLocality() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",0);
  ResourceRequest nodeRequest=createResourceRequest(1024,node1.getHostName(),1,1,true);
  ResourceRequest rackRequest=createResourceRequest(1024,node1.getRackName(),1,1,false);
  ResourceRequest anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,1,false);
  createSchedulingRequestExistingApplication(nodeRequest,attId1);
  createSchedulingRequestExistingApplication(rackRequest,attId1);
  createSchedulingRequestExistingApplication(anyRequest,attId1);
  scheduler.update();
  NodeUpdateSchedulerEvent node1UpdateEvent=new NodeUpdateSchedulerEvent(node1);
  NodeUpdateSchedulerEvent node2UpdateEvent=new NodeUpdateSchedulerEvent(node2);
  FSAppAttempt app=scheduler.getSchedulerApp(attId1);
  for (int i=0; i < 10; i++) {
    scheduler.handle(node2UpdateEvent);
    assertEquals(0,app.getLiveContainers().size());
    assertEquals(0,app.getReservedContainers().size());
  }
  scheduler.handle(node1UpdateEvent);
  assertEquals(1,app.getLiveContainers().size());
}

</code></pre>

<pre class="type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFairShareWithMinAlloc() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(3 * 1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(2 * 1024,"queueA","user1");
  createSchedulingRequest(2 * 1024,"queueB","user1");
  scheduler.update();
  Collection<FSLeafQueue> queues=scheduler.getQueueManager().getLeafQueues();
  assertEquals(3,queues.size());
  for (  FSLeafQueue p : queues) {
    if (p.getName().equals("root.queueA")) {
      assertEquals(1024,p.getFairShare().getMemory());
    }
 else     if (p.getName().equals("root.queueB")) {
      assertEquals(2048,p.getFairShare().getMemory());
    }
  }
}

</code></pre>

<pre class="type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFairShareAndWeightsInNestedUserQueueRule() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"parentq\" type=\"parent\">");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queuePlacementPolicy>");
  out.println("<rule name=\"nestedUserQueue\">");
  out.println("     <rule name=\"specified\" create=\"false\" />");
  out.println("</rule>");
  out.println("<rule name=\"default\" />");
  out.println("</queuePlacementPolicy>");
  out.println("</allocations>");
  out.close();
  RMApp rmApp1=new MockRMApp(0,0,RMAppState.NEW);
  RMApp rmApp2=new MockRMApp(1,1,RMAppState.NEW);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  int capacity=16 * 1024;
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(capacity),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(10 * 1024,"root.parentq","user1");
  createSchedulingRequest(10 * 1024,"root.parentq","user2");
  createSchedulingRequest(10 * 1024,"root.default","user3");
  scheduler.update();
  scheduler.getQueueManager().getRootQueue().setSteadyFairShare(scheduler.getClusterResource());
  scheduler.getQueueManager().getRootQueue().recomputeSteadyShares();
  Collection<FSLeafQueue> leafQueues=scheduler.getQueueManager().getLeafQueues();
  for (  FSLeafQueue leaf : leafQueues) {
    if (leaf.getName().equals("root.parentq.user1") || leaf.getName().equals("root.parentq.user2")) {
      assertEquals(capacity / 4,leaf.getFairShare().getMemory());
      assertEquals(capacity / 4,leaf.getSteadyFairShare().getMemory());
      assertEquals(1.0,leaf.getWeights().getWeight(ResourceType.MEMORY),0);
    }
  }
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMaxRunningAppsHierarchicalQueues() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  MockClock clock=new MockClock();
  scheduler.setClock(clock);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queue1\">");
  out.println("  <maxRunningApps>3</maxRunningApps>");
  out.println("  <queue name=\"sub1\"></queue>");
  out.println("  <queue name=\"sub2\"></queue>");
  out.println("  <queue name=\"sub3\">");
  out.println("    <maxRunningApps>1</maxRunningApps>");
  out.println("  </queue>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1.sub1","user1");
  verifyAppRunnable(attId1,true);
  verifyQueueNumRunnable("queue1.sub1",1,0);
  clock.tick(10);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue1.sub3","user1");
  verifyAppRunnable(attId2,true);
  verifyQueueNumRunnable("queue1.sub3",1,0);
  clock.tick(10);
  ApplicationAttemptId attId3=createSchedulingRequest(1024,"queue1.sub2","user1");
  verifyAppRunnable(attId3,true);
  verifyQueueNumRunnable("queue1.sub2",1,0);
  clock.tick(10);
  ApplicationAttemptId attId4=createSchedulingRequest(1024,"queue1.sub2","user1");
  verifyAppRunnable(attId4,false);
  verifyQueueNumRunnable("queue1.sub2",1,1);
  clock.tick(10);
  ApplicationAttemptId attId5=createSchedulingRequest(1024,"queue1.sub3","user1");
  verifyAppRunnable(attId5,false);
  verifyQueueNumRunnable("queue1.sub3",1,1);
  clock.tick(10);
  AppAttemptRemovedSchedulerEvent appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(attId2,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent1);
  verifyAppRunnable(attId4,true);
  verifyQueueNumRunnable("queue1.sub2",2,0);
  verifyAppRunnable(attId5,false);
  verifyQueueNumRunnable("queue1.sub3",0,1);
  AppAttemptRemovedSchedulerEvent appRemovedEvent2=new AppAttemptRemovedSchedulerEvent(attId5,RMAppAttemptState.KILLED,true);
  scheduler.handle(appRemovedEvent2);
  assertEquals(0,scheduler.maxRunningEnforcer.usersNonRunnableApps.get("user1").size());
  verifyQueueNumRunnable("queue1.sub3",0,0);
  AppAttemptRemovedSchedulerEvent appRemovedEvent3=new AppAttemptRemovedSchedulerEvent(attId4,RMAppAttemptState.FINISHED,true);
  scheduler.handle(appRemovedEvent3);
  verifyQueueNumRunnable("queue1.sub2",1,0);
  verifyQueueNumRunnable("queue1.sub3",0,0);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPreemptionIsNotDelayedToNextRound() throws Exception {
  conf.setLong(FairSchedulerConfiguration.PREEMPTION_INTERVAL,5000);
  conf.setLong(FairSchedulerConfiguration.WAIT_TIME_BEFORE_KILL,10000);
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"false");
  MockClock clock=new MockClock();
  scheduler.setClock(clock);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<weight>8</weight>");
  out.println("<queue name=\"queueA1\" />");
  out.println("<queue name=\"queueA2\" />");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<weight>2</weight>");
  out.println("</queue>");
  out.print("<fairSharePreemptionTimeout>10</fairSharePreemptionTimeout>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8 * 1024,8),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  ApplicationAttemptId app1=createSchedulingRequest(1 * 1024,1,"queueA.queueA1","user1",7,1);
  ApplicationAttemptId app2=createSchedulingRequest(1 * 1024,1,"queueB","user2",1,1);
  scheduler.update();
  NodeUpdateSchedulerEvent nodeUpdate1=new NodeUpdateSchedulerEvent(node1);
  for (int i=0; i < 8; i++) {
    scheduler.handle(nodeUpdate1);
  }
  assertEquals(7,scheduler.getSchedulerApp(app1).getLiveContainers().size());
  assertEquals(1,scheduler.getSchedulerApp(app2).getLiveContainers().size());
  ApplicationAttemptId app3=createSchedulingRequest(1 * 1024,1,"queueA.queueA2","user3",7,1);
  scheduler.update();
  clock.tick(11);
  scheduler.update();
  Resource toPreempt=scheduler.resToPreempt(scheduler.getQueueManager().getLeafQueue("queueA.queueA2",false),clock.getTime());
  assertEquals(3277,toPreempt.getMemory());
  scheduler.preemptResources(toPreempt);
  assertEquals(3,scheduler.getSchedulerApp(app1).getPreemptionContainers().size());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDRFHierarchicalQueues() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,BuilderUtils.newResource(12288,12),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  ApplicationAttemptId appAttId1=createSchedulingRequest(3074,1,"queue1.subqueue1","user1",2);
  Thread.sleep(3);
  FSAppAttempt app1=scheduler.getSchedulerApp(appAttId1);
  ApplicationAttemptId appAttId2=createSchedulingRequest(1024,3,"queue1.subqueue1","user1",2);
  Thread.sleep(3);
  FSAppAttempt app2=scheduler.getSchedulerApp(appAttId2);
  ApplicationAttemptId appAttId3=createSchedulingRequest(2048,2,"queue1.subqueue2","user1",2);
  Thread.sleep(3);
  FSAppAttempt app3=scheduler.getSchedulerApp(appAttId3);
  ApplicationAttemptId appAttId4=createSchedulingRequest(1024,2,"queue2","user1",2);
  Thread.sleep(3);
  FSAppAttempt app4=scheduler.getSchedulerApp(appAttId4);
  DominantResourceFairnessPolicy drfPolicy=new DominantResourceFairnessPolicy();
  drfPolicy.initialize(scheduler.getClusterResource());
  scheduler.getQueueManager().getQueue("root").setPolicy(drfPolicy);
  scheduler.getQueueManager().getQueue("queue1").setPolicy(drfPolicy);
  scheduler.getQueueManager().getQueue("queue1.subqueue1").setPolicy(drfPolicy);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app1.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app4.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(2,app4.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app3.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(2,app3.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app2.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app1.getLiveContainers().size());
  Assert.assertEquals(1,app2.getLiveContainers().size());
  Assert.assertEquals(2,app3.getLiveContainers().size());
  Assert.assertEquals(2,app4.getLiveContainers().size());
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=10000) public void testContinuousScheduling() throws Exception {
  FairScheduler fs=new FairScheduler();
  Configuration conf=createConfiguration();
  conf.setBoolean(FairSchedulerConfiguration.CONTINUOUS_SCHEDULING_ENABLED,true);
  fs.setRMContext(resourceManager.getRMContext());
  fs.init(conf);
  fs.start();
  fs.reinitialize(conf,resourceManager.getRMContext());
  Assert.assertTrue("Continuous scheduling should be enabled.",fs.isContinuousSchedulingEnabled());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8 * 1024,8),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  fs.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(8 * 1024,8),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  fs.handle(nodeEvent2);
  Assert.assertEquals(fs.getClusterResource().getMemory(),16 * 1024);
  Assert.assertEquals(fs.getClusterResource().getVirtualCores(),16);
  ApplicationAttemptId appAttemptId=createAppAttemptId(this.APP_ID++,this.ATTEMPT_ID++);
  fs.addApplication(appAttemptId.getApplicationId(),"queue11","user11",false);
  fs.addApplicationAttempt(appAttemptId,false,false);
  List<ResourceRequest> ask=new ArrayList<ResourceRequest>();
  ResourceRequest request=createResourceRequest(1024,1,ResourceRequest.ANY,1,1,true);
  ask.add(request);
  fs.allocate(appAttemptId,ask,new ArrayList<ContainerId>(),null,null);
  Thread.sleep(fs.getConf().getContinuousSchedulingSleepMs() + 500);
  FSAppAttempt app=fs.getSchedulerApp(appAttemptId);
  while (app.getCurrentConsumption().equals(Resources.none())) {
  }
  Assert.assertEquals(1024,app.getCurrentConsumption().getMemory());
  Assert.assertEquals(1,app.getCurrentConsumption().getVirtualCores());
  request=createResourceRequest(1024,1,ResourceRequest.ANY,2,1,true);
  ask.clear();
  ask.add(request);
  fs.allocate(appAttemptId,ask,new ArrayList<ContainerId>(),null,null);
  while (app.getCurrentConsumption().equals(Resources.createResource(1024,1))) {
  }
  Assert.assertEquals(2048,app.getCurrentConsumption().getMemory());
  Assert.assertEquals(2,app.getCurrentConsumption().getVirtualCores());
  Set<NodeId> nodes=new HashSet<NodeId>();
  Iterator<RMContainer> it=app.getLiveContainers().iterator();
  while (it.hasNext()) {
    nodes.add(it.next().getContainer().getNodeId());
  }
  Assert.assertEquals(2,nodes.size());
}

</code></pre>

<pre class="type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testIsStarvedForFairShare() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<weight>.25</weight>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<weight>.75</weight>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(4 * 1024,4),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(3 * 1024,"queueA","user1");
  scheduler.update();
  NodeUpdateSchedulerEvent nodeEvent2=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(nodeEvent2);
  createSchedulingRequest(1 * 1024,"queueB","user1");
  scheduler.update();
  Collection<FSLeafQueue> queues=scheduler.getQueueManager().getLeafQueues();
  assertEquals(3,queues.size());
  for (  FSLeafQueue p : queues) {
    if (p.getName().equals("root.queueA")) {
      assertEquals(false,scheduler.isStarvedForFairShare(p));
    }
 else     if (p.getName().equals("root.queueB")) {
      assertEquals(true,scheduler.isStarvedForFairShare(p));
    }
  }
  scheduler.handle(nodeEvent2);
  for (  FSLeafQueue p : queues) {
    if (p.getName().equals("root.queueB")) {
      assertEquals(false,scheduler.isStarvedForFairShare(p));
    }
  }
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNotUserAsDefaultQueue() throws Exception {
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"false");
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId appAttemptId=createAppAttemptId(1,1);
  createApplicationWithAMResource(appAttemptId,"default","user2",null);
  assertEquals(0,scheduler.getQueueManager().getLeafQueue("user1",true).getRunnableAppSchedulables().size());
  assertEquals(1,scheduler.getQueueManager().getLeafQueue("default",true).getRunnableAppSchedulables().size());
  assertEquals(0,scheduler.getQueueManager().getLeafQueue("user2",true).getRunnableAppSchedulables().size());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSteadyFairShareWithReloadAndNodeAddRemove() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<defaultQueueSchedulingPolicy>fair</defaultQueueSchedulingPolicy>");
  out.println("<queue name=\"root\">");
  out.println("  <schedulingPolicy>drf</schedulingPolicy>");
  out.println("  <queue name=\"child1\">");
  out.println("    <weight>1</weight>");
  out.println("  </queue>");
  out.println("  <queue name=\"child2\">");
  out.println("    <weight>1</weight>");
  out.println("  </queue>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueManager=scheduler.getQueueManager();
  assertEquals(0,queueManager.getLeafQueue("child1",false).getSteadyFairShare().getMemory());
  assertEquals(0,queueManager.getLeafQueue("child2",false).getSteadyFairShare().getMemory());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(6144),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  assertEquals(6144,scheduler.getClusterResource().getMemory());
  assertEquals(2048,queueManager.getLeafQueue("child1",false).getSteadyFairShare().getMemory());
  assertEquals(2048,queueManager.getLeafQueue("child2",false).getSteadyFairShare().getMemory());
  out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<defaultQueueSchedulingPolicy>fair</defaultQueueSchedulingPolicy>");
  out.println("<queue name=\"root\">");
  out.println("  <schedulingPolicy>drf</schedulingPolicy>");
  out.println("  <queue name=\"child1\">");
  out.println("    <weight>1</weight>");
  out.println("  </queue>");
  out.println("  <queue name=\"child2\">");
  out.println("    <weight>2</weight>");
  out.println("  </queue>");
  out.println("  <queue name=\"child3\">");
  out.println("    <weight>2</weight>");
  out.println("  </queue>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  assertEquals(1024,queueManager.getLeafQueue("child1",false).getSteadyFairShare().getMemory());
  assertEquals(2048,queueManager.getLeafQueue("child2",false).getSteadyFairShare().getMemory());
  assertEquals(2048,queueManager.getLeafQueue("child3",false).getSteadyFairShare().getMemory());
  NodeRemovedSchedulerEvent nodeEvent2=new NodeRemovedSchedulerEvent(node1);
  scheduler.handle(nodeEvent2);
  assertEquals(0,scheduler.getClusterResource().getMemory());
  assertEquals(0,queueManager.getLeafQueue("child1",false).getSteadyFairShare().getMemory());
  assertEquals(0,queueManager.getLeafQueue("child2",false).getSteadyFairShare().getMemory());
}

</code></pre>

<pre class="type-9 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetAppsInQueue() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId appAttId1=createSchedulingRequest(1024,1,"queue1.subqueue1","user1");
  ApplicationAttemptId appAttId2=createSchedulingRequest(1024,1,"queue1.subqueue2","user1");
  ApplicationAttemptId appAttId3=createSchedulingRequest(1024,1,"default","user1");
  List<ApplicationAttemptId> apps=scheduler.getAppsInQueue("queue1.subqueue1");
  assertEquals(1,apps.size());
  assertEquals(appAttId1,apps.get(0));
  apps=scheduler.getAppsInQueue("root.queue1.subqueue1");
  assertEquals(1,apps.size());
  assertEquals(appAttId1,apps.get(0));
  apps=scheduler.getAppsInQueue("user1");
  assertEquals(1,apps.size());
  assertEquals(appAttId3,apps.get(0));
  apps=scheduler.getAppsInQueue("root.user1");
  assertEquals(1,apps.size());
  assertEquals(appAttId3,apps.get(0));
  apps=scheduler.getAppsInQueue("queue1");
  Assert.assertEquals(2,apps.size());
  Set<ApplicationAttemptId> appAttIds=Sets.newHashSet(apps.get(0),apps.get(1));
  assertTrue(appAttIds.contains(appAttId1));
  assertTrue(appAttIds.contains(appAttId2));
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNoMoreCpuOnNode() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(2048,1),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  ApplicationAttemptId attId=createSchedulingRequest(1024,1,"default","user1",2);
  FSAppAttempt app=scheduler.getSchedulerApp(attId);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  assertEquals(1,app.getLiveContainers().size());
  scheduler.handle(updateEvent);
  assertEquals(1,app.getLiveContainers().size());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLowestCommonAncestorRootParent() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  FSLeafQueue aQueue=mock(FSLeafQueue.class);
  FSLeafQueue bQueue=mock(FSLeafQueue.class);
  when(aQueue.getName()).thenReturn("root.a");
  when(bQueue.getName()).thenReturn("root.b");
  QueueManager queueManager=scheduler.getQueueManager();
  FSParentQueue queue1=queueManager.getParentQueue("root",false);
  queue1.addChildQueue(aQueue);
  queue1.addChildQueue(bQueue);
  FSQueue ancestorQueue=scheduler.findLowestCommonAncestorQueue(aQueue,bQueue);
  assertEquals(ancestorQueue,queue1);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testSimpleContainerAllocation() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024,4),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(512,2),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  createSchedulingRequest(512,2,"queue1","user1",2);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  assertEquals(FairSchedulerConfiguration.DEFAULT_RM_SCHEDULER_INCREMENT_ALLOCATION_MB,scheduler.getQueueManager().getQueue("queue1").getResourceUsage().getMemory());
  NodeUpdateSchedulerEvent updateEvent2=new NodeUpdateSchedulerEvent(node2);
  scheduler.handle(updateEvent2);
  assertEquals(1024,scheduler.getQueueManager().getQueue("queue1").getResourceUsage().getMemory());
  assertEquals(2,scheduler.getQueueManager().getQueue("queue1").getResourceUsage().getVirtualCores());
  QueueMetrics queue1Metrics=scheduler.getQueueManager().getQueue("queue1").getMetrics();
  assertEquals(1024,queue1Metrics.getAllocatedMB());
  assertEquals(2,queue1Metrics.getAllocatedVirtualCores());
  assertEquals(1024,scheduler.getRootQueueMetrics().getAllocatedMB());
  assertEquals(2,scheduler.getRootQueueMetrics().getAllocatedVirtualCores());
  assertEquals(512,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(4,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
}

</code></pre>

<pre class="type-11 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies whether objects are null
"></span><br>
@Test public void testDefaultRuleInitializesProperlyWhenPolicyNotConfigured() throws IOException {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  conf.setBoolean(FairSchedulerConfiguration.ALLOW_UNDECLARED_POOLS,false);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  List<QueuePlacementRule> rules=scheduler.allocConf.placementPolicy.getRules();
  for (  QueuePlacementRule rule : rules) {
    if (rule instanceof Default) {
      Default defaultRule=(Default)rule;
      assertNotNull(defaultRule.defaultQueueName);
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@SuppressWarnings("unchecked") @Test public void testNotAllowSubmitApplication() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"root\">");
  out.println("  <aclSubmitApps> </aclSubmitApps>");
  out.println("  <aclAdministerApps> </aclAdministerApps>");
  out.println("  <queue name=\"queue1\">");
  out.println("    <aclSubmitApps>userallow</aclSubmitApps>");
  out.println("    <aclAdministerApps>userallow</aclAdministerApps>");
  out.println("  </queue>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  int appId=this.APP_ID++;
  String user="usernotallow";
  String queue="queue1";
  ApplicationId applicationId=MockApps.newAppID(appId);
  String name=MockApps.newAppName();
  ApplicationMasterService masterService=new ApplicationMasterService(resourceManager.getRMContext(),scheduler);
  ApplicationSubmissionContext submissionContext=new ApplicationSubmissionContextPBImpl();
  ContainerLaunchContext clc=BuilderUtils.newContainerLaunchContext(null,null,null,null,null,null);
  submissionContext.setApplicationId(applicationId);
  submissionContext.setAMContainerSpec(clc);
  RMApp application=new RMAppImpl(applicationId,resourceManager.getRMContext(),conf,name,user,queue,submissionContext,scheduler,masterService,System.currentTimeMillis(),"YARN",null);
  resourceManager.getRMContext().getRMApps().putIfAbsent(applicationId,application);
  application.handle(new RMAppEvent(applicationId,RMAppEventType.START));
  final int MAX_TRIES=20;
  int numTries=0;
  while (!application.getState().equals(RMAppState.SUBMITTED) && numTries < MAX_TRIES) {
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException ex) {
      ex.printStackTrace();
    }
    numTries++;
  }
  assertEquals("The application doesn't reach SUBMITTED.",RMAppState.SUBMITTED,application.getState());
  ApplicationAttemptId attId=ApplicationAttemptId.newInstance(applicationId,this.ATTEMPT_ID++);
  scheduler.addApplication(attId.getApplicationId(),queue,user,false);
  numTries=0;
  while (application.getFinishTime() == 0 && numTries < MAX_TRIES) {
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException ex) {
      ex.printStackTrace();
    }
    numTries++;
  }
  assertEquals(FinalApplicationStatus.FAILED,application.getFinalApplicationStatus());
}

</code></pre>

<pre class="type-9 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
@Test public void testAclSubmitApplication() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"root\">");
  out.println("  <aclSubmitApps> </aclSubmitApps>");
  out.println("  <aclAdministerApps> </aclAdministerApps>");
  out.println("  <queue name=\"queue1\">");
  out.println("    <aclSubmitApps>norealuserhasthisname</aclSubmitApps>");
  out.println("    <aclAdministerApps>norealuserhasthisname</aclAdministerApps>");
  out.println("  </queue>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","norealuserhasthisname",1);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue1","norealuserhasthisname2",1);
  FSAppAttempt app1=scheduler.getSchedulerApp(attId1);
  assertNotNull("The application was not allowed",app1);
  FSAppAttempt app2=scheduler.getSchedulerApp(attId2);
  assertNull("The application was allowed",app2);
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testSimpleContainerReservation() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  assertEquals(1024,scheduler.getQueueManager().getQueue("queue1").getResourceUsage().getMemory());
  ApplicationAttemptId attId=createSchedulingRequest(1024,"queue2","user1",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.getQueueManager().getQueue("queue2").getResourceUsage().getMemory());
  assertEquals(1024,scheduler.getSchedulerApp(attId).getCurrentReservation().getMemory());
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  NodeUpdateSchedulerEvent updateEvent2=new NodeUpdateSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  scheduler.handle(updateEvent2);
  assertEquals(1024,scheduler.getQueueManager().getQueue("queue2").getResourceUsage().getMemory());
  assertEquals(1024,scheduler.getSchedulerApp(attId).getCurrentReservation().getMemory());
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.getSchedulerApp(attId).getCurrentReservation().getMemory());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDontAllowUndeclaredPools() throws Exception {
  conf.setBoolean(FairSchedulerConfiguration.ALLOW_UNDECLARED_POOLS,false);
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"jerry\">");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueManager=scheduler.getQueueManager();
  FSLeafQueue jerryQueue=queueManager.getLeafQueue("jerry",false);
  FSLeafQueue defaultQueue=queueManager.getLeafQueue("default",false);
  createSchedulingRequest(1024,"jerry","someuser");
  assertEquals(1,jerryQueue.getRunnableAppSchedulables().size());
  createSchedulingRequest(1024,"newqueue","someuser");
  assertEquals(1,jerryQueue.getRunnableAppSchedulables().size());
  assertEquals(1,defaultQueue.getRunnableAppSchedulables().size());
  createSchedulingRequest(1024,"default","someuser");
  assertEquals(1,jerryQueue.getRunnableAppSchedulables().size());
  assertEquals(2,defaultQueue.getRunnableAppSchedulables().size());
  createSchedulingRequest(1024,"default","jerry");
  assertEquals(2,jerryQueue.getRunnableAppSchedulables().size());
  assertEquals(2,defaultQueue.getRunnableAppSchedulables().size());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * If we update our ask to strictly request a node, it doesn't make sense to keep
 * a reservation on another.
 */
@Test public void testReservationsStrictLocality() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId=createSchedulingRequest(1024,"queue1","user1",0);
  FSAppAttempt app=scheduler.getSchedulerApp(attId);
  ResourceRequest nodeRequest=createResourceRequest(1024,node2.getHostName(),1,2,true);
  ResourceRequest rackRequest=createResourceRequest(1024,"rack1",1,2,true);
  ResourceRequest anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,2,false);
  createSchedulingRequestExistingApplication(nodeRequest,attId);
  createSchedulingRequestExistingApplication(rackRequest,attId);
  createSchedulingRequestExistingApplication(anyRequest,attId);
  scheduler.update();
  NodeUpdateSchedulerEvent nodeUpdateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(nodeUpdateEvent);
  assertEquals(1,app.getLiveContainers().size());
  scheduler.handle(nodeUpdateEvent);
  assertEquals(1,app.getReservedContainers().size());
  rackRequest=createResourceRequest(1024,"rack1",1,1,false);
  anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,1,false);
  scheduler.allocate(attId,Arrays.asList(rackRequest,anyRequest),new ArrayList<ContainerId>(),null,null);
  scheduler.handle(nodeUpdateEvent);
  assertEquals(0,app.getReservedContainers().size());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSteadyFairShareWithQueueCreatedRuntime() throws Exception {
  conf.setClass(CommonConfigurationKeys.HADOOP_SECURITY_GROUP_MAPPING,SimpleGroupsMapping.class,GroupMappingServiceProvider.class);
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"true");
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(6144),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  assertEquals(6144,scheduler.getClusterResource().getMemory());
  assertEquals(6144,scheduler.getQueueManager().getRootQueue().getSteadyFairShare().getMemory());
  assertEquals(6144,scheduler.getQueueManager().getLeafQueue("default",false).getSteadyFairShare().getMemory());
  ApplicationAttemptId appAttemptId1=createAppAttemptId(1,1);
  createApplicationWithAMResource(appAttemptId1,"default","user1",null);
  assertEquals(3072,scheduler.getQueueManager().getLeafQueue("default",false).getSteadyFairShare().getMemory());
  assertEquals(3072,scheduler.getQueueManager().getLeafQueue("user1",false).getSteadyFairShare().getMemory());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Two apps on one queue, one app on another
 */
@Test public void testBasicDRFWithQueues() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,BuilderUtils.newResource(8192,7),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  ApplicationAttemptId appAttId1=createSchedulingRequest(3072,1,"queue1","user1",2);
  FSAppAttempt app1=scheduler.getSchedulerApp(appAttId1);
  ApplicationAttemptId appAttId2=createSchedulingRequest(2048,2,"queue1","user1",2);
  FSAppAttempt app2=scheduler.getSchedulerApp(appAttId2);
  ApplicationAttemptId appAttId3=createSchedulingRequest(1024,2,"queue2","user1",2);
  FSAppAttempt app3=scheduler.getSchedulerApp(appAttId3);
  DominantResourceFairnessPolicy drfPolicy=new DominantResourceFairnessPolicy();
  drfPolicy.initialize(scheduler.getClusterResource());
  scheduler.getQueueManager().getQueue("root").setPolicy(drfPolicy);
  scheduler.getQueueManager().getQueue("queue1").setPolicy(drfPolicy);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app1.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app3.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(2,app3.getLiveContainers().size());
  scheduler.handle(updateEvent);
  Assert.assertEquals(1,app2.getLiveContainers().size());
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=5000) public void testPreemptionDecision() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  MockClock clock=new MockClock();
  scheduler.setClock(clock);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"default\">");
  out.println("<maxResources>0mb,0vcores</maxResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueA\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueC\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueD\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.print("<defaultMinSharePreemptionTimeout>5</defaultMinSharePreemptionTimeout>");
  out.print("<fairSharePreemptionTimeout>10</fairSharePreemptionTimeout>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(2 * 1024,2),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(2 * 1024,2),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  RMNode node3=MockNodes.newNodeInfo(1,Resources.createResource(2 * 1024,2),3,"127.0.0.3");
  NodeAddedSchedulerEvent nodeEvent3=new NodeAddedSchedulerEvent(node3);
  scheduler.handle(nodeEvent3);
  ApplicationAttemptId app1=createSchedulingRequest(1 * 1024,"queueA","user1",1,1);
  ApplicationAttemptId app2=createSchedulingRequest(1 * 1024,"queueA","user1",1,2);
  ApplicationAttemptId app3=createSchedulingRequest(1 * 1024,"queueA","user1",1,3);
  ApplicationAttemptId app4=createSchedulingRequest(1 * 1024,"queueB","user1",1,1);
  ApplicationAttemptId app5=createSchedulingRequest(1 * 1024,"queueB","user1",1,2);
  ApplicationAttemptId app6=createSchedulingRequest(1 * 1024,"queueB","user1",1,3);
  scheduler.update();
  for (int i=0; i < 2; i++) {
    NodeUpdateSchedulerEvent nodeUpdate1=new NodeUpdateSchedulerEvent(node1);
    scheduler.handle(nodeUpdate1);
    NodeUpdateSchedulerEvent nodeUpdate2=new NodeUpdateSchedulerEvent(node2);
    scheduler.handle(nodeUpdate2);
    NodeUpdateSchedulerEvent nodeUpdate3=new NodeUpdateSchedulerEvent(node3);
    scheduler.handle(nodeUpdate3);
  }
  ApplicationAttemptId app7=createSchedulingRequest(1 * 1024,"queueC","user1",1,1);
  ApplicationAttemptId app8=createSchedulingRequest(1 * 1024,"queueC","user1",1,2);
  ApplicationAttemptId app9=createSchedulingRequest(1 * 1024,"queueC","user1",1,3);
  ApplicationAttemptId app10=createSchedulingRequest(1 * 1024,"queueD","user1",1,1);
  ApplicationAttemptId app11=createSchedulingRequest(1 * 1024,"queueD","user1",1,2);
  ApplicationAttemptId app12=createSchedulingRequest(1 * 1024,"queueD","user1",1,3);
  scheduler.update();
  FSLeafQueue schedC=scheduler.getQueueManager().getLeafQueue("queueC",true);
  FSLeafQueue schedD=scheduler.getQueueManager().getLeafQueue("queueD",true);
  assertTrue(Resources.equals(Resources.none(),scheduler.resToPreempt(schedC,clock.getTime())));
  assertTrue(Resources.equals(Resources.none(),scheduler.resToPreempt(schedD,clock.getTime())));
  clock.tick(6);
  assertEquals(1024,scheduler.resToPreempt(schedC,clock.getTime()).getMemory());
  assertEquals(1024,scheduler.resToPreempt(schedD,clock.getTime()).getMemory());
  scheduler.update();
  clock.tick(6);
  assertEquals(1536,scheduler.resToPreempt(schedC,clock.getTime()).getMemory());
  assertEquals(1536,scheduler.resToPreempt(schedD,clock.getTime()).getMemory());
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=YarnException.class) public void testMoveToNonexistentQueue() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  scheduler.getQueueManager().getLeafQueue("queue1",true);
  ApplicationAttemptId appAttId=createSchedulingRequest(1024,1,"queue1","user1",3);
  scheduler.moveApplication(appAttId.getApplicationId(),"queue2");
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUserAsDefaultQueue() throws Exception {
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"true");
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId appAttemptId=createAppAttemptId(1,1);
  createApplicationWithAMResource(appAttemptId,"default","user1",null);
  assertEquals(1,scheduler.getQueueManager().getLeafQueue("user1",true).getRunnableAppSchedulables().size());
  assertEquals(0,scheduler.getQueueManager().getLeafQueue("default",true).getRunnableAppSchedulables().size());
  assertEquals("root.user1",resourceManager.getRMContext().getRMApps().get(appAttemptId.getApplicationId()).getQueue());
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws IOException {
  scheduler=new FairScheduler();
  conf=createConfiguration();
  resourceManager=new ResourceManager();
  resourceManager.init(conf);
  ((AsyncDispatcher)resourceManager.getRMContext().getDispatcher()).start();
  resourceManager.getRMContext().getStateStore().start();
  resourceManager.getRMContext().getContainerTokenSecretManager().rollMasterKey();
  scheduler.setRMContext(resourceManager.getRMContext());
}

</code></pre>

<pre class="type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testConfValidation() throws Exception {
  FairScheduler scheduler=new FairScheduler();
  Configuration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_MB,2048);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,1024);
  try {
    scheduler.serviceInit(conf);
    fail("Exception is expected because the min memory allocation is" + " larger than the max memory allocation.");
  }
 catch (  YarnRuntimeException e) {
    assertTrue("The thrown exception is not the expected one.",e.getMessage().startsWith("Invalid resource scheduler memory"));
  }
  conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_VCORES,2);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,1);
  try {
    scheduler.serviceInit(conf);
    fail("Exception is expected because the min vcores allocation is" + " larger than the max vcores allocation.");
  }
 catch (  YarnRuntimeException e) {
    assertTrue("The thrown exception is not the expected one.",e.getMessage().startsWith("Invalid resource scheduler vcores"));
  }
}

</code></pre>

<pre class="type-11 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testIsStarvedForMinShare() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(4 * 1024,4),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(3 * 1024,"queueA","user1");
  scheduler.update();
  NodeUpdateSchedulerEvent nodeEvent2=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(nodeEvent2);
  createSchedulingRequest(1 * 1024,"queueB","user1");
  scheduler.update();
  Collection<FSLeafQueue> queues=scheduler.getQueueManager().getLeafQueues();
  assertEquals(3,queues.size());
  for (  FSLeafQueue p : queues) {
    if (p.getName().equals("root.queueA")) {
      assertEquals(false,scheduler.isStarvedForMinShare(p));
    }
 else     if (p.getName().equals("root.queueB")) {
      assertEquals(true,scheduler.isStarvedForMinShare(p));
    }
  }
  scheduler.handle(nodeEvent2);
  for (  FSLeafQueue p : queues) {
    if (p.getName().equals("root.queueB")) {
      assertEquals(false,scheduler.isStarvedForMinShare(p));
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=3000) public void testMaxAssign() throws Exception {
  conf.setBoolean(FairSchedulerConfiguration.ASSIGN_MULTIPLE,true);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(16384,16),0,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  ApplicationAttemptId attId=createSchedulingRequest(1024,"root.default","user",8);
  FSAppAttempt app=scheduler.getSchedulerApp(attId);
  scheduler.maxAssign=2;
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Incorrect number of containers allocated",2,app.getLiveContainers().size());
  scheduler.maxAssign=-1;
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Incorrect number of containers allocated",8,app.getLiveContainers().size());
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown(){
  scheduler=null;
  resourceManager=null;
  QueueMetrics.clearQueueMetrics();
  DefaultMetricsSystem.shutdown();
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSimpleFairShareCalculation() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(10 * 1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(10 * 1024,"queue1","user1");
  createSchedulingRequest(10 * 1024,"queue2","user1");
  createSchedulingRequest(10 * 1024,"root.default","user1");
  scheduler.update();
  scheduler.getQueueManager().getRootQueue().setSteadyFairShare(scheduler.getClusterResource());
  scheduler.getQueueManager().getRootQueue().recomputeSteadyShares();
  Collection<FSLeafQueue> queues=scheduler.getQueueManager().getLeafQueues();
  assertEquals(3,queues.size());
  for (  FSLeafQueue p : queues) {
    assertEquals(3414,p.getFairShare().getMemory());
    assertEquals(3414,p.getMetrics().getFairShareMB());
    assertEquals(3414,p.getSteadyFairShare().getMemory());
    assertEquals(3414,p.getMetrics().getSteadyFairShareMB());
  }
}

</code></pre>

<pre class="type-9 type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=30000) public void testHostPortNodeName() throws Exception {
  conf.setBoolean(YarnConfiguration.RM_SCHEDULER_INCLUDE_PORT_IN_NODE_NAME,true);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1",1);
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.1",2);
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",0);
  ResourceRequest nodeRequest=createResourceRequest(1024,node1.getNodeID().getHost() + ":" + node1.getNodeID().getPort(),1,1,true);
  ResourceRequest rackRequest=createResourceRequest(1024,node1.getRackName(),1,1,false);
  ResourceRequest anyRequest=createResourceRequest(1024,ResourceRequest.ANY,1,1,false);
  createSchedulingRequestExistingApplication(nodeRequest,attId1);
  createSchedulingRequestExistingApplication(rackRequest,attId1);
  createSchedulingRequestExistingApplication(anyRequest,attId1);
  scheduler.update();
  NodeUpdateSchedulerEvent node1UpdateEvent=new NodeUpdateSchedulerEvent(node1);
  NodeUpdateSchedulerEvent node2UpdateEvent=new NodeUpdateSchedulerEvent(node2);
  FSAppAttempt app=scheduler.getSchedulerApp(attId1);
  for (int i=0; i < 10; i++) {
    scheduler.handle(node2UpdateEvent);
    assertEquals(0,app.getLiveContainers().size());
    assertEquals(0,app.getReservedContainers().size());
  }
  scheduler.handle(node1UpdateEvent);
  assertEquals(1,app.getLiveContainers().size());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
"></span><br>
@Test public void testAssignToNonLeafQueueReturnsNull() throws Exception {
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"true");
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  scheduler.getQueueManager().getLeafQueue("root.child1.granchild",true);
  scheduler.getQueueManager().getLeafQueue("root.child2",true);
  RMApp rmApp1=new MockRMApp(0,0,RMAppState.NEW);
  RMApp rmApp2=new MockRMApp(1,1,RMAppState.NEW);
  assertNull(scheduler.assignToQueue(rmApp1,"root.child1","tintin"));
  assertNotNull(scheduler.assignToQueue(rmApp2,"root.child2","snowy"));
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAppAdditionAndRemoval() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId attemptId=createAppAttemptId(1,1);
  AppAddedSchedulerEvent appAddedEvent=new AppAddedSchedulerEvent(attemptId.getApplicationId(),"default","user1");
  scheduler.handle(appAddedEvent);
  AppAttemptAddedSchedulerEvent attemptAddedEvent=new AppAttemptAddedSchedulerEvent(createAppAttemptId(1,1),false);
  scheduler.handle(attemptAddedEvent);
  assertEquals(2,scheduler.getQueueManager().getLeafQueues().size());
  assertEquals(1,scheduler.getQueueManager().getLeafQueue("user1",true).getRunnableAppSchedulables().size());
  AppAttemptRemovedSchedulerEvent appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(createAppAttemptId(1,1),RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent1);
  assertEquals(0,scheduler.getQueueManager().getLeafQueue("user1",true).getRunnableAppSchedulables().size());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Make allocation requests and ensure they are reflected in queue demand.
 */
@Test public void testQueueDemandCalculation() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId id11=createAppAttemptId(1,1);
  scheduler.addApplication(id11.getApplicationId(),"root.queue1","user1",false);
  scheduler.addApplicationAttempt(id11,false,false);
  ApplicationAttemptId id21=createAppAttemptId(2,1);
  scheduler.addApplication(id21.getApplicationId(),"root.queue2","user1",false);
  scheduler.addApplicationAttempt(id21,false,false);
  ApplicationAttemptId id22=createAppAttemptId(2,2);
  scheduler.addApplication(id22.getApplicationId(),"root.queue2","user1",false);
  scheduler.addApplicationAttempt(id22,false,false);
  int minReqSize=FairSchedulerConfiguration.DEFAULT_RM_SCHEDULER_INCREMENT_ALLOCATION_MB;
  List<ResourceRequest> ask1=new ArrayList<ResourceRequest>();
  ResourceRequest request1=createResourceRequest(minReqSize * 2,ResourceRequest.ANY,1,1,true);
  ask1.add(request1);
  scheduler.allocate(id11,ask1,new ArrayList<ContainerId>(),null,null);
  List<ResourceRequest> ask2=new ArrayList<ResourceRequest>();
  ResourceRequest request2=createResourceRequest(2 * minReqSize,"foo",1,1,false);
  ResourceRequest request3=createResourceRequest(minReqSize,"bar",1,2,false);
  ask2.add(request2);
  ask2.add(request3);
  scheduler.allocate(id21,ask2,new ArrayList<ContainerId>(),null,null);
  List<ResourceRequest> ask3=new ArrayList<ResourceRequest>();
  ResourceRequest request4=createResourceRequest(2 * minReqSize,ResourceRequest.ANY,1,1,true);
  ask3.add(request4);
  scheduler.allocate(id22,ask3,new ArrayList<ContainerId>(),null,null);
  scheduler.update();
  assertEquals(2 * minReqSize,scheduler.getQueueManager().getQueue("root.queue1").getDemand().getMemory());
  assertEquals(2 * minReqSize + 2 * minReqSize + (2 * minReqSize),scheduler.getQueueManager().getQueue("root.queue2").getDemand().getMemory());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testUserMaxRunningApps() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<user name=\"user1\">");
  out.println("<maxRunningApps>1</maxRunningApps>");
  out.println("</user>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8192,8),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  assertEquals(1,scheduler.getSchedulerApp(attId1).getLiveContainers().size());
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.getSchedulerApp(attId2).getLiveContainers().size());
  createSchedulingRequestExistingApplication(1024,1,attId1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(2,scheduler.getSchedulerApp(attId1).getLiveContainers().size());
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("resource") @Test public void testBlacklistNodes() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  final int GB=1024;
  String host="127.0.0.1";
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(16 * GB,16),0,host);
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  ApplicationAttemptId appAttemptId=createSchedulingRequest(GB,"root.default","user",1);
  FSAppAttempt app=scheduler.getSchedulerApp(appAttemptId);
  scheduler.allocate(appAttemptId,Collections.<ResourceRequest>emptyList(),Collections.<ContainerId>emptyList(),Collections.singletonList(host),null);
  assertTrue(app.isBlacklisted(host));
  scheduler.allocate(appAttemptId,Collections.<ResourceRequest>emptyList(),Collections.<ContainerId>emptyList(),null,Collections.singletonList(host));
  assertFalse(scheduler.getSchedulerApp(appAttemptId).isBlacklisted(host));
  List<ResourceRequest> update=Arrays.asList(createResourceRequest(GB,node.getHostName(),1,0,true));
  scheduler.allocate(appAttemptId,update,Collections.<ContainerId>emptyList(),Collections.singletonList(host),null);
  assertTrue(app.isBlacklisted(host));
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Incorrect number of containers allocated",0,app.getLiveContainers().size());
  scheduler.allocate(appAttemptId,update,Collections.<ContainerId>emptyList(),null,Collections.singletonList(host));
  assertFalse(app.isBlacklisted(host));
  createSchedulingRequest(GB,"root.default","user",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Incorrect number of containers allocated",1,app.getLiveContainers().size());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPerfMetricsInited(){
  scheduler.init(conf);
  scheduler.start();
  MetricsCollectorImpl collector=new MetricsCollectorImpl();
  scheduler.fsOpDurations.getMetrics(collector,true);
  assertEquals("Incorrect number of perf metrics",1,collector.getRecords().size());
}

</code></pre>

<pre class="type-7 type-6 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=YarnException.class) public void testMoveWouldViolateMaxResourcesConstraints() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueMgr=scheduler.getQueueManager();
  FSLeafQueue oldQueue=queueMgr.getLeafQueue("queue1",true);
  queueMgr.getLeafQueue("queue2",true);
  scheduler.getAllocationConfiguration().maxQueueResources.put("root.queue2",Resource.newInstance(1024,1));
  ApplicationAttemptId appAttId=createSchedulingRequest(1024,1,"queue1","user1",3);
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(2048,2));
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  scheduler.handle(updateEvent);
  scheduler.handle(updateEvent);
  assertEquals(Resource.newInstance(2048,2),oldQueue.getResourceUsage());
  scheduler.moveApplication(appAttId.getApplicationId(),"queue2");
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMoveNonRunnableApp() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueMgr=scheduler.getQueueManager();
  FSLeafQueue oldQueue=queueMgr.getLeafQueue("queue1",true);
  FSLeafQueue targetQueue=queueMgr.getLeafQueue("queue2",true);
  scheduler.getAllocationConfiguration().queueMaxApps.put("root.queue1",0);
  scheduler.getAllocationConfiguration().queueMaxApps.put("root.queue2",0);
  ApplicationAttemptId appAttId=createSchedulingRequest(1024,1,"queue1","user1",3);
  assertEquals(0,oldQueue.getNumRunnableApps());
  scheduler.moveApplication(appAttId.getApplicationId(),"queue2");
  assertEquals(0,oldQueue.getNumRunnableApps());
  assertEquals(0,targetQueue.getNumRunnableApps());
  assertEquals(0,queueMgr.getRootQueue().getNumRunnableApps());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLowestCommonAncestorForNonRootParent() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  FSLeafQueue aQueue=mock(FSLeafQueue.class);
  FSLeafQueue bQueue=mock(FSLeafQueue.class);
  when(aQueue.getName()).thenReturn("root.queue1.a");
  when(bQueue.getName()).thenReturn("root.queue1.b");
  QueueManager queueManager=scheduler.getQueueManager();
  FSParentQueue queue1=queueManager.getParentQueue("queue1",true);
  queue1.addChildQueue(aQueue);
  queue1.addChildQueue(bQueue);
  FSQueue ancestorQueue=scheduler.findLowestCommonAncestorQueue(aQueue,bQueue);
  assertEquals(ancestorQueue,queue1);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testMultipleNodesSingleRackRequest() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024),2,"127.0.0.2");
  RMNode node3=MockNodes.newNodeInfo(2,Resources.createResource(1024),3,"127.0.0.3");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  ApplicationAttemptId appId=createAppAttemptId(this.APP_ID++,this.ATTEMPT_ID++);
  scheduler.addApplication(appId.getApplicationId(),"queue1","user1",false);
  scheduler.addApplicationAttempt(appId,false,false);
  List<ResourceRequest> asks=new ArrayList<ResourceRequest>();
  asks.add(createResourceRequest(1024,node1.getHostName(),1,1,true));
  asks.add(createResourceRequest(1024,node2.getHostName(),1,1,true));
  asks.add(createResourceRequest(1024,node3.getHostName(),1,1,true));
  asks.add(createResourceRequest(1024,node1.getRackName(),1,1,true));
  asks.add(createResourceRequest(1024,node3.getRackName(),1,1,true));
  asks.add(createResourceRequest(1024,ResourceRequest.ANY,1,2,true));
  scheduler.allocate(appId,asks,new ArrayList<ContainerId>(),null,null);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent1=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent1);
  assertEquals(1,scheduler.getSchedulerApp(appId).getLiveContainers().size());
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent2=new NodeUpdateSchedulerEvent(node2);
  scheduler.handle(updateEvent2);
  assertEquals(2,scheduler.getSchedulerApp(appId).getLiveContainers().size());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testMultipleContainersWaitingForReservation() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue2","user2",1);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue3","user3",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1024,scheduler.getSchedulerApp(attId1).getCurrentReservation().getMemory());
  assertEquals(0,scheduler.getSchedulerApp(attId2).getCurrentReservation().getMemory());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=3000) public void testMaxAssignWithZeroMemoryContainers() throws Exception {
  conf.setBoolean(FairSchedulerConfiguration.ASSIGN_MULTIPLE,true);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_MB,0);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(16384,16),0,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  ApplicationAttemptId attId=createSchedulingRequest(0,1,"root.default","user",8);
  FSAppAttempt app=scheduler.getSchedulerApp(attId);
  scheduler.maxAssign=2;
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Incorrect number of containers allocated",2,app.getLiveContainers().size());
  scheduler.maxAssign=-1;
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Incorrect number of containers allocated",8,app.getLiveContainers().size());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRemoveNodeUpdatesRootQueueMetrics() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024,4),1,"127.0.0.1");
  NodeAddedSchedulerEvent addEvent=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(addEvent);
  assertEquals(1024,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(4,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
  scheduler.update();
  assertEquals(1024,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(4,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
  NodeRemovedSchedulerEvent removeEvent=new NodeRemovedSchedulerEvent(node1);
  scheduler.handle(removeEvent);
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
  scheduler.update();
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testQueuePlacementWithPolicy() throws Exception {
  conf.setClass(CommonConfigurationKeys.HADOOP_SECURITY_GROUP_MAPPING,SimpleGroupsMapping.class,GroupMappingServiceProvider.class);
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId appId;
  List<QueuePlacementRule> rules=new ArrayList<QueuePlacementRule>();
  rules.add(new QueuePlacementRule.Specified().initialize(true,null));
  rules.add(new QueuePlacementRule.User().initialize(false,null));
  rules.add(new QueuePlacementRule.PrimaryGroup().initialize(false,null));
  rules.add(new QueuePlacementRule.SecondaryGroupExistingQueue().initialize(false,null));
  rules.add(new QueuePlacementRule.Default().initialize(true,null));
  Set<String> queues=Sets.newHashSet("root.user1","root.user3group","root.user4subgroup1","root.user4subgroup2","root.user5subgroup2");
  Map<FSQueueType,Set<String>> configuredQueues=new HashMap<FSQueueType,Set<String>>();
  configuredQueues.put(FSQueueType.LEAF,queues);
  configuredQueues.put(FSQueueType.PARENT,new HashSet<String>());
  scheduler.getAllocationConfiguration().placementPolicy=new QueuePlacementPolicy(rules,configuredQueues,conf);
  appId=createSchedulingRequest(1024,"somequeue","user1");
  assertEquals("root.somequeue",scheduler.getSchedulerApp(appId).getQueueName());
  appId=createSchedulingRequest(1024,"default","user1");
  assertEquals("root.user1",scheduler.getSchedulerApp(appId).getQueueName());
  appId=createSchedulingRequest(1024,"default","user3");
  assertEquals("root.user3group",scheduler.getSchedulerApp(appId).getQueueName());
  appId=createSchedulingRequest(1024,"default","user4");
  assertEquals("root.user4subgroup1",scheduler.getSchedulerApp(appId).getQueueName());
  appId=createSchedulingRequest(1024,"default","user5");
  assertEquals("root.user5subgroup2",scheduler.getSchedulerApp(appId).getQueueName());
  appId=createSchedulingRequest(1024,"default","otheruser");
  assertEquals("root.default",scheduler.getSchedulerApp(appId).getQueueName());
  rules=new ArrayList<QueuePlacementRule>();
  rules.add(new QueuePlacementRule.User().initialize(false,null));
  rules.add(new QueuePlacementRule.Specified().initialize(true,null));
  rules.add(new QueuePlacementRule.Default().initialize(true,null));
  scheduler.getAllocationConfiguration().placementPolicy=new QueuePlacementPolicy(rules,configuredQueues,conf);
  appId=createSchedulingRequest(1024,"somequeue","user1");
  assertEquals("root.user1",scheduler.getSchedulerApp(appId).getQueueName());
  appId=createSchedulingRequest(1024,"somequeue","otheruser");
  assertEquals("root.somequeue",scheduler.getSchedulerApp(appId).getQueueName());
  appId=createSchedulingRequest(1024,"default","otheruser");
  assertEquals("root.default",scheduler.getSchedulerApp(appId).getQueueName());
}

</code></pre>

<pre class="type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHierarchicalQueueAllocationFileParsing() throws IOException, SAXException, AllocationConfigurationException, ParserConfigurationException {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("<queue name=\"queueC\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueD\">");
  out.println("<minResources>2048mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueManager=scheduler.getQueueManager();
  Collection<FSLeafQueue> leafQueues=queueManager.getLeafQueues();
  Assert.assertEquals(4,leafQueues.size());
  Assert.assertNotNull(queueManager.getLeafQueue("queueA",false));
  Assert.assertNotNull(queueManager.getLeafQueue("queueB.queueC",false));
  Assert.assertNotNull(queueManager.getLeafQueue("queueB.queueD",false));
  Assert.assertNotNull(queueManager.getLeafQueue("default",false));
  Assert.assertEquals(4,leafQueues.size());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReservationThatDoesntFit() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  ApplicationAttemptId attId=createSchedulingRequest(2048,"queue1","user1",1);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  FSAppAttempt app=scheduler.getSchedulerApp(attId);
  assertEquals(0,app.getLiveContainers().size());
  assertEquals(0,app.getReservedContainers().size());
  createSchedulingRequestExistingApplication(1024,2,attId);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1,app.getLiveContainers().size());
  assertEquals(0,app.getReservedContainers().size());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNonMinZeroResourcesSettings() throws IOException {
  FairScheduler fs=new FairScheduler();
  YarnConfiguration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_MB,256);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_VCORES,1);
  conf.setInt(FairSchedulerConfiguration.RM_SCHEDULER_INCREMENT_ALLOCATION_MB,512);
  conf.setInt(FairSchedulerConfiguration.RM_SCHEDULER_INCREMENT_ALLOCATION_VCORES,2);
  fs.init(conf);
  fs.reinitialize(conf,null);
  Assert.assertEquals(256,fs.getMinimumResourceCapability().getMemory());
  Assert.assertEquals(1,fs.getMinimumResourceCapability().getVirtualCores());
  Assert.assertEquals(512,fs.getIncrementResourceCapability().getMemory());
  Assert.assertEquals(2,fs.getIncrementResourceCapability().getVirtualCores());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUserAndQueueMaxRunningApps() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queue1\">");
  out.println("<maxRunningApps>2</maxRunningApps>");
  out.println("</queue>");
  out.println("<user name=\"user1\">");
  out.println("<maxRunningApps>1</maxRunningApps>");
  out.println("</user>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1");
  verifyAppRunnable(attId1,true);
  verifyQueueNumRunnable("queue1",1,0);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue2","user1");
  verifyAppRunnable(attId2,false);
  verifyQueueNumRunnable("queue2",0,1);
  ApplicationAttemptId attId3=createSchedulingRequest(1024,"queue1","user2");
  verifyAppRunnable(attId3,true);
  verifyQueueNumRunnable("queue1",2,0);
  ApplicationAttemptId attId4=createSchedulingRequest(1024,"queue1","user2");
  verifyAppRunnable(attId4,false);
  verifyQueueNumRunnable("queue1",2,1);
  AppAttemptRemovedSchedulerEvent appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(attId1,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent1);
  verifyAppRunnable(attId2,true);
  verifyQueueNumRunnable("queue2",1,0);
  verifyAppRunnable(attId4,true);
  verifyQueueNumRunnable("queue1",2,0);
  ApplicationAttemptId attId5=createSchedulingRequest(1024,"queue1","user2");
  verifyAppRunnable(attId5,false);
  verifyQueueNumRunnable("queue1",2,1);
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAssignToQueue() throws Exception {
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"true");
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMApp rmApp1=new MockRMApp(0,0,RMAppState.NEW);
  RMApp rmApp2=new MockRMApp(1,1,RMAppState.NEW);
  FSLeafQueue queue1=scheduler.assignToQueue(rmApp1,"default","asterix");
  FSLeafQueue queue2=scheduler.assignToQueue(rmApp2,"notdefault","obelix");
  assertEquals(rmApp1.getQueue(),queue1.getName());
  assertEquals("root.asterix",rmApp1.getQueue());
  assertEquals(rmApp2.getQueue(),queue2.getName());
  assertEquals("root.notdefault",rmApp2.getQueue());
}

</code></pre>

<pre class="type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testThreadLifeCycle() throws InterruptedException {
  conf.setBoolean(FairSchedulerConfiguration.CONTINUOUS_SCHEDULING_ENABLED,true);
  scheduler.init(conf);
  scheduler.start();
  Thread updateThread=scheduler.updateThread;
  Thread schedulingThread=scheduler.schedulingThread;
  assertTrue(updateThread.isAlive());
  assertTrue(schedulingThread.isAlive());
  scheduler.stop();
  int numRetries=100;
  while (numRetries-- > 0 && (updateThread.isAlive() || schedulingThread.isAlive())) {
    Thread.sleep(50);
  }
  assertNotEquals("One of the threads is still alive",0,numRetries);
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testReservationWhileMultiplePriorities() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024,4),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  ApplicationAttemptId attId=createSchedulingRequest(1024,4,"queue1","user1",1,2);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  FSAppAttempt app=scheduler.getSchedulerApp(attId);
  assertEquals(1,app.getLiveContainers().size());
  ContainerId containerId=scheduler.getSchedulerApp(attId).getLiveContainers().iterator().next().getContainerId();
  createSchedulingRequestExistingApplication(1024,4,2,attId);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1,app.getLiveContainers().size());
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
  createSchedulingRequestExistingApplication(1024,4,1,attId);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1,app.getLiveContainers().size());
  for (  RMContainer container : app.getReservedContainers()) {
    assertEquals(2,container.getReservedPriority().getPriority());
  }
  scheduler.allocate(attId,new ArrayList<ResourceRequest>(),Arrays.asList(containerId),null,null);
  assertEquals(1024,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(4,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
  scheduler.update();
  scheduler.handle(updateEvent);
  Collection<RMContainer> liveContainers=app.getLiveContainers();
  assertEquals(1,liveContainers.size());
  for (  RMContainer liveContainer : liveContainers) {
    Assert.assertEquals(2,liveContainer.getContainer().getPriority().getPriority());
  }
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableMB());
  assertEquals(0,scheduler.getRootQueueMetrics().getAvailableVirtualCores());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSchedulerRootQueueMetrics() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024));
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  createSchedulingRequest(1024,"queue2","user1",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1024,scheduler.rootMetrics.getReservedMB());
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024));
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  NodeUpdateSchedulerEvent updateEvent2=new NodeUpdateSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  scheduler.handle(updateEvent2);
  assertEquals(1024,scheduler.rootMetrics.getReservedMB());
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.rootMetrics.getReservedMB());
}

</code></pre>

<pre class="type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHierarchicalQueuesSimilarParents() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueManager=scheduler.getQueueManager();
  FSLeafQueue leafQueue=queueManager.getLeafQueue("parent.child",true);
  Assert.assertEquals(2,queueManager.getLeafQueues().size());
  Assert.assertNotNull(leafQueue);
  Assert.assertEquals("root.parent.child",leafQueue.getName());
  FSLeafQueue leafQueue2=queueManager.getLeafQueue("parent",true);
  Assert.assertNull(leafQueue2);
  Assert.assertEquals(2,queueManager.getLeafQueues().size());
  FSLeafQueue leafQueue3=queueManager.getLeafQueue("parent.child.grandchild",true);
  Assert.assertNull(leafQueue3);
  Assert.assertEquals(2,queueManager.getLeafQueues().size());
  FSLeafQueue leafQueue4=queueManager.getLeafQueue("parent.sister",true);
  Assert.assertNotNull(leafQueue4);
  Assert.assertEquals("root.parent.sister",leafQueue4.getName());
  Assert.assertEquals(3,queueManager.getLeafQueues().size());
}

</code></pre>

<pre class="type-9 type-7 type-10 type-19 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveRunnableApp() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueMgr=scheduler.getQueueManager();
  FSLeafQueue oldQueue=queueMgr.getLeafQueue("queue1",true);
  FSLeafQueue targetQueue=queueMgr.getLeafQueue("queue2",true);
  ApplicationAttemptId appAttId=createSchedulingRequest(1024,1,"queue1","user1",3);
  ApplicationId appId=appAttId.getApplicationId();
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(1024));
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  scheduler.handle(updateEvent);
  assertEquals(Resource.newInstance(1024,1),oldQueue.getResourceUsage());
  scheduler.update();
  assertEquals(Resource.newInstance(3072,3),oldQueue.getDemand());
  scheduler.moveApplication(appId,"queue2");
  FSAppAttempt app=scheduler.getSchedulerApp(appAttId);
  assertSame(targetQueue,app.getQueue());
  assertFalse(oldQueue.getRunnableAppSchedulables().contains(app));
  assertTrue(targetQueue.getRunnableAppSchedulables().contains(app));
  assertEquals(Resource.newInstance(0,0),oldQueue.getResourceUsage());
  assertEquals(Resource.newInstance(1024,1),targetQueue.getResourceUsage());
  assertEquals(0,oldQueue.getNumRunnableApps());
  assertEquals(1,targetQueue.getNumRunnableApps());
  assertEquals(1,queueMgr.getRootQueue().getNumRunnableApps());
  scheduler.update();
  assertEquals(Resource.newInstance(0,0),oldQueue.getDemand());
  assertEquals(Resource.newInstance(3072,3),targetQueue.getDemand());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAggregateCapacityTracking() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  assertEquals(1024,scheduler.getClusterResource().getMemory());
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(512),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  assertEquals(1536,scheduler.getClusterResource().getMemory());
  NodeRemovedSchedulerEvent nodeEvent3=new NodeRemovedSchedulerEvent(node1);
  scheduler.handle(nodeEvent3);
  assertEquals(512,scheduler.getClusterResource().getMemory());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAddAndRemoveAppFromFairScheduler() throws Exception {
  AbstractYarnScheduler<SchedulerApplicationAttempt,SchedulerNode> scheduler=(AbstractYarnScheduler<SchedulerApplicationAttempt,SchedulerNode>)resourceManager.getResourceScheduler();
  TestSchedulerUtils.verifyAppAddedAndRemovedFromScheduler(scheduler.getSchedulerApplications(),scheduler,"default");
}

</code></pre>

<pre class="type-7 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConfigureRootQueue() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<defaultQueueSchedulingPolicy>fair</defaultQueueSchedulingPolicy>");
  out.println("<queue name=\"root\">");
  out.println("  <schedulingPolicy>drf</schedulingPolicy>");
  out.println("  <queue name=\"child1\">");
  out.println("    <minResources>1024mb,1vcores</minResources>");
  out.println("  </queue>");
  out.println("  <queue name=\"child2\">");
  out.println("    <minResources>1024mb,4vcores</minResources>");
  out.println("  </queue>");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueManager=scheduler.getQueueManager();
  FSQueue root=queueManager.getRootQueue();
  assertTrue(root.getPolicy() instanceof DominantResourceFairnessPolicy);
  assertNotNull(queueManager.getLeafQueue("child1",false));
  assertNotNull(queueManager.getLeafQueue("child2",false));
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testQueueMaxAMShareDefault() throws Exception {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queue1\">");
  out.println("</queue>");
  out.println("<queue name=\"queue2\">");
  out.println("<maxAMShare>1.0</maxAMShare>");
  out.println("</queue>");
  out.println("<queue name=\"queue3\">");
  out.println("</queue>");
  out.println("<queue name=\"queue4\">");
  out.println("</queue>");
  out.println("<queue name=\"queue5\">");
  out.println("</queue>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(8192,20),0,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent=new NodeAddedSchedulerEvent(node);
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
  scheduler.handle(nodeEvent);
  scheduler.update();
  FSLeafQueue queue1=scheduler.getQueueManager().getLeafQueue("queue1",true);
  assertEquals("Queue queue1's fair share should be 0",0,queue1.getFairShare().getMemory());
  FSLeafQueue queue2=scheduler.getQueueManager().getLeafQueue("queue2",true);
  assertEquals("Queue queue2's fair share should be 0",0,queue2.getFairShare().getMemory());
  FSLeafQueue queue3=scheduler.getQueueManager().getLeafQueue("queue3",true);
  assertEquals("Queue queue3's fair share should be 0",0,queue3.getFairShare().getMemory());
  FSLeafQueue queue4=scheduler.getQueueManager().getLeafQueue("queue4",true);
  assertEquals("Queue queue4's fair share should be 0",0,queue4.getFairShare().getMemory());
  FSLeafQueue queue5=scheduler.getQueueManager().getLeafQueue("queue5",true);
  assertEquals("Queue queue5's fair share should be 0",0,queue5.getFairShare().getMemory());
  List<String> queues=Arrays.asList("root.default","root.queue3","root.queue4","root.queue5");
  for (  String queue : queues) {
    createSchedulingRequest(1 * 1024,queue,"user1");
    scheduler.update();
    scheduler.handle(updateEvent);
  }
  Resource amResource1=Resource.newInstance(2048,1);
  int amPriority=RMAppAttemptImpl.AM_CONTAINER_PRIORITY.getPriority();
  ApplicationAttemptId attId1=createAppAttemptId(1,1);
  createApplicationWithAMResource(attId1,"queue1","test1",amResource1);
  createSchedulingRequestExistingApplication(2048,1,amPriority,attId1);
  FSAppAttempt app1=scheduler.getSchedulerApp(attId1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application1's AM requests 2048 MB memory",2048,app1.getAMResource().getMemory());
  assertEquals("Application1's AM should be running",1,app1.getLiveContainers().size());
  assertEquals("Queue1's AM resource usage should be 2048 MB memory",2048,queue1.getAmResourceUsage().getMemory());
  ApplicationAttemptId attId2=createAppAttemptId(2,1);
  createApplicationWithAMResource(attId2,"queue2","test1",amResource1);
  createSchedulingRequestExistingApplication(2048,1,amPriority,attId2);
  FSAppAttempt app2=scheduler.getSchedulerApp(attId2);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals("Application2's AM requests 2048 MB memory",2048,app2.getAMResource().getMemory());
  assertEquals("Application2's AM should not be running",0,app2.getLiveContainers().size());
  assertEquals("Queue2's AM resource usage should be 0 MB memory",0,queue2.getAmResourceUsage().getMemory());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMinZeroResourcesSettings() throws IOException {
  FairScheduler fs=new FairScheduler();
  YarnConfiguration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_MB,0);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_VCORES,0);
  conf.setInt(FairSchedulerConfiguration.RM_SCHEDULER_INCREMENT_ALLOCATION_MB,512);
  conf.setInt(FairSchedulerConfiguration.RM_SCHEDULER_INCREMENT_ALLOCATION_VCORES,2);
  fs.init(conf);
  fs.reinitialize(conf,null);
  Assert.assertEquals(0,fs.getMinimumResourceCapability().getMemory());
  Assert.assertEquals(0,fs.getMinimumResourceCapability().getVirtualCores());
  Assert.assertEquals(512,fs.getIncrementResourceCapability().getMemory());
  Assert.assertEquals(2,fs.getIncrementResourceCapability().getVirtualCores());
}

</code></pre>

<pre class="type-7 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEmptyQueueName() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  assertEquals(1,scheduler.getQueueManager().getLeafQueues().size());
  ApplicationAttemptId appAttemptId=createAppAttemptId(1,1);
  AppAddedSchedulerEvent appAddedEvent=new AppAddedSchedulerEvent(appAttemptId.getApplicationId(),"","user1");
  scheduler.handle(appAddedEvent);
  assertEquals(1,scheduler.getQueueManager().getLeafQueues().size());
  assertNull(scheduler.getSchedulerApp(appAttemptId));
  assertEquals(0,resourceManager.getRMContext().getRMApps().size());
}

</code></pre>

<pre class="type-9 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNestedUserQueue() throws IOException {
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  conf.setClass(CommonConfigurationKeys.HADOOP_SECURITY_GROUP_MAPPING,SimpleGroupsMapping.class,GroupMappingServiceProvider.class);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"user1group\" type=\"parent\">");
  out.println("<minResources>1024mb,0vcores</minResources>");
  out.println("</queue>");
  out.println("<queuePlacementPolicy>");
  out.println("<rule name=\"specified\" create=\"false\" />");
  out.println("<rule name=\"nestedUserQueue\">");
  out.println("     <rule name=\"primaryGroup\" create=\"false\" />");
  out.println("</rule>");
  out.println("<rule name=\"default\" />");
  out.println("</queuePlacementPolicy>");
  out.println("</allocations>");
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMApp rmApp1=new MockRMApp(0,0,RMAppState.NEW);
  FSLeafQueue user1Leaf=scheduler.assignToQueue(rmApp1,"root.default","user1");
  assertEquals("root.user1group.user1",user1Leaf.getName());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=5000) public void testFifoWithinQueue() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(3072,3),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",2);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue1","user1",2);
  FSAppAttempt app1=scheduler.getSchedulerApp(attId1);
  FSAppAttempt app2=scheduler.getSchedulerApp(attId2);
  FSLeafQueue queue1=scheduler.getQueueManager().getLeafQueue("queue1",true);
  queue1.setPolicy(new FifoPolicy());
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  assertEquals(1,app1.getLiveContainers().size());
  assertEquals(0,app2.getLiveContainers().size());
  scheduler.handle(updateEvent);
  assertEquals(2,app1.getLiveContainers().size());
  assertEquals(0,app2.getLiveContainers().size());
  scheduler.handle(updateEvent);
  assertEquals(2,app1.getLiveContainers().size());
  assertEquals(1,app2.getLiveContainers().size());
}

</code></pre>

<pre class="type-14 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=YarnException.class) public void testMoveWouldViolateMaxAppsConstraints() throws Exception {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  QueueManager queueMgr=scheduler.getQueueManager();
  queueMgr.getLeafQueue("queue2",true);
  scheduler.getAllocationConfiguration().queueMaxApps.put("root.queue2",0);
  ApplicationAttemptId appAttId=createSchedulingRequest(1024,1,"queue1","user1",3);
  scheduler.moveApplication(appAttId.getApplicationId(),"queue2");
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSimpleHierarchicalFairShareCalculation() throws IOException {
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  int capacity=10 * 24;
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(capacity),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(10 * 1024,"parent.queue2","user1");
  createSchedulingRequest(10 * 1024,"parent.queue3","user1");
  createSchedulingRequest(10 * 1024,"root.default","user1");
  scheduler.update();
  scheduler.getQueueManager().getRootQueue().setSteadyFairShare(scheduler.getClusterResource());
  scheduler.getQueueManager().getRootQueue().recomputeSteadyShares();
  QueueManager queueManager=scheduler.getQueueManager();
  Collection<FSLeafQueue> queues=queueManager.getLeafQueues();
  assertEquals(3,queues.size());
  FSLeafQueue queue1=queueManager.getLeafQueue("default",true);
  FSLeafQueue queue2=queueManager.getLeafQueue("parent.queue2",true);
  FSLeafQueue queue3=queueManager.getLeafQueue("parent.queue3",true);
  assertEquals(capacity / 2,queue1.getFairShare().getMemory());
  assertEquals(capacity / 2,queue1.getMetrics().getFairShareMB());
  assertEquals(capacity / 2,queue1.getSteadyFairShare().getMemory());
  assertEquals(capacity / 2,queue1.getMetrics().getSteadyFairShareMB());
  assertEquals(capacity / 4,queue2.getFairShare().getMemory());
  assertEquals(capacity / 4,queue2.getMetrics().getFairShareMB());
  assertEquals(capacity / 4,queue2.getSteadyFairShare().getMemory());
  assertEquals(capacity / 4,queue2.getMetrics().getSteadyFairShareMB());
  assertEquals(capacity / 4,queue3.getFairShare().getMemory());
  assertEquals(capacity / 4,queue3.getMetrics().getFairShareMB());
  assertEquals(capacity / 4,queue3.getSteadyFairShare().getMemory());
  assertEquals(capacity / 4,queue3.getMetrics().getSteadyFairShareMB());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
