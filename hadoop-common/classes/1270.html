<h3 style="margin:0px">Class: org.apache.hadoop.yarn.server.resourcemanager.TestRMAdminService (17 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(14)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="20"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('20')" data-toggle="tooltip" title="Verifies values related to public fields."><kbd id="tag-20"class="label-info"style="display: inline-block;font-size:7pt" >PublicFieldVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testRefreshUserToGroupsMappingsWithLocalConfigurationProvider(){
  rm=new MockRM(configuration);
  rm.init(configuration);
  rm.start();
  try {
    rm.adminService.refreshUserToGroupsMappings(RefreshUserToGroupsMappingsRequest.newInstance());
  }
 catch (  Exception ex) {
    fail("Using localConfigurationProvider. Should not get any exception.");
  }
}

</code></pre>

<pre class="type-2 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAdminRefreshQueuesWithLocalConfigurationProvider() throws IOException, YarnException {
  rm=new MockRM(configuration);
  rm.init(configuration);
  rm.start();
  CapacityScheduler cs=(CapacityScheduler)rm.getRMContext().getScheduler();
  int maxAppsBefore=cs.getConfiguration().getMaximumSystemApplications();
  try {
    rm.adminService.refreshQueues(RefreshQueuesRequest.newInstance());
    Assert.assertEquals(maxAppsBefore,cs.getConfiguration().getMaximumSystemApplications());
  }
 catch (  Exception ex) {
    fail("Using localConfigurationProvider. Should not get any exception.");
  }
}

</code></pre>

<pre class="type-9 type-11 type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRMInitialsWithFileSystemBasedConfigurationProvider() throws Exception {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  final File excludeHostsFile=new File(tmpDir.toString(),"excludeHosts");
  if (excludeHostsFile.exists()) {
    excludeHostsFile.delete();
  }
  if (!excludeHostsFile.createNewFile()) {
    Assert.fail("Can not create " + "excludeHosts");
  }
  PrintWriter fileWriter=new PrintWriter(excludeHostsFile);
  fileWriter.write("0.0.0.0:123");
  fileWriter.close();
  uploadToRemoteFileSystem(new Path(excludeHostsFile.getAbsolutePath()));
  YarnConfiguration yarnConf=new YarnConfiguration();
  yarnConf.set(YarnConfiguration.YARN_ADMIN_ACL,"world:anyone:rwcda");
  yarnConf.set(YarnConfiguration.RM_NODES_EXCLUDE_FILE_PATH,this.workingPath + "/excludeHosts");
  uploadConfiguration(yarnConf,"yarn-site.xml");
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  csConf.set("yarn.scheduler.capacity.maximum-applications","5000");
  uploadConfiguration(csConf,"capacity-scheduler.xml");
  String aclsString="alice,bob users,wheel";
  Configuration newConf=new Configuration();
  newConf.set("security.applicationclient.protocol.acl",aclsString);
  uploadConfiguration(newConf,"hadoop-policy.xml");
  Configuration conf=new Configuration();
  conf.setBoolean(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION,true);
  conf.set("hadoop.proxyuser.test.groups","test_groups");
  conf.set("hadoop.proxyuser.test.hosts","test_hosts");
  conf.setClass(CommonConfigurationKeys.HADOOP_SECURITY_GROUP_MAPPING,MockUnixGroupsMapping.class,GroupMappingServiceProvider.class);
  uploadConfiguration(conf,"core-site.xml");
  MockUnixGroupsMapping.updateGroups();
  ResourceManager resourceManager=null;
  try {
    try {
      resourceManager=new ResourceManager();
      resourceManager.init(configuration);
      resourceManager.start();
    }
 catch (    Exception ex) {
      fail("Should not get any exceptions");
    }
    Set<String> excludeHosts=resourceManager.getRMContext().getNodesListManager().getHostsReader().getExcludedHosts();
    Assert.assertTrue(excludeHosts.size() == 1);
    Assert.assertTrue(excludeHosts.contains("0.0.0.0:123"));
    String aclStringAfter=resourceManager.adminService.getAccessControlList().getAclString().trim();
    Assert.assertEquals(aclStringAfter,"world:anyone:rwcda");
    CapacityScheduler cs=(CapacityScheduler)resourceManager.getRMContext().getScheduler();
    int maxAppsAfter=cs.getConfiguration().getMaximumSystemApplications();
    Assert.assertEquals(maxAppsAfter,5000);
    ServiceAuthorizationManager adminServiceServiceManager=resourceManager.adminService.getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(adminServiceServiceManager,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager clientRMServiceServiceManager=resourceManager.getRMContext().getClientRMService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(clientRMServiceServiceManager,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager appMasterService=resourceManager.getRMContext().getApplicationMasterService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(appMasterService,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager RTService=resourceManager.getRMContext().getResourceTrackerService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(RTService,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyGroups().get("hadoop.proxyuser.test.groups").size() == 1);
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyGroups().get("hadoop.proxyuser.test.groups").contains("test_groups"));
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyHosts().get("hadoop.proxyuser.test.hosts").size() == 1);
    Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyHosts().get("hadoop.proxyuser.test.hosts").contains("test_hosts"));
    List<String> groupAfter=Groups.getUserToGroupsMappingService(configuration).getGroups(UserGroupInformation.getCurrentUser().getUserName());
    Assert.assertTrue(groupAfter.contains("test_group_D") && groupAfter.contains("test_group_E") && groupAfter.contains("test_group_F")&& groupAfter.size() == 3);
  }
  finally {
    if (resourceManager != null) {
      resourceManager.stop();
    }
  }
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown() throws IOException {
  if (rm != null) {
    rm.stop();
  }
  fs.delete(workingPath,true);
  fs.delete(tmpDir,true);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testRefreshNodesWithLocalConfigurationProvider(){
  rm=new MockRM(configuration);
  rm.init(configuration);
  rm.start();
  try {
    rm.adminService.refreshNodes(RefreshNodesRequest.newInstance());
  }
 catch (  Exception ex) {
    fail("Using localConfigurationProvider. Should not get any exception.");
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testRMStartsWithoutConfigurationFilesProvided(){
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
}

</code></pre>

<pre class="type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRMHAWithFileSystemBasedConfiguration() throws IOException, YarnException {
  StateChangeRequestInfo requestInfo=new StateChangeRequestInfo(HAServiceProtocol.RequestSource.REQUEST_BY_USER);
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  configuration.setBoolean(YarnConfiguration.RM_HA_ENABLED,true);
  configuration.setBoolean(YarnConfiguration.AUTO_FAILOVER_ENABLED,false);
  configuration.set(YarnConfiguration.RM_HA_IDS,"rm1,rm2");
  int base=100;
  for (  String confKey : YarnConfiguration.getServiceAddressConfKeys(configuration)) {
    configuration.set(HAUtil.addSuffix(confKey,"rm1"),"0.0.0.0:" + (base + 20));
    configuration.set(HAUtil.addSuffix(confKey,"rm2"),"0.0.0.0:" + (base + 40));
    base=base * 2;
  }
  Configuration conf1=new Configuration(configuration);
  conf1.set(YarnConfiguration.RM_HA_ID,"rm1");
  Configuration conf2=new Configuration(configuration);
  conf2.set(YarnConfiguration.RM_HA_ID,"rm2");
  uploadDefaultConfiguration();
  MockRM rm1=null;
  MockRM rm2=null;
  try {
    rm1=new MockRM(conf1);
    rm1.init(conf1);
    rm1.start();
    Assert.assertTrue(rm1.getRMContext().getHAServiceState() == HAServiceState.STANDBY);
    rm2=new MockRM(conf2);
    rm2.init(conf1);
    rm2.start();
    Assert.assertTrue(rm2.getRMContext().getHAServiceState() == HAServiceState.STANDBY);
    rm1.adminService.transitionToActive(requestInfo);
    Assert.assertTrue(rm1.getRMContext().getHAServiceState() == HAServiceState.ACTIVE);
    CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
    csConf.set("yarn.scheduler.capacity.maximum-applications","5000");
    uploadConfiguration(csConf,"capacity-scheduler.xml");
    rm1.adminService.refreshQueues(RefreshQueuesRequest.newInstance());
    int maxApps=((CapacityScheduler)rm1.getRMContext().getScheduler()).getConfiguration().getMaximumSystemApplications();
    Assert.assertEquals(maxApps,5000);
    int maxAppsBeforeFailOver=((CapacityScheduler)rm2.getRMContext().getScheduler()).getConfiguration().getMaximumSystemApplications();
    Assert.assertEquals(maxAppsBeforeFailOver,10000);
    rm1.adminService.transitionToStandby(requestInfo);
    rm2.adminService.transitionToActive(requestInfo);
    Assert.assertTrue(rm1.getRMContext().getHAServiceState() == HAServiceState.STANDBY);
    Assert.assertTrue(rm2.getRMContext().getHAServiceState() == HAServiceState.ACTIVE);
    int maxAppsAfter=((CapacityScheduler)rm2.getRMContext().getScheduler()).getConfiguration().getMaximumSystemApplications();
    Assert.assertEquals(maxAppsAfter,5000);
  }
  finally {
    if (rm1 != null) {
      rm1.stop();
    }
    if (rm2 != null) {
      rm2.stop();
    }
  }
}

</code></pre>

<pre class="type-2 type-7 type-10 type-6 type-20 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAdminAclsWithFileSystemBasedConfigurationProvider() throws IOException, YarnException {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  uploadDefaultConfiguration();
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
  String aclStringBefore=rm.adminService.getAccessControlList().getAclString().trim();
  YarnConfiguration yarnConf=new YarnConfiguration();
  yarnConf.set(YarnConfiguration.YARN_ADMIN_ACL,"world:anyone:rwcda");
  uploadConfiguration(yarnConf,"yarn-site.xml");
  rm.adminService.refreshAdminAcls(RefreshAdminAclsRequest.newInstance());
  String aclStringAfter=rm.adminService.getAccessControlList().getAclString().trim();
  Assert.assertTrue(!aclStringAfter.equals(aclStringBefore));
  Assert.assertEquals(aclStringAfter,"world:anyone:rwcda");
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setup() throws IOException {
  configuration=new YarnConfiguration();
  configuration.set(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class.getCanonicalName());
  fs=FileSystem.get(configuration);
  workingPath=new Path(new File("target",this.getClass().getSimpleName() + "-remoteDir").getAbsolutePath());
  configuration.set(YarnConfiguration.FS_BASED_RM_CONF_STORE,workingPath.toString());
  tmpDir=new Path(new File("target",this.getClass().getSimpleName() + "-tmpDir").getAbsolutePath());
  fs.delete(workingPath,true);
  fs.delete(tmpDir,true);
  fs.mkdirs(workingPath);
  fs.mkdirs(tmpDir);
  MockUnixGroupsMapping.resetGroups();
}

</code></pre>

<pre class="type-9 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRefreshUserToGroupsMappingsWithFileSystemBasedConfigurationProvider() throws IOException, YarnException {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  String[] defaultTestUserGroups={"dummy_group1","dummy_group2"};
  UserGroupInformation ugi=UserGroupInformation.createUserForTesting("dummyUser",defaultTestUserGroups);
  String user=ugi.getUserName();
  List<String> groupWithInit=new ArrayList<String>(2);
  for (int i=0; i < ugi.getGroupNames().length; i++) {
    groupWithInit.add(ugi.getGroupNames()[i]);
  }
  uploadDefaultConfiguration();
  Configuration conf=new Configuration();
  conf.setClass(CommonConfigurationKeys.HADOOP_SECURITY_GROUP_MAPPING,MockUnixGroupsMapping.class,GroupMappingServiceProvider.class);
  uploadConfiguration(conf,"core-site.xml");
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
  List<String> groupBefore=new ArrayList<String>(Groups.getUserToGroupsMappingService(configuration).getGroups(user));
  Assert.assertTrue(groupBefore.contains("test_group_A") && groupBefore.contains("test_group_B") && groupBefore.contains("test_group_C")&& groupBefore.size() == 3);
  Assert.assertTrue(groupWithInit.size() != groupBefore.size());
  Assert.assertFalse(groupWithInit.contains("test_group_A") || groupWithInit.contains("test_group_B") || groupWithInit.contains("test_group_C"));
  MockUnixGroupsMapping.updateGroups();
  rm.adminService.refreshUserToGroupsMappings(RefreshUserToGroupsMappingsRequest.newInstance());
  List<String> groupAfter=Groups.getUserToGroupsMappingService(configuration).getGroups(user);
  Assert.assertTrue(groupAfter.contains("test_group_D") && groupAfter.contains("test_group_E") && groupAfter.contains("test_group_F")&& groupAfter.size() == 3);
}

</code></pre>

<pre class="type-11 type-2 type-7 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRefreshNodesWithFileSystemBasedConfigurationProvider() throws IOException, YarnException {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  uploadDefaultConfiguration();
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
  final File excludeHostsFile=new File(tmpDir.toString(),"excludeHosts");
  if (excludeHostsFile.exists()) {
    excludeHostsFile.delete();
  }
  if (!excludeHostsFile.createNewFile()) {
    Assert.fail("Can not create " + "excludeHosts");
  }
  PrintWriter fileWriter=new PrintWriter(excludeHostsFile);
  fileWriter.write("0.0.0.0:123");
  fileWriter.close();
  uploadToRemoteFileSystem(new Path(excludeHostsFile.getAbsolutePath()));
  Configuration yarnConf=new YarnConfiguration();
  yarnConf.set(YarnConfiguration.RM_NODES_EXCLUDE_FILE_PATH,this.workingPath + "/excludeHosts");
  uploadConfiguration(yarnConf,YarnConfiguration.YARN_SITE_CONFIGURATION_FILE);
  rm.adminService.refreshNodes(RefreshNodesRequest.newInstance());
  Set<String> excludeHosts=rm.getNodesListManager().getHostsReader().getExcludedHosts();
  Assert.assertTrue(excludeHosts.size() == 1);
  Assert.assertTrue(excludeHosts.contains("0.0.0.0:123"));
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testServiceAclsRefreshWithFileSystemBasedConfigurationProvider() throws IOException, YarnException {
  configuration.setBoolean(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION,true);
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  ResourceManager resourceManager=null;
  try {
    uploadDefaultConfiguration();
    Configuration conf=new Configuration();
    conf.setBoolean(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION,true);
    uploadConfiguration(conf,"core-site.xml");
    try {
      resourceManager=new ResourceManager();
      resourceManager.init(configuration);
      resourceManager.start();
    }
 catch (    Exception ex) {
      fail("Should not get any exceptions");
    }
    String aclsString="alice,bob users,wheel";
    Configuration newConf=new Configuration();
    newConf.set("security.applicationclient.protocol.acl",aclsString);
    uploadConfiguration(newConf,"hadoop-policy.xml");
    resourceManager.adminService.refreshServiceAcls(RefreshServiceAclsRequest.newInstance());
    ServiceAuthorizationManager adminServiceServiceManager=resourceManager.adminService.getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(adminServiceServiceManager,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager clientRMServiceServiceManager=resourceManager.getRMContext().getClientRMService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(clientRMServiceServiceManager,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager appMasterService=resourceManager.getRMContext().getApplicationMasterService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(appMasterService,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
    ServiceAuthorizationManager RTService=resourceManager.getRMContext().getResourceTrackerService().getServer().getServiceAuthorizationManager();
    verifyServiceACLsRefresh(RTService,org.apache.hadoop.yarn.api.ApplicationClientProtocolPB.class,aclsString);
  }
  finally {
    if (resourceManager != null) {
      resourceManager.stop();
    }
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAdminAclsWithLocalConfigurationProvider(){
  rm=new MockRM(configuration);
  rm.init(configuration);
  rm.start();
  try {
    rm.adminService.refreshAdminAcls(RefreshAdminAclsRequest.newInstance());
  }
 catch (  Exception ex) {
    fail("Using localConfigurationProvider. Should not get any exception.");
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testServiceAclsRefreshWithLocalConfigurationProvider(){
  configuration.setBoolean(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHORIZATION,true);
  ResourceManager resourceManager=null;
  try {
    resourceManager=new ResourceManager();
    resourceManager.init(configuration);
    resourceManager.start();
    resourceManager.adminService.refreshServiceAcls(RefreshServiceAclsRequest.newInstance());
  }
 catch (  Exception ex) {
    fail("Using localConfigurationProvider. Should not get any exception.");
  }
 finally {
    if (resourceManager != null) {
      resourceManager.stop();
    }
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testRefreshSuperUserGroupsWithLocalConfigurationProvider(){
  rm=new MockRM(configuration);
  rm.init(configuration);
  rm.start();
  try {
    rm.adminService.refreshSuperUserGroupsConfiguration(RefreshSuperUserGroupsConfigurationRequest.newInstance());
  }
 catch (  Exception ex) {
    fail("Using localConfigurationProvider. Should not get any exception.");
  }
}

</code></pre>

<pre class="type-2 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAdminRefreshQueuesWithFileSystemBasedConfigurationProvider() throws IOException, YarnException {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  uploadDefaultConfiguration();
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
  CapacityScheduler cs=(CapacityScheduler)rm.getRMContext().getScheduler();
  int maxAppsBefore=cs.getConfiguration().getMaximumSystemApplications();
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  csConf.set("yarn.scheduler.capacity.maximum-applications","5000");
  uploadConfiguration(csConf,"capacity-scheduler.xml");
  rm.adminService.refreshQueues(RefreshQueuesRequest.newInstance());
  int maxAppsAfter=cs.getConfiguration().getMaximumSystemApplications();
  Assert.assertEquals(maxAppsAfter,5000);
  Assert.assertTrue(maxAppsAfter != maxAppsBefore);
}

</code></pre>

<pre class="type-2 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRefreshSuperUserGroupsWithFileSystemBasedConfigurationProvider() throws IOException, YarnException {
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  uploadDefaultConfiguration();
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
  Configuration coreConf=new Configuration(false);
  coreConf.set("hadoop.proxyuser.test.groups","test_groups");
  coreConf.set("hadoop.proxyuser.test.hosts","test_hosts");
  uploadConfiguration(coreConf,"core-site.xml");
  rm.adminService.refreshSuperUserGroupsConfiguration(RefreshSuperUserGroupsConfigurationRequest.newInstance());
  Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyGroups().get("hadoop.proxyuser.test.groups").size() == 1);
  Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyGroups().get("hadoop.proxyuser.test.groups").contains("test_groups"));
  Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyHosts().get("hadoop.proxyuser.test.hosts").size() == 1);
  Assert.assertTrue(ProxyUsers.getDefaultImpersonationProvider().getProxyHosts().get("hadoop.proxyuser.test.hosts").contains("test_hosts"));
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
