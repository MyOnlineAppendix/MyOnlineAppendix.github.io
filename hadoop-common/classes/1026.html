<h3 style="margin:0px">Class: org.apache.hadoop.security.authorize.TestAccessControlList (8 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessControlList() throws Exception {
  AccessControlList acl;
  Collection<String> users;
  Collection<String> groups;
  acl=new AccessControlList("drwho tardis");
  users=acl.getUsers();
  assertEquals(users.size(),1);
  assertEquals(users.iterator().next(),"drwho");
  groups=acl.getGroups();
  assertEquals(groups.size(),1);
  assertEquals(groups.iterator().next(),"tardis");
  acl=new AccessControlList("drwho");
  users=acl.getUsers();
  assertEquals(users.size(),1);
  assertEquals(users.iterator().next(),"drwho");
  groups=acl.getGroups();
  assertEquals(groups.size(),0);
  acl=new AccessControlList("drwho ");
  users=acl.getUsers();
  assertEquals(users.size(),1);
  assertEquals(users.iterator().next(),"drwho");
  groups=acl.getGroups();
  assertEquals(groups.size(),0);
  acl=new AccessControlList(" tardis");
  users=acl.getUsers();
  assertEquals(users.size(),0);
  groups=acl.getGroups();
  assertEquals(groups.size(),1);
  assertEquals(groups.iterator().next(),"tardis");
  Iterator<String> iter;
  acl=new AccessControlList("drwho,joe tardis, users");
  users=acl.getUsers();
  assertEquals(users.size(),2);
  iter=users.iterator();
  assertEquals(iter.next(),"drwho");
  assertEquals(iter.next(),"joe");
  groups=acl.getGroups();
  assertEquals(groups.size(),2);
  iter=groups.iterator();
  assertEquals(iter.next(),"tardis");
  assertEquals(iter.next(),"users");
}

</code></pre>

<pre class="type-9 type-7 type-10 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test addUser/Group and removeUser/Group api.
 */
@Test public void testAddRemoveAPI(){
  AccessControlList acl;
  Collection<String> users;
  Collection<String> groups;
  acl=new AccessControlList(" ");
  assertEquals(0,acl.getUsers().size());
  assertEquals(0,acl.getGroups().size());
  assertEquals(" ",acl.getAclString());
  acl.addUser("drwho");
  users=acl.getUsers();
  assertEquals(users.size(),1);
  assertEquals(users.iterator().next(),"drwho");
  assertEquals("drwho ",acl.getAclString());
  acl.addGroup("tardis");
  groups=acl.getGroups();
  assertEquals(groups.size(),1);
  assertEquals(groups.iterator().next(),"tardis");
  assertEquals("drwho tardis",acl.getAclString());
  acl.addUser("joe");
  acl.addGroup("users");
  users=acl.getUsers();
  assertEquals(users.size(),2);
  Iterator<String> iter=users.iterator();
  assertEquals(iter.next(),"drwho");
  assertEquals(iter.next(),"joe");
  groups=acl.getGroups();
  assertEquals(groups.size(),2);
  iter=groups.iterator();
  assertEquals(iter.next(),"tardis");
  assertEquals(iter.next(),"users");
  assertEquals("drwho,joe tardis,users",acl.getAclString());
  acl.removeUser("joe");
  acl.removeGroup("users");
  users=acl.getUsers();
  assertEquals(users.size(),1);
  assertFalse(users.contains("joe"));
  groups=acl.getGroups();
  assertEquals(groups.size(),1);
  assertFalse(groups.contains("users"));
  assertEquals("drwho tardis",acl.getAclString());
  acl.removeGroup("tardis");
  groups=acl.getGroups();
  assertEquals(0,groups.size());
  assertFalse(groups.contains("tardis"));
  assertEquals("drwho ",acl.getAclString());
  acl.removeUser("drwho");
  assertEquals(0,users.size());
  assertFalse(users.contains("drwho"));
  assertEquals(0,acl.getGroups().size());
  assertEquals(0,acl.getUsers().size());
  assertEquals(" ",acl.getAclString());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testAclString(){
  AccessControlList acl;
  acl=new AccessControlList("*");
  assertTrue(acl.toString().equals("All users are allowed"));
  validateGetAclString(acl);
  acl=new AccessControlList(" ");
  assertTrue(acl.toString().equals("No users are allowed"));
  acl=new AccessControlList("user1,user2");
  assertTrue(acl.toString().equals("Users [user1, user2] are allowed"));
  validateGetAclString(acl);
  acl=new AccessControlList("user1,user2 ");
  assertTrue(acl.toString().equals("Users [user1, user2] are allowed"));
  validateGetAclString(acl);
  acl=new AccessControlList(" group1,group2");
  assertTrue(acl.toString().equals("Members of the groups [group1, group2] are allowed"));
  validateGetAclString(acl);
  acl=new AccessControlList("user1,user2 group1,group2");
  assertTrue(acl.toString().equals("Users [user1, user2] and " + "members of the groups [group1, group2] are allowed"));
  validateGetAclString(acl);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testWildCardAccessControlList() throws Exception {
  AccessControlList acl;
  acl=new AccessControlList("*");
  assertTrue(acl.isAllAllowed());
  acl=new AccessControlList("  * ");
  assertTrue(acl.isAllAllowed());
  acl=new AccessControlList(" *");
  assertTrue(acl.isAllAllowed());
  acl=new AccessControlList("*  ");
  assertTrue(acl.isAllAllowed());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Verify the method isUserAllowed()
 */
@Test public void testIsUserAllowed(){
  AccessControlList acl;
  UserGroupInformation drwho=UserGroupInformation.createUserForTesting("drwho@EXAMPLE.COM",new String[]{"aliens","humanoids","timelord"});
  UserGroupInformation susan=UserGroupInformation.createUserForTesting("susan@EXAMPLE.COM",new String[]{"aliens","humanoids","timelord"});
  UserGroupInformation barbara=UserGroupInformation.createUserForTesting("barbara@EXAMPLE.COM",new String[]{"humans","teachers"});
  UserGroupInformation ian=UserGroupInformation.createUserForTesting("ian@EXAMPLE.COM",new String[]{"humans","teachers"});
  acl=new AccessControlList("drwho humanoids");
  assertUserAllowed(drwho,acl);
  assertUserAllowed(susan,acl);
  assertUserNotAllowed(barbara,acl);
  assertUserNotAllowed(ian,acl);
  acl=new AccessControlList("drwho");
  assertUserAllowed(drwho,acl);
  assertUserNotAllowed(susan,acl);
  assertUserNotAllowed(barbara,acl);
  assertUserNotAllowed(ian,acl);
  acl=new AccessControlList("drwho ");
  assertUserAllowed(drwho,acl);
  assertUserNotAllowed(susan,acl);
  assertUserNotAllowed(barbara,acl);
  assertUserNotAllowed(ian,acl);
  acl=new AccessControlList(" humanoids");
  assertUserAllowed(drwho,acl);
  assertUserAllowed(susan,acl);
  assertUserNotAllowed(barbara,acl);
  assertUserNotAllowed(ian,acl);
  acl=new AccessControlList("drwho,ian aliens,teachers");
  assertUserAllowed(drwho,acl);
  assertUserAllowed(susan,acl);
  assertUserAllowed(barbara,acl);
  assertUserAllowed(ian,acl);
}

</code></pre>

<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Tests adding user/group to an wild card acl.
 */
@Test public void testAddRemoveToWildCardACL(){
  AccessControlList acl=new AccessControlList(" * ");
  assertTrue(acl.isAllAllowed());
  UserGroupInformation drwho=UserGroupInformation.createUserForTesting("drwho@EXAMPLE.COM",new String[]{"aliens"});
  UserGroupInformation drwho2=UserGroupInformation.createUserForTesting("drwho2@EXAMPLE.COM",new String[]{"tardis"});
  acl.addUser("drwho");
  assertTrue(acl.isAllAllowed());
  assertFalse(acl.getAclString().contains("drwho"));
  acl.addGroup("tardis");
  assertTrue(acl.isAllAllowed());
  assertFalse(acl.getAclString().contains("tardis"));
  acl.removeUser("drwho");
  assertTrue(acl.isAllAllowed());
  assertUserAllowed(drwho,acl);
  acl.removeGroup("tardis");
  assertTrue(acl.isAllAllowed());
  assertUserAllowed(drwho2,acl);
}

</code></pre>

<pre class="type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests adding/removing wild card as the user/group.
 */
@Test public void testAddRemoveWildCard(){
  AccessControlList acl=new AccessControlList("drwho tardis");
  Throwable th=null;
  try {
    acl.addUser(" * ");
  }
 catch (  Throwable t) {
    th=t;
  }
  assertNotNull(th);
  assertTrue(th instanceof IllegalArgumentException);
  th=null;
  try {
    acl.addGroup(" * ");
  }
 catch (  Throwable t) {
    th=t;
  }
  assertNotNull(th);
  assertTrue(th instanceof IllegalArgumentException);
  th=null;
  try {
    acl.removeUser(" * ");
  }
 catch (  Throwable t) {
    th=t;
  }
  assertNotNull(th);
  assertTrue(th instanceof IllegalArgumentException);
  th=null;
  try {
    acl.removeGroup(" * ");
  }
 catch (  Throwable t) {
    th=t;
  }
  assertNotNull(th);
  assertTrue(th instanceof IllegalArgumentException);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the netgroups (groups in ACL rules that start with @)
 * This is a  manual test because it requires:
 * - host setup
 * - native code compiled
 * - specify the group mapping class
 * Host setup:
 * /etc/nsswitch.conf should have a line like this:
 * netgroup: files
 * /etc/netgroup should be (the whole file):
 * lasVegas (,elvis,)
 * memphis (,elvis,) (,jerryLeeLewis,)
 * To run this test:
 * export JAVA_HOME='path/to/java'
 * ant \
 * -Dtestcase=TestAccessControlList \
 * -Dtest.output=yes \
 * -DTestAccessControlListGroupMapping=$className \
 * compile-native test
 * where $className is one of the classes that provide group
 * mapping services, i.e. classes that implement
 * GroupMappingServiceProvider interface, at this time:
 * - org.apache.hadoop.security.JniBasedUnixGroupsNetgroupMapping
 * - org.apache.hadoop.security.ShellBasedUnixGroupsNetgroupMapping
 */
@Test public void testNetgroups() throws Exception {
  if (!NativeCodeLoader.isNativeCodeLoaded()) {
    LOG.info("Not testing netgroups, " + "this test only runs when native code is compiled");
    return;
  }
  String groupMappingClassName=System.getProperty("TestAccessControlListGroupMapping");
  if (groupMappingClassName == null) {
    LOG.info("Not testing netgroups, no group mapping class specified, " + "use -DTestAccessControlListGroupMapping=$className to specify " + "group mapping class (must implement GroupMappingServiceProvider "+ "interface and support netgroups)");
    return;
  }
  LOG.info("Testing netgroups using: " + groupMappingClassName);
  Configuration conf=new Configuration();
  conf.set(CommonConfigurationKeysPublic.HADOOP_SECURITY_GROUP_MAPPING,groupMappingClassName);
  Groups groups=Groups.getUserToGroupsMappingService(conf);
  AccessControlList acl;
  acl=new AccessControlList("ja my");
  acl=new AccessControlList("sinatra ratpack,@lasVegas");
  acl=new AccessControlList(" somegroup,@someNetgroup");
  acl=new AccessControlList("carlPerkins ratpack,@lasVegas");
  acl.addGroup("@memphis");
  validateNetgroups(groups,acl);
  groups.refresh();
  validateNetgroups(groups,acl);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
