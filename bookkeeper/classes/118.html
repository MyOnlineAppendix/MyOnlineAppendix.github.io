<h3 style="margin:0px">Class: org.apache.hedwig.server.topics.TestMMTopicManager (9 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testGetOwnerSingle() throws Exception {
  tm.getOwner(topic,false,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
}

</code></pre>

<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testMaxNumTopics() throws Exception {
  conf.getConf().setProperty("max_num_topics","1");
  MMTopicManager tm1=new MMTopicManager(conf,zk,metadataManagerFactory,scheduler);
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
  tm1.getOwner(ByteString.copyFromUtf8("MaxNumTopic"),true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(2000L);
  assertOwnershipNodeDoesntExist();
  tm1.stop();
}

</code></pre>

<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testLoadBalancing() throws Exception {
  tm.getOwner(topic,false,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  ServerConfiguration conf1=new CustomServerConfiguration(conf.getServerPort() + 1);
  TopicManager tm1=new MMTopicManager(conf1,zk,metadataManagerFactory,scheduler);
  ByteString topic1=mkTopic(1);
  tm.getOwner(topic1,false,addrCbq,null);
  Assert.assertEquals(conf1.getServerAddr(),check(addrCbq.take()));
  tm1.stop();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Override @Before public void setUp() throws Exception {
  super.setUp();
  me=conf.getServerAddr();
  scheduler=Executors.newSingleThreadScheduledExecutor();
  tom=metadataManagerFactory.newTopicOwnershipManager();
  tm=new MMTopicManager(conf,zk,metadataManagerFactory,scheduler);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@Override @After public void tearDown() throws Exception {
  tom.close();
  tm.stop();
  super.tearDown();
}

</code></pre>

<pre class="type-11 type-6 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGetOwnerMulti() throws Exception {
  ServerConfiguration conf1=new CustomServerConfiguration(conf.getServerPort() + 1), conf2=new CustomServerConfiguration(conf.getServerPort() + 2);
  MMTopicManager tm1=new MMTopicManager(conf1,zk,metadataManagerFactory,scheduler), tm2=new MMTopicManager(conf2,zk,metadataManagerFactory,scheduler);
  tm.getOwner(topic,false,addrCbq,null);
  HedwigSocketAddress owner=check(addrCbq.take());
  for (int i=0; i < 100; ++i) {
    tm.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
    tm1.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
    tm2.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
  }
  for (int i=0; i < 100; ++i) {
    if (!owner.equals(me))     break;
    tm.getOwner(mkTopic(i),false,addrCbq,null);
    owner=check(addrCbq.take());
    if (i == 99)     Assert.fail("Never chose another owner");
  }
  tm1.stop();
  tm2.stop();
}

</code></pre>

<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testRetentionAfterAccess() throws Exception {
  conf.getConf().setProperty("retention_secs_after_access","5");
  MMTopicManager tm1=new MMTopicManager(conf,zk,metadataManagerFactory,scheduler);
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(6000L);
  tm1.topics.cleanUp();
  Thread.sleep(2000L);
  assertOwnershipNodeDoesntExist();
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(1000L);
  tm1.topics.cleanUp();
  Thread.sleep(2000L);
  assertOwnershipNodeExists();
  tm1.stop();
}

</code></pre>

<pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testOwnershipChange() throws Exception {
  SynchronousQueue<Pair<ByteString,Boolean>> bsQueue=new SynchronousQueue<Pair<ByteString,Boolean>>();
  StubOwnershipChangeListener listener=new StubOwnershipChangeListener(bsQueue);
  tm.addTopicOwnershipChangeListener(listener);
  tm.getOwner(topic,true,addrCbq,null);
  Pair<ByteString,Boolean> pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertTrue(pair.second());
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Assert.assertTrue(bsQueue.isEmpty());
  assertOwnershipNodeExists();
  tm.releaseTopic(topic,cb,null);
  pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertFalse(pair.second());
  Assert.assertTrue(queue.take());
  assertOwnershipNodeDoesntExist();
  tm.releaseTopic(mkTopic(0),cb,null);
  Assert.assertTrue(queue.take());
  Assert.assertTrue(bsQueue.isEmpty());
  listener.setFailure(true);
  tm.getOwner(topic,true,addrCbq,null);
  pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertTrue(pair.second());
  Assert.assertEquals(PubSubException.ServiceDownException.class,((CompositeException)addrCbq.take().right()).getExceptions().iterator().next().getClass());
  Assert.assertFalse(null != tm.topics.getIfPresent(topic));
  Thread.sleep(100);
  assertOwnershipNodeDoesntExist();
}

</code></pre>

<pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testZKClientDisconnected() throws Exception {
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  tm.isSuspended=true;
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(PubSubException.ServiceDownException.class,addrCbq.take().right().getClass());
  tm.releaseTopic(topic,cb,null);
  Assert.assertTrue(queue.take());
  assertOwnershipNodeDoesntExist();
  tm.isSuspended=false;
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
