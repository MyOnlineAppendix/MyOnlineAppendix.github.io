<h3><span class=" glyphicon glyphicon-tag"/>&nbspNullVerifier</h3><kbd>Verifies whether objects are null</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.BookieInitializationTest </h4><pre class="type-2 type-6 type-3 type-4 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the bookie reg. Restarting bookie server will wait for the session
 * timeout when previous reg node exists in zk. On zNode delete event,
 * should continue startup
 */
@Test(timeout=20000) public void testBookieRegistration() throws Exception {
  File tmpDir=createTempDir("bookie","test");
  final ServerConfiguration conf=TestBKConfiguration.newServerConfiguration().setZkServers(null).setJournalDirName(tmpDir.getPath()).setLedgerDirNames(new String[]{tmpDir.getPath()});
  final String bkRegPath=conf.getZkAvailableBookiesPath() + "/" + InetAddress.getLocalHost().getHostAddress()+ ":"+ conf.getBookiePort();
  MockBookie b=new MockBookie(conf);
  b.zk=zkc;
  b.testRegisterBookie(conf);
  Stat bkRegNode1=zkc.exists(bkRegPath,false);
  Assert.assertNotNull("Bookie registration node doesn't exists!",bkRegNode1);
  createNewZKClient();
  b.zk=newzk;
  new Thread(){
    @Override public void run(){
      try {
        Thread.sleep(conf.getZkTimeout() / 3);
        zkc.delete(bkRegPath,-1);
      }
 catch (      Exception e) {
        LOG.error("Failed to delete the znode :" + bkRegPath,e);
      }
    }
  }
.start();
  try {
    b.testRegisterBookie(conf);
  }
 catch (  IOException e) {
    Throwable t=e.getCause();
    if (t instanceof KeeperException) {
      KeeperException ke=(KeeperException)t;
      Assert.assertTrue("ErrorCode:" + ke.code() + ", Registration node exists",ke.code() != KeeperException.Code.NODEEXISTS);
    }
    throw e;
  }
  Stat bkRegNode2=newzk.exists(bkRegPath,false);
  Assert.assertNotNull("Bookie registration has been failed",bkRegNode2);
  Assert.assertTrue("Bookie is referring to old registration znode:" + bkRegNode1 + ", New ZNode:"+ bkRegNode2,bkRegNode1.getEphemeralOwner() != bkRegNode2.getEphemeralOwner());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=20000) public void testBookieRegistrationWithSameZooKeeperClient() throws Exception {
  File tmpDir=createTempDir("bookie","test");
  final ServerConfiguration conf=TestBKConfiguration.newServerConfiguration().setZkServers(null).setJournalDirName(tmpDir.getPath()).setLedgerDirNames(new String[]{tmpDir.getPath()});
  final String bkRegPath=conf.getZkAvailableBookiesPath() + "/" + InetAddress.getLocalHost().getHostAddress()+ ":"+ conf.getBookiePort();
  MockBookie b=new MockBookie(conf);
  b.zk=zkc;
  b.testRegisterBookie(conf);
  Assert.assertNotNull("Bookie registration node doesn't exists!",zkc.exists(bkRegPath,false));
  b.testRegisterBookie(conf);
  Assert.assertNotNull("Bookie registration node doesn't exists!",zkc.exists(bkRegPath,false));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-3 type-4 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the bookie registration, it should throw
 * KeeperException.NodeExistsException if the znode still exists even after
 * the zk session timeout.
 */
@Test(timeout=30000) public void testRegNodeExistsAfterSessionTimeOut() throws Exception {
  File tmpDir=createTempDir("bookie","test");
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration().setZkServers(null).setJournalDirName(tmpDir.getPath()).setLedgerDirNames(new String[]{tmpDir.getPath()});
  String bkRegPath=conf.getZkAvailableBookiesPath() + "/" + InetAddress.getLocalHost().getHostAddress()+ ":"+ conf.getBookiePort();
  MockBookie b=new MockBookie(conf);
  b.zk=zkc;
  b.testRegisterBookie(conf);
  Stat bkRegNode1=zkc.exists(bkRegPath,false);
  Assert.assertNotNull("Bookie registration node doesn't exists!",bkRegNode1);
  createNewZKClient();
  b.zk=newzk;
  try {
    b.testRegisterBookie(conf);
    fail("Should throw NodeExistsException as the znode is not getting expired");
  }
 catch (  IOException e) {
    Throwable t=e.getCause();
    if (t instanceof KeeperException) {
      KeeperException ke=(KeeperException)t;
      Assert.assertTrue("ErrorCode:" + ke.code() + ", Registration node doesn't exists",ke.code() == KeeperException.Code.NODEEXISTS);
      Stat bkRegNode2=newzk.exists(bkRegPath,false);
      Assert.assertNotNull("Bookie registration has been failed",bkRegNode2);
      Assert.assertTrue("Bookie wrongly registered. Old registration znode:" + bkRegNode1 + ", New znode:"+ bkRegNode2,bkRegNode1.getEphemeralOwner() == bkRegNode2.getEphemeralOwner());
      return;
    }
    throw e;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.EntryLogTest </h4><pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
"></span><br>
@Test(timeout=60000) public void testCorruptEntryLog() throws Exception {
  File tmpDir=createTempDir("bkTest",".dir");
  File curDir=Bookie.getCurrentDirectory(tmpDir);
  Bookie.checkDirectoryStructure(curDir);
  int gcWaitTime=1000;
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration();
  conf.setGcWaitTime(gcWaitTime);
  conf.setLedgerDirNames(new String[]{tmpDir.toString()});
  Bookie bookie=new Bookie(conf);
  EntryLogger logger=((InterleavedLedgerStorage)bookie.ledgerStorage).entryLogger;
  logger.addEntry(1,generateEntry(1,1));
  logger.addEntry(3,generateEntry(3,1));
  logger.addEntry(2,generateEntry(2,1));
  logger.flush();
  File f=new File(curDir,"0.log");
  RandomAccessFile raf=new RandomAccessFile(f,"rw");
  raf.setLength(raf.length() - 10);
  raf.close();
  logger=new EntryLogger(conf,bookie.getLedgerDirsManager());
  EntryLogMetadata meta=new EntryLogMetadata(0L);
  ExtractionScanner scanner=new ExtractionScanner(meta);
  logger.scanEntryLog(0L,scanner);
  LOG.info("Extracted Meta From Entry Log {}",meta);
  assertNotNull(meta.ledgersMap.get(1L));
  assertNull(meta.ledgersMap.get(2L));
  assertNotNull(meta.ledgersMap.get(3L));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.IndexCorruptionTest </h4><pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testEmptyIndexPage() throws Exception {
  LOG.debug("Testing EmptyIndexPage");
  SyncThread syncThread=bs.get(0).getBookie().syncThread;
  assertNotNull("Not found SyncThread.",syncThread);
  syncThread.suspendSync();
  LedgerHandle lh1=bkc.createLedger(1,1,digestType,"".getBytes());
  String dummyMsg="NoSuchLedger";
  int numMsgs=2 * pageSize / 8;
  LedgerHandle lh2=bkc.createLedger(1,1,digestType,"".getBytes());
  for (int i=0; i < numMsgs; i++) {
    lh2.addEntry(dummyMsg.getBytes());
  }
  syncThread.resumeSync();
  Thread.sleep(2 * baseConf.getFlushInterval());
  syncThread.suspendSync();
  LedgerHandle newLh1=bkc.openLedger(lh1.getId(),digestType,"".getBytes());
  for (int i=0; i < 3; i++) {
    lh2.addEntry(dummyMsg.getBytes());
  }
  syncThread.resumeSync();
  Thread.sleep(2 * baseConf.getFlushInterval());
  restartBookies();
  numMsgs+=3;
  Enumeration<LedgerEntry> seq=lh2.readEntries(0,numMsgs - 1);
  assertTrue("Enumeration of ledger entries has no element",seq.hasMoreElements() == true);
  int entryId=0;
  while (seq.hasMoreElements()) {
    LedgerEntry e=seq.nextElement();
    assertEquals(entryId,e.getEntryId());
    Assert.assertArrayEquals(dummyMsg.getBytes(),e.getEntry());
    ++entryId;
  }
  assertEquals(entryId,numMsgs);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.UpdateCookieCmdTest </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWhenNoCookieExists() throws Exception {
  ServerConfiguration conf=bsConfs.get(0);
  BookieServer bks=bs.get(0);
  bks.shutdown();
  String zkCookiePath=Cookie.getZkPath(conf);
  Assert.assertNotNull("Cookie path doesn't still exists!",zkc.exists(zkCookiePath,false));
  zkc.delete(zkCookiePath,-1);
  Assert.assertNull("Cookie path still exists!",zkc.exists(zkCookiePath,false));
  BookieShell bkShell=new BookieShell();
  conf.setUseHostNameAsBookieID(true);
  bkShell.setConf(conf);
  String[] argv=new String[]{"updatecookie","-b","hostname"};
  Assert.assertEquals("Failed to return the error code!",-1,bkShell.run(argv));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestLedgerChecker </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should give two fragments when 2 bookies failed
 * in same ensemble when ensemble = 3, quorum = 2
 */
@Test(timeout=60000) public void testShouldGetTwoFrgamentsIfTwoBookiesFailedInSameEnsemble() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  startNewBookie();
  startNewBookie();
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress firstBookieFromEnsemble=firstEnsemble.get(0);
  killBookie(firstEnsemble,firstBookieFromEnsemble);
  BookieSocketAddress secondBookieFromEnsemble=firstEnsemble.get(1);
  killBookie(firstEnsemble,secondBookieFromEnsemble);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("There should be 2 fragments",2,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should one fragment as underReplicated
 * if there is an open ledger with single entry written.
 */
@Test(timeout=60000) public void testShouldGetOneFragmentWithSingleEntryOpenedLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,3,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(0);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 1 fragment. But returned fragments are " + result,1,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should get failed ensemble number of fragments
 * if ensemble bookie failures on next entry
 */
@Test(timeout=60000) public void testShouldGetFailedEnsembleNumberOfFgmntsIfEnsembleBookiesFailedOnNextWrite() throws Exception {
  startNewBookie();
  startNewBookie();
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  for (int i=0; i < 3; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  for (  BookieSocketAddress bkAddr : firstEnsemble) {
    killBookie(firstEnsemble,bkAddr);
  }
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("There should be 3 fragments",3,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker does not return any fragments
 * from a closed ledger with 0 entries.
 */
@Test(timeout=60000) public void testClosedSingleEntryLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  lh.close();
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(2);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragment. But returned fragments are " + result,0,result.size());
  lh1.close();
  lastBookieFromEnsemble=firstEnsemble.get(1);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 1 fragment. But returned fragments are " + result,1,result.size());
  lh1.close();
  lastBookieFromEnsemble=firstEnsemble.get(0);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 2 fragment. But returned fragments are " + result,2,result.size());
  lh1.close();
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker does not return any fragments
 * from a closed ledger with 0 entries.
 */
@Test(timeout=60000) public void testClosedEmptyLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,3,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  lh.close();
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(0);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragment. But returned fragments are " + result,0,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker correctly identifies missing fragments
 * when a single entry is written after an ensemble change.
 * This is important, as the last add confirmed may be less than the
 * first entry id of the final segment.
 */
@Test(timeout=60000) public void testSingleEntryAfterEnsembleChange() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,3,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  for (int i=0; i < 10; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(lh.getDistributionSchedule().getWriteSet(lh.getLastAddPushed()).get(0));
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  lastBookieFromEnsemble=firstEnsemble.get(lh.getDistributionSchedule().getWriteSet(lh.getLastAddPushed()).get(1));
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 3 fragment. But returned fragments are " + result,3,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should get all fragments if ledger is empty
 * but all bookies in the ensemble are down.
 * In this case, there's no way to tell whether data was written or not.
 * In this case, there'll only be two fragments, as quorum is 2 and we only
 * suspect that the first entry of the ledger could exist.
 */
@Test(timeout=60000) public void testShouldGet2FragmentsWithEmptyLedgerButBookiesDead() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  for (  BookieSocketAddress b : lh.getLedgerMetadata().getEnsembles().get(0L)) {
    killBookie(b);
  }
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 2 fragments.",2,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that the LedgerChecker should detect the underReplicated fragments
 * on multiple Bookie crashes
 */
@Test(timeout=60000) public void testChecker() throws Exception {
  LedgerHandle lh=bkc.createLedger(BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  startNewBookie();
  for (int i=0; i < 10; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  BookieSocketAddress replicaToKill=lh.getLedgerMetadata().getEnsembles().get(0L).get(0);
  LOG.info("Killing {}",replicaToKill);
  killBookie(replicaToKill);
  for (int i=0; i < 10; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("Should have one missing fragment",1,result.size());
  assertEquals("Fragment should be missing from first replica",result.iterator().next().getAddress(),replicaToKill);
  BookieSocketAddress replicaToKill2=lh.getLedgerMetadata().getEnsembles().get(0L).get(1);
  LOG.info("Killing {}",replicaToKill2);
  killBookie(replicaToKill2);
  result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("Should have three missing fragments",3,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that ledger checker should pick the fragment as bad only if any of
 * the fragment entries not meeting the quorum.
 */
@Test(timeout=60000) public void testShouldNotGetTheFragmentIfThereIsNoMissedEntry() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(2);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  LOG.info("Ensembles after first entry :" + lh.getLedgerMetadata().getEnsembles());
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  LOG.info("Ensembles after second entry :" + lh.getLedgerMetadata().getEnsembles());
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("Should not have any missing fragment",0,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should not get any underReplicated fragments, if
 * corresponding ledger does not exists.
 */
@Test(timeout=60000) public void testShouldNotGetAnyFragmentIfNoLedgerPresent() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress firstBookieFromEnsemble=firstEnsemble.get(0);
  killBookie(firstBookieFromEnsemble);
  startNewBookie();
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  bkc.deleteLedger(lh.getId());
  LOG.info("Waiting to see ledger id {} deletion",lh.getId());
  int retries=40;
  boolean noSuchLedger=false;
  while (retries > 0) {
    try {
      lh.readEntries(0,0);
    }
 catch (    BKException.BKNoSuchLedgerExistsException bkn) {
      noSuchLedger=true;
      break;
    }
    retries--;
    Thread.sleep(500);
  }
  assertEquals("Ledger exists",true,noSuchLedger);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragments. But returned fragments are " + result,0,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should not get any fragments as underReplicated
 * if Ledger itself is empty
 */
@Test(timeout=60000) public void testShouldNotGetAnyFragmentWithEmptyLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragments. But returned fragments are " + result,0,result.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestSpeculativeRead </h4><pre class="type-2 type-6 type-3 type-4 type-7 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Unit test for the speculative read scheduling method
 */
@Test(timeout=60000) public void testSpeculativeReadScheduling() throws Exception {
  long id=getLedgerToRead(3,2);
  int timeout=1000;
  BookKeeper bkspec=createClient(timeout);
  LedgerHandle l=bkspec.openLedger(id,digestType,passwd);
  ArrayList<BookieSocketAddress> ensemble=l.getLedgerMetadata().getEnsembles().get(0L);
  Set<BookieSocketAddress> allHosts=new HashSet<BookieSocketAddress>(ensemble);
  Set<BookieSocketAddress> noHost=new HashSet<BookieSocketAddress>();
  Set<BookieSocketAddress> secondHostOnly=new HashSet<BookieSocketAddress>();
  secondHostOnly.add(ensemble.get(1));
  PendingReadOp.LedgerEntryRequest req0=null, req2=null, req4=null;
  try {
    LatchCallback latch0=new LatchCallback();
    PendingReadOp op=new PendingReadOp(l,bkspec.scheduler,0,5,latch0,null);
    req0=op.new LedgerEntryRequest(ensemble,l.getId(),0);
    assertTrue("Should have sent to first",req0.maybeSendSpeculativeRead(allHosts).equals(ensemble.get(0)));
    assertNull("Should not have sent another",req0.maybeSendSpeculativeRead(allHosts));
    req2=op.new LedgerEntryRequest(ensemble,l.getId(),2);
    assertTrue("Should have sent to third",req2.maybeSendSpeculativeRead(noHost).equals(ensemble.get(2)));
    assertTrue("Should have sent to first",req2.maybeSendSpeculativeRead(secondHostOnly).equals(ensemble.get(0)));
    req4=op.new LedgerEntryRequest(ensemble,l.getId(),4);
    assertTrue("Should have sent to second",req4.maybeSendSpeculativeRead(noHost).equals(ensemble.get(1)));
    assertNull("Should not have sent another",req4.maybeSendSpeculativeRead(secondHostOnly));
  }
  finally {
    for (    PendingReadOp.LedgerEntryRequest req : new PendingReadOp.LedgerEntryRequest[]{req0,req2,req4}) {
      if (req != null) {
        int i=0;
        while (!req.isComplete()) {
          if (i++ > 10) {
            break;
          }
          Thread.sleep(1000);
        }
        assertTrue("Request should be done",req0.isComplete());
      }
    }
    l.close();
    bkspec.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.UpdateLedgerOpTest </h4><pre class="type-2 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests verifies the ensemble reformation after updating the bookie id in
 * the existing ensemble
 */
@Test(timeout=120000) public void testChangeEnsembleAfterRenaming() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  BookKeeperAdmin bkadmin=new BookKeeperAdmin(bk);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh=createLedgerWithEntries(bk,100);
  BookieServer bookieServer=bs.get(0);
  ArrayList<BookieSocketAddress> ensemble=lh.getLedgerMetadata().getEnsemble(0);
  BookieSocketAddress curBookieAddr=null;
  for (  BookieSocketAddress bookieSocketAddress : ensemble) {
    if (bookieServer.getLocalAddress().equals(bookieSocketAddress)) {
      curBookieAddr=bookieSocketAddress;
    }
  }
  Assert.assertNotNull("Couldn't find the bookie in ledger metadata!",curBookieAddr);
  baseConf.setUseHostNameAsBookieID(true);
  BookieSocketAddress toBookieId=Bookie.getBookieAddress(baseConf);
  BookieSocketAddress toBookieAddr=new BookieSocketAddress(toBookieId.getHostname() + ":" + curBookieAddr.getPort());
  UpdateLedgerOp updateLedgerOp=new UpdateLedgerOp(bk,bkadmin);
  updateLedgerOp.updateBookieIdInLedgers(curBookieAddr,toBookieAddr,5,100,progressable);
  bookieServer.shutdown();
  ServerConfiguration serverConf1=newServerConfiguration();
  bsConfs.add(serverConf1);
  bs.add(startBookie(serverConf1));
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicInteger rc=new AtomicInteger(BKException.Code.OK);
  lh.asyncAddEntry("foobar".getBytes(),new AddCallback(){
    @Override public void addComplete(    int rccb,    LedgerHandle lh,    long entryId,    Object ctx){
      rc.compareAndSet(BKException.Code.OK,rccb);
      latch.countDown();
    }
  }
,null);
  if (!latch.await(30,TimeUnit.SECONDS)) {
    throw new Exception("Entries took too long to add");
  }
  if (rc.get() != BKException.Code.OK) {
    throw BKException.create(rc.get());
  }
  lh.close();
  LedgerHandle openLedger=bk.openLedger(lh.getId(),digestType,PASSWORD.getBytes());
  final LedgerMetadata ledgerMetadata=openLedger.getLedgerMetadata();
  Assert.assertEquals("Failed to reform ensemble!",2,ledgerMetadata.getEnsembles().size());
  ensemble=ledgerMetadata.getEnsemble(0);
  Assert.assertTrue("Failed to update the ledger metadata to use bookie host name",ensemble.contains(toBookieAddr));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.GcLedgersTest </h4><pre class="type-2 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGcLedgersOutsideRange() throws Exception {
  final SortedSet<Long> createdLedgers=Collections.synchronizedSortedSet(new TreeSet<Long>());
  final Queue<Long> cleaned=new LinkedList<Long>();
  int numLedgers=100;
  createLedgers(numLedgers,createdLedgers);
  final GarbageCollector garbageCollector=new ScanAndCompareGarbageCollector(getLedgerManager(),activeLedgers);
  GarbageCollector.GarbageCleaner cleaner=new GarbageCollector.GarbageCleaner(){
    @Override public void clean(    long ledgerId){
      LOG.info("Cleaned {}",ledgerId);
      cleaned.add(ledgerId);
    }
  }
;
  garbageCollector.gc(cleaner);
  assertNull("Should have cleaned nothing",cleaned.poll());
  long last=createdLedgers.last();
  removeLedger(last);
  garbageCollector.gc(cleaner);
  assertNotNull("Should have cleaned something",cleaned.peek());
  assertEquals("Should have cleaned last ledger" + last,(long)last,(long)cleaned.poll());
  long first=createdLedgers.first();
  removeLedger(first);
  garbageCollector.gc(cleaner);
  assertNotNull("Should have cleaned something",cleaned.peek());
  assertEquals("Should have cleaned first ledger" + first,(long)first,(long)cleaned.poll());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.LedgerLayoutTest </h4><pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testReadV1LedgerManagerLayout() throws Exception {
  ClientConfiguration conf=new ClientConfiguration();
  writeLedgerLayout(conf.getZkLedgersRootPath(),FlatLedgerManagerFactory.NAME,FlatLedgerManagerFactory.CUR_VERSION,1);
  LedgerLayout layout=LedgerLayout.readLayout(zkc,conf.getZkLedgersRootPath());
  assertNotNull("Should not be null",layout);
  assertEquals(FlatLedgerManagerFactory.NAME,layout.getManagerFactoryClass());
  assertEquals(FlatLedgerManagerFactory.CUR_VERSION,layout.getManagerVersion());
  assertEquals(1,layout.getLayoutFormatVersion());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.LedgerManagerIteratorTest </h4><pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testIterateNoLedgers() throws Exception {
  LedgerManager lm=getLedgerManager();
  LedgerRangeIterator lri=lm.getLedgerRanges();
  assertNotNull(lri);
  if (lri.hasNext())   lri.next();
  assertEquals(false,lri.hasNext());
  assertEquals(false,lri.hasNext());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.TestZkLedgerIdGenerator </h4><pre class="type-2 type-11 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGenerateLedgerId() throws Exception {
  final int nThread=2;
  final int nLedgers=2000;
  final CountDownLatch countDownLatch=new CountDownLatch(nThread * nLedgers);
  final AtomicInteger errCount=new AtomicInteger(0);
  final ConcurrentLinkedQueue<Long> ledgerIds=new ConcurrentLinkedQueue<Long>();
  final GenericCallback<Long> cb=new GenericCallback<Long>(){
    @Override public void operationComplete(    int rc,    Long result){
      if (Code.OK.intValue() == rc) {
        ledgerIds.add(result);
      }
 else {
        errCount.incrementAndGet();
      }
      countDownLatch.countDown();
    }
  }
;
  long start=System.currentTimeMillis();
  for (int i=0; i < nThread; i++) {
    new Thread(){
      @Override public void run(){
        for (int j=0; j < nLedgers; j++) {
          ledgerIdGenerator.generateLedgerId(cb);
        }
      }
    }
.start();
  }
  assertTrue("Wait ledger id generation threads to stop timeout : ",countDownLatch.await(30,TimeUnit.SECONDS));
  LOG.info("Number of generated ledger id: {}, time used: {}",ledgerIds.size(),System.currentTimeMillis() - start);
  assertEquals("Error occur during ledger id generation : ",0,errCount.get());
  Set<Long> ledgers=new HashSet<Long>();
  while (!ledgerIds.isEmpty()) {
    Long ledger=ledgerIds.poll();
    assertNotNull("Generated ledger id is null : ",ledger);
    assertFalse("Ledger id [" + ledger + "] conflict : ",ledgers.contains(ledger));
    ledgers.add(ledger);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.metastore.TestMetaStore </h4><pre class="type-2 type-8 type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test usage of get operation on (full and partial) fields.
 */
@Test(timeout=60000) public void testGet() throws Exception {
  Versioned<Value> vv;
  final Set<String> fields=new HashSet<String>(Arrays.asList(new String[]{FIELD_NAME}));
  final String name="get";
  final Integer counter=getRandom();
  Version version=myTable.put(RECORDID,makeValue(name,counter),Version.NEW);
  assertNotNull(version);
  vv=getExistRecordFields(RECORDID,ALL_FIELDS);
  checkExpectedValue(vv,name,counter,version);
  vv=getExistRecordFields(RECORDID,fields);
  checkExpectedValue(vv,name,null,version);
  vv=getExistRecordFields(RECORDID,NON_FIELDS);
  checkExpectedValue(vv,null,null,version);
  try {
    getExistRecordFields(null,NON_FIELDS);
    fail("Should fail to get null key with NON fields");
  }
 catch (  MSException.IllegalOpException ioe) {
  }
  try {
    getExistRecordFields(null,ALL_FIELDS);
    fail("Should fail to get null key with ALL fields.");
  }
 catch (  MSException.IllegalOpException ioe) {
  }
  try {
    getExistRecordFields(null,fields);
    fail("Should fail to get null key with fields " + fields);
  }
 catch (  MSException.IllegalOpException ioe) {
  }
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * Test usage of put operation with (full and partial) fields.
 */
@Test(timeout=60000) public void testPut() throws Exception {
  final Integer counter=getRandom();
  final String name="put";
  Version version;
  version=myTable.put(RECORDID,makeValue(name,counter),Version.NEW);
  assertNotNull(version);
  Record expected=new Record(name,counter,version);
  putAndCheck(RECORDID,"name1",null,expected.getVersion(),expected,Code.OK);
  putAndCheck(RECORDID,null,counter + 1,expected.getVersion(),expected,Code.OK);
  putAndCheck(RECORDID,"name2",counter + 2,expected.getVersion(),expected,Code.OK);
  checkPartialPut("put exist entry with Version.ANY",Version.ANY,expected,Code.OK);
  badVersionedPut(Version.NEW,Code.KeyExists);
  badVersionedPut(newBadVersion(),Code.BadVersion);
  myTable.remove(RECORDID,Version.ANY);
  badVersionedPut(newBadVersion(),Code.NoKey);
  badVersionedPut(Version.ANY,Code.NoKey);
  illegalPut(null,Version.NEW);
  illegalPut(makeValue("illegal value",getRandom()),null);
  illegalPut(null,null);
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test usage of (unconditional remove, BadVersion remove, CorrectVersion
 * remove) operation.
 */
@Test(timeout=60000) public void testRemove() throws Exception {
  final Integer counter=getRandom();
  final String name="remove";
  Version version;
  version=myTable.put(RECORDID,makeValue(name,counter),Version.NEW);
  assertNotNull(version);
  myTable.remove(RECORDID,Version.ANY);
  version=myTable.put(RECORDID,makeValue(name,counter),Version.NEW);
  assertNotNull(version);
  try {
    myTable.remove(RECORDID,Version.NEW);
    fail("Should fail to remove a given key with bad version");
  }
 catch (  MSException.BadVersionException bve) {
  }
  try {
    myTable.remove(RECORDID,newBadVersion());
    fail("Should fail to remove a given key with bad version");
  }
 catch (  MSException.BadVersionException bve) {
  }
  myTable.remove(RECORDID,version);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.proto.TestDeathwatcher </h4><pre class="type-2 type-3 type-4 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure that if the autorecovery daemon is running inside the bookie
 * then a failure/crash in the autorecovery daemon will not take down the
 * bookie also.
 */
@Test(timeout=30000) public void testAutorecoveryFailureDoesntKillBookie() throws Exception {
  ServerConfiguration conf=newServerConfiguration().setAutoRecoveryDaemonEnabled(true);
  BookieServer bs=startBookie(conf);
  assertNotNull("Autorecovery daemon should exist",bs.autoRecoveryMain);
  assertTrue("Bookie should be running",bs.isBookieRunning());
  bs.autoRecoveryMain.shutdown();
  Thread.sleep(conf.getDeathWatchInterval() * 2);
  assertTrue("Bookie should be running",bs.isBookieRunning());
  bs.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.BookieAutoRecoveryTest </h4><pre class="type-2 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
/** 
 * Verify the published urledgers of deleted ledgers(those ledgers where
 * deleted after publishing as urledgers by Auditor) should be cleared off
 * by the newly selected replica bookie
 */
@Test(timeout=30000) public void testNoSuchLedgerExists() throws Exception {
  List<LedgerHandle> listOfLedgerHandle=createLedgersAndAddEntries(2,5);
  CountDownLatch latch=new CountDownLatch(listOfLedgerHandle.size());
  for (  LedgerHandle lh : listOfLedgerHandle) {
    assertNull("UrLedger already exists!",watchUrLedgerNode(getUrLedgerZNode(lh),latch));
  }
  BookieSocketAddress replicaToKillAddr=LedgerHandleAdapter.getLedgerMetadata(listOfLedgerHandle.get(0)).getEnsembles().get(0L).get(0);
  killBookie(replicaToKillAddr);
  replicaToKillAddr=LedgerHandleAdapter.getLedgerMetadata(listOfLedgerHandle.get(0)).getEnsembles().get(0L).get(0);
  killBookie(replicaToKillAddr);
  latch.await();
  latch=new CountDownLatch(listOfLedgerHandle.size());
  for (  LedgerHandle lh : listOfLedgerHandle) {
    assertNotNull("UrLedger doesn't exists!",watchUrLedgerNode(getUrLedgerZNode(lh),latch));
  }
  for (  LedgerHandle lh : listOfLedgerHandle) {
    bkc.deleteLedger(lh.getId());
  }
  startNewBookie();
  latch.await();
  for (  LedgerHandle lh : listOfLedgerHandle) {
    assertNull("UrLedger still exists after rereplication",watchUrLedgerNode(getUrLedgerZNode(lh),latch));
  }
}

</code></pre>

<br>
<pre class="type-2 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
/** 
 * Test verifies bookie recovery, the host (recorded via ipaddress in
 * ledgermetadata)
 */
@Test(timeout=90000) public void testLedgerMetadataContainsIpAddressAsBookieID() throws Exception {
  stopBKCluster();
  bkc=new BookKeeperTestClient(baseClientConf);
  ServerConfiguration serverConf1=newServerConfiguration();
  ServerConfiguration serverConf2=newServerConfiguration();
  serverConf2.setUseHostNameAsBookieID(true);
  ServerConfiguration serverConf3=newServerConfiguration();
  serverConf3.setUseHostNameAsBookieID(true);
  bsConfs.add(serverConf1);
  bsConfs.add(serverConf2);
  bsConfs.add(serverConf3);
  bs.add(startBookie(serverConf1));
  bs.add(startBookie(serverConf2));
  bs.add(startBookie(serverConf3));
  List<LedgerHandle> listOfLedgerHandle=createLedgersAndAddEntries(1,5);
  LedgerHandle lh=listOfLedgerHandle.get(0);
  int ledgerReplicaIndex=0;
  final SortedMap<Long,ArrayList<BookieSocketAddress>> ensembles=LedgerHandleAdapter.getLedgerMetadata(lh).getEnsembles();
  final ArrayList<BookieSocketAddress> bkAddresses=ensembles.get(0L);
  BookieSocketAddress replicaToKillAddr=bkAddresses.get(0);
  for (  BookieSocketAddress bookieSocketAddress : bkAddresses) {
    if (!isCreatedFromIp(bookieSocketAddress)) {
      replicaToKillAddr=bookieSocketAddress;
      LOG.info("Kill bookie which has registered using hostname");
      break;
    }
  }
  final String urLedgerZNode=getUrLedgerZNode(lh);
  ledgerReplicaIndex=getReplicaIndexInLedger(lh,replicaToKillAddr);
  CountDownLatch latch=new CountDownLatch(1);
  assertNull("UrLedger already exists!",watchUrLedgerNode(urLedgerZNode,latch));
  LOG.info("Killing Bookie :" + replicaToKillAddr);
  killBookie(replicaToKillAddr);
  latch.await();
  latch=new CountDownLatch(1);
  LOG.info("Watching on urLedgerPath:" + urLedgerZNode + " to know the status of rereplication process");
  assertNotNull("UrLedger doesn't exists!",watchUrLedgerNode(urLedgerZNode,latch));
  ServerConfiguration serverConf=newServerConfiguration();
  serverConf.setUseHostNameAsBookieID(false);
  bsConfs.add(serverConf);
  bs.add(startBookie(serverConf));
  int newBookieIndex=bs.size() - 1;
  BookieServer newBookieServer=bs.get(newBookieIndex);
  LOG.debug("Waiting to finish the replication of failed bookie : " + replicaToKillAddr);
  latch.await();
  LOG.info("Waiting to update the urledger metadata in zookeeper");
  verifyLedgerEnsembleMetadataAfterReplication(newBookieServer,listOfLedgerHandle.get(0),ledgerReplicaIndex);
}

</code></pre>

<br>
<pre class="type-2 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
/** 
 * Test verifies publish urLedger by Auditor and replication worker is
 * picking up the entries and finishing the rereplication of open ledger
 */
@Test(timeout=90000) public void testOpenLedgers() throws Exception {
  List<LedgerHandle> listOfLedgerHandle=createLedgersAndAddEntries(1,5);
  LedgerHandle lh=listOfLedgerHandle.get(0);
  int ledgerReplicaIndex=0;
  BookieSocketAddress replicaToKillAddr=LedgerHandleAdapter.getLedgerMetadata(lh).getEnsembles().get(0L).get(0);
  final String urLedgerZNode=getUrLedgerZNode(lh);
  ledgerReplicaIndex=getReplicaIndexInLedger(lh,replicaToKillAddr);
  CountDownLatch latch=new CountDownLatch(1);
  assertNull("UrLedger already exists!",watchUrLedgerNode(urLedgerZNode,latch));
  LOG.info("Killing Bookie :" + replicaToKillAddr);
  killBookie(replicaToKillAddr);
  latch.await();
  latch=new CountDownLatch(1);
  LOG.info("Watching on urLedgerPath:" + urLedgerZNode + " to know the status of rereplication process");
  assertNotNull("UrLedger doesn't exists!",watchUrLedgerNode(urLedgerZNode,latch));
  startNewBookie();
  int newBookieIndex=bs.size() - 1;
  BookieServer newBookieServer=bs.get(newBookieIndex);
  LOG.debug("Waiting to finish the replication of failed bookie : " + replicaToKillAddr);
  latch.await();
  LOG.info("Waiting to update the urledger metadata in zookeeper");
  verifyLedgerEnsembleMetadataAfterReplication(newBookieServer,listOfLedgerHandle.get(0),ledgerReplicaIndex);
}

</code></pre>

<br>
<pre class="type-2 type-11 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies whether objects are null
"></span><br>
/** 
 * Test stopping replica service while replication in progress. Considering
 * when there is an exception will shutdown Auditor and RW processes. After
 * restarting should be able to finish the re-replication activities
 */
@Test(timeout=90000) public void testStopWhileReplicationInProgress() throws Exception {
  int numberOfLedgers=2;
  List<Integer> listOfReplicaIndex=new ArrayList<Integer>();
  List<LedgerHandle> listOfLedgerHandle=createLedgersAndAddEntries(numberOfLedgers,5);
  closeLedgers(listOfLedgerHandle);
  LedgerHandle handle=listOfLedgerHandle.get(0);
  BookieSocketAddress replicaToKillAddr=LedgerHandleAdapter.getLedgerMetadata(handle).getEnsembles().get(0L).get(0);
  LOG.info("Killing Bookie:" + replicaToKillAddr);
  CountDownLatch latch=new CountDownLatch(listOfLedgerHandle.size());
  for (int i=0; i < listOfLedgerHandle.size(); i++) {
    final String urLedgerZNode=getUrLedgerZNode(listOfLedgerHandle.get(i));
    assertNull("UrLedger already exists!",watchUrLedgerNode(urLedgerZNode,latch));
    int replicaIndexInLedger=getReplicaIndexInLedger(listOfLedgerHandle.get(i),replicaToKillAddr);
    listOfReplicaIndex.add(replicaIndexInLedger);
  }
  LOG.info("Killing Bookie :" + replicaToKillAddr);
  killBookie(replicaToKillAddr);
  latch.await();
  latch=new CountDownLatch(listOfLedgerHandle.size());
  for (  LedgerHandle lh : listOfLedgerHandle) {
    String urLedgerZNode=getUrLedgerZNode(lh);
    LOG.info("Watching on urLedgerPath:" + urLedgerZNode + " to know the status of rereplication process");
    assertNotNull("UrLedger doesn't exists!",watchUrLedgerNode(urLedgerZNode,latch));
  }
  startNewBookie();
  int newBookieIndex=bs.size() - 1;
  BookieServer newBookieServer=bs.get(newBookieIndex);
  LOG.debug("Waiting to finish the replication of failed bookie : " + replicaToKillAddr);
  while (true) {
    if (latch.getCount() < numberOfLedgers || latch.getCount() <= 0) {
      stopReplicationService();
      LOG.info("Latch Count is:" + latch.getCount());
      break;
    }
    Thread.sleep(1000);
  }
  startReplicationService();
  LOG.info("Waiting to finish rereplication processes");
  latch.await();
  LOG.info("Waiting to update the urledger metadata in zookeeper");
  for (int index=0; index < listOfLedgerHandle.size(); index++) {
    verifyLedgerEnsembleMetadataAfterReplication(newBookieServer,listOfLedgerHandle.get(index),listOfReplicaIndex.get(index));
  }
}

</code></pre>

<br>
<pre class="type-2 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
/** 
 * Test verifies bookie recovery, the host (recorded via useHostName in
 * ledgermetadata)
 */
@Test(timeout=90000) public void testLedgerMetadataContainsHostNameAsBookieID() throws Exception {
  stopBKCluster();
  bkc=new BookKeeperTestClient(baseClientConf);
  ServerConfiguration serverConf1=newServerConfiguration();
  ServerConfiguration serverConf2=newServerConfiguration();
  serverConf2.setUseHostNameAsBookieID(true);
  ServerConfiguration serverConf3=newServerConfiguration();
  serverConf3.setUseHostNameAsBookieID(true);
  bsConfs.add(serverConf1);
  bsConfs.add(serverConf2);
  bsConfs.add(serverConf3);
  bs.add(startBookie(serverConf1));
  bs.add(startBookie(serverConf2));
  bs.add(startBookie(serverConf3));
  List<LedgerHandle> listOfLedgerHandle=createLedgersAndAddEntries(1,5);
  LedgerHandle lh=listOfLedgerHandle.get(0);
  int ledgerReplicaIndex=0;
  final SortedMap<Long,ArrayList<BookieSocketAddress>> ensembles=LedgerHandleAdapter.getLedgerMetadata(lh).getEnsembles();
  final ArrayList<BookieSocketAddress> bkAddresses=ensembles.get(0L);
  BookieSocketAddress replicaToKillAddr=bkAddresses.get(0);
  for (  BookieSocketAddress bookieSocketAddress : bkAddresses) {
    if (isCreatedFromIp(bookieSocketAddress)) {
      replicaToKillAddr=bookieSocketAddress;
      LOG.info("Kill bookie which has registered using ipaddress");
      break;
    }
  }
  final String urLedgerZNode=getUrLedgerZNode(lh);
  ledgerReplicaIndex=getReplicaIndexInLedger(lh,replicaToKillAddr);
  CountDownLatch latch=new CountDownLatch(1);
  assertNull("UrLedger already exists!",watchUrLedgerNode(urLedgerZNode,latch));
  LOG.info("Killing Bookie :" + replicaToKillAddr);
  killBookie(replicaToKillAddr);
  latch.await();
  latch=new CountDownLatch(1);
  LOG.info("Watching on urLedgerPath:" + urLedgerZNode + " to know the status of rereplication process");
  assertNotNull("UrLedger doesn't exists!",watchUrLedgerNode(urLedgerZNode,latch));
  bkc=new BookKeeperTestClient(baseClientConf);
  ServerConfiguration serverConf=newServerConfiguration();
  serverConf.setUseHostNameAsBookieID(true);
  bsConfs.add(serverConf);
  bs.add(startBookie(serverConf));
  int newBookieIndex=bs.size() - 1;
  BookieServer newBookieServer=bs.get(newBookieIndex);
  LOG.debug("Waiting to finish the replication of failed bookie : " + replicaToKillAddr);
  latch.await();
  LOG.info("Waiting to update the urledger metadata in zookeeper");
  verifyLedgerEnsembleMetadataAfterReplication(newBookieServer,listOfLedgerHandle.get(0),ledgerReplicaIndex);
}

</code></pre>

<br>
<pre class="type-2 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
/** 
 * Test verifies publish urLedger by Auditor and replication worker is
 * picking up the entries and finishing the rereplication of closed ledgers
 */
@Test(timeout=90000) public void testClosedLedgers() throws Exception {
  List<Integer> listOfReplicaIndex=new ArrayList<Integer>();
  List<LedgerHandle> listOfLedgerHandle=createLedgersAndAddEntries(1,5);
  closeLedgers(listOfLedgerHandle);
  LedgerHandle lhandle=listOfLedgerHandle.get(0);
  int ledgerReplicaIndex=0;
  BookieSocketAddress replicaToKillAddr=LedgerHandleAdapter.getLedgerMetadata(lhandle).getEnsembles().get(0L).get(0);
  CountDownLatch latch=new CountDownLatch(listOfLedgerHandle.size());
  for (  LedgerHandle lh : listOfLedgerHandle) {
    ledgerReplicaIndex=getReplicaIndexInLedger(lh,replicaToKillAddr);
    listOfReplicaIndex.add(ledgerReplicaIndex);
    assertNull("UrLedger already exists!",watchUrLedgerNode(getUrLedgerZNode(lh),latch));
  }
  LOG.info("Killing Bookie :" + replicaToKillAddr);
  killBookie(replicaToKillAddr);
  latch.await();
  latch=new CountDownLatch(listOfLedgerHandle.size());
  for (  LedgerHandle lh : listOfLedgerHandle) {
    String urLedgerZNode=getUrLedgerZNode(lh);
    LOG.info("Watching on urLedgerPath:" + urLedgerZNode + " to know the status of rereplication process");
    assertNotNull("UrLedger doesn't exists!",watchUrLedgerNode(urLedgerZNode,latch));
  }
  startNewBookie();
  int newBookieIndex=bs.size() - 1;
  BookieServer newBookieServer=bs.get(newBookieIndex);
  LOG.debug("Waiting to finish the replication of failed bookie : " + replicaToKillAddr);
  latch.await();
  LOG.info("Waiting to update the urledger metadata in zookeeper");
  for (int index=0; index < listOfLedgerHandle.size(); index++) {
    verifyLedgerEnsembleMetadataAfterReplication(newBookieServer,listOfLedgerHandle.get(index),listOfReplicaIndex.get(index));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.BookieReadWriteTest </h4><pre class="type-2 type-11 type-8 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that the add api with offset and length work correctly.
 * First try varying the offset. Then the length with a fixed non-zero
 * offset.
 */
@Test(timeout=60000) public void testReadWriteRangeAsyncSingleClient() throws IOException {
  SyncObj sync=new SyncObj();
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    byte bytes[]={'a','b','c','d','e','f','g','h','i'};
    lh.asyncAddEntry(bytes,0,bytes.length,this,sync);
    lh.asyncAddEntry(bytes,0,4,this,sync);
    lh.asyncAddEntry(bytes,3,4,this,sync);
    lh.asyncAddEntry(bytes,3,(bytes.length - 3),this,sync);
    int numEntries=4;
synchronized (sync) {
      while (sync.counter < numEntries) {
        LOG.debug("Entries counter = " + sync.counter);
        sync.wait();
      }
      assertEquals("Error adding",BKException.Code.OK,sync.getReturnCode());
    }
    try {
      lh.asyncAddEntry(bytes,-1,bytes.length,this,sync);
      fail("Shouldn't be able to use negative offset");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,0,bytes.length + 1,this,sync);
      fail("Shouldn't be able to use that much length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,-1,bytes.length + 2,this,sync);
      fail("Shouldn't be able to use negative offset " + "with that much length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,4,-3,this,sync);
      fail("Shouldn't be able to use negative length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,-4,-3,this,sync);
      fail("Shouldn't be able to use negative offset & length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
    lh=bkc.openLedger(ledgerId,digestType,ledgerPassword);
    LOG.debug("Number of entries written: " + (lh.getLastAddConfirmed() + 1));
    assertTrue("Verifying number of entries written",lh.getLastAddConfirmed() == (numEntries - 1));
    lh.asyncReadEntries(0,numEntries - 1,this,sync);
synchronized (sync) {
      while (sync.value == false) {
        sync.wait();
      }
      assertEquals("Error reading",BKException.Code.OK,sync.getReturnCode());
    }
    LOG.debug("*** READ COMPLETE ***");
    int i=0;
    Enumeration<LedgerEntry> ls=sync.getLedgerEntries();
    while (ls.hasMoreElements()) {
      byte[] expected=null;
      byte[] entry=ls.nextElement().getEntry();
switch (i) {
case 0:
        expected=Arrays.copyOfRange(bytes,0,bytes.length);
      break;
case 1:
    expected=Arrays.copyOfRange(bytes,0,4);
  break;
case 2:
expected=Arrays.copyOfRange(bytes,3,3 + 4);
break;
case 3:
expected=Arrays.copyOfRange(bytes,3,3 + (bytes.length - 3));
break;
}
assertNotNull("There are more checks than writes",expected);
String message="Checking entry " + i + " for equality ["+ new String(entry,"UTF-8")+ ","+ new String(expected,"UTF-8")+ "]";
assertTrue(message,Arrays.equals(entry,expected));
i++;
}
assertTrue("Checking number of read entries",i == numEntries);
lh.close();
}
 catch (BKException e) {
LOG.error("Test failed",e);
fail("Test failed due to BookKeeper exception");
}
catch (InterruptedException e) {
LOG.error("Test failed",e);
fail("Test failed due to interruption");
}
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.BookieZKExpireTest </h4><pre class="type-2 type-11 type-6 type-8 type-3 type-4 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("deprecation") @Test(timeout=60000) public void testBookieServerZKExpireBehaviour() throws Exception {
  BookieServer server=null;
  try {
    File f=createTempDir("bookieserver","test");
    HashSet<Thread> threadset=new HashSet<Thread>();
    int threadCount=Thread.activeCount();
    Thread threads[]=new Thread[threadCount * 2];
    threadCount=Thread.enumerate(threads);
    for (int i=0; i < threadCount; i++) {
      if (threads[i].getName().indexOf("SendThread") != -1) {
        threadset.add(threads[i]);
      }
    }
    ServerConfiguration conf=newServerConfiguration(PortManager.nextFreePort(),zkUtil.getZooKeeperConnectString(),f,new File[]{f});
    server=new BookieServer(conf);
    server.start();
    int secondsToWait=5;
    while (!server.isRunning()) {
      Thread.sleep(1000);
      if (secondsToWait-- <= 0) {
        fail("Bookie never started");
      }
    }
    Thread sendthread=null;
    threadCount=Thread.activeCount();
    threads=new Thread[threadCount * 2];
    threadCount=Thread.enumerate(threads);
    for (int i=0; i < threadCount; i++) {
      if (threads[i].getName().indexOf("SendThread") != -1 && !threadset.contains(threads[i])) {
        sendthread=threads[i];
        break;
      }
    }
    assertNotNull("Send thread not found",sendthread);
    sendthread.suspend();
    Thread.sleep(2 * conf.getZkTimeout());
    sendthread.resume();
    Thread.sleep(3000);
    assertTrue("Bookie should not shutdown on losing zk session",server.isBookieRunning());
    assertTrue("Bookie Server should not shutdown on losing zk session",server.isRunning());
  }
  finally {
    server.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.zookeeper.TestZooKeeperClient </h4><pre class="type-2 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testRetrySyncOperations() throws Exception {
  final int timeout=2000;
  ZooKeeperClient client=ZooKeeperClient.createConnectedZooKeeperClient(zkUtil.getZooKeeperConnectString(),timeout,new HashSet<Watcher>(),new BoundExponentialBackoffRetryPolicy(timeout,timeout,Integer.MAX_VALUE));
  Assert.assertTrue("Client failed to connect an alive ZooKeeper.",client.getState().isConnected());
  String path="/a";
  byte[] data="test".getBytes();
  expireZooKeeperSession(client,timeout);
  logger.info("Create znode " + path);
  client.create(path,data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  logger.info("Created znode " + path);
  expireZooKeeperSession(client,timeout);
  logger.info("Exists znode " + path);
  Stat stat=client.exists(path,false);
  Assert.assertNotNull("znode doesn't existed",stat);
  expireZooKeeperSession(client,timeout);
  logger.info("Get data from znode " + path);
  Stat newStat=new Stat();
  client.getData(path,false,newStat);
  Assert.assertEquals(stat,newStat);
  expireZooKeeperSession(client,timeout);
  logger.info("Create children under znode " + path);
  client.create(path + "/children",data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expireZooKeeperSession(client,timeout);
  List<String> children=client.getChildren(path,false,newStat);
  Assert.assertEquals(1,children.size());
  Assert.assertEquals("children",children.get(0));
  logger.info("Get children under znode " + path);
  expireZooKeeperSession(client,timeout);
  client.delete(path + "/children",-1);
  logger.info("Delete children from znode " + path);
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testRetryAsyncOperations() throws Exception {
  final int timeout=2000;
  ZooKeeperClient client=ZooKeeperClient.createConnectedZooKeeperClient(zkUtil.getZooKeeperConnectString(),timeout,new HashSet<Watcher>(),new BoundExponentialBackoffRetryPolicy(timeout,timeout,Integer.MAX_VALUE));
  Assert.assertTrue("Client failed to connect an alive ZooKeeper.",client.getState().isConnected());
  String path="/a";
  byte[] data="test".getBytes();
  expireZooKeeperSession(client,timeout);
  logger.info("Create znode " + path);
  final CountDownLatch createLatch=new CountDownLatch(1);
  client.create(path,data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new StringCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    String name){
      if (KeeperException.Code.OK.intValue() == rc) {
        createLatch.countDown();
      }
    }
  }
,null);
  createLatch.await();
  logger.info("Created znode " + path);
  expireZooKeeperSession(client,timeout);
  logger.info("Exists znode " + path);
  final CountDownLatch existsLatch=new CountDownLatch(1);
  client.exists(path,false,new StatCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    Stat stat){
      if (KeeperException.Code.OK.intValue() == rc) {
        existsLatch.countDown();
      }
    }
  }
,null);
  existsLatch.await();
  expireZooKeeperSession(client,timeout);
  final CountDownLatch getLatch=new CountDownLatch(1);
  logger.info("Get data from znode " + path);
  client.getData(path,false,new DataCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    byte[] data,    Stat stat){
      if (KeeperException.Code.OK.intValue() == rc) {
        getLatch.countDown();
      }
    }
  }
,null);
  getLatch.await();
  expireZooKeeperSession(client,timeout);
  logger.info("Create children under znode " + path);
  final CountDownLatch createChildLatch=new CountDownLatch(1);
  client.create(path + "/children",data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new StringCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    String name){
      if (KeeperException.Code.OK.intValue() == rc) {
        createChildLatch.countDown();
      }
    }
  }
,null);
  createChildLatch.await();
  expireZooKeeperSession(client,timeout);
  final CountDownLatch getChildLatch=new CountDownLatch(1);
  final AtomicReference<List<String>> children=new AtomicReference<List<String>>();
  client.getChildren(path,false,new Children2Callback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    List<String> childList,    Stat stat){
      if (KeeperException.Code.OK.intValue() == rc) {
        children.set(childList);
        getChildLatch.countDown();
      }
    }
  }
,null);
  getChildLatch.await();
  Assert.assertNotNull(children.get());
  Assert.assertEquals(1,children.get().size());
  Assert.assertEquals("children",children.get().get(0));
  logger.info("Get children under znode " + path);
  expireZooKeeperSession(client,timeout);
  final CountDownLatch deleteChildLatch=new CountDownLatch(1);
  client.delete(path + "/children",-1,new VoidCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx){
      if (KeeperException.Code.OK.intValue() == rc) {
        deleteChildLatch.countDown();
      }
    }
  }
,null);
  deleteChildLatch.await();
  logger.info("Delete children from znode " + path);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.client.TestPubSubClient </h4><pre class="type-4 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testCloseSubscribeDuringResubscribe() throws Exception {
  client.close();
  final long reconnectWaitTime=2000L;
  client=new HedwigClient(new ClientConfiguration(){
    @Override public HedwigSocketAddress getDefaultServerHedwigSocketAddress(){
      return getDefaultHedwigAddress();
    }
    @Override public boolean isSubscriptionChannelSharingEnabled(){
      return TestPubSubClient.this.isSubscriptionChannelSharingEnabled;
    }
    @Override public long getSubscribeReconnectRetryWaitTime(){
      return reconnectWaitTime;
    }
  }
);
  publisher=client.getPublisher();
  subscriber=client.getSubscriber();
  ByteString topic=ByteString.copyFromUtf8("testCloseSubscribeDuringResubscribe");
  ByteString subscriberId=ByteString.copyFromUtf8("mysub");
  subscriber.addSubscriptionListener(new TestSubscriptionListener());
  SubscriptionOptions options=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).setForceAttach(false).setEnableResubscribe(true).build();
  subscriber.subscribe(topic,subscriberId,options);
  logger.info("Subscribed topic {}, subscriber {}.",topic.toStringUtf8(),subscriberId.toStringUtf8());
  subscriber.startDelivery(topic,subscriberId,new TestMessageHandler());
  tearDownHubServer();
  logger.info("Tear down the hub server");
  Thread.sleep(reconnectWaitTime / 2);
  subscriber.closeSubscription(topic,subscriberId);
  startHubServer(conf);
  publisher.asyncPublish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8("Message #1")).build(),new TestCallback(),null);
  assertTrue(queue.take());
  assertNull("Should not receive any messages since the subscription has already been closed.",consumeQueue.poll(reconnectWaitTime + reconnectWaitTime / 2,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncPublishWithResponse() throws Exception {
  ByteString topic=ByteString.copyFromUtf8("testSyncPublishWithResponse");
  ByteString subid=ByteString.copyFromUtf8("mysubid");
  final String prefix="SyncMessage-";
  final int numMessages=30;
  final Map<String,MessageSeqId> publishedMsgs=new HashMap<String,MessageSeqId>();
  final AtomicInteger numReceived=new AtomicInteger(0);
  final CountDownLatch receiveLatch=new CountDownLatch(1);
  final Map<String,MessageSeqId> receivedMsgs=new HashMap<String,MessageSeqId>();
  SubscriptionOptions opts=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).build();
  subscriber.subscribe(topic,subid,opts);
  subscriber.startDelivery(topic,subid,new MessageHandler(){
    synchronized public void deliver(    ByteString topic,    ByteString subscriberId,    Message msg,    Callback<Void> callback,    Object context){
      String str=msg.getBody().toStringUtf8();
      receivedMsgs.put(str,msg.getMsgId());
      if (numMessages == numReceived.incrementAndGet()) {
        receiveLatch.countDown();
      }
      callback.operationFinished(context,null);
    }
  }
);
  for (int i=0; i < numMessages; i++) {
    String str=prefix + i;
    ByteString data=ByteString.copyFromUtf8(str);
    Message msg=Message.newBuilder().setBody(data).build();
    PublishResponse response=publisher.publish(topic,msg);
    assertNotNull(response);
    publishedMsgs.put(str,response.getPublishedMsgId());
  }
  assertTrue("Timed out waiting on callback for messages.",receiveLatch.await(30,TimeUnit.SECONDS));
  assertEquals("Should be expected " + numMessages + " messages.",numMessages,numReceived.get());
  assertEquals("Should be expected " + numMessages + " messages in map.",numMessages,receivedMsgs.size());
  for (int i=0; i < numMessages; i++) {
    final String str=prefix + i;
    MessageSeqId pubId=publishedMsgs.get(str);
    MessageSeqId revId=receivedMsgs.get(str);
    assertTrue("Doesn't receive same message seq id for " + str,pubId.equals(revId));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.jms.selector.BasicSelectorGrammarTest </h4><pre class="type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasicLookup() throws ParseException {
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " = " + BOOLEAN_VALUE1),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " <> " + BOOLEAN_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " = " + INT_VALUE1),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " <> " + INT_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " = " + DOUBLE_VALUE1),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " <> " + DOUBLE_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " = '" + STRING_VALUE1+ "'"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " <> '" + STRING_VALUE1+ "'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " = '" + STRING_QUOTED_QUOTES_VALUE+ "'"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " <> '" + STRING_QUOTED_QUOTES_VALUE+ "'"),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " = " + INT_VALUE1),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " = " + DOUBLE_VALUE1),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector("unknown_header = " + STRING_VALUE1),message));
}

</code></pre>

<br>
<pre class="type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFunctions() throws ParseException {
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER2 + " IS NOT NULL"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " IS NULL"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector("unknown_header is null"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER2 + " BETWEEN 1 AND 2"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(" ( - " + INT_HEADER1 + " * 2 + "+ DOUBLE_HEADER1+ " * 4 ) / 10.0 between 0 and 3 * "+ INT_HEADER2+ " * 2.4"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER2 + " not between (0.4 * 2 + (0.01 + 0.3 * 0.2) ) AND 10.0"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER2 + " NOT BETWEEN (0.4 * 2 + (0.01 + 0.3 * 0.2) + " + DOUBLE_VALUE1+ " / 10.0 ) AND 10.0"),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " * 2 + " + DOUBLE_HEADER1+ " / 1.4 NOT BETWEEN (0.4 * 2 + (0.01 + 0.3 * 0.2) + "+ DOUBLE_VALUE1+ " / 10.0 ) AND 10.0"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER3 + " IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "', '"+ STRING_QUOTED_QUOTES_VALUE+ "') "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "', '"+ STRING_QUOTED_QUOTES_VALUE+ "') "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " NOT IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "') "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " NOT IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "') "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "') "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " LIKE 'header\\_%' ESCAPE '\\'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_LIKE_HEADER + " LIKE '% with a \\_ and \\%%' ESCAPE '\\'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_LIKE_HEADER + " LIKE '%\n%'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_LIKE_HEADER + " NOT LIKE '%\r%'"),message));
}

</code></pre>

<br>
<pre class="type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testArithmetic() throws ParseException {
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " + " + INT_HEADER2+ " > "+ INT_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " + ( 2 * " + INT_HEADER2+ " + "+ INT_HEADER1+ " ) < "+ " 4 * ( "+ INT_HEADER1+ " + "+ INT_VALUE2+ " ) "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " + " + DOUBLE_HEADER2+ " > "+ DOUBLE_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " * 7.5 + 1 + 2 * ( " + DOUBLE_HEADER2+ " + 2.0 * "+ DOUBLE_HEADER1+ " ) = "+ " 0.5 + 4 * ( 2.0 * "+ DOUBLE_HEADER1+ " + "+ DOUBLE_VALUE2+ " ) "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " * 4 + " + DOUBLE_HEADER1+ " * 7.5 + 1 + 2 * ( "+ DOUBLE_HEADER2+ "+ 2.0 * "+ DOUBLE_HEADER1+ " ) = "+ " 0.5 + 4 * ( 2.0 * "+ DOUBLE_HEADER1+ " + "+ DOUBLE_VALUE2+ " ) "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(" unknown_header * 4 + " + DOUBLE_HEADER1 + " * 7.5 + 1 + 2 * ( "+ DOUBLE_HEADER2+ " + 2.0 * "+ DOUBLE_HEADER1+ " ) = "+ " 0.5 + 4 * ( 2.0 * "+ DOUBLE_HEADER1+ " + "+ DOUBLE_VALUE2+ " ) "),message));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.TestBackwardCompat </h4><pre class="type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * Test compatability of publish interface between version 4.1.0
 * and current verison.
 * 1) 4.1.0 client could talk with current server.
 * 2) current client could talk with 4.1.0 server,
 * but no message seq id would be returned
 */
@Test(timeout=60000) public void testPublishCompat410() throws Exception {
  ByteString topic=ByteString.copyFromUtf8("TestPublishCompat410");
  ByteString data=ByteString.copyFromUtf8("testdata");
  BookKeeperCluster410 bkc410=new BookKeeperCluster410(3);
  bkc410.start();
  int port=PortManager.nextFreePort();
  int sslPort=PortManager.nextFreePort();
  Server410 s410=new Server410(zkUtil.getZooKeeperConnectString(),port,sslPort);
  s410.start();
  ClientCurrent ccur=new ClientCurrent("localhost:" + port + ":"+ sslPort);
  Client410 c410=new Client410("localhost:" + port + ":"+ sslPort);
  assertNull(c410.publish(topic,data));
  assertNull(ccur.publish(topic,data));
  s410.stop();
  Server420 s420=new Server420(zkUtil.getZooKeeperConnectString(),port,sslPort);
  s420.start();
  assertNull(c410.publish(topic,data));
  assertNotNull(ccur.publish(topic,data));
  ccur.close();
  c410.close();
  s420.stop();
  bkc410.stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.delivery.TestFIFODeliveryManager </h4><pre class="type-3 type-4 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that the FIFO delivery manager executes stopServing and startServing
 * in the correct order{@link https://issues.apache.org/jira/browse/BOOKKEEPER-539}
 */
@Test(timeout=60000) public void testFIFODeliverySubCloseSubRace() throws Exception {
  ServerConfiguration conf=new ServerConfiguration();
  ByteString topic=ByteString.copyFromUtf8("subRaceTopic");
  ByteString subscriber=ByteString.copyFromUtf8("subRaceSubscriber");
  PersistenceManager pm=new StubPersistenceManager();
  FIFODeliveryManager fdm=new FIFODeliveryManager(new StubTopicManager(conf),pm,conf);
  ExecutorDeliveryEndPointWithQueue dep=new ExecutorDeliveryEndPointWithQueue();
  SubscriptionPreferences prefs=SubscriptionPreferences.newBuilder().build();
  PipelineFilter filter=new PipelineFilter();
  filter.addLast(new AllToAllTopologyFilter());
  filter.initialize(conf.getConf());
  filter.setSubscriptionPreferences(topic,subscriber,prefs);
  MessageSeqId startId=MessageSeqId.newBuilder().setLocalComponent(1).build();
  CountDownLatch l=new CountDownLatch(1);
  Message m=Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(1))).build();
  TestCallback cb=new TestCallback(l);
  pm.persistMessage(new PersistRequest(topic,m,cb,null));
  assertTrue("Persistence never finished",l.await(10,TimeUnit.SECONDS));
  final CountDownLatch oplatch=new CountDownLatch(3);
  fdm.start();
  fdm.startServingSubscription(topic,subscriber,prefs,startId,dep,filter,new Callback<Void>(){
    @Override public void operationFinished(    Object ctx,    Void result){
      oplatch.countDown();
    }
    @Override public void operationFailed(    Object ctx,    PubSubException exception){
      oplatch.countDown();
    }
  }
,null);
  fdm.stopServingSubscriber(topic,subscriber,null,new Callback<Void>(){
    @Override public void operationFinished(    Object ctx,    Void result){
      oplatch.countDown();
    }
    @Override public void operationFailed(    Object ctx,    PubSubException exception){
      oplatch.countDown();
    }
  }
,null);
  fdm.startServingSubscription(topic,subscriber,prefs,startId,dep,filter,new Callback<Void>(){
    @Override public void operationFinished(    Object ctx,    Void result){
      oplatch.countDown();
    }
    @Override public void operationFailed(    Object ctx,    PubSubException exception){
      oplatch.countDown();
    }
  }
,null);
  assertTrue("Ops never finished",oplatch.await(10,TimeUnit.SECONDS));
  int seconds=5;
  while (dep.getNumResponses() < 2) {
    if (seconds-- == 0) {
      break;
    }
    Thread.sleep(1000);
  }
  PubSubResponse r=dep.getNextResponse();
  assertNotNull("There should be a response",r);
  assertTrue("Response should contain a message",r.hasMessage());
  r=dep.getNextResponse();
  assertNotNull("There should be a response",r);
  assertTrue("Response should contain a message",r.hasMessage());
  r=dep.getNextResponse();
  assertNull("There should only be 2 responses",r);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.handlers.TestBaseHandler </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testHandleRequestOnError() throws Exception {
  tm.setShouldError(true);
  handler.handleRequest(request,channel);
  PubSubResponse response=getPubSubResponse(channel);
  assertEquals(response.getStatusCode(),StatusCode.SERVICE_DOWN);
  assertEquals(request.getTxnId(),response.getTxnId());
  assertNull(handler.getRequest());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testHandleRequestOnRedirect() throws Exception {
  tm.setShouldOwnEveryNewTopic(false);
  handler.handleRequest(request,channel);
  PubSubResponse response=getPubSubResponse(channel);
  assertEquals(response.getStatusCode(),StatusCode.NOT_RESPONSIBLE_FOR_TOPIC);
  assertEquals(request.getTxnId(),response.getTxnId());
  assertNull(handler.getRequest());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.handlers.TestSubUnsubHandler </h4><pre class="type-3 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSuccessCase(){
  StubCallback<Void> callback=new StubCallback<Void>();
  sm.acquiredTopic(topic,callback,null);
  assertNull(ConcurrencyUtils.take(callback.queue).right());
  sh.handleRequestAtOwner(pubSubRequestPrototype,channel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  Set<TopicSubscriber> topicSubs=new HashSet<TopicSubscriber>();
  topicSubs.add(new TopicSubscriber(topic,subscriberId));
  assertEquals(topicSubs,subChannelMgr.channel2sub.get(channel));
  assertEquals(channel,subChannelMgr.sub2Channel.get(new TopicSubscriber(topic,subscriberId)));
  StartServingRequest startRequest=(StartServingRequest)dm.lastRequest.poll();
  assertEquals(channel,((ChannelEndPoint)startRequest.endPoint).getChannel());
  assertEquals(PipelineFilter.class,startRequest.filter.getClass());
  PipelineFilter pfilter=(PipelineFilter)(startRequest.filter);
  assertEquals(1,pfilter.size());
  assertEquals(AllToAllTopologyFilter.class,pfilter.getFirst().getClass());
  assertEquals(1,startRequest.seqIdToStartFrom.getLocalComponent());
  assertEquals(subscriberId,startRequest.subscriberId);
  assertEquals(topic,startRequest.topic);
  StubCallback<SubscriptionData> callback1=new StubCallback<SubscriptionData>();
  sm.serveSubscribeRequest(topic,SubscribeRequest.newBuilder(subRequestPrototype).setCreateOrAttach(CreateOrAttach.CREATE).build(),MessageSeqId.newBuilder().setLocalComponent(10).build(),callback1,null);
  assertEquals(PubSubException.ClientAlreadySubscribedException.class,ConcurrencyUtils.take(callback1.queue).right().getClass());
  WriteRecordingChannel dupChannel=new WriteRecordingChannel();
  sh.handleRequestAtOwner(pubSubRequestPrototype,dupChannel);
  assertEquals(StatusCode.TOPIC_BUSY,((PubSubResponse)dupChannel.getMessagesWritten().get(0)).getStatusCode());
  subChannelMgr.channelDisconnected(channel);
  dupChannel=new WriteRecordingChannel();
  sh.handleRequestAtOwner(pubSubRequestPrototype,dupChannel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)dupChannel.getMessagesWritten().get(0)).getStatusCode());
  channel=new WriteRecordingChannel();
  ush.handleRequestAtOwner(pubSubRequestPrototype,channel);
  assertEquals(StatusCode.MALFORMED_REQUEST,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  PubSubRequest unsubRequest=PubSubRequest.newBuilder(pubSubRequestPrototype).setUnsubscribeRequest(UnsubscribeRequest.newBuilder().setSubscriberId(subscriberId)).build();
  channel=new WriteRecordingChannel();
  dm.lastRequest.clear();
  ush.handleRequestAtOwner(unsubRequest,channel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  assertEquals(new TopicSubscriber(topic,subscriberId),dm.lastRequest.poll());
  StubCallback<SubscriptionData> callback2=new StubCallback<SubscriptionData>();
  sm.serveSubscribeRequest(topic,SubscribeRequest.newBuilder(subRequestPrototype).setCreateOrAttach(CreateOrAttach.ATTACH).build(),MessageSeqId.newBuilder().setLocalComponent(10).build(),callback2,null);
  assertEquals(PubSubException.ClientNotSubscribedException.class,ConcurrencyUtils.take(callback2.queue).right().getClass());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.meta.TestMetadataManager </h4><pre class="type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testPersistenceInfo() throws Exception {
  TopicPersistenceManager tpManager=metadataManagerFactory.newTopicPersistenceManager();
  ByteString topic=ByteString.copyFromUtf8("testPersistenceInfo");
  StubCallback<Versioned<LedgerRanges>> readCallback=new StubCallback<Versioned<LedgerRanges>>();
  StubCallback<Version> writeCallback=new StubCallback<Version>();
  StubCallback<Void> deleteCallback=new StubCallback<Void>();
  tpManager.writeTopicPersistenceInfo(topic,LedgerRanges.getDefaultInstance(),Version.NEW,writeCallback,null);
  Either<Version,PubSubException> res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v1=res.left();
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  Versioned<LedgerRanges> ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(ranges.getVersion()));
  Assert.assertEquals(LedgerRanges.getDefaultInstance(),ranges.getValue());
  LedgerRange lastRange=LedgerRange.newBuilder().setLedgerId(1).build();
  LedgerRanges.Builder builder=LedgerRanges.newBuilder();
  builder.addRanges(lastRange);
  LedgerRanges newRanges=builder.build();
  tpManager.writeTopicPersistenceInfo(topic,newRanges,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.TopicPersistenceInfoExistsException);
  tpManager.writeTopicPersistenceInfo(topic,newRanges,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v2=res.left();
  Assert.assertEquals(Version.Occurred.AFTER,v2.compare(v1));
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  lastRange=LedgerRange.newBuilder().setLedgerId(2).build();
  builder=LedgerRanges.newBuilder();
  builder.addRanges(lastRange);
  LedgerRanges newRanges2=builder.build();
  tpManager.writeTopicPersistenceInfo(topic,newRanges2,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.BadVersionException);
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  tpManager.deleteTopicPersistenceInfo(topic,v1,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.BadVersionException);
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  tpManager.deleteTopicPersistenceInfo(topic,v2,deleteCallback,null);
  Assert.assertEquals(null,deleteCallback.queue.take().right());
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  Assert.assertEquals(null,readCallback.queue.take().left());
  tpManager.deleteTopicPersistenceInfo(topic,Version.ANY,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.NoTopicPersistenceInfoException);
  tpManager.close();
}

</code></pre>

<br>
<pre class="type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testOwnerInfo() throws Exception {
  TopicOwnershipManager toManager=metadataManagerFactory.newTopicOwnershipManager();
  ByteString topic=ByteString.copyFromUtf8("testOwnerInfo");
  StubCallback<Versioned<HubInfo>> readCallback=new StubCallback<Versioned<HubInfo>>();
  StubCallback<Version> writeCallback=new StubCallback<Version>();
  StubCallback<Void> deleteCallback=new StubCallback<Void>();
  Either<Version,PubSubException> res;
  HubInfo owner=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),999);
  toManager.writeOwnerInfo(topic,owner,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v1=res.left();
  toManager.readOwnerInfo(topic,readCallback,null);
  Versioned<HubInfo> hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(hubInfo.getVersion()));
  Assert.assertEquals(owner,hubInfo.getValue());
  HubInfo newOwner=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),1000);
  toManager.writeOwnerInfo(topic,newOwner,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.TopicOwnerInfoExistsException);
  toManager.writeOwnerInfo(topic,newOwner,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v2=res.left();
  Assert.assertEquals(Version.Occurred.AFTER,v2.compare(v1));
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  Assert.assertEquals(newOwner,hubInfo.getValue());
  HubInfo newOwner2=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),1001);
  toManager.writeOwnerInfo(topic,newOwner2,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.BadVersionException);
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  Assert.assertEquals(newOwner,hubInfo.getValue());
  toManager.deleteOwnerInfo(topic,v1,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.BadVersionException);
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  toManager.deleteOwnerInfo(topic,v2,deleteCallback,null);
  Assert.assertEquals(null,deleteCallback.queue.take().right());
  toManager.readOwnerInfo(topic,readCallback,null);
  Assert.assertEquals(null,readCallback.queue.take().left());
  toManager.deleteOwnerInfo(topic,Version.ANY,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.NoTopicOwnerInfoException);
  toManager.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.MessageBoundedPersistenceTest </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLedgerGC() throws Exception {
  Client client=new HedwigClient(new MessageBoundClientConfiguration());
  Publisher pub=client.getPublisher();
  Subscriber sub=client.getSubscriber();
  String ledgersPath="/hedwig/standalone/topics/testGCTopic/ledgers";
  ByteString topic=ByteString.copyFromUtf8("testGCTopic");
  ByteString subid=ByteString.copyFromUtf8("testGCSubId");
  SubscriptionOptions opts=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).build();
  sub.subscribe(topic,subid,opts);
  sub.closeSubscription(topic,subid);
  for (int i=1; i <= 100; i++) {
    pub.publish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(i))).build());
  }
  LedgerRanges r=LedgerRanges.parseFrom(bktb.getZooKeeperClient().getData(ledgersPath,false,null));
  assertEquals("Should only have 1 ledger yet",1,r.getRangesList().size());
  long firstLedger=r.getRangesList().get(0).getLedgerId();
  stopHubServers();
  startHubServers();
  pub.publish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(0xdeadbeef))).build());
  r=LedgerRanges.parseFrom(bktb.getZooKeeperClient().getData(ledgersPath,false,null));
  assertEquals("Should have 2 ledgers after restart",2,r.getRangesList().size());
  for (int i=100; i <= 200; i++) {
    pub.publish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(i))).build());
  }
  Thread.sleep(5000);
  r=LedgerRanges.parseFrom(bktb.getZooKeeperClient().getData(ledgersPath,false,null));
  long secondLedger=r.getRangesList().get(0).getLedgerId();
  assertEquals("Should only have 1 ledger after GC",1,r.getRangesList().size());
  String firstLedgerPath=String.format("/ledgers/L%010d",firstLedger);
  String secondLedgerPath=String.format("/ledgers/L%010d",secondLedger);
  assertNull("Ledger should not exist",bktb.getZooKeeperClient().exists(firstLedgerPath,false));
  assertNotNull("Ledger should exist",bktb.getZooKeeperClient().exists(secondLedgerPath,false));
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.TestBookkeeperPersistenceManagerWhiteBox </h4><pre class="type-3 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testChangeLedgerFailure() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  ChangeLedgerCallback persistCallback=new ChangeLedgerCallback(1,NUM_MESSAGES_TO_TEST);
  for (  Message message : messages) {
    bkpm.persistMessage(new PersistRequest(topic,message,persistCallback,null));
  }
  assertEquals(maxEntriesPerLedger + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
  assertEquals(maxEntriesPerLedger,persistCallback.numSuccess);
  assertEquals(NUM_MESSAGES_TO_TEST - maxEntriesPerLedger,persistCallback.numFailed);
}

</code></pre>

<br>
<pre class="type-2 type-11 type-6 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncChangeLedgers() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  int index=0;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  while (index < messages.size()) {
    logger.debug("Persist message {}",(index + 1));
    StubCallback<MessageSeqId> persistCallback=new StubCallback<MessageSeqId>();
    bkpm.persistMessage(new PersistRequest(topic,messages.get(index),persistCallback,null));
    assertEquals(index + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
    index++;
    if (index % maxEntriesPerLedger == 1) {
      assertEquals(index / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
    }
  }
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Message scannedMessage=ConcurrencyUtils.take(scanCallback.queue).left();
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
  bkpm.topicInfos.clear();
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger + 1,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testNonEmptyDirtyLedger() throws Exception {
  Random r=new Random();
  int NUM_MESSAGES_TO_TEST=100;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  int index=0;
  int numPrevLedgers=0;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  while (index < messages.size()) {
    StubCallback<Void> stubCallback=new StubCallback<Void>();
    bkpm.acquiredTopic(topic,stubCallback,null);
    assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
    assertEquals(numPrevLedgers,bkpm.topicInfos.get(topic).ledgerRanges.size());
    StubCallback<PubSubProtocol.MessageSeqId> persistCallback=new StubCallback<PubSubProtocol.MessageSeqId>();
    bkpm.persistMessage(new PersistRequest(topic,messages.get(index),persistCallback,null));
    assertEquals(index + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
    index++;
    if (r.nextInt(10) == 9) {
      if (index < messages.size()) {
        bkpm.topicInfos.clear();
        numPrevLedgers++;
      }
    }
  }
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Message scannedMessage=ConcurrencyUtils.take(scanCallback.queue).left();
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAsyncChangeLedgers() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  OrderCheckingCallback persistCallback=new OrderCheckingCallback(1,NUM_MESSAGES_TO_TEST);
  for (  Message message : messages) {
    bkpm.persistMessage(new PersistRequest(topic,message,persistCallback,null));
  }
  assertEquals(NUM_MESSAGES_TO_TEST + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
  assertEquals(NUM_MESSAGES_TO_TEST,persistCallback.numSuccess);
  assertEquals(0,persistCallback.numFailed);
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Either<Message,Exception> e=ConcurrencyUtils.take(scanCallback.queue);
    Message scannedMessage=e.left();
    if (scannedMessage == null) {
      throw e.right();
    }
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
  bkpm.topicInfos.clear();
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger + 1,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testEmptyDirtyLedger() throws Exception {
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  bkpm=new BookkeeperPersistenceManager(new BookKeeper(bktb.getZkHostPort()),mm,tm,conf,scheduler);
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.TestReadAheadCacheWhiteBox </h4><pre class="type-3 type-4 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testPersistMessage() throws Exception {
  StubCallback<PubSubProtocol.MessageSeqId> callback=new StubCallback<PubSubProtocol.MessageSeqId>();
  PersistRequest request=new PersistRequest(topic,messages.get(0),callback,null);
  stubPersistenceManager.failure=true;
  cacheBasedPersistenceManager.persistMessage(request);
  assertNotNull(ConcurrencyUtils.take(callback.queue).right());
  CacheKey key=new CacheKey(topic,cacheBasedPersistenceManager.getCurrentSeqIdForTopic(topic).getLocalComponent());
  assertFalse(cacheBasedPersistenceManager.cache.containsKey(key));
  stubPersistenceManager.failure=false;
  persistMessage(messages.get(0));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testDoReadAheadStartingFrom() throws Exception {
  persistMessage(messages.get(0));
  int readAheadCount=5;
  int start=1;
  RangeScanRequest readAheadRequest=cacheBasedPersistenceManager.doReadAheadStartingFrom(topic,start,readAheadCount);
  assertNull(readAheadRequest);
  StubScanCallback callback=new StubScanCallback();
  int end=100;
  ScanRequest request=new ScanRequest(topic,end,callback,null);
  cacheBasedPersistenceManager.doReadAhead(request);
  int pos=98;
  readAheadRequest=cacheBasedPersistenceManager.doReadAheadStartingFrom(topic,pos,readAheadCount);
  assertEquals(readAheadRequest.messageLimit,end - pos);
  end=200;
  request=new ScanRequest(topic,end,callback,null);
  cacheBasedPersistenceManager.doReadAhead(request);
  pos=150;
  readAheadRequest=cacheBasedPersistenceManager.doReadAheadStartingFrom(topic,pos,readAheadCount);
  assertEquals(readAheadRequest.messageLimit,readAheadCount);
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
