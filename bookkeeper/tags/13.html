<h3><span class=" glyphicon glyphicon-tag"/>&nbspPublicFieldVerifier</h3><kbd>Verifies values related to public fields.</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.EntryLogTest </h4><pre class="type-3 type-4 type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
/** 
 * Test to verify the DiskFull during addEntry
 */
@Test(timeout=60000) public void testAddEntryFailureOnDiskFull() throws Exception {
  File ledgerDir1=createTempDir("bkTest",".dir");
  File ledgerDir2=createTempDir("bkTest",".dir");
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration();
  conf.setLedgerDirNames(new String[]{ledgerDir1.getAbsolutePath(),ledgerDir2.getAbsolutePath()});
  Bookie bookie=new Bookie(conf);
  EntryLogger entryLogger=new EntryLogger(conf,bookie.getLedgerDirsManager());
  InterleavedLedgerStorage ledgerStorage=((InterleavedLedgerStorage)bookie.ledgerStorage);
  ledgerStorage.entryLogger=entryLogger;
  ledgerStorage.setMasterKey(1,"key".getBytes());
  ledgerStorage.setMasterKey(2,"key".getBytes());
  ledgerStorage.setMasterKey(3,"key".getBytes());
  ledgerStorage.addEntry(generateEntry(1,1));
  ledgerStorage.addEntry(generateEntry(2,1));
  bookie.getLedgerDirsManager().addToFilledDirs(entryLogger.currentDir);
  ledgerStorage.addEntry(generateEntry(3,1));
  Assert.assertTrue(0 == generateEntry(1,1).compareTo(ledgerStorage.getEntry(1,1)));
  Assert.assertTrue(0 == generateEntry(2,1).compareTo(ledgerStorage.getEntry(2,1)));
  Assert.assertTrue(0 == generateEntry(3,1).compareTo(ledgerStorage.getEntry(3,1)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.LedgerCacheTest </h4><pre class="type-3 type-4 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test Ledger Cache flush failure
 */
@Test(timeout=30000) public void testLedgerCacheFlushFailureOnDiskFull() throws Exception {
  File ledgerDir1=createTempDir("bkTest",".dir");
  File ledgerDir2=createTempDir("bkTest",".dir");
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration();
  conf.setLedgerDirNames(new String[]{ledgerDir1.getAbsolutePath(),ledgerDir2.getAbsolutePath()});
  Bookie bookie=new Bookie(conf);
  InterleavedLedgerStorage ledgerStorage=((InterleavedLedgerStorage)bookie.ledgerStorage);
  LedgerCacheImpl ledgerCache=(LedgerCacheImpl)ledgerStorage.ledgerCache;
  ledgerStorage.setMasterKey(1,"key".getBytes());
  FileInfo fileInfo=ledgerCache.getIndexPersistenceManager().getFileInfo(Long.valueOf(1),null);
  FileInfo newFileInfo=new FileInfo(fileInfo.getLf(),fileInfo.getMasterKey());
  ledgerCache.getIndexPersistenceManager().fileInfoCache.put(Long.valueOf(1),newFileInfo);
  ledgerStorage.addEntry(generateEntry(1,1));
  ledgerStorage.addEntry(generateEntry(1,2));
  ledgerStorage.flush();
  ledgerStorage.addEntry(generateEntry(1,3));
  bookie.getIndexDirsManager().addToFilledDirs(newFileInfo.getLf().getParentFile().getParentFile().getParentFile());
  File before=newFileInfo.getLf();
  ledgerStorage.flush();
  File after=newFileInfo.getLf();
  assertEquals("Reference counting for the file info should be zero.",0,newFileInfo.getUseCount());
  assertFalse("After flush index file should be changed",before.equals(after));
  Assert.assertArrayEquals(generateEntry(1,1).array(),ledgerStorage.getEntry(1,1).array());
  Assert.assertArrayEquals(generateEntry(1,2).array(),ledgerStorage.getEntry(1,2).array());
  Assert.assertArrayEquals(generateEntry(1,3).array(),ledgerStorage.getEntry(1,3).array());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestSpeculativeRead </h4><pre class="type-2 type-6 type-3 type-4 type-7 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Unit test for the speculative read scheduling method
 */
@Test(timeout=60000) public void testSpeculativeReadScheduling() throws Exception {
  long id=getLedgerToRead(3,2);
  int timeout=1000;
  BookKeeper bkspec=createClient(timeout);
  LedgerHandle l=bkspec.openLedger(id,digestType,passwd);
  ArrayList<BookieSocketAddress> ensemble=l.getLedgerMetadata().getEnsembles().get(0L);
  Set<BookieSocketAddress> allHosts=new HashSet<BookieSocketAddress>(ensemble);
  Set<BookieSocketAddress> noHost=new HashSet<BookieSocketAddress>();
  Set<BookieSocketAddress> secondHostOnly=new HashSet<BookieSocketAddress>();
  secondHostOnly.add(ensemble.get(1));
  PendingReadOp.LedgerEntryRequest req0=null, req2=null, req4=null;
  try {
    LatchCallback latch0=new LatchCallback();
    PendingReadOp op=new PendingReadOp(l,bkspec.scheduler,0,5,latch0,null);
    req0=op.new LedgerEntryRequest(ensemble,l.getId(),0);
    assertTrue("Should have sent to first",req0.maybeSendSpeculativeRead(allHosts).equals(ensemble.get(0)));
    assertNull("Should not have sent another",req0.maybeSendSpeculativeRead(allHosts));
    req2=op.new LedgerEntryRequest(ensemble,l.getId(),2);
    assertTrue("Should have sent to third",req2.maybeSendSpeculativeRead(noHost).equals(ensemble.get(2)));
    assertTrue("Should have sent to first",req2.maybeSendSpeculativeRead(secondHostOnly).equals(ensemble.get(0)));
    req4=op.new LedgerEntryRequest(ensemble,l.getId(),4);
    assertTrue("Should have sent to second",req4.maybeSendSpeculativeRead(noHost).equals(ensemble.get(1)));
    assertNull("Should not have sent another",req4.maybeSendSpeculativeRead(secondHostOnly));
  }
  finally {
    for (    PendingReadOp.LedgerEntryRequest req : new PendingReadOp.LedgerEntryRequest[]{req0,req2,req4}) {
      if (req != null) {
        int i=0;
        while (!req.isComplete()) {
          if (i++ > 10) {
            break;
          }
          Thread.sleep(1000);
        }
        assertTrue("Request should be done",req0.isComplete());
      }
    }
    l.close();
    bkspec.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.BookieReadWriteTest </h4><pre class="type-2 type-11 type-8 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that the add api with offset and length work correctly.
 * First try varying the offset. Then the length with a fixed non-zero
 * offset.
 */
@Test(timeout=60000) public void testReadWriteRangeAsyncSingleClient() throws IOException {
  SyncObj sync=new SyncObj();
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    byte bytes[]={'a','b','c','d','e','f','g','h','i'};
    lh.asyncAddEntry(bytes,0,bytes.length,this,sync);
    lh.asyncAddEntry(bytes,0,4,this,sync);
    lh.asyncAddEntry(bytes,3,4,this,sync);
    lh.asyncAddEntry(bytes,3,(bytes.length - 3),this,sync);
    int numEntries=4;
synchronized (sync) {
      while (sync.counter < numEntries) {
        LOG.debug("Entries counter = " + sync.counter);
        sync.wait();
      }
      assertEquals("Error adding",BKException.Code.OK,sync.getReturnCode());
    }
    try {
      lh.asyncAddEntry(bytes,-1,bytes.length,this,sync);
      fail("Shouldn't be able to use negative offset");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,0,bytes.length + 1,this,sync);
      fail("Shouldn't be able to use that much length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,-1,bytes.length + 2,this,sync);
      fail("Shouldn't be able to use negative offset " + "with that much length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,4,-3,this,sync);
      fail("Shouldn't be able to use negative length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,-4,-3,this,sync);
      fail("Shouldn't be able to use negative offset & length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
    lh=bkc.openLedger(ledgerId,digestType,ledgerPassword);
    LOG.debug("Number of entries written: " + (lh.getLastAddConfirmed() + 1));
    assertTrue("Verifying number of entries written",lh.getLastAddConfirmed() == (numEntries - 1));
    lh.asyncReadEntries(0,numEntries - 1,this,sync);
synchronized (sync) {
      while (sync.value == false) {
        sync.wait();
      }
      assertEquals("Error reading",BKException.Code.OK,sync.getReturnCode());
    }
    LOG.debug("*** READ COMPLETE ***");
    int i=0;
    Enumeration<LedgerEntry> ls=sync.getLedgerEntries();
    while (ls.hasMoreElements()) {
      byte[] expected=null;
      byte[] entry=ls.nextElement().getEntry();
switch (i) {
case 0:
        expected=Arrays.copyOfRange(bytes,0,bytes.length);
      break;
case 1:
    expected=Arrays.copyOfRange(bytes,0,4);
  break;
case 2:
expected=Arrays.copyOfRange(bytes,3,3 + 4);
break;
case 3:
expected=Arrays.copyOfRange(bytes,3,3 + (bytes.length - 3));
break;
}
assertNotNull("There are more checks than writes",expected);
String message="Checking entry " + i + " for equality ["+ new String(entry,"UTF-8")+ ","+ new String(expected,"UTF-8")+ "]";
assertTrue(message,Arrays.equals(entry,expected));
i++;
}
assertTrue("Checking number of read entries",i == numEntries);
lh.close();
}
 catch (BKException e) {
LOG.error("Test failed",e);
fail("Test failed due to BookKeeper exception");
}
catch (InterruptedException e) {
LOG.error("Test failed",e);
fail("Test failed due to interruption");
}
}

</code></pre>

<br>
<pre class="type-2 type-4 type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
/** 
 * test the streaming api for reading and writing
 * @throws {@link IOException}
 */
@Test(timeout=60000) public void testStreamingClients() throws IOException, BKException, InterruptedException {
  lh=bkc.createLedger(digestType,ledgerPassword);
  String toWrite="we need to check for this string to match " + "and for the record mahadev is the best";
  LedgerOutputStream lout=new LedgerOutputStream(lh,1);
  byte[] b=toWrite.getBytes();
  lout.write(b);
  lout.close();
  long lId=lh.getId();
  lh.close();
  lh=bkc.openLedger(lId,digestType,ledgerPassword);
  LedgerInputStream lin=new LedgerInputStream(lh,1);
  byte[] bread=new byte[b.length];
  int read=0;
  while (read < b.length) {
    read=read + lin.read(bread,read,b.length);
  }
  String newString=new String(bread);
  assertTrue("these two should same",toWrite.equals(newString));
  lin.close();
  lh.close();
  lh=bkc.createLedger(digestType,ledgerPassword);
  lout=new LedgerOutputStream(lh);
  for (int i=0; i < b.length; i++) {
    lout.write(b[i]);
  }
  lout.close();
  lId=lh.getId();
  lh.close();
  lh=bkc.openLedger(lId,digestType,ledgerPassword);
  lin=new LedgerInputStream(lh);
  bread=new byte[b.length];
  read=0;
  while (read < b.length) {
    read=read + lin.read(bread,read,b.length);
  }
  newString=new String(bread);
  assertTrue("these two should be same ",toWrite.equals(newString));
  lin.close();
  lh.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.handlers.TestSubUnsubHandler </h4><pre class="type-3 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSuccessCase(){
  StubCallback<Void> callback=new StubCallback<Void>();
  sm.acquiredTopic(topic,callback,null);
  assertNull(ConcurrencyUtils.take(callback.queue).right());
  sh.handleRequestAtOwner(pubSubRequestPrototype,channel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  Set<TopicSubscriber> topicSubs=new HashSet<TopicSubscriber>();
  topicSubs.add(new TopicSubscriber(topic,subscriberId));
  assertEquals(topicSubs,subChannelMgr.channel2sub.get(channel));
  assertEquals(channel,subChannelMgr.sub2Channel.get(new TopicSubscriber(topic,subscriberId)));
  StartServingRequest startRequest=(StartServingRequest)dm.lastRequest.poll();
  assertEquals(channel,((ChannelEndPoint)startRequest.endPoint).getChannel());
  assertEquals(PipelineFilter.class,startRequest.filter.getClass());
  PipelineFilter pfilter=(PipelineFilter)(startRequest.filter);
  assertEquals(1,pfilter.size());
  assertEquals(AllToAllTopologyFilter.class,pfilter.getFirst().getClass());
  assertEquals(1,startRequest.seqIdToStartFrom.getLocalComponent());
  assertEquals(subscriberId,startRequest.subscriberId);
  assertEquals(topic,startRequest.topic);
  StubCallback<SubscriptionData> callback1=new StubCallback<SubscriptionData>();
  sm.serveSubscribeRequest(topic,SubscribeRequest.newBuilder(subRequestPrototype).setCreateOrAttach(CreateOrAttach.CREATE).build(),MessageSeqId.newBuilder().setLocalComponent(10).build(),callback1,null);
  assertEquals(PubSubException.ClientAlreadySubscribedException.class,ConcurrencyUtils.take(callback1.queue).right().getClass());
  WriteRecordingChannel dupChannel=new WriteRecordingChannel();
  sh.handleRequestAtOwner(pubSubRequestPrototype,dupChannel);
  assertEquals(StatusCode.TOPIC_BUSY,((PubSubResponse)dupChannel.getMessagesWritten().get(0)).getStatusCode());
  subChannelMgr.channelDisconnected(channel);
  dupChannel=new WriteRecordingChannel();
  sh.handleRequestAtOwner(pubSubRequestPrototype,dupChannel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)dupChannel.getMessagesWritten().get(0)).getStatusCode());
  channel=new WriteRecordingChannel();
  ush.handleRequestAtOwner(pubSubRequestPrototype,channel);
  assertEquals(StatusCode.MALFORMED_REQUEST,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  PubSubRequest unsubRequest=PubSubRequest.newBuilder(pubSubRequestPrototype).setUnsubscribeRequest(UnsubscribeRequest.newBuilder().setSubscriberId(subscriberId)).build();
  channel=new WriteRecordingChannel();
  dm.lastRequest.clear();
  ush.handleRequestAtOwner(unsubRequest,channel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  assertEquals(new TopicSubscriber(topic,subscriberId),dm.lastRequest.poll());
  StubCallback<SubscriptionData> callback2=new StubCallback<SubscriptionData>();
  sm.serveSubscribeRequest(topic,SubscribeRequest.newBuilder(subRequestPrototype).setCreateOrAttach(CreateOrAttach.ATTACH).build(),MessageSeqId.newBuilder().setLocalComponent(10).build(),callback2,null);
  assertEquals(PubSubException.ClientNotSubscribedException.class,ConcurrencyUtils.take(callback2.queue).right().getClass());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.meta.TestMetadataManager </h4><pre class="type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testPersistenceInfo() throws Exception {
  TopicPersistenceManager tpManager=metadataManagerFactory.newTopicPersistenceManager();
  ByteString topic=ByteString.copyFromUtf8("testPersistenceInfo");
  StubCallback<Versioned<LedgerRanges>> readCallback=new StubCallback<Versioned<LedgerRanges>>();
  StubCallback<Version> writeCallback=new StubCallback<Version>();
  StubCallback<Void> deleteCallback=new StubCallback<Void>();
  tpManager.writeTopicPersistenceInfo(topic,LedgerRanges.getDefaultInstance(),Version.NEW,writeCallback,null);
  Either<Version,PubSubException> res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v1=res.left();
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  Versioned<LedgerRanges> ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(ranges.getVersion()));
  Assert.assertEquals(LedgerRanges.getDefaultInstance(),ranges.getValue());
  LedgerRange lastRange=LedgerRange.newBuilder().setLedgerId(1).build();
  LedgerRanges.Builder builder=LedgerRanges.newBuilder();
  builder.addRanges(lastRange);
  LedgerRanges newRanges=builder.build();
  tpManager.writeTopicPersistenceInfo(topic,newRanges,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.TopicPersistenceInfoExistsException);
  tpManager.writeTopicPersistenceInfo(topic,newRanges,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v2=res.left();
  Assert.assertEquals(Version.Occurred.AFTER,v2.compare(v1));
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  lastRange=LedgerRange.newBuilder().setLedgerId(2).build();
  builder=LedgerRanges.newBuilder();
  builder.addRanges(lastRange);
  LedgerRanges newRanges2=builder.build();
  tpManager.writeTopicPersistenceInfo(topic,newRanges2,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.BadVersionException);
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  tpManager.deleteTopicPersistenceInfo(topic,v1,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.BadVersionException);
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  tpManager.deleteTopicPersistenceInfo(topic,v2,deleteCallback,null);
  Assert.assertEquals(null,deleteCallback.queue.take().right());
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  Assert.assertEquals(null,readCallback.queue.take().left());
  tpManager.deleteTopicPersistenceInfo(topic,Version.ANY,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.NoTopicPersistenceInfoException);
  tpManager.close();
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSubscriptionData() throws Exception {
  SubscriptionDataManager subManager=metadataManagerFactory.newSubscriptionDataManager();
  ByteString topic=ByteString.copyFromUtf8("testSubscriptionData");
  ByteString subid=ByteString.copyFromUtf8("mysub");
  final StubCallback<Version> callback=new StubCallback<Version>();
  StubCallback<Versioned<SubscriptionData>> readCallback=new StubCallback<Versioned<SubscriptionData>>();
  StubCallback<Map<ByteString,Versioned<SubscriptionData>>> subsCallback=new StubCallback<Map<ByteString,Versioned<SubscriptionData>>>();
  subManager.readSubscriptionData(topic,subid,readCallback,null);
  Either<Versioned<SubscriptionData>,PubSubException> readRes=readCallback.queue.take();
  Assert.assertEquals("Found inconsistent subscription state",null,readRes.left());
  Assert.assertEquals("Should not fail with PubSubException",null,readRes.right());
  subManager.readSubscriptions(topic,subsCallback,null);
  Either<Map<ByteString,Versioned<SubscriptionData>>,PubSubException> res=subsCallback.queue.take();
  Assert.assertEquals("Found more than 0 subscribers",0,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  if (subManager.isPartialUpdateSupported()) {
    subManager.updateSubscriptionData(topic,subid,SubscriptionData.getDefaultInstance(),Version.ANY,callback,null);
  }
 else {
    subManager.replaceSubscriptionData(topic,subid,SubscriptionData.getDefaultInstance(),Version.ANY,callback,null);
  }
  Assert.assertTrue("Should fail to update a non-existed subscriber with PubSubException",callback.queue.take().right() instanceof PubSubException.NoSubscriptionStateException);
  Callback<Void> voidCallback=new Callback<Void>(){
    @Override public void operationFinished(    Object ctx,    Void resultOfOperation){
      callback.operationFinished(ctx,null);
    }
    @Override public void operationFailed(    Object ctx,    PubSubException exception){
      callback.operationFailed(ctx,exception);
    }
  }
;
  subManager.deleteSubscriptionData(topic,subid,Version.ANY,voidCallback,null);
  Assert.assertTrue("Should fail to delete a non-existed subscriber with PubSubException",callback.queue.take().right() instanceof PubSubException.NoSubscriptionStateException);
  long seqId=10;
  MessageSeqId.Builder builder=MessageSeqId.newBuilder();
  builder.setLocalComponent(seqId);
  MessageSeqId msgId=builder.build();
  SubscriptionState.Builder stateBuilder=SubscriptionState.newBuilder(SubscriptionState.getDefaultInstance()).setMsgId(msgId);
  SubscriptionData data=SubscriptionData.newBuilder().setState(stateBuilder).build();
  subManager.createSubscriptionData(topic,subid,data,callback,null);
  Either<Version,PubSubException> cbResult=callback.queue.take();
  Version v1=cbResult.left();
  Assert.assertEquals("Should not fail with PubSubException",null,cbResult.right());
  subManager.readSubscriptions(topic,subsCallback,null);
  res=subsCallback.queue.take();
  Assert.assertEquals("Should find just 1 subscriber",1,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  Versioned<SubscriptionData> versionedSubData=res.left().get(subid);
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(versionedSubData.getVersion()));
  SubscriptionData imss=versionedSubData.getValue();
  Assert.assertEquals("Found inconsistent subscription state",data,imss);
  Assert.assertEquals("Found inconsistent last consumed seq id",seqId,imss.getState().getMsgId().getLocalComponent());
  seqId=99;
  builder=MessageSeqId.newBuilder();
  builder.setLocalComponent(seqId);
  msgId=builder.build();
  stateBuilder=SubscriptionState.newBuilder(data.getState()).setMsgId(msgId);
  data=SubscriptionData.newBuilder().setState(stateBuilder).build();
  if (subManager.isPartialUpdateSupported()) {
    subManager.updateSubscriptionData(topic,subid,data,versionedSubData.getVersion(),callback,null);
  }
 else {
    subManager.replaceSubscriptionData(topic,subid,data,versionedSubData.getVersion(),callback,null);
  }
  cbResult=callback.queue.take();
  Assert.assertEquals("Fail to update a subscription state",null,cbResult.right());
  Version v2=cbResult.left();
  subManager.readSubscriptionData(topic,subid,readCallback,null);
  Assert.assertEquals("Found inconsistent subscription state",data,readCallback.queue.take().left().getValue());
  subManager.readSubscriptions(topic,subsCallback,null);
  res=subsCallback.queue.take();
  Assert.assertEquals("Should find just 1 subscriber",1,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  versionedSubData=res.left().get(subid);
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(versionedSubData.getVersion()));
  imss=res.left().get(subid).getValue();
  Assert.assertEquals("Found inconsistent subscription state",data,imss);
  Assert.assertEquals("Found inconsistent last consumed seq id",seqId,imss.getState().getMsgId().getLocalComponent());
  if (subManager.isPartialUpdateSupported()) {
    subManager.updateSubscriptionData(topic,subid,data,v1,callback,null);
  }
 else {
    subManager.replaceSubscriptionData(topic,subid,data,v1,callback,null);
  }
  Assert.assertTrue(callback.queue.take().right() instanceof PubSubException.BadVersionException);
  subManager.deleteSubscriptionData(topic,subid,v1,voidCallback,null);
  Assert.assertTrue(callback.queue.take().right() instanceof PubSubException.BadVersionException);
  subManager.deleteSubscriptionData(topic,subid,res.left().get(subid).getVersion(),voidCallback,null);
  Assert.assertEquals("Fail to delete an existed subscriber",null,callback.queue.take().right());
  subManager.readSubscriptions(topic,subsCallback,null);
  res=subsCallback.queue.take();
  Assert.assertEquals("Found more than 0 subscribers",0,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  subManager.close();
}

</code></pre>

<br>
<pre class="type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testOwnerInfo() throws Exception {
  TopicOwnershipManager toManager=metadataManagerFactory.newTopicOwnershipManager();
  ByteString topic=ByteString.copyFromUtf8("testOwnerInfo");
  StubCallback<Versioned<HubInfo>> readCallback=new StubCallback<Versioned<HubInfo>>();
  StubCallback<Version> writeCallback=new StubCallback<Version>();
  StubCallback<Void> deleteCallback=new StubCallback<Void>();
  Either<Version,PubSubException> res;
  HubInfo owner=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),999);
  toManager.writeOwnerInfo(topic,owner,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v1=res.left();
  toManager.readOwnerInfo(topic,readCallback,null);
  Versioned<HubInfo> hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(hubInfo.getVersion()));
  Assert.assertEquals(owner,hubInfo.getValue());
  HubInfo newOwner=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),1000);
  toManager.writeOwnerInfo(topic,newOwner,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.TopicOwnerInfoExistsException);
  toManager.writeOwnerInfo(topic,newOwner,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v2=res.left();
  Assert.assertEquals(Version.Occurred.AFTER,v2.compare(v1));
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  Assert.assertEquals(newOwner,hubInfo.getValue());
  HubInfo newOwner2=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),1001);
  toManager.writeOwnerInfo(topic,newOwner2,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.BadVersionException);
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  Assert.assertEquals(newOwner,hubInfo.getValue());
  toManager.deleteOwnerInfo(topic,v1,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.BadVersionException);
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  toManager.deleteOwnerInfo(topic,v2,deleteCallback,null);
  Assert.assertEquals(null,deleteCallback.queue.take().right());
  toManager.readOwnerInfo(topic,readCallback,null);
  Assert.assertEquals(null,readCallback.queue.take().left());
  toManager.deleteOwnerInfo(topic,Version.ANY,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.NoTopicOwnerInfoException);
  toManager.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.TestBookkeeperPersistenceManagerWhiteBox </h4><pre class="type-3 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testChangeLedgerFailure() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  ChangeLedgerCallback persistCallback=new ChangeLedgerCallback(1,NUM_MESSAGES_TO_TEST);
  for (  Message message : messages) {
    bkpm.persistMessage(new PersistRequest(topic,message,persistCallback,null));
  }
  assertEquals(maxEntriesPerLedger + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
  assertEquals(maxEntriesPerLedger,persistCallback.numSuccess);
  assertEquals(NUM_MESSAGES_TO_TEST - maxEntriesPerLedger,persistCallback.numFailed);
}

</code></pre>

<br>
<pre class="type-2 type-11 type-6 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncChangeLedgers() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  int index=0;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  while (index < messages.size()) {
    logger.debug("Persist message {}",(index + 1));
    StubCallback<MessageSeqId> persistCallback=new StubCallback<MessageSeqId>();
    bkpm.persistMessage(new PersistRequest(topic,messages.get(index),persistCallback,null));
    assertEquals(index + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
    index++;
    if (index % maxEntriesPerLedger == 1) {
      assertEquals(index / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
    }
  }
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Message scannedMessage=ConcurrencyUtils.take(scanCallback.queue).left();
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
  bkpm.topicInfos.clear();
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger + 1,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testNonEmptyDirtyLedger() throws Exception {
  Random r=new Random();
  int NUM_MESSAGES_TO_TEST=100;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  int index=0;
  int numPrevLedgers=0;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  while (index < messages.size()) {
    StubCallback<Void> stubCallback=new StubCallback<Void>();
    bkpm.acquiredTopic(topic,stubCallback,null);
    assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
    assertEquals(numPrevLedgers,bkpm.topicInfos.get(topic).ledgerRanges.size());
    StubCallback<PubSubProtocol.MessageSeqId> persistCallback=new StubCallback<PubSubProtocol.MessageSeqId>();
    bkpm.persistMessage(new PersistRequest(topic,messages.get(index),persistCallback,null));
    assertEquals(index + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
    index++;
    if (r.nextInt(10) == 9) {
      if (index < messages.size()) {
        bkpm.topicInfos.clear();
        numPrevLedgers++;
      }
    }
  }
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Message scannedMessage=ConcurrencyUtils.take(scanCallback.queue).left();
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAsyncChangeLedgers() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  OrderCheckingCallback persistCallback=new OrderCheckingCallback(1,NUM_MESSAGES_TO_TEST);
  for (  Message message : messages) {
    bkpm.persistMessage(new PersistRequest(topic,message,persistCallback,null));
  }
  assertEquals(NUM_MESSAGES_TO_TEST + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
  assertEquals(NUM_MESSAGES_TO_TEST,persistCallback.numSuccess);
  assertEquals(0,persistCallback.numFailed);
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Either<Message,Exception> e=ConcurrencyUtils.take(scanCallback.queue);
    Message scannedMessage=e.left();
    if (scannedMessage == null) {
      throw e.right();
    }
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
  bkpm.topicInfos.clear();
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger + 1,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.TestReadAheadCacheWhiteBox </h4><pre class="type-2 type-3 type-4 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAddMessageToCache(){
  CacheKey key=new CacheKey(topic,1);
  cacheBasedPersistenceManager.addMessageToCache(key,messages.get(0),MathUtils.now());
  assertEquals(1,cacheBasedPersistenceManager.cache.size());
  assertEquals(MSG_SIZE,cacheBasedPersistenceManager.presentCacheSize.get());
  assertEquals(1,cacheBasedPersistenceManager.orderedIndexOnSeqId.get(topic).size());
  assertTrue(cacheBasedPersistenceManager.orderedIndexOnSeqId.get(topic).contains(1L));
  CacheValue value=cacheBasedPersistenceManager.cache.get(key);
  assertTrue(cacheBasedPersistenceManager.cacheSegment.get().timeIndexOfAddition.get(value.timeOfAddition).contains(key));
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
