<h3><span class=" glyphicon glyphicon-tag"/>&nbspEqualityVerifier</h3><kbd>Verifies whether objects/variable are equal to an expected value </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.BookieInitializationTest </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify the bookie server exit code. On ZooKeeper exception, should return
 * exit code ZK_REG_FAIL = 4
 */
@Test(timeout=20000) public void testExitCodeZK_REG_FAIL() throws Exception {
  File tmpDir=createTempDir("bookie","test");
  final ServerConfiguration conf=TestBKConfiguration.newServerConfiguration().setZkServers(null).setJournalDirName(tmpDir.getPath()).setLedgerDirNames(new String[]{tmpDir.getPath()});
  BookieServer bkServer=new BookieServer(conf){
    protected Bookie newBookie(    ServerConfiguration conf) throws IOException, KeeperException, InterruptedException, BookieException {
      MockBookie bookie=new MockBookie(conf);
      bookie.zk=zkc;
      zkc.close();
      return bookie;
    }
  }
;
  bkServer.start();
  bkServer.join();
  Assert.assertEquals("Failed to return ExitCode.ZK_REG_FAIL",ExitCode.ZK_REG_FAIL,bkServer.getExitCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.BookieJournalTest </h4><pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that if the bookie crashes in the middle of writing
 * the actual entry it can recover.
 * In this case the entry will be available, but it will corrupt.
 * This is ok, as the client will disregard the entry after looking
 * at its checksum.
 */
@Test(timeout=60000) public void testTruncatedInEntryJournal() throws Exception {
  File journalDir=createTempDir("bookie","journal");
  Bookie.checkDirectoryStructure(Bookie.getCurrentDirectory(journalDir));
  File ledgerDir=createTempDir("bookie","ledger");
  Bookie.checkDirectoryStructure(Bookie.getCurrentDirectory(ledgerDir));
  JournalChannel jc=writeV2Journal(Bookie.getCurrentDirectory(journalDir),100);
  ByteBuffer zeros=ByteBuffer.allocate(2048);
  jc.fc.position(jc.getBufferedChannel().position() - 0x300);
  jc.fc.write(zeros);
  jc.fc.force(false);
  writeIndexFileForLedger(Bookie.getCurrentDirectory(ledgerDir),1,"testPasswd".getBytes());
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration().setZkServers(null).setJournalDirName(journalDir.getPath()).setLedgerDirNames(new String[]{ledgerDir.getPath()});
  Bookie b=new Bookie(conf);
  b.readJournal();
  b.readEntry(1,99);
  ByteBuffer buf=b.readEntry(1,100);
  assertEquals("Ledger Id is wrong",buf.getLong(),1);
  assertEquals("Entry Id is wrong",buf.getLong(),100);
  assertEquals("Last confirmed is wrong",buf.getLong(),99);
  assertEquals("Length is wrong",buf.getLong(),100 * 1024);
  buf.getLong();
  boolean allX=true;
  for (int i=0; i < 1024; i++) {
    byte x=buf.get();
    allX=allX && x == (byte)'X';
  }
  assertFalse("Some of buffer should have been zeroed",allX);
  try {
    b.readEntry(1,101);
    fail("Shouldn't have found entry 101");
  }
 catch (  Bookie.NoEntryException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.CookieTest </h4><pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test write cookie multiple times.
 */
@Test(timeout=60000) public void testWriteToZooKeeper() throws Exception {
  String[] ledgerDirs=new String[]{newDirectory(),newDirectory(),newDirectory()};
  String journalDir=newDirectory();
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration().setZkServers(zkUtil.getZooKeeperConnectString()).setJournalDirName(journalDir).setLedgerDirNames(ledgerDirs).setBookiePort(bookiePort);
  Bookie b=new Bookie(conf);
  b.start();
  b.shutdown();
  Versioned<Cookie> zkCookie=Cookie.readFromZooKeeper(zkc,conf);
  Version version1=zkCookie.getVersion();
  Assert.assertTrue("Invalid type expected ZkVersion type",version1 instanceof ZkVersion);
  ZkVersion zkVersion1=(ZkVersion)version1;
  Cookie cookie=zkCookie.getValue();
  cookie.writeToZooKeeper(zkc,conf,version1);
  zkCookie=Cookie.readFromZooKeeper(zkc,conf);
  Version version2=zkCookie.getVersion();
  Assert.assertTrue("Invalid type expected ZkVersion type",version2 instanceof ZkVersion);
  ZkVersion zkVersion2=(ZkVersion)version2;
  Assert.assertEquals("Version mismatches!",zkVersion1.getZnodeVersion() + 1,zkVersion2.getZnodeVersion());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.EntryLogTest </h4><pre class="type-2 type-11 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testMissingLogId() throws Exception {
  File tmpDir=createTempDir("entryLogTest",".dir");
  File curDir=Bookie.getCurrentDirectory(tmpDir);
  Bookie.checkDirectoryStructure(curDir);
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration();
  conf.setLedgerDirNames(new String[]{tmpDir.toString()});
  Bookie bookie=new Bookie(conf);
  int numLogs=3;
  int numEntries=10;
  long[][] positions=new long[2 * numLogs][];
  for (int i=0; i < numLogs; i++) {
    positions[i]=new long[numEntries];
    EntryLogger logger=new EntryLogger(conf,bookie.getLedgerDirsManager());
    for (int j=0; j < numEntries; j++) {
      positions[i][j]=logger.addEntry(i,generateEntry(i,j));
    }
    logger.flush();
  }
  File lastLogId=new File(curDir,"lastId");
  lastLogId.delete();
  for (int i=numLogs; i < 2 * numLogs; i++) {
    positions[i]=new long[numEntries];
    EntryLogger logger=new EntryLogger(conf,bookie.getLedgerDirsManager());
    for (int j=0; j < numEntries; j++) {
      positions[i][j]=logger.addEntry(i,generateEntry(i,j));
    }
    logger.flush();
  }
  EntryLogger newLogger=new EntryLogger(conf,bookie.getLedgerDirsManager());
  for (int i=0; i < (2 * numLogs + 1); i++) {
    File logFile=new File(curDir,Long.toHexString(i) + ".log");
    assertTrue(logFile.exists());
  }
  for (int i=0; i < 2 * numLogs; i++) {
    for (int j=0; j < numEntries; j++) {
      String expectedValue="ledger-" + i + "-"+ j;
      byte[] value=newLogger.readEntry(i,j,positions[i][j]);
      ByteBuffer buf=ByteBuffer.wrap(value);
      long ledgerId=buf.getLong();
      long entryId=buf.getLong();
      byte[] data=new byte[buf.remaining()];
      buf.get(data);
      assertEquals(i,ledgerId);
      assertEquals(j,entryId);
      assertEquals(expectedValue,new String(data));
    }
  }
}

</code></pre>

<br>
<pre class="type-8 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testEntryLoggerShouldThrowFNFEIfDirectoriesDoesNotExist() throws Exception {
  File tmpDir=createTempDir("bkTest",".dir");
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration();
  conf.setLedgerDirNames(new String[]{tmpDir.toString()});
  EntryLogger entryLogger=null;
  try {
    entryLogger=new EntryLogger(conf,new LedgerDirsManager(conf,conf.getLedgerDirs()));
    fail("Expecting FileNotFoundException");
  }
 catch (  FileNotFoundException e) {
    assertEquals("Entry log directory does not exist",e.getLocalizedMessage());
  }
 finally {
    if (entryLogger != null) {
      entryLogger.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.IndexCorruptionTest </h4><pre class="type-2 type-11 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testNoSuchLedger() throws Exception {
  LOG.debug("Testing NoSuchLedger");
  SyncThread syncThread=bs.get(0).getBookie().syncThread;
  syncThread.suspendSync();
  LedgerHandle lh=bkc.createLedger(1,1,digestType,"".getBytes());
  LedgerHandle newLh=bkc.openLedger(lh.getId(),digestType,"".getBytes());
  String dummyMsg="NoSuchLedger";
  int numMsgs=3;
  LedgerHandle wlh=bkc.createLedger(1,1,digestType,"".getBytes());
  for (int i=0; i < numMsgs; i++) {
    wlh.addEntry(dummyMsg.getBytes());
  }
  syncThread.resumeSync();
  Thread.sleep(2 * baseConf.getFlushInterval());
  restartBookies();
  Enumeration<LedgerEntry> seq=wlh.readEntries(0,numMsgs - 1);
  assertTrue("Enumeration of ledger entries has no element",seq.hasMoreElements() == true);
  int entryId=0;
  while (seq.hasMoreElements()) {
    LedgerEntry e=seq.nextElement();
    assertEquals(entryId,e.getEntryId());
    Assert.assertArrayEquals(dummyMsg.getBytes(),e.getEntry());
    ++entryId;
  }
  assertEquals(entryId,numMsgs);
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testEmptyIndexPage() throws Exception {
  LOG.debug("Testing EmptyIndexPage");
  SyncThread syncThread=bs.get(0).getBookie().syncThread;
  assertNotNull("Not found SyncThread.",syncThread);
  syncThread.suspendSync();
  LedgerHandle lh1=bkc.createLedger(1,1,digestType,"".getBytes());
  String dummyMsg="NoSuchLedger";
  int numMsgs=2 * pageSize / 8;
  LedgerHandle lh2=bkc.createLedger(1,1,digestType,"".getBytes());
  for (int i=0; i < numMsgs; i++) {
    lh2.addEntry(dummyMsg.getBytes());
  }
  syncThread.resumeSync();
  Thread.sleep(2 * baseConf.getFlushInterval());
  syncThread.suspendSync();
  LedgerHandle newLh1=bkc.openLedger(lh1.getId(),digestType,"".getBytes());
  for (int i=0; i < 3; i++) {
    lh2.addEntry(dummyMsg.getBytes());
  }
  syncThread.resumeSync();
  Thread.sleep(2 * baseConf.getFlushInterval());
  restartBookies();
  numMsgs+=3;
  Enumeration<LedgerEntry> seq=lh2.readEntries(0,numMsgs - 1);
  assertTrue("Enumeration of ledger entries has no element",seq.hasMoreElements() == true);
  int entryId=0;
  while (seq.hasMoreElements()) {
    LedgerEntry e=seq.nextElement();
    assertEquals(entryId,e.getEntryId());
    Assert.assertArrayEquals(dummyMsg.getBytes(),e.getEntry());
    ++entryId;
  }
  assertEquals(entryId,numMsgs);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.LedgerCacheTest </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Race where a flush would fail because a garbage collection occurred at
 * the wrong time.{@link https://issues.apache.org/jira/browse/BOOKKEEPER-604}
 */
@Test(timeout=60000) public void testFlushDeleteRace() throws Exception {
  newLedgerCache();
  final AtomicInteger rc=new AtomicInteger(0);
  final LinkedBlockingQueue<Long> ledgerQ=new LinkedBlockingQueue<Long>(1);
  final byte[] masterKey="masterKey".getBytes();
  Thread newLedgerThread=new Thread(){
    public void run(){
      try {
        for (int i=0; i < 1000 && rc.get() == 0; i++) {
          ledgerCache.setMasterKey(i,masterKey);
          ledgerQ.put((long)i);
        }
      }
 catch (      Exception e) {
        rc.set(-1);
        LOG.error("Exception in new ledger thread",e);
      }
    }
  }
;
  newLedgerThread.start();
  Thread flushThread=new Thread(){
    public void run(){
      try {
        while (true) {
          Long id=ledgerQ.peek();
          if (id == null) {
            continue;
          }
          LOG.info("Put entry for {}",id);
          try {
            ledgerCache.putEntryOffset((long)id,1,0);
          }
 catch (          Bookie.NoLedgerException nle) {
          }
          ledgerCache.flushLedger(true);
        }
      }
 catch (      Exception e) {
        rc.set(-1);
        LOG.error("Exception in flush thread",e);
      }
    }
  }
;
  flushThread.start();
  Thread deleteThread=new Thread(){
    public void run(){
      try {
        while (true) {
          long id=ledgerQ.take();
          LOG.info("Deleting {}",id);
          ledgerCache.deleteLedger(id);
        }
      }
 catch (      Exception e) {
        rc.set(-1);
        LOG.error("Exception in delete thread",e);
      }
    }
  }
;
  deleteThread.start();
  newLedgerThread.join();
  assertEquals("Should have been no errors",rc.get(),0);
  deleteThread.interrupt();
  flushThread.interrupt();
}

</code></pre>

<br>
<pre class="type-11 type-8 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that if we are writing to more ledgers than there
 * are pages, then we will not flush the index before the
 * entries in the entrylogger have been persisted to disk.{@link https://issues.apache.org/jira/browse/BOOKKEEPER-447}
 */
@Test(timeout=30000) public void testIndexPageEvictionWriteOrder() throws Exception {
  final int numLedgers=10;
  File journalDir=createTempDir("bookie","journal");
  Bookie.checkDirectoryStructure(Bookie.getCurrentDirectory(journalDir));
  File ledgerDir=createTempDir("bookie","ledger");
  Bookie.checkDirectoryStructure(Bookie.getCurrentDirectory(ledgerDir));
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration().setZkServers(null).setJournalDirName(journalDir.getPath()).setLedgerDirNames(new String[]{ledgerDir.getPath()}).setFlushInterval(1000).setPageLimit(1).setSortedLedgerStorageEnabled(false);
  Bookie b=new Bookie(conf);
  b.start();
  for (int i=1; i <= numLedgers; i++) {
    ByteBuffer packet=generateEntry(i,1);
    b.addEntry(packet,new Bookie.NopWriteCallback(),null,"passwd".getBytes());
  }
  conf=TestBKConfiguration.newServerConfiguration().setZkServers(null).setJournalDirName(journalDir.getPath()).setLedgerDirNames(new String[]{ledgerDir.getPath()});
  b=new Bookie(conf);
  for (int i=1; i <= numLedgers; i++) {
    try {
      b.readEntry(i,1);
    }
 catch (    Bookie.NoLedgerException nle) {
      assertEquals("No ledger should only happen for the last ledger",i,numLedgers);
    }
catch (    Bookie.NoEntryException nee) {
    }
catch (    IOException ioe) {
      LOG.info("Shouldn't have received IOException",ioe);
      fail("Shouldn't throw IOException, should say that entry is not found");
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test Ledger Cache flush failure
 */
@Test(timeout=30000) public void testLedgerCacheFlushFailureOnDiskFull() throws Exception {
  File ledgerDir1=createTempDir("bkTest",".dir");
  File ledgerDir2=createTempDir("bkTest",".dir");
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration();
  conf.setLedgerDirNames(new String[]{ledgerDir1.getAbsolutePath(),ledgerDir2.getAbsolutePath()});
  Bookie bookie=new Bookie(conf);
  InterleavedLedgerStorage ledgerStorage=((InterleavedLedgerStorage)bookie.ledgerStorage);
  LedgerCacheImpl ledgerCache=(LedgerCacheImpl)ledgerStorage.ledgerCache;
  ledgerStorage.setMasterKey(1,"key".getBytes());
  FileInfo fileInfo=ledgerCache.getIndexPersistenceManager().getFileInfo(Long.valueOf(1),null);
  FileInfo newFileInfo=new FileInfo(fileInfo.getLf(),fileInfo.getMasterKey());
  ledgerCache.getIndexPersistenceManager().fileInfoCache.put(Long.valueOf(1),newFileInfo);
  ledgerStorage.addEntry(generateEntry(1,1));
  ledgerStorage.addEntry(generateEntry(1,2));
  ledgerStorage.flush();
  ledgerStorage.addEntry(generateEntry(1,3));
  bookie.getIndexDirsManager().addToFilledDirs(newFileInfo.getLf().getParentFile().getParentFile().getParentFile());
  File before=newFileInfo.getLf();
  ledgerStorage.flush();
  File after=newFileInfo.getLf();
  assertEquals("Reference counting for the file info should be zero.",0,newFileInfo.getUseCount());
  assertFalse("After flush index file should be changed",before.equals(after));
  Assert.assertArrayEquals(generateEntry(1,1).array(),ledgerStorage.getEntry(1,1).array());
  Assert.assertArrayEquals(generateEntry(1,2).array(),ledgerStorage.getEntry(1,2).array());
  Assert.assertArrayEquals(generateEntry(1,3).array(),ledgerStorage.getEntry(1,3).array());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.TestLedgerDirsManager </h4><pre class="type-8 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testNoWritableDir() throws Exception {
  try {
    dirsManager.addToFilledDirs(curDir);
    dirsManager.pickRandomWritableDir();
    fail("Should not reach here due to there is no writable ledger dir.");
  }
 catch (  NoWritableLedgerDirException nwlde) {
    assertEquals("Should got NoWritableLedgerDirException w/ 'All ledger directories are non writable'.","All ledger directories are non writable",nwlde.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.TestSyncThread </h4><pre class="type-2 type-11 type-6 type-8 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that sync thread suspension works.
 * i.e. when we suspend the syncthread, nothing
 * will be synced.
 */
@Test(timeout=60000) public void testSyncThreadSuspension() throws Exception {
  int flushInterval=100;
  ServerConfiguration conf=TestBKConfiguration.newServerConfiguration();
  CheckpointSource checkpointSource=new DummyCheckpointSource();
  LedgerDirsListener listener=new DummyLedgerDirsListener();
  final AtomicInteger checkpointCount=new AtomicInteger(0);
  LedgerStorage storage=new DummyLedgerStorage(){
    @Override public Checkpoint checkpoint(    Checkpoint checkpoint) throws IOException {
      checkpointCount.incrementAndGet();
      return checkpoint;
    }
  }
;
  final SyncThread t=new SyncThread(conf,listener,storage,checkpointSource);
  t.start();
  while (checkpointCount.get() == 0) {
    Thread.sleep(flushInterval);
  }
  t.suspendSync();
  Thread.sleep(flushInterval);
  int count=checkpointCount.get();
  for (int i=0; i < 10; i++) {
    assertEquals("Checkpoint count shouldn't change",count,checkpointCount.get());
  }
  t.resumeSync();
  int i=0;
  while (checkpointCount.get() == count) {
    Thread.sleep(flushInterval);
    i++;
    if (i > 100) {
      fail("Checkpointing never resumed");
    }
  }
  t.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.bookie.UpdateCookieCmdTest </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWhenNoCookieExists() throws Exception {
  ServerConfiguration conf=bsConfs.get(0);
  BookieServer bks=bs.get(0);
  bks.shutdown();
  String zkCookiePath=Cookie.getZkPath(conf);
  Assert.assertNotNull("Cookie path doesn't still exists!",zkc.exists(zkCookiePath,false));
  zkc.delete(zkCookiePath,-1);
  Assert.assertNull("Cookie path still exists!",zkc.exists(zkCookiePath,false));
  BookieShell bkShell=new BookieShell();
  conf.setUseHostNameAsBookieID(true);
  bkShell.setConf(conf);
  String[] argv=new String[]{"updatecookie","-b","hostname"};
  Assert.assertEquals("Failed to return the error code!",-1,bkShell.run(argv));
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * During first updatecookie it successfully created the hostname cookie but
 * it fails to delete the old ipaddress cookie. Here user will issue
 * updatecookie again, now it should be able to delete the old cookie
 * gracefully.
 */
@Test public void testWhenBothIPaddressAndHostNameCookiesExists() throws Exception {
  updateCookie("-b","hostname",true);
  ServerConfiguration conf=bsConfs.get(0);
  conf.setUseHostNameAsBookieID(true);
  Cookie cookie=Cookie.readFromZooKeeper(zkc,conf).getValue();
  Cookie.Builder cookieBuilder=Cookie.newBuilder(cookie);
  conf.setUseHostNameAsBookieID(false);
  final String newBookieHost=Bookie.getBookieAddress(conf).toString();
  cookieBuilder.setBookieHost(newBookieHost);
  cookieBuilder.build().writeToZooKeeper(zkc,conf,Version.NEW);
  verifyCookieInZooKeeper(conf,2);
  BookieShell bkShell=new BookieShell();
  conf.setUseHostNameAsBookieID(true);
  bkShell.setConf(conf);
  String[] argv=new String[]{"updatecookie","-b","hostname"};
  Assert.assertEquals("Failed to return the error code!",0,bkShell.run(argv));
  conf.setUseHostNameAsBookieID(true);
  cookie=Cookie.readFromZooKeeper(zkc,conf).getValue();
  Assert.assertFalse("Cookie has created with IP!",cookie.isBookieHostCreatedFromIp());
  verifyCookieInZooKeeper(conf,1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.BookKeeperCloseTest </h4><pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that createledger using bookkeeper client which is closed should
 * throw ClientClosedException
 */
@Test(timeout=60000) public void testCreateLedger() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Closing bookkeeper client");
  bk.close();
  try {
    bk.createLedger(digestType,PASSWORD.getBytes());
    fail("should have failed, client is closed");
  }
 catch (  BKClientClosedException e) {
  }
  final AtomicInteger returnCode=new AtomicInteger(0);
  final CountDownLatch openLatch=new CountDownLatch(1);
  CreateCallback cb=new CreateCallback(){
    @Override public void createComplete(    int rc,    LedgerHandle lh,    Object ctx){
      returnCode.set(rc);
      openLatch.countDown();
    }
  }
;
  bk.asyncCreateLedger(3,2,digestType,PASSWORD.getBytes(),cb,openLatch);
  LOG.info("Waiting to finish the ledger creation");
  assertTrue("create ledger call should have completed",openLatch.await(20,TimeUnit.SECONDS));
  assertEquals("Succesfully created ledger through closed bkclient!",BKException.Code.ClientClosedException,returnCode.get());
}

</code></pre>

<br>
<pre class="type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that BookKeeperAdmin operationg using a closed BK client will
 * throw a ClientClosedException
 */
@Test(timeout=60000) public void testBookKeeperAdmin() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  BookKeeperAdmin bkadmin=new BookKeeperAdmin(bk);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh1=createLedgerWithEntries(bk,100);
  LedgerHandle lh2=createLedgerWithEntries(bk,100);
  LedgerHandle lh3=createLedgerWithEntries(bk,100);
  lh3.close();
  BookieSocketAddress bookieToKill=getBookie(0);
  killBookie(bookieToKill);
  startNewBookie();
  BookieSocketAddress newBookie=getBookie(2);
  CheckerCb checkercb=new CheckerCb();
  LedgerChecker lc=new LedgerChecker(bk);
  lc.checkLedger(lh3,checkercb);
  assertEquals("Should have completed",checkercb.getRc(30,TimeUnit.SECONDS),BKException.Code.OK);
  assertEquals("Should have a missing fragment",1,checkercb.getResult(30,TimeUnit.SECONDS).size());
  restartBookieSlow();
  restartBookieSlow();
  bk.close();
  try {
    bkadmin.openLedger(lh1.getId());
    fail("Shouldn't be able to open with a closed client");
  }
 catch (  BKException.BKClientClosedException cce) {
  }
  try {
    bkadmin.openLedgerNoRecovery(lh1.getId());
    fail("Shouldn't be able to open with a closed client");
  }
 catch (  BKException.BKClientClosedException cce) {
  }
  try {
    bkadmin.recoverBookieData(bookieToKill,newBookie);
    fail("Shouldn't be able to recover with a closed client");
  }
 catch (  BKException.BKClientClosedException cce) {
  }
  try {
    bkadmin.replicateLedgerFragment(lh3,checkercb.getResult(10,TimeUnit.SECONDS).iterator().next(),newBookie);
    fail("Shouldn't be able to replicate with a closed client");
  }
 catch (  BKException.BKClientClosedException cce) {
  }
}

</code></pre>

<br>
<pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adding entry to a ledger using bookkeeper client which is
 * closed should throw ClientClosedException
 */
@Test(timeout=60000) public void testAddLedgerEntry() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh=createLedgerWithEntries(bk,1);
  LOG.info("Closing bookkeeper client");
  restartBookieSlow();
  bk.close();
  try {
    lh.addEntry("foobar".getBytes());
    fail("should have failed, client is closed");
  }
 catch (  BKClientClosedException e) {
  }
  final CountDownLatch completeLatch=new CountDownLatch(1);
  final AtomicInteger rc=new AtomicInteger(BKException.Code.OK);
  lh.asyncAddEntry("foobar".getBytes(),new AddCallback(){
    public void addComplete(    int rccb,    LedgerHandle lh,    long entryId,    Object ctx){
      rc.set(rccb);
      completeLatch.countDown();
    }
  }
,null);
  LOG.info("Waiting to finish adding another entry asynchronously");
  assertTrue("Add entry to ledger call should have completed",completeLatch.await(20,TimeUnit.SECONDS));
  assertEquals("Add entry to ledger should not have succeeded through closed bkclient!",BKException.Code.ClientClosedException,rc.get());
}

</code></pre>

<br>
<pre class="type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that checking a ledger using a closed BK client will
 * throw a ClientClosedException
 */
@Test(timeout=60000) public void testLedgerCheck() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh=createLedgerWithEntries(bk,100);
  LOG.info("Closing bookkeeper client");
  LedgerChecker lc=new LedgerChecker(bk);
  restartBookieSlow();
  bk.close();
  final CountDownLatch postLatch=new CountDownLatch(1);
  final AtomicInteger postRc=new AtomicInteger(BKException.Code.OK);
  lc.checkLedger(lh,new GenericCallback<Set<LedgerFragment>>(){
    @Override public void operationComplete(    int rc,    Set<LedgerFragment> result){
      postRc.set(rc);
      postLatch.countDown();
    }
  }
);
  assertTrue("checkLedger should have finished",postLatch.await(30,TimeUnit.SECONDS));
  assertEquals("Should have client closed exception",postRc.get(),BKException.Code.ClientClosedException);
}

</code></pre>

<br>
<pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that deleting a ledger using bookkeeper client which is closed
 * should throw ClientClosedException
 */
@Test(timeout=60000) public void testDeleteLedger() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh=createLedgerWithEntries(bk,100);
  LOG.info("Closing bookkeeper client");
  bk.close();
  try {
    bk.deleteLedger(lh.getId());
    fail("should have failed, client is closed");
  }
 catch (  BKClientClosedException e) {
  }
  final AtomicInteger returnCode=new AtomicInteger(0);
  final CountDownLatch openLatch=new CountDownLatch(1);
  AsyncCallback.DeleteCallback cb=new AsyncCallback.DeleteCallback(){
    public void deleteComplete(    int rc,    Object ctx){
      returnCode.set(rc);
      openLatch.countDown();
    }
  }
;
  bk.asyncDeleteLedger(lh.getId(),cb,openLatch);
  LOG.info("Waiting to delete the ledger asynchronously");
  assertTrue("Delete call should have completed",openLatch.await(20,TimeUnit.SECONDS));
  assertEquals("Delete should not have succeeded through closed bkclient!",BKException.Code.ClientClosedException,returnCode.get());
}

</code></pre>

<br>
<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that the bookkeeper client doesn't leave any threads hanging around.
 * See {@link https://issues.apache.org/jira/browse/BOOKKEEPER-804}
 */
@Test(timeout=60000) public void testBookKeeperCloseThreads() throws Exception {
  ThreadGroup group=new ThreadGroup("test-group");
  final SettableFuture<Void> future=SettableFuture.<Void>create();
  Thread t=new Thread(group,"TestThread"){
    @Override public void run(){
      try {
        BookKeeper bk=new BookKeeper(baseClientConf);
        LedgerHandle lh=bk.createLedger(BookKeeper.DigestType.CRC32,"passwd".getBytes());
        lh.addEntry("foobar".getBytes());
        lh.close();
        long id=lh.getId();
        lh=bk.openLedgerNoRecovery(id,BookKeeper.DigestType.CRC32,"passwd".getBytes());
        Enumeration<LedgerEntry> entries=lh.readEntries(0,0);
        lh.close();
        bk.close();
        future.set(null);
      }
 catch (      InterruptedException ie) {
        Thread.currentThread().interrupt();
        future.setException(ie);
      }
catch (      Exception e) {
        future.setException(e);
      }
    }
  }
;
  t.start();
  future.get();
  t.join();
  for (int i=0; i < 10; i++) {
    if (group.activeCount() > 0) {
      Thread[] threads=new Thread[group.activeCount()];
      group.enumerate(threads);
      for (      Thread leftover : threads) {
        LOG.error("Leftover thread after {} secs: {}",i,leftover);
      }
      Thread.sleep(1000);
    }
 else {
      break;
    }
  }
  assertEquals("Should be no threads left in group",0,group.activeCount());
}

</code></pre>

<br>
<pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that closing a ledger using bookkeeper client which is closed should
 * throw ClientClosedException
 */
@Test(timeout=60000) public void testCloseLedger() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh=createLedgerWithEntries(bk,100);
  LedgerHandle lh2=createLedgerWithEntries(bk,100);
  LOG.info("Closing bookkeeper client");
  bk.close();
  try {
    lh.close();
    fail("should have failed, client is closed");
  }
 catch (  BKClientClosedException e) {
  }
  final CountDownLatch completeLatch=new CountDownLatch(1);
  final AtomicInteger rc=new AtomicInteger(BKException.Code.OK);
  lh2.asyncClose(new CloseCallback(){
    public void closeComplete(    int rccb,    LedgerHandle lh,    Object ctx){
      rc.set(rccb);
      completeLatch.countDown();
    }
  }
,null);
  LOG.info("Waiting to finish adding another entry asynchronously");
  assertTrue("Close ledger call should have completed",completeLatch.await(20,TimeUnit.SECONDS));
  assertEquals("Close ledger should have succeeded through closed bkclient!",BKException.Code.ClientClosedException,rc.get());
}

</code></pre>

<br>
<pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that readlastconfirmed entry from a ledger using bookkeeper client
 * which is closed should throw ClientClosedException
 */
@Test(timeout=60000) public void testReadLastConfirmed() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh=createLedgerWithEntries(bk,100);
  LOG.info("Closing bookkeeper client");
  restartBookieSlow();
  restartBookieSlow();
  restartBookieSlow();
  bk.close();
  final CountDownLatch readLatch=new CountDownLatch(1);
  final AtomicInteger rc=new AtomicInteger(BKException.Code.OK);
  AsyncCallback.ReadLastConfirmedCallback cb=new AsyncCallback.ReadLastConfirmedCallback(){
    @Override public void readLastConfirmedComplete(    int rccb,    long lastConfirmed,    Object ctx){
      rc.set(rccb);
      readLatch.countDown();
    }
  }
;
  lh.asyncReadLastConfirmed(cb,readLatch);
  LOG.info("Waiting to finish reading last confirmed entry asynchronously");
  assertTrue("ReadLastConfirmed call should have completed",readLatch.await(20,TimeUnit.SECONDS));
  assertEquals("ReadLastConfirmed should have succeeded through closed bkclient!",BKException.Code.ClientClosedException,rc.get());
  try {
    lh.readLastConfirmed();
    fail("should have failed, client is closed");
  }
 catch (  BKClientClosedException e) {
  }
}

</code></pre>

<br>
<pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that reading entry from a ledger using bookkeeper client which is
 * closed should throw ClientClosedException
 */
@Test(timeout=60000) public void testReadLedgerEntry() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Create ledger and add entries to it");
  int numOfEntries=100;
  LedgerHandle lh=createLedgerWithEntries(bk,numOfEntries);
  LOG.info("Closing bookkeeper client");
  restartBookieSlow();
  bk.close();
  try {
    lh.readEntries(0,numOfEntries - 1);
    fail("should have failed, client is closed");
  }
 catch (  BKClientClosedException e) {
  }
  final CountDownLatch readLatch=new CountDownLatch(1);
  final AtomicInteger rc=new AtomicInteger(BKException.Code.OK);
  ReadCallback cb=new ReadCallback(){
    @Override public void readComplete(    int rccb,    LedgerHandle lh,    Enumeration<LedgerEntry> seq,    Object ctx){
      rc.set(rccb);
      readLatch.countDown();
    }
  }
;
  lh.asyncReadEntries(0,numOfEntries - 1,cb,readLatch);
  LOG.info("Waiting to finish reading the entries asynchronously");
  assertTrue("Read entry ledger call should have completed",readLatch.await(20,TimeUnit.SECONDS));
  assertEquals("Read entry ledger should have succeeded through closed bkclient!",BKException.Code.ClientClosedException,rc.get());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.BookieWriteLedgerTest </h4><pre class="type-2 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Skips few entries before closing the ledger and assert that the
 * lastAddConfirmed is right before our skipEntryId.
 * @throws Exception
 */
@Test(timeout=60000) public void testLedgerCreateAdvWithSkipEntries() throws Exception {
  long ledgerId;
  SyncObj syncObj1=new SyncObj();
  lh=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  ledgerId=lh.getId();
  LOG.info("Ledger ID: " + ledgerId);
  int skipEntryId=rng.nextInt(numEntriesToWrite - 1);
  for (int i=numEntriesToWrite - 1; i >= 0; i--) {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    try {
      entries1.add(0,entry.array());
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    if (i == skipEntryId) {
      LOG.info("Skipping entry:{}",skipEntryId);
      continue;
    }
    lh.asyncAddEntry(i,entry.array(),0,entry.capacity(),this,syncObj1);
  }
synchronized (syncObj1) {
    while (syncObj1.counter < skipEntryId) {
      syncObj1.wait();
    }
    assertEquals(BKException.Code.OK,syncObj1.rc);
  }
  lh.close();
  lh=bkc.openLedger(ledgerId,digestType,ledgerPassword);
  assertEquals(lh.lastAddConfirmed,skipEntryId - 1);
  lh.close();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify asynchronous writing when few bookie failures in last ensemble.
 */
@Test(timeout=60000) public void testAsyncWritesWithMultipleFailuresInLastEnsemble() throws Exception {
  lh=bkc.createLedger(5,4,digestType,ledgerPassword);
  lh2=bkc.createLedger(5,4,digestType,ledgerPassword);
  LOG.info("Ledger ID-1: " + lh.getId());
  LOG.info("Ledger ID-2: " + lh2.getId());
  for (int i=0; i < numEntriesToWrite; i++) {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    entries1.add(entry.array());
    entries2.add(entry.array());
    lh.addEntry(entry.array());
    lh2.addEntry(entry.array());
  }
  startNewBookie();
  startNewBookie();
  startNewBookie();
  ArrayList<BookieSocketAddress> ensemble=lh.getLedgerMetadata().getEnsembles().entrySet().iterator().next().getValue();
  killBookie(ensemble.get(0));
  killBookie(ensemble.get(1));
  killBookie(ensemble.get(2));
  numEntriesToWrite++;
  ByteBuffer entry=ByteBuffer.allocate(4);
  entry.putInt(rng.nextInt(maxInt));
  entry.position(0);
  entries1.add(entry.array());
  entries2.add(entry.array());
  SyncObj syncObj1=new SyncObj();
  SyncObj syncObj2=new SyncObj();
  lh.asyncAddEntry(entry.array(),this,syncObj1);
  lh2.asyncAddEntry(entry.array(),this,syncObj2);
synchronized (syncObj1) {
    while (syncObj1.counter < 1) {
      LOG.debug("Entries counter = " + syncObj1.counter);
      syncObj1.wait();
    }
    assertEquals(BKException.Code.OK,syncObj1.rc);
  }
synchronized (syncObj2) {
    while (syncObj2.counter < 1) {
      LOG.debug("Entries counter = " + syncObj2.counter);
      syncObj2.wait();
    }
    assertEquals(BKException.Code.OK,syncObj2.rc);
  }
  readEntries(lh,entries1);
  readEntries(lh2,entries2);
  lh.close();
  lh2.close();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify Advanced asynchronous writing with entryIds in reverse order
 */
@Test(timeout=60000) public void testLedgerCreateAdvWithAsyncWritesWithBookieFailures() throws Exception {
  lh=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  lh2=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  LOG.info("Ledger ID-1: " + lh.getId());
  LOG.info("Ledger ID-2: " + lh2.getId());
  SyncObj syncObj1=new SyncObj();
  SyncObj syncObj2=new SyncObj();
  for (int i=numEntriesToWrite - 1; i >= 0; i--) {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    try {
      entries1.add(0,entry.array());
      entries2.add(0,entry.array());
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    lh.asyncAddEntry(i,entry.array(),0,entry.capacity(),this,syncObj1);
    lh2.asyncAddEntry(i,entry.array(),0,entry.capacity(),this,syncObj2);
  }
  startNewBookie();
  ArrayList<BookieSocketAddress> ensemble=lh.getLedgerMetadata().getEnsembles().entrySet().iterator().next().getValue();
  killBookie(ensemble.get(0));
synchronized (syncObj1) {
    while (syncObj1.counter < numEntriesToWrite) {
      syncObj1.wait();
    }
    assertEquals(BKException.Code.OK,syncObj1.rc);
  }
synchronized (syncObj2) {
    while (syncObj2.counter < numEntriesToWrite) {
      syncObj2.wait();
    }
    assertEquals(BKException.Code.OK,syncObj2.rc);
  }
  readEntries(lh,entries1);
  readEntries(lh2,entries2);
  lh.close();
  lh2.close();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify Advanced asynchronous writing with entryIds in pseudo random order
 */
@Test(timeout=60000) public void testLedgerCreateAdvWithRandomAsyncWritesWithBookieFailures() throws Exception {
  lh=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  lh2=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  LOG.info("Ledger ID-1: " + lh.getId());
  LOG.info("Ledger ID-2: " + lh2.getId());
  SyncObj syncObj1=new SyncObj();
  SyncObj syncObj2=new SyncObj();
  int batchSize=5;
  int i, j;
  for (i=0; i < numEntriesToWrite; i++) {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    try {
      entries1.add(0,entry.array());
      entries2.add(0,entry.array());
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
  for (i=0; i < batchSize; i++) {
    for (j=i; j < numEntriesToWrite; j=j + batchSize) {
      byte[] entry1=entries1.get(j);
      byte[] entry2=entries2.get(j);
      lh.asyncAddEntry(j,entry1,0,entry1.length,this,syncObj1);
      lh2.asyncAddEntry(j,entry2,0,entry2.length,this,syncObj2);
    }
  }
  startNewBookie();
  ArrayList<BookieSocketAddress> ensemble=lh.getLedgerMetadata().getEnsembles().entrySet().iterator().next().getValue();
  killBookie(ensemble.get(0));
synchronized (syncObj1) {
    while (syncObj1.counter < numEntriesToWrite) {
      syncObj1.wait();
    }
    assertEquals(BKException.Code.OK,syncObj1.rc);
  }
synchronized (syncObj2) {
    while (syncObj2.counter < numEntriesToWrite) {
      syncObj2.wait();
    }
    assertEquals(BKException.Code.OK,syncObj2.rc);
  }
  readEntries(lh,entries1);
  readEntries(lh2,entries2);
  lh.close();
  lh2.close();
}

</code></pre>

<br>
<pre class="type-11 type-6 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify the functionality LedgerHandleAdv asyncAddEntry with duplicate
 * entryIds
 * @throws Exception
 */
@Test(timeout=60000) public void testLedgerCreateAdvSyncAsyncAddDuplicateEntryIds() throws Exception {
  long ledgerId;
  SyncObj syncObj1=new SyncObj();
  SyncObj syncObj2=new SyncObj();
  lh=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  ledgerId=lh.getId();
  LOG.info("Ledger ID: " + ledgerId);
  for (int i=numEntriesToWrite - 1; i >= 0; i--) {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    try {
      entries1.add(0,entry.array());
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    lh.asyncAddEntry(i,entry.array(),0,entry.capacity(),this,syncObj1);
    if (rng.nextBoolean()) {
      lh.asyncAddEntry(i,entry.array(),0,entry.capacity(),this,syncObj2);
synchronized (syncObj2) {
        while (syncObj2.counter < 1) {
          syncObj2.wait();
        }
        assertEquals(BKException.Code.DuplicateEntryIdException,syncObj2.rc);
      }
    }
  }
synchronized (syncObj1) {
    while (syncObj1.counter < numEntriesToWrite) {
      syncObj1.wait();
    }
    assertEquals(BKException.Code.OK,syncObj1.rc);
  }
  lh.close();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify Advanced asynchronous writing with entryIds in pseudo random order with bookie failures between writes
 */
@Test(timeout=60000) public void testLedgerCreateAdvWithRandomAsyncWritesWithBookieFailuresBetweenWrites() throws Exception {
  lh=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  lh2=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  LOG.info("Ledger ID-1: " + lh.getId());
  LOG.info("Ledger ID-2: " + lh2.getId());
  SyncObj syncObj1=new SyncObj();
  SyncObj syncObj2=new SyncObj();
  int batchSize=5;
  int i, j;
  for (i=0; i < numEntriesToWrite; i++) {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    try {
      entries1.add(0,entry.array());
      entries2.add(0,entry.array());
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
  for (i=0; i < batchSize; i++) {
    for (j=i; j < numEntriesToWrite; j=j + batchSize) {
      byte[] entry1=entries1.get(j);
      byte[] entry2=entries2.get(j);
      lh.asyncAddEntry(j,entry1,0,entry1.length,this,syncObj1);
      lh2.asyncAddEntry(j,entry2,0,entry2.length,this,syncObj2);
      if (j == numEntriesToWrite / 2) {
        startNewBookie();
        ArrayList<BookieSocketAddress> ensemble=lh.getLedgerMetadata().getEnsembles().entrySet().iterator().next().getValue();
        killBookie(ensemble.get(0));
      }
    }
  }
synchronized (syncObj1) {
    while (syncObj1.counter < numEntriesToWrite) {
      syncObj1.wait();
    }
    assertEquals(BKException.Code.OK,syncObj1.rc);
  }
synchronized (syncObj2) {
    while (syncObj2.counter < numEntriesToWrite) {
      syncObj2.wait();
    }
    assertEquals(BKException.Code.OK,syncObj2.rc);
  }
  readEntries(lh,entries1);
  readEntries(lh2,entries2);
  lh.close();
  lh2.close();
}

</code></pre>

<br>
<pre class="type-8 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the functionality LedgerHandleAdv addEntry with duplicate entryIds
 * @throws Exception
 */
@Test(timeout=60000) public void testLedgerCreateAdvSyncAddDuplicateEntryIds() throws Exception {
  lh=bkc.createLedgerAdv(5,3,2,digestType,ledgerPassword);
  LOG.info("Ledger ID: " + lh.getId());
  for (int i=0; i < numEntriesToWrite; i++) {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    entries1.add(entry.array());
    lh.addEntry(i,entry.array());
    entry.position(0);
  }
  readEntries(lh,entries1);
  int dupEntryId=rng.nextInt(numEntriesToWrite - 1);
  try {
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    lh.addEntry(dupEntryId,entry.array());
    fail("Expected exception not thrown");
  }
 catch (  BKException e) {
    assertEquals(e.getCode(),BKException.Code.DuplicateEntryIdException);
  }
  lh.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.LedgerCloseTest </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testLedgerCloseWithConsistentLength() throws Exception {
  ClientConfiguration conf=new ClientConfiguration();
  conf.setZkServers(zkUtil.getZooKeeperConnectString()).setReadTimeout(1);
  BookKeeper bkc=new BookKeeper(conf);
  LedgerHandle lh=bkc.createLedger(6,3,DigestType.CRC32,new byte[]{});
  final CountDownLatch latch=new CountDownLatch(1);
  stopBKCluster();
  final AtomicInteger i=new AtomicInteger(0xdeadbeef);
  AsyncCallback.AddCallback cb=new AsyncCallback.AddCallback(){
    @Override public void addComplete(    int rc,    LedgerHandle lh,    long entryId,    Object ctx){
      i.set(rc);
      latch.countDown();
    }
  }
;
  lh.asyncAddEntry("Test Entry".getBytes(),cb,null);
  latch.await();
  assertEquals(i.get(),BKException.Code.NotEnoughBookiesException);
  assertEquals(0,lh.getLength());
  assertEquals(LedgerHandle.INVALID_ENTRY_ID,lh.getLastAddConfirmed());
  startBKCluster();
  LedgerHandle newLh=bkc.openLedger(lh.getId(),DigestType.CRC32,new byte[]{});
  assertEquals(0,newLh.getLength());
  assertEquals(LedgerHandle.INVALID_ENTRY_ID,newLh.getLastAddConfirmed());
}

</code></pre>

<br>
<pre class="type-2 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testLedgerCheckerShouldnotSelectInvalidLastFragments() throws Exception {
  int numEntries=10;
  LedgerHandle lh=bkc.createLedger(3,3,3,digestType,"".getBytes());
  for (int i=0; i < numEntries; i++) {
    lh.addEntry("data".getBytes());
  }
  numEntries=4;
  verifyMetadataConsistency(numEntries,lh);
  LedgerChecker checker=new LedgerChecker(bkc);
  CheckerCallback cb=new CheckerCallback();
  checker.checkLedger(lh,cb);
  Set<LedgerFragment> result=cb.waitAndGetResult();
  assertEquals("No fragments should be selected",0,result.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.LedgerRecoveryTest </h4><pre class="type-2 type-6 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that it doesn't break the recovery when changing ensemble in
 * recovery add.
 */
@Test(timeout=60000) public void testEnsembleChangeDuringRecovery() throws Exception {
  LedgerHandle lh=bkc.createLedger(numBookies,2,2,digestType,"".getBytes());
  int numEntries=(numBookies * 3) + 1;
  final AtomicInteger numPendingAdds=new AtomicInteger(numEntries);
  final CountDownLatch addDone=new CountDownLatch(1);
  for (int i=0; i < numEntries; i++) {
    lh.asyncAddEntry("data".getBytes(),new AddCallback(){
      @Override public void addComplete(      int rc,      LedgerHandle lh,      long entryId,      Object ctx){
        if (BKException.Code.OK != rc) {
          addDone.countDown();
          return;
        }
        if (numPendingAdds.decrementAndGet() == 0) {
          addDone.countDown();
        }
      }
    }
,null);
  }
  addDone.await(10,TimeUnit.SECONDS);
  if (numPendingAdds.get() > 0) {
    fail("Failed to add " + numEntries + " to ledger handle "+ lh.getId());
  }
  BookieSocketAddress bookie1=lh.getLedgerMetadata().currentEnsemble.get(0);
  ServerConfiguration conf1=killBookie(bookie1);
  BookieSocketAddress bookie2=lh.getLedgerMetadata().currentEnsemble.get(1);
  ServerConfiguration conf2=killBookie(bookie2);
  startDeadBookie(conf1);
  startDeadBookie(conf2);
  startNewBookie();
  startNewBookie();
  LedgerHandle recoveredLh=bkc.openLedger(lh.getId(),digestType,"".getBytes());
  assertEquals("Fenced ledger should have correct lastAddConfirmed",lh.getLastAddConfirmed(),recoveredLh.getLastAddConfirmed());
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * {@link https://issues.apache.org/jira/browse/BOOKKEEPER-355}A recovery during a rolling restart shouldn't affect the ability
 * to recovery the ledger later.
 * We have a ledger on ensemble B1,B2,B3.
 * The sequence of events is
 * 1. B1 brought down for maintenance
 * 2. Ledger recovery started
 * 3. B2 answers read last confirmed.
 * 4. B1 replaced in ensemble by B4
 * 5. Write to B4 fails for some reason
 * 6. B1 comes back up.
 * 7. B2 goes down for maintenance.
 * 8. Ledger recovery starts (ledger is now unavailable)
 */
@Test(timeout=60000) public void testLedgerRecoveryWithRollingRestart() throws Exception {
  LedgerHandle lhbefore=bkc.createLedger(numBookies,2,digestType,"".getBytes());
  for (int i=0; i < (numBookies * 3) + 1; i++) {
    lhbefore.addEntry("data".getBytes());
  }
  ServerConfiguration conf=newServerConfiguration();
  Bookie deadBookie1=new Bookie(conf){
    @Override public void recoveryAddEntry(    ByteBuffer entry,    WriteCallback cb,    Object ctx,    byte[] masterKey) throws IOException, BookieException {
      throw new IOException("Couldn't write for some reason");
    }
  }
;
  bsConfs.add(conf);
  bs.add(startBookie(conf,deadBookie1));
  BookieSocketAddress bookie1=lhbefore.getLedgerMetadata().currentEnsemble.get(0);
  ServerConfiguration conf1=killBookie(bookie1);
  try {
    bkc.openLedger(lhbefore.getId(),digestType,"".getBytes());
    fail("Shouldn't be able to open ledger, there should be entries missing");
  }
 catch (  BKException.BKLedgerRecoveryException e) {
  }
  bsConfs.add(conf1);
  bs.add(startBookie(conf1));
  BookieSocketAddress bookie2=lhbefore.getLedgerMetadata().currentEnsemble.get(1);
  ServerConfiguration conf2=killBookie(bookie2);
  final AtomicInteger returnCode=new AtomicInteger(0);
  final CountDownLatch openLatch=new CountDownLatch(1);
  bkc.asyncOpenLedger(lhbefore.getId(),digestType,"".getBytes(),new AsyncCallback.OpenCallback(){
    public void openComplete(    int rc,    LedgerHandle lh,    Object ctx){
      returnCode.set(rc);
      openLatch.countDown();
      if (rc == BKException.Code.OK) {
        try {
          lh.close();
        }
 catch (        Exception e) {
          LOG.error("Exception closing ledger handle",e);
        }
      }
    }
  }
,null);
  assertTrue("Open call should have completed",openLatch.await(5,TimeUnit.SECONDS));
  assertFalse("Open should not have succeeded",returnCode.get() == BKException.Code.OK);
  bsConfs.add(conf2);
  bs.add(startBookie(conf2));
  LedgerHandle lhafter=bkc.openLedger(lhbefore.getId(),digestType,"".getBytes());
  assertEquals("Fenced ledger should have correct lastAddConfirmed",lhbefore.getLastAddConfirmed(),lhafter.getLastAddConfirmed());
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLedgerRecoveryWithNotEnoughBookies() throws Exception {
  int numEntries=3;
  LedgerHandle beforelh=null;
  beforelh=bkc.createLedger(3,3,digestType,"".getBytes());
  String tmp="BookKeeper is cool!";
  for (int i=0; i < numEntries; i++) {
    beforelh.addEntry(tmp.getBytes());
  }
  bs.get(0).shutdown();
  bs.remove(0);
  try {
    bkc.openLedger(beforelh.getId(),digestType,"".getBytes());
    fail("should not reach here!");
  }
 catch (  Exception e) {
  }
  startNewBookie();
  LedgerHandle afterlh=bkc.openLedger(beforelh.getId(),digestType,"".getBytes());
  assertEquals(numEntries - 1,afterlh.getLastAddConfirmed());
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * {@link https://issues.apache.org/jira/browse/BOOKKEEPER-355}Verify that if a recovery happens with 1 replica missing, and it's replaced
 * with a faulty bookie, it doesn't break future recovery from happening.
 * 1. Ledger is created with quorum size as 2, and entries are written
 * 2. Now first bookie is in the ensemble is brought down.
 * 3. Another client fence and trying to recover the same ledger
 * 4. During this time ensemble change will happen
 * and new bookie will be added. But this bookie is not able to write.
 * 5. This recovery will fail.
 * 7. A new non-faulty bookie comes up
 * 8. Another client trying to recover the same ledger.
 */
@Test(timeout=60000) public void testBookieFailureDuringRecovery() throws Exception {
  LedgerHandle lhbefore=bkc.createLedger(numBookies,2,digestType,"".getBytes());
  for (int i=0; i < (numBookies * 3) + 1; i++) {
    lhbefore.addEntry("data".getBytes());
  }
  ServerConfiguration conf=newServerConfiguration();
  Bookie deadBookie1=new Bookie(conf){
    @Override public void recoveryAddEntry(    ByteBuffer entry,    WriteCallback cb,    Object ctx,    byte[] masterKey) throws IOException, BookieException {
      throw new IOException("Couldn't write for some reason");
    }
  }
;
  bsConfs.add(conf);
  bs.add(startBookie(conf,deadBookie1));
  BookieSocketAddress bookie1=lhbefore.getLedgerMetadata().currentEnsemble.get(0);
  killBookie(bookie1);
  try {
    bkc.openLedger(lhbefore.getId(),digestType,"".getBytes());
    fail("Shouldn't be able to open ledger, there should be entries missing");
  }
 catch (  BKException.BKLedgerRecoveryException e) {
  }
  startNewBookie();
  LedgerHandle lhafter=bkc.openLedger(lhbefore.getId(),digestType,"".getBytes());
  assertEquals("Fenced ledger should have correct lastAddConfirmed",lhbefore.getLastAddConfirmed(),lhafter.getLastAddConfirmed());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.RoundRobinDistributionScheduleTest </h4><pre class="type-2 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that coverage sets only respond as covered when it has
 * heard from enough bookies that no ack quorum can exist without these bookies.
 */
@Test(timeout=60000) public void testCoverageSets(){
  int errors=0;
  for (int e=6; e > 0; e--) {
    for (int w=e; w > 0; w--) {
      for (int a=w; a > 0; a--) {
        errors+=testCoverageForConfiguration(e,w,a);
      }
    }
  }
  assertEquals("Should be no errors",0,errors);
}

</code></pre>

<br>
<pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testDistributionSchedule() throws Exception {
  RoundRobinDistributionSchedule schedule=new RoundRobinDistributionSchedule(3,2,5);
  List<Integer> wSet=schedule.getWriteSet(1);
  assertEquals("Write set is wrong size",wSet.size(),3);
  DistributionSchedule.AckSet ackSet=schedule.getAckSet();
  assertFalse("Shouldn't ack yet",ackSet.addBookieAndCheck(wSet.get(0)));
  assertFalse("Shouldn't ack yet",ackSet.addBookieAndCheck(wSet.get(0)));
  assertTrue("Should ack after 2 unique",ackSet.addBookieAndCheck(wSet.get(2)));
  assertTrue("Should still be acking",ackSet.addBookieAndCheck(wSet.get(1)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.SlowBookieTest </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testSlowBookie() throws Exception {
  ClientConfiguration conf=new ClientConfiguration();
  conf.setZkServers(zkUtil.getZooKeeperConnectString()).setReadTimeout(360);
  BookKeeper bkc=new BookKeeper(conf);
  LedgerHandle lh=bkc.createLedger(4,3,2,BookKeeper.DigestType.CRC32,new byte[]{});
  byte[] entry="Test Entry".getBytes();
  for (int i=0; i < 10; i++) {
    lh.addEntry(entry);
  }
  final CountDownLatch b0latch=new CountDownLatch(1);
  final CountDownLatch b1latch=new CountDownLatch(1);
  final CountDownLatch addEntrylatch=new CountDownLatch(1);
  List<BookieSocketAddress> curEns=lh.getLedgerMetadata().currentEnsemble;
  try {
    sleepBookie(curEns.get(0),b0latch);
    for (int i=0; i < 10; i++) {
      lh.addEntry(entry);
    }
    sleepBookie(curEns.get(2),b1latch);
    final AtomicInteger i=new AtomicInteger(0xdeadbeef);
    AsyncCallback.AddCallback cb=new AsyncCallback.AddCallback(){
      public void addComplete(      int rc,      LedgerHandle lh,      long entryId,      Object ctx){
        i.set(rc);
        addEntrylatch.countDown();
      }
    }
;
    lh.asyncAddEntry(entry,cb,null);
    Thread.sleep(3000);
    assertEquals("Successfully added entry!",0xdeadbeef,i.get());
    b0latch.countDown();
    b1latch.countDown();
    addEntrylatch.await(4000,TimeUnit.MILLISECONDS);
    assertEquals("Failed to add entry!",BKException.Code.OK,i.get());
  }
  finally {
    b0latch.countDown();
    b1latch.countDown();
    addEntrylatch.countDown();
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testManyBookieFailureWithSlowBookies() throws Exception {
  ClientConfiguration conf=new ClientConfiguration();
  conf.setZkServers(zkUtil.getZooKeeperConnectString()).setReadTimeout(5);
  BookKeeper bkc=new BookKeeper(conf);
  byte[] pwd=new byte[]{};
  final LedgerHandle lh=bkc.createLedger(4,3,1,BookKeeper.DigestType.CRC32,pwd);
  final AtomicBoolean finished=new AtomicBoolean(false);
  final AtomicBoolean failTest=new AtomicBoolean(false);
  final byte[] entry="Test Entry".getBytes();
  Thread t=new Thread(){
    public void run(){
      try {
        while (!finished.get()) {
          lh.addEntry(entry);
        }
      }
 catch (      Exception e) {
        LOG.error("Exception in add entry thread",e);
        failTest.set(true);
      }
    }
  }
;
  t.start();
  final CountDownLatch b0latch=new CountDownLatch(1);
  final CountDownLatch b1latch=new CountDownLatch(1);
  startNewBookie();
  startNewBookie();
  sleepBookie(getBookie(0),b0latch);
  sleepBookie(getBookie(1),b1latch);
  Thread.sleep(10000);
  b0latch.countDown();
  b1latch.countDown();
  finished.set(true);
  t.join();
  assertFalse(failTest.get());
  lh.close();
  LedgerHandle lh2=bkc.openLedger(lh.getId(),BookKeeper.DigestType.CRC32,pwd);
  LedgerChecker lc=new LedgerChecker(bkc);
  final CountDownLatch checklatch=new CountDownLatch(1);
  final AtomicInteger numFragments=new AtomicInteger(-1);
  lc.checkLedger(lh2,new GenericCallback<Set<LedgerFragment>>(){
    public void operationComplete(    int rc,    Set<LedgerFragment> fragments){
      LOG.debug("Checked ledgers returned {} {}",rc,fragments);
      if (rc == BKException.Code.OK) {
        numFragments.set(fragments.size());
      }
      checklatch.countDown();
    }
  }
);
  checklatch.await();
  assertEquals("There should be no missing fragments",0,numFragments.get());
}

</code></pre>

<br>
<pre class="type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testBookieFailureWithSlowBookie() throws Exception {
  ClientConfiguration conf=new ClientConfiguration();
  conf.setZkServers(zkUtil.getZooKeeperConnectString()).setReadTimeout(5);
  BookKeeper bkc=new BookKeeper(conf);
  byte[] pwd=new byte[]{};
  final LedgerHandle lh=bkc.createLedger(4,3,2,BookKeeper.DigestType.CRC32,pwd);
  final AtomicBoolean finished=new AtomicBoolean(false);
  final AtomicBoolean failTest=new AtomicBoolean(false);
  final byte[] entry="Test Entry".getBytes();
  Thread t=new Thread(){
    public void run(){
      try {
        while (!finished.get()) {
          lh.addEntry(entry);
        }
      }
 catch (      Exception e) {
        LOG.error("Exception in add entry thread",e);
        failTest.set(true);
      }
    }
  }
;
  t.start();
  final CountDownLatch b0latch=new CountDownLatch(1);
  startNewBookie();
  sleepBookie(getBookie(0),b0latch);
  Thread.sleep(10000);
  b0latch.countDown();
  finished.set(true);
  t.join();
  assertFalse(failTest.get());
  lh.close();
  LedgerHandle lh2=bkc.openLedger(lh.getId(),BookKeeper.DigestType.CRC32,pwd);
  LedgerChecker lc=new LedgerChecker(bkc);
  final CountDownLatch checklatch=new CountDownLatch(1);
  final AtomicInteger numFragments=new AtomicInteger(-1);
  lc.checkLedger(lh2,new GenericCallback<Set<LedgerFragment>>(){
    public void operationComplete(    int rc,    Set<LedgerFragment> fragments){
      LOG.debug("Checked ledgers returned {} {}",rc,fragments);
      if (rc == BKException.Code.OK) {
        numFragments.set(fragments.size());
      }
      checklatch.countDown();
    }
  }
);
  checklatch.await();
  assertEquals("There should be no missing fragments",0,numFragments.get());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestAddEntryQuorumTimeout </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testTimeoutWithPendingOps() throws Exception {
  BookKeeperTestClient bkc=new BookKeeperTestClient(baseClientConf);
  LedgerHandle lh=bkc.createLedger(3,3,3,digestType,testPasswd);
  List<BookieSocketAddress> curEns=lh.getLedgerMetadata().currentEnsemble;
  byte[] data="foobar".getBytes();
  SyncObj syncObj1=new SyncObj();
  SyncObj syncObj2=new SyncObj();
  SyncObj syncObj3=new SyncObj();
  lh.addEntry(data);
  sleepBookie(curEns.get(0),5).await();
  lh.asyncAddEntry(data,this,syncObj1);
  lh.asyncAddEntry(data,this,syncObj2);
  lh.asyncAddEntry(data,this,syncObj3);
  waitForSyncObj(syncObj1);
  Assert.assertEquals(BKException.Code.AddEntryQuorumTimeoutException,syncObj1.rc);
  waitForSyncObj(syncObj2);
  Assert.assertEquals(BKException.Code.AddEntryQuorumTimeoutException,syncObj2.rc);
  waitForSyncObj(syncObj3);
  Assert.assertEquals(BKException.Code.AddEntryQuorumTimeoutException,syncObj3.rc);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestFencing </h4><pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that opening a ledger in norecovery mode
 * doesn't fence off a ledger
 */
@Test(timeout=60000) public void testNoRecoveryOpen() throws Exception {
  LedgerHandle writelh=null;
  writelh=bkc.createLedger(digestType,"".getBytes());
  String tmp="BookKeeper is cool!";
  final int numEntries=10;
  for (int i=0; i < numEntries; i++) {
    writelh.addEntry(tmp.getBytes());
  }
  LedgerHandle readlh=bkc.openLedgerNoRecovery(writelh.getId(),digestType,"".getBytes());
  writelh.addEntry(tmp.getBytes());
  long numReadable=readlh.getLastAddConfirmed();
  LOG.error("numRead " + numReadable);
  readlh.readEntries(1,numReadable);
  try {
    readlh.readEntries(numReadable + 1,numReadable + 1);
    fail("Shouldn't have been able to read this far");
  }
 catch (  BKException.BKReadException e) {
  }
  writelh.addEntry(tmp.getBytes());
  long numReadable2=readlh.getLastAddConfirmed();
  assertEquals("Number of readable entries hasn't changed",numReadable2,numReadable);
  readlh.close();
  writelh.addEntry(tmp.getBytes());
  writelh.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestLedgerChecker </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should give two fragments when 2 bookies failed
 * in same ensemble when ensemble = 3, quorum = 2
 */
@Test(timeout=60000) public void testShouldGetTwoFrgamentsIfTwoBookiesFailedInSameEnsemble() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  startNewBookie();
  startNewBookie();
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress firstBookieFromEnsemble=firstEnsemble.get(0);
  killBookie(firstEnsemble,firstBookieFromEnsemble);
  BookieSocketAddress secondBookieFromEnsemble=firstEnsemble.get(1);
  killBookie(firstEnsemble,secondBookieFromEnsemble);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("There should be 2 fragments",2,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should one fragment as underReplicated
 * if there is an open ledger with single entry written.
 */
@Test(timeout=60000) public void testShouldGetOneFragmentWithSingleEntryOpenedLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,3,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(0);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 1 fragment. But returned fragments are " + result,1,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should get failed ensemble number of fragments
 * if ensemble bookie failures on next entry
 */
@Test(timeout=60000) public void testShouldGetFailedEnsembleNumberOfFgmntsIfEnsembleBookiesFailedOnNextWrite() throws Exception {
  startNewBookie();
  startNewBookie();
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  for (int i=0; i < 3; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  for (  BookieSocketAddress bkAddr : firstEnsemble) {
    killBookie(firstEnsemble,bkAddr);
  }
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("There should be 3 fragments",3,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker does not return any fragments
 * from a closed ledger with 0 entries.
 */
@Test(timeout=60000) public void testClosedSingleEntryLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  lh.close();
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(2);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragment. But returned fragments are " + result,0,result.size());
  lh1.close();
  lastBookieFromEnsemble=firstEnsemble.get(1);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 1 fragment. But returned fragments are " + result,1,result.size());
  lh1.close();
  lastBookieFromEnsemble=firstEnsemble.get(0);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 2 fragment. But returned fragments are " + result,2,result.size());
  lh1.close();
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker does not return any fragments
 * from a closed ledger with 0 entries.
 */
@Test(timeout=60000) public void testClosedEmptyLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,3,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  lh.close();
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(0);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragment. But returned fragments are " + result,0,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker correctly identifies missing fragments
 * when a single entry is written after an ensemble change.
 * This is important, as the last add confirmed may be less than the
 * first entry id of the final segment.
 */
@Test(timeout=60000) public void testSingleEntryAfterEnsembleChange() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,3,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  for (int i=0; i < 10; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(lh.getDistributionSchedule().getWriteSet(lh.getLastAddPushed()).get(0));
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  lastBookieFromEnsemble=firstEnsemble.get(lh.getDistributionSchedule().getWriteSet(lh.getLastAddPushed()).get(1));
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  LedgerHandle lh1=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh1);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 3 fragment. But returned fragments are " + result,3,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should get all fragments if ledger is empty
 * but all bookies in the ensemble are down.
 * In this case, there's no way to tell whether data was written or not.
 * In this case, there'll only be two fragments, as quorum is 2 and we only
 * suspect that the first entry of the ledger could exist.
 */
@Test(timeout=60000) public void testShouldGet2FragmentsWithEmptyLedgerButBookiesDead() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  for (  BookieSocketAddress b : lh.getLedgerMetadata().getEnsembles().get(0L)) {
    killBookie(b);
  }
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 2 fragments.",2,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that the LedgerChecker should detect the underReplicated fragments
 * on multiple Bookie crashes
 */
@Test(timeout=60000) public void testChecker() throws Exception {
  LedgerHandle lh=bkc.createLedger(BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  startNewBookie();
  for (int i=0; i < 10; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  BookieSocketAddress replicaToKill=lh.getLedgerMetadata().getEnsembles().get(0L).get(0);
  LOG.info("Killing {}",replicaToKill);
  killBookie(replicaToKill);
  for (int i=0; i < 10; i++) {
    lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  }
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("Should have one missing fragment",1,result.size());
  assertEquals("Fragment should be missing from first replica",result.iterator().next().getAddress(),replicaToKill);
  BookieSocketAddress replicaToKill2=lh.getLedgerMetadata().getEnsembles().get(0L).get(1);
  LOG.info("Killing {}",replicaToKill2);
  killBookie(replicaToKill2);
  result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("Should have three missing fragments",3,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that ledger checker should pick the fragment as bad only if any of
 * the fragment entries not meeting the quorum.
 */
@Test(timeout=60000) public void testShouldNotGetTheFragmentIfThereIsNoMissedEntry() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress lastBookieFromEnsemble=firstEnsemble.get(2);
  LOG.info("Killing " + lastBookieFromEnsemble + " from ensemble="+ firstEnsemble);
  killBookie(lastBookieFromEnsemble);
  startNewBookie();
  LOG.info("Ensembles after first entry :" + lh.getLedgerMetadata().getEnsembles());
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  LOG.info("Ensembles after second entry :" + lh.getLedgerMetadata().getEnsembles());
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  for (  LedgerFragment r : result) {
    LOG.info("unreplicated fragment: {}",r);
  }
  assertEquals("Should not have any missing fragment",0,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should not get any underReplicated fragments, if
 * corresponding ledger does not exists.
 */
@Test(timeout=60000) public void testShouldNotGetAnyFragmentIfNoLedgerPresent() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  ArrayList<BookieSocketAddress> firstEnsemble=lh.getLedgerMetadata().getEnsembles().get(0L);
  BookieSocketAddress firstBookieFromEnsemble=firstEnsemble.get(0);
  killBookie(firstBookieFromEnsemble);
  startNewBookie();
  lh.addEntry(TEST_LEDGER_ENTRY_DATA);
  bkc.deleteLedger(lh.getId());
  LOG.info("Waiting to see ledger id {} deletion",lh.getId());
  int retries=40;
  boolean noSuchLedger=false;
  while (retries > 0) {
    try {
      lh.readEntries(0,0);
    }
 catch (    BKException.BKNoSuchLedgerExistsException bkn) {
      noSuchLedger=true;
      break;
    }
    retries--;
    Thread.sleep(500);
  }
  assertEquals("Ledger exists",true,noSuchLedger);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragments. But returned fragments are " + result,0,result.size());
}

</code></pre>

<br>
<pre class="type-2 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that LedgerChecker should not get any fragments as underReplicated
 * if Ledger itself is empty
 */
@Test(timeout=60000) public void testShouldNotGetAnyFragmentWithEmptyLedger() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,2,BookKeeper.DigestType.CRC32,TEST_LEDGER_PASSWORD);
  Set<LedgerFragment> result=getUnderReplicatedFragments(lh);
  assertNotNull("Result shouldn't be null",result);
  assertEquals("There should be 0 fragments. But returned fragments are " + result,0,result.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestLedgerFragmentReplication </h4><pre class="type-6 type-8 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that fragment re-replication fails on last unclosed ledger
 * fragments.
 */
@Test(timeout=60000) public void testReplicateLFFailsOnlyOnLastUnClosedFragments() throws Exception {
  byte[] data="TestLedgerFragmentReplication".getBytes();
  LedgerHandle lh=bkc.createLedger(3,3,TEST_DIGEST_TYPE,TEST_PSSWD);
  for (int i=0; i < 10; i++) {
    lh.addEntry(data);
  }
  BookieSocketAddress replicaToKill=lh.getLedgerMetadata().getEnsembles().get(0L).get(0);
  startNewBookie();
  LOG.info("Killing Bookie",replicaToKill);
  killBookie(replicaToKill);
  for (int i=0; i < 10; i++) {
    lh.addEntry(data);
  }
  BookieSocketAddress replicaToKill2=lh.getLedgerMetadata().getEnsembles().get(0L).get(1);
  int startNewBookie2=startNewBookie();
  LOG.info("Killing Bookie",replicaToKill2);
  killBookie(replicaToKill2);
  BookieSocketAddress newBkAddr=new BookieSocketAddress(InetAddress.getLocalHost().getHostAddress(),startNewBookie2);
  LOG.info("New Bookie addr :" + newBkAddr);
  Set<LedgerFragment> result=getFragmentsToReplicate(lh);
  BookKeeperAdmin admin=new BookKeeperAdmin(baseClientConf);
  int unclosedCount=0;
  for (  LedgerFragment lf : result) {
    if (lf.isClosed()) {
      admin.replicateLedgerFragment(lh,lf,newBkAddr);
    }
 else {
      unclosedCount++;
      try {
        admin.replicateLedgerFragment(lh,lf,newBkAddr);
        fail("Shouldn't be able to rereplicate unclosed ledger");
      }
 catch (      BKException bke) {
      }
    }
  }
  assertEquals("Should be only one unclosed fragment",1,unclosedCount);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testReplaceBookieWithEnoughBookiesInSameRack() throws Exception {
  BookieSocketAddress addr1=new BookieSocketAddress("127.0.0.1",3181);
  BookieSocketAddress addr2=new BookieSocketAddress("127.0.0.2",3181);
  BookieSocketAddress addr3=new BookieSocketAddress("127.0.0.3",3181);
  BookieSocketAddress addr4=new BookieSocketAddress("127.0.0.4",3181);
  StaticDNSResolver.addNodeToRack(addr1.getSocketAddress().getAddress().getHostAddress(),NetworkTopology.DEFAULT_RACK);
  StaticDNSResolver.addNodeToRack(addr2.getSocketAddress().getAddress().getHostAddress(),"/r2");
  StaticDNSResolver.addNodeToRack(addr3.getSocketAddress().getAddress().getHostAddress(),"/r2");
  StaticDNSResolver.addNodeToRack(addr4.getSocketAddress().getAddress().getHostAddress(),"/r3");
  Set<BookieSocketAddress> addrs=new HashSet<BookieSocketAddress>();
  addrs.add(addr1);
  addrs.add(addr2);
  addrs.add(addr3);
  addrs.add(addr4);
  repp.onClusterChanged(addrs,new HashSet<BookieSocketAddress>());
  BookieSocketAddress replacedBookie=repp.replaceBookie(addr2,new HashSet<BookieSocketAddress>());
  assertEquals(addr3,replacedBookie);
}

</code></pre>

<br>
<pre class="type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testNewEnsembleWithSingleRack() throws Exception {
  BookieSocketAddress addr1=new BookieSocketAddress("127.0.0.1",3181);
  BookieSocketAddress addr2=new BookieSocketAddress("127.0.0.2",3181);
  BookieSocketAddress addr3=new BookieSocketAddress("127.0.0.3",3181);
  BookieSocketAddress addr4=new BookieSocketAddress("127.0.0.4",3181);
  Set<BookieSocketAddress> addrs=new HashSet<BookieSocketAddress>();
  addrs.add(addr1);
  addrs.add(addr2);
  addrs.add(addr3);
  addrs.add(addr4);
  repp.onClusterChanged(addrs,new HashSet<BookieSocketAddress>());
  try {
    ArrayList<BookieSocketAddress> ensemble=repp.newEnsemble(3,2,new HashSet<BookieSocketAddress>());
    assertEquals(0,getNumCoveredWriteQuorums(ensemble,2));
    ArrayList<BookieSocketAddress> ensemble2=repp.newEnsemble(4,2,new HashSet<BookieSocketAddress>());
    assertEquals(0,getNumCoveredWriteQuorums(ensemble2,2));
  }
 catch (  BKNotEnoughBookiesException bnebe) {
    fail("Should not get not enough bookies exception even there is only one rack.");
  }
}

</code></pre>

<br>
<pre class="type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=90000) public void testNewEnsembleWithEnoughRacks() throws Exception {
  BookieSocketAddress addr1=new BookieSocketAddress("127.0.0.1",3181);
  BookieSocketAddress addr2=new BookieSocketAddress("127.0.0.2",3181);
  BookieSocketAddress addr3=new BookieSocketAddress("127.0.0.3",3181);
  BookieSocketAddress addr4=new BookieSocketAddress("127.0.0.4",3181);
  BookieSocketAddress addr5=new BookieSocketAddress("127.0.0.5",3181);
  BookieSocketAddress addr6=new BookieSocketAddress("127.0.0.6",3181);
  BookieSocketAddress addr7=new BookieSocketAddress("127.0.0.7",3181);
  BookieSocketAddress addr8=new BookieSocketAddress("127.0.0.8",3181);
  StaticDNSResolver.addNodeToRack(addr1.getSocketAddress().getAddress().getHostAddress(),NetworkTopology.DEFAULT_RACK);
  StaticDNSResolver.addNodeToRack(addr2.getSocketAddress().getAddress().getHostAddress(),"/r2");
  StaticDNSResolver.addNodeToRack(addr3.getSocketAddress().getAddress().getHostAddress(),"/r3");
  StaticDNSResolver.addNodeToRack(addr4.getSocketAddress().getAddress().getHostAddress(),"/r4");
  StaticDNSResolver.addNodeToRack(addr5.getSocketAddress().getAddress().getHostAddress(),NetworkTopology.DEFAULT_RACK);
  StaticDNSResolver.addNodeToRack(addr6.getSocketAddress().getAddress().getHostAddress(),"/r2");
  StaticDNSResolver.addNodeToRack(addr7.getSocketAddress().getAddress().getHostAddress(),"/r3");
  StaticDNSResolver.addNodeToRack(addr8.getSocketAddress().getAddress().getHostAddress(),"/r4");
  Set<BookieSocketAddress> addrs=new HashSet<BookieSocketAddress>();
  addrs.add(addr1);
  addrs.add(addr2);
  addrs.add(addr3);
  addrs.add(addr4);
  addrs.add(addr5);
  addrs.add(addr6);
  addrs.add(addr7);
  addrs.add(addr8);
  repp.onClusterChanged(addrs,new HashSet<BookieSocketAddress>());
  try {
    ArrayList<BookieSocketAddress> ensemble1=repp.newEnsemble(3,2,new HashSet<BookieSocketAddress>());
    assertEquals(3,getNumCoveredWriteQuorums(ensemble1,2));
    ArrayList<BookieSocketAddress> ensemble2=repp.newEnsemble(4,2,new HashSet<BookieSocketAddress>());
    assertEquals(4,getNumCoveredWriteQuorums(ensemble2,2));
  }
 catch (  BKNotEnoughBookiesException bnebe) {
    fail("Should not get not enough bookies exception even there is only one rack.");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestTryReadLastConfirmed </h4><pre class="type-2 type-11 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testTryReadLaCWhenSomeBookiesDown() throws Exception {
  final int numEntries=3;
  final int ensembleSize=3;
  final LedgerHandle lh=bkc.createLedger(ensembleSize,1,1,digestType,"".getBytes());
  LedgerHandle readLh=bkc.openLedgerNoRecovery(lh.getId(),digestType,"".getBytes());
  assertEquals(LedgerHandle.INVALID_ENTRY_ID,readLh.getLastAddConfirmed());
  for (int i=0; i < numEntries; i++) {
    lh.addEntry(("data" + i).getBytes());
  }
  for (int i=0; i < numEntries; i++) {
    ServerConfiguration[] confs=new ServerConfiguration[ensembleSize - 1];
    for (int j=0; j < ensembleSize - 1; j++) {
      int idx=(i + 1 + j) % ensembleSize;
      confs[j]=killBookie(lh.getLedgerMetadata().currentEnsemble.get(idx));
    }
    final AtomicBoolean success=new AtomicBoolean(false);
    final AtomicInteger numCallbacks=new AtomicInteger(0);
    final CountDownLatch latch=new CountDownLatch(1);
    final int entryId=i;
    readLh.asyncTryReadLastConfirmed(new AsyncCallback.ReadLastConfirmedCallback(){
      @Override public void readLastConfirmedComplete(      int rc,      long lastConfirmed,      Object ctx){
        numCallbacks.incrementAndGet();
        if (BKException.Code.OK == rc) {
          success.set(lastConfirmed == (entryId - 1));
        }
 else {
          success.set(false);
        }
        latch.countDown();
      }
    }
,null);
    latch.await();
    assertTrue(success.get());
    assertTrue(numCallbacks.get() == 1);
    for (    ServerConfiguration conf : confs) {
      bs.add(startBookie(conf));
      bsConfs.add(conf);
    }
  }
  lh.close();
  readLh.close();
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testTryReadLACWhenAllBookiesDown() throws Exception {
  final int numEntries=2;
  final int ensembleSize=3;
  final LedgerHandle lh=bkc.createLedger(ensembleSize,1,1,digestType,"".getBytes());
  LedgerHandle readLh=bkc.openLedgerNoRecovery(lh.getId(),digestType,"".getBytes());
  assertEquals(LedgerHandle.INVALID_ENTRY_ID,readLh.getLastAddConfirmed());
  for (int i=0; i < numEntries; i++) {
    lh.addEntry(("data" + i).getBytes());
  }
  for (int i=0; i < ensembleSize; i++) {
    killBookie(lh.getLedgerMetadata().currentEnsemble.get(i));
  }
  final AtomicBoolean success=new AtomicBoolean(false);
  final AtomicInteger numCallbacks=new AtomicInteger(0);
  final CountDownLatch latch=new CountDownLatch(1);
  readLh.asyncTryReadLastConfirmed(new AsyncCallback.ReadLastConfirmedCallback(){
    @Override public void readLastConfirmedComplete(    int rc,    long lastConfirmed,    Object ctx){
      logger.info("ReadLastConfirmedComplete : rc = {}, lac = {}.",rc,lastConfirmed);
      numCallbacks.incrementAndGet();
      if (BKException.Code.OK == rc) {
        success.set(lastConfirmed == LedgerHandle.INVALID_ENTRY_ID);
      }
 else {
        success.set(false);
      }
      latch.countDown();
    }
  }
,null);
  latch.await();
  TimeUnit.SECONDS.sleep(2);
  assertFalse(success.get());
  assertTrue(numCallbacks.get() == 1);
  lh.close();
  readLh.close();
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testTryReadLACWhenAllBookiesUp() throws Exception {
  final int numEntries=3;
  final LedgerHandle lh=bkc.createLedger(3,3,1,digestType,"".getBytes());
  LedgerHandle readLh=bkc.openLedgerNoRecovery(lh.getId(),digestType,"".getBytes());
  assertEquals(LedgerHandle.INVALID_ENTRY_ID,readLh.getLastAddConfirmed());
  for (int i=0; i < numEntries; i++) {
    lh.addEntry(("data" + i).getBytes());
  }
  final AtomicBoolean success=new AtomicBoolean(false);
  final AtomicInteger numCallbacks=new AtomicInteger(0);
  final CountDownLatch latch1=new CountDownLatch(1);
  readLh.asyncTryReadLastConfirmed(new AsyncCallback.ReadLastConfirmedCallback(){
    @Override public void readLastConfirmedComplete(    int rc,    long lastConfirmed,    Object ctx){
      numCallbacks.incrementAndGet();
      if (BKException.Code.OK == rc) {
        success.set(true);
      }
 else {
        success.set(false);
      }
      latch1.countDown();
    }
  }
,null);
  latch1.await();
  TimeUnit.SECONDS.sleep(2);
  assertTrue(success.get());
  assertTrue(numCallbacks.get() == 1);
  assertEquals(numEntries - 2,readLh.getLastAddConfirmed());
  success.set(false);
  numCallbacks.set(0);
  final CountDownLatch latch2=new CountDownLatch(1);
  readLh.asyncTryReadLastConfirmed(new AsyncCallback.ReadLastConfirmedCallback(){
    @Override public void readLastConfirmedComplete(    int rc,    long lastConfirmed,    Object ctx){
      numCallbacks.incrementAndGet();
      if (BKException.Code.OK == rc && lastConfirmed == (numEntries - 2)) {
        success.set(true);
      }
 else {
        success.set(false);
      }
      latch2.countDown();
    }
  }
,null);
  latch2.await();
  TimeUnit.SECONDS.sleep(2);
  assertTrue(success.get());
  assertTrue(numCallbacks.get() == 1);
  assertEquals(numEntries - 2,readLh.getLastAddConfirmed());
  lh.close();
  readLh.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.TestWatchEnsembleChange </h4><pre class="type-2 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testWatchEnsembleChange() throws Exception {
  int numEntries=10;
  LedgerHandle lh=bkc.createLedger(3,3,3,digestType,"".getBytes());
  for (int i=0; i < numEntries; i++) {
    lh.addEntry(("data" + i).getBytes());
    LOG.info("Added entry {}.",i);
  }
  LedgerHandle readLh=bkc.openLedgerNoRecovery(lh.getId(),digestType,"".getBytes());
  long lastLAC=readLh.getLastAddConfirmed();
  assertEquals(numEntries - 2,lastLAC);
  ArrayList<BookieSocketAddress> ensemble=lh.getLedgerMetadata().currentEnsemble;
  for (  BookieSocketAddress addr : ensemble) {
    killBookie(addr);
  }
  for (int i=0; i < numEntries; i++) {
    lh.addEntry(("data" + (numEntries + i)).getBytes());
    LOG.info("Added entry {}.",(numEntries + i));
  }
  TimeUnit.SECONDS.sleep(5);
  readLh.readLastConfirmed();
  assertEquals(2 * numEntries - 2,readLh.getLastAddConfirmed());
  readLh.close();
  lh.close();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testWatchMetadataRemoval() throws Exception {
  LedgerManagerFactory factory=ReflectionUtils.newInstance(lmFactoryCls);
  factory.initialize(baseConf,super.zkc,factory.getCurrentVersion());
  final LedgerManager manager=factory.newLedgerManager();
  LedgerIdGenerator idGenerator=factory.newLedgerIdGenerator();
  final ByteBuffer bbLedgerId=ByteBuffer.allocate(8);
  final CountDownLatch createLatch=new CountDownLatch(1);
  final CountDownLatch removeLatch=new CountDownLatch(1);
  idGenerator.generateLedgerId(new GenericCallback<Long>(){
    @Override public void operationComplete(    int rc,    final Long lid){
      manager.createLedgerMetadata(lid,new LedgerMetadata(4,2,2,digestType,"fpj was here".getBytes()),new BookkeeperInternalCallbacks.GenericCallback<Void>(){
        @Override public void operationComplete(        int rc,        Void result){
          bbLedgerId.putLong(lid);
          bbLedgerId.flip();
          createLatch.countDown();
        }
      }
);
    }
  }
);
  assertTrue(createLatch.await(2000,TimeUnit.MILLISECONDS));
  final long createdLid=bbLedgerId.getLong();
  manager.registerLedgerMetadataListener(createdLid,new LedgerMetadataListener(){
    @Override public void onChanged(    long ledgerId,    LedgerMetadata metadata){
      assertEquals(ledgerId,createdLid);
      assertEquals(metadata,null);
      removeLatch.countDown();
    }
  }
);
  manager.removeLedgerMetadata(createdLid,Version.ANY,new BookkeeperInternalCallbacks.GenericCallback<Void>(){
    @Override public void operationComplete(    int rc,    Void result){
      assertEquals(rc,BKException.Code.OK);
    }
  }
);
  assertTrue(removeLatch.await(2000,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.UpdateLedgerCmdTest </h4><pre class="type-2 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * updateledgers to hostname
 */
@Test(timeout=120000) public void testUpdateLedgersToHostname() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  LOG.info("Create ledger and add entries to it");
  List<LedgerHandle> ledgers=new ArrayList<LedgerHandle>();
  LedgerHandle lh1=createLedgerWithEntries(bk,0);
  ledgers.add(lh1);
  for (int i=1; i < 40; i++) {
    ledgers.add(createLedgerWithEntries(bk,0));
  }
  String[] argv=new String[]{"updateledgers","-b","hostname","-v","true","-p","2"};
  final ServerConfiguration conf=bsConfs.get(0);
  conf.setUseHostNameAsBookieID(true);
  BookieSocketAddress toBookieId=Bookie.getBookieAddress(conf);
  BookieSocketAddress toBookieAddr=new BookieSocketAddress(toBookieId.getHostname() + ":" + conf.getBookiePort());
  updateLedgerCmd(argv,0,conf);
  int updatedLedgersCount=getUpdatedLedgersCount(bk,ledgers,toBookieAddr);
  Assert.assertEquals("Failed to update the ledger metadata to use bookie host name",40,updatedLedgersCount);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.client.UpdateLedgerOpTest </h4><pre class="type-2 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests verifies with limit value lesser than the total number of ledgers.
 */
@Test(timeout=120000) public void testLimitLessThanTotalLedgers() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  BookKeeperAdmin bkadmin=new BookKeeperAdmin(bk);
  LOG.info("Create ledger and add entries to it");
  List<LedgerHandle> ledgers=new ArrayList<LedgerHandle>();
  LedgerHandle lh1=createLedgerWithEntries(bk,0);
  ledgers.add(lh1);
  for (int i=1; i < 10; i++) {
    ledgers.add(createLedgerWithEntries(bk,0));
  }
  ArrayList<BookieSocketAddress> ensemble=lh1.getLedgerMetadata().getEnsemble(0);
  BookieSocketAddress curBookieAddr=ensemble.get(0);
  baseConf.setUseHostNameAsBookieID(true);
  BookieSocketAddress toBookieId=Bookie.getBookieAddress(baseConf);
  BookieSocketAddress toBookieAddr=new BookieSocketAddress(toBookieId.getHostname() + ":" + curBookieAddr.getPort());
  UpdateLedgerOp updateLedgerOp=new UpdateLedgerOp(bk,bkadmin);
  updateLedgerOp.updateBookieIdInLedgers(curBookieAddr,toBookieAddr,7,4,progressable);
  int updatedLedgersCount=getUpdatedLedgersCount(bk,ledgers,toBookieAddr);
  Assert.assertEquals("Failed to update the ledger metadata to use bookie host name",4,updatedLedgersCount);
  updateLedgerOp.updateBookieIdInLedgers(curBookieAddr,toBookieAddr,2,10,progressable);
  updatedLedgersCount=getUpdatedLedgersCount(bk,ledgers,toBookieAddr);
  Assert.assertEquals("Failed to update the ledger metadata to use bookie host name",10,updatedLedgersCount);
  updateLedgerOp.updateBookieIdInLedgers(curBookieAddr,toBookieAddr,3,20,progressable);
  updatedLedgersCount=getUpdatedLedgersCount(bk,ledgers,toBookieAddr);
  Assert.assertEquals("Failed to update the ledger metadata to use bookie host name",10,updatedLedgersCount);
  updateLedgerOp.updateBookieIdInLedgers(curBookieAddr,toBookieAddr,3,Integer.MIN_VALUE,progressable);
  updatedLedgersCount=getUpdatedLedgersCount(bk,ledgers,toBookieAddr);
  Assert.assertEquals("Failed to update the ledger metadata to use bookie host name",10,updatedLedgersCount);
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests verifies the ensemble reformation after updating the bookie id in
 * the existing ensemble
 */
@Test(timeout=120000) public void testChangeEnsembleAfterRenaming() throws Exception {
  BookKeeper bk=new BookKeeper(baseClientConf,zkc);
  BookKeeperAdmin bkadmin=new BookKeeperAdmin(bk);
  LOG.info("Create ledger and add entries to it");
  LedgerHandle lh=createLedgerWithEntries(bk,100);
  BookieServer bookieServer=bs.get(0);
  ArrayList<BookieSocketAddress> ensemble=lh.getLedgerMetadata().getEnsemble(0);
  BookieSocketAddress curBookieAddr=null;
  for (  BookieSocketAddress bookieSocketAddress : ensemble) {
    if (bookieServer.getLocalAddress().equals(bookieSocketAddress)) {
      curBookieAddr=bookieSocketAddress;
    }
  }
  Assert.assertNotNull("Couldn't find the bookie in ledger metadata!",curBookieAddr);
  baseConf.setUseHostNameAsBookieID(true);
  BookieSocketAddress toBookieId=Bookie.getBookieAddress(baseConf);
  BookieSocketAddress toBookieAddr=new BookieSocketAddress(toBookieId.getHostname() + ":" + curBookieAddr.getPort());
  UpdateLedgerOp updateLedgerOp=new UpdateLedgerOp(bk,bkadmin);
  updateLedgerOp.updateBookieIdInLedgers(curBookieAddr,toBookieAddr,5,100,progressable);
  bookieServer.shutdown();
  ServerConfiguration serverConf1=newServerConfiguration();
  bsConfs.add(serverConf1);
  bs.add(startBookie(serverConf1));
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicInteger rc=new AtomicInteger(BKException.Code.OK);
  lh.asyncAddEntry("foobar".getBytes(),new AddCallback(){
    @Override public void addComplete(    int rccb,    LedgerHandle lh,    long entryId,    Object ctx){
      rc.compareAndSet(BKException.Code.OK,rccb);
      latch.countDown();
    }
  }
,null);
  if (!latch.await(30,TimeUnit.SECONDS)) {
    throw new Exception("Entries took too long to add");
  }
  if (rc.get() != BKException.Code.OK) {
    throw BKException.create(rc.get());
  }
  lh.close();
  LedgerHandle openLedger=bk.openLedger(lh.getId(),digestType,PASSWORD.getBytes());
  final LedgerMetadata ledgerMetadata=openLedger.getLedgerMetadata();
  Assert.assertEquals("Failed to reform ensemble!",2,ledgerMetadata.getEnsembles().size());
  ensemble=ledgerMetadata.getEnsemble(0);
  Assert.assertTrue("Failed to update the ledger metadata to use bookie host name",ensemble.contains(toBookieAddr));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.GcLedgersTest </h4><pre class="type-2 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGcLedgersNotLast() throws Exception {
  final SortedSet<Long> createdLedgers=Collections.synchronizedSortedSet(new TreeSet<Long>());
  final List<Long> cleaned=new ArrayList<Long>();
  final int numLedgers=30001;
  createLedgers(numLedgers,createdLedgers);
  final GarbageCollector garbageCollector=new ScanAndCompareGarbageCollector(getLedgerManager(),activeLedgers);
  GarbageCollector.GarbageCleaner cleaner=new GarbageCollector.GarbageCleaner(){
    @Override public void clean(    long ledgerId){
      LOG.info("Cleaned {}",ledgerId);
      cleaned.add(ledgerId);
    }
  }
;
  SortedSet<Long> scannedLedgers=new TreeSet<Long>();
  LedgerRangeIterator iterator=getLedgerManager().getLedgerRanges();
  while (iterator.hasNext()) {
    LedgerRange ledgerRange=iterator.next();
    scannedLedgers.addAll(ledgerRange.getLedgers());
  }
  assertEquals(createdLedgers,scannedLedgers);
  garbageCollector.gc(cleaner);
  assertTrue("Should have cleaned nothing",cleaned.isEmpty());
  long first=createdLedgers.first();
  removeLedger(first);
  garbageCollector.gc(cleaner);
  assertEquals("Should have cleaned something",1,cleaned.size());
  assertEquals("Should have cleaned first ledger" + first,(long)first,(long)cleaned.get(0));
}

</code></pre>

<br>
<pre class="type-2 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGcLedgersOutsideRange() throws Exception {
  final SortedSet<Long> createdLedgers=Collections.synchronizedSortedSet(new TreeSet<Long>());
  final Queue<Long> cleaned=new LinkedList<Long>();
  int numLedgers=100;
  createLedgers(numLedgers,createdLedgers);
  final GarbageCollector garbageCollector=new ScanAndCompareGarbageCollector(getLedgerManager(),activeLedgers);
  GarbageCollector.GarbageCleaner cleaner=new GarbageCollector.GarbageCleaner(){
    @Override public void clean(    long ledgerId){
      LOG.info("Cleaned {}",ledgerId);
      cleaned.add(ledgerId);
    }
  }
;
  garbageCollector.gc(cleaner);
  assertNull("Should have cleaned nothing",cleaned.poll());
  long last=createdLedgers.last();
  removeLedger(last);
  garbageCollector.gc(cleaner);
  assertNotNull("Should have cleaned something",cleaned.peek());
  assertEquals("Should have cleaned last ledger" + last,(long)last,(long)cleaned.poll());
  long first=createdLedgers.first();
  removeLedger(first);
  garbageCollector.gc(cleaner);
  assertNotNull("Should have cleaned something",cleaned.peek());
  assertEquals("Should have cleaned first ledger" + first,(long)first,(long)cleaned.poll());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.LedgerLayoutTest </h4><pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLedgerLayout() throws Exception {
  ClientConfiguration conf=new ClientConfiguration();
  conf.setLedgerManagerFactoryClass(HierarchicalLedgerManagerFactory.class);
  String ledgerRootPath="/testLedgerLayout";
  zkc.create(ledgerRootPath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LedgerLayout layout=LedgerLayout.readLayout(zkc,ledgerRootPath);
  assertTrue("Layout should be null",layout == null);
  String testName="foobar";
  int testVersion=0xdeadbeef;
  LedgerLayout layout2=new LedgerLayout(testName,testVersion);
  layout2.store(zkc,ledgerRootPath);
  layout=LedgerLayout.readLayout(zkc,ledgerRootPath);
  assertEquals(testName,layout.getManagerFactoryClass());
  assertEquals(testVersion,layout.getManagerVersion());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testReadV1LedgerManagerLayout() throws Exception {
  ClientConfiguration conf=new ClientConfiguration();
  writeLedgerLayout(conf.getZkLedgersRootPath(),FlatLedgerManagerFactory.NAME,FlatLedgerManagerFactory.CUR_VERSION,1);
  LedgerLayout layout=LedgerLayout.readLayout(zkc,conf.getZkLedgersRootPath());
  assertNotNull("Should not be null",layout);
  assertEquals(FlatLedgerManagerFactory.NAME,layout.getManagerFactoryClass());
  assertEquals(FlatLedgerManagerFactory.CUR_VERSION,layout.getManagerVersion());
  assertEquals(1,layout.getLayoutFormatVersion());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.LedgerManagerIteratorTest </h4><pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testIterateNoLedgers() throws Exception {
  LedgerManager lm=getLedgerManager();
  LedgerRangeIterator lri=lm.getLedgerRanges();
  assertNotNull(lri);
  if (lri.hasNext())   lri.next();
  assertEquals(false,lri.hasNext());
  assertEquals(false,lri.hasNext());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.TestLedgerManager </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testConcurrent2() throws Exception {
  int numThreadsEach=25;
  String root0="/lmroot0";
  zkc.create(root0,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  CyclicBarrier barrier=new CyclicBarrier(numThreadsEach * 2 + 1);
  List<CreateLMThread> threadsA=new ArrayList<CreateLMThread>(numThreadsEach);
  for (int i=0; i < numThreadsEach; i++) {
    CreateLMThread t=new CreateLMThread(zkUtil.getZooKeeperConnectString(),root0,FlatLedgerManagerFactory.class.getName(),barrier);
    t.start();
    threadsA.add(t);
  }
  List<CreateLMThread> threadsB=new ArrayList<CreateLMThread>(numThreadsEach);
  for (int i=0; i < numThreadsEach; i++) {
    CreateLMThread t=new CreateLMThread(zkUtil.getZooKeeperConnectString(),root0,HierarchicalLedgerManagerFactory.class.getName(),barrier);
    t.start();
    threadsB.add(t);
  }
  barrier.await();
  int numSuccess=0;
  int numFails=0;
  for (  CreateLMThread t : threadsA) {
    t.join();
    t.close();
    if (t.isSuccessful()) {
      numSuccess++;
    }
 else {
      numFails++;
    }
  }
  for (  CreateLMThread t : threadsB) {
    t.join();
    t.close();
    if (t.isSuccessful()) {
      numSuccess++;
    }
 else {
      numFails++;
    }
  }
  assertEquals("Incorrect number of successes",numThreadsEach,numSuccess);
  assertEquals("Incorrect number of failures",numThreadsEach,numFails);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.TestZkLedgerIdGenerator </h4><pre class="type-2 type-11 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGenerateLedgerId() throws Exception {
  final int nThread=2;
  final int nLedgers=2000;
  final CountDownLatch countDownLatch=new CountDownLatch(nThread * nLedgers);
  final AtomicInteger errCount=new AtomicInteger(0);
  final ConcurrentLinkedQueue<Long> ledgerIds=new ConcurrentLinkedQueue<Long>();
  final GenericCallback<Long> cb=new GenericCallback<Long>(){
    @Override public void operationComplete(    int rc,    Long result){
      if (Code.OK.intValue() == rc) {
        ledgerIds.add(result);
      }
 else {
        errCount.incrementAndGet();
      }
      countDownLatch.countDown();
    }
  }
;
  long start=System.currentTimeMillis();
  for (int i=0; i < nThread; i++) {
    new Thread(){
      @Override public void run(){
        for (int j=0; j < nLedgers; j++) {
          ledgerIdGenerator.generateLedgerId(cb);
        }
      }
    }
.start();
  }
  assertTrue("Wait ledger id generation threads to stop timeout : ",countDownLatch.await(30,TimeUnit.SECONDS));
  LOG.info("Number of generated ledger id: {}, time used: {}",ledgerIds.size(),System.currentTimeMillis() - start);
  assertEquals("Error occur during ledger id generation : ",0,errCount.get());
  Set<Long> ledgers=new HashSet<Long>();
  while (!ledgerIds.isEmpty()) {
    Long ledger=ledgerIds.poll();
    assertNotNull("Generated ledger id is null : ",ledger);
    assertFalse("Ledger id [" + ledger + "] conflict : ",ledgers.contains(ledger));
    ledgers.add(ledger);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.meta.TestZkVersion </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testCompare(){
  ZkVersion zv=new ZkVersion(99);
  Assert.assertEquals(Occurred.AFTER,zv.compare(new ZkVersion(98)));
  Assert.assertEquals(Occurred.BEFORE,zv.compare(new ZkVersion(100)));
  Assert.assertEquals(Occurred.CONCURRENTLY,zv.compare(new ZkVersion(99)));
  Assert.assertEquals(Occurred.CONCURRENTLY,zv.compare(Version.ANY));
  Assert.assertEquals(Occurred.AFTER,zv.compare(Version.NEW));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.proto.TestBKStats </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests that updatLatency should not fail with
 * ArrayIndexOutOfBoundException when latency time coming as negative.
 */
@Test(timeout=60000) public void testUpdateLatencyShouldNotFailWithAIOBEWithNegativeLatency() throws Exception {
  OpStats opStat=new OpStats();
  opStat.updateLatency(-10);
  assertEquals("Should not update any latency metrics",0,opStat.numSuccessOps);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.AuditorLedgerCheckerTest </h4><pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test publishing of under replicated ledgers by the auditor bookie
 */
@Test(timeout=60000) public void testSimpleLedger() throws Exception {
  LedgerHandle lh1=createAndAddEntriesToLedger();
  Long ledgerId=lh1.getId();
  LOG.debug("Created ledger : " + ledgerId);
  ledgerList.add(ledgerId);
  lh1.close();
  final CountDownLatch underReplicaLatch=registerUrLedgerWatcher(ledgerList.size());
  int bkShutdownIndex=bs.size() - 1;
  String shutdownBookie=shutdownBookie(bkShutdownIndex);
  LOG.debug("Waiting for ledgers to be marked as under replicated");
  underReplicaLatch.await(5,TimeUnit.SECONDS);
  Map<Long,String> urLedgerData=getUrLedgerData(urLedgerList);
  assertEquals("Missed identifying under replicated ledgers",1,urLedgerList.size());
  assertTrue("Ledger is not marked as underreplicated:" + ledgerId,urLedgerList.contains(ledgerId));
  String data=urLedgerData.get(ledgerId);
  assertTrue("Bookie " + shutdownBookie + "is not listed in the ledger as missing replica :"+ data,data.contains(shutdownBookie));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.AuditorPeriodicBookieCheckTest </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that the periodic bookie checker works
 */
@Test(timeout=30000) public void testPeriodicBookieCheckInterval() throws Exception {
  LedgerManagerFactory mFactory=LedgerManagerFactory.newLedgerManagerFactory(bsConfs.get(0),zkc);
  LedgerManager ledgerManager=mFactory.newLedgerManager();
  final LedgerUnderreplicationManager underReplicationManager=mFactory.newLedgerUnderreplicationManager();
  final int numLedgers=1;
  LedgerHandle lh=bkc.createLedger(3,3,DigestType.CRC32,"passwd".getBytes());
  LedgerMetadata md=LedgerHandleAdapter.getLedgerMetadata(lh);
  List<BookieSocketAddress> ensemble=md.getEnsembles().get(0L);
  ensemble.set(0,new BookieSocketAddress("1.1.1.1",1000));
  TestCallbacks.GenericCallbackFuture<Void> cb=new TestCallbacks.GenericCallbackFuture<Void>();
  ledgerManager.writeLedgerMetadata(lh.getId(),md,cb);
  cb.get();
  long underReplicatedLedger=-1;
  for (int i=0; i < 10; i++) {
    underReplicatedLedger=underReplicationManager.pollLedgerToRereplicate();
    if (underReplicatedLedger != -1) {
      break;
    }
    Thread.sleep(CHECK_INTERVAL * 1000);
  }
  assertEquals("Ledger should be under replicated",lh.getId(),underReplicatedLedger);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.AuditorPeriodicCheckTest </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * test that the periodic checking will detect corruptions in
 * the bookie entry log
 */
@Test(timeout=30000) public void testEntryLogCorruption() throws Exception {
  LedgerManagerFactory mFactory=LedgerManagerFactory.newLedgerManagerFactory(bsConfs.get(0),zkc);
  LedgerUnderreplicationManager underReplicationManager=mFactory.newLedgerUnderreplicationManager();
  underReplicationManager.disableLedgerReplication();
  LedgerHandle lh=bkc.createLedger(3,3,DigestType.CRC32,"passwd".getBytes());
  long ledgerId=lh.getId();
  for (int i=0; i < 100; i++) {
    lh.addEntry("testdata".getBytes());
  }
  lh.close();
  BookieAccessor.forceFlush(bs.get(0).getBookie());
  File ledgerDir=bsConfs.get(0).getLedgerDirs()[0];
  ledgerDir=Bookie.getCurrentDirectory(ledgerDir);
  File[] entryLogs=ledgerDir.listFiles(new FilenameFilter(){
    public boolean accept(    File dir,    String name){
      return name.endsWith(".log");
    }
  }
);
  ByteBuffer junk=ByteBuffer.allocate(1024 * 1024);
  for (  File f : entryLogs) {
    FileOutputStream out=new FileOutputStream(f);
    out.getChannel().write(junk);
    out.close();
  }
  restartBookies();
  underReplicationManager.enableLedgerReplication();
  long underReplicatedLedger=-1;
  for (int i=0; i < 10; i++) {
    underReplicatedLedger=underReplicationManager.pollLedgerToRereplicate();
    if (underReplicatedLedger != -1) {
      break;
    }
    Thread.sleep(CHECK_INTERVAL * 1000);
  }
  assertEquals("Ledger should be under replicated",ledgerId,underReplicatedLedger);
  underReplicationManager.close();
}

</code></pre>

<br>
<pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that the period checker will not run when auto replication has been disabled
 */
@Test(timeout=120000) public void testPeriodicCheckWhenDisabled() throws Exception {
  LedgerManagerFactory mFactory=LedgerManagerFactory.newLedgerManagerFactory(bsConfs.get(0),zkc);
  final LedgerUnderreplicationManager underReplicationManager=mFactory.newLedgerUnderreplicationManager();
  final int numLedgers=10;
  final int numMsgs=2;
  final CountDownLatch completeLatch=new CountDownLatch(numMsgs * numLedgers);
  final AtomicInteger rc=new AtomicInteger(BKException.Code.OK);
  List<LedgerHandle> lhs=new ArrayList<LedgerHandle>();
  for (int i=0; i < numLedgers; i++) {
    LedgerHandle lh=bkc.createLedger(3,3,DigestType.CRC32,"passwd".getBytes());
    lhs.add(lh);
    for (int j=0; j < 2; j++) {
      lh.asyncAddEntry("testdata".getBytes(),new AddCallback(){
        public void addComplete(        int rc2,        LedgerHandle lh,        long entryId,        Object ctx){
          if (rc.compareAndSet(BKException.Code.OK,rc2)) {
            LOG.info("Failed to add entry : {}",BKException.getMessage(rc2));
          }
          completeLatch.countDown();
        }
      }
,null);
    }
  }
  completeLatch.await();
  if (rc.get() != BKException.Code.OK) {
    throw BKException.create(rc.get());
  }
  for (  LedgerHandle lh : lhs) {
    lh.close();
  }
  underReplicationManager.disableLedgerReplication();
  final AtomicInteger numReads=new AtomicInteger(0);
  ServerConfiguration conf=killBookie(0);
  Bookie deadBookie=new Bookie(conf){
    @Override public ByteBuffer readEntry(    long ledgerId,    long entryId) throws IOException, NoLedgerException {
      numReads.incrementAndGet();
      throw new IOException("Fake I/O exception");
    }
  }
;
  bsConfs.add(conf);
  bs.add(startBookie(conf,deadBookie));
  Thread.sleep(CHECK_INTERVAL * 2000);
  assertEquals("Nothing should have tried to read",0,numReads.get());
  underReplicationManager.enableLedgerReplication();
  Thread.sleep(CHECK_INTERVAL * 2000);
  underReplicationManager.disableLedgerReplication();
  Thread.sleep(CHECK_INTERVAL * 2000);
  int numUnderreplicated=0;
  long underReplicatedLedger=-1;
  do {
    underReplicatedLedger=underReplicationManager.pollLedgerToRereplicate();
    if (underReplicatedLedger == -1) {
      break;
    }
    numUnderreplicated++;
    underReplicationManager.markLedgerReplicated(underReplicatedLedger);
  }
 while (underReplicatedLedger != -1);
  Thread.sleep(CHECK_INTERVAL * 2000);
  underReplicatedLedger=underReplicationManager.pollLedgerToRereplicate();
  assertEquals("There should be no underreplicated ledgers",-1,underReplicatedLedger);
  LOG.info("{} of {} ledgers underreplicated",numUnderreplicated,numUnderreplicated);
  assertTrue("All should be underreplicated",numUnderreplicated <= numLedgers && numUnderreplicated > 0);
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * test that the period checker will detect corruptions in
 * the bookie index files
 */
@Test(timeout=30000) public void testIndexCorruption() throws Exception {
  LedgerManagerFactory mFactory=LedgerManagerFactory.newLedgerManagerFactory(bsConfs.get(0),zkc);
  LedgerUnderreplicationManager underReplicationManager=mFactory.newLedgerUnderreplicationManager();
  LedgerHandle lh=bkc.createLedger(3,3,DigestType.CRC32,"passwd".getBytes());
  long ledgerToCorrupt=lh.getId();
  for (int i=0; i < 100; i++) {
    lh.addEntry("testdata".getBytes());
  }
  lh.close();
  lh=bkc.createLedger(3,3,DigestType.CRC32,"passwd".getBytes());
  for (int i=0; i < 100; i++) {
    lh.addEntry("testdata".getBytes());
  }
  lh.close();
  BookieAccessor.forceFlush(bs.get(0).getBookie());
  File ledgerDir=bsConfs.get(0).getLedgerDirs()[0];
  ledgerDir=Bookie.getCurrentDirectory(ledgerDir);
  File index=new File(ledgerDir,IndexPersistenceMgr.getLedgerName(ledgerToCorrupt));
  LOG.info("file to corrupt{}",index);
  ByteBuffer junk=ByteBuffer.allocate(1024 * 1024);
  FileOutputStream out=new FileOutputStream(index);
  out.getChannel().write(junk);
  out.close();
  long underReplicatedLedger=-1;
  for (int i=0; i < 10; i++) {
    underReplicatedLedger=underReplicationManager.pollLedgerToRereplicate();
    if (underReplicatedLedger != -1) {
      break;
    }
    Thread.sleep(CHECK_INTERVAL * 1000);
  }
  assertEquals("Ledger should be under replicated",ledgerToCorrupt,underReplicatedLedger);
  underReplicationManager.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.AuditorRollingRestartTest </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test no auditing during restart if disabled
 */
@Test(timeout=600000) public void testAuditingDuringRollingRestart() throws Exception {
  LedgerManagerFactory mFactory=LedgerManagerFactory.newLedgerManagerFactory(bsConfs.get(0),zkc);
  final LedgerUnderreplicationManager underReplicationManager=mFactory.newLedgerUnderreplicationManager();
  LedgerHandle lh=bkc.createLedger(3,3,DigestType.CRC32,"passwd".getBytes());
  for (int i=0; i < 10; i++) {
    lh.asyncAddEntry("foobar".getBytes(),new TestCallbacks.AddCallbackFuture(i),null);
  }
  lh.addEntry("foobar".getBytes());
  lh.close();
  assertEquals("shouldn't be anything under replicated",underReplicationManager.pollLedgerToRereplicate(),-1);
  underReplicationManager.disableLedgerReplication();
  BookieSocketAddress auditor=AuditorElector.getCurrentAuditor(baseConf,zkc);
  ServerConfiguration conf=killBookie(auditor);
  Thread.sleep(2000);
  startBookie(conf);
  Thread.sleep(2000);
  assertEquals("shouldn't be anything under replicated",-1,underReplicationManager.pollLedgerToRereplicate());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.BookieLedgerIndexTest </h4><pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the bookie-ledger mapping with minimum number of bookies and few
 * ledgers
 */
@Test(timeout=60000) public void testSimpleBookieLedgerMapping() throws Exception {
  for (int i=0; i < numberOfLedgers; i++) {
    createAndAddEntriesToLedger().close();
  }
  BookieLedgerIndexer bookieLedgerIndex=new BookieLedgerIndexer(ledgerManager);
  Map<String,Set<Long>> bookieToLedgerIndex=bookieLedgerIndex.getBookieToLedgerIndex();
  assertEquals("Missed few bookies in the bookie-ledger mapping!",3,bookieToLedgerIndex.size());
  Collection<Set<Long>> bk2ledgerEntry=bookieToLedgerIndex.values();
  for (  Set<Long> ledgers : bk2ledgerEntry) {
    assertEquals("Missed few ledgers in the bookie-ledger mapping!",3,ledgers.size());
    for (    Long ledgerId : ledgers) {
      assertTrue("Unknown ledger-bookie mapping",ledgerList.contains(ledgerId));
    }
  }
}

</code></pre>

<br>
<pre class="type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify indexing with multiple ensemble reformation
 */
@Test(timeout=60000) public void testEnsembleReformation() throws Exception {
  try {
    LedgerHandle lh1=createAndAddEntriesToLedger();
    LedgerHandle lh2=createAndAddEntriesToLedger();
    startNewBookie();
    shutdownBookie(bs.size() - 2);
    for (int i=0; i < 10; i++) {
      ByteBuffer entry=ByteBuffer.allocate(4);
      entry.putInt(rng.nextInt(Integer.MAX_VALUE));
      entry.position(0);
      entries.add(entry.array());
      lh1.addEntry(entry.array());
      lh2.addEntry(entry.array());
    }
    BookieLedgerIndexer bookieLedgerIndex=new BookieLedgerIndexer(ledgerManager);
    Map<String,Set<Long>> bookieToLedgerIndex=bookieLedgerIndex.getBookieToLedgerIndex();
    assertEquals("Missed few bookies in the bookie-ledger mapping!",4,bookieToLedgerIndex.size());
    Collection<Set<Long>> bk2ledgerEntry=bookieToLedgerIndex.values();
    for (    Set<Long> ledgers : bk2ledgerEntry) {
      assertEquals("Missed few ledgers in the bookie-ledger mapping!",2,ledgers.size());
      for (      Long ledgerNode : ledgers) {
        assertTrue("Unknown ledger-bookie mapping",ledgerList.contains(ledgerNode));
      }
    }
  }
 catch (  BKException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to BookKeeper exception");
  }
catch (  InterruptedException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to interruption");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.TestAutoRecoveryAlongWithBookieServers </h4><pre class="type-2 type-11 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that the auto recovery service along with Bookie servers itself 
 */
@Test(timeout=60000) public void testAutoRecoveryAlongWithBookieServers() throws Exception {
  LedgerHandle lh=bkc.createLedger(3,3,BookKeeper.DigestType.CRC32,"testpasswd".getBytes());
  byte[] testData="testBuiltAutoRecovery".getBytes();
  for (int i=0; i < 10; i++) {
    lh.addEntry(testData);
  }
  lh.close();
  BookieSocketAddress replicaToKill=LedgerHandleAdapter.getLedgerMetadata(lh).getEnsembles().get(0L).get(0);
  killBookie(replicaToKill);
  int startNewBookie=startNewBookie();
  BookieSocketAddress newBkAddr=new BookieSocketAddress(InetAddress.getLocalHost().getHostAddress(),startNewBookie);
  while (ReplicationTestUtil.isLedgerInUnderReplication(zkc,lh.getId(),basePath)) {
    Thread.sleep(100);
  }
  Set<Entry<Long,ArrayList<BookieSocketAddress>>> entrySet=LedgerHandleAdapter.getLedgerMetadata(lh).getEnsembles().entrySet();
  for (  Entry<Long,ArrayList<BookieSocketAddress>> entry : entrySet) {
    ArrayList<BookieSocketAddress> bookies=entry.getValue();
    for (    BookieSocketAddress bookie : bookies) {
      if (bookie.equals(newBkAddr)) {
        continue;
      }
      killBookie(bookie);
    }
  }
  LedgerHandle lhs=bkc.openLedgerNoRecovery(lh.getId(),BookKeeper.DigestType.CRC32,"testpasswd".getBytes());
  Enumeration<LedgerEntry> entries=lhs.readEntries(0,9);
  assertTrue("Should have the elements",entries.hasMoreElements());
  while (entries.hasMoreElements()) {
    LedgerEntry entry=entries.nextElement();
    assertEquals("testBuiltAutoRecovery",new String(entry.getEntry()));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.replication.TestLedgerUnderreplicationManager </h4><pre class="type-11 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that as the hierarchy gets cleaned up, it doesn't interfere
 * with the marking of other ledgers as underreplicated
 */
@Test(timeout=90000) public void testHierarchyCleanupInterference() throws Exception {
  final LedgerUnderreplicationManager replicaMgr1=lmf1.newLedgerUnderreplicationManager();
  final LedgerUnderreplicationManager replicaMgr2=lmf2.newLedgerUnderreplicationManager();
  final int iterations=100;
  final AtomicBoolean threadFailed=new AtomicBoolean(false);
  Thread markUnder=new Thread(){
    public void run(){
      long l=1;
      try {
        for (int i=0; i < iterations; i++) {
          replicaMgr1.markLedgerUnderreplicated(l,"localhost:3181");
          l+=10000;
        }
      }
 catch (      Exception e) {
        LOG.error("markUnder Thread failed with exception",e);
        threadFailed.set(true);
        return;
      }
    }
  }
;
  final AtomicInteger processed=new AtomicInteger(0);
  Thread markRepl=new Thread(){
    public void run(){
      try {
        for (int i=0; i < iterations; i++) {
          long l=replicaMgr2.getLedgerToRereplicate();
          replicaMgr2.markLedgerReplicated(l);
          processed.incrementAndGet();
        }
      }
 catch (      Exception e) {
        LOG.error("markRepl Thread failed with exception",e);
        threadFailed.set(true);
        return;
      }
    }
  }
;
  markRepl.setDaemon(true);
  markUnder.setDaemon(true);
  markRepl.start();
  markUnder.start();
  markUnder.join();
  assertFalse("Thread failed to complete",threadFailed.get());
  int lastProcessed=0;
  while (true) {
    markRepl.join(10000);
    if (!markRepl.isAlive()) {
      break;
    }
    assertFalse("markRepl thread not progressing",lastProcessed == processed.get());
  }
  assertFalse("Thread failed to complete",threadFailed.get());
  List<String> children=zkc1.getChildren(urLedgerPath,false);
  for (  String s : children) {
    LOG.info("s: {}",s);
  }
  assertEquals("All hierarchies should be cleaned up",0,children.size());
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test basic interactions with the ledger underreplication
 * manager.
 * Mark some ledgers as underreplicated.
 * Ensure that getLedgerToReplicate will block until it a ledger
 * becomes available.
 */
@Test(timeout=60000) public void testBasicInteraction() throws Exception {
  Set<Long> ledgers=new HashSet<Long>();
  ledgers.add(0xdeadbeefL);
  ledgers.add(0xbeefcafeL);
  ledgers.add(0xffffbeefL);
  ledgers.add(0xfacebeefL);
  String missingReplica="localhost:3181";
  int count=0;
  LedgerUnderreplicationManager m=lmf1.newLedgerUnderreplicationManager();
  Iterator<Long> iter=ledgers.iterator();
  while (iter.hasNext()) {
    m.markLedgerUnderreplicated(iter.next(),missingReplica);
    count++;
  }
  List<Future<Long>> futures=new ArrayList<Future<Long>>();
  for (int i=0; i < count; i++) {
    futures.add(getLedgerToReplicate(m));
  }
  for (  Future<Long> f : futures) {
    Long l=f.get(5,TimeUnit.SECONDS);
    assertTrue(ledgers.remove(l));
  }
  Future<Long> f=getLedgerToReplicate(m);
  try {
    f.get(1,TimeUnit.SECONDS);
    fail("Shouldn't be able to find a ledger to replicate");
  }
 catch (  TimeoutException te) {
  }
  Long newl=0xfefefefefefeL;
  m.markLedgerUnderreplicated(newl,missingReplica);
  assertEquals("Should have got the one just added",newl,f.get(5,TimeUnit.SECONDS));
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test locking for ledger unreplication manager.
 * If there's only one ledger marked for rereplication,
 * and one client has it, it should be locked; another
 * client shouldn't be able to get it. If the first client dies
 * however, the second client should be able to get it.
 */
@Test(timeout=60000) public void testLocking() throws Exception {
  String missingReplica="localhost:3181";
  LedgerUnderreplicationManager m1=lmf1.newLedgerUnderreplicationManager();
  LedgerUnderreplicationManager m2=lmf2.newLedgerUnderreplicationManager();
  Long ledger=0xfeadeefdacL;
  m1.markLedgerUnderreplicated(ledger,missingReplica);
  Future<Long> f=getLedgerToReplicate(m1);
  Long l=f.get(5,TimeUnit.SECONDS);
  assertEquals("Should be the ledger I just marked",ledger,l);
  f=getLedgerToReplicate(m2);
  try {
    f.get(1,TimeUnit.SECONDS);
    fail("Shouldn't be able to find a ledger to replicate");
  }
 catch (  TimeoutException te) {
  }
  zkc1.close();
  zkc1=null;
  l=f.get(5,TimeUnit.SECONDS);
  assertEquals("Should be the ledger I marked",ledger,l);
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that the hierarchy gets cleaned up as ledgers
 * are marked as fully replicated
 */
@Test(timeout=60000) public void testHierarchyCleanup() throws Exception {
  final LedgerUnderreplicationManager replicaMgr=lmf1.newLedgerUnderreplicationManager();
  long[] ledgers={0x00000000deadbeefL,0x00000000deadbeeeL,0x00000000beefcafeL,0x00000000cafed00dL};
  for (  long l : ledgers) {
    replicaMgr.markLedgerUnderreplicated(l,"localhost:3181");
  }
  String testPath=urLedgerPath + "/0000/0000";
  List<String> children=zkc1.getChildren(testPath,false);
  assertEquals("Wrong number of hierarchies",3,children.size());
  int marked=0;
  while (marked < 3) {
    long l=replicaMgr.getLedgerToRereplicate();
    if (l != ledgers[0]) {
      replicaMgr.markLedgerReplicated(l);
      marked++;
    }
 else {
      replicaMgr.releaseUnderreplicatedLedger(l);
    }
  }
  children=zkc1.getChildren(testPath,false);
  assertEquals("Wrong number of hierarchies",1,children.size());
  long l=replicaMgr.getLedgerToRereplicate();
  assertEquals("Got wrong ledger",ledgers[0],l);
  replicaMgr.markLedgerReplicated(l);
  children=zkc1.getChildren(urLedgerPath,false);
  assertEquals("All hierarchies should be cleaned up",0,children.size());
}

</code></pre>

<br>
<pre class="type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test enabling the ledger re-replication. After enableLedegerReplication,
 * should continue getLedgerToRereplicate() task
 */
@Test(timeout=20000) public void testEnableLedgerReplication() throws Exception {
  isLedgerReplicationDisabled=true;
  final LedgerUnderreplicationManager replicaMgr=lmf1.newLedgerUnderreplicationManager();
  final Long ledgerA=0xfeadeefdacL;
  final String missingReplica="localhost:3181";
  try {
    replicaMgr.markLedgerUnderreplicated(ledgerA,missingReplica);
  }
 catch (  UnavailableException e) {
    LOG.debug("Unexpected exception while marking urLedger",e);
    fail("Unexpected exception while marking urLedger" + e.getMessage());
  }
  replicaMgr.disableLedgerReplication();
  LOG.debug("Disabled Ledeger Replication");
  String znodeA=getUrLedgerZnode(ledgerA);
  final CountDownLatch znodeLatch=new CountDownLatch(2);
  String urledgerA=StringUtils.substringAfterLast(znodeA,"/");
  String urLockLedgerA=basePath + "/locks/" + urledgerA;
  zkc1.exists(urLockLedgerA,new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeCreated) {
        znodeLatch.countDown();
        LOG.debug("Recieved node creation event for the zNodePath:" + event.getPath());
      }
    }
  }
);
  Thread thread1=new Thread(){
    @Override public void run(){
      try {
        Long lA=replicaMgr.getLedgerToRereplicate();
        assertEquals("Should be the ledger I just marked",lA,ledgerA);
        isLedgerReplicationDisabled=false;
        znodeLatch.countDown();
      }
 catch (      UnavailableException e) {
        LOG.debug("Unexpected exception while marking urLedger",e);
        isLedgerReplicationDisabled=false;
      }
    }
  }
;
  thread1.start();
  try {
    assertFalse("shouldn't complete",znodeLatch.await(1,TimeUnit.SECONDS));
    assertTrue("Ledger replication is not disabled!",isLedgerReplicationDisabled);
    assertEquals("Failed to disable ledger replication!",2,znodeLatch.getCount());
    replicaMgr.enableLedgerReplication();
    znodeLatch.await(5,TimeUnit.SECONDS);
    LOG.debug("Enabled Ledeger Replication");
    assertTrue("Ledger replication is not disabled!",!isLedgerReplicationDisabled);
    assertEquals("Failed to disable ledger replication!",0,znodeLatch.getCount());
  }
  finally {
    thread1.interrupt();
  }
}

</code></pre>

<br>
<pre class="type-2 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that when a failure occurs on a ledger, while the ledger
 * is already being rereplicated, the ledger will still be in the
 * under replicated ledger list when first rereplicating client marks
 * it as replicated.
 */
@Test(timeout=60000) public void testManyFailures() throws Exception {
  String missingReplica1="localhost:3181";
  String missingReplica2="localhost:3182";
  LedgerUnderreplicationManager m1=lmf1.newLedgerUnderreplicationManager();
  Long ledgerA=0xfeadeefdacL;
  m1.markLedgerUnderreplicated(ledgerA,missingReplica1);
  Future<Long> fA=getLedgerToReplicate(m1);
  Long lA=fA.get(5,TimeUnit.SECONDS);
  m1.markLedgerUnderreplicated(ledgerA,missingReplica2);
  assertEquals("Should be the ledger I just marked",lA,ledgerA);
  m1.markLedgerReplicated(lA);
  Future<Long> f=getLedgerToReplicate(m1);
  lA=f.get(5,TimeUnit.SECONDS);
  assertEquals("Should be the ledger I had marked previously",lA,ledgerA);
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that when a ledger has been marked as replicated, it
 * will not be offered to anther client.
 * This test checked that by marking two ledgers, and acquiring
 * them on a single client. It marks one as replicated and then
 * the client is killed. We then check that another client can
 * acquire a ledger, and that it's not the one that was previously
 * marked as replicated.
 */
@Test(timeout=60000) public void testMarkingAsReplicated() throws Exception {
  String missingReplica="localhost:3181";
  LedgerUnderreplicationManager m1=lmf1.newLedgerUnderreplicationManager();
  LedgerUnderreplicationManager m2=lmf2.newLedgerUnderreplicationManager();
  Long ledgerA=0xfeadeefdacL;
  Long ledgerB=0xdefadebL;
  m1.markLedgerUnderreplicated(ledgerA,missingReplica);
  m1.markLedgerUnderreplicated(ledgerB,missingReplica);
  Future<Long> fA=getLedgerToReplicate(m1);
  Future<Long> fB=getLedgerToReplicate(m1);
  Long lA=fA.get(5,TimeUnit.SECONDS);
  Long lB=fB.get(5,TimeUnit.SECONDS);
  assertTrue("Should be the ledgers I just marked",(lA.equals(ledgerA) && lB.equals(ledgerB)) || (lA.equals(ledgerB) && lB.equals(ledgerA)));
  Future<Long> f=getLedgerToReplicate(m2);
  try {
    f.get(1,TimeUnit.SECONDS);
    fail("Shouldn't be able to find a ledger to replicate");
  }
 catch (  TimeoutException te) {
  }
  m1.markLedgerReplicated(lA);
  zkc1.close();
  zkc1=null;
  Long l=f.get(5,TimeUnit.SECONDS);
  assertEquals("Should be the ledger I marked",lB,l);
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that when a ledger is marked as underreplicated with
 * the same missing replica twice, only marking as replicated
 * will be enough to remove it from the list.
 */
@Test(timeout=60000) public void test2reportSame() throws Exception {
  String missingReplica1="localhost:3181";
  LedgerUnderreplicationManager m1=lmf1.newLedgerUnderreplicationManager();
  LedgerUnderreplicationManager m2=lmf2.newLedgerUnderreplicationManager();
  Long ledgerA=0xfeadeefdacL;
  m1.markLedgerUnderreplicated(ledgerA,missingReplica1);
  m2.markLedgerUnderreplicated(ledgerA,missingReplica1);
  UnderreplicatedLedgerFormat.Builder builderA=UnderreplicatedLedgerFormat.newBuilder();
  String znode=getUrLedgerZnode(ledgerA);
  byte[] data=zkc1.getData(znode,false,null);
  TextFormat.merge(new String(data,Charset.forName("UTF-8")),builderA);
  List<String> replicaList=builderA.getReplicaList();
  assertEquals("Published duplicate missing replica : " + replicaList,1,replicaList.size());
  assertTrue("Published duplicate missing replica : " + replicaList,replicaList.contains(missingReplica1));
  Future<Long> fA=getLedgerToReplicate(m1);
  Long lA=fA.get(5,TimeUnit.SECONDS);
  assertEquals("Should be the ledger I just marked",lA,ledgerA);
  m1.markLedgerReplicated(lA);
  Future<Long> f=getLedgerToReplicate(m2);
  try {
    f.get(1,TimeUnit.SECONDS);
    fail("Shouldn't be able to find a ledger to replicate");
  }
 catch (  TimeoutException te) {
  }
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test releasing of a ledger
 * A ledger is released when a client decides it does not want
 * to replicate it (or cannot at the moment).
 * When a client releases a previously acquired ledger, another
 * client should then be able to acquire it.
 */
@Test(timeout=60000) public void testRelease() throws Exception {
  String missingReplica="localhost:3181";
  LedgerUnderreplicationManager m1=lmf1.newLedgerUnderreplicationManager();
  LedgerUnderreplicationManager m2=lmf2.newLedgerUnderreplicationManager();
  Long ledgerA=0xfeadeefdacL;
  Long ledgerB=0xdefadebL;
  m1.markLedgerUnderreplicated(ledgerA,missingReplica);
  m1.markLedgerUnderreplicated(ledgerB,missingReplica);
  Future<Long> fA=getLedgerToReplicate(m1);
  Future<Long> fB=getLedgerToReplicate(m1);
  Long lA=fA.get(5,TimeUnit.SECONDS);
  Long lB=fB.get(5,TimeUnit.SECONDS);
  assertTrue("Should be the ledgers I just marked",(lA.equals(ledgerA) && lB.equals(ledgerB)) || (lA.equals(ledgerB) && lB.equals(ledgerA)));
  Future<Long> f=getLedgerToReplicate(m2);
  try {
    f.get(1,TimeUnit.SECONDS);
    fail("Shouldn't be able to find a ledger to replicate");
  }
 catch (  TimeoutException te) {
  }
  m1.markLedgerReplicated(lA);
  m1.releaseUnderreplicatedLedger(lB);
  Long l=f.get(5,TimeUnit.SECONDS);
  assertEquals("Should be the ledger I marked",lB,l);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.BookieClientTest </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testNoLedger() throws Exception {
  ResultStruct arc=new ResultStruct();
  BookieSocketAddress addr=new BookieSocketAddress("127.0.0.1",port);
  BookieClient bc=new BookieClient(new ClientConfiguration(),channelFactory,executor);
synchronized (arc) {
    bc.readEntry(addr,2,13,recb,arc);
    arc.wait(1000);
    assertEquals(BKException.Code.NoSuchLedgerExistsException,arc.rc);
  }
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testWriteGaps() throws Exception {
  final Object notifyObject=new Object();
  byte[] passwd=new byte[20];
  Arrays.fill(passwd,(byte)'a');
  BookieSocketAddress addr=new BookieSocketAddress("127.0.0.1",port);
  ResultStruct arc=new ResultStruct();
  BookieClient bc=new BookieClient(new ClientConfiguration(),channelFactory,executor);
  ChannelBuffer bb;
  bb=createByteBuffer(1,1,1);
  bc.addEntry(addr,1,passwd,1,bb,wrcb,arc,BookieProtocol.FLAG_NONE);
synchronized (arc) {
    arc.wait(1000);
    bc.readEntry(addr,1,1,recb,arc);
    arc.wait(1000);
    assertEquals(0,arc.rc);
    assertEquals(1,arc.entry.getInt());
  }
  bb=createByteBuffer(2,1,2);
  bc.addEntry(addr,1,passwd,2,bb,wrcb,null,BookieProtocol.FLAG_NONE);
  bb=createByteBuffer(3,1,3);
  bc.addEntry(addr,1,passwd,3,bb,wrcb,null,BookieProtocol.FLAG_NONE);
  bb=createByteBuffer(5,1,5);
  bc.addEntry(addr,1,passwd,5,bb,wrcb,null,BookieProtocol.FLAG_NONE);
  bb=createByteBuffer(7,1,7);
  bc.addEntry(addr,1,passwd,7,bb,wrcb,null,BookieProtocol.FLAG_NONE);
synchronized (notifyObject) {
    bb=createByteBuffer(11,1,11);
    bc.addEntry(addr,1,passwd,11,bb,wrcb,notifyObject,BookieProtocol.FLAG_NONE);
    notifyObject.wait();
  }
synchronized (arc) {
    bc.readEntry(addr,1,6,recb,arc);
    arc.wait(1000);
    assertEquals(BKException.Code.NoSuchEntryException,arc.rc);
  }
synchronized (arc) {
    bc.readEntry(addr,1,7,recb,arc);
    arc.wait(1000);
    assertEquals(0,arc.rc);
    assertEquals(7,arc.entry.getInt());
  }
synchronized (arc) {
    bc.readEntry(addr,1,1,recb,arc);
    arc.wait(1000);
    assertEquals(0,arc.rc);
    assertEquals(1,arc.entry.getInt());
  }
synchronized (arc) {
    bc.readEntry(addr,1,2,recb,arc);
    arc.wait(1000);
    assertEquals(0,arc.rc);
    assertEquals(2,arc.entry.getInt());
  }
synchronized (arc) {
    bc.readEntry(addr,1,3,recb,arc);
    arc.wait(1000);
    assertEquals(0,arc.rc);
    assertEquals(3,arc.entry.getInt());
  }
synchronized (arc) {
    bc.readEntry(addr,1,4,recb,arc);
    arc.wait(1000);
    assertEquals(BKException.Code.NoSuchEntryException,arc.rc);
  }
synchronized (arc) {
    bc.readEntry(addr,1,11,recb,arc);
    arc.wait(1000);
    assertEquals(0,arc.rc);
    assertEquals(11,arc.entry.getInt());
  }
synchronized (arc) {
    bc.readEntry(addr,1,5,recb,arc);
    arc.wait(1000);
    assertEquals(0,arc.rc);
    assertEquals(5,arc.entry.getInt());
  }
synchronized (arc) {
    bc.readEntry(addr,1,10,recb,arc);
    arc.wait(1000);
    assertEquals(BKException.Code.NoSuchEntryException,arc.rc);
  }
synchronized (arc) {
    bc.readEntry(addr,1,12,recb,arc);
    arc.wait(1000);
    assertEquals(BKException.Code.NoSuchEntryException,arc.rc);
  }
synchronized (arc) {
    bc.readEntry(addr,1,13,recb,arc);
    arc.wait(1000);
    assertEquals(BKException.Code.NoSuchEntryException,arc.rc);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.BookieFailureTest </h4><pre class="type-2 type-11 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testBookieRecovery() throws Exception {
  bs.get(0).shutdown();
  bs.get(1).shutdown();
  bs.get(2).shutdown();
  byte[] passwd="blah".getBytes();
  LedgerHandle lh=bkc.createLedger(1,1,digestType,passwd);
  int numEntries=100;
  for (int i=0; i < numEntries; i++) {
    byte[] data=("" + i).getBytes();
    lh.addEntry(data);
  }
  bs.get(3).shutdown();
  BookieServer server=new BookieServer(bsConfs.get(3));
  server.start();
  bs.set(3,server);
  assertEquals(numEntries - 1,lh.getLastAddConfirmed());
  Enumeration<LedgerEntry> entries=lh.readEntries(0,lh.getLastAddConfirmed());
  int numScanned=0;
  while (entries.hasMoreElements()) {
    assertEquals(("" + numScanned),new String(entries.nextElement().getEntry()));
    numScanned++;
  }
  assertEquals(numEntries,numScanned);
}

</code></pre>

<br>
<pre class="type-2 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify read last confirmed op, it shouldn't cause any deadlock as new
 * bookie connection is being established and returning the connection
 * notification in the same caller thread. It would be simulated by delaying
 * the future.addlistener() in PerChannelBookieClient after the connection
 * establishment. Now the future.addlistener() will notify back in the same
 * thread and simultaneously invoke the pendingOp.operationComplete() event.
 * BOOKKEEPER-326
 */
@Test(timeout=60000) public void testReadLastConfirmedOp() throws Exception {
  startNewBookie();
  startNewBookie();
  LedgerHandle beforelh=bkc.createLedger(numBookies + 2,numBookies + 2,digestType,"".getBytes());
  int numEntries=10;
  String tmp="BookKeeper is cool!";
  for (int i=0; i < numEntries; i++) {
    beforelh.addEntry(tmp.getBytes());
  }
  killBookie(0);
  startNewBookie();
  BookKeeperTestClient bkc1=new BookKeeperTestClient(baseClientConf);
  LedgerHandle afterlh=bkc1.openLedger(beforelh.getId(),digestType,"".getBytes());
  assertEquals("Entries got missed",beforelh.getLastAddPushed(),afterlh.getLastAddConfirmed());
  bkc1.close();
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLedgerNoRecoveryOpenAfterBKCrashed() throws Exception {
  LedgerHandle beforelh=bkc.createLedger(numBookies,numBookies,digestType,"".getBytes());
  int numEntries=10;
  String tmp="BookKeeper is cool!";
  for (int i=0; i < numEntries; i++) {
    beforelh.addEntry(tmp.getBytes());
  }
  killBookie(0);
  LedgerHandle afterlh=bkc.openLedgerNoRecovery(beforelh.getId(),digestType,"".getBytes());
  assertEquals(numEntries - 2,afterlh.getLastAddConfirmed());
  startNewBookie();
  LedgerHandle beforelh2=bkc.createLedger(numBookies,1,digestType,"".getBytes());
  for (int i=0; i < numEntries; i++) {
    beforelh2.addEntry(tmp.getBytes());
  }
  killBookie(0);
  try {
    bkc.openLedgerNoRecovery(beforelh2.getId(),digestType,"".getBytes());
    fail("Should have thrown exception");
  }
 catch (  BKException.BKReadException e) {
  }
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLedgerOpenAfterBKCrashed() throws Exception {
  LedgerHandle beforelh=bkc.createLedger(numBookies,numBookies,digestType,"".getBytes());
  int numEntries=10;
  String tmp="BookKeeper is cool!";
  for (int i=0; i < numEntries; i++) {
    beforelh.addEntry(tmp.getBytes());
  }
  killBookie(0);
  startNewBookie();
  LedgerHandle afterlh=bkc.openLedger(beforelh.getId(),digestType,"".getBytes());
  assertEquals(beforelh.getLastAddPushed(),afterlh.getLastAddConfirmed());
  LedgerHandle beforelh2=bkc.createLedger(numBookies,1,digestType,"".getBytes());
  for (int i=0; i < numEntries; i++) {
    beforelh2.addEntry(tmp.getBytes());
  }
  killBookie(0);
  try {
    bkc.openLedger(beforelh2.getId(),digestType,"".getBytes());
    fail("Should have thrown exception");
  }
 catch (  BKException.BKLedgerRecoveryException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.BookieReadWriteTest </h4><pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testReadFromOpenLedgerOpenOnce() throws Exception {
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    LedgerHandle lhOpen=bkc.openLedgerNoRecovery(ledgerId,digestType,ledgerPassword);
    writeNEntriesLastWriteSync(lh,numEntriesToWrite / 2);
    ByteBuffer entry=ByteBuffer.allocate(4);
    entry.putInt(rng.nextInt(maxInt));
    entry.position(0);
    int toRead=numEntriesToWrite / 2 - 2;
    long readLastConfirmed=lhOpen.readLastConfirmed();
    assertTrue(readLastConfirmed != 0);
    Enumeration<LedgerEntry> readEntry=lhOpen.readEntries(toRead,toRead);
    assertTrue("Enumeration of ledger entries has no element",readEntry.hasMoreElements() == true);
    LedgerEntry e=readEntry.nextElement();
    assertEquals(toRead,e.getEntryId());
    Assert.assertArrayEquals(entries.get(toRead),e.getEntry());
    try {
      lhOpen.addEntry(entry.array());
      fail("Should have thrown an exception here");
    }
 catch (    BKException.BKIllegalOpException bkioe) {
    }
catch (    Exception ex) {
      LOG.error("Unexpected exception",ex);
      fail("Unexpected exception");
    }
    writeNEntriesLastWriteSync(lh,numEntriesToWrite / 2);
    long last=lh.readLastConfirmed();
    assertTrue("Last confirmed add: " + last,last == (numEntriesToWrite - 2));
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
    lhOpen.close();
  }
 catch (  BKException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to BookKeeper exception");
  }
catch (  InterruptedException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to interruption");
  }
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLastConfirmedAdd() throws Exception {
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    writeNEntriesLastWriteSync(lh,numEntriesToWrite);
    long last=lh.readLastConfirmed();
    assertTrue("Last confirmed add: " + last,last == (numEntriesToWrite - 2));
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    writeNEntriesLastWriteSync(lh,numEntriesToWrite);
    SyncObj sync=new SyncObj();
    lh.asyncReadLastConfirmed(this,sync);
synchronized (sync) {
      while (sync.lastConfirmed == LedgerHandle.INVALID_ENTRY_ID) {
        LOG.debug("Counter = " + sync.lastConfirmed);
        sync.wait();
      }
      assertEquals("Error reading",BKException.Code.OK,sync.getReturnCode());
    }
    assertTrue("Last confirmed add: " + sync.lastConfirmed,sync.lastConfirmed == (numEntriesToWrite - 2));
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
  }
 catch (  BKException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to BookKeeper exception");
  }
catch (  InterruptedException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to interruption");
  }
}

</code></pre>

<br>
<pre class="type-2 type-11 type-8 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that the add api with offset and length work correctly.
 * First try varying the offset. Then the length with a fixed non-zero
 * offset.
 */
@Test(timeout=60000) public void testReadWriteRangeAsyncSingleClient() throws IOException {
  SyncObj sync=new SyncObj();
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    byte bytes[]={'a','b','c','d','e','f','g','h','i'};
    lh.asyncAddEntry(bytes,0,bytes.length,this,sync);
    lh.asyncAddEntry(bytes,0,4,this,sync);
    lh.asyncAddEntry(bytes,3,4,this,sync);
    lh.asyncAddEntry(bytes,3,(bytes.length - 3),this,sync);
    int numEntries=4;
synchronized (sync) {
      while (sync.counter < numEntries) {
        LOG.debug("Entries counter = " + sync.counter);
        sync.wait();
      }
      assertEquals("Error adding",BKException.Code.OK,sync.getReturnCode());
    }
    try {
      lh.asyncAddEntry(bytes,-1,bytes.length,this,sync);
      fail("Shouldn't be able to use negative offset");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,0,bytes.length + 1,this,sync);
      fail("Shouldn't be able to use that much length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,-1,bytes.length + 2,this,sync);
      fail("Shouldn't be able to use negative offset " + "with that much length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,4,-3,this,sync);
      fail("Shouldn't be able to use negative length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    try {
      lh.asyncAddEntry(bytes,-4,-3,this,sync);
      fail("Shouldn't be able to use negative offset & length");
    }
 catch (    ArrayIndexOutOfBoundsException aiob) {
    }
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
    lh=bkc.openLedger(ledgerId,digestType,ledgerPassword);
    LOG.debug("Number of entries written: " + (lh.getLastAddConfirmed() + 1));
    assertTrue("Verifying number of entries written",lh.getLastAddConfirmed() == (numEntries - 1));
    lh.asyncReadEntries(0,numEntries - 1,this,sync);
synchronized (sync) {
      while (sync.value == false) {
        sync.wait();
      }
      assertEquals("Error reading",BKException.Code.OK,sync.getReturnCode());
    }
    LOG.debug("*** READ COMPLETE ***");
    int i=0;
    Enumeration<LedgerEntry> ls=sync.getLedgerEntries();
    while (ls.hasMoreElements()) {
      byte[] expected=null;
      byte[] entry=ls.nextElement().getEntry();
switch (i) {
case 0:
        expected=Arrays.copyOfRange(bytes,0,bytes.length);
      break;
case 1:
    expected=Arrays.copyOfRange(bytes,0,4);
  break;
case 2:
expected=Arrays.copyOfRange(bytes,3,3 + 4);
break;
case 3:
expected=Arrays.copyOfRange(bytes,3,3 + (bytes.length - 3));
break;
}
assertNotNull("There are more checks than writes",expected);
String message="Checking entry " + i + " for equality ["+ new String(entry,"UTF-8")+ ","+ new String(expected,"UTF-8")+ "]";
assertTrue(message,Arrays.equals(entry,expected));
i++;
}
assertTrue("Checking number of read entries",i == numEntries);
lh.close();
}
 catch (BKException e) {
LOG.error("Test failed",e);
fail("Test failed due to BookKeeper exception");
}
catch (InterruptedException e) {
LOG.error("Test failed",e);
fail("Test failed due to interruption");
}
}

</code></pre>

<br>
<pre class="type-2 type-11 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncReadAsyncWriteStringsSingleClient() throws IOException {
  SyncObj sync=new SyncObj();
  LOG.info("TEST READ WRITE STRINGS MIXED SINGLE CLIENT");
  String charset="utf-8";
  LOG.debug("Default charset: " + Charset.defaultCharset());
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    for (int i=0; i < numEntriesToWrite; i++) {
      int randomInt=rng.nextInt(maxInt);
      byte[] entry=new String(Integer.toString(randomInt)).getBytes(charset);
      entries.add(entry);
      lh.asyncAddEntry(entry,this,sync);
    }
synchronized (sync) {
      while (sync.counter < numEntriesToWrite) {
        LOG.debug("Entries counter = " + sync.counter);
        sync.wait();
      }
      assertEquals("Error adding",BKException.Code.OK,sync.getReturnCode());
    }
    LOG.debug("*** ASYNC WRITE COMPLETE ***");
    lh.close();
    lh=bkc.openLedger(ledgerId,digestType,ledgerPassword);
    LOG.debug("Number of entries written: " + (lh.getLastAddConfirmed() + 1));
    assertTrue("Verifying number of entries written",lh.getLastAddConfirmed() == (numEntriesToWrite - 1));
    Enumeration<LedgerEntry> ls=lh.readEntries(0,numEntriesToWrite - 1);
    LOG.debug("*** SYNC READ COMPLETE ***");
    int i=0;
    while (ls.hasMoreElements()) {
      byte[] origEntryBytes=entries.get(i++);
      byte[] retrEntryBytes=ls.nextElement().getEntry();
      LOG.debug("Original byte entry size: " + origEntryBytes.length);
      LOG.debug("Saved byte entry size: " + retrEntryBytes.length);
      String origEntry=new String(origEntryBytes,charset);
      String retrEntry=new String(retrEntryBytes,charset);
      LOG.debug("Original entry: " + origEntry);
      LOG.debug("Retrieved entry: " + retrEntry);
      assertTrue("Checking entry " + i + " for equality",origEntry.equals(retrEntry));
    }
    assertTrue("Checking number of read entries",i == numEntriesToWrite);
    lh.close();
  }
 catch (  BKException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to BookKeeper exception");
  }
catch (  InterruptedException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to interruption");
  }
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testReadWriteAsyncLength() throws IOException {
  SyncObj sync=new SyncObj();
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    for (int i=0; i < numEntriesToWrite; i++) {
      ByteBuffer entry=ByteBuffer.allocate(4);
      entry.putInt(rng.nextInt(maxInt));
      entry.position(0);
      entries.add(entry.array());
      entriesSize.add(entry.array().length);
      lh.asyncAddEntry(entry.array(),this,sync);
    }
synchronized (sync) {
      while (sync.counter < numEntriesToWrite) {
        LOG.debug("Entries counter = " + sync.counter);
        sync.wait();
      }
      assertEquals("Error adding",BKException.Code.OK,sync.getReturnCode());
    }
    long length=numEntriesToWrite * 4;
    assertTrue("Ledger length before closing: " + lh.getLength(),lh.getLength() == length);
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
    lh=bkc.openLedger(ledgerId,digestType,ledgerPassword);
    assertTrue("Ledger length after opening: " + lh.getLength(),lh.getLength() == length);
    lh.close();
  }
 catch (  BKException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to BookKeeper exception");
  }
catch (  InterruptedException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to interruption");
  }
}

</code></pre>

<br>
<pre class="type-2 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testReadFromOpenLedger() throws Exception {
  try {
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    LOG.info("Ledger ID: " + lh.getId());
    long lac=writeNEntriesLastWriteSync(lh,numEntriesToWrite);
    LedgerHandle lhOpen=bkc.openLedgerNoRecovery(ledgerId,digestType,ledgerPassword);
    long toRead=lac - 1;
    Enumeration<LedgerEntry> readEntry=lhOpen.readEntries(toRead,toRead);
    assertTrue("Enumeration of ledger entries has no element",readEntry.hasMoreElements() == true);
    LedgerEntry e=readEntry.nextElement();
    assertEquals(toRead,e.getEntryId());
    Assert.assertArrayEquals(entries.get((int)toRead),e.getEntry());
    try {
      ByteBuffer entry=ByteBuffer.allocate(4);
      entry.putInt(rng.nextInt(maxInt));
      entry.position(0);
      lhOpen.addEntry(entry.array());
      fail("Should have thrown an exception here");
    }
 catch (    BKException.BKIllegalOpException bkioe) {
    }
catch (    Exception ex) {
      LOG.error("Unexpected exception",ex);
      fail("Unexpected exception");
    }
    lhOpen.close();
    lac=writeNEntriesLastWriteSync(lh,numEntriesToWrite);
    assertEquals("Last confirmed add: ",lac,(numEntriesToWrite * 2) - 1);
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
    lh=bkc.createLedger(digestType,ledgerPassword);
    ledgerId=lh.getId();
    writeNEntriesLastWriteSync(lh,numEntriesToWrite);
    SyncObj sync=new SyncObj();
    lh.asyncReadLastConfirmed(this,sync);
synchronized (sync) {
      while (sync.lastConfirmed == -1) {
        LOG.debug("Counter = " + sync.lastConfirmed);
        sync.wait();
      }
      assertEquals("Error reading",BKException.Code.OK,sync.getReturnCode());
    }
    assertEquals("Last confirmed add",sync.lastConfirmed,(numEntriesToWrite - 2));
    LOG.debug("*** WRITE COMPLETE ***");
    lh.close();
  }
 catch (  BKException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to BookKeeper exception");
  }
catch (  InterruptedException e) {
    LOG.error("Test failed",e);
    fail("Test failed due to interruption");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.ConfigurationTest </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testGetZkServers(){
  System.setProperty("zkServers","server1:port1,server2:port2");
  ServerConfiguration conf=new ServerConfiguration();
  ClientConfiguration clientConf=new ClientConfiguration();
  assertEquals("zookeeper connect string doesn't match in server configuration","server1:port1,server2:port2",conf.getZkServers());
  assertEquals("zookeeper connect string doesn't match in client configuration","server1:port1,server2:port2",clientConf.getZkServers());
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testConfigurationOverwrite(){
  System.clearProperty("zkServers");
  ServerConfiguration conf=new ServerConfiguration();
  assertEquals(null,conf.getZkServers());
  System.setProperty("zkServers","server1");
  assertEquals("server1",conf.getZkServers());
  ServerConfiguration conf2=new ServerConfiguration();
  assertEquals("server1",conf2.getZkServers());
  System.clearProperty("zkServers");
  ServerConfiguration newConf=new ServerConfiguration();
  assertEquals(null,newConf.getZkServers());
  newConf.setZkServers("newserver");
  assertEquals("newserver",newConf.getZkServers());
  conf2.loadConf(newConf);
  assertEquals("newserver",conf2.getZkServers());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.ForceReadOnlyBookieTest </h4><pre class="type-2 type-11 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check force start readonly bookie
 */
@Test(timeout=60000) public void testBookieForceStartAsReadOnly() throws Exception {
  LedgerHandle ledger=bkc.createLedger(2,2,DigestType.MAC,"".getBytes());
  for (int i=0; i < 10; i++) {
    ledger.addEntry("data".getBytes());
  }
  ledger.close();
  LOG.info("successed prepare");
  bsConfs.get(1).setReadOnlyModeEnabled(true);
  bsConfs.get(1).setForceReadOnlyBookie(true);
  restartBookies();
  Bookie bookie=bs.get(1).getBookie();
  assertTrue("Bookie should be running and in readonly mode",bookie.isRunning() && bookie.isReadOnly());
  LOG.info("successed force start ReadOnlyBookie");
  File[] ledgerDirs=bsConfs.get(1).getLedgerDirs();
  assertEquals("Only one ledger dir should be present",1,ledgerDirs.length);
  killBookie(0);
  Enumeration<LedgerEntry> readEntries=ledger.readEntries(0,9);
  while (readEntries.hasMoreElements()) {
    LedgerEntry entry=readEntries.nextElement();
    assertEquals("Entry should contain correct data","data",new String(entry.getEntry()));
  }
  LOG.info("successed read entry from ReadOnlyBookie");
  LedgerDirsManager ledgerDirsManager=bookie.getLedgerDirsManager();
  ledgerDirsManager.addToWritableDirs(new File(ledgerDirs[0],"current"),true);
  assertTrue("Bookie should be running and in readonly mode",bookie.isRunning() && bookie.isReadOnly());
  LOG.info("successed: bookie still readonly");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.ReadOnlyBookieTest </h4><pre class="type-2 type-11 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check readonly bookie
 */
@Test(timeout=60000) public void testBookieShouldServeAsReadOnly() throws Exception {
  killBookie(0);
  baseConf.setReadOnlyModeEnabled(true);
  startNewBookie();
  LedgerHandle ledger=bkc.createLedger(2,2,DigestType.MAC,"".getBytes());
  File[] ledgerDirs=bsConfs.get(1).getLedgerDirs();
  assertEquals("Only one ledger dir should be present",1,ledgerDirs.length);
  Bookie bookie=bs.get(1).getBookie();
  LedgerDirsManager ledgerDirsManager=bookie.getLedgerDirsManager();
  for (int i=0; i < 10; i++) {
    ledger.addEntry("data".getBytes());
  }
  ledgerDirsManager.addToFilledDirs(new File(ledgerDirs[0],"current"));
  try {
    ledger.addEntry("data".getBytes());
    fail("Should fail to add entry since there isn't enough bookies alive.");
  }
 catch (  BKException.BKNotEnoughBookiesException e) {
  }
  assertTrue("Bookie should be running and converted to readonly mode",bookie.isRunning() && bookie.isReadOnly());
  killBookie(0);
  Enumeration<LedgerEntry> readEntries=ledger.readEntries(0,9);
  while (readEntries.hasMoreElements()) {
    LedgerEntry entry=readEntries.nextElement();
    assertEquals("Entry should contain correct data","data",new String(entry.getEntry()));
  }
}

</code></pre>

<br>
<pre class="type-2 type-11 type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testBookieShouldTurnWritableFromReadOnly() throws Exception {
  killBookie(0);
  baseConf.setReadOnlyModeEnabled(true);
  startNewBookie();
  LedgerHandle ledger=bkc.createLedger(2,2,DigestType.MAC,"".getBytes());
  File[] ledgerDirs=bsConfs.get(1).getLedgerDirs();
  assertEquals("Only one ledger dir should be present",1,ledgerDirs.length);
  Bookie bookie=bs.get(1).getBookie();
  LedgerDirsManager ledgerDirsManager=bookie.getLedgerDirsManager();
  for (int i=0; i < 10; i++) {
    ledger.addEntry("data".getBytes());
  }
  File testDir=new File(ledgerDirs[0],"current");
  ledgerDirsManager.addToFilledDirs(testDir);
  try {
    ledger.addEntry("data".getBytes());
    fail("Should fail to add entry since there isn't enough bookies alive.");
  }
 catch (  BKException.BKNotEnoughBookiesException e) {
  }
  LOG.info("bookie is running {}, readonly {}.",bookie.isRunning(),bookie.isReadOnly());
  assertTrue("Bookie should be running and converted to readonly mode",bookie.isRunning() && bookie.isReadOnly());
  bkc.readBookiesBlocking();
  try {
    bkc.createLedger(2,2,DigestType.MAC,"".getBytes());
    fail("Should fail to create a ledger since there isn't enough bookies alive.");
  }
 catch (  BKException.BKNotEnoughBookiesException bke) {
  }
  ledgerDirsManager.addToWritableDirs(testDir,true);
  LOG.info("bookie is running {}, readonly {}.",bookie.isRunning(),bookie.isReadOnly());
  assertTrue("Bookie should be running and converted back to writable mode",bookie.isRunning() && !bookie.isReadOnly());
  bkc.readBookiesBlocking();
  LedgerHandle newLedger=bkc.createLedger(2,2,DigestType.MAC,"".getBytes());
  for (int i=0; i < 10; i++) {
    newLedger.addEntry("data".getBytes());
  }
  Enumeration<LedgerEntry> readEntries=newLedger.readEntries(0,9);
  while (readEntries.hasMoreElements()) {
    LedgerEntry entry=readEntries.nextElement();
    assertEquals("Entry should contain correct data","data",new String(entry.getEntry()));
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check multiple ledger dirs
 */
@Test(timeout=60000) public void testBookieContinueWritingIfMultipleLedgersPresent() throws Exception {
  startNewBookieWithMultipleLedgerDirs(2);
  File[] ledgerDirs=bsConfs.get(1).getLedgerDirs();
  assertEquals("Only one ledger dir should be present",2,ledgerDirs.length);
  Bookie bookie=bs.get(1).getBookie();
  LedgerHandle ledger=bkc.createLedger(2,2,DigestType.MAC,"".getBytes());
  LedgerDirsManager ledgerDirsManager=bookie.getLedgerDirsManager();
  for (int i=0; i < 10; i++) {
    ledger.addEntry("data".getBytes());
  }
  ledgerDirsManager.addToFilledDirs(new File(ledgerDirs[0],"current"));
  for (int i=0; i < 10; i++) {
    ledger.addEntry("data".getBytes());
  }
  assertEquals("writable dirs should have one dir",1,ledgerDirsManager.getWritableLedgerDirs().size());
  assertTrue("Bookie should shutdown if readOnlyMode not enabled",bookie.isAlive());
}

</code></pre>

<br>
<pre class="type-8 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * check readOnlyModeEnabled=false
 */
@Test(timeout=60000) public void testBookieShutdownIfReadOnlyModeNotEnabled() throws Exception {
  File[] ledgerDirs=bsConfs.get(1).getLedgerDirs();
  assertEquals("Only one ledger dir should be present",1,ledgerDirs.length);
  Bookie bookie=bs.get(1).getBookie();
  LedgerHandle ledger=bkc.createLedger(2,2,DigestType.MAC,"".getBytes());
  LedgerDirsManager ledgerDirsManager=bookie.getLedgerDirsManager();
  for (int i=0; i < 10; i++) {
    ledger.addEntry("data".getBytes());
  }
  ledgerDirsManager.addToFilledDirs(new File(ledgerDirs[0],"current"));
  try {
    ledger.addEntry("data".getBytes());
    fail("Should fail to add entry since there isn't enough bookies alive.");
  }
 catch (  BKException.BKNotEnoughBookiesException e) {
  }
  for (int i=0; i < 10 && bookie.isAlive(); i++) {
    Thread.sleep(1000);
  }
  assertFalse("Bookie should shutdown if readOnlyMode not enabled",bookie.isAlive());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.test.TestBackwardCompat </h4><pre class="type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test compatability between version 4.1.0 and the current version.
 * - A 4.1.0 client is not able to open a ledger created by the current
 * version due to a change in the ledger metadata format.
 * - Otherwise, they should be compatible.
 */
@Test(timeout=60000) public void testCompat410() throws Exception {
  File journalDir=createTempDir("bookie","journal");
  File ledgerDir=createTempDir("bookie","ledger");
  int port=PortManager.nextFreePort();
  Server410 s410=new Server410(journalDir,ledgerDir,port);
  s410.start();
  Ledger410 l410=Ledger410.newLedger();
  l410.write100();
  long oldLedgerId=l410.getId();
  l410.close();
  LedgerCurrent lcur=LedgerCurrent.newLedger();
  try {
    lcur.write100();
    fail("Shouldn't be able to write");
  }
 catch (  Exception e) {
  }
  lcur.close();
  s410.stop();
  ServerCurrent scur=new ServerCurrent(journalDir,ledgerDir,port,false);
  scur.start();
  l410=Ledger410.openLedger(oldLedgerId);
  assertEquals(100,l410.readAll());
  l410.close();
  l410=Ledger410.newLedger();
  l410.write100();
  l410.close();
  l410=Ledger410.newLedger();
  l410.write100();
  Ledger410 l410f=Ledger410.openLedger(l410.getId());
  try {
    l410.write100();
    fail("Shouldn't be able to write");
  }
 catch (  Exception e) {
  }
  l410f.close();
  try {
    l410.close();
    fail("Shouldn't be able to close");
  }
 catch (  Exception e) {
  }
  l410=Ledger410.newLedger();
  l410.write100();
  oldLedgerId=l410.getId();
  lcur=LedgerCurrent.openLedger(oldLedgerId);
  try {
    l410.write100();
    fail("Shouldn't be able to write");
  }
 catch (  Exception e) {
  }
  try {
    l410.close();
    fail("Shouldn't be able to close");
  }
 catch (  Exception e) {
  }
  lcur.close();
  l410=Ledger410.openLedger(oldLedgerId);
  assertEquals(100,l410.readAll());
  l410.close();
  lcur=LedgerCurrent.openLedger(oldLedgerId);
  assertEquals(100,lcur.readAll());
  lcur.close();
  lcur=LedgerCurrent.openLedger(oldLedgerId);
  assertEquals(100,lcur.readAll());
  lcur.close();
  lcur=LedgerCurrent.newLedger();
  lcur.write100();
  long fenceLedgerId=lcur.getId();
  try {
    l410=Ledger410.openLedger(fenceLedgerId);
    fail("Shouldn't be able to open ledger");
  }
 catch (  Exception e) {
  }
  lcur.write100();
  lcur.close();
  scur.stop();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test compatability between version old version and the current version.
 * - 4.1.0 server restarts with useHostNameAsBookieID=true.
 * - Write ledgers with old and new clients
 * - Read ledgers written by old clients.
 */
@Test(timeout=60000) public void testCompatWrites() throws Exception {
  File journalDir=createTempDir("bookie","journal");
  File ledgerDir=createTempDir("bookie","ledger");
  int port=PortManager.nextFreePort();
  Server410 s410=new Server410(journalDir,ledgerDir,port);
  s410.start();
  s410.stop();
  ServerCurrent scur=new ServerCurrent(journalDir,ledgerDir,port,true);
  scur.start();
  LedgerCurrent lcur=LedgerCurrent.newLedger();
  lcur.write100();
  lcur.close();
  final LedgerCurrent curledger=LedgerCurrent.openLedger(lcur.getId());
  assertEquals("Failed to read entries!",100,curledger.readAll());
  Ledger410 l410=Ledger410.newLedger();
  l410.write100();
  long oldLedgerId=l410.getId();
  l410.close();
  Ledger410 l420=Ledger410.newLedger();
  l420.write100();
  long lid420=l420.getId();
  l420.close();
  LedgerCurrent oldledger=LedgerCurrent.openLedger(oldLedgerId);
  assertEquals("Failed to read entries!",100,oldledger.readAll());
  oldledger.close();
  oldledger=LedgerCurrent.openLedger(lid420);
  assertEquals("Failed to read entries!",100,oldledger.readAll());
  oldledger.close();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test compatability between old versions and the current version.
 * - old server restarts with useHostNameAsBookieID=true.
 * - Read ledgers with old and new clients
 */
@Test(timeout=60000) public void testCompatReads() throws Exception {
  File journalDir=createTempDir("bookie","journal");
  File ledgerDir=createTempDir("bookie","ledger");
  int port=PortManager.nextFreePort();
  Server410 s410=new Server410(journalDir,ledgerDir,port);
  s410.start();
  Ledger410 l410=Ledger410.newLedger();
  l410.write100();
  long oldLedgerId=l410.getId();
  l410.close();
  Ledger420 l420=Ledger420.newLedger();
  l420.write100();
  long lid420=l420.getId();
  l420.close();
  s410.stop();
  ServerCurrent scur=new ServerCurrent(journalDir,ledgerDir,port,true);
  scur.start();
  l410=Ledger410.openLedger(oldLedgerId);
  assertEquals(100,l410.readAll());
  l410.close();
  l420=Ledger420.openLedger(lid420);
  assertEquals("Failed to read entries!",100,l420.readAll());
  l420.close();
  final LedgerCurrent curledger=LedgerCurrent.openLedger(lid420);
  assertEquals("Failed to read entries!",100,curledger.readAll());
  curledger.close();
}

</code></pre>

<br>
<pre class="type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test compatability between version 4.0.0 and the current version.
 * Incompatabilities are:
 * - Current client will not be able to talk to 4.0.0 server.
 * - 4.0.0 client will not be able to fence ledgers on current server.
 * - Current server won't start with 4.0.0 server directories without upgrade.
 */
@Test(timeout=60000) public void testCompat400() throws Exception {
  File journalDir=createTempDir("bookie","journal");
  File ledgerDir=createTempDir("bookie","ledger");
  int port=PortManager.nextFreePort();
  Server400 s400=new Server400(journalDir,ledgerDir,port);
  s400.start();
  Ledger400 l400=Ledger400.newLedger();
  l400.write100();
  long oldLedgerId=l400.getId();
  l400.close();
  LedgerCurrent lcur=LedgerCurrent.newLedger();
  try {
    lcur.write100();
    fail("Current shouldn't be able to write to 4.0.0 server");
  }
 catch (  Exception e) {
  }
  lcur.close();
  s400.stop();
  ServerCurrent scur=new ServerCurrent(journalDir,ledgerDir,port,false);
  try {
    scur.start();
    fail("Shouldn't be able to start without directory upgrade");
  }
 catch (  Exception e) {
  }
  FileSystemUpgrade.upgrade(scur.getConf());
  scur.start();
  l400=Ledger400.openLedger(oldLedgerId);
  assertEquals(100,l400.readAll());
  l400.close();
  l400=Ledger400.newLedger();
  l400.write100();
  l400.close();
  lcur=LedgerCurrent.openLedger(oldLedgerId);
  assertEquals(100,lcur.readAll());
  lcur.close();
  lcur=LedgerCurrent.openLedger(oldLedgerId);
  assertEquals(100,lcur.readAll());
  lcur.close();
  lcur=LedgerCurrent.newLedger();
  lcur.write100();
  long fenceLedgerId=lcur.getId();
  try {
    l400=Ledger400.openLedger(fenceLedgerId);
    fail("Shouldn't be able to open ledger");
  }
 catch (  Exception e) {
  }
  lcur.write100();
  lcur.close();
  lcur=LedgerCurrent.openLedger(fenceLedgerId);
  assertEquals(200,lcur.readAll());
  lcur.close();
  scur.stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.bookkeeper.zookeeper.TestZooKeeperClient </h4><pre class="type-2 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testRetrySyncOperations() throws Exception {
  final int timeout=2000;
  ZooKeeperClient client=ZooKeeperClient.createConnectedZooKeeperClient(zkUtil.getZooKeeperConnectString(),timeout,new HashSet<Watcher>(),new BoundExponentialBackoffRetryPolicy(timeout,timeout,Integer.MAX_VALUE));
  Assert.assertTrue("Client failed to connect an alive ZooKeeper.",client.getState().isConnected());
  String path="/a";
  byte[] data="test".getBytes();
  expireZooKeeperSession(client,timeout);
  logger.info("Create znode " + path);
  client.create(path,data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  logger.info("Created znode " + path);
  expireZooKeeperSession(client,timeout);
  logger.info("Exists znode " + path);
  Stat stat=client.exists(path,false);
  Assert.assertNotNull("znode doesn't existed",stat);
  expireZooKeeperSession(client,timeout);
  logger.info("Get data from znode " + path);
  Stat newStat=new Stat();
  client.getData(path,false,newStat);
  Assert.assertEquals(stat,newStat);
  expireZooKeeperSession(client,timeout);
  logger.info("Create children under znode " + path);
  client.create(path + "/children",data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expireZooKeeperSession(client,timeout);
  List<String> children=client.getChildren(path,false,newStat);
  Assert.assertEquals(1,children.size());
  Assert.assertEquals("children",children.get(0));
  logger.info("Get children under znode " + path);
  expireZooKeeperSession(client,timeout);
  client.delete(path + "/children",-1);
  logger.info("Delete children from znode " + path);
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testRetryAsyncOperations() throws Exception {
  final int timeout=2000;
  ZooKeeperClient client=ZooKeeperClient.createConnectedZooKeeperClient(zkUtil.getZooKeeperConnectString(),timeout,new HashSet<Watcher>(),new BoundExponentialBackoffRetryPolicy(timeout,timeout,Integer.MAX_VALUE));
  Assert.assertTrue("Client failed to connect an alive ZooKeeper.",client.getState().isConnected());
  String path="/a";
  byte[] data="test".getBytes();
  expireZooKeeperSession(client,timeout);
  logger.info("Create znode " + path);
  final CountDownLatch createLatch=new CountDownLatch(1);
  client.create(path,data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new StringCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    String name){
      if (KeeperException.Code.OK.intValue() == rc) {
        createLatch.countDown();
      }
    }
  }
,null);
  createLatch.await();
  logger.info("Created znode " + path);
  expireZooKeeperSession(client,timeout);
  logger.info("Exists znode " + path);
  final CountDownLatch existsLatch=new CountDownLatch(1);
  client.exists(path,false,new StatCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    Stat stat){
      if (KeeperException.Code.OK.intValue() == rc) {
        existsLatch.countDown();
      }
    }
  }
,null);
  existsLatch.await();
  expireZooKeeperSession(client,timeout);
  final CountDownLatch getLatch=new CountDownLatch(1);
  logger.info("Get data from znode " + path);
  client.getData(path,false,new DataCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    byte[] data,    Stat stat){
      if (KeeperException.Code.OK.intValue() == rc) {
        getLatch.countDown();
      }
    }
  }
,null);
  getLatch.await();
  expireZooKeeperSession(client,timeout);
  logger.info("Create children under znode " + path);
  final CountDownLatch createChildLatch=new CountDownLatch(1);
  client.create(path + "/children",data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new StringCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    String name){
      if (KeeperException.Code.OK.intValue() == rc) {
        createChildLatch.countDown();
      }
    }
  }
,null);
  createChildLatch.await();
  expireZooKeeperSession(client,timeout);
  final CountDownLatch getChildLatch=new CountDownLatch(1);
  final AtomicReference<List<String>> children=new AtomicReference<List<String>>();
  client.getChildren(path,false,new Children2Callback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    List<String> childList,    Stat stat){
      if (KeeperException.Code.OK.intValue() == rc) {
        children.set(childList);
        getChildLatch.countDown();
      }
    }
  }
,null);
  getChildLatch.await();
  Assert.assertNotNull(children.get());
  Assert.assertEquals(1,children.get().size());
  Assert.assertEquals("children",children.get().get(0));
  logger.info("Get children under znode " + path);
  expireZooKeeperSession(client,timeout);
  final CountDownLatch deleteChildLatch=new CountDownLatch(1);
  client.delete(path + "/children",-1,new VoidCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx){
      if (KeeperException.Code.OK.intValue() == rc) {
        deleteChildLatch.countDown();
      }
    }
  }
,null);
  deleteChildLatch.await();
  logger.info("Delete children from znode " + path);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.client.TestPubSubClient </h4><pre class="type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAsyncSubscribeWithListener() throws Exception {
  ByteString topic=ByteString.copyFromUtf8("myAsyncSubscribeWithListener");
  ByteString subscriberId=ByteString.copyFromUtf8("mysub");
  subscriber.addSubscriptionListener(new TestSubscriptionListener());
  SubscriptionOptions options=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).setEnableResubscribe(false).build();
  subscriber.asyncSubscribe(topic,subscriberId,options,new TestCallback(),null);
  assertTrue(queue.take());
  subscriber.startDelivery(topic,subscriberId,new TestMessageHandler());
  tearDownHubServer();
  assertEquals(SubscriptionEvent.TOPIC_MOVED,eventQueue.take());
}

</code></pre>

<br>
<pre class="type-8 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncSubscribeWithListener() throws Exception {
  ByteString topic=ByteString.copyFromUtf8("mySyncSubscribeWithListener");
  ByteString subscriberId=ByteString.copyFromUtf8("mysub");
  subscriber.addSubscriptionListener(new TestSubscriptionListener());
  try {
    SubscriptionOptions options=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).setEnableResubscribe(false).build();
    subscriber.subscribe(topic,subscriberId,options);
  }
 catch (  PubSubException.ServiceDownException e) {
    fail("Should not reach here!");
  }
  subscriber.startDelivery(topic,subscriberId,new TestMessageHandler());
  tearDownHubServer();
  assertEquals(SubscriptionEvent.TOPIC_MOVED,eventQueue.take());
}

</code></pre>

<br>
<pre class="type-2 type-11 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAsyncPublishWithResponse() throws Exception {
  ByteString topic=ByteString.copyFromUtf8("testAsyncPublishWithResponse");
  ByteString subid=ByteString.copyFromUtf8("mysubid");
  final String prefix="AsyncMessage-";
  final int numMessages=30;
  final AtomicInteger numPublished=new AtomicInteger(0);
  final CountDownLatch publishLatch=new CountDownLatch(1);
  final Map<String,MessageSeqId> publishedMsgs=new HashMap<String,MessageSeqId>();
  final AtomicInteger numReceived=new AtomicInteger(0);
  final CountDownLatch receiveLatch=new CountDownLatch(1);
  final Map<String,MessageSeqId> receivedMsgs=new HashMap<String,MessageSeqId>();
  SubscriptionOptions opts=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).build();
  subscriber.subscribe(topic,subid,opts);
  subscriber.startDelivery(topic,subid,new MessageHandler(){
    synchronized public void deliver(    ByteString topic,    ByteString subscriberId,    Message msg,    Callback<Void> callback,    Object context){
      String str=msg.getBody().toStringUtf8();
      receivedMsgs.put(str,msg.getMsgId());
      if (numMessages == numReceived.incrementAndGet()) {
        receiveLatch.countDown();
      }
      callback.operationFinished(context,null);
    }
  }
);
  for (int i=0; i < numMessages; i++) {
    final String str=prefix + i;
    ByteString data=ByteString.copyFromUtf8(str);
    Message msg=Message.newBuilder().setBody(data).build();
    publisher.asyncPublishWithResponse(topic,msg,new Callback<PublishResponse>(){
      @Override public void operationFinished(      Object ctx,      PublishResponse response){
        publishedMsgs.put(str,response.getPublishedMsgId());
        if (numMessages == numPublished.incrementAndGet()) {
          publishLatch.countDown();
        }
      }
      @Override public void operationFailed(      Object ctx,      final PubSubException exception){
        publishLatch.countDown();
      }
    }
,null);
  }
  assertTrue("Timed out waiting on callback for publish requests.",publishLatch.await(10,TimeUnit.SECONDS));
  assertEquals("Should be expected " + numMessages + " publishes.",numMessages,numPublished.get());
  assertEquals("Should be expected " + numMessages + " publishe responses.",numMessages,publishedMsgs.size());
  assertTrue("Timed out waiting on callback for messages.",receiveLatch.await(30,TimeUnit.SECONDS));
  assertEquals("Should be expected " + numMessages + " messages.",numMessages,numReceived.get());
  assertEquals("Should be expected " + numMessages + " messages in map.",numMessages,receivedMsgs.size());
  for (int i=0; i < numMessages; i++) {
    final String str=prefix + i;
    MessageSeqId pubId=publishedMsgs.get(str);
    MessageSeqId revId=receivedMsgs.get(str);
    assertTrue("Doesn't receive same message seq id for " + str,pubId.equals(revId));
  }
}

</code></pre>

<br>
<pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncSubscribeWithListenerWhenReleasingTopic() throws Exception {
  client.close();
  tearDownHubServer();
  startHubServer(new RetentionServerConfiguration());
  client=new HedwigClient(new ClientConfiguration(){
    @Override public HedwigSocketAddress getDefaultServerHedwigSocketAddress(){
      return getDefaultHedwigAddress();
    }
    @Override public boolean isSubscriptionChannelSharingEnabled(){
      return TestPubSubClient.this.isSubscriptionChannelSharingEnabled;
    }
  }
);
  publisher=client.getPublisher();
  subscriber=client.getSubscriber();
  ByteString topic=ByteString.copyFromUtf8("mySyncSubscribeWithListenerWhenReleasingTopic");
  ByteString subscriberId=ByteString.copyFromUtf8("mysub");
  subscriber.addSubscriptionListener(new TestSubscriptionListener());
  SubscriptionOptions options=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).setForceAttach(false).setEnableResubscribe(false).build();
  try {
    subscriber.subscribe(topic,subscriberId,options);
  }
 catch (  PubSubException.ServiceDownException e) {
    fail("Should not reach here!");
  }
  subscriber.startDelivery(topic,subscriberId,new TestMessageHandler());
  publisher.asyncPublish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8("Message #1")).build(),new TestCallback(),null);
  assertTrue(queue.take());
  assertTrue(consumeQueue.take());
  Thread.sleep(RETENTION_SECS_VALUE * 2);
  assertEquals(SubscriptionEvent.TOPIC_MOVED,eventQueue.take());
}

</code></pre>

<br>
<pre class="type-8 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncSubscribeForceAttach() throws Exception {
  ByteString topic=ByteString.copyFromUtf8("mySyncSubscribeForceAttach");
  ByteString subscriberId=ByteString.copyFromUtf8("mysub");
  subscriber.addSubscriptionListener(new TestSubscriptionListener());
  SubscriptionOptions options=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).setForceAttach(true).setEnableResubscribe(false).build();
  try {
    subscriber.subscribe(topic,subscriberId,options);
  }
 catch (  PubSubException.ServiceDownException e) {
    fail("Should not reach here!");
  }
  subscriber.startDelivery(topic,subscriberId,new TestMessageHandler());
  HedwigClient client2=new HedwigClient(new ClientConfiguration(){
    @Override public HedwigSocketAddress getDefaultServerHedwigSocketAddress(){
      return getDefaultHedwigAddress();
    }
  }
);
  Subscriber subscriber2=client2.getSubscriber();
  Publisher publisher2=client2.getPublisher();
  SynchronousQueue<SubscriptionEvent> eventQueue2=new SynchronousQueue<SubscriptionEvent>();
  subscriber2.addSubscriptionListener(new TestSubscriptionListener(eventQueue2));
  try {
    subscriber2.subscribe(topic,subscriberId,options);
  }
 catch (  PubSubException.ServiceDownException e) {
    fail("Should not reach here!");
  }
  SynchronousQueue<Boolean> consumeQueue2=new SynchronousQueue<Boolean>();
  subscriber2.startDelivery(topic,subscriberId,new TestMessageHandler(consumeQueue2));
  assertEquals(SubscriptionEvent.SUBSCRIPTION_FORCED_CLOSED,eventQueue.take());
  assertTrue(eventQueue2.isEmpty());
  publisher.asyncPublish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8("Message #1")).build(),new TestCallback(),null);
  assertTrue(queue.take());
  assertTrue(consumeQueue2.take());
  assertTrue(consumeQueue.isEmpty());
  publisher2.asyncPublish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8("Message #2")).build(),new TestCallback(),null);
  assertTrue(queue.take());
  assertTrue(consumeQueue2.take());
  assertTrue(consumeQueue.isEmpty());
  client2.close();
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncPublishWithResponse() throws Exception {
  ByteString topic=ByteString.copyFromUtf8("testSyncPublishWithResponse");
  ByteString subid=ByteString.copyFromUtf8("mysubid");
  final String prefix="SyncMessage-";
  final int numMessages=30;
  final Map<String,MessageSeqId> publishedMsgs=new HashMap<String,MessageSeqId>();
  final AtomicInteger numReceived=new AtomicInteger(0);
  final CountDownLatch receiveLatch=new CountDownLatch(1);
  final Map<String,MessageSeqId> receivedMsgs=new HashMap<String,MessageSeqId>();
  SubscriptionOptions opts=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).build();
  subscriber.subscribe(topic,subid,opts);
  subscriber.startDelivery(topic,subid,new MessageHandler(){
    synchronized public void deliver(    ByteString topic,    ByteString subscriberId,    Message msg,    Callback<Void> callback,    Object context){
      String str=msg.getBody().toStringUtf8();
      receivedMsgs.put(str,msg.getMsgId());
      if (numMessages == numReceived.incrementAndGet()) {
        receiveLatch.countDown();
      }
      callback.operationFinished(context,null);
    }
  }
);
  for (int i=0; i < numMessages; i++) {
    String str=prefix + i;
    ByteString data=ByteString.copyFromUtf8(str);
    Message msg=Message.newBuilder().setBody(data).build();
    PublishResponse response=publisher.publish(topic,msg);
    assertNotNull(response);
    publishedMsgs.put(str,response.getPublishedMsgId());
  }
  assertTrue("Timed out waiting on callback for messages.",receiveLatch.await(30,TimeUnit.SECONDS));
  assertEquals("Should be expected " + numMessages + " messages.",numMessages,numReceived.get());
  assertEquals("Should be expected " + numMessages + " messages in map.",numMessages,receivedMsgs.size());
  for (int i=0; i < numMessages; i++) {
    final String str=prefix + i;
    MessageSeqId pubId=publishedMsgs.get(str);
    MessageSeqId revId=receivedMsgs.get(str);
    assertTrue("Doesn't receive same message seq id for " + str,pubId.equals(revId));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.jms.selector.BasicSelectorGrammarTest </h4><pre class="type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasicLookup() throws ParseException {
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " = " + BOOLEAN_VALUE1),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " <> " + BOOLEAN_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " = " + INT_VALUE1),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " <> " + INT_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " = " + DOUBLE_VALUE1),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " <> " + DOUBLE_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " = '" + STRING_VALUE1+ "'"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " <> '" + STRING_VALUE1+ "'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " = '" + STRING_QUOTED_QUOTES_VALUE+ "'"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " <> '" + STRING_QUOTED_QUOTES_VALUE+ "'"),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " = " + INT_VALUE1),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " = " + DOUBLE_VALUE1),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector("unknown_header = " + STRING_VALUE1),message));
}

</code></pre>

<br>
<pre class="type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFunctions() throws ParseException {
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER2 + " IS NOT NULL"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " IS NULL"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector("unknown_header is null"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER2 + " BETWEEN 1 AND 2"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(" ( - " + INT_HEADER1 + " * 2 + "+ DOUBLE_HEADER1+ " * 4 ) / 10.0 between 0 and 3 * "+ INT_HEADER2+ " * 2.4"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER2 + " not between (0.4 * 2 + (0.01 + 0.3 * 0.2) ) AND 10.0"),message));
  Assert.assertEquals(Boolean.FALSE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER2 + " NOT BETWEEN (0.4 * 2 + (0.01 + 0.3 * 0.2) + " + DOUBLE_VALUE1+ " / 10.0 ) AND 10.0"),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " * 2 + " + DOUBLE_HEADER1+ " / 1.4 NOT BETWEEN (0.4 * 2 + (0.01 + 0.3 * 0.2) + "+ DOUBLE_VALUE1+ " / 10.0 ) AND 10.0"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER3 + " IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "', '"+ STRING_QUOTED_QUOTES_VALUE+ "') "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "', '"+ STRING_QUOTED_QUOTES_VALUE+ "') "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_QUOTES_HEADER + " NOT IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "') "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " NOT IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "') "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(BOOLEAN_HEADER1 + " IN ( '" + STRING_VALUE1+ "', '"+ STRING_VALUE2+ "', '"+ STRING_VALUE3+ "', '"+ STRING_VALUE4+ "') "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " LIKE 'header\\_%' ESCAPE '\\'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_LIKE_HEADER + " LIKE '% with a \\_ and \\%%' ESCAPE '\\'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_LIKE_HEADER + " LIKE '%\n%'"),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_LIKE_HEADER + " NOT LIKE '%\r%'"),message));
}

</code></pre>

<br>
<pre class="type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testArithmetic() throws ParseException {
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " + " + INT_HEADER2+ " > "+ INT_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(INT_HEADER1 + " + ( 2 * " + INT_HEADER2+ " + "+ INT_HEADER1+ " ) < "+ " 4 * ( "+ INT_HEADER1+ " + "+ INT_VALUE2+ " ) "),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " + " + DOUBLE_HEADER2+ " > "+ DOUBLE_VALUE1),message));
  Assert.assertEquals(Boolean.TRUE,SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(DOUBLE_HEADER1 + " * 7.5 + 1 + 2 * ( " + DOUBLE_HEADER2+ " + 2.0 * "+ DOUBLE_HEADER1+ " ) = "+ " 0.5 + 4 * ( 2.0 * "+ DOUBLE_HEADER1+ " + "+ DOUBLE_VALUE2+ " ) "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(STRING_HEADER1 + " * 4 + " + DOUBLE_HEADER1+ " * 7.5 + 1 + 2 * ( "+ DOUBLE_HEADER2+ "+ 2.0 * "+ DOUBLE_HEADER1+ " ) = "+ " 0.5 + 4 * ( 2.0 * "+ DOUBLE_HEADER1+ " + "+ DOUBLE_VALUE2+ " ) "),message));
  Assert.assertNull(SelectorParser.evaluateSelector(SelectorParser.parseMessageSelector(" unknown_header * 4 + " + DOUBLE_HEADER1 + " * 7.5 + 1 + 2 * ( "+ DOUBLE_HEADER2+ " + 2.0 * "+ DOUBLE_HEADER1+ " ) = "+ " 0.5 + 4 * ( 2.0 * "+ DOUBLE_HEADER1+ " + "+ DOUBLE_VALUE2+ " ) "),message));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.delivery.TestFIFODeliveryManager </h4><pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test throttle race issue cause by messageConsumed and doDeliverNextMessage{@link https://issues.apache.org/jira/browse/BOOKKEEPER-503}
 */
@Test(timeout=60000) public void testFIFODeliveryThrottlingRace() throws Exception {
  final int numMessages=20;
  final int throttleSize=10;
  ServerConfiguration conf=new ServerConfiguration(){
    @Override public int getDefaultMessageWindowSize(){
      return throttleSize;
    }
  }
;
  ByteString topic=ByteString.copyFromUtf8("throttlingRaceTopic");
  ByteString subscriber=ByteString.copyFromUtf8("throttlingRaceSubscriber");
  PersistenceManager pm=new StubPersistenceManager();
  FIFODeliveryManager fdm=new FIFODeliveryManager(new StubTopicManager(conf),pm,conf);
  ExecutorDeliveryEndPoint dep=new ExecutorDeliveryEndPoint(fdm);
  SubscriptionPreferences prefs=SubscriptionPreferences.newBuilder().build();
  PipelineFilter filter=new PipelineFilter();
  filter.addLast(new AllToAllTopologyFilter());
  filter.initialize(conf.getConf());
  filter.setSubscriptionPreferences(topic,subscriber,prefs);
  CountDownLatch l=new CountDownLatch(numMessages);
  TestCallback firstCallback=null;
  for (int i=0; i < numMessages; i++) {
    Message m=Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(i))).build();
    TestCallback cb=new TestCallback(l);
    if (firstCallback == null) {
      firstCallback=cb;
    }
    pm.persistMessage(new PersistRequest(topic,m,cb,null));
  }
  fdm.start();
  assertTrue("Persistence never finished",l.await(10,TimeUnit.SECONDS));
  fdm.startServingSubscription(topic,subscriber,prefs,firstCallback.getId(),dep,filter,new Callback<Void>(){
    @Override public void operationFinished(    Object ctx,    Void result){
    }
    @Override public void operationFailed(    Object ctx,    PubSubException exception){
    }
  }
,null);
  int count=30;
  while (dep.getNumDelivered() < numMessages) {
    Thread.sleep(1000);
    if (count-- == 0) {
      break;
    }
  }
  assertEquals("Should have delivered " + numMessages,numMessages,dep.getNumDelivered());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.handlers.TestBaseHandler </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testHandleRequestOnError() throws Exception {
  tm.setShouldError(true);
  handler.handleRequest(request,channel);
  PubSubResponse response=getPubSubResponse(channel);
  assertEquals(response.getStatusCode(),StatusCode.SERVICE_DOWN);
  assertEquals(request.getTxnId(),response.getTxnId());
  assertNull(handler.getRequest());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testHandleRequestOnRedirect() throws Exception {
  tm.setShouldOwnEveryNewTopic(false);
  handler.handleRequest(request,channel);
  PubSubResponse response=getPubSubResponse(channel);
  assertEquals(response.getStatusCode(),StatusCode.NOT_RESPONSIBLE_FOR_TOPIC);
  assertEquals(request.getTxnId(),response.getTxnId());
  assertNull(handler.getRequest());
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testHandleRequestOnOwner() throws Exception {
  tm.setShouldOwnEveryNewTopic(true);
  handler.handleRequest(request,channel);
  assertEquals(0,channel.getMessagesWritten().size());
  assertEquals(handler.getRequest(),request);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.handlers.TestSubUnsubHandler </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testNoSubscribeRequest(){
  sh.handleRequestAtOwner(PubSubRequest.newBuilder(pubSubRequestPrototype).clearSubscribeRequest().build(),channel);
  assertEquals(StatusCode.MALFORMED_REQUEST,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSuccessCase(){
  StubCallback<Void> callback=new StubCallback<Void>();
  sm.acquiredTopic(topic,callback,null);
  assertNull(ConcurrencyUtils.take(callback.queue).right());
  sh.handleRequestAtOwner(pubSubRequestPrototype,channel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  Set<TopicSubscriber> topicSubs=new HashSet<TopicSubscriber>();
  topicSubs.add(new TopicSubscriber(topic,subscriberId));
  assertEquals(topicSubs,subChannelMgr.channel2sub.get(channel));
  assertEquals(channel,subChannelMgr.sub2Channel.get(new TopicSubscriber(topic,subscriberId)));
  StartServingRequest startRequest=(StartServingRequest)dm.lastRequest.poll();
  assertEquals(channel,((ChannelEndPoint)startRequest.endPoint).getChannel());
  assertEquals(PipelineFilter.class,startRequest.filter.getClass());
  PipelineFilter pfilter=(PipelineFilter)(startRequest.filter);
  assertEquals(1,pfilter.size());
  assertEquals(AllToAllTopologyFilter.class,pfilter.getFirst().getClass());
  assertEquals(1,startRequest.seqIdToStartFrom.getLocalComponent());
  assertEquals(subscriberId,startRequest.subscriberId);
  assertEquals(topic,startRequest.topic);
  StubCallback<SubscriptionData> callback1=new StubCallback<SubscriptionData>();
  sm.serveSubscribeRequest(topic,SubscribeRequest.newBuilder(subRequestPrototype).setCreateOrAttach(CreateOrAttach.CREATE).build(),MessageSeqId.newBuilder().setLocalComponent(10).build(),callback1,null);
  assertEquals(PubSubException.ClientAlreadySubscribedException.class,ConcurrencyUtils.take(callback1.queue).right().getClass());
  WriteRecordingChannel dupChannel=new WriteRecordingChannel();
  sh.handleRequestAtOwner(pubSubRequestPrototype,dupChannel);
  assertEquals(StatusCode.TOPIC_BUSY,((PubSubResponse)dupChannel.getMessagesWritten().get(0)).getStatusCode());
  subChannelMgr.channelDisconnected(channel);
  dupChannel=new WriteRecordingChannel();
  sh.handleRequestAtOwner(pubSubRequestPrototype,dupChannel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)dupChannel.getMessagesWritten().get(0)).getStatusCode());
  channel=new WriteRecordingChannel();
  ush.handleRequestAtOwner(pubSubRequestPrototype,channel);
  assertEquals(StatusCode.MALFORMED_REQUEST,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  PubSubRequest unsubRequest=PubSubRequest.newBuilder(pubSubRequestPrototype).setUnsubscribeRequest(UnsubscribeRequest.newBuilder().setSubscriberId(subscriberId)).build();
  channel=new WriteRecordingChannel();
  dm.lastRequest.clear();
  ush.handleRequestAtOwner(unsubRequest,channel);
  assertEquals(StatusCode.SUCCESS,((PubSubResponse)channel.getMessagesWritten().get(0)).getStatusCode());
  assertEquals(new TopicSubscriber(topic,subscriberId),dm.lastRequest.poll());
  StubCallback<SubscriptionData> callback2=new StubCallback<SubscriptionData>();
  sm.serveSubscribeRequest(topic,SubscribeRequest.newBuilder(subRequestPrototype).setCreateOrAttach(CreateOrAttach.ATTACH).build(),MessageSeqId.newBuilder().setLocalComponent(10).build(),callback2,null);
  assertEquals(PubSubException.ClientNotSubscribedException.class,ConcurrencyUtils.take(callback2.queue).right().getClass());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.meta.TestFactoryLayout </h4><pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testFactoryLayout() throws Exception {
  ServerConfiguration conf=new ServerConfiguration();
  conf.setMetadataManagerFactoryName("org.apache.hedwig.server.meta.ZkMetadataManager");
  FactoryLayout layout=FactoryLayout.readLayout(zk,conf);
  Assert.assertTrue("Layout should be null",layout == null);
  String testName="foobar";
  int testVersion=0xdeadbeef;
  writeFactoryLayout(conf,testName,testVersion);
  layout=FactoryLayout.readLayout(zk,conf);
  Assert.assertEquals(testName,layout.getManagerMeta().getManagerImpl());
  Assert.assertEquals(testVersion,layout.getManagerMeta().getManagerVersion());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.meta.TestMetadataManager </h4><pre class="type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testPersistenceInfo() throws Exception {
  TopicPersistenceManager tpManager=metadataManagerFactory.newTopicPersistenceManager();
  ByteString topic=ByteString.copyFromUtf8("testPersistenceInfo");
  StubCallback<Versioned<LedgerRanges>> readCallback=new StubCallback<Versioned<LedgerRanges>>();
  StubCallback<Version> writeCallback=new StubCallback<Version>();
  StubCallback<Void> deleteCallback=new StubCallback<Void>();
  tpManager.writeTopicPersistenceInfo(topic,LedgerRanges.getDefaultInstance(),Version.NEW,writeCallback,null);
  Either<Version,PubSubException> res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v1=res.left();
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  Versioned<LedgerRanges> ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(ranges.getVersion()));
  Assert.assertEquals(LedgerRanges.getDefaultInstance(),ranges.getValue());
  LedgerRange lastRange=LedgerRange.newBuilder().setLedgerId(1).build();
  LedgerRanges.Builder builder=LedgerRanges.newBuilder();
  builder.addRanges(lastRange);
  LedgerRanges newRanges=builder.build();
  tpManager.writeTopicPersistenceInfo(topic,newRanges,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.TopicPersistenceInfoExistsException);
  tpManager.writeTopicPersistenceInfo(topic,newRanges,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v2=res.left();
  Assert.assertEquals(Version.Occurred.AFTER,v2.compare(v1));
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  lastRange=LedgerRange.newBuilder().setLedgerId(2).build();
  builder=LedgerRanges.newBuilder();
  builder.addRanges(lastRange);
  LedgerRanges newRanges2=builder.build();
  tpManager.writeTopicPersistenceInfo(topic,newRanges2,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.BadVersionException);
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  tpManager.deleteTopicPersistenceInfo(topic,v1,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.BadVersionException);
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  ranges=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(ranges.getVersion()));
  Assert.assertEquals(newRanges,ranges.getValue());
  tpManager.deleteTopicPersistenceInfo(topic,v2,deleteCallback,null);
  Assert.assertEquals(null,deleteCallback.queue.take().right());
  tpManager.readTopicPersistenceInfo(topic,readCallback,null);
  Assert.assertEquals(null,readCallback.queue.take().left());
  tpManager.deleteTopicPersistenceInfo(topic,Version.ANY,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.NoTopicPersistenceInfoException);
  tpManager.close();
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSubscriptionData() throws Exception {
  SubscriptionDataManager subManager=metadataManagerFactory.newSubscriptionDataManager();
  ByteString topic=ByteString.copyFromUtf8("testSubscriptionData");
  ByteString subid=ByteString.copyFromUtf8("mysub");
  final StubCallback<Version> callback=new StubCallback<Version>();
  StubCallback<Versioned<SubscriptionData>> readCallback=new StubCallback<Versioned<SubscriptionData>>();
  StubCallback<Map<ByteString,Versioned<SubscriptionData>>> subsCallback=new StubCallback<Map<ByteString,Versioned<SubscriptionData>>>();
  subManager.readSubscriptionData(topic,subid,readCallback,null);
  Either<Versioned<SubscriptionData>,PubSubException> readRes=readCallback.queue.take();
  Assert.assertEquals("Found inconsistent subscription state",null,readRes.left());
  Assert.assertEquals("Should not fail with PubSubException",null,readRes.right());
  subManager.readSubscriptions(topic,subsCallback,null);
  Either<Map<ByteString,Versioned<SubscriptionData>>,PubSubException> res=subsCallback.queue.take();
  Assert.assertEquals("Found more than 0 subscribers",0,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  if (subManager.isPartialUpdateSupported()) {
    subManager.updateSubscriptionData(topic,subid,SubscriptionData.getDefaultInstance(),Version.ANY,callback,null);
  }
 else {
    subManager.replaceSubscriptionData(topic,subid,SubscriptionData.getDefaultInstance(),Version.ANY,callback,null);
  }
  Assert.assertTrue("Should fail to update a non-existed subscriber with PubSubException",callback.queue.take().right() instanceof PubSubException.NoSubscriptionStateException);
  Callback<Void> voidCallback=new Callback<Void>(){
    @Override public void operationFinished(    Object ctx,    Void resultOfOperation){
      callback.operationFinished(ctx,null);
    }
    @Override public void operationFailed(    Object ctx,    PubSubException exception){
      callback.operationFailed(ctx,exception);
    }
  }
;
  subManager.deleteSubscriptionData(topic,subid,Version.ANY,voidCallback,null);
  Assert.assertTrue("Should fail to delete a non-existed subscriber with PubSubException",callback.queue.take().right() instanceof PubSubException.NoSubscriptionStateException);
  long seqId=10;
  MessageSeqId.Builder builder=MessageSeqId.newBuilder();
  builder.setLocalComponent(seqId);
  MessageSeqId msgId=builder.build();
  SubscriptionState.Builder stateBuilder=SubscriptionState.newBuilder(SubscriptionState.getDefaultInstance()).setMsgId(msgId);
  SubscriptionData data=SubscriptionData.newBuilder().setState(stateBuilder).build();
  subManager.createSubscriptionData(topic,subid,data,callback,null);
  Either<Version,PubSubException> cbResult=callback.queue.take();
  Version v1=cbResult.left();
  Assert.assertEquals("Should not fail with PubSubException",null,cbResult.right());
  subManager.readSubscriptions(topic,subsCallback,null);
  res=subsCallback.queue.take();
  Assert.assertEquals("Should find just 1 subscriber",1,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  Versioned<SubscriptionData> versionedSubData=res.left().get(subid);
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(versionedSubData.getVersion()));
  SubscriptionData imss=versionedSubData.getValue();
  Assert.assertEquals("Found inconsistent subscription state",data,imss);
  Assert.assertEquals("Found inconsistent last consumed seq id",seqId,imss.getState().getMsgId().getLocalComponent());
  seqId=99;
  builder=MessageSeqId.newBuilder();
  builder.setLocalComponent(seqId);
  msgId=builder.build();
  stateBuilder=SubscriptionState.newBuilder(data.getState()).setMsgId(msgId);
  data=SubscriptionData.newBuilder().setState(stateBuilder).build();
  if (subManager.isPartialUpdateSupported()) {
    subManager.updateSubscriptionData(topic,subid,data,versionedSubData.getVersion(),callback,null);
  }
 else {
    subManager.replaceSubscriptionData(topic,subid,data,versionedSubData.getVersion(),callback,null);
  }
  cbResult=callback.queue.take();
  Assert.assertEquals("Fail to update a subscription state",null,cbResult.right());
  Version v2=cbResult.left();
  subManager.readSubscriptionData(topic,subid,readCallback,null);
  Assert.assertEquals("Found inconsistent subscription state",data,readCallback.queue.take().left().getValue());
  subManager.readSubscriptions(topic,subsCallback,null);
  res=subsCallback.queue.take();
  Assert.assertEquals("Should find just 1 subscriber",1,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  versionedSubData=res.left().get(subid);
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(versionedSubData.getVersion()));
  imss=res.left().get(subid).getValue();
  Assert.assertEquals("Found inconsistent subscription state",data,imss);
  Assert.assertEquals("Found inconsistent last consumed seq id",seqId,imss.getState().getMsgId().getLocalComponent());
  if (subManager.isPartialUpdateSupported()) {
    subManager.updateSubscriptionData(topic,subid,data,v1,callback,null);
  }
 else {
    subManager.replaceSubscriptionData(topic,subid,data,v1,callback,null);
  }
  Assert.assertTrue(callback.queue.take().right() instanceof PubSubException.BadVersionException);
  subManager.deleteSubscriptionData(topic,subid,v1,voidCallback,null);
  Assert.assertTrue(callback.queue.take().right() instanceof PubSubException.BadVersionException);
  subManager.deleteSubscriptionData(topic,subid,res.left().get(subid).getVersion(),voidCallback,null);
  Assert.assertEquals("Fail to delete an existed subscriber",null,callback.queue.take().right());
  subManager.readSubscriptions(topic,subsCallback,null);
  res=subsCallback.queue.take();
  Assert.assertEquals("Found more than 0 subscribers",0,res.left().size());
  Assert.assertEquals("Should not fail with PubSubException",null,res.right());
  subManager.close();
}

</code></pre>

<br>
<pre class="type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testOwnerInfo() throws Exception {
  TopicOwnershipManager toManager=metadataManagerFactory.newTopicOwnershipManager();
  ByteString topic=ByteString.copyFromUtf8("testOwnerInfo");
  StubCallback<Versioned<HubInfo>> readCallback=new StubCallback<Versioned<HubInfo>>();
  StubCallback<Version> writeCallback=new StubCallback<Version>();
  StubCallback<Void> deleteCallback=new StubCallback<Void>();
  Either<Version,PubSubException> res;
  HubInfo owner=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),999);
  toManager.writeOwnerInfo(topic,owner,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v1=res.left();
  toManager.readOwnerInfo(topic,readCallback,null);
  Versioned<HubInfo> hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v1.compare(hubInfo.getVersion()));
  Assert.assertEquals(owner,hubInfo.getValue());
  HubInfo newOwner=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),1000);
  toManager.writeOwnerInfo(topic,newOwner,Version.NEW,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.TopicOwnerInfoExistsException);
  toManager.writeOwnerInfo(topic,newOwner,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertEquals(null,res.right());
  Version v2=res.left();
  Assert.assertEquals(Version.Occurred.AFTER,v2.compare(v1));
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  Assert.assertEquals(newOwner,hubInfo.getValue());
  HubInfo newOwner2=new HubInfo(new HedwigSocketAddress("127.0.0.1",8008),1001);
  toManager.writeOwnerInfo(topic,newOwner2,v1,writeCallback,null);
  res=writeCallback.queue.take();
  Assert.assertNotNull(res.right());
  Assert.assertTrue(res.right() instanceof PubSubException.BadVersionException);
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  Assert.assertEquals(newOwner,hubInfo.getValue());
  toManager.deleteOwnerInfo(topic,v1,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.BadVersionException);
  toManager.readOwnerInfo(topic,readCallback,null);
  hubInfo=readCallback.queue.take().left();
  Assert.assertEquals(Version.Occurred.CONCURRENTLY,v2.compare(hubInfo.getVersion()));
  toManager.deleteOwnerInfo(topic,v2,deleteCallback,null);
  Assert.assertEquals(null,deleteCallback.queue.take().right());
  toManager.readOwnerInfo(topic,readCallback,null);
  Assert.assertEquals(null,readCallback.queue.take().left());
  toManager.deleteOwnerInfo(topic,Version.ANY,deleteCallback,null);
  Assert.assertTrue(deleteCallback.queue.take().right() instanceof PubSubException.NoTopicOwnerInfoException);
  toManager.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.meta.TestMetadataManagerFactory </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testConcurrent2() throws Exception {
  int numThreadsEach=25;
  String root0="/lmroot0";
  CyclicBarrier barrier=new CyclicBarrier(numThreadsEach * 2 + 1);
  List<CreateMMThread> threadsA=new ArrayList<CreateMMThread>(numThreadsEach);
  for (int i=0; i < numThreadsEach; i++) {
    CreateMMThread t=new CreateMMThread(root0,ZkMetadataManagerFactory.class.getName(),barrier);
    t.start();
    threadsA.add(t);
  }
  List<CreateMMThread> threadsB=new ArrayList<CreateMMThread>(numThreadsEach);
  for (int i=0; i < numThreadsEach; i++) {
    CreateMMThread t=new CreateMMThread(root0,DummyMetadataManagerFactory.class.getName(),barrier);
    t.start();
    threadsB.add(t);
  }
  barrier.await();
  int numSuccess=0;
  int numFails=0;
  for (  CreateMMThread t : threadsA) {
    t.join();
    t.close();
    if (t.isSuccessful()) {
      numSuccess++;
    }
 else {
      numFails++;
    }
  }
  for (  CreateMMThread t : threadsB) {
    t.join();
    t.close();
    if (t.isSuccessful()) {
      numSuccess++;
    }
 else {
      numFails++;
    }
  }
  Assert.assertEquals("Incorrect number of successes",numThreadsEach,numSuccess);
  Assert.assertEquals("Incorrect number of failures",numThreadsEach,numFails);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.netty.TestPubSubServer </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testUncaughtExceptionInNettyThread() throws Exception {
  SynchronousQueue<Throwable> queue=new SynchronousQueue<Throwable>();
  RecordingUncaughtExceptionHandler uncaughtExceptionHandler=new RecordingUncaughtExceptionHandler(queue);
  final int port=PortManager.nextFreePort();
  PubSubServer server=startServer(uncaughtExceptionHandler,port,new TopicManagerInstantiator(){
    @Override public TopicManager instantiateTopicManager() throws IOException {
      return new AbstractTopicManager(new ServerConfiguration(),Executors.newSingleThreadScheduledExecutor()){
        @Override protected void realGetOwner(        ByteString topic,        boolean shouldClaim,        Callback<HedwigSocketAddress> cb,        Object ctx){
          throw new RuntimeException("this exception should be uncaught");
        }
        @Override protected void postReleaseCleanup(        ByteString topic,        Callback<Void> cb,        Object ctx){
        }
      }
;
    }
  }
);
  runPublishRequest(port);
  assertEquals(RuntimeException.class,queue.take().getClass());
  server.shutdown();
}

</code></pre>

<br>
<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testUncaughtExceptionInZKThread() throws Exception {
  SynchronousQueue<Throwable> queue=new SynchronousQueue<Throwable>();
  RecordingUncaughtExceptionHandler uncaughtExceptionHandler=new RecordingUncaughtExceptionHandler(queue);
  final int port=PortManager.nextFreePort();
  final String hostPort="127.0.0.1:" + PortManager.nextFreePort();
  PubSubServer server=startServer(uncaughtExceptionHandler,port,new TopicManagerInstantiator(){
    @Override public TopicManager instantiateTopicManager() throws IOException {
      return new AbstractTopicManager(new ServerConfiguration(),Executors.newSingleThreadScheduledExecutor()){
        @Override protected void realGetOwner(        ByteString topic,        boolean shouldClaim,        Callback<HedwigSocketAddress> cb,        Object ctx){
          ZooKeeper zookeeper;
          try {
            zookeeper=new ZooKeeper(hostPort,60000,new Watcher(){
              @Override public void process(              WatchedEvent event){
              }
            }
);
          }
 catch (          IOException e) {
            throw new RuntimeException(e);
          }
          zookeeper.getData("/fake",false,new SafeAsyncZKCallback.DataCallback(){
            @Override public void safeProcessResult(            int rc,            String path,            Object ctx,            byte[] data,            org.apache.zookeeper.data.Stat stat){
              throw new RuntimeException("This should go to the uncaught exception handler");
            }
          }
,null);
        }
        @Override protected void postReleaseCleanup(        ByteString topic,        Callback<Void> cb,        Object ctx){
        }
      }
;
    }
  }
);
  runPublishRequest(port);
  assertEquals(RuntimeException.class,queue.take().getClass());
  server.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.netty.TestServerStats </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests that updatLatency should not fail with
 * ArrayIndexOutOfBoundException when latency time coming as negative.
 */
@Test(timeout=60000) public void testUpdateLatencyShouldNotFailWithAIOBEWithNegativeLatency() throws Exception {
  OpStats opStat=new OpStats();
  opStat.updateLatency(-10);
  assertEquals("Should not update any latency metrics",0,opStat.numSuccessOps);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.MessageBoundedPersistenceTest </h4><pre class="type-2 type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLedgerGC() throws Exception {
  Client client=new HedwigClient(new MessageBoundClientConfiguration());
  Publisher pub=client.getPublisher();
  Subscriber sub=client.getSubscriber();
  String ledgersPath="/hedwig/standalone/topics/testGCTopic/ledgers";
  ByteString topic=ByteString.copyFromUtf8("testGCTopic");
  ByteString subid=ByteString.copyFromUtf8("testGCSubId");
  SubscriptionOptions opts=SubscriptionOptions.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE_OR_ATTACH).build();
  sub.subscribe(topic,subid,opts);
  sub.closeSubscription(topic,subid);
  for (int i=1; i <= 100; i++) {
    pub.publish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(i))).build());
  }
  LedgerRanges r=LedgerRanges.parseFrom(bktb.getZooKeeperClient().getData(ledgersPath,false,null));
  assertEquals("Should only have 1 ledger yet",1,r.getRangesList().size());
  long firstLedger=r.getRangesList().get(0).getLedgerId();
  stopHubServers();
  startHubServers();
  pub.publish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(0xdeadbeef))).build());
  r=LedgerRanges.parseFrom(bktb.getZooKeeperClient().getData(ledgersPath,false,null));
  assertEquals("Should have 2 ledgers after restart",2,r.getRangesList().size());
  for (int i=100; i <= 200; i++) {
    pub.publish(topic,Message.newBuilder().setBody(ByteString.copyFromUtf8(String.valueOf(i))).build());
  }
  Thread.sleep(5000);
  r=LedgerRanges.parseFrom(bktb.getZooKeeperClient().getData(ledgersPath,false,null));
  long secondLedger=r.getRangesList().get(0).getLedgerId();
  assertEquals("Should only have 1 ledger after GC",1,r.getRangesList().size());
  String firstLedgerPath=String.format("/ledgers/L%010d",firstLedger);
  String secondLedgerPath=String.format("/ledgers/L%010d",secondLedger);
  assertNull("Ledger should not exist",bktb.getZooKeeperClient().exists(firstLedgerPath,false));
  assertNotNull("Ledger should exist",bktb.getZooKeeperClient().exists(secondLedgerPath,false));
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.TestBookkeeperPersistenceManagerWhiteBox </h4><pre class="type-3 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testChangeLedgerFailure() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  ChangeLedgerCallback persistCallback=new ChangeLedgerCallback(1,NUM_MESSAGES_TO_TEST);
  for (  Message message : messages) {
    bkpm.persistMessage(new PersistRequest(topic,message,persistCallback,null));
  }
  assertEquals(maxEntriesPerLedger + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
  assertEquals(maxEntriesPerLedger,persistCallback.numSuccess);
  assertEquals(NUM_MESSAGES_TO_TEST - maxEntriesPerLedger,persistCallback.numFailed);
}

</code></pre>

<br>
<pre class="type-2 type-11 type-6 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testSyncChangeLedgers() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  int index=0;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  while (index < messages.size()) {
    logger.debug("Persist message {}",(index + 1));
    StubCallback<MessageSeqId> persistCallback=new StubCallback<MessageSeqId>();
    bkpm.persistMessage(new PersistRequest(topic,messages.get(index),persistCallback,null));
    assertEquals(index + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
    index++;
    if (index % maxEntriesPerLedger == 1) {
      assertEquals(index / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
    }
  }
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Message scannedMessage=ConcurrencyUtils.take(scanCallback.queue).left();
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
  bkpm.topicInfos.clear();
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger + 1,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testNonEmptyDirtyLedger() throws Exception {
  Random r=new Random();
  int NUM_MESSAGES_TO_TEST=100;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  int index=0;
  int numPrevLedgers=0;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  while (index < messages.size()) {
    StubCallback<Void> stubCallback=new StubCallback<Void>();
    bkpm.acquiredTopic(topic,stubCallback,null);
    assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
    assertEquals(numPrevLedgers,bkpm.topicInfos.get(topic).ledgerRanges.size());
    StubCallback<PubSubProtocol.MessageSeqId> persistCallback=new StubCallback<PubSubProtocol.MessageSeqId>();
    bkpm.persistMessage(new PersistRequest(topic,messages.get(index),persistCallback,null));
    assertEquals(index + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
    index++;
    if (r.nextInt(10) == 9) {
      if (index < messages.size()) {
        bkpm.topicInfos.clear();
        numPrevLedgers++;
      }
    }
  }
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Message scannedMessage=ConcurrencyUtils.take(scanCallback.queue).left();
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
}

</code></pre>

<br>
<pre class="type-2 type-11 type-3 type-4 type-7 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAsyncChangeLedgers() throws Exception {
  int NUM_MESSAGES_TO_TEST=101;
  int SIZE_OF_MESSAGES_TO_TEST=100;
  List<Message> messages=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,SIZE_OF_MESSAGES_TO_TEST);
  bkpm=new BookkeeperPersistenceManager(bktb.bk,mm,tm,new ChangeLedgerServerConfiguration(),scheduler);
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
  OrderCheckingCallback persistCallback=new OrderCheckingCallback(1,NUM_MESSAGES_TO_TEST);
  for (  Message message : messages) {
    bkpm.persistMessage(new PersistRequest(topic,message,persistCallback,null));
  }
  assertEquals(NUM_MESSAGES_TO_TEST + 1,ConcurrencyUtils.take(persistCallback.queue).left().getLocalComponent());
  assertEquals(NUM_MESSAGES_TO_TEST,persistCallback.numSuccess);
  assertEquals(0,persistCallback.numFailed);
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger,bkpm.topicInfos.get(topic).ledgerRanges.size());
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  StubScanCallback scanCallback=new StubScanCallback();
  bkpm.scanMessages(new RangeScanRequest(topic,1,NUM_MESSAGES_TO_TEST,Long.MAX_VALUE,scanCallback,null));
  for (int i=0; i < messages.size(); i++) {
    Either<Message,Exception> e=ConcurrencyUtils.take(scanCallback.queue);
    Message scannedMessage=e.left();
    if (scannedMessage == null) {
      throw e.right();
    }
    assertTrue(messages.get(i).getBody().equals(scannedMessage.getBody()));
    assertEquals(i + 1,scannedMessage.getMsgId().getLocalComponent());
  }
  assertTrue(StubScanCallback.END_MESSAGE == ConcurrencyUtils.take(scanCallback.queue).left());
  bkpm.topicInfos.clear();
  stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(NUM_MESSAGES_TO_TEST / maxEntriesPerLedger + 1,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testEmptyDirtyLedger() throws Exception {
  StubCallback<Void> stubCallback=new StubCallback<Void>();
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  bkpm=new BookkeeperPersistenceManager(new BookKeeper(bktb.getZkHostPort()),mm,tm,conf,scheduler);
  bkpm.acquiredTopic(topic,stubCallback,null);
  assertNull(ConcurrencyUtils.take(stubCallback.queue).right());
  assertEquals(0,bkpm.topicInfos.get(topic).ledgerRanges.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.TestPersistenceManagerBlackBox </h4><pre class="type-11 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testPersistenceManager() throws Exception {
  List<Thread> publisherThreads=new LinkedList<Thread>();
  List<Thread> scannerThreads=new LinkedList<Thread>();
  Thread thread;
  Semaphore latch=new Semaphore(1);
  for (int i=0; i < NUM_TOPICS_TO_TEST; i++) {
    ByteString topic=getTopicName(i);
    if (persistenceManager instanceof TopicOwnershipChangeListener) {
      TopicOwnershipChangeListener tocl=(TopicOwnershipChangeListener)persistenceManager;
      latch.acquire();
      tocl.acquiredTopic(topic,new Callback<Void>(){
        @Override public void operationFailed(        Object ctx,        PubSubException exception){
          failureException=new RuntimeException(exception);
          ((Semaphore)ctx).release();
        }
        @Override public void operationFinished(        Object ctx,        Void res){
          ((Semaphore)ctx).release();
        }
      }
,latch);
      latch.acquire();
      latch.release();
      if (failureException != null) {
        throw (Exception)failureException.getCause();
      }
    }
    List<Message> msgs=HelperMethods.getRandomPublishedMessages(NUM_MESSAGES_TO_TEST,1024);
    thread=new Thread(new Publisher(topic,msgs));
    publisherThreads.add(thread);
    thread.start();
    thread=new Thread(new ScanVerifier(topic,msgs));
    scannerThreads.add(thread);
  }
  for (  Thread t : publisherThreads) {
    t.join();
  }
  for (  Thread t : scannerThreads) {
    t.start();
  }
  for (  Thread t : scannerThreads) {
    t.join();
  }
  assertEquals(null,failureException);
  for (int i=0; i < NUM_TOPICS_TO_TEST; i++) {
    assertEquals(persistenceManager.getCurrentSeqIdForTopic(getTopicName(i)).getLocalComponent(),getExpectedSeqId(NUM_MESSAGES_TO_TEST));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.persistence.TestReadAheadCacheWhiteBox </h4><pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testCollectExpiredCacheEntries() throws Exception {
  int i=1;
  int n=2;
  long ttl=5000L;
  myConf.cacheEntryTTL=ttl;
  long curTime=MathUtils.now();
  cacheBasedPersistenceManager.reloadConf(myConf);
  for (  Message m : messages) {
    CacheKey key=new CacheKey(topic,i);
    cacheBasedPersistenceManager.addMessageToCache(key,m,curTime++);
    if (i == NUM_MESSAGES - n) {
      Thread.sleep(2 * ttl);
      curTime+=2 * ttl;
    }
    i++;
  }
  assertEquals(n,cacheBasedPersistenceManager.cache.size());
  assertEquals(n,cacheBasedPersistenceManager.cacheSegment.get().timeIndexOfAddition.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testDeliveredUntil() throws Exception {
  for (  Message m : messages) {
    persistMessage(m);
  }
  assertEquals((long)NUM_MESSAGES * MSG_SIZE,cacheBasedPersistenceManager.presentCacheSize.get());
  long middle=messages.size() / 2;
  cacheBasedPersistenceManager.deliveredUntil(topic,middle);
  assertEquals(messages.size() - middle,cacheBasedPersistenceManager.cache.size());
  long middle2=middle - 1;
  cacheBasedPersistenceManager.deliveredUntil(topic,middle2);
  assertEquals(messages.size() - middle,cacheBasedPersistenceManager.cache.size());
  cacheBasedPersistenceManager.deliveredUntil(topic,(long)messages.size());
  assertTrue(cacheBasedPersistenceManager.cache.isEmpty());
  assertTrue(cacheBasedPersistenceManager.cacheSegment.get().timeIndexOfAddition.isEmpty());
  assertTrue(cacheBasedPersistenceManager.orderedIndexOnSeqId.isEmpty());
  assertTrue(0 == cacheBasedPersistenceManager.presentCacheSize.get());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testDoReadAheadStartingFrom() throws Exception {
  persistMessage(messages.get(0));
  int readAheadCount=5;
  int start=1;
  RangeScanRequest readAheadRequest=cacheBasedPersistenceManager.doReadAheadStartingFrom(topic,start,readAheadCount);
  assertNull(readAheadRequest);
  StubScanCallback callback=new StubScanCallback();
  int end=100;
  ScanRequest request=new ScanRequest(topic,end,callback,null);
  cacheBasedPersistenceManager.doReadAhead(request);
  int pos=98;
  readAheadRequest=cacheBasedPersistenceManager.doReadAheadStartingFrom(topic,pos,readAheadCount);
  assertEquals(readAheadRequest.messageLimit,end - pos);
  end=200;
  request=new ScanRequest(topic,end,callback,null);
  cacheBasedPersistenceManager.doReadAhead(request);
  pos=150;
  readAheadRequest=cacheBasedPersistenceManager.doReadAheadStartingFrom(topic,pos,readAheadCount);
  assertEquals(readAheadRequest.messageLimit,readAheadCount);
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testDoReadAhead(){
  StubScanCallback callback=new StubScanCallback();
  ScanRequest request=new ScanRequest(topic,1,callback,null);
  cacheBasedPersistenceManager.doReadAhead(request);
  assertEquals(myConf.readAheadCount,cacheBasedPersistenceManager.cache.size());
  request=new ScanRequest(topic,myConf.readAheadCount / 2 - 1,callback,null);
  cacheBasedPersistenceManager.doReadAhead(request);
  assertEquals(myConf.readAheadCount,cacheBasedPersistenceManager.cache.size());
  request=new ScanRequest(topic,myConf.readAheadCount / 2 + 2,callback,null);
  cacheBasedPersistenceManager.doReadAhead(request);
  assertEquals((int)(1.5 * myConf.readAheadCount),cacheBasedPersistenceManager.cache.size());
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testAddMessageToCache(){
  CacheKey key=new CacheKey(topic,1);
  cacheBasedPersistenceManager.addMessageToCache(key,messages.get(0),MathUtils.now());
  assertEquals(1,cacheBasedPersistenceManager.cache.size());
  assertEquals(MSG_SIZE,cacheBasedPersistenceManager.presentCacheSize.get());
  assertEquals(1,cacheBasedPersistenceManager.orderedIndexOnSeqId.get(topic).size());
  assertTrue(cacheBasedPersistenceManager.orderedIndexOnSeqId.get(topic).contains(1L));
  CacheValue value=cacheBasedPersistenceManager.cache.get(key);
  assertTrue(cacheBasedPersistenceManager.cacheSegment.get().timeIndexOfAddition.get(value.timeOfAddition).contains(key));
}

</code></pre>

<br>
<pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testReadAheadSizeLimit() throws Exception {
  for (  Message m : messages) {
    persistMessage(m);
  }
  cacheBasedPersistenceManager.cache.clear();
  StubScanCallback callback=new StubScanCallback();
  ScanRequest request=new ScanRequest(topic,1,callback,null);
  cacheBasedPersistenceManager.scanSingleMessage(request);
  assertTrue(callback.isSuccess());
  assertEquals((int)Math.ceil(myConf.readAheadSize / (MSG_SIZE + 0.0)),cacheBasedPersistenceManager.cache.size());
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testCollectOldCacheEntries(){
  int i=1;
  for (  Message m : messages) {
    CacheKey key=new CacheKey(topic,i);
    cacheBasedPersistenceManager.addMessageToCache(key,m,i);
    i++;
  }
  int n=2;
  myConf.maxCacheSize=n * MSG_SIZE * myConf.getNumReadAheadCacheThreads();
  cacheBasedPersistenceManager.reloadConf(myConf);
  cacheBasedPersistenceManager.collectOldOrExpiredCacheEntries(cacheBasedPersistenceManager.cacheSegment.get());
  assertEquals(n,cacheBasedPersistenceManager.cache.size());
  assertEquals(n,cacheBasedPersistenceManager.cacheSegment.get().timeIndexOfAddition.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.subscriptions.TestMMSubscriptionManager </h4><pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testBasics() throws Exception {
  ByteString topic1=ByteString.copyFromUtf8("topic1");
  ByteString sub1=ByteString.copyFromUtf8("sub1");
  SubscribeRequest subRequest=SubscribeRequest.newBuilder().setSubscriberId(sub1).build();
  MessageSeqId msgId=MessageSeqId.newBuilder().setLocalComponent(100).build();
  sm.serveSubscribeRequest(topic1,subRequest,msgId,subDataCallback,null);
  Assert.assertEquals(ConcurrencyUtils.take(subDataCallbackQueue).right().getClass(),PubSubException.ServerNotResponsibleForTopicException.class);
  sm.unsubscribe(topic1,sub1,voidCallback,null);
  Assert.assertEquals(ConcurrencyUtils.take(BooleanCallbackQueue).right().getClass(),PubSubException.ServerNotResponsibleForTopicException.class);
  sm.acquiredTopic(topic1,voidCallback,null);
  Assert.assertTrue(BooleanCallbackQueue.take().left());
  Assert.assertTrue(sm.top2sub2seq.containsKey(topic1));
  Assert.assertEquals(0,sm.top2sub2seq.get(topic1).size());
  sm.unsubscribe(topic1,sub1,voidCallback,null);
  Assert.assertEquals(ConcurrencyUtils.take(BooleanCallbackQueue).right().getClass(),PubSubException.ClientNotSubscribedException.class);
  subRequest=SubscribeRequest.newBuilder().setCreateOrAttach(CreateOrAttach.ATTACH).setSubscriberId(sub1).build();
  sm.serveSubscribeRequest(topic1,subRequest,msgId,subDataCallback,null);
  Assert.assertEquals(ConcurrencyUtils.take(subDataCallbackQueue).right().getClass(),PubSubException.ClientNotSubscribedException.class);
  subRequest=SubscribeRequest.newBuilder().setCreateOrAttach(CreateOrAttach.CREATE).setSubscriberId(sub1).build();
  sm.serveSubscribeRequest(topic1,subRequest,msgId,subDataCallback,null);
  Assert.assertEquals(msgId.getLocalComponent(),ConcurrencyUtils.take(subDataCallbackQueue).left().getState().getMsgId().getLocalComponent());
  Assert.assertEquals(msgId.getLocalComponent(),sm.top2sub2seq.get(topic1).get(sub1).getLastConsumeSeqId().getLocalComponent());
  sm.serveSubscribeRequest(topic1,subRequest,msgId,subDataCallback,null);
  Assert.assertEquals(ConcurrencyUtils.take(subDataCallbackQueue).right().getClass(),PubSubException.ClientAlreadySubscribedException.class);
  Assert.assertEquals(msgId.getLocalComponent(),sm.top2sub2seq.get(topic1).get(sub1).getLastConsumeSeqId().getLocalComponent());
  sm.lostTopic(topic1);
  sm.acquiredTopic(topic1,voidCallback,null);
  Assert.assertTrue(BooleanCallbackQueue.take().left());
  subRequest=SubscribeRequest.newBuilder().setCreateOrAttach(CreateOrAttach.ATTACH).setSubscriberId(sub1).build();
  MessageSeqId msgId1=MessageSeqId.newBuilder().setLocalComponent(msgId.getLocalComponent() + 10).build();
  sm.serveSubscribeRequest(topic1,subRequest,msgId1,subDataCallback,null);
  Assert.assertEquals(msgId.getLocalComponent(),subDataCallbackQueue.take().left().getState().getMsgId().getLocalComponent());
  Assert.assertEquals(msgId.getLocalComponent(),sm.top2sub2seq.get(topic1).get(sub1).getLastConsumeSeqId().getLocalComponent());
  MessageSeqId msgId2=MessageSeqId.newBuilder().setLocalComponent(msgId.getLocalComponent() + cfg.getConsumeInterval() - 1).build();
  sm.setConsumeSeqIdForSubscriber(topic1,sub1,msgId2,voidCallback,null);
  Assert.assertTrue(BooleanCallbackQueue.take().left());
  Assert.assertEquals(msgId2.getLocalComponent(),sm.top2sub2seq.get(topic1).get(sub1).getLastConsumeSeqId().getLocalComponent());
  Assert.assertEquals(msgId.getLocalComponent(),sm.top2sub2seq.get(topic1).get(sub1).getSubscriptionState().getMsgId().getLocalComponent());
  MessageSeqId msgId3=MessageSeqId.newBuilder().setLocalComponent(msgId.getLocalComponent() + cfg.getConsumeInterval() + 1).build();
  sm.setConsumeSeqIdForSubscriber(topic1,sub1,msgId3,voidCallback,null);
  Assert.assertTrue(BooleanCallbackQueue.take().left());
  sm.lostTopic(topic1);
  sm.acquiredTopic(topic1,voidCallback,null);
  Assert.assertTrue(BooleanCallbackQueue.take().left());
  Assert.assertEquals(msgId3.getLocalComponent(),sm.top2sub2seq.get(topic1).get(sub1).getLastConsumeSeqId().getLocalComponent());
  Assert.assertEquals(msgId3.getLocalComponent(),sm.top2sub2seq.get(topic1).get(sub1).getSubscriptionState().getMsgId().getLocalComponent());
  sm.unsubscribe(topic1,sub1,voidCallback,null);
  Assert.assertTrue(BooleanCallbackQueue.take().left());
  sm.lostTopic(topic1);
  sm.acquiredTopic(topic1,voidCallback,null);
  Assert.assertTrue(BooleanCallbackQueue.take().left());
  Assert.assertFalse(sm.top2sub2seq.get(topic1).containsKey(sub1));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.topics.TestHubInfo </h4><pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testParseHubInfo() throws Exception {
  HedwigSocketAddress addr=new HedwigSocketAddress("localhost",9086,9087);
  HubInfo hubInfo1=new HubInfo(addr,9999);
  String strHubInfo1=hubInfo1.toString();
  HubInfo parsedHubInfo1=HubInfo.parse(strHubInfo1);
  Assert.assertEquals("Hub infos should be same",hubInfo1,parsedHubInfo1);
  HubInfo hubInfo2=new HubInfo(addr,0);
  HubInfo parsedHubInfo2=HubInfo.parse("localhost:9086:9087");
  Assert.assertEquals("Hub infos w/o zxid should be same",hubInfo2,parsedHubInfo2);
  try {
    HubInfo.parse("");
    Assert.fail("Should throw InvalidHubInfoException parsing empty string.");
  }
 catch (  HubInfo.InvalidHubInfoException ihie) {
  }
  try {
    HubInfo.parse("localhost,a,b,c");
    Assert.fail("Should throw InvalidHubInfoException parsing corrupted hostname.");
  }
 catch (  HubInfo.InvalidHubInfoException ihie) {
  }
  try {
    HubInfo.parse("hostname: localhost:9086:9087");
    Assert.fail("Should throw InvalidHubInfoException parsing corrupted string.");
  }
 catch (  HubInfo.InvalidHubInfoException ihie) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.topics.TestHubLoad </h4><pre class="type-2 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testParseHubLoad() throws Exception {
  HubLoad hubLoad1=new HubLoad(9999);
  String strHubLoad1=hubLoad1.toString();
  HubLoad parsedHubLoad1=HubLoad.parse(strHubLoad1);
  Assert.assertEquals("Hub load data should be same",hubLoad1,parsedHubLoad1);
  final int numTopics=9998;
  HubLoad hubLoad2=new HubLoad(numTopics);
  HubLoad parsedHubLoad2=HubLoad.parse(numTopics + "");
  Assert.assertEquals("Hub load data not protobuf encoded should be same",hubLoad2,parsedHubLoad2);
  try {
    HubLoad.parse("");
    Assert.fail("Should throw InvalidHubLoadException parsing empty string.");
  }
 catch (  HubLoad.InvalidHubLoadException ihie) {
  }
  try {
    HubLoad.parse("9998_x");
    Assert.fail("Should throw InvalidHubLoadException parsing corrupted hub load data.");
  }
 catch (  HubLoad.InvalidHubLoadException ihie) {
  }
  try {
    HubLoad.parse("hostname: 9998_x");
    Assert.fail("Should throw InvalidHubLoadException parsing corrupted hub load data.");
  }
 catch (  HubLoad.InvalidHubLoadException ihie) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.topics.TestMMTopicManager </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testGetOwnerSingle() throws Exception {
  tm.getOwner(topic,false,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testMaxNumTopics() throws Exception {
  conf.getConf().setProperty("max_num_topics","1");
  MMTopicManager tm1=new MMTopicManager(conf,zk,metadataManagerFactory,scheduler);
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
  tm1.getOwner(ByteString.copyFromUtf8("MaxNumTopic"),true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(2000L);
  assertOwnershipNodeDoesntExist();
  tm1.stop();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testLoadBalancing() throws Exception {
  tm.getOwner(topic,false,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  ServerConfiguration conf1=new CustomServerConfiguration(conf.getServerPort() + 1);
  TopicManager tm1=new MMTopicManager(conf1,zk,metadataManagerFactory,scheduler);
  ByteString topic1=mkTopic(1);
  tm.getOwner(topic1,false,addrCbq,null);
  Assert.assertEquals(conf1.getServerAddr(),check(addrCbq.take()));
  tm1.stop();
}

</code></pre>

<br>
<pre class="type-11 type-6 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGetOwnerMulti() throws Exception {
  ServerConfiguration conf1=new CustomServerConfiguration(conf.getServerPort() + 1), conf2=new CustomServerConfiguration(conf.getServerPort() + 2);
  MMTopicManager tm1=new MMTopicManager(conf1,zk,metadataManagerFactory,scheduler), tm2=new MMTopicManager(conf2,zk,metadataManagerFactory,scheduler);
  tm.getOwner(topic,false,addrCbq,null);
  HedwigSocketAddress owner=check(addrCbq.take());
  for (int i=0; i < 100; ++i) {
    tm.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
    tm1.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
    tm2.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
  }
  for (int i=0; i < 100; ++i) {
    if (!owner.equals(me))     break;
    tm.getOwner(mkTopic(i),false,addrCbq,null);
    owner=check(addrCbq.take());
    if (i == 99)     Assert.fail("Never chose another owner");
  }
  tm1.stop();
  tm2.stop();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testRetentionAfterAccess() throws Exception {
  conf.getConf().setProperty("retention_secs_after_access","5");
  MMTopicManager tm1=new MMTopicManager(conf,zk,metadataManagerFactory,scheduler);
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(6000L);
  tm1.topics.cleanUp();
  Thread.sleep(2000L);
  assertOwnershipNodeDoesntExist();
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(1000L);
  tm1.topics.cleanUp();
  Thread.sleep(2000L);
  assertOwnershipNodeExists();
  tm1.stop();
}

</code></pre>

<br>
<pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testOwnershipChange() throws Exception {
  SynchronousQueue<Pair<ByteString,Boolean>> bsQueue=new SynchronousQueue<Pair<ByteString,Boolean>>();
  StubOwnershipChangeListener listener=new StubOwnershipChangeListener(bsQueue);
  tm.addTopicOwnershipChangeListener(listener);
  tm.getOwner(topic,true,addrCbq,null);
  Pair<ByteString,Boolean> pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertTrue(pair.second());
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Assert.assertTrue(bsQueue.isEmpty());
  assertOwnershipNodeExists();
  tm.releaseTopic(topic,cb,null);
  pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertFalse(pair.second());
  Assert.assertTrue(queue.take());
  assertOwnershipNodeDoesntExist();
  tm.releaseTopic(mkTopic(0),cb,null);
  Assert.assertTrue(queue.take());
  Assert.assertTrue(bsQueue.isEmpty());
  listener.setFailure(true);
  tm.getOwner(topic,true,addrCbq,null);
  pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertTrue(pair.second());
  Assert.assertEquals(PubSubException.ServiceDownException.class,((CompositeException)addrCbq.take().right()).getExceptions().iterator().next().getClass());
  Assert.assertFalse(null != tm.topics.getIfPresent(topic));
  Thread.sleep(100);
  assertOwnershipNodeDoesntExist();
}

</code></pre>

<br>
<pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testZKClientDisconnected() throws Exception {
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  tm.isSuspended=true;
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(PubSubException.ServiceDownException.class,addrCbq.take().right().getClass());
  tm.releaseTopic(topic,cb,null);
  Assert.assertTrue(queue.take());
  assertOwnershipNodeDoesntExist();
  tm.isSuspended=false;
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.server.topics.TestZkTopicManager </h4><pre class="type-2 type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testOwnershipChange() throws Exception {
  SynchronousQueue<Pair<ByteString,Boolean>> bsQueue=new SynchronousQueue<Pair<ByteString,Boolean>>();
  StubOwnershipChangeListener listener=new StubOwnershipChangeListener(bsQueue);
  tm.addTopicOwnershipChangeListener(listener);
  tm.getOwner(topic,true,addrCbq,null);
  Pair<ByteString,Boolean> pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertTrue(pair.second());
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Assert.assertTrue(bsQueue.isEmpty());
  assertOwnershipNodeExists();
  tm.releaseTopic(topic,cb,null);
  pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertFalse(pair.second());
  Assert.assertTrue(queue.take());
  assertOwnershipNodeDoesntExist();
  tm.releaseTopic(mkTopic(0),cb,null);
  Assert.assertTrue(queue.take());
  Assert.assertTrue(bsQueue.isEmpty());
  listener.setFailure(true);
  tm.getOwner(topic,true,addrCbq,null);
  pair=bsQueue.take();
  Assert.assertEquals(topic,pair.first());
  Assert.assertTrue(pair.second());
  Assert.assertEquals(PubSubException.ServiceDownException.class,((CompositeException)addrCbq.take().right()).getExceptions().iterator().next().getClass());
  Assert.assertFalse(null != tm.topics.getIfPresent(topic));
  Thread.sleep(100);
  assertOwnershipNodeDoesntExist();
}

</code></pre>

<br>
<pre class="type-11 type-6 type-8 type-3 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testGetOwnerMulti() throws Exception {
  ServerConfiguration cfg1=new CustomServerConfiguration(cfg.getServerPort() + 1), cfg2=new CustomServerConfiguration(cfg.getServerPort() + 2);
  ZkTopicManager tm1=new ZkTopicManager(zk,cfg1,scheduler), tm2=new ZkTopicManager(zk,cfg2,scheduler);
  tm.getOwner(topic,false,addrCbq,null);
  HedwigSocketAddress owner=check(addrCbq.take());
  if (owner.getPort() == cfg1.getServerPort())   tm1.getOwner(topic,true,addrCbq,null);
 else   if (owner.getPort() == cfg2.getServerPort())   tm2.getOwner(topic,true,addrCbq,null);
  if (owner.getPort() != cfg.getServerPort())   Assert.assertEquals(owner,check(addrCbq.take()));
  for (int i=0; i < 100; ++i) {
    tm.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
    tm1.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
    tm2.getOwner(topic,false,addrCbq,null);
    Assert.assertEquals(owner,check(addrCbq.take()));
  }
  for (int i=0; i < 100; ++i) {
    if (!owner.equals(me))     break;
    tm.getOwner(mkTopic(i),false,addrCbq,null);
    owner=check(addrCbq.take());
    if (i == 99)     Assert.fail("Never chose another owner");
  }
  for (int i=0; i < 100; ++i) {
    tm.getOwner(mkTopic(100),true,addrCbq,null);
    Assert.assertEquals(me,check(addrCbq.take()));
  }
  tm1.stop();
  tm2.stop();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testLoadBalancing() throws Exception {
  tm.getOwner(topic,false,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  ServerConfiguration cfg1=new CustomServerConfiguration(cfg.getServerPort() + 1);
  TopicManager tm1=new ZkTopicManager(zk,cfg1,scheduler);
  ByteString topic1=mkTopic(1);
  tm.getOwner(topic1,false,addrCbq,null);
  Assert.assertEquals(cfg1.getServerAddr(),check(addrCbq.take()));
  tm1.stop();
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testRetentionAfterAccess() throws Exception {
  DEFAULT_RETENTION_SECS_AFTER_ACCESS=5;
  ZkTopicManager tm1=new ZkTopicManager(zk,cfg,scheduler);
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(6000L);
  tm1.topics.cleanUp();
  Thread.sleep(2000L);
  assertOwnershipNodeDoesntExist();
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(1000L);
  tm1.topics.cleanUp();
  Thread.sleep(2000L);
  assertOwnershipNodeExists();
  tm1.stop();
}

</code></pre>

<br>
<pre class="type-3 type-4 type-9 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testZKClientDisconnected() throws Exception {
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  tm.isSuspended=true;
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(PubSubException.ServiceDownException.class,addrCbq.take().right().getClass());
  tm.releaseTopic(topic,cb,null);
  Assert.assertTrue(queue.take());
  assertOwnershipNodeDoesntExist();
  tm.isSuspended=false;
  tm.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
}

</code></pre>

<br>
<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testGetOwnerSingle() throws Exception {
  tm.getOwner(topic,false,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
}

</code></pre>

<br>
<pre class="type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testMaxNumTopics() throws Exception {
  DEFAULT_MAX_NUM_TOPICS=1;
  TopicManager tm1=new ZkTopicManager(zk,cfg,scheduler);
  tm1.getOwner(topic,true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  assertOwnershipNodeExists();
  tm1.getOwner(ByteString.copyFromUtf8("MaxNumTopic"),true,addrCbq,null);
  Assert.assertEquals(me,check(addrCbq.take()));
  Thread.sleep(2000L);
  assertOwnershipNodeDoesntExist();
  tm1.stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hedwig.util.TestPathUtils </h4><pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testPrefixes(){
  assertEquals(Arrays.asList(new String[]{"/a","/a/b","/a/b/c"}),PathUtils.prefixes("/a/b/c"));
  assertEquals(Arrays.asList(new String[]{"/a","/a/b","/a/b/c"}),PathUtils.prefixes("///a///b///c"));
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
