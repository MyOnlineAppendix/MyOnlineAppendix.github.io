<h3 style="margin:0px">Class: org.apache.sshd.client.subsystem.sftp.SftpVersionsTest (8 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="17"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('17')" data-toggle="tooltip" title="Invokes logging operations"><kbd id="tag-17"class="label-info"style="display: inline-block;font-size:7pt" >Logger&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown() throws Exception {
  tearDownServer();
}

</code></pre>

<pre class="type-8 type-10 type-2 type-3 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSftpFileTypeAndPermissionsUpdate() throws Exception {
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName());
  Path subFolder=Files.createDirectories(lclSftp.resolve("sub-folder"));
  String subFolderName=subFolder.getFileName().toString();
  Path lclFile=assertHierarchyTargetFolderExists(lclSftp).resolve(getCurrentTestName() + "-" + getTestedVersion()+ ".txt");
  String lclFileName=lclFile.getFileName().toString();
  Files.write(lclFile,getClass().getName().getBytes(StandardCharsets.UTF_8));
  Path parentPath=targetPath.getParent();
  String remotePath=Utils.resolveRelativeRemotePath(parentPath,lclSftp);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient(getTestedVersion())){
        for (        DirEntry entry : sftp.readDir(remotePath)) {
          String fileName=entry.getFilename();
          if (".".equals(fileName) || "..".equals(fileName)) {
            continue;
          }
          Attributes attrs=validateSftpFileTypeAndPermissions(fileName,getTestedVersion(),entry.getAttributes());
          if (subFolderName.equals(fileName)) {
            assertEquals("Mismatched sub-folder type",SftpConstants.SSH_FILEXFER_TYPE_DIRECTORY,attrs.getType());
            assertTrue("Sub-folder not marked as directory",attrs.isDirectory());
          }
 else           if (lclFileName.equals(fileName)) {
            assertEquals("Mismatched sub-file type",SftpConstants.SSH_FILEXFER_TYPE_REGULAR,attrs.getType());
            assertTrue("Sub-folder not marked as directory",attrs.isRegularFile());
          }
        }
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-17 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Invokes logging operations">Logger</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Invokes logging operations
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSftpFileTimesUpdate() throws Exception {
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName());
  Path lclFile=assertHierarchyTargetFolderExists(lclSftp).resolve(getCurrentTestName() + "-" + getTestedVersion()+ ".txt");
  Files.write(lclFile,getClass().getName().getBytes(StandardCharsets.UTF_8));
  Path parentPath=targetPath.getParent();
  String remotePath=Utils.resolveRelativeRemotePath(parentPath,lclFile);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient(getTestedVersion())){
        Attributes attrs=sftp.lstat(remotePath);
        long expectedSeconds=TimeUnit.SECONDS.convert(System.currentTimeMillis() - TimeUnit.HOURS.toMillis(1L),TimeUnit.MILLISECONDS);
        attrs.getFlags().clear();
        attrs.modifyTime(expectedSeconds);
        sftp.setStat(remotePath,attrs);
        attrs=sftp.lstat(remotePath);
        long actualSeconds=attrs.getModifyTime().to(TimeUnit.SECONDS);
        if (expectedSeconds != actualSeconds) {
          System.err.append("Mismatched last modified time for ").append(lclFile.toString()).append(" - expected=").append(String.valueOf(expectedSeconds)).append('[').append(new Date(TimeUnit.SECONDS.toMillis(expectedSeconds)).toString()).append(']').append(", actual=").append(String.valueOf(actualSeconds)).append('[').append(new Date(TimeUnit.SECONDS.toMillis(actualSeconds)).toString()).append(']').println();
        }
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-10 type-3 type-7 type-12 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSftpACLEncodeDecode() throws Exception {
  AclEntryType[] types=AclEntryType.values();
  final List<AclEntry> aclExpected=new ArrayList<>(types.length);
  for (  AclEntryType t : types) {
    aclExpected.add(AclEntry.newBuilder().setType(t).setFlags(EnumSet.allOf(AclEntryFlag.class)).setPermissions(EnumSet.allOf(AclEntryPermission.class)).setPrincipal(new DefaultGroupPrincipal(getCurrentTestName() + "@" + getClass().getPackage().getName())).build());
  }
  final AtomicInteger numInvocations=new AtomicInteger(0);
  SftpSubsystemFactory factory=new SftpSubsystemFactory(){
    @Override public Command create(){
      SftpSubsystem subsystem=new SftpSubsystem(getExecutorService(),isShutdownOnExit(),getUnsupportedAttributePolicy()){
        @Override protected Map<String,Object> resolveFileAttributes(        Path file,        int flags,        LinkOption... options) throws IOException {
          Map<String,Object> attrs=super.resolveFileAttributes(file,flags,options);
          if (GenericUtils.isEmpty(attrs)) {
            attrs=new TreeMap<String,Object>(String.CASE_INSENSITIVE_ORDER);
          }
          @SuppressWarnings("unchecked") List<AclEntry> aclActual=(List<AclEntry>)attrs.put("acl",aclExpected);
          if (aclActual != null) {
            log.info("resolveFileAttributes(" + file + ") replaced ACL: "+ aclActual);
          }
          return attrs;
        }
        @Override protected void setFileAccessControl(        Path file,        List<AclEntry> aclActual,        LinkOption... options) throws IOException {
          if (aclActual != null) {
            assertListEquals("Mismatched ACL set for file=" + file,aclExpected,aclActual);
            numInvocations.incrementAndGet();
          }
        }
      }
;
      Collection<? extends SftpEventListener> listeners=getRegisteredListeners();
      if (GenericUtils.size(listeners) > 0) {
        for (        SftpEventListener l : listeners) {
          subsystem.addSftpEventListener(l);
        }
      }
      return subsystem;
    }
  }
;
  factory.addSftpEventListener(new AbstractSftpEventListenerAdapter(){
    @Override public void modifyingAttributes(    ServerSession session,    Path path,    Map<String,?> attrs){
      @SuppressWarnings("unchecked") List<AclEntry> aclActual=GenericUtils.isEmpty(attrs) ? null : (List<AclEntry>)attrs.get("acl");
      if (getTestedVersion() > SftpConstants.SFTP_V3) {
        assertListEquals("Mismatched modifying ACL for file=" + path,aclExpected,aclActual);
      }
 else {
        assertNull("Unexpected modifying ACL for file=" + path,aclActual);
      }
    }
    @Override public void modifiedAttributes(    ServerSession session,    Path path,    Map<String,?> attrs,    Throwable thrown){
      @SuppressWarnings("unchecked") List<AclEntry> aclActual=GenericUtils.isEmpty(attrs) ? null : (List<AclEntry>)attrs.get("acl");
      if (getTestedVersion() > SftpConstants.SFTP_V3) {
        assertListEquals("Mismatched modified ACL for file=" + path,aclExpected,aclActual);
      }
 else {
        assertNull("Unexpected modified ACL for file=" + path,aclActual);
      }
    }
  }
);
  sshd.setSubsystemFactories(Collections.<NamedFactory<Command>>singletonList(factory));
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName());
  Files.createDirectories(lclSftp.resolve("sub-folder"));
  Path lclFile=assertHierarchyTargetFolderExists(lclSftp).resolve(getCurrentTestName() + "-" + getTestedVersion()+ ".txt");
  Files.write(lclFile,getClass().getName().getBytes(StandardCharsets.UTF_8));
  Path parentPath=targetPath.getParent();
  String remotePath=Utils.resolveRelativeRemotePath(parentPath,lclSftp);
  int numInvoked=0;
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient(getTestedVersion())){
        for (        DirEntry entry : sftp.readDir(remotePath)) {
          String fileName=entry.getFilename();
          if (".".equals(fileName) || "..".equals(fileName)) {
            continue;
          }
          Attributes attrs=validateSftpFileTypeAndPermissions(fileName,getTestedVersion(),entry.getAttributes());
          List<AclEntry> aclActual=attrs.getAcl();
          if (getTestedVersion() == SftpConstants.SFTP_V3) {
            assertNull("Unexpected ACL for entry=" + fileName,aclActual);
          }
 else {
            assertListEquals("Mismatched ACL for entry=" + fileName,aclExpected,aclActual);
          }
          attrs.getFlags().clear();
          attrs.setAcl(aclExpected);
          sftp.setStat(remotePath + "/" + fileName,attrs);
          if (getTestedVersion() > SftpConstants.SFTP_V3) {
            numInvoked++;
          }
        }
      }
     }
  finally {
      client.stop();
    }
  }
   assertEquals("Mismatched invocations count",numInvoked,numInvocations.get());
}

</code></pre>

<pre class="type-2 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSftpExtensionsEncodeDecode() throws Exception {
  final Class<?> anchor=getClass();
  final Map<String,String> expExtensions=new TreeMap<String,String>(String.CASE_INSENSITIVE_ORDER){
    private static final long serialVersionUID=1L;
{
      put("class",anchor.getSimpleName());
      put("package",anchor.getPackage().getName());
      put("method",getCurrentTestName());
    }
  }
;
  final AtomicInteger numInvocations=new AtomicInteger(0);
  SftpSubsystemFactory factory=new SftpSubsystemFactory(){
    @Override public Command create(){
      SftpSubsystem subsystem=new SftpSubsystem(getExecutorService(),isShutdownOnExit(),getUnsupportedAttributePolicy()){
        @Override protected Map<String,Object> resolveFileAttributes(        Path file,        int flags,        LinkOption... options) throws IOException {
          Map<String,Object> attrs=super.resolveFileAttributes(file,flags,options);
          if (GenericUtils.isEmpty(attrs)) {
            attrs=new TreeMap<String,Object>(String.CASE_INSENSITIVE_ORDER);
          }
          @SuppressWarnings("unchecked") Map<String,String> actExtensions=(Map<String,String>)attrs.put("extended",expExtensions);
          if (actExtensions != null) {
            log.info("resolveFileAttributes(" + file + ") replaced extensions: "+ actExtensions);
          }
          return attrs;
        }
        @Override protected void setFileExtensions(        Path file,        Map<String,byte[]> extensions,        LinkOption... options) throws IOException {
          assertExtensionsMapEquals("setFileExtensions(" + file + ")",expExtensions,extensions);
          numInvocations.incrementAndGet();
          int currentVersion=getTestedVersion();
          try {
            super.setFileExtensions(file,extensions,options);
            assertFalse("Expected exception not generated for version=" + currentVersion,currentVersion >= SftpConstants.SFTP_V6);
          }
 catch (          UnsupportedOperationException e) {
            assertTrue("Unexpected exception for version=" + currentVersion,currentVersion >= SftpConstants.SFTP_V6);
          }
        }
      }
;
      Collection<? extends SftpEventListener> listeners=getRegisteredListeners();
      if (GenericUtils.size(listeners) > 0) {
        for (        SftpEventListener l : listeners) {
          subsystem.addSftpEventListener(l);
        }
      }
      return subsystem;
    }
  }
;
  factory.addSftpEventListener(new AbstractSftpEventListenerAdapter(){
    @Override public void modifyingAttributes(    ServerSession session,    Path path,    Map<String,?> attrs){
      @SuppressWarnings("unchecked") Map<String,byte[]> actExtensions=GenericUtils.isEmpty(attrs) ? null : (Map<String,byte[]>)attrs.get("extended");
      assertExtensionsMapEquals("modifying(" + path + ")",expExtensions,actExtensions);
    }
    @Override public void modifiedAttributes(    ServerSession session,    Path path,    Map<String,?> attrs,    Throwable thrown){
      @SuppressWarnings("unchecked") Map<String,byte[]> actExtensions=GenericUtils.isEmpty(attrs) ? null : (Map<String,byte[]>)attrs.get("extended");
      assertExtensionsMapEquals("modified(" + path + ")",expExtensions,actExtensions);
    }
  }
);
  sshd.setSubsystemFactories(Collections.<NamedFactory<Command>>singletonList(factory));
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName());
  Files.createDirectories(lclSftp.resolve("sub-folder"));
  Path lclFile=assertHierarchyTargetFolderExists(lclSftp).resolve(getCurrentTestName() + "-" + getTestedVersion()+ ".txt");
  Files.write(lclFile,getClass().getName().getBytes(StandardCharsets.UTF_8));
  Path parentPath=targetPath.getParent();
  String remotePath=Utils.resolveRelativeRemotePath(parentPath,lclSftp);
  int numInvoked=0;
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient(getTestedVersion())){
        for (        DirEntry entry : sftp.readDir(remotePath)) {
          String fileName=entry.getFilename();
          if (".".equals(fileName) || "..".equals(fileName)) {
            continue;
          }
          Attributes attrs=validateSftpFileTypeAndPermissions(fileName,getTestedVersion(),entry.getAttributes());
          Map<String,byte[]> actExtensions=attrs.getExtensions();
          assertExtensionsMapEquals("dirEntry=" + fileName,expExtensions,actExtensions);
          attrs.getFlags().clear();
          attrs.setStringExtensions(expExtensions);
          sftp.setStat(remotePath + "/" + fileName,attrs);
          numInvoked++;
        }
      }
     }
  finally {
      client.stop();
    }
  }
   assertEquals("Mismatched invocations count",numInvoked,numInvocations.get());
}

</code></pre>

<pre class="type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSftpVersionSelector() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient(getTestedVersion())){
        assertEquals("Mismatched negotiated version",getTestedVersion(),sftp.getVersion());
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  setupServer();
}

</code></pre>

<pre class="type-11 type-8 type-10 type-2 type-3 type-12 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEndOfListIndicator() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient(getTestedVersion())){
        AtomicReference<Boolean> eolIndicator=new AtomicReference<>();
        int version=sftp.getVersion();
        Path targetPath=detectTargetFolder();
        Path parentPath=targetPath.getParent();
        String remotePath=Utils.resolveRelativeRemotePath(parentPath,targetPath);
        try (CloseableHandle handle=sftp.openDir(remotePath)){
          List<DirEntry> entries=sftp.readDir(handle,eolIndicator);
          for (int index=1; entries != null; entries=sftp.readDir(handle,eolIndicator), index++) {
            Boolean value=eolIndicator.get();
            if (version < SftpConstants.SFTP_V6) {
              assertNull("Unexpected indicator value at iteration #" + index,value);
            }
 else {
              assertNotNull("No indicator returned at iteration #" + index,value);
              if (value.booleanValue()) {
                break;
              }
            }
            eolIndicator.set(null);
          }
          Boolean value=eolIndicator.get();
          if (version < SftpConstants.SFTP_V6) {
            assertNull("Unexpected end-of-list indication received at end of entries",value);
            assertNull("Unexpected no last entries indication",entries);
          }
 else {
            assertNotNull("No end-of-list indication received at end of entries",value);
            assertNotNull("No last received entries",entries);
            assertTrue("Bad end-of-list value",value.booleanValue());
          }
        }
       }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
