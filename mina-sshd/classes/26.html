<h3 style="margin:0px">Class: org.apache.sshd.client.subsystem.sftp.SftpTest (19 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies values related to public fields."><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >PublicFieldVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Sets implicit assumptions "><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >AssumptionSetter&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-8 type-2 type-3 type-15 type-14 type-7 type-12 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateSymbolicLink() throws Exception {
  Assume.assumeTrue("Skip non-Unix O/S",OsUtils.isUNIX());
  List<NamedFactory<Command>> factories=sshd.getSubsystemFactories();
  assertEquals("Mismatched subsystem factories count",1,GenericUtils.size(factories));
  NamedFactory<Command> f=factories.get(0);
  assertObjectInstanceOf("Not an SFTP subsystem factory",SftpSubsystemFactory.class,f);
  SftpSubsystemFactory factory=(SftpSubsystemFactory)f;
  final AtomicReference<LinkData> linkDataHolder=new AtomicReference<>();
  factory.addSftpEventListener(new AbstractSftpEventListenerAdapter(){
    @Override public void linking(    ServerSession session,    Path src,    Path target,    boolean symLink){
      assertNull("Multiple linking calls",linkDataHolder.getAndSet(new LinkData(src,target,symLink)));
    }
    @Override public void linked(    ServerSession session,    Path src,    Path target,    boolean symLink,    Throwable thrown){
      LinkData data=linkDataHolder.get();
      assertNotNull("No previous linking call",data);
      assertSame("Mismatched source",data.getSource(),src);
      assertSame("Mismatched target",data.getTarget(),target);
      assertEquals("Mismatched link type",data.isSymLink(),symLink);
      assertNull("Unexpected failure",thrown);
    }
  }
);
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(lclSftp);
  Path parentPath=targetPath.getParent();
  Path sourcePath=assertHierarchyTargetFolderExists(lclSftp).resolve("src.txt");
  String remSrcPath="/" + Utils.resolveRelativeRemotePath(parentPath,sourcePath);
  String data=getCurrentTestName();
  ChannelSftp c=(ChannelSftp)session.openChannel(SftpConstants.SFTP_SUBSYSTEM_NAME);
  c.connect();
  try {
    try (InputStream dataStream=new ByteArrayInputStream(data.getBytes(StandardCharsets.UTF_8))){
      c.put(dataStream,remSrcPath);
    }
     assertTrue("Source file not created: " + sourcePath,Files.exists(sourcePath));
    assertEquals("Mismatched stored data in " + remSrcPath,data,readFile(remSrcPath));
    Path linkPath=lclSftp.resolve("link-" + sourcePath.getFileName());
    String remLinkPath="/" + Utils.resolveRelativeRemotePath(parentPath,linkPath);
    LinkOption[] options=IoUtils.getLinkOptions(false);
    if (Files.exists(linkPath,options)) {
      Files.delete(linkPath);
    }
    assertFalse("Target link exists before linking: " + linkPath,Files.exists(linkPath,options));
    outputDebugMessage("Symlink %s => %s",remLinkPath,remSrcPath);
    c.symlink(remSrcPath,remLinkPath);
    assertTrue("Symlink not created: " + linkPath,Files.exists(linkPath,options));
    assertEquals("Mismatched link data in " + remLinkPath,data,readFile(remLinkPath));
    String str1=c.readlink(remLinkPath);
    String str2=c.realpath(remSrcPath);
    assertEquals("Mismatched link vs. real path",str1,str2);
  }
  finally {
    c.disconnect();
  }
  assertNotNull("No symlink signalled",linkDataHolder.getAndSet(null));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * this test is meant to test out write's logic, to ensure that internal chunking (based on Buffer.MAX_LEN) is
 * functioning properly. To do this, we write a variety of file sizes, both smaller and larger than Buffer.MAX_LEN.
 * in addition, this test ensures that improper arguments passed in get caught with an IllegalArgumentException
 * @throws Exception upon any uncaught exception or failure
 */
@Test public void testWriteChunking() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      Path targetPath=detectTargetFolder();
      Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(lclSftp);
      Path parentPath=targetPath.getParent();
      Path clientFolder=assertHierarchyTargetFolderExists(lclSftp).resolve("client");
      String dir=Utils.resolveRelativeRemotePath(parentPath,clientFolder);
      try (SftpClient sftp=session.createSftpClient()){
        sftp.mkdir(dir);
        uploadAndVerifyFile(sftp,clientFolder,dir,0,"emptyFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,1000,"smallFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,ByteArrayBuffer.MAX_LEN - 1,"bufferMaxLenMinusOneFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,ByteArrayBuffer.MAX_LEN,"bufferMaxLenFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,ByteArrayBuffer.MAX_LEN + 1,"bufferMaxLenPlusOneFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,(int)(1.5 * ByteArrayBuffer.MAX_LEN),"1point5BufferMaxLenFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,(2 * ByteArrayBuffer.MAX_LEN) - 1,"2TimesBufferMaxLenMinusOneFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,2 * ByteArrayBuffer.MAX_LEN,"2TimesBufferMaxLenFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,(2 * ByteArrayBuffer.MAX_LEN) + 1,"2TimesBufferMaxLenPlusOneFile.txt");
        uploadAndVerifyFile(sftp,clientFolder,dir,200000,"largerFile.txt");
        Path invalidPath=clientFolder.resolve(getCurrentTestName() + "-invalid");
        testInvalidParams(sftp,invalidPath,Utils.resolveRelativeRemotePath(parentPath,invalidPath));
        sftp.rmdir(dir);
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-10 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testReadDir() throws Exception {
  ChannelSftp c=(ChannelSftp)session.openChannel(SftpConstants.SFTP_SUBSYSTEM_NAME);
  c.connect();
  try {
    URI url=getClass().getClassLoader().getResource(SshClient.class.getName().replace('.','/') + ".class").toURI();
    URI base=new File(System.getProperty("user.dir")).getAbsoluteFile().toURI();
    File baseDir=new File(base.relativize(url).getPath());
    String path=baseDir.getParent() + "/";
    path=path.replace('\\','/');
    Vector<?> res=c.ls(path);
    File dir=baseDir.getParentFile();
    Collection<String> expNames=OsUtils.isUNIX() ? new LinkedList<String>() : new TreeSet<String>(String.CASE_INSENSITIVE_ORDER);
    String[] names=dir.list();
    if (GenericUtils.length(names) > 0) {
      for (      String n : names) {
        if (".".equals(n) || "..".equals(n)) {
          continue;
        }
        assertTrue("Failed to accumulate " + n,expNames.add(n));
      }
    }
    for (    Object f : res) {
      outputDebugMessage("LsEntry: %s",f);
      ChannelSftp.LsEntry entry=(ChannelSftp.LsEntry)f;
      String name=entry.getFilename();
      if (".".equals(name) || "..".equals(name)) {
        continue;
      }
      assertTrue("Entry not found: " + name,expNames.remove(name));
    }
    assertTrue("Un-listed names: " + expNames,GenericUtils.isEmpty(expNames));
  }
  finally {
    c.disconnect();
  }
}

</code></pre>

<pre class="type-8 type-10 type-6 type-3 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCannotEscapeUserRoot() throws Exception {
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  assertHierarchyTargetFolderExists(lclSftp);
  sshd.setFileSystemFactory(new VirtualFileSystemFactory(lclSftp));
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      String escapePath=targetPath.toString();
      if (OsUtils.isWin32()) {
        escapePath="/" + escapePath.replace(File.separatorChar,'/');
      }
      try (SftpClient sftp=session.createSftpClient()){
        SftpClient.Attributes attrs=sftp.stat(escapePath);
        fail("Unexpected escape success for path=" + escapePath + ": "+ attrs);
      }
 catch (      SftpException e) {
        if (OsUtils.isWin32()) {
          assertEquals("Mismatched status for " + escapePath,SftpConstants.getStatusName(SftpConstants.SSH_FX_INVALID_FILENAME),SftpConstants.getStatusName(e.getStatus()));
        }
 else {
          assertEquals("Mismatched status for " + escapePath,SftpConstants.getStatusName(SftpConstants.SSH_FX_NO_SUCH_FILE),SftpConstants.getStatusName(e.getStatus()));
        }
      }
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSftpVersionSelector() throws Exception {
  final AtomicInteger selected=new AtomicInteger(-1);
  SftpVersionSelector selector=new SftpVersionSelector(){
    @Override public int selectVersion(    int current,    List<Integer> available){
      int numAvailable=GenericUtils.size(available);
      Integer maxValue=null;
      if (numAvailable == 1) {
        maxValue=available.get(0);
      }
 else {
        for (        Integer v : available) {
          if (v.intValue() == current) {
            continue;
          }
          if ((maxValue == null) || (maxValue.intValue() < v.intValue())) {
            maxValue=v;
          }
        }
      }
      selected.set(maxValue.intValue());
      return selected.get();
    }
  }
;
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient(selector)){
        assertEquals("Mismatched negotiated version",selected.get(),sftp.getVersion());
        testClient(client,sftp);
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-10 type-2 type-3 type-7 type-12 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServerExtensionsDeclarations() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        Map<String,byte[]> extensions=sftp.getServerExtensions();
        for (        String name : new String[]{SftpConstants.EXT_NEWLINE,SftpConstants.EXT_VERSIONS,SftpConstants.EXT_VENDOR_ID,SftpConstants.EXT_ACL_SUPPORTED,SftpConstants.EXT_SUPPORTED,SftpConstants.EXT_SUPPORTED2}) {
          assertTrue("Missing extension=" + name,extensions.containsKey(name));
        }
        Map<String,?> data=ParserUtils.parse(extensions);
        for (        Map.Entry<String,?> de : data.entrySet()) {
          String extName=de.getKey();
          Object extValue=de.getValue();
          outputDebugMessage("%s: %s",extName,extValue);
          if (SftpConstants.EXT_SUPPORTED.equalsIgnoreCase(extName)) {
            assertSupportedExtensions(extName,((Supported)extValue).extensionNames);
          }
 else           if (SftpConstants.EXT_SUPPORTED2.equalsIgnoreCase(extName)) {
            assertSupportedExtensions(extName,((Supported2)extValue).extensionNames);
          }
 else           if (SftpConstants.EXT_ACL_SUPPORTED.equalsIgnoreCase(extName)) {
            assertSupportedAclCapabilities((AclCapabilities)extValue);
          }
 else           if (SftpConstants.EXT_VERSIONS.equalsIgnoreCase(extName)) {
            assertSupportedVersions((Versions)extValue);
          }
 else           if (SftpConstants.EXT_NEWLINE.equalsIgnoreCase(extName)) {
            assertNewlineValue((Newline)extValue);
          }
        }
        for (        String extName : extensions.keySet()) {
          if (!data.containsKey(extName)) {
            outputDebugMessage("No parser for extension=%s",extName);
          }
        }
        for (        OpenSSHExtension expected : SftpSubsystem.DEFAULT_OPEN_SSH_EXTENSIONS) {
          String name=expected.getName();
          Object value=data.get(name);
          assertNotNull("OpenSSH extension not declared: " + name,value);
          OpenSSHExtension actual=(OpenSSHExtension)value;
          assertEquals("Mismatched version for OpenSSH extension=" + name,expected.getVersion(),actual.getVersion());
        }
        for (        BuiltinSftpClientExtensions type : BuiltinSftpClientExtensions.VALUES) {
          String extensionName=type.getName();
          boolean isOpenSSHExtension=extensionName.endsWith("@openssh.com");
          SftpClientExtension instance=sftp.getExtension(extensionName);
          assertNotNull("Extension not implemented:" + extensionName,instance);
          assertEquals("Mismatched instance name",extensionName,instance.getName());
          if (instance.isSupported()) {
            if (isOpenSSHExtension) {
              assertTrue("Unlisted default OpenSSH extension: " + extensionName,SftpSubsystem.DEFAULT_OPEN_SSH_EXTENSIONS_NAMES.contains(extensionName));
            }
          }
 else {
            assertTrue("Unsupported non-OpenSSH extension: " + extensionName,isOpenSSHExtension);
            assertFalse("Unsupported default OpenSSH extension: " + extensionName,SftpSubsystem.DEFAULT_OPEN_SSH_EXTENSIONS_NAMES.contains(extensionName));
          }
        }
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-2 type-3 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClient() throws Exception {
  List<NamedFactory<Command>> factories=sshd.getSubsystemFactories();
  assertEquals("Mismatched subsystem factories count",1,GenericUtils.size(factories));
  NamedFactory<Command> f=factories.get(0);
  assertObjectInstanceOf("Not an SFTP subsystem factory",SftpSubsystemFactory.class,f);
  SftpSubsystemFactory factory=(SftpSubsystemFactory)f;
  final AtomicInteger versionHolder=new AtomicInteger(-1);
  final AtomicInteger openCount=new AtomicInteger(0);
  final AtomicInteger closeCount=new AtomicInteger(0);
  final AtomicLong readSize=new AtomicLong(0L);
  final AtomicLong writeSize=new AtomicLong(0L);
  final AtomicInteger entriesCount=new AtomicInteger(0);
  final AtomicInteger creatingCount=new AtomicInteger(0);
  final AtomicInteger createdCount=new AtomicInteger(0);
  final AtomicInteger removingCount=new AtomicInteger(0);
  final AtomicInteger removedCount=new AtomicInteger(0);
  final AtomicInteger modifyingCount=new AtomicInteger(0);
  final AtomicInteger modifiedCount=new AtomicInteger(0);
  factory.addSftpEventListener(new SftpEventListener(){
    private final Logger log=LoggerFactory.getLogger(SftpEventListener.class);
    @Override public void initialized(    ServerSession session,    int version){
      log.info("initialized(" + session + ") version: "+ version);
      assertTrue("Initialized version below minimum",version >= SftpSubsystem.LOWER_SFTP_IMPL);
      assertTrue("Initialized version above maximum",version <= SftpSubsystem.HIGHER_SFTP_IMPL);
      assertTrue("Initializion re-called",versionHolder.getAndSet(version) < 0);
    }
    @Override public void destroying(    ServerSession session){
      log.info("destroying(" + session + ")");
      assertTrue("Initialization method not called",versionHolder.get() > 0);
    }
    @Override public void write(    ServerSession session,    String remoteHandle,    FileHandle localHandle,    long offset,    byte[] data,    int dataOffset,    int dataLen){
      writeSize.addAndGet(dataLen);
      if (log.isDebugEnabled()) {
        log.debug("write(" + session + ")["+ localHandle.getFile()+ "] offset="+ offset+ ", requested="+ dataLen);
      }
    }
    @Override public void removing(    ServerSession session,    Path path){
      removingCount.incrementAndGet();
      log.info("removing(" + session + ") "+ path);
    }
    @Override public void removed(    ServerSession session,    Path path,    Throwable thrown){
      removedCount.incrementAndGet();
      log.info("removed(" + session + ") "+ path+ ((thrown == null) ? "" : (": " + thrown.getClass().getSimpleName() + ": "+ thrown.getMessage())));
    }
    @Override public void modifyingAttributes(    ServerSession session,    Path path,    Map<String,?> attrs){
      modifyingCount.incrementAndGet();
      log.info("modifyingAttributes(" + session + ") "+ path);
    }
    @Override public void modifiedAttributes(    ServerSession session,    Path path,    Map<String,?> attrs,    Throwable thrown){
      modifiedCount.incrementAndGet();
      log.info("modifiedAttributes(" + session + ") "+ path+ ((thrown == null) ? "" : (": " + thrown.getClass().getSimpleName() + ": "+ thrown.getMessage())));
    }
    @Override public void read(    ServerSession session,    String remoteHandle,    FileHandle localHandle,    long offset,    byte[] data,    int dataOffset,    int dataLen,    int readLen){
      readSize.addAndGet(readLen);
      if (log.isDebugEnabled()) {
        log.debug("read(" + session + ")["+ localHandle.getFile()+ "] offset="+ offset+ ", requested="+ dataLen+ ", read="+ readLen);
      }
    }
    @Override public void read(    ServerSession session,    String remoteHandle,    DirectoryHandle localHandle,    Map<String,Path> entries){
      int numEntries=GenericUtils.size(entries);
      entriesCount.addAndGet(numEntries);
      if (log.isDebugEnabled()) {
        log.debug("read(" + session + ")["+ localHandle.getFile()+ "] "+ numEntries+ " entries");
      }
      if ((numEntries > 0) && log.isTraceEnabled()) {
        for (        Map.Entry<String,Path> ee : entries.entrySet()) {
          log.trace("read(" + session + ")["+ localHandle.getFile()+ "] "+ ee.getKey()+ " - "+ ee.getValue());
        }
      }
    }
    @Override public void open(    ServerSession session,    String remoteHandle,    Handle localHandle){
      Path path=localHandle.getFile();
      log.info("open(" + session + ")["+ remoteHandle+ "] "+ (Files.isDirectory(path) ? "directory" : "file")+ " "+ path);
      openCount.incrementAndGet();
    }
    @Override public void moving(    ServerSession session,    Path srcPath,    Path dstPath,    Collection<CopyOption> opts){
      log.info("moving(" + session + ")["+ opts+ "]"+ srcPath+ " => "+ dstPath);
    }
    @Override public void moved(    ServerSession session,    Path srcPath,    Path dstPath,    Collection<CopyOption> opts,    Throwable thrown){
      log.info("moved(" + session + ")["+ opts+ "]"+ srcPath+ " => "+ dstPath+ ((thrown == null) ? "" : (": " + thrown.getClass().getSimpleName() + ": "+ thrown.getMessage())));
    }
    @Override public void linking(    ServerSession session,    Path src,    Path target,    boolean symLink){
      log.info("linking(" + session + ")["+ symLink+ "]"+ src+ " => "+ target);
    }
    @Override public void linked(    ServerSession session,    Path src,    Path target,    boolean symLink,    Throwable thrown){
      log.info("linked(" + session + ")["+ symLink+ "]"+ src+ " => "+ target+ ((thrown == null) ? "" : (": " + thrown.getClass().getSimpleName() + ": "+ thrown.getMessage())));
    }
    @Override public void creating(    ServerSession session,    Path path,    Map<String,?> attrs){
      creatingCount.incrementAndGet();
      log.info("creating(" + session + ") "+ (Files.isDirectory(path) ? "directory" : "file")+ " "+ path);
    }
    @Override public void created(    ServerSession session,    Path path,    Map<String,?> attrs,    Throwable thrown){
      createdCount.incrementAndGet();
      log.info("created(" + session + ") "+ (Files.isDirectory(path) ? "directory" : "file")+ " "+ path+ ((thrown == null) ? "" : (": " + thrown.getClass().getSimpleName() + ": "+ thrown.getMessage())));
    }
    @Override public void blocking(    ServerSession session,    String remoteHandle,    FileHandle localHandle,    long offset,    long length,    int mask){
      log.info("blocking(" + session + ")["+ localHandle.getFile()+ "]"+ " offset="+ offset+ ", length="+ length+ ", mask=0x"+ Integer.toHexString(mask));
    }
    @Override public void blocked(    ServerSession session,    String remoteHandle,    FileHandle localHandle,    long offset,    long length,    int mask,    Throwable thrown){
      log.info("blocked(" + session + ")["+ localHandle.getFile()+ "]"+ " offset="+ offset+ ", length="+ length+ ", mask=0x"+ Integer.toHexString(mask)+ ((thrown == null) ? "" : (": " + thrown.getClass().getSimpleName() + ": "+ thrown.getMessage())));
    }
    @Override public void unblocking(    ServerSession session,    String remoteHandle,    FileHandle localHandle,    long offset,    long length){
      log.info("unblocking(" + session + ")["+ localHandle.getFile()+ "] offset="+ offset+ ", length="+ length);
    }
    @Override public void unblocked(    ServerSession session,    String remoteHandle,    FileHandle localHandle,    long offset,    long length,    Boolean result,    Throwable thrown){
      log.info("unblocked(" + session + ")["+ localHandle.getFile()+ "]"+ " offset="+ offset+ ", length="+ length+ ", result="+ result+ ((thrown == null) ? "" : (": " + thrown.getClass().getSimpleName() + ": "+ thrown.getMessage())));
    }
    @Override public void close(    ServerSession session,    String remoteHandle,    Handle localHandle){
      Path path=localHandle.getFile();
      log.info("close(" + session + ")["+ remoteHandle+ "] "+ (Files.isDirectory(path) ? "directory" : "file")+ " "+ path);
      closeCount.incrementAndGet();
    }
  }
);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        assertEquals("Mismatched negotiated version",sftp.getVersion(),versionHolder.get());
        testClient(client,sftp);
      }
       assertEquals("Mismatched open/close count",openCount.get(),closeCount.get());
      assertTrue("No entries read",entriesCount.get() > 0);
      assertTrue("No data read",readSize.get() > 0L);
      assertTrue("No data written",writeSize.get() > 0L);
      assertEquals("Mismatched removal counts",removingCount.get(),removedCount.get());
      assertTrue("No removals signalled",removedCount.get() > 0);
      assertEquals("Mismatched creation counts",creatingCount.get(),createdCount.get());
      assertTrue("No creations signalled",creatingCount.get() > 0);
      assertEquals("Mismatched modification counts",modifyingCount.get(),modifiedCount.get());
      assertTrue("No modifications signalled",modifiedCount.get() > 0);
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-11 type-8 type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNormalizeRemoteRootValues() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        StringBuilder sb=new StringBuilder(Long.SIZE + 1);
        String expected=sftp.canonicalPath("/");
        for (int i=0; i < Long.SIZE; i++) {
          if (sb.length() > 0) {
            sb.setLength(0);
          }
          for (int j=1; j <= i; j++) {
            sb.append('/');
          }
          String remotePath=sb.toString();
          String actual=sftp.canonicalPath(remotePath);
          assertEquals("Mismatched roots for " + remotePath.length() + " slashes",expected,actual);
        }
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-11 type-8 type-3 type-7 type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testNormalizeRemotePathsValues() throws Exception {
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Path testFile=assertHierarchyTargetFolderExists(lclSftp).resolve("file.txt");
  String file=Utils.resolveRelativeRemotePath(parentPath,testFile);
  String[] comps=GenericUtils.split(file,'/');
  try (SshClient client=setupTestClient()){
    client.start();
    Factory<? extends Random> factory=client.getRandomFactory();
    Random rnd=factory.create();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        StringBuilder sb=new StringBuilder(file.length() + comps.length);
        String expected=sftp.canonicalPath(file);
        for (int i=0; i < file.length(); i++) {
          if (sb.length() > 0) {
            sb.setLength(0);
          }
          sb.append(comps[0]);
          for (int j=1; j < comps.length; j++) {
            String name=comps[j];
            slashify(sb,rnd);
            sb.append(name);
          }
          slashify(sb,rnd);
          if (rnd.random(Byte.SIZE) < (Byte.SIZE / 2)) {
            sb.append('.');
          }
          String remotePath=sb.toString();
          String actual=sftp.canonicalPath(remotePath);
          assertEquals("Mismatched canonical value for " + remotePath,expected,actual);
        }
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-2 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadWriteWithOffset() throws Exception {
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(lclSftp);
  Path localPath=assertHierarchyTargetFolderExists(lclSftp).resolve("file.txt");
  String remotePath=Utils.resolveRelativeRemotePath(targetPath.getParent(),localPath);
  String data=getCurrentTestName();
  String extraData="@" + getClass().getSimpleName();
  int appendOffset=-5;
  ChannelSftp c=(ChannelSftp)session.openChannel(SftpConstants.SFTP_SUBSYSTEM_NAME);
  c.connect();
  try {
    c.put(new ByteArrayInputStream(data.getBytes(StandardCharsets.UTF_8)),remotePath);
    assertTrue("Remote file not created after initial write: " + localPath,Files.exists(localPath));
    assertEquals("Mismatched data read from " + remotePath,data,readFile(remotePath));
    try (OutputStream os=c.put(remotePath,null,ChannelSftp.APPEND,appendOffset)){
      os.write(extraData.getBytes(StandardCharsets.UTF_8));
    }
   }
  finally {
    c.disconnect();
  }
  assertTrue("Remote file not created after data update: " + localPath,Files.exists(localPath));
  String expected=data.substring(0,data.length() + appendOffset) + extraData;
  String actual=readFile(remotePath);
  assertEquals("Mismatched final file data in " + remotePath,expected,actual);
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown() throws Exception {
  if (session != null) {
    session.disconnect();
  }
  tearDownServer();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  setupServer();
  JSch sch=new JSch();
  session=sch.getSession("sshd",TEST_LOCALHOST,port);
  session.setUserInfo(new SimpleUserInfo("sshd"));
  session.connect();
}

</code></pre>

<pre class="type-8 type-6 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRename() throws Exception {
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(lclSftp);
  Path parentPath=targetPath.getParent();
  Path clientFolder=assertHierarchyTargetFolderExists(lclSftp.resolve("client"));
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        Path file1=clientFolder.resolve("file-1.txt");
        String file1Path=Utils.resolveRelativeRemotePath(parentPath,file1);
        try (OutputStream os=sftp.write(file1Path,SftpClient.MIN_WRITE_BUFFER_SIZE)){
          os.write((getCurrentTestName() + "\n").getBytes(StandardCharsets.UTF_8));
        }
         Path file2=clientFolder.resolve("file-2.txt");
        String file2Path=Utils.resolveRelativeRemotePath(parentPath,file2);
        Path file3=clientFolder.resolve("file-3.txt");
        String file3Path=Utils.resolveRelativeRemotePath(parentPath,file3);
        try {
          sftp.rename(file2Path,file3Path);
          fail("Unxpected rename success of " + file2Path + " => "+ file3Path);
        }
 catch (        org.apache.sshd.common.subsystem.sftp.SftpException e) {
          assertEquals("Mismatched status for failed rename of " + file2Path + " => "+ file3Path,SftpConstants.SSH_FX_NO_SUCH_FILE,e.getStatus());
        }
        try (OutputStream os=sftp.write(file2Path,SftpClient.MIN_WRITE_BUFFER_SIZE)){
          os.write("h".getBytes(StandardCharsets.UTF_8));
        }
         try {
          sftp.rename(file1Path,file2Path);
          fail("Unxpected rename success of " + file1Path + " => "+ file2Path);
        }
 catch (        org.apache.sshd.common.subsystem.sftp.SftpException e) {
          assertEquals("Mismatched status for failed rename of " + file1Path + " => "+ file2Path,SftpConstants.SSH_FX_FILE_ALREADY_EXISTS,e.getStatus());
        }
        sftp.rename(file1Path,file2Path,SftpClient.CopyMode.Overwrite);
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testServerDoesNotSupportSftp() throws Exception {
  sshd.setSubsystemFactories(null);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      PropertyResolverUtils.updateProperty(session,SftpClient.SFTP_CHANNEL_OPEN_TIMEOUT,TimeUnit.SECONDS.toMillis(4L));
      try (SftpClient sftp=session.createSftpClient()){
        fail("Unexpected SFTP client creation success");
      }
 catch (      SocketTimeoutException|EOFException|WindowClosedException e) {
      }
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-6 type-2 type-3 type-7 type-13 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOpen() throws Exception {
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Path clientFolder=lclSftp.resolve("client");
  Path testFile=clientFolder.resolve("file.txt");
  String file=Utils.resolveRelativeRemotePath(parentPath,testFile);
  File javaFile=testFile.toFile();
  assertHierarchyTargetFolderExists(javaFile.getParentFile());
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      javaFile.createNewFile();
      javaFile.setWritable(false,false);
      javaFile.setReadable(false,false);
      try (SftpClient sftp=session.createSftpClient()){
        boolean isWindows=OsUtils.isWin32();
        try (SftpClient.CloseableHandle h=sftp.open(file)){
          assertTrue("Empty read should have failed on " + file,isWindows);
        }
 catch (        IOException e) {
          if (isWindows) {
            throw e;
          }
        }
        try (SftpClient.CloseableHandle h=sftp.open(file,EnumSet.of(SftpClient.OpenMode.Write))){
          fail("Empty write should have failed on " + file);
        }
 catch (        IOException e) {
        }
        try (SftpClient.CloseableHandle h=sftp.open(file,EnumSet.of(SftpClient.OpenMode.Truncate))){
          assertTrue("Empty truncate should have failed on " + file,isWindows);
        }
 catch (        IOException e) {
        }
        int perms=sftp.stat(file).getPermissions();
        int permsMask=SftpConstants.S_IWUSR | (isWindows ? 0 : SftpConstants.S_IRUSR);
        assertEquals("Mismatched permissions for " + file + ": 0x"+ Integer.toHexString(perms),0,(perms & permsMask));
        javaFile.setWritable(true,false);
        try (SftpClient.CloseableHandle h=sftp.open(file,EnumSet.of(SftpClient.OpenMode.Truncate,SftpClient.OpenMode.Write))){
          assertTrue("Handle not marked as open for file=" + file,h.isOpen());
        }
         byte[] d="0123456789\n".getBytes(StandardCharsets.UTF_8);
        try (SftpClient.CloseableHandle h=sftp.open(file,EnumSet.of(SftpClient.OpenMode.Write))){
          sftp.write(h,0,d,0,d.length);
          sftp.write(h,d.length,d,0,d.length);
        }
         try (SftpClient.CloseableHandle h=sftp.open(file,EnumSet.of(SftpClient.OpenMode.Write))){
          sftp.write(h,d.length * 2,d,0,d.length);
        }
         try (SftpClient.CloseableHandle h=sftp.open(file,EnumSet.of(SftpClient.OpenMode.Write))){
          byte[] overwrite="-".getBytes(StandardCharsets.UTF_8);
          sftp.write(h,3L,overwrite,0,1);
          d[3]=overwrite[0];
        }
         try (SftpClient.CloseableHandle h=sftp.open(file)){
          assertTrue("Data read should have failed on " + file,isWindows);
        }
 catch (        IOException e) {
          if (isWindows) {
            throw e;
          }
        }
        javaFile.setReadable(true,false);
        byte[] buf=new byte[3];
        try (SftpClient.CloseableHandle h=sftp.open(file)){
          int l=sftp.read(h,2L,buf,0,buf.length);
          String expected=new String(d,2,l,StandardCharsets.UTF_8);
          String actual=new String(buf,0,l,StandardCharsets.UTF_8);
          assertEquals("Mismatched read data",expected,actual);
        }
       }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-11 type-8 type-10 type-6 type-3 type-7 type-13 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadBufferLimit() throws Exception {
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Path testFile=assertHierarchyTargetFolderExists(lclSftp).resolve("file.txt");
  byte[] expected=new byte[1024];
  Factory<? extends Random> factory=sshd.getRandomFactory();
  Random rnd=factory.create();
  rnd.fill(expected);
  Files.write(testFile,expected);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        String file=Utils.resolveRelativeRemotePath(parentPath,testFile);
        byte[] actual=new byte[expected.length];
        int maxAllowed=actual.length / 4;
        PropertyResolverUtils.updateProperty(sshd,SftpSubsystem.MAX_PACKET_LENGTH_PROP,maxAllowed);
        try (CloseableHandle handle=sftp.open(file,OpenMode.Read)){
          int readLen=sftp.read(handle,0L,actual);
          assertEquals("Mismatched read len",maxAllowed,readLen);
          for (int index=0; index < readLen; index++) {
            byte expByte=expected[index], actByte=actual[index];
            if (expByte != actByte) {
              fail("Mismatched values at index=" + index + ": expected=0x"+ Integer.toHexString(expByte & 0xFF)+ ", actual=0x"+ Integer.toHexString(actByte & 0xFF));
            }
          }
        }
       }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSftp() throws Exception {
  String d=getCurrentTestName() + "\n";
  Path targetPath=detectTargetFolder();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(lclSftp);
  Path target=assertHierarchyTargetFolderExists(lclSftp).resolve("file.txt");
  String remotePath=Utils.resolveRelativeRemotePath(targetPath.getParent(),target);
  final int NUM_ITERATIONS=10;
  StringBuilder sb=new StringBuilder(d.length() * NUM_ITERATIONS * NUM_ITERATIONS);
  for (int j=1; j <= NUM_ITERATIONS; j++) {
    if (sb.length() > 0) {
      sb.setLength(0);
    }
    for (int i=0; i < j; i++) {
      sb.append(d);
    }
    sendFile(remotePath,sb.toString());
    assertFileLength(target,sb.length(),TimeUnit.SECONDS.toMillis(5L));
    Files.delete(target);
  }
}

</code></pre>

<pre class="type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNavigateBeyondRootFolder() throws Exception {
  Path rootLocation=Paths.get(OsUtils.isUNIX() ? "/" : "C:\\");
  final FileSystem fsRoot=rootLocation.getFileSystem();
  sshd.setFileSystemFactory(new FileSystemFactory(){
    @Override public FileSystem createFileSystem(    Session session) throws IOException {
      return fsRoot;
    }
  }
);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        String rootDir=sftp.canonicalPath("/");
        String upDir=sftp.canonicalPath(rootDir + "/..");
        assertEquals("Mismatched root dir parent",rootDir,upDir);
      }
     }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-3 type-7 type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testWriteOffsetIgnoredForAppendMode() throws IOException {
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path lclSftp=Utils.resolve(targetPath,SftpConstants.SFTP_SUBSYSTEM_NAME,getClass().getSimpleName(),getCurrentTestName());
  Path testFile=assertHierarchyTargetFolderExists(lclSftp).resolve("file.txt");
  Files.deleteIfExists(testFile);
  byte[] expectedRandom=new byte[Byte.MAX_VALUE];
  Factory<? extends Random> factory=sshd.getRandomFactory();
  Random rnd=factory.create();
  rnd.fill(expectedRandom);
  byte[] expectedText=(getClass().getName() + "#" + getCurrentTestName()).getBytes(StandardCharsets.UTF_8);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      try (SftpClient sftp=session.createSftpClient()){
        String file=Utils.resolveRelativeRemotePath(parentPath,testFile);
        try (CloseableHandle handle=sftp.open(file,OpenMode.Create,OpenMode.Write,OpenMode.Read,OpenMode.Append)){
          sftp.write(handle,7365L,expectedRandom);
          byte[] actualRandom=new byte[expectedRandom.length];
          int readLen=sftp.read(handle,0L,actualRandom);
          assertEquals("Incomplete random data read",expectedRandom.length,readLen);
          assertArrayEquals("Mismatched read random data",expectedRandom,actualRandom);
          sftp.write(handle,3777347L,expectedText);
          byte[] actualText=new byte[expectedText.length];
          readLen=sftp.read(handle,actualRandom.length,actualText);
          assertEquals("Incomplete text data read",actualText.length,readLen);
          assertArrayEquals("Mismatched read text data",expectedText,actualText);
        }
       }
     }
  finally {
      client.stop();
    }
  }
   byte[] actualBytes=Files.readAllBytes(testFile);
  assertEquals("Mismatched result file size",expectedRandom.length + expectedText.length,actualBytes.length);
  byte[] actualRandom=Arrays.copyOfRange(actualBytes,0,expectedRandom.length);
  assertArrayEquals("Mismatched random part",expectedRandom,actualRandom);
  byte[] actualText=Arrays.copyOfRange(actualBytes,expectedRandom.length,actualBytes.length);
  assertArrayEquals("Mismatched text part",expectedText,actualText);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
