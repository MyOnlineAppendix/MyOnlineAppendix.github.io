<h3 style="margin:0px">Class: org.apache.sshd.client.scp.ScpTest (16 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(5)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testScpNativePreserveAttributes() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      Path targetPath=detectTargetFolder();
      Path parentPath=targetPath.getParent();
      Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(scpRoot);
      Path localDir=scpRoot.resolve("local");
      Path localSubDir=assertHierarchyTargetFolderExists(localDir.resolve("dir"));
      final long lastModMillis=System.currentTimeMillis() - TimeUnit.DAYS.toMillis(1);
      final long lastModSecs=TimeUnit.MILLISECONDS.toSeconds(lastModMillis);
      Path local1=localDir.resolve("file-1.txt");
      byte[] data=Utils.writeFile(local1,getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL);
      File lclFile1=local1.toFile();
      boolean lcl1ModSet=lclFile1.setLastModified(lastModMillis);
      lclFile1.setExecutable(true,true);
      lclFile1.setWritable(false,false);
      Path localSub2=localSubDir.resolve("file-2.txt");
      Files.write(localSub2,data);
      File lclSubFile2=localSub2.toFile();
      boolean lclSub2ModSet=lclSubFile2.setLastModified(lastModMillis);
      Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
      String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteDir);
      scp.upload(localDir.toString() + File.separator + "*",remotePath,ScpClient.Option.Recursive,ScpClient.Option.PreserveAttributes);
      Path remote1=remoteDir.resolve(local1.getFileName());
      assertFileLength(remote1,data.length,TimeUnit.SECONDS.toMillis(5L));
      File remFile1=remote1.toFile();
      assertLastModifiedTimeEquals(remFile1,lcl1ModSet,lastModSecs);
      Path remoteSubDir=remoteDir.resolve(localSubDir.getFileName());
      Path remoteSub2=remoteSubDir.resolve(localSub2.getFileName());
      assertFileLength(remoteSub2,data.length,TimeUnit.SECONDS.toMillis(5L));
      File remSubFile2=remoteSub2.toFile();
      assertLastModifiedTimeEquals(remSubFile2,lclSub2ModSet,lastModSecs);
      Utils.deleteRecursive(localDir);
      assertHierarchyTargetFolderExists(localDir);
      scp.download(remotePath + "/*",localDir,ScpClient.Option.Recursive,ScpClient.Option.PreserveAttributes);
      assertFileLength(local1,data.length,TimeUnit.SECONDS.toMillis(5L));
      assertLastModifiedTimeEquals(lclFile1,lcl1ModSet,lastModSecs);
      assertFileLength(localSub2,data.length,TimeUnit.SECONDS.toMillis(5L));
      assertLastModifiedTimeEquals(lclSubFile2,lclSub2ModSet,lastModSecs);
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testScpNativeOnDirWithPattern() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      Path targetPath=detectTargetFolder();
      Path parentPath=targetPath.getParent();
      Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(scpRoot);
      Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
      Path local1=localDir.resolve("file-1.txt");
      byte[] data=Utils.writeFile(local1,getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL);
      Path local2=localDir.resolve("file-2.txt");
      Files.write(local2,data);
      Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
      String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteDir);
      scp.upload(localDir.toString() + File.separator + "*",remotePath);
      assertFileLength(remoteDir.resolve(local1.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
      assertFileLength(remoteDir.resolve(local2.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
      Files.delete(local1);
      Files.delete(local2);
      scp.download(remotePath + "/*",localDir);
      assertFileLength(local1,data.length,TimeUnit.SECONDS.toMillis(5L));
      assertFileLength(local2,data.length,TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  sshd=setupTestServer();
  sshd.setCommandFactory(new ScpCommandFactory());
  sshd.setFileSystemFactory(fileSystemFactory);
  sshd.start();
  port=sshd.getPort();
}

</code></pre>

<pre class="type-2 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJschScp() throws Exception {
  com.jcraft.jsch.Session session=getJschSession();
  try {
    String data=getCurrentTestName() + "\n";
    String unixDir="target/scp";
    String fileName=getCurrentTestName() + ".txt";
    String unixPath=unixDir + "/" + fileName;
    File root=new File(unixDir);
    File target=new File(unixPath);
    Utils.deleteRecursive(root);
    root.mkdirs();
    assertTrue(root.exists());
    target.delete();
    assertFalse(target.exists());
    sendFile(session,unixPath,fileName,data);
    assertFileLength(target,data.length(),TimeUnit.SECONDS.toMillis(5L));
    target.delete();
    assertFalse(target.exists());
    sendFile(session,unixDir,fileName,data);
    assertFileLength(target,data.length(),TimeUnit.SECONDS.toMillis(5L));
    sendFileError(session,"target",ScpHelper.SCP_COMMAND_PREFIX,data);
    readFileError(session,unixDir);
    assertEquals("Mismatched file data",data,readFile(session,unixPath,target.length()));
    assertEquals("Mismatched dir data",data,readDir(session,unixDir,fileName,target.length()));
    target.delete();
    root.delete();
    sendDir(session,"target",ScpHelper.SCP_COMMAND_PREFIX,fileName,data);
    assertFileLength(target,data.length(),TimeUnit.SECONDS.toMillis(5L));
  }
  finally {
    session.disconnect();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUploadAbsoluteDriveLetter() throws Exception {
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(scpRoot);
  Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
  Path localFile=localDir.resolve("file-1.txt");
  byte[] data=Utils.writeFile(localFile,getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL);
  Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
  Path remoteFile=remoteDir.resolve(localFile.getFileName().toString());
  String localPath=localFile.toString();
  String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteFile);
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      scp.upload(localPath,remotePath);
      assertFileLength(remoteFile,data.length,TimeUnit.SECONDS.toMillis(5L));
      Path secondRemote=remoteDir.resolve("file-2.txt");
      String secondPath=Utils.resolveRelativeRemotePath(parentPath,secondRemote);
      scp.upload(localPath,secondPath);
      assertFileLength(secondRemote,data.length,TimeUnit.SECONDS.toMillis(5L));
      Path pathRemote=remoteDir.resolve("file-path.txt");
      String pathPath=Utils.resolveRelativeRemotePath(parentPath,pathRemote);
      scp.upload(localFile,pathPath);
      assertFileLength(pathRemote,data.length,TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-3 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStreamsUploadAndDownload() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      Path targetPath=detectTargetFolder();
      Path parentPath=targetPath.getParent();
      Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(scpRoot);
      Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
      Path remoteFile=remoteDir.resolve("file.txt");
      String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteFile);
      byte[] data=(getClass().getName() + "#" + getCurrentTestName()).getBytes(StandardCharsets.UTF_8);
      outputDebugMessage("Upload data to %s",remotePath);
      scp.upload(data,remotePath,EnumSet.allOf(PosixFilePermission.class),null);
      assertFileLength(remoteFile,data.length,TimeUnit.SECONDS.toMillis(5L));
      byte[] uploaded=Files.readAllBytes(remoteFile);
      assertArrayEquals("Mismatched uploaded data",data,uploaded);
      outputDebugMessage("Download data from %s",remotePath);
      byte[] downloaded=scp.downloadBytes(remotePath);
      assertArrayEquals("Mismatched downloaded data",uploaded,downloaded);
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testScpNativeOnMixedDirAndFiles() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      Path targetPath=detectTargetFolder();
      Path parentPath=targetPath.getParent();
      Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(scpRoot);
      Path localDir=scpRoot.resolve("local");
      Path localSubDir=assertHierarchyTargetFolderExists(localDir.resolve("dir"));
      Path local1=localDir.resolve("file-1.txt");
      byte[] data=Utils.writeFile(local1,getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL);
      Path localSub2=localSubDir.resolve("file-2.txt");
      Files.write(localSub2,data);
      Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
      String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteDir);
      scp.upload(localDir.toString() + File.separator + "*",remotePath,ScpClient.Option.Recursive);
      assertFileLength(remoteDir.resolve(local1.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
      Path remoteSubDir=remoteDir.resolve(localSubDir.getFileName());
      assertFileLength(remoteSubDir.resolve(localSub2.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
      Files.delete(local1);
      Utils.deleteRecursive(localSubDir);
      scp.download(remotePath + "/*",localDir);
      assertFileLength(local1,data.length,TimeUnit.SECONDS.toMillis(5L));
      assertFalse("Unexpected recursive local file: " + localSub2,Files.exists(localSub2));
      Files.delete(local1);
      scp.download(remotePath + "/*",localDir,ScpClient.Option.Recursive);
      assertFileLength(local1,data.length,TimeUnit.SECONDS.toMillis(5L));
      assertFileLength(localSub2,data.length,TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testScpDownloadZeroLengthFile() throws Exception {
  Path targetPath=detectTargetFolder();
  Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
  Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
  Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
  Path zeroLocal=localDir.resolve(getCurrentTestName());
  if (Files.exists(zeroLocal)) {
    Files.delete(zeroLocal);
  }
  Path zeroRemote=remoteDir.resolve(zeroLocal.getFileName());
  try (FileChannel fch=FileChannel.open(zeroRemote,StandardOpenOption.CREATE,StandardOpenOption.WRITE,StandardOpenOption.TRUNCATE_EXISTING)){
    if (fch.size() > 0L) {
      fch.truncate(0L);
    }
  }
   assertEquals("Non-zero size for remote file=" + zeroRemote,0L,Files.size(zeroRemote));
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      String remotePath=Utils.resolveRelativeRemotePath(targetPath.getParent(),zeroRemote);
      scp.download(remotePath,zeroLocal.toString());
      assertFileLength(zeroLocal,0L,TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testScpNativeOnRecursiveDirs() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      Path targetPath=detectTargetFolder();
      Path parentPath=targetPath.getParent();
      Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(scpRoot);
      Path localDir=scpRoot.resolve("local");
      Path localSubDir=assertHierarchyTargetFolderExists(localDir.resolve("dir"));
      Path localSub1=localSubDir.resolve("file-1.txt");
      byte[] data=Utils.writeFile(localSub1,getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL);
      Path localSub2=localSubDir.resolve("file-2.txt");
      Files.write(localSub2,data);
      Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
      scp.upload(localSubDir,Utils.resolveRelativeRemotePath(parentPath,remoteDir),ScpClient.Option.Recursive);
      Path remoteSubDir=remoteDir.resolve(localSubDir.getFileName());
      assertFileLength(remoteSubDir.resolve(localSub1.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
      assertFileLength(remoteSubDir.resolve(localSub2.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
      Utils.deleteRecursive(localSubDir);
      scp.download(Utils.resolveRelativeRemotePath(parentPath,remoteSubDir),localDir,ScpClient.Option.Recursive);
      assertFileLength(localSub1,data.length,TimeUnit.SECONDS.toMillis(5L));
      assertFileLength(localSub2,data.length,TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-6 type-2 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testScpNativeOnSingleFile() throws Exception {
  String data=getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL;
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(scpRoot);
  Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
  Path localOutFile=localDir.resolve("file-1.txt");
  Path remoteDir=scpRoot.resolve("remote");
  Path remoteOutFile=remoteDir.resolve(localOutFile.getFileName());
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      Utils.writeFile(localOutFile,data);
      assertFalse("Remote folder already exists: " + remoteDir,Files.exists(remoteDir));
      String localOutPath=localOutFile.toString();
      String remoteOutPath=Utils.resolveRelativeRemotePath(parentPath,remoteOutFile);
      outputDebugMessage("Expect upload failure %s => %s",localOutPath,remoteOutPath);
      try {
        scp.upload(localOutPath,remoteOutPath);
        fail("Expected IOException for 1st time " + remoteOutPath);
      }
 catch (      IOException e) {
      }
      assertHierarchyTargetFolderExists(remoteDir);
      outputDebugMessage("Expect upload success %s => %s",localOutPath,remoteOutPath);
      scp.upload(localOutPath,remoteOutPath);
      assertFileLength(remoteOutFile,data.length(),TimeUnit.SECONDS.toMillis(5L));
      Path secondLocal=localDir.resolve(localOutFile.getFileName());
      String downloadTarget=Utils.resolveRelativeRemotePath(parentPath,secondLocal);
      outputDebugMessage("Expect download success %s => %s",remoteOutPath,downloadTarget);
      scp.download(remoteOutPath,downloadTarget);
      assertFileLength(secondLocal,data.length(),TimeUnit.SECONDS.toMillis(5L));
      Path localPath=localDir.resolve("file-path.txt");
      downloadTarget=Utils.resolveRelativeRemotePath(parentPath,localPath);
      outputDebugMessage("Expect download success %s => %s",remoteOutPath,downloadTarget);
      scp.download(remoteOutPath,downloadTarget);
      assertFileLength(localPath,data.length(),TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-2 type-3 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWithGanymede() throws Exception {
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(scpRoot);
  byte[] expected=(getClass().getName() + "#" + getCurrentTestName()).getBytes(StandardCharsets.UTF_8);
  Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
  String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteDir);
  String fileName="file.txt";
  Path remoteFile=remoteDir.resolve(fileName);
  String mode=ScpHelper.getOctalPermissions(EnumSet.of(PosixFilePermission.OTHERS_READ,PosixFilePermission.OTHERS_WRITE,PosixFilePermission.GROUP_READ,PosixFilePermission.GROUP_WRITE,PosixFilePermission.OWNER_READ,PosixFilePermission.OWNER_WRITE));
  ch.ethz.ssh2.log.Logger.enabled=true;
  final Connection conn=new Connection(TEST_LOCALHOST,port);
  try {
    ConnectionInfo info=conn.connect(null,(int)TimeUnit.SECONDS.toMillis(5L),(int)TimeUnit.SECONDS.toMillis(11L));
    outputDebugMessage("Connected: kex=%s, key-type=%s, c2senc=%s, s2cenc=%s, c2mac=%s, s2cmac=%s",info.keyExchangeAlgorithm,info.serverHostKeyAlgorithm,info.clientToServerCryptoAlgorithm,info.serverToClientCryptoAlgorithm,info.clientToServerMACAlgorithm,info.serverToClientMACAlgorithm);
    assertTrue("Failed to authenticate",conn.authenticateWithPassword(getCurrentTestName(),getCurrentTestName()));
    final SCPClient scp_client=new SCPClient(conn);
    try (OutputStream output=scp_client.put(fileName,expected.length,remotePath,mode)){
      output.write(expected);
    }
     assertTrue("Remote file not created: " + remoteFile,Files.exists(remoteFile));
    byte[] remoteData=Files.readAllBytes(remoteFile);
    assertArrayEquals("Mismatched remote put data",expected,remoteData);
    Arrays.fill(remoteData,(byte)0);
    try (InputStream input=scp_client.get(remotePath + "/" + fileName)){
      int readLen=input.read(remoteData);
      assertEquals("Mismatched remote get data size",expected.length,readLen);
      assertEquals("Unexpected extra data after read expected size",(-1),input.read());
    }
     assertArrayEquals("Mismatched remote get data",expected,remoteData);
  }
  finally {
    conn.close();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testScpUploadOverwrite() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      String data=getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL;
      Path targetPath=detectTargetFolder();
      Path parentPath=targetPath.getParent();
      Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(scpRoot);
      Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
      Path localFile=localDir.resolve("file.txt");
      Utils.writeFile(localFile,data);
      Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
      Path remoteFile=remoteDir.resolve(localFile.getFileName());
      Utils.writeFile(remoteFile,data + data);
      String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteFile);
      scp.upload(localFile.toString(),remotePath);
      assertFileLength(remoteFile,data.length(),TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown() throws Exception {
  if (sshd != null) {
    sshd.stop(true);
  }
}

</code></pre>

<pre class="type-11 type-8 type-2 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNormalizedScpRemotePaths() throws Exception {
  Path targetPath=detectTargetFolder();
  Path parentPath=targetPath.getParent();
  Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
  Utils.deleteRecursive(scpRoot);
  Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
  Path localFile=localDir.resolve("file.txt");
  byte[] data=Utils.writeFile(localFile,getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL);
  Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
  Path remoteFile=remoteDir.resolve(localFile.getFileName().toString());
  String localPath=localFile.toString();
  String remotePath=Utils.resolveRelativeRemotePath(parentPath,remoteFile);
  String[] remoteComps=GenericUtils.split(remotePath,'/');
  try (SshClient client=setupTestClient()){
    client.start();
    Factory<? extends Random> factory=client.getRandomFactory();
    Random rnd=factory.create();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      StringBuilder sb=new StringBuilder(remotePath.length() + Long.SIZE);
      for (int i=0; i < Math.max(Long.SIZE,remoteComps.length); i++) {
        if (sb.length() > 0) {
          sb.setLength(0);
        }
        sb.append(remoteComps[0]);
        for (int j=1; j < remoteComps.length; j++) {
          String name=remoteComps[j];
          slashify(sb,rnd);
          sb.append(name);
        }
        slashify(sb,rnd);
        String path=sb.toString();
        scp.upload(localPath,path);
        assertTrue("Remote file not ready for " + path,waitForFile(remoteFile,data.length,TimeUnit.SECONDS.toMillis(5L)));
        byte[] actual=Files.readAllBytes(remoteFile);
        assertArrayEquals("Mismatched uploaded data for " + path,data,actual);
        Files.delete(remoteFile);
        assertFalse("Remote file (" + remoteFile + ") not deleted for "+ path,Files.exists(remoteFile));
      }
    }
   }
 }

</code></pre>

<pre class="type-8 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testScpUploadZeroLengthFile() throws Exception {
  Path targetPath=detectTargetFolder();
  Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
  Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
  Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
  Path zeroLocal=localDir.resolve("zero.txt");
  try (FileChannel fch=FileChannel.open(zeroLocal,StandardOpenOption.CREATE,StandardOpenOption.WRITE,StandardOpenOption.TRUNCATE_EXISTING)){
    if (fch.size() > 0L) {
      fch.truncate(0L);
    }
  }
   assertEquals("Non-zero size for local file=" + zeroLocal,0L,Files.size(zeroLocal));
  Path zeroRemote=remoteDir.resolve(zeroLocal.getFileName());
  if (Files.exists(zeroRemote)) {
    Files.delete(zeroRemote);
  }
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      String remotePath=Utils.resolveRelativeRemotePath(targetPath.getParent(),zeroRemote);
      scp.upload(zeroLocal.toString(),remotePath);
      assertFileLength(zeroRemote,0L,TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<pre class="type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testScpNativeOnMultipleFiles() throws Exception {
  try (SshClient client=setupTestClient()){
    client.start();
    try (ClientSession session=client.connect(getCurrentTestName(),TEST_LOCALHOST,port).verify(7L,TimeUnit.SECONDS).getSession()){
      session.addPasswordIdentity(getCurrentTestName());
      session.auth().verify(5L,TimeUnit.SECONDS);
      ScpClient scp=createScpClient(session);
      Path targetPath=detectTargetFolder();
      Path parentPath=targetPath.getParent();
      Path scpRoot=Utils.resolve(targetPath,ScpHelper.SCP_COMMAND_PREFIX,getClass().getSimpleName(),getCurrentTestName());
      Utils.deleteRecursive(scpRoot);
      Path localDir=assertHierarchyTargetFolderExists(scpRoot.resolve("local"));
      Path local1=localDir.resolve("file-1.txt");
      byte[] data=Utils.writeFile(local1,getClass().getName() + "#" + getCurrentTestName()+ IoUtils.EOL);
      Path local2=localDir.resolve("file-2.txt");
      Files.write(local2,data);
      Path remoteDir=assertHierarchyTargetFolderExists(scpRoot.resolve("remote"));
      Path remote1=remoteDir.resolve(local1.getFileName());
      String remote1Path=Utils.resolveRelativeRemotePath(parentPath,remote1);
      String[] locals={local1.toString(),local2.toString()};
      try {
        scp.upload(locals,remote1Path);
        fail("Unexpected upload success to missing remote file: " + remote1Path);
      }
 catch (      IOException e) {
      }
      Files.write(remote1,data);
      try {
        scp.upload(locals,remote1Path);
        fail("Unexpected upload success to existing remote file: " + remote1Path);
      }
 catch (      IOException e) {
      }
      Path remoteSubDir=assertHierarchyTargetFolderExists(remoteDir.resolve("dir"));
      scp.upload(locals,Utils.resolveRelativeRemotePath(parentPath,remoteSubDir));
      Path remoteSub1=remoteSubDir.resolve(local1.getFileName());
      assertFileLength(remoteSub1,data.length,TimeUnit.SECONDS.toMillis(5L));
      Path remoteSub2=remoteSubDir.resolve(local2.getFileName());
      assertFileLength(remoteSub2,data.length,TimeUnit.SECONDS.toMillis(5L));
      String[] remotes={Utils.resolveRelativeRemotePath(parentPath,remoteSub1),Utils.resolveRelativeRemotePath(parentPath,remoteSub2)};
      try {
        scp.download(remotes,Utils.resolveRelativeRemotePath(parentPath,local1));
        fail("Unexpected download success to existing local file: " + local1);
      }
 catch (      IOException e) {
      }
      Path localSubDir=localDir.resolve("dir");
      try {
        scp.download(remotes,localSubDir);
        fail("Unexpected download success to non-existing folder: " + localSubDir);
      }
 catch (      IOException e) {
      }
      assertHierarchyTargetFolderExists(localSubDir);
      scp.download(remotes,localSubDir);
      assertFileLength(localSubDir.resolve(remoteSub1.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
      assertFileLength(localSubDir.resolve(remoteSub2.getFileName()),data.length,TimeUnit.SECONDS.toMillis(5L));
    }
  finally {
      client.stop();
    }
  }
 }

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
