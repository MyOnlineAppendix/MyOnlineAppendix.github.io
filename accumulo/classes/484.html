<h3 style="margin:0px">Class: org.apache.accumulo.tserver.replication.AccumuloReplicaSystemTest (10 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void endOfFileExceptionOnOpenWalImpliesMoreReplication() throws Exception {
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_NAME.getKey(),"source");
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  ars.setConf(conf);
  Status status=Status.newBuilder().setBegin(100).setEnd(0).setInfiniteEnd(true).setClosed(false).build();
  DataInputStream dis=new DataInputStream(new ByteArrayInputStream(new byte[0]));
  WalReplication repl=ars.getWalEdits(new ReplicationTarget("peer","1","1"),dis,new Path("/accumulo/wals/tserver+port/wal"),status,Long.MAX_VALUE,new HashSet<Integer>());
  Assert.assertEquals(0,repl.entriesConsumed);
  Assert.assertEquals(0,repl.walEdits.getEditsSize());
  Assert.assertEquals(0,repl.sizeInRecords);
  Assert.assertEquals(0,repl.sizeInBytes);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUserKeytab() throws Exception {
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  ReplicationTarget target=new ReplicationTarget("peer","peer_table","1");
  String user="user", keytab="/etc/security/keytabs/replication.keytab";
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_PEER_USER.getKey() + target.getPeerName(),user);
  confMap.put(Property.REPLICATION_PEER_KEYTAB.getKey() + target.getPeerName(),keytab);
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  assertEquals(user,ars.getPrincipal(conf,target));
  assertEquals(keytab,ars.getKeytab(conf,target));
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUserPassword() throws Exception {
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  ReplicationTarget target=new ReplicationTarget("peer","peer_table","1");
  String user="user", password="password";
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_PEER_USER.getKey() + target.getPeerName(),user);
  confMap.put(Property.REPLICATION_PEER_PASSWORD.getKey() + target.getPeerName(),password);
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  assertEquals(user,ars.getPrincipal(conf,target));
  assertEquals(password,ars.getPassword(conf,target));
}

</code></pre>

<pre class="type-9 type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void restartInFileKnowsAboutPreviousTableDefines() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream dos=new DataOutputStream(baos);
  LogFileKey key=new LogFileKey();
  LogFileValue value=new LogFileValue();
  key.seq=1l;
  key.event=LogEvents.DEFINE_TABLET;
  key.tablet=new KeyExtent(new Text("1"),null,null);
  key.tid=1;
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("row")));
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.tid=1;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("row")));
  key.write(dos);
  value.write(dos);
  dos.close();
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_NAME.getKey(),"source");
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  ars.setConf(conf);
  Status status=Status.newBuilder().setBegin(0).setEnd(0).setInfiniteEnd(true).setClosed(false).build();
  DataInputStream dis=new DataInputStream(new ByteArrayInputStream(baos.toByteArray()));
  HashSet<Integer> tids=new HashSet<>();
  WalReplication repl=ars.getWalEdits(new ReplicationTarget("peer","1","1"),dis,new Path("/accumulo/wals/tserver+port/wal"),status,1l,tids);
  Assert.assertEquals(2,repl.entriesConsumed);
  Assert.assertEquals(1,repl.walEdits.getEditsSize());
  Assert.assertEquals(1,repl.sizeInRecords);
  Assert.assertNotEquals(0,repl.sizeInBytes);
  status=Status.newBuilder(status).setBegin(2).build();
  repl=ars.getWalEdits(new ReplicationTarget("peer","1","1"),dis,new Path("/accumulo/wals/tserver+port/wal"),status,1l,tids);
  Assert.assertEquals(1,repl.entriesConsumed);
  Assert.assertEquals(1,repl.walEdits.getEditsSize());
  Assert.assertEquals(1,repl.sizeInRecords);
  Assert.assertNotEquals(0,repl.sizeInBytes);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void dontSendEmptyDataToPeer() throws Exception {
  Client replClient=createMock(Client.class);
  AccumuloReplicaSystem ars=createMock(AccumuloReplicaSystem.class);
  WalEdits edits=new WalEdits(Collections.<ByteBuffer>emptyList());
  WalReplication walReplication=new WalReplication(edits,0,0,0);
  ReplicationTarget target=new ReplicationTarget("peer","2","1");
  DataInputStream input=null;
  Path p=new Path("/accumulo/wals/tserver+port/" + UUID.randomUUID().toString());
  Status status=null;
  long sizeLimit=Long.MAX_VALUE;
  String remoteTableId=target.getRemoteIdentifier();
  TCredentials tcreds=null;
  Set<Integer> tids=new HashSet<>();
  WalClientExecReturn walClientExec=ars.new WalClientExecReturn(target,input,p,status,sizeLimit,remoteTableId,tcreds,tids);
  expect(ars.getWalEdits(target,input,p,status,sizeLimit,tids)).andReturn(walReplication);
  replay(replClient,ars);
  ReplicationStats stats=walClientExec.execute(replClient);
  verify(replClient,ars);
  Assert.assertEquals(new ReplicationStats(0l,0l,0l),stats);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void consumedButNotSentDataShouldBeRecorded() throws Exception {
  Client replClient=createMock(Client.class);
  AccumuloReplicaSystem ars=createMock(AccumuloReplicaSystem.class);
  WalEdits edits=new WalEdits(Collections.<ByteBuffer>emptyList());
  WalReplication walReplication=new WalReplication(edits,0,5,0);
  ReplicationTarget target=new ReplicationTarget("peer","2","1");
  DataInputStream input=null;
  Path p=new Path("/accumulo/wals/tserver+port/" + UUID.randomUUID().toString());
  Status status=null;
  long sizeLimit=Long.MAX_VALUE;
  String remoteTableId=target.getRemoteIdentifier();
  TCredentials tcreds=null;
  Set<Integer> tids=new HashSet<>();
  WalClientExecReturn walClientExec=ars.new WalClientExecReturn(target,input,p,status,sizeLimit,remoteTableId,tcreds,tids);
  expect(ars.getWalEdits(target,input,p,status,sizeLimit,tids)).andReturn(walReplication);
  replay(replClient,ars);
  ReplicationStats stats=walClientExec.execute(replClient);
  verify(replClient,ars);
  Assert.assertEquals(new ReplicationStats(0l,0l,5l),stats);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void endOfFileExceptionOnClosedWalImpliesFullyReplicated() throws Exception {
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_NAME.getKey(),"source");
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  ars.setConf(conf);
  Status status=Status.newBuilder().setBegin(100).setEnd(0).setInfiniteEnd(true).setClosed(true).build();
  DataInputStream dis=new DataInputStream(new ByteArrayInputStream(new byte[0]));
  WalReplication repl=ars.getWalEdits(new ReplicationTarget("peer","1","1"),dis,new Path("/accumulo/wals/tserver+port/wal"),status,Long.MAX_VALUE,new HashSet<Integer>());
  Assert.assertEquals(Long.MAX_VALUE,repl.entriesConsumed);
  Assert.assertEquals(0,repl.walEdits.getEditsSize());
  Assert.assertEquals(0,repl.sizeInRecords);
  Assert.assertEquals(0,repl.sizeInBytes);
}

</code></pre>

<pre class="type-9 type-5 type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void mutationsNotReReplicatedToPeers() throws Exception {
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_NAME.getKey(),"source");
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  ars.setConf(conf);
  LogFileValue value=new LogFileValue();
  value.mutations=new ArrayList<>();
  Mutation m=new Mutation("row");
  m.put("","",new Value(new byte[0]));
  value.mutations.add(m);
  m=new Mutation("row2");
  m.put("","",new Value(new byte[0]));
  m.addReplicationSource("peer");
  value.mutations.add(m);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream out=new DataOutputStream(baos);
  ars.writeValueAvoidingReplicationCycles(out,value,new ReplicationTarget("peer","1","1"));
  out.close();
  ByteArrayInputStream bais=new ByteArrayInputStream(baos.toByteArray());
  DataInputStream in=new DataInputStream(bais);
  int numMutations=in.readInt();
  Assert.assertEquals(1,numMutations);
  m=new Mutation();
  m.readFields(in);
  Assert.assertEquals("row",new String(m.getRow()));
  Assert.assertEquals(1,m.getReplicationSources().size());
  Assert.assertTrue("Expected source cluster to be listed in mutation replication source",m.getReplicationSources().contains("source"));
}

</code></pre>

<pre class="type-9 type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void onlyChooseMutationsForDesiredTableWithClosedStatus() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream dos=new DataOutputStream(baos);
  LogFileKey key=new LogFileKey();
  LogFileValue value=new LogFileValue();
  key.seq=1l;
  key.event=LogEvents.DEFINE_TABLET;
  key.tablet=new KeyExtent(new Text("1"),null,null);
  key.tid=1;
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("row")));
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.DEFINE_TABLET;
  key.tablet=new KeyExtent(new Text("2"),null,null);
  key.tid=2;
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.OPEN;
  key.tid=LogFileKey.VERSION;
  key.tserverSession="foobar";
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("badrow")));
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.COMPACTION_START;
  key.tid=2;
  key.filename="/accumulo/tables/1/t-000001/A000001.rf";
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.DEFINE_TABLET;
  key.tablet=new KeyExtent(new Text("1"),null,null);
  key.tid=3;
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.COMPACTION_FINISH;
  key.tid=6;
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.tid=3;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("row")));
  key.write(dos);
  value.write(dos);
  dos.close();
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_NAME.getKey(),"source");
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  ars.setConf(conf);
  Status status=Status.newBuilder().setBegin(0).setEnd(0).setInfiniteEnd(true).setClosed(true).build();
  DataInputStream dis=new DataInputStream(new ByteArrayInputStream(baos.toByteArray()));
  WalReplication repl=ars.getWalEdits(new ReplicationTarget("peer","1","1"),dis,new Path("/accumulo/wals/tserver+port/wal"),status,Long.MAX_VALUE,new HashSet<Integer>());
  Assert.assertEquals(Long.MAX_VALUE,repl.entriesConsumed);
  Assert.assertEquals(2,repl.walEdits.getEditsSize());
  Assert.assertEquals(2,repl.sizeInRecords);
  Assert.assertNotEquals(0,repl.sizeInBytes);
}

</code></pre>

<pre class="type-9 type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void onlyChooseMutationsForDesiredTableWithOpenStatus() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream dos=new DataOutputStream(baos);
  LogFileKey key=new LogFileKey();
  LogFileValue value=new LogFileValue();
  key.seq=1l;
  key.event=LogEvents.DEFINE_TABLET;
  key.tablet=new KeyExtent(new Text("1"),null,null);
  key.tid=1;
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("row")));
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.DEFINE_TABLET;
  key.tablet=new KeyExtent(new Text("2"),null,null);
  key.tid=2;
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.OPEN;
  key.tid=LogFileKey.VERSION;
  key.tserverSession="foobar";
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("badrow")));
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.COMPACTION_START;
  key.tid=2;
  key.filename="/accumulo/tables/1/t-000001/A000001.rf";
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.DEFINE_TABLET;
  key.tablet=new KeyExtent(new Text("1"),null,null);
  key.tid=3;
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.event=LogEvents.COMPACTION_FINISH;
  key.tid=6;
  value.mutations=Collections.emptyList();
  key.write(dos);
  value.write(dos);
  key.tablet=null;
  key.event=LogEvents.MUTATION;
  key.tid=3;
  key.filename="/accumulo/wals/tserver+port/" + UUID.randomUUID();
  value.mutations=Arrays.<Mutation>asList(new ServerMutation(new Text("row")));
  key.write(dos);
  value.write(dos);
  dos.close();
  Map<String,String> confMap=new HashMap<>();
  confMap.put(Property.REPLICATION_NAME.getKey(),"source");
  AccumuloConfiguration conf=new ConfigurationCopy(confMap);
  AccumuloReplicaSystem ars=new AccumuloReplicaSystem();
  ars.setConf(conf);
  Status status=Status.newBuilder().setBegin(0).setEnd(0).setInfiniteEnd(true).setClosed(false).build();
  DataInputStream dis=new DataInputStream(new ByteArrayInputStream(baos.toByteArray()));
  WalReplication repl=ars.getWalEdits(new ReplicationTarget("peer","1","1"),dis,new Path("/accumulo/wals/tserver+port/wal"),status,Long.MAX_VALUE,new HashSet<Integer>());
  Assert.assertEquals(9,repl.entriesConsumed);
  Assert.assertEquals(2,repl.walEdits.getEditsSize());
  Assert.assertEquals(2,repl.sizeInRecords);
  Assert.assertNotEquals(0,repl.sizeInBytes);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
