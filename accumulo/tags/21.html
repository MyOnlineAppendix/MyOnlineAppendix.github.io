<h3><span class=" glyphicon glyphicon-tag"/>&nbspAssumptionSetter</h3><kbd>Sets implicit assumptions </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.accumulo.harness.AccumuloClusterHarness </h4><pre class="type-4 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void setupCluster() throws Exception {
  Assume.assumeTrue(canRunTest(type));
switch (type) {
case MINI:
    MiniClusterHarness miniClusterHarness=new MiniClusterHarness();
  MiniAccumuloClusterImpl impl=miniClusterHarness.create(this,getAdminToken(),krb);
cluster=impl;
((AccumuloMiniClusterConfiguration)clusterConf).setClientConf(impl.getClientConfig());
if (null != krb) {
ClusterUser rootUser=krb.getRootUser();
UserGroupInformation.loginUserFromKeytab(rootUser.getPrincipal(),rootUser.getKeytab().getAbsolutePath());
}
break;
case STANDALONE:
StandaloneAccumuloClusterConfiguration conf=(StandaloneAccumuloClusterConfiguration)clusterConf;
ClientConfiguration clientConf=conf.getClientConf();
StandaloneAccumuloCluster standaloneCluster=new StandaloneAccumuloCluster(conf.getInstance(),clientConf,conf.getTmpDirectory(),conf.getUsers(),conf.getAccumuloServerUser());
standaloneCluster.setAccumuloHome(conf.getAccumuloHome());
standaloneCluster.setClientAccumuloConfDir(conf.getClientAccumuloConfDir());
standaloneCluster.setServerAccumuloConfDir(conf.getServerAccumuloConfDir());
standaloneCluster.setHadoopConfDir(conf.getHadoopConfDir());
Configuration hadoopConfiguration=standaloneCluster.getHadoopConfiguration();
if (clientConf.getBoolean(ClientProperty.INSTANCE_RPC_SASL_ENABLED.getKey(),false)) {
UserGroupInformation.setConfiguration(hadoopConfiguration);
UserGroupInformation.loginUserFromKeytab(conf.getAdminPrincipal(),conf.getAdminKeytab().getAbsolutePath());
}
cluster=standaloneCluster;
break;
default :
throw new RuntimeException("Unhandled type");
}
if (type.isDynamic()) {
cluster.start();
}
 else {
log.info("Removing tables which appear to be from a previous test run");
cleanupTables();
log.info("Removing users which appear to be from a previous test run");
cleanupUsers();
}
switch (type) {
case MINI:
if (null != krb) {
final String traceTable=Property.TRACE_TABLE.getDefaultValue();
final ClusterUser systemUser=krb.getAccumuloServerUser(), rootUser=krb.getRootUser();
UserGroupInformation.loginUserFromKeytab(systemUser.getPrincipal(),systemUser.getKeytab().getAbsolutePath());
Connector conn=cluster.getConnector(systemUser.getPrincipal(),new KerberosToken(systemUser.getPrincipal(),systemUser.getKeytab(),true));
UserGroupInformation.loginUserFromKeytab(rootUser.getPrincipal(),rootUser.getKeytab().getAbsolutePath());
conn=getConnector();
conn.tableOperations().create(traceTable);
conn.securityOperations().grantTablePermission(systemUser.getPrincipal(),traceTable,TablePermission.READ);
conn.securityOperations().grantTablePermission(systemUser.getPrincipal(),traceTable,TablePermission.WRITE);
conn.securityOperations().grantTablePermission(systemUser.getPrincipal(),traceTable,TablePermission.ALTER_TABLE);
}
break;
default :
}
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.shell.commands.HistoryCommandTest </h4><pre class="type-5 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEventExpansion() throws IOException {
  Assume.assumeTrue(reader.getTerminal().isSupported());
  reader.readLine();
  assertTrue(baos.toString().trim().endsWith("foo"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.ConditionalWriterIT </h4><pre class="type-9 type-13 type-11 type-5 type-3 type-21 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrace() throws Exception {
  Assume.assumeTrue(getClusterType() == ClusterType.MINI);
  Process tracer=null;
  Connector conn=getConnector();
  AccumuloCluster cluster=getCluster();
  MiniAccumuloClusterImpl mac=(MiniAccumuloClusterImpl)cluster;
  if (!conn.tableOperations().exists("trace")) {
    tracer=mac.exec(TraceServer.class);
    while (!conn.tableOperations().exists("trace")) {
      sleepUninterruptibly(1,TimeUnit.SECONDS);
    }
  }
  String tableName=getUniqueNames(1)[0];
  conn.tableOperations().create(tableName);
  DistributedTrace.enable("localhost","testTrace",mac.getClientConfig());
  sleepUninterruptibly(1,TimeUnit.SECONDS);
  Span root=Trace.on("traceTest");
  ConditionalWriter cw=conn.createConditionalWriter(tableName,new ConditionalWriterConfig());
  ConditionalMutation cm0=new ConditionalMutation("99006",new Condition("tx","seq"));
  cm0.put("name","last","doe");
  cm0.put("name","first","john");
  cm0.put("tx","seq","1");
  Assert.assertEquals(Status.ACCEPTED,cw.write(cm0).getStatus());
  root.stop();
  final Scanner scanner=conn.createScanner("trace",Authorizations.EMPTY);
  scanner.setRange(new Range(new Text(Long.toHexString(root.traceId()))));
  loop:   while (true) {
    final StringBuilder finalBuffer=new StringBuilder();
    int traceCount=TraceDump.printTrace(scanner,new Printer(){
      @Override public void print(      final String line){
        try {
          finalBuffer.append(line).append("\n");
        }
 catch (        Exception ex) {
          throw new RuntimeException(ex);
        }
      }
    }
);
    String traceOutput=finalBuffer.toString();
    log.info("Trace output:" + traceOutput);
    if (traceCount > 0) {
      int lastPos=0;
      for (      String part : "traceTest, startScan,startConditionalUpdate,conditionalUpdate,Check conditions,apply conditional mutations".split(",")) {
        log.info("Looking in trace output for '" + part + "'");
        int pos=traceOutput.indexOf(part);
        if (-1 == pos) {
          log.info("Trace output doesn't contain '" + part + "'");
          Thread.sleep(1000);
          break loop;
        }
        assertTrue("Did not find '" + part + "' in output",pos > 0);
        assertTrue("'" + part + "' occurred earlier than the previous element unexpectedly",pos > lastPos);
        lastPos=pos;
      }
      break;
    }
 else {
      log.info("Ignoring trace output as traceCount not greater than zero: " + traceCount);
      Thread.sleep(1000);
    }
  }
  if (tracer != null) {
    tracer.destroy();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.NamespacesIT </h4><pre class="type-4 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void setupConnectorAndNamespace() throws Exception {
  Assume.assumeTrue(ClusterType.MINI == getClusterType());
  c=getConnector();
  namespace="ns_" + getUniqueNames(1)[0];
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.ShellServerIT </h4><pre class="type-9 type-5 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void badLogin() throws Exception {
  Assume.assumeTrue(getToken() instanceof PasswordToken);
  ts.input.set(getRootPassword() + "\n");
  String err=ts.exec("user NoSuchUser",false);
  assertTrue(err.contains("BAD_CREDENTIALS for user NoSuchUser"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.UserCompactionStrategyIT </h4><pre class="type-5 type-3 type-21 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPerTableClasspath() throws Exception {
  Assume.assumeTrue(ClusterType.MINI == getClusterType());
  final Connector c=getConnector();
  final String tableName=getUniqueNames(1)[0];
  File target=new File(System.getProperty("user.dir"),"target");
  Assert.assertTrue(target.mkdirs() || target.isDirectory());
  File destFile=installJar(target,"/TestCompactionStrat.jar");
  c.tableOperations().create(tableName);
  c.instanceOperations().setProperty(Property.VFS_CONTEXT_CLASSPATH_PROPERTY.getKey() + "context1",destFile.toString());
  c.tableOperations().setProperty(tableName,Property.TABLE_CLASSPATH.getKey(),"context1");
  c.tableOperations().addSplits(tableName,new TreeSet<Text>(Arrays.asList(new Text("efg"))));
  writeFlush(c,tableName,"a");
  writeFlush(c,tableName,"b");
  writeFlush(c,tableName,"h");
  writeFlush(c,tableName,"i");
  Assert.assertEquals(4,FunctionalTestUtils.countRFiles(c,tableName));
  CompactionStrategyConfig csConfig=new CompactionStrategyConfig("org.apache.accumulo.test.EfgCompactionStrat");
  c.tableOperations().compact(tableName,new CompactionConfig().setWait(true).setCompactionStrategy(csConfig));
  Assert.assertEquals(3,FunctionalTestUtils.countRFiles(c,tableName));
  c.tableOperations().compact(tableName,new CompactionConfig().setWait(true));
  Assert.assertEquals(2,FunctionalTestUtils.countRFiles(c,tableName));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.BalanceInPresenceOfOfflineTableIT </h4><pre class="type-4 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void setupTables() throws AccumuloException, AccumuloSecurityException, TableExistsException, TableNotFoundException {
  Connector conn=getConnector();
  Assume.assumeTrue("Not enough tservers to run test",conn.instanceOperations().getTabletServers().size() >= 2);
  final SortedSet<Text> splits=new TreeSet<Text>();
  for (int i=0; i < NUM_SPLITS; i++) {
    splits.add(new Text(String.format("%08x",i * 1000)));
  }
  String[] names=getUniqueNames(2);
  UNUSED_TABLE=names[0];
  TEST_TABLE=names[1];
  connector=getConnector();
  connector.tableOperations().create(UNUSED_TABLE);
  connector.tableOperations().addSplits(UNUSED_TABLE,splits);
  connector.tableOperations().offline(UNUSED_TABLE);
  connector.tableOperations().create(TEST_TABLE);
  connector.tableOperations().setProperty(TEST_TABLE,Property.TABLE_SPLIT_THRESHOLD.getKey(),"10K");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.ClassLoaderIT </h4><pre class="type-4 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void checkCluster(){
  Assume.assumeThat(getClusterType(),CoreMatchers.is(ClusterType.MINI));
  MiniAccumuloClusterImpl mac=(MiniAccumuloClusterImpl)getCluster();
  rootPath=mac.getConfig().getDir().getAbsolutePath();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.CloneTestIT </h4><pre class="type-9 type-11 type-5 type-3 type-21 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteClone() throws Exception {
  String[] tableNames=getUniqueNames(3);
  String table1=tableNames[0];
  String table2=tableNames[1];
  String table3=tableNames[2];
  Connector c=getConnector();
  AccumuloCluster cluster=getCluster();
  Assume.assumeTrue(cluster instanceof MiniAccumuloClusterImpl);
  MiniAccumuloClusterImpl mac=(MiniAccumuloClusterImpl)cluster;
  String rootPath=mac.getConfig().getDir().getAbsolutePath();
  c.tableOperations().create(table3);
  writeData(table3,c).close();
  c.tableOperations().flush(table3,null,null,true);
  FileSystem fs=getCluster().getFileSystem();
  String id=c.tableOperations().tableIdMap().get(table3);
  FileStatus[] status=fs.listStatus(new Path(rootPath + "/accumulo/tables/" + id));
  assertTrue(status.length > 0);
  List<DiskUsage> diskUsage=c.tableOperations().getDiskUsage(Collections.singleton(table3));
  assertEquals(1,diskUsage.size());
  assertTrue(diskUsage.get(0).getUsage() > 100);
  c.tableOperations().delete(table3);
  Path tablePath=new Path(rootPath + "/accumulo/tables/" + id);
  if (fs.exists(tablePath)) {
    status=fs.listStatus(tablePath);
    assertTrue(status == null || status.length == 0);
  }
  c.tableOperations().create(table1);
  BatchWriter bw=writeData(table1,c);
  Map<String,String> props=new HashMap<String,String>();
  props.put(Property.TABLE_FILE_COMPRESSED_BLOCK_SIZE.getKey(),"500K");
  Set<String> exclude=new HashSet<String>();
  exclude.add(Property.TABLE_FILE_MAX.getKey());
  c.tableOperations().clone(table1,table2,true,props,exclude);
  Mutation m3=new Mutation("009");
  m3.put("data","x","1");
  m3.put("data","y","2");
  bw.addMutation(m3);
  bw.close();
  c.tableOperations().delete(table1);
  checkData(table2,c);
  c.tableOperations().compact(table2,null,null,true,true);
  checkData(table2,c);
  c.tableOperations().delete(table2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.ExamplesIT </h4><pre class="type-9 type-5 type-21 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDirList() throws Exception {
  String[] names=getUniqueNames(3);
  String dirTable=names[0], indexTable=names[1], dataTable=names[2];
  String[] args;
  String dirListDirectory;
switch (getClusterType()) {
case MINI:
    dirListDirectory=((MiniAccumuloClusterImpl)getCluster()).getConfig().getDir().getAbsolutePath();
  break;
case STANDALONE:
dirListDirectory=((StandaloneAccumuloCluster)getCluster()).getAccumuloHome();
break;
default :
throw new RuntimeException("Unknown cluster type");
}
assumeTrue(new File(dirListDirectory).exists());
if (saslEnabled) {
args=new String[]{"-i",instance,"-z",keepers,"-u",user,"--keytab",keytab,"--dirTable",dirTable,"--indexTable",indexTable,"--dataTable",dataTable,"--vis",visibility,"--chunkSize",Integer.toString(10000),dirListDirectory};
}
 else {
args=new String[]{"-i",instance,"-z",keepers,"-u",user,"-p",passwd,"--dirTable",dirTable,"--indexTable",indexTable,"--dataTable",dataTable,"--vis",visibility,"--chunkSize",Integer.toString(10000),dirListDirectory};
}
Entry<Integer,String> entry=getClusterControl().execWithStdout(Ingest.class,args);
assertEquals("Got non-zero return code. Stdout=" + entry.getValue(),0,entry.getKey().intValue());
String expectedFile;
switch (getClusterType()) {
case MINI:
expectedFile="accumulo-site.xml";
break;
case STANDALONE:
expectedFile="LICENSE";
break;
default :
throw new RuntimeException("Unknown cluster type");
}
if (saslEnabled) {
args=new String[]{"-i",instance,"-z",keepers,"--keytab",keytab,"-u",user,"-t",indexTable,"--auths",auths,"--search","--path",expectedFile};
}
 else {
args=new String[]{"-i",instance,"-z",keepers,"-p",passwd,"-u",user,"-t",indexTable,"--auths",auths,"--search","--path",expectedFile};
}
entry=getClusterControl().execWithStdout(QueryUtil.class,args);
if (ClusterType.MINI == getClusterType()) {
MiniAccumuloClusterImpl impl=(MiniAccumuloClusterImpl)cluster;
for (LogWriter writer : impl.getLogWriters()) {
writer.flush();
}
}
log.info("result " + entry.getValue());
assertEquals(0,entry.getKey().intValue());
assertTrue(entry.getValue().contains(expectedFile));
}

</code></pre>

<br>
<pre class="type-21 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Sets implicit assumptions 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBulkIngest() throws Exception {
  assumeTrue(getAdminToken() instanceof PasswordToken);
  String tableName=getUniqueNames(1)[0];
  FileSystem fs=getFileSystem();
  Path p=new Path(dir,"tmp");
  if (fs.exists(p)) {
    fs.delete(p,true);
  }
  goodExec(GenerateTestData.class,"--start-row","0","--count","10000","--output",dir + "/tmp/input/data");
  List<String> commonArgs=new ArrayList<>(Arrays.asList(new String[]{"-i",instance,"-z",keepers,"-u",user,"--table",tableName}));
  if (saslEnabled) {
    commonArgs.add("--keytab");
    commonArgs.add(keytab);
  }
 else {
    commonArgs.add("-p");
    commonArgs.add(passwd);
  }
  List<String> args=new ArrayList<>(commonArgs);
  goodExec(SetupTable.class,args.toArray(new String[0]));
  args=new ArrayList<>(commonArgs);
  args.addAll(Arrays.asList(new String[]{"--inputDir",dir + "/tmp/input","--workDir",dir + "/tmp"}));
  goodExec(BulkIngestExample.class,args.toArray(new String[0]));
  args=new ArrayList<>(commonArgs);
  args.addAll(Arrays.asList(new String[]{"--start-row","0","--count","10000"}));
  goodExec(VerifyIngest.class,args.toArray(new String[0]));
}

</code></pre>

<br>
<pre class="type-5 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShardedIndex() throws Exception {
  File src=new File(System.getProperty("user.dir") + "/src");
  assumeTrue(src.exists());
  String[] names=getUniqueNames(3);
  final String shard=names[0], index=names[1];
  c.tableOperations().create(shard);
  c.tableOperations().create(index);
  bw=c.createBatchWriter(shard,bwc);
  Index.index(30,src,"\\W+",bw);
  bw.close();
  BatchScanner bs=c.createBatchScanner(shard,Authorizations.EMPTY,4);
  List<String> found=Query.query(bs,Arrays.asList("foo","bar"),null);
  bs.close();
  boolean thisFile=false;
  for (  String file : found) {
    if (file.endsWith("/ExamplesIT.java"))     thisFile=true;
  }
  assertTrue(thisFile);
  String[] args;
  if (saslEnabled) {
    args=new String[]{"-i",instance,"-z",keepers,"--shardTable",shard,"--doc2Term",index,"-u",user,"--keytab",keytab};
  }
 else {
    args=new String[]{"-i",instance,"-z",keepers,"--shardTable",shard,"--doc2Term",index,"-u",getAdminPrincipal(),"-p",passwd};
  }
  goodExec(Reverse.class,args);
  if (saslEnabled) {
    args=new String[]{"-i",instance,"-z",keepers,"--shardTable",shard,"--doc2Term",index,"-u",user,"--keytab",keytab,"--terms","5","--count","1000"};
  }
 else {
    args=new String[]{"-i",instance,"-z",keepers,"--shardTable",shard,"--doc2Term",index,"-u",user,"-p",passwd,"--terms","5","--count","1000"};
  }
  goodExec(ContinuousQuery.class,args);
}

</code></pre>

<br>
<pre class="type-21 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Sets implicit assumptions 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTeraSortAndRead() throws Exception {
  assumeTrue(getAdminToken() instanceof PasswordToken);
  String tableName=getUniqueNames(1)[0];
  String[] args;
  if (saslEnabled) {
    args=new String[]{"--count",(1000 * 1000) + "","-nk","10","-xk","10","-nv","10","-xv","10","-t",tableName,"-i",instance,"-z",keepers,"-u",user,"--keytab",keytab,"--splits","4"};
  }
 else {
    args=new String[]{"--count",(1000 * 1000) + "","-nk","10","-xk","10","-nv","10","-xv","10","-t",tableName,"-i",instance,"-z",keepers,"-u",user,"-p",passwd,"--splits","4"};
  }
  goodExec(TeraSortIngest.class,args);
  Path output=new Path(dir,"tmp/nines");
  if (fs.exists(output)) {
    fs.delete(output,true);
  }
  if (saslEnabled) {
    args=new String[]{"-i",instance,"-z",keepers,"-u",user,"--keytab",keytab,"-t",tableName,"--rowRegex",".*999.*","--output",output.toString()};
  }
 else {
    args=new String[]{"-i",instance,"-z",keepers,"-u",user,"-p",passwd,"-t",tableName,"--rowRegex",".*999.*","--output",output.toString()};
  }
  goodExec(RegexExample.class,args);
  if (saslEnabled) {
    args=new String[]{"-i",instance,"-z",keepers,"-u",user,"--keytab",keytab,"-t",tableName,"--column","c:"};
  }
 else {
    args=new String[]{"-i",instance,"-z",keepers,"-u",user,"-p",passwd,"-t",tableName,"--column","c:"};
  }
  goodExec(RowHash.class,args);
  output=new Path(dir,"tmp/tableFile");
  if (fs.exists(output)) {
    fs.delete(output,true);
  }
  if (saslEnabled) {
    args=new String[]{"-i",instance,"-z",keepers,"-u",user,"--keytab",keytab,"-t",tableName,"--output",output.toString()};
  }
 else {
    args=new String[]{"-i",instance,"-z",keepers,"-u",user,"-p",passwd,"-t",tableName,"--output",output.toString()};
  }
  goodExec(TableToFile.class,args);
}

</code></pre>

<br>
<pre class="type-21 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Sets implicit assumptions 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testWordCount() throws Exception {
  assumeTrue(getAdminToken() instanceof PasswordToken);
  String tableName=getUniqueNames(1)[0];
  c.tableOperations().create(tableName);
  is=new IteratorSetting(10,SummingCombiner.class);
  SummingCombiner.setColumns(is,Collections.singletonList(new IteratorSetting.Column(new Text("count"))));
  SummingCombiner.setEncodingType(is,SummingCombiner.Type.STRING);
  c.tableOperations().attachIterator(tableName,is);
  Path readme=new Path(new Path(System.getProperty("user.dir")).getParent(),"README.md");
  if (!new File(readme.toString()).exists()) {
    log.info("Not running test: README.md does not exist)");
    return;
  }
  fs.copyFromLocalFile(readme,new Path(dir + "/tmp/wc/README.md"));
  String[] args;
  if (saslEnabled) {
    args=new String[]{"-i",instance,"-u",user,"--keytab",keytab,"-z",keepers,"--input",dir + "/tmp/wc","-t",tableName};
  }
 else {
    args=new String[]{"-i",instance,"-u",user,"-p",passwd,"-z",keepers,"--input",dir + "/tmp/wc","-t",tableName};
  }
  goodExec(WordCount.class,args);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.PermissionsIT </h4><pre class="type-4 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void limitToMini() throws Exception {
  Assume.assumeTrue(ClusterType.MINI == getClusterType());
  Connector c=getConnector();
  Set<String> users=c.securityOperations().listLocalUsers();
  ClusterUser user=getUser(0);
  if (users.contains(user.getPrincipal())) {
    c.securityOperations().dropLocalUser(user.getPrincipal());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.ScannerContextIT </h4><pre class="type-4 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void checkCluster() throws Exception {
  Assume.assumeThat(getClusterType(),CoreMatchers.is(ClusterType.MINI));
  MiniAccumuloClusterImpl.class.cast(getCluster());
  fs=FileSystem.get(CachedConfiguration.getInstance());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.SplitIT </h4><pre class="type-4 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void alterConfig() throws Exception {
  Assume.assumeTrue(ClusterType.MINI == getClusterType());
  InstanceOperations iops=getConnector().instanceOperations();
  Map<String,String> config=iops.getSystemConfiguration();
  tservMaxMem=config.get(Property.TSERV_MAXMEM.getKey());
  tservMajcDelay=config.get(Property.TSERV_MAJC_DELAY.getKey());
  if (!tservMajcDelay.equals("100ms")) {
    iops.setProperty(Property.TSERV_MAJC_DELAY.getKey(),"100ms");
  }
  boolean restarted=false;
  if (!tservMaxMem.equals("5K")) {
    iops.setProperty(Property.TSERV_MAXMEM.getKey(),"5K");
    getCluster().getClusterControl().stopAllServers(ServerType.TABLET_SERVER);
    getCluster().getClusterControl().startAllServers(ServerType.TABLET_SERVER);
    restarted=true;
  }
  if (!restarted) {
    long millis=AccumuloConfiguration.getTimeInMillis(tservMajcDelay);
    log.info("Waiting for majc delay period: {}ms",millis);
    Thread.sleep(millis);
    log.info("Finished waiting for majc delay period");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.functional.TableIT </h4><pre class="type-9 type-5 type-3 type-21 type-7 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  Assume.assumeThat(getClusterType(),CoreMatchers.is(ClusterType.MINI));
  AccumuloCluster cluster=getCluster();
  MiniAccumuloClusterImpl mac=(MiniAccumuloClusterImpl)cluster;
  String rootPath=mac.getConfig().getDir().getAbsolutePath();
  Connector c=getConnector();
  TableOperations to=c.tableOperations();
  String tableName=getUniqueNames(1)[0];
  to.create(tableName);
  TestIngest.Opts opts=new TestIngest.Opts();
  VerifyIngest.Opts vopts=new VerifyIngest.Opts();
  ClientConfiguration clientConfig=getCluster().getClientConfig();
  if (clientConfig.getBoolean(ClientProperty.INSTANCE_RPC_SASL_ENABLED.getKey(),false)) {
    opts.updateKerberosCredentials(clientConfig);
    vopts.updateKerberosCredentials(clientConfig);
  }
 else {
    opts.setPrincipal(getAdminPrincipal());
    vopts.setPrincipal(getAdminPrincipal());
  }
  opts.setTableName(tableName);
  TestIngest.ingest(c,opts,new BatchWriterOpts());
  to.flush(tableName,null,null,true);
  vopts.setTableName(tableName);
  VerifyIngest.verifyIngest(c,vopts,new ScannerOpts());
  String id=to.tableIdMap().get(tableName);
  Scanner s=c.createScanner(MetadataTable.NAME,Authorizations.EMPTY);
  s.setRange(new KeyExtent(new Text(id),null,null).toMetadataRange());
  s.fetchColumnFamily(MetadataSchema.TabletsSection.DataFileColumnFamily.NAME);
  assertTrue(Iterators.size(s.iterator()) > 0);
  FileSystem fs=getCluster().getFileSystem();
  assertTrue(fs.listStatus(new Path(rootPath + "/accumulo/tables/" + id)).length > 0);
  to.delete(tableName);
  assertEquals(0,Iterators.size(s.iterator()));
  try {
    assertEquals(0,fs.listStatus(new Path(rootPath + "/accumulo/tables/" + id)).length);
  }
 catch (  FileNotFoundException ex) {
  }
  assertNull(to.tableIdMap().get(tableName));
  to.create(tableName);
  TestIngest.ingest(c,opts,new BatchWriterOpts());
  VerifyIngest.verifyIngest(c,vopts,new ScannerOpts());
  to.delete(tableName);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.accumulo.test.start.KeywordStartIT </h4><pre class="type-9 type-13 type-5 type-21 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpectedClasses() throws IOException {
  assumeTrue(new File(System.getProperty("user.dir") + "/src").exists());
  TreeMap<String,Class<? extends KeywordExecutable>> expectSet=new TreeMap<>();
  expectSet.put("admin",Admin.class);
  expectSet.put("classpath",Classpath.class);
  expectSet.put("create-token",CreateToken.class);
  expectSet.put("gc",GCExecutable.class);
  expectSet.put("help",Help.class);
  expectSet.put("info",Info.class);
  expectSet.put("init",Initialize.class);
  expectSet.put("jar",Jar.class);
  expectSet.put("login-info",LoginProperties.class);
  expectSet.put("master",MasterExecutable.class);
  expectSet.put("minicluster",MiniClusterExecutable.class);
  expectSet.put("monitor",MonitorExecutable.class);
  expectSet.put("proxy",Proxy.class);
  expectSet.put("rfile-info",PrintInfo.class);
  expectSet.put("shell",Shell.class);
  expectSet.put("tracer",TracerExecutable.class);
  expectSet.put("tserver",TServerExecutable.class);
  expectSet.put("version",Version.class);
  expectSet.put("zookeeper",ZooKeeperMain.class);
  Iterator<Entry<String,Class<? extends KeywordExecutable>>> expectIter=expectSet.entrySet().iterator();
  TreeMap<String,KeywordExecutable> actualSet=new TreeMap<>(Main.getExecutables(getClass().getClassLoader()));
  Iterator<Entry<String,KeywordExecutable>> actualIter=actualSet.entrySet().iterator();
  Entry<String,Class<? extends KeywordExecutable>> expected;
  Entry<String,KeywordExecutable> actual;
  while (expectIter.hasNext() && actualIter.hasNext()) {
    expected=expectIter.next();
    actual=actualIter.next();
    assertEquals(expected.getKey(),actual.getKey());
    assertEquals(expected.getValue(),actual.getValue().getClass());
  }
  boolean moreExpected=expectIter.hasNext();
  if (moreExpected) {
    while (expectIter.hasNext()) {
      log.warn("Missing class for keyword '" + expectIter.next() + "'");
    }
  }
  assertFalse("Missing expected classes",moreExpected);
  boolean moreActual=actualIter.hasNext();
  if (moreActual) {
    while (actualIter.hasNext()) {
      log.warn("Extra class found with keyword '" + actualIter.next() + "'");
    }
  }
  assertFalse("Found additional unexpected classes",moreActual);
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
