<h3 style="margin:0px">Class: org.apache.hc.client5.http.impl.cache.TestCachingExecChain (54 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(40)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(33)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(31)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(3)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNewerCacheableResponsesReplaceExistingCacheEntry() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final Date fiveSecondsAgo=new Date(now.getTime() - 5 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(fiveSecondsAgo));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Etag","\"old-etag\"");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  req2.setHeader("Cache-Control","max-age=0");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"new-etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Cache-Control","max-age=3600");
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  assertEquals("\"new-etag\"",result.getFirstHeader("ETag").getValue());
}

</code></pre>

<pre class="type-7 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testSetsViaHeaderOnResponseIfRequestServedFromCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(new Date()));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertNotNull(result.getFirstHeader("Via"));
}

</code></pre>

<pre class="type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testSuitableCacheEntryDoesNotCauseBackendRequest() throws Exception {
  cacheInvalidatorWasCalled();
  requestPolicyAllowsCaching(true);
  getCacheEntryReturns(mockCacheEntry);
  cacheEntrySuitable(true);
  responseIsGeneratedFromCache();
  requestIsFatallyNonCompliant(null);
  entryHasStaleness(0L);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertSame(mockCachedResponse,result);
}

</code></pre>

<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testNonCacheableResponseIsNotCachedAndIsReturnedAsIs() throws Exception {
  final CacheConfig configDefault=CacheConfig.DEFAULT;
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(new HeapResourceFactory(),mockStorage,configDefault),configDefault);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Cache-Control","no-cache");
  expect(mockStorage.getEntry(isA(String.class))).andReturn(null).anyTimes();
  mockStorage.removeEntry(isA(String.class));
  expectLastCall().anyTimes();
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  final HttpResponse result=impl.execute(route,req1,context,null);
  verifyMocks();
  assertTrue(HttpTestUtils.semanticallyTransparent(resp1,result));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsCacheHitContextIfRequestServedFromCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(new Date()));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(CacheResponseStatus.CACHE_HIT,context.getCacheResponseStatus());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testResponseIsGeneratedWhenCacheEntryIsUsable() throws Exception {
  requestIsFatallyNonCompliant(null);
  cacheInvalidatorWasCalled();
  requestPolicyAllowsCaching(true);
  cacheEntrySuitable(true);
  getCacheEntryReturns(mockCacheEntry);
  responseIsGeneratedFromCache();
  entryHasStaleness(0L);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSocketTimeoutExceptionIsNotSilentlyCatched() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(new InputStreamEntity(new InputStream(){
    private boolean closed=false;
    @Override public void close() throws IOException {
      closed=true;
    }
    @Override public int read() throws IOException {
      if (closed) {
        throw new SocketException("Socket closed");
      }
      throw new SocketTimeoutException("Read timed out");
    }
  }
,128));
  resp1.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  try {
    final HttpResponse result1=impl.execute(route,req1,context,null);
    EntityUtils.toString(result1.getEntity());
    Assert.fail("We should have had a SocketTimeoutException");
  }
 catch (  final SocketTimeoutException e) {
  }
  verifyMocks();
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns304ForIfModifiedSincePassesIfRequestServedFromOrigin() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(tenSecondsAgo));
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("ETag","\"etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  resp2.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_NOT_MODIFIED,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@SuppressWarnings("unchecked") @Before public void setUp(){
  mockRequestPolicy=createNiceMock(CacheableRequestPolicy.class);
  mockValidityPolicy=createNiceMock(CacheValidityPolicy.class);
  mockBackend=createNiceMock(ClientExecChain.class);
  mockCache=createNiceMock(HttpCache.class);
  mockSuitabilityChecker=createNiceMock(CachedResponseSuitabilityChecker.class);
  mockResponsePolicy=createNiceMock(ResponseCachingPolicy.class);
  mockHandler=createNiceMock(ResponseHandler.class);
  mockUriRequest=createNiceMock(HttpUriRequest.class);
  mockCacheEntry=createNiceMock(HttpCacheEntry.class);
  mockResponseGenerator=createNiceMock(CachedHttpResponseGenerator.class);
  mockCachedResponse=createNiceMock(CloseableHttpResponse.class);
  mockConditionalRequestBuilder=createNiceMock(ConditionalRequestBuilder.class);
  mockConditionalRequest=createNiceMock(HttpRequest.class);
  mockStatusLine=createNiceMock(StatusLine.class);
  mockResponseProtocolCompliance=createNiceMock(ResponseProtocolCompliance.class);
  mockRequestProtocolCompliance=createNiceMock(RequestProtocolCompliance.class);
  mockStorage=createNiceMock(HttpCacheStorage.class);
  config=CacheConfig.DEFAULT;
  asyncValidator=new AsynchronousValidator(config);
  host=new HttpHost("foo.example.com",80);
  route=new HttpRoute(host);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/stuff",HttpVersion.HTTP_1_1),host);
  context=HttpCacheContext.create();
  context.setTargetHost(host);
  entry=HttpTestUtils.makeCacheEntry();
  impl=createCachingExecChain(mockBackend,mockCache,mockValidityPolicy,mockResponsePolicy,mockResponseGenerator,mockRequestPolicy,mockSuitabilityChecker,mockConditionalRequestBuilder,mockResponseProtocolCompliance,mockRequestProtocolCompliance,config,asyncValidator);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSetsRequestSentInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  impl.execute(route,request,ctx,null);
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns304ForIfNoneMatchPassesIfRequestServedFromOrigin() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  req2.addHeader("If-None-Match","\"etag\"");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("ETag","\"etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_NOT_MODIFIED,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-7 type-4 type-1 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoEntityForIfNoneMatchRequestNotYetInCache() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req1.addHeader("If-None-Match","\"etag\"");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not modified");
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  final HttpResponse result=impl.execute(route,req1,context,null);
  verifyMocks();
  assertEquals(HttpStatus.SC_NOT_MODIFIED,result.getStatusLine().getStatusCode());
  assertNull("The 304 response messages MUST NOT contain a message-body",result.getEntity());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNotModifiedResponseWithVaryUpdatesCacheEntryWhenNoEntity() throws Exception {
  final Date now=new Date();
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req1.addHeader("If-None-Match","etag");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req2.addHeader("If-None-Match","etag");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not modified");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=0");
  resp1.setHeader("Etag","etag");
  resp1.setHeader("Vary","Accept-Encoding");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not modified");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Cache-Control","max-age=0");
  resp1.setHeader("Etag","etag");
  resp1.setHeader("Vary","Accept-Encoding");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  final HttpResponse result1=impl.execute(route,req1,context,null);
  final HttpResponse result2=impl.execute(route,req2,context,null);
  verifyMocks();
  assertEquals(HttpStatus.SC_NOT_MODIFIED,result1.getStatusLine().getStatusCode());
  assertEquals("etag",result1.getFirstHeader("Etag").getValue());
  assertEquals(HttpStatus.SC_NOT_MODIFIED,result2.getStatusLine().getStatusCode());
  assertEquals("etag",result2.getFirstHeader("Etag").getValue());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsModuleResponseContextIfValidationFailsButNotRequired() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndThrows(new IOException());
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(CacheResponseStatus.CACHE_HIT,context.getCacheResponseStatus());
}

</code></pre>

<pre class="type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testSetsTargetHostInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  impl.execute(route,request,ctx,null);
  assertSame(host,ctx.getTargetHost());
}

</code></pre>

<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRecordsClientProtocolInViaHeaderIfRequestNotServableFromCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_0),host);
  req.setHeader("Cache-Control","no-cache");
  final HttpResponse resp=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NO_CONTENT,"No Content");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  backendCaptureRequestAndReturn(cap,resp);
  replayMocks();
  impl.execute(route,req,context,null);
  verifyMocks();
  final HttpRequest captured=cap.getValue();
  final String via=captured.getFirstHeader("Via").getValue();
  final String proto=via.split("\\s+")[0];
  Assert.assertTrue("http/1.0".equalsIgnoreCase(proto) || "1.0".equalsIgnoreCase(proto));
}

</code></pre>

<pre class="type-16 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testSetsRequestInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  impl.execute(route,request,ctx,null);
  if (!HttpTestUtils.equivalent(request,ctx.getRequest())) {
    assertSame(request,ctx.getRequest());
  }
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns304ForIfModifiedSinceHeaderIfRequestServedFromCache() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(now));
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_NOT_MODIFIED,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCanCacheAResponseWithoutABody() throws Exception {
  final HttpResponse response=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NO_CONTENT,"No Content");
  response.setHeader("Date",DateUtils.formatDate(new Date()));
  response.setHeader("Cache-Control","max-age=300");
  final DummyBackend backend=new DummyBackend();
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  impl.execute(route,request,context,null);
  impl.execute(route,request,context,null);
  assertEquals(1,backend.getExecutions());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns200ForOptionsFollowedByGetIfAuthorizationHeaderAndSharedCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.custom().setSharedCache(true).build());
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpOptions("http://foo.example.com/"),host);
  req1.setHeader("Authorization","Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req2.setHeader("Authorization","Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NO_CONTENT,"No Content");
  resp1.setHeader("Content-Length","0");
  resp1.setHeader("ETag","\"options-etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(now));
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"get-etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(200,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsModuleGeneratedResponseContextForFatallyNoncompliantRequest() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req.setHeader("Range","bytes=0-50");
  req.setHeader("If-Range","W/\"weak-etag\"");
  impl.execute(route,req,context,null);
  Assert.assertEquals(CacheResponseStatus.CACHE_MODULE_RESPONSE,context.getCacheResponseStatus());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testIfOnlyIfCachedAndNoCacheEntryBackendNotCalled() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  request.addHeader("Cache-Control","only-if-cached");
  final HttpResponse resp=impl.execute(route,request,context,null);
  Assert.assertEquals(HttpStatus.SC_GATEWAY_TIMEOUT,resp.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testVariantsMissServerReturns304CacheReturns304() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req1.addHeader("Accept-Encoding","gzip");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("Etag","\"gzip_etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Vary","Accept-Encoding");
  resp1.setHeader("Cache-Control","public, max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req2.addHeader("Accept-Encoding","deflate");
  final HttpRequestWrapper req2Server=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req2Server.addHeader("Accept-Encoding","deflate");
  req2Server.addHeader("If-None-Match","\"gzip_etag\"");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp2.setEntity(HttpTestUtils.makeBody(128));
  resp2.setHeader("Content-Length","128");
  resp2.setHeader("Etag","\"deflate_etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Vary","Accept-Encoding");
  resp2.setHeader("Cache-Control","public, max-age=3600");
  final HttpRequestWrapper req4=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req4.addHeader("Accept-Encoding","gzip,identity");
  req4.addHeader("If-None-Match","\"gzip_etag\"");
  final HttpRequestWrapper req4Server=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req4Server.addHeader("Accept-Encoding","gzip,identity");
  req4Server.addHeader("If-None-Match","\"gzip_etag\"");
  final HttpResponse resp4=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp4.setHeader("Etag","\"gzip_etag\"");
  resp4.setHeader("Date",DateUtils.formatDate(now));
  resp4.setHeader("Vary","Accept-Encoding");
  resp4.setHeader("Cache-Control","public, max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  backendExpectsAnyRequestAndReturn(resp4);
  replayMocks();
  final HttpResponse result1=impl.execute(route,req1,context,null);
  final HttpResponse result2=impl.execute(route,req2,context,null);
  final HttpResponse result4=impl.execute(route,req4,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_OK,result1.getStatusLine().getStatusCode());
  Assert.assertEquals(HttpStatus.SC_OK,result2.getStatusLine().getStatusCode());
  Assert.assertEquals(HttpStatus.SC_NOT_MODIFIED,result4.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testIfOnlyIfCachedAndEntryExistsAndIsSuitableReturnsEntry() throws Exception {
  request.setHeader("Cache-Control","only-if-cached");
  requestIsFatallyNonCompliant(null);
  cacheInvalidatorWasCalled();
  requestPolicyAllowsCaching(true);
  getCacheEntryReturns(entry);
  cacheEntrySuitable(true);
  responseIsGeneratedFromCache();
  entryHasStaleness(0);
  replayMocks();
  final HttpResponse resp=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertSame(mockCachedResponse,resp);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsRouteInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  impl.execute(route,request,ctx,null);
  assertEquals(route,ctx.getHttpRoute());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOlderCacheableResponsesDoNotGoIntoCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final Date fiveSecondsAgo=new Date(now.getTime() - 5 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Etag","\"new-etag\"");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  req2.setHeader("Cache-Control","no-cache");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"old-etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(fiveSecondsAgo));
  resp2.setHeader("Cache-Control","max-age=3600");
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  assertEquals("\"new-etag\"",result.getFirstHeader("ETag").getValue());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsCacheMissContextIfRequestNotServableFromCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req.setHeader("Cache-Control","no-cache");
  final HttpResponse resp=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NO_CONTENT,"No Content");
  backendExpectsAnyRequestAndReturn(resp);
  replayMocks();
  impl.execute(route,req,context,null);
  verifyMocks();
  Assert.assertEquals(CacheResponseStatus.CACHE_MISS,context.getCacheResponseStatus());
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testIsSharedCache(){
  Assert.assertTrue(config.isSharedCache());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns200ForIfNoneMatchHeaderFailsIfModifiedSinceIgnored() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req2.addHeader("If-None-Match","\"abc\"");
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(now));
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(200,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsModuleResponseContextIfValidationRequiredButFailed() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5, must-revalidate");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndThrows(new IOException());
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(CacheResponseStatus.CACHE_MODULE_RESPONSE,context.getCacheResponseStatus());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns200ForIfNoneMatchHeaderFails() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(new Date()));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  req2.addHeader("If-None-Match","\"abc\"");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(200,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsValidatedContextIfRequestWasSuccessfullyValidated() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp2.setEntity(HttpTestUtils.makeBody(128));
  resp2.setHeader("Content-Length","128");
  resp2.setHeader("ETag","\"etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp2.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(CacheResponseStatus.VALIDATED,context.getCacheResponseStatus());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testIfOnlyIfCachedAndEntryNotSuitableBackendNotCalled() throws Exception {
  request.setHeader("Cache-Control","only-if-cached");
  entry=HttpTestUtils.makeCacheEntry(new Header[]{new BasicHeader("Cache-Control","must-revalidate")});
  requestIsFatallyNonCompliant(null);
  cacheInvalidatorWasCalled();
  requestPolicyAllowsCaching(true);
  getCacheEntryReturns(entry);
  cacheEntrySuitable(false);
  replayMocks();
  final HttpResponse resp=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_GATEWAY_TIMEOUT,resp.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsesVirtualHostForCacheKey() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  impl.execute(route,request,context,null);
  assertEquals(1,backend.getExecutions());
  context.setTargetHost(new HttpHost("bar.example.com"));
  impl.execute(route,request,context,null);
  assertEquals(2,backend.getExecutions());
  impl.execute(route,request,context,null);
  assertEquals(2,backend.getExecutions());
}

</code></pre>

<pre class="type-7 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testSetViaHeaderIfValidationFailsButNotRequired() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndThrows(new IOException());
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertNotNull(result.getFirstHeader("Via"));
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns200ForIfModifiedSinceFailsIfRequestServedFromOrigin() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(tenSecondsAgo));
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp2.setEntity(HttpTestUtils.makeBody(128));
  resp2.setHeader("Content-Length","128");
  resp2.setHeader("ETag","\"newetag\"");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Last-Modified",DateUtils.formatDate(now));
  resp2.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_OK,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNotModifiedResponseUpdatesCacheEntryWhenNoEntity() throws Exception {
  final Date now=new Date();
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req1.addHeader("If-None-Match","etag");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req2.addHeader("If-None-Match","etag");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not modified");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=0");
  resp1.setHeader("Etag","etag");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not modified");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Cache-Control","max-age=0");
  resp1.setHeader("Etag","etag");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  final HttpResponse result1=impl.execute(route,req1,context,null);
  final HttpResponse result2=impl.execute(route,req2,context,null);
  verifyMocks();
  assertEquals(HttpStatus.SC_NOT_MODIFIED,result1.getStatusLine().getStatusCode());
  assertEquals("etag",result1.getFirstHeader("Etag").getValue());
  assertEquals(HttpStatus.SC_NOT_MODIFIED,result2.getStatusLine().getStatusCode());
  assertEquals("etag",result2.getFirstHeader("Etag").getValue());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns200ForIfModifiedSinceDateIsLess() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(new Date()));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(new Date()));
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(tenSecondsAgo));
  final HttpResponse resp2=HttpTestUtils.make200Response();
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_OK,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns200ForIfNoneMatchFailsIfRequestServedFromOrigin() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  req2.addHeader("If-None-Match","\"etag\"");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp2.setEntity(HttpTestUtils.makeBody(128));
  resp2.setHeader("Content-Length","128");
  resp2.setHeader("ETag","\"newetag\"");
  resp2.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp2.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_OK,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-7 type-16 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testSetsResponseInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  final HttpResponse result=impl.execute(route,request,ctx,null);
  if (!HttpTestUtils.equivalent(result,ctx.getResponse())) {
    assertSame(result,ctx.getResponse());
  }
}

</code></pre>

<pre class="type-7 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReturns304ForIfModifiedSinceHeaderIf304ResponseInCache() throws Exception {
  final Date now=new Date();
  final Date oneHourAgo=new Date(now.getTime() - 3600 * 1000L);
  final Date inTenMinutes=new Date(now.getTime() + 600 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req1.addHeader("If-Modified-Since",DateUtils.formatDate(oneHourAgo));
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(oneHourAgo));
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not modified");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-control","max-age=600");
  resp1.setHeader("Expires",DateUtils.formatDate(inTenMinutes));
  expect(mockBackend.execute(eq(route),isA(HttpRequestWrapper.class),isA(HttpClientContext.class),(HttpExecutionAware)isNull())).andReturn(Proxies.enhanceResponse(resp1)).once();
  expect(mockBackend.execute(eq(route),isA(HttpRequestWrapper.class),isA(HttpClientContext.class),(HttpExecutionAware)isNull())).andThrow(new AssertionFailedError("Should have reused cached 304 response")).anyTimes();
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_NOT_MODIFIED,result.getStatusLine().getStatusCode());
  Assert.assertFalse(result.containsHeader("Last-Modified"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetsModuleGeneratedResponseContextForCacheOptionsResponse() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("OPTIONS","*",HttpVersion.HTTP_1_1),host);
  req.setHeader("Max-Forwards","0");
  impl.execute(route,req,context,null);
  Assert.assertEquals(CacheResponseStatus.CACHE_MODULE_RESPONSE,context.getCacheResponseStatus());
}

</code></pre>

<pre class="type-7 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testSetsViaHeaderOnResponseForCacheMiss() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(new Date()));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  final HttpResponse result=impl.execute(route,req1,context,null);
  verifyMocks();
  Assert.assertNotNull(result.getFirstHeader("Via"));
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns304ForIfNoneMatchHeaderAndIfModifiedSinceIfRequestServedFromCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(new Date()));
  req2.addHeader("If-None-Match","*");
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_NOT_MODIFIED,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNonCompliantRequestWrapsAndReThrowsProtocolException() throws Exception {
  final ClientProtocolException expected=new ClientProtocolException("ouch");
  requestIsFatallyNonCompliant(null);
  mockRequestProtocolCompliance.makeRequestCompliant((HttpRequestWrapper)anyObject());
  expectLastCall().andThrow(expected);
  boolean gotException=false;
  replayMocks();
  try {
    impl.execute(route,request,context,null);
  }
 catch (  final ClientProtocolException ex) {
    Assert.assertSame(expected,ex);
    gotException=true;
  }
  verifyMocks();
  Assert.assertTrue(gotException);
}

</code></pre>

<pre class="type-7 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testSetsViaHeaderOnResponseIfRequestNotServableFromCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req.setHeader("Cache-Control","no-cache");
  final HttpResponse resp=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NO_CONTENT,"No Content");
  backendExpectsAnyRequestAndReturn(resp);
  replayMocks();
  final HttpResponse result=impl.execute(route,req,context,null);
  verifyMocks();
  Assert.assertNotNull(result.getFirstHeader("Via"));
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns200ForIfModifiedSinceDateIsInvalid() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAfter=new Date(now.getTime() + 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(new Date()));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(new Date()));
  req2.addHeader("If-Modified-Since",DateUtils.formatDate(tenSecondsAfter));
  backendExpectsAnyRequestAndReturn(resp1).times(2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_OK,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-7 type-4 type-1 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoesNotSend304ForNonConditionalRequest() throws Exception {
  final Date now=new Date();
  final Date inOneMinute=new Date(System.currentTimeMillis() + 60000);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req1.addHeader("If-None-Match","etag");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not modified");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","public, max-age=60");
  resp1.setHeader("Expires",DateUtils.formatDate(inOneMinute));
  resp1.setHeader("Etag","etag");
  resp1.setHeader("Vary","Accept-Encoding");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"Ok");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Cache-Control","public, max-age=60");
  resp2.setHeader("Expires",DateUtils.formatDate(inOneMinute));
  resp2.setHeader("Etag","etag");
  resp2.setHeader("Vary","Accept-Encoding");
  resp2.setEntity(HttpTestUtils.makeBody(128));
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2).anyTimes();
  replayMocks();
  final HttpResponse result1=impl.execute(route,req1,context,null);
  final HttpResponse result2=impl.execute(route,req2,context,null);
  verifyMocks();
  assertEquals(HttpStatus.SC_NOT_MODIFIED,result1.getStatusLine().getStatusCode());
  assertNull(result1.getEntity());
  assertEquals(HttpStatus.SC_OK,result2.getStatusLine().getStatusCode());
  Assert.assertNotNull(result2.getEntity());
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testVariantMissServerIfReturns304CacheReturns200() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req1.addHeader("Accept-Encoding","gzip");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("Etag","\"gzip_etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Vary","Accept-Encoding");
  resp1.setHeader("Cache-Control","public, max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req2.addHeader("Accept-Encoding","deflate");
  final HttpRequestWrapper req2Server=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req2Server.addHeader("Accept-Encoding","deflate");
  req2Server.addHeader("If-None-Match","\"gzip_etag\"");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp2.setEntity(HttpTestUtils.makeBody(128));
  resp2.setHeader("Content-Length","128");
  resp2.setHeader("Etag","\"deflate_etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Vary","Accept-Encoding");
  resp2.setHeader("Cache-Control","public, max-age=3600");
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req3.addHeader("Accept-Encoding","gzip,deflate");
  final HttpRequestWrapper req3Server=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com"),host);
  req3Server.addHeader("Accept-Encoding","gzip,deflate");
  req3Server.addHeader("If-None-Match","\"gzip_etag\",\"deflate_etag\"");
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Content-Length","128");
  resp3.setHeader("Etag","\"gzip_etag\"");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  resp3.setHeader("Vary","Accept-Encoding");
  resp3.setHeader("Cache-Control","public, max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  final HttpResponse result1=impl.execute(route,req1,context,null);
  final HttpResponse result2=impl.execute(route,req2,context,null);
  final HttpResponse result3=impl.execute(route,req3,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_OK,result1.getStatusLine().getStatusCode());
  Assert.assertEquals(HttpStatus.SC_OK,result2.getStatusLine().getStatusCode());
  Assert.assertEquals(HttpStatus.SC_OK,result3.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-7 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testTreatsCacheIOExceptionsAsCacheMiss() throws Exception {
  impl=createCachingExecChain(mockBackend,mockCache,CacheConfig.DEFAULT);
  final CloseableHttpResponse resp=Proxies.enhanceResponse(HttpTestUtils.make200Response());
  mockCache.flushInvalidatedCacheEntriesFor(host,request);
  expectLastCall().andThrow(new IOException()).anyTimes();
  mockCache.flushInvalidatedCacheEntriesFor(isA(HttpHost.class),isA(HttpRequest.class),isA(HttpResponse.class));
  expectLastCall().anyTimes();
  expect(mockCache.getCacheEntry(eq(host),isA(HttpRequest.class))).andThrow(new IOException()).anyTimes();
  expect(mockCache.getVariantCacheEntriesWithEtags(eq(host),isA(HttpRequest.class))).andThrow(new IOException()).anyTimes();
  expect(mockCache.cacheAndReturnResponse(eq(host),isA(HttpRequest.class),isA(CloseableHttpResponse.class),isA(Date.class),isA(Date.class))).andReturn(resp).anyTimes();
  expect(mockBackend.execute(eq(route),isA(HttpRequestWrapper.class),isA(HttpClientContext.class),(HttpExecutionAware)isNull())).andReturn(resp);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertSame(resp,result);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCacheableResponsesGoIntoCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Cache-Control","max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(HttpTestUtils.makeDefaultRequest(),host);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-7 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testSetsViaHeaderIfRequestWasSuccessfullyValidated() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","public, max-age=5");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp2.setEntity(HttpTestUtils.makeBody(128));
  resp2.setHeader("Content-Length","128");
  resp2.setHeader("ETag","\"etag\"");
  resp2.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp2.setHeader("Cache-Control","public, max-age=5");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertNotNull(result.getFirstHeader("Via"));
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReturns304ForIfNoneMatchHeaderIfRequestServedFromCache() throws Exception {
  impl=createCachingExecChain(mockBackend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new HttpGet("http://foo.example.com/"),host);
  req2.addHeader("If-None-Match","*");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp1.setEntity(HttpTestUtils.makeBody(128));
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(new Date()));
  resp1.setHeader("Cache-Control","public, max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals(HttpStatus.SC_NOT_MODIFIED,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testDoesNotSetConnectionInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  impl.execute(route,request,ctx,null);
  assertNull(ctx.getConnection());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
