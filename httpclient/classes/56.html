<h3 style="margin:0px">Class: org.apache.hc.client5.http.impl.cache.TestProtocolRequirements (232 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(146)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(45)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(37)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(37)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(30)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(29)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(24)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="18"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('18')" data-toggle="tooltip" title="Is an empty test case"><kbd id="tag-18"class="label-info"style="display: inline-block;font-size:7pt" >EmptyTester&nbsp;(2)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="17"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('17')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-17"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyLastModifiedHeaderOnRequest() throws Exception {
  final long tenSecondsAgo=System.currentTimeMillis() - 10 * 1000L;
  final String lm=DateUtils.formatDate(new Date(tenSecondsAgo));
  testDoesNotModifyHeaderOnRequest("Last-Modified",lm);
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUpdatedEndToEndHeadersFrom304ArePassedOnResponseAndUpdatedInCacheEntry() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("ETag","\"etag\"");
  decorateWithEndToEndHeaders(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-age=0, max-stale=0");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("Cache-Control","max-age=1800");
  resp2.setHeader("Date",DateUtils.formatDate(new Date()));
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Allow","GET,HEAD");
  resp2.setHeader("Content-Language","en,en-us");
  resp2.setHeader("Content-Location","http://foo.example.com/new");
  resp2.setHeader("Content-Type","text/html");
  resp2.setHeader("Expires",DateUtils.formatDate(new Date(System.currentTimeMillis() + 5 * 1000L)));
  resp2.setHeader("Location","http://foo.example.com/new2");
  resp2.setHeader("Pragma","x-new-pragma");
  resp2.setHeader("Retry-After","120");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result1=impl.execute(route,req2,context,null);
  final HttpResponse result2=impl.execute(route,req3,context,null);
  verifyMocks();
  final String[] endToEndHeaders={"Date","Cache-Control","Allow","Content-Language","Content-Location","Content-Type","Expires","Location","Pragma","Retry-After"};
  for (  final String h : endToEndHeaders) {
    Assert.assertEquals(HttpTestUtils.getCanonicalHeaderValue(resp2,h),HttpTestUtils.getCanonicalHeaderValue(result1,h));
    Assert.assertEquals(HttpTestUtils.getCanonicalHeaderValue(resp2,h),HttpTestUtils.getCanonicalHeaderValue(result2,h));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteInvalidatesCacheForThatUriInRelativeContentLocationHeader() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/"),host);
  testUnsafeMethodInvalidatesCacheForRelativeUriInContentLocationHeader(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testForwardsUnknownHeadersOnRequestsFromHigherProtocolVersions() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",new ProtocolVersion("HTTP",1,2)),host);
  request.removeHeaders("Connection");
  request.addHeader("X-Unknown-Header","some-value");
  final HttpRequestWrapper downgraded=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",HttpVersion.HTTP_1_1),host);
  downgraded.removeHeaders("Connection");
  downgraded.addHeader("X-Unknown-Header","some-value");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),eqRequest(downgraded),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLowerOriginResponsesUpgradedToOurVersion1_1() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(new ProtocolVersion("HTTP",1,2),HttpStatus.SC_OK,"OK"));
  originResponse.setHeader("Date",DateUtils.formatDate(new Date()));
  originResponse.setHeader("Server","MockOrigin/1.0");
  originResponse.setEntity(body);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(HttpVersion.HTTP_1_1,result.getProtocolVersion());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnknownResponseStatusCodesAreNotCached() throws Exception {
  for (int i=102; i <= 199; i++) {
    testUnknownResponseStatusCodeIsNotCached(i);
  }
  for (int i=207; i <= 299; i++) {
    testUnknownResponseStatusCodeIsNotCached(i);
  }
  for (int i=308; i <= 399; i++) {
    testUnknownResponseStatusCodeIsNotCached(i);
  }
  for (int i=418; i <= 499; i++) {
    testUnknownResponseStatusCodeIsNotCached(i);
  }
  for (int i=506; i <= 999; i++) {
    testUnknownResponseStatusCodeIsNotCached(i);
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleAcceptHeaderValuesIsPreservedOnRequests() throws Exception {
  request.addHeader("Accept","audio/*; q=0.2, audio/basic");
  request.addHeader("Accept","text/*, text/html, text/html;level=1, */*");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Accept",request);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleViaHeadersIsPreservedOnResponses() throws Exception {
  originResponse.addHeader("Via","1.0 fred, 1.1 nowhere.com (Apache/1.1)");
  originResponse.addHeader("Via","1.0 ricky, 1.1 mertz, 1.0 lucy");
  testOrderOfMultipleHeadersIsPreservedOnResponses("Via");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPostInvalidatesCacheForThatUriInLocationHeader() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("POST","/");
  testUnsafeMethodInvalidatesCacheForUriInLocationHeader(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyLastModifiedHeaderFromOrigin() throws Exception {
  final String lm=DateUtils.formatDate(new Date());
  testDoesNotModifyHeaderFromOrigin("Last-Modified",lm);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test302ResponseWithoutExplicitCacheabilityIsNotReturnedFromCache() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,302,"Temporary Redirect"));
  originResponse.setHeader("Location","http://foo.example.com/other");
  originResponse.removeHeaders("Expires");
  originResponse.removeHeaders("Cache-Control");
  backendExpectsAnyRequest().andReturn(originResponse).times(2);
  replayMocks();
  impl.execute(route,request,context,null);
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentEncodingHeaderToOriginResponseWithNoTransformIfNotPresent() throws Exception {
  originResponse.addHeader("Cache-Control","no-transform");
  testDoesNotAddHeaderToOriginResponse("Content-Encoding");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleCacheControlHeadersIsPreservedOnResponses() throws Exception {
  originResponse.addHeader("Cache-Control","max-age=0");
  originResponse.addHeader("Cache-Control","no-store, must-revalidate");
  testOrderOfMultipleHeadersIsPreservedOnResponses("Cache-Control");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyExpiresHeaderFromOriginOnCacheHit() throws Exception {
  final long inTenSeconds=System.currentTimeMillis() + 10 * 1000L;
  final String expires=DateUtils.formatDate(new Date(inTenSeconds));
  testDoesNotModifyHeaderFromOriginOnCacheHit("Expires",expires);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSharedCacheMustNotNormallyCacheAuthorizedResponses() throws Exception {
  final HttpResponse resp=HttpTestUtils.make200Response();
  resp.setHeader("Cache-Control","max-age=3600");
  resp.setHeader("ETag","\"etag\"");
  testSharedCacheRevalidatesAuthorizedResponse(resp,1,1);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCacheDoesNotAssumeContentLocationHeaderIndicatesAnotherCacheableResource() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Cache-Control","public,max-age=3600");
  resp1.setHeader("Etag","\"etag\"");
  resp1.setHeader("Content-Location","http://foo.example.com/bar");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/bar",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("Cache-Control","public,max-age=3600");
  resp2.setHeader("Etag","\"etag\"");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultiplePragmaHeadersIsPreservedOnRequests() throws Exception {
  request.addHeader("Pragma","no-cache");
  request.addHeader("Pragma","x-pragma-1, x-pragma-2");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Pragma",request);
}

</code></pre>

<pre class="type-7 type-16 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies whether objects are null
"></span><br>
@Test public void testCacheControlPrivateOnFieldIsNotReturnedBySharedCache() throws Exception {
  if (config.isSharedCache()) {
    final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    final HttpResponse resp1=HttpTestUtils.make200Response();
    resp1.setHeader("X-Personal","stuff");
    resp1.setHeader("Cache-Control","private=\"X-Personal\",s-maxage=3600");
    backendExpectsAnyRequestAndReturn(resp1);
    final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    final HttpResponse resp2=HttpTestUtils.make200Response();
    backendExpectsAnyRequestAndReturn(resp2).times(0,1);
    replayMocks();
    impl.execute(route,req1,context,null);
    final HttpResponse result=impl.execute(route,req2,context,null);
    verifyMocks();
    Assert.assertNull(result.getFirstHeader("X-Personal"));
  }
}

</code></pre>

<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testMustIncludeAllowHeaderFromAnOrigin405Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,405,"Method Not Allowed"));
  originResponse.setHeader("Allow","GET, HEAD");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  if (result.getStatusLine().getStatusCode() == 405) {
    Assert.assertNotNull(result.getFirstHeader("Allow"));
  }
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentEncodingHeaderToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-Encoding");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test206ResponsesAreNotCachedIfTheCacheDoesNotSupportRangeAndContentRangeHeaders() throws Exception {
  if (!supportsRangeAndContentRangeHeaders(impl)) {
    emptyMockCacheExpectsNoPuts();
    request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    request.addHeader("Range","bytes=0-50");
    originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content"));
    originResponse.setHeader("Content-Range","bytes 0-50/128");
    originResponse.setHeader("Cache-Control","max-age=3600");
    final byte[] bytes=new byte[51];
    new Random().nextBytes(bytes);
    originResponse.setEntity(new ByteArrayEntity(bytes));
    EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
    replayMocks();
    impl.execute(route,request,context,null);
    verifyMocks();
  }
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ContainsETagIfA200ResponseWouldHaveIncludedIt() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("ETag","\"etag1\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNotNull(result.getFirstHeader("ETag"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCannotCombinePartialResponseIfCacheValidatorsDoNotStronglyMatch() throws Exception {
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final Date twoSecondsAgo=new Date(now.getTime() - 2 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(twoSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("ETag","\"etag2\"");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentTypeHeaderOnCachedResponseWithNoTransform() throws Exception {
  testDoesNotModifyHeaderOnCachedResponseWithNoTransform("Content-Type","text/html;charset=utf-8");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSharedCacheMayCacheAuthorizedResponsesWithMustRevalidate() throws Exception {
  final HttpResponse resp=HttpTestUtils.make200Response();
  resp.setHeader("Cache-Control","must-revalidate");
  resp.setHeader("ETag","\"etag\"");
  testSharedCacheRevalidatesAuthorizedResponse(resp,0,1);
}

</code></pre>

<pre class="type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKeepsMostRecentDateHeaderForFreshResponse() throws Exception {
  final Date now=new Date();
  final Date inFiveSecond=new Date(now.getTime() + 5 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(inFiveSecond));
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Length","128");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","no-cache");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("ETag","\"etag2\"");
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Length","128");
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),eqRequest(req1),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  Assert.assertEquals("\"etag1\"",result.getFirstHeader("ETag").getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSharedCacheMustRevalidateAuthorizedResponsesWhenSMaxAgeIsZero() throws Exception {
  final HttpResponse resp=HttpTestUtils.make200Response();
  resp.setHeader("Cache-Control","s-maxage=0");
  resp.setHeader("ETag","\"etag\"");
  testSharedCacheRevalidatesAuthorizedResponse(resp,1,1);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPostInvalidatesCacheForRelativeUriInContentLocationHeader() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("POST","/");
  testUnsafeMethodInvalidatesCacheForRelativeUriInContentLocationHeader(req);
}

</code></pre>

<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleTransferEncodingHeadersIsPreserved() throws Exception {
  originResponse.addHeader("Transfer-Encoding","chunked");
  originResponse.addHeader("Transfer-Encoding","x-transfer");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int transfer_encodings=0;
  for (  final Header h : result.getHeaders("Transfer-Encoding")) {
    for (    final HeaderElement elt : h.getElements()) {
switch (transfer_encodings) {
case 0:
        Assert.assertEquals("chunked",elt.getName());
      break;
case 1:
    Assert.assertEquals("x-transfer",elt.getName());
  break;
default :
Assert.fail("too many transfer encodings");
}
transfer_encodings++;
}
}
Assert.assertEquals(2,transfer_encodings);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoesNotModifyAllowHeaderWithUnknownMethods() throws Exception {
  final String allowHeaderValue="GET, HEAD, FOOBAR";
  originResponse.setHeader("Allow",allowHeaderValue);
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(HttpTestUtils.getCanonicalHeaderValue(originResponse,"Allow"),HttpTestUtils.getCanonicalHeaderValue(result,"Allow"));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentLocationToOriginResponse() throws Exception {
  testDoesNotAddHeaderToOriginResponse("Content-Location");
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDecrementsMaxForwardsWhenForwardingOPTIONSRequest() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("OPTIONS","*",HttpVersion.HTTP_1_1),host);
  request.setHeader("Max-Forwards","7");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
  final HttpRequest captured=cap.getValue();
  Assert.assertEquals("6",captured.getFirstHeader("Max-Forwards").getValue());
}

</code></pre>

<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testWarning110IsAddedToStaleResponses() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","max-age=5");
  resp1.setHeader("Etag","\"etag\"");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-stale=60");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (!cap.hasCaptured()) {
    boolean found110Warning=false;
    for (    final Header h : result.getHeaders("Warning")) {
      for (      final HeaderElement elt : h.getElements()) {
        final String[] parts=elt.getName().split("\\s");
        if ("110".equals(parts[0])) {
          found110Warning=true;
          break;
        }
      }
    }
    Assert.assertTrue(found110Warning);
  }
}

</code></pre>

<pre class="type-16 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testIncompleteResponseMustNotBeReturnedToClientWithoutMarkingItAs206() throws Exception {
  originResponse.setEntity(HttpTestUtils.makeBody(128));
  originResponse.setHeader("Content-Length","256");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final int status=result.getStatusLine().getStatusCode();
  Assert.assertFalse(HttpStatus.SC_OK == status);
  if (status > 200 && status <= 299 && HttpTestUtils.equivalent(originResponse.getEntity(),result.getEntity())) {
    Assert.assertTrue(HttpStatus.SC_PARTIAL_CONTENT == status);
  }
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ResponseGeneratedFromCacheMustHaveDateHeader() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=0-50");
  backendExpectsAnyRequestAndReturn(resp1).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_PARTIAL_CONTENT == result.getStatusLine().getStatusCode()) {
    Assert.assertNotNull(result.getFirstHeader("Date"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteDoesNotInvalidateCacheForUriInContentLocationHeadersFromOtherHosts() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/",HttpVersion.HTTP_1_1),host);
  testUnsafeMethodDoesNotInvalidateCacheForUriInContentLocationHeadersFromOtherHosts(req);
}

</code></pre>

<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testConditionalRequestWhereNotAllValidatorsMatchCannotBeServedFromCache() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final Date twentySecondsAgo=new Date(now.getTime() - 20 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","W/\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","W/\"etag\"");
  req2.setHeader("If-Modified-Since",DateUtils.formatDate(twentySecondsAgo));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1)).times(2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertFalse(HttpStatus.SC_NOT_MODIFIED == result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentLocationHeaderOnRequest() throws Exception {
  final String url="http://foo.example.com/other";
  testDoesNotModifyHeaderOnRequest("Content-Location",url);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSharedCacheMustUseNewRequestHeadersWhenRevalidatingAuthorizedResponsesWithSMaxAge() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","s-maxage=5");
  testSharedCacheMustUseNewRequestHeadersWhenRevalidatingAuthorizedResponse(resp1);
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoesNotModifyContentRangeHeaderOnCachedResponseWithNoTransform() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("If-Range","\"etag\"");
  req1.setHeader("Range","bytes=0-49");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-Range","\"etag\"");
  req2.setHeader("Range","bytes=0-49");
  originResponse.addHeader("Cache-Control","max-age=3600, no-transform");
  originResponse.setHeader("Content-Range","bytes 0-49/128");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertEquals("bytes 0-49/128",result.getFirstHeader("Content-Range").getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleContentEncodingHeadersIsPreservedOnRequests() throws Exception {
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",HttpVersion.HTTP_1_1);
  post.setEntity(body);
  post.addHeader("Content-Encoding","gzip");
  post.addHeader("Content-Encoding","compress");
  post.addHeader("Content-Length","128");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Content-Encoding",HttpRequestWrapper.wrap(post,host));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNoCacheCannotSatisfyASubsequentRequestWithoutRevalidationEvenWithContraryIndications() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","no-cache,s-maxage=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-stale=7200");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test304ResponseDoesNotContainABody() throws Exception {
  request.setHeader("If-None-Match","\"etag\"");
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified"));
  originResponse.setHeader("Date",DateUtils.formatDate(new Date()));
  originResponse.setHeader("Server","MockServer/1.0");
  originResponse.setHeader("Content-Length","128");
  originResponse.setEntity(HttpTestUtils.makeBody(entityLength));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertTrue(result.getEntity() == null || result.getEntity().getContentLength() == 0);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMustReturnACacheEntryIfItCanRevalidateIt() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final Date nineSecondsAgo=new Date(now.getTime() - 9 * 1000L);
  final Date eightSecondsAgo=new Date(now.getTime() - 8 * 1000L);
  final Header[] hdrs=new Header[]{new BasicHeader("Date",DateUtils.formatDate(nineSecondsAgo)),new BasicHeader("Cache-Control","max-age=0"),new BasicHeader("ETag","\"etag\""),new BasicHeader("Content-Length","128")};
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpCacheEntry entry=HttpTestUtils.makeCacheEntry(tenSecondsAgo,eightSecondsAgo,hdrs,bytes);
  impl=new CachingExec(mockBackend,mockCache,config);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  final HttpRequestWrapper validate=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  validate.setHeader("If-None-Match","\"etag\"");
  final CloseableHttpResponse notModified=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified"));
  notModified.setHeader("Date",DateUtils.formatDate(now));
  notModified.setHeader("ETag","\"etag\"");
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.eq(host),eqRequest(request));
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.eq(host),eqRequest(request))).andReturn(entry);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(validate),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(notModified);
  EasyMock.expect(mockCache.updateCacheEntry(EasyMock.eq(host),eqRequest(request),EasyMock.eq(entry),eqResponse(notModified),EasyMock.isA(Date.class),EasyMock.isA(Date.class))).andReturn(HttpTestUtils.makeCacheEntry());
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultiplePragmaHeadersIsPreservedOnResponses() throws Exception {
  originResponse.addHeader("Pragma","no-cache, x-pragma-2");
  originResponse.addHeader("Pragma","x-pragma-1");
  testOrderOfMultipleHeadersIsPreservedOnResponses("Pragma");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPOSTRequestsAreWrittenThroughToOrigin() throws Exception {
  final HttpRequest req=new BasicHttpRequest("POST","/",HttpVersion.HTTP_1_1);
  req.setEntity(HttpTestUtils.makeBody(128));
  req.setHeader("Content-Length","128");
  testRequestIsWrittenThroughToOrigin(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentEncodingToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-Encoding");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPutInvalidatesCacheForThatUriInRelativeContentLocationHeader() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("PUT","/");
  testUnsafeMethodInvalidatesCacheForRelativeUriInContentLocationHeader(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGenerates504IfSharedCacheCannotRevalidateAProxyRevalidateEntry() throws Exception {
  if (config.isSharedCache()) {
    final HttpResponse resp1=HttpTestUtils.make200Response();
    final Date now=new Date();
    final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
    resp1.setHeader("ETag","\"etag\"");
    resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
    resp1.setHeader("Cache-Control","max-age=5,proxy-revalidate");
    testGenerates504IfCannotRevalidateStaleResponse(resp1);
  }
}

</code></pre>

<pre class="type-4 type-1 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test200ResponseToOPTIONSWithNoBodyShouldIncludeContentLengthZero() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("OPTIONS","/",HttpVersion.HTTP_1_1),host);
  originResponse.setEntity(null);
  originResponse.setHeader("Content-Length","0");
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final Header contentLength=result.getFirstHeader("Content-Length");
  Assert.assertNotNull(contentLength);
  Assert.assertEquals("0",contentLength.getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentEncodingHeaderToCachedResponseWithNoTransformIfNotPresent() throws Exception {
  originResponse.addHeader("Cache-Control","no-transform");
  testDoesNotAddHeaderOnCacheHit("Content-Encoding");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCONNECTRequestsAreWrittenThroughToOrigin() throws Exception {
  final HttpRequest req=HttpRequestWrapper.wrap(new BasicHttpRequest("CONNECT","/",HttpVersion.HTTP_1_1),host);
  testRequestIsWrittenThroughToOrigin(req);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testSubrangeGETWithWeakETagIsNotAllowed() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  request.setHeader("Range","bytes=0-500");
  request.setHeader("If-Range","W/\"etag\"");
  final HttpResponse response=testRequestWithWeakETagValidatorIsNotAllowed("If-Range");
  Assert.assertTrue(response.getStatusLine().getStatusCode() == HttpStatus.SC_BAD_REQUEST);
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test100ContinueResponsesAreNotForwardedTo1_0ClientsWhoDidNotAskForThem() throws Exception {
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",new ProtocolVersion("HTTP",1,0));
  post.setEntity(body);
  post.setHeader("Content-Length","128");
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,100,"Continue"));
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  try {
    impl.execute(route,HttpRequestWrapper.wrap(post,host),context,null);
    Assert.fail("should have thrown an exception");
  }
 catch (  final ClientProtocolException expected) {
  }
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNoStoreOnResponseIsNotStoredInCache() throws Exception {
  emptyMockCacheExpectsNoPuts();
  originResponse.setHeader("Cache-Control","no-store");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCannotUseVariantCacheEntryIfNotAllSelectingRequestHeadersMatch() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Accept-Encoding","gzip");
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Vary","Accept-Encoding");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.removeHeaders("Accept-Encoding");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"etag1\"");
  resp2.setHeader("Cache-Control","max-age=3600");
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentTypeHeaderToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-Type");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPutInvalidatesCacheForThatUriInContentLocationHeader() throws Exception {
  final HttpRequestWrapper req2=makeRequestWithBody("PUT","/");
  testUnsafeMethodInvalidatesCacheForUriInContentLocationHeader(req2);
}

</code></pre>

<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleTransferEncodingsInSingleHeadersIsPreserved() throws Exception {
  originResponse.addHeader("Transfer-Encoding","chunked, x-transfer");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int transfer_encodings=0;
  for (  final Header h : result.getHeaders("Transfer-Encoding")) {
    for (    final HeaderElement elt : h.getElements()) {
switch (transfer_encodings) {
case 0:
        Assert.assertEquals("chunked",elt.getName());
      break;
case 1:
    Assert.assertEquals("x-transfer",elt.getName());
  break;
default :
Assert.fail("too many transfer encodings");
}
transfer_encodings++;
}
}
Assert.assertEquals(2,transfer_encodings);
}

</code></pre>

<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testMustIncludeProxyAuthenticateHeaderFromAnOrigin407Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,407,"Proxy Authentication Required"));
  originResponse.setHeader("Proxy-Authenticate","x-scheme x-param");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  if (result.getStatusLine().getStatusCode() == 407) {
    Assert.assertNotNull(result.getFirstHeader("Proxy-Authenticate"));
  }
  verifyMocks();
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test206ResponseIsNotCombinedWithPreviousContentIfETagDoesNotMatch() throws Exception {
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("ETag","\"etag1\"");
  final byte[] bytes1=new byte[128];
  for (int i=0; i < bytes1.length; i++) {
    bytes1[i]=(byte)1;
  }
  resp1.setEntity(new ByteArrayEntity(bytes1));
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","no-cache");
  req2.setHeader("Range","bytes=0-50");
  final Date inOneSecond=new Date(now.getTime() + 1000L);
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setHeader("Date",DateUtils.formatDate(inOneSecond));
  resp2.setHeader("Server",resp1.getFirstHeader("Server").getValue());
  resp2.setHeader("ETag","\"etag2\"");
  resp2.setHeader("Content-Range","bytes 0-50/128");
  final byte[] bytes2=new byte[51];
  for (int i=0; i < bytes2.length; i++) {
    bytes2[i]=(byte)2;
  }
  resp2.setEntity(new ByteArrayEntity(bytes2));
  final Date inTwoSeconds=new Date(now.getTime() + 2000L);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp3=HttpTestUtils.make200Response();
  resp3.setHeader("Date",DateUtils.formatDate(inTwoSeconds));
  resp3.setHeader("Cache-Control","max-age=3600");
  resp3.setHeader("ETag","\"etag2\"");
  final byte[] bytes3=new byte[128];
  for (int i=0; i < bytes3.length; i++) {
    bytes3[i]=(byte)2;
  }
  resp3.setEntity(new ByteArrayEntity(bytes3));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp3)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  final InputStream i=result.getEntity().getContent();
  int b;
  boolean found1=false;
  boolean found2=false;
  while ((b=i.read()) != -1) {
    if (b == 1) {
      found1=true;
    }
    if (b == 2) {
      found2=true;
    }
  }
  i.close();
  Assert.assertFalse(found1 && found2);
}

</code></pre>

<pre class="type-7 type-16 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies whether objects are null
"></span><br>
@Test public void testNoCacheOnFieldIsNotReturnedWithoutRevalidation() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("X-Stuff","things");
  resp1.setHeader("Cache-Control","no-cache=\"X-Stuff\", max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"etag\"");
  resp2.setHeader("X-Stuff","things");
  resp2.setHeader("Cache-Control","no-cache=\"X-Stuff\",max-age=3600");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (!cap.hasCaptured()) {
    Assert.assertNull(result.getFirstHeader("X-Stuff"));
  }
}

</code></pre>

<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testMustIncludeWWWAuthenticateHeaderOnAnOrigin401Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,401,"Unauthorized"));
  originResponse.setHeader("WWW-Authenticate","x-scheme x-param");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  if (result.getStatusLine().getStatusCode() == 401) {
    Assert.assertNotNull(result.getFirstHeader("WWW-Authenticate"));
  }
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExpiresZeroHeaderIsTreatedAsStale() throws Exception {
  testInvalidExpiresHeaderIsTreatedAsStale("0");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGenerates504IfCannotRevalidateAMustRevalidateEntry() throws Exception {
  final HttpResponse resp1=HttpTestUtils.make200Response();
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","max-age=5,must-revalidate");
  testGenerates504IfCannotRevalidateStaleResponse(resp1);
}

</code></pre>

<pre class="type-7 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test1xxWarningsAreDeletedAfterSuccessfulRevalidation() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 25 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=5");
  resp1.setHeader("Warning","110 squid \"stale stuff\"");
  resp1.setHeader("Via","1.1 fred");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpRequestWrapper validate=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  validate.setHeader("If-None-Match","\"etag\"");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("ETag","\"etag\"");
  resp2.setHeader("Via","1.1 fred");
  backendExpectsAnyRequestAndReturn(resp1);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(validate),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2));
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  replayMocks();
  final HttpResponse stale=impl.execute(route,req1,context,null);
  Assert.assertNotNull(stale.getFirstHeader("Warning"));
  final HttpResponse result1=impl.execute(route,req2,context,null);
  final HttpResponse result2=impl.execute(route,req3,context,null);
  verifyMocks();
  boolean found1xxWarning=false;
  for (  final Header h : result1.getHeaders("Warning")) {
    for (    final HeaderElement elt : h.getElements()) {
      if (elt.getName().startsWith("1")) {
        found1xxWarning=true;
      }
    }
  }
  for (  final Header h : result2.getHeaders("Warning")) {
    for (    final HeaderElement elt : h.getElements()) {
      if (elt.getName().startsWith("1")) {
        found1xxWarning=true;
      }
    }
  }
  Assert.assertFalse(found1xxWarning);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddLastModifiedHeaderOnCacheHit() throws Exception {
  testDoesNotAddHeaderOnCacheHit("Last-Modified");
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test206ResponseIsNotCombinedWithPreviousContentIfLastModifiedDoesNotMatch() throws Exception {
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  final Date oneHourAgo=new Date(now.getTime() - 3600L);
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(oneHourAgo));
  final byte[] bytes1=new byte[128];
  for (int i=0; i < bytes1.length; i++) {
    bytes1[i]=(byte)1;
  }
  resp1.setEntity(new ByteArrayEntity(bytes1));
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","no-cache");
  req2.setHeader("Range","bytes=0-50");
  final Date inOneSecond=new Date(now.getTime() + 1000L);
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setHeader("Date",DateUtils.formatDate(inOneSecond));
  resp2.setHeader("Server",resp1.getFirstHeader("Server").getValue());
  resp2.setHeader("Last-Modified",DateUtils.formatDate(now));
  resp2.setHeader("Content-Range","bytes 0-50/128");
  final byte[] bytes2=new byte[51];
  for (int i=0; i < bytes2.length; i++) {
    bytes2[i]=(byte)2;
  }
  resp2.setEntity(new ByteArrayEntity(bytes2));
  final Date inTwoSeconds=new Date(now.getTime() + 2000L);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp3=HttpTestUtils.make200Response();
  resp3.setHeader("Date",DateUtils.formatDate(inTwoSeconds));
  resp3.setHeader("Cache-Control","max-age=3600");
  resp3.setHeader("ETag","\"etag2\"");
  final byte[] bytes3=new byte[128];
  for (int i=0; i < bytes3.length; i++) {
    bytes3[i]=(byte)2;
  }
  resp3.setEntity(new ByteArrayEntity(bytes3));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp3)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  final InputStream i=result.getEntity().getContent();
  int b;
  boolean found1=false;
  boolean found2=false;
  while ((b=i.read()) != -1) {
    if (b == 1) {
      found1=true;
    }
    if (b == 2) {
      found2=true;
    }
  }
  i.close();
  Assert.assertFalse(found1 && found2);
}

</code></pre>

<pre class="type-16 type-2 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHeuristicCacheOlderThan24HoursHasWarningAttached() throws Exception {
  final Date now=new Date();
  final Date thirtySixHoursAgo=new Date(now.getTime() - 36 * 3600 * 1000L);
  final Date oneYearAgo=new Date(now.getTime() - 365 * 24 * 3600* 1000L);
  final Date requestTime=new Date(thirtySixHoursAgo.getTime() - 1000L);
  final Date responseTime=new Date(thirtySixHoursAgo.getTime() + 1000L);
  final Header[] hdrs=new Header[]{new BasicHeader("Date",DateUtils.formatDate(thirtySixHoursAgo)),new BasicHeader("Cache-Control","public"),new BasicHeader("Last-Modified",DateUtils.formatDate(oneYearAgo)),new BasicHeader("Content-Length","128")};
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpCacheEntry entry=HttpTestUtils.makeCacheEntry(requestTime,responseTime,hdrs,bytes);
  impl=new CachingExec(mockBackend,mockCache,config);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  final CloseableHttpResponse validated=Proxies.enhanceResponse(HttpTestUtils.make200Response());
  validated.setHeader("Cache-Control","public");
  validated.setHeader("Last-Modified",DateUtils.formatDate(oneYearAgo));
  validated.setHeader("Content-Length","128");
  validated.setEntity(new ByteArrayEntity(bytes));
  final CloseableHttpResponse reconstructed=Proxies.enhanceResponse(HttpTestUtils.make200Response());
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.eq(host),eqRequest(request));
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.isA(HttpHost.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpResponse.class));
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.eq(host),eqRequest(request))).andReturn(entry);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(validated).times(0,1);
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.isA(HttpHost.class),EasyMock.isA(HttpRequestWrapper.class))).andReturn(entry).times(0,1);
  EasyMock.expect(mockCache.cacheAndReturnResponse(EasyMock.isA(HttpHost.class),EasyMock.isA(HttpRequestWrapper.class),eqCloseableResponse(validated),EasyMock.isA(Date.class),EasyMock.isA(Date.class))).andReturn(reconstructed).times(0,1);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(200,result.getStatusLine().getStatusCode());
  if (!cap.hasCaptured()) {
    boolean found113Warning=false;
    for (    final Header h : result.getHeaders("Warning")) {
      for (      final HeaderElement elt : h.getElements()) {
        final String[] parts=elt.getName().split(" ");
        if ("113".equals(parts[0])) {
          found113Warning=true;
          break;
        }
      }
    }
    Assert.assertTrue(found113Warning);
  }
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testHigherMajorProtocolVersionsOnRequestSwitchToTunnelBehavior() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",new ProtocolVersion("HTTP",2,13)),host);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(request),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertSame(originResponse,result);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleCacheControlHeadersIsPreservedOnRequests() throws Exception {
  request.addHeader("Cache-Control","max-age=5");
  request.addHeader("Cache-Control","min-fresh=10");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Cache-Control",request);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testResponsesToTRACEsAreNotCached() throws Exception {
  emptyMockCacheExpectsNoPuts();
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("TRACE","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testResponsesToPOSTWithoutCacheControlOrExpiresAreNotCached() throws Exception {
  emptyMockCacheExpectsNoPuts();
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",HttpVersion.HTTP_1_1);
  post.setHeader("Content-Length","128");
  post.setEntity(HttpTestUtils.makeBody(128));
  originResponse.removeHeaders("Cache-Control");
  originResponse.removeHeaders("Expires");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,HttpRequestWrapper.wrap(post,host),context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleWWWAuthenticateHeadersIsPreservedOnResponses() throws Exception {
  originResponse.addHeader("WWW-Authenticate","x-challenge-1");
  originResponse.addHeader("WWW-Authenticate","x-challenge-2");
  testOrderOfMultipleHeadersIsPreservedOnResponses("WWW-Authenticate");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test303ResponsesAreNotCached() throws Exception {
  emptyMockCacheExpectsNoPuts();
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_SEE_OTHER,"See Other"));
  originResponse.setHeader("Date",DateUtils.formatDate(new Date()));
  originResponse.setHeader("Server","MockServer/1.0");
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.setHeader("Content-Type","application/x-cachingclient-test");
  originResponse.setHeader("Location","http://foo.example.com/other");
  originResponse.setEntity(HttpTestUtils.makeBody(entityLength));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testDoesNotTransmitNoCacheDirectivesWithFieldsDownstream() throws Exception {
  request.setHeader("Cache-Control","no-cache=\"X-Field\"");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(0,1);
  replayMocks();
  try {
    impl.execute(route,request,context,null);
  }
 catch (  final ClientProtocolException acceptable) {
  }
  verifyMocks();
  if (cap.hasCaptured()) {
    final HttpRequest captured=cap.getValue();
    for (    final Header h : captured.getHeaders("Cache-Control")) {
      for (      final HeaderElement elt : h.getElements()) {
        if ("no-cache".equals(elt.getName())) {
          Assert.assertNull(elt.getValue());
        }
      }
    }
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteDoesNotInvalidateCacheForUriInLocationHeadersFromOtherHosts() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/",HttpVersion.HTTP_1_1),host);
  testUnsafeMethodDoesNotInvalidateCacheForUriInLocationHeadersFromOtherHosts(req);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testExpect100ContinueIsNotSentIfThereIsNoRequestBody() throws Exception {
  request.addHeader("Expect","100-continue");
  final Capture<HttpRequestWrapper> reqCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(reqCap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
  final HttpRequest forwarded=reqCap.getValue();
  boolean foundExpectContinue=false;
  for (  final Header h : forwarded.getHeaders("Expect")) {
    for (    final HeaderElement elt : h.getElements()) {
      if ("100-continue".equalsIgnoreCase(elt.getName())) {
        foundExpectContinue=true;
        break;
      }
    }
  }
  Assert.assertFalse(foundExpectContinue);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testHEADResponseWithUpdatedLastModifiedFieldMakeACacheEntryStale() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final Date sixSecondsAgo=new Date(now.getTime() - 6 * 1000L);
  testHEADResponseWithUpdatedEntityFieldsMakeACacheEntryStale("Last-Modified",DateUtils.formatDate(tenSecondsAgo),DateUtils.formatDate(sixSecondsAgo));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAgeHeaderPopulatedFromCacheEntryCurrentAge() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final Date nineSecondsAgo=new Date(now.getTime() - 9 * 1000L);
  final Date eightSecondsAgo=new Date(now.getTime() - 8 * 1000L);
  final Header[] hdrs=new Header[]{new BasicHeader("Date",DateUtils.formatDate(nineSecondsAgo)),new BasicHeader("Cache-Control","max-age=3600"),new BasicHeader("Content-Length","128")};
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpCacheEntry entry=HttpTestUtils.makeCacheEntry(tenSecondsAgo,eightSecondsAgo,hdrs,bytes);
  impl=new CachingExec(mockBackend,mockCache,config);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.eq(host),eqRequest(request));
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.eq(host),eqRequest(request))).andReturn(entry);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(200,result.getStatusLine().getStatusCode());
  Assert.assertEquals("11",result.getFirstHeader("Age").getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddEtagToOriginResponse() throws Exception {
  testDoesNotAddHeaderToOriginResponse("ETag");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentMD5HeaderOnRequest() throws Exception {
  testDoesNotModifyHeaderOnRequest("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPUTWithIfNoneMatchWeakETagIsNotAllowed() throws Exception {
  final HttpRequest put=new BasicHttpRequest("PUT","/",HttpVersion.HTTP_1_1);
  put.setEntity(HttpTestUtils.makeBody(128));
  put.setHeader("Content-Length","128");
  put.setHeader("If-None-Match","W/\"etag\"");
  request=HttpRequestWrapper.wrap(put,host);
  testRequestWithWeakETagValidatorIsNotAllowed("If-None-Match");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentLocationFromOriginOnCacheHit() throws Exception {
  final String url="http://foo.example.com/other";
  testDoesNotModifyHeaderFromOriginOnCacheHit("Content-Location",url);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNoCacheCannotSatisfyASubsequentRequestWithoutRevalidation() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","no-cache");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp2=HttpTestUtils.make200Response();
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyETagHeaderOnRequest() throws Exception {
  testDoesNotModifyHeaderOnRequest("ETag","\"etag\"");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentMD5FromOriginOnCacheHit() throws Exception {
  testDoesNotModifyHeaderFromOriginOnCacheHit("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDELETEWithIfMatchWeakETagIsNotAllowed() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/",HttpVersion.HTTP_1_1),host);
  request.setHeader("If-Match","W/\"etag\"");
  testRequestWithWeakETagValidatorIsNotAllowed("If-Match");
}

</code></pre>

<pre class="type-7 type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testViaHeaderOnResponseProperlyRecordsOriginProtocol() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_0,HttpStatus.SC_NO_CONTENT,"No Content"));
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final String via=result.getFirstHeader("Via").getValue();
  final String protocol=via.split("\\s+")[0];
  final String[] protoParts=protocol.split("/");
  Assert.assertTrue(protoParts.length >= 1);
  Assert.assertTrue(protoParts.length <= 2);
  if (protoParts.length > 1) {
    Assert.assertTrue("http".equalsIgnoreCase(protoParts[0]));
  }
  Assert.assertEquals("1.0",protoParts[protoParts.length - 1]);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSharedCacheMustUseNewRequestHeadersWhenRevalidatingAuthorizedResponsesWithMustRevalidate() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","maxage=5, must-revalidate");
  testSharedCacheMustUseNewRequestHeadersWhenRevalidatingAuthorizedResponse(resp1);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentTypeHeaderToCachedResponseWithNoTransformIfNotPresent() throws Exception {
  originResponse.addHeader("Cache-Control","no-transform");
  testDoesNotAddHeaderOnCacheHit("Content-Type");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testHEADResponseWithUpdatedContentLengthFieldMakeACacheEntryStale() throws Exception {
  testHEADResponseWithUpdatedEntityFieldsMakeACacheEntryStale("Content-Length","128","127");
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ResponseIncludesVariantHeadersIfValueMightDiffer() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.addHeader("Accept-Encoding","gzip");
  final Date now=new Date();
  final Date inOneHour=new Date(now.getTime() + 3600 * 1000L);
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Expires",DateUtils.formatDate(inOneHour));
  originResponse.addHeader("Vary","Accept-Encoding");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("Cache-Control","no-cache");
  req2.addHeader("Accept-Encoding","gzip");
  final Date nextSecond=new Date(now.getTime() + 1000L);
  final Date inTwoHoursPlusASec=new Date(now.getTime() + 2 * 3600 * 1000L + 1000L);
  final HttpResponse originResponse2=HttpTestUtils.make200Response();
  originResponse2.setHeader("Date",DateUtils.formatDate(nextSecond));
  originResponse2.setHeader("Cache-Control","max-age=7200");
  originResponse2.setHeader("Expires",DateUtils.formatDate(inTwoHoursPlusASec));
  originResponse2.setHeader("Vary","Accept-Encoding");
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.addHeader("Range","bytes=0-50");
  req3.addHeader("Accept-Encoding","gzip");
  backendExpectsAnyRequest().andReturn(originResponse);
  backendExpectsAnyRequestAndReturn(originResponse2).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNotNull(result.getFirstHeader("Expires"));
    Assert.assertNotNull(result.getFirstHeader("Cache-Control"));
    Assert.assertNotNull(result.getFirstHeader("Vary"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMustDiscardCachedPartialResponseIfCacheValidatorsDoNotStronglyMatchAndDateHeadersAreEqual() throws Exception {
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("Etag","\"etag1\"");
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("ETag","\"etag2\"");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.setHeader("Range","bytes=0-49");
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-7 type-16 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testNonmatchingVariantCannotBeServedFromCacheUnlessConditionallyValidated() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("User-Agent","MyBrowser/1.0");
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Vary","User-Agent");
  resp1.setHeader("Content-Type","application/octet-stream");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("User-Agent","MyBrowser/1.5");
  final HttpRequestWrapper conditional=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  conditional.setHeader("User-Agent","MyBrowser/1.5");
  conditional.setHeader("If-None-Match","\"etag1\"");
  final HttpResponse resp200=HttpTestUtils.make200Response();
  resp200.setHeader("ETag","\"etag1\"");
  resp200.setHeader("Vary","User-Agent");
  final HttpResponse resp304=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp304.setHeader("ETag","\"etag1\"");
  resp304.setHeader("Vary","User-Agent");
  final Capture<HttpRequestWrapper> condCap=new Capture<>();
  final Capture<HttpRequestWrapper> uncondCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.and(eqRequest(conditional),EasyMock.capture(condCap)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp304)).times(0,1);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.and(eqRequest(req2),EasyMock.capture(uncondCap)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp200)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_OK == result.getStatusLine().getStatusCode()) {
    Assert.assertTrue(condCap.hasCaptured() || uncondCap.hasCaptured());
    if (uncondCap.hasCaptured()) {
      Assert.assertTrue(HttpTestUtils.semanticallyTransparent(resp200,result));
    }
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleContentLanguageHeadersIsPreservedOnResponses() throws Exception {
  originResponse.addHeader("Content-Language","mi");
  originResponse.addHeader("Content-Language","en");
  testOrderOfMultipleHeadersIsPreservedOnResponses("Content-Language");
}

</code></pre>

<pre class="type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testDoesNotAddAMaxForwardsHeaderToForwardedOPTIONSRequests() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("OPTIONS","/",HttpVersion.HTTP_1_1),host);
  final Capture<HttpRequestWrapper> reqCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(reqCap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
  final HttpRequest forwarded=reqCap.getValue();
  Assert.assertNull(forwarded.getFirstHeader("Max-Forwards"));
}

</code></pre>

<pre class="type-7 type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test206ResponseGeneratedFromCacheMustHaveABodyThatMatchesContentLengthHeaderIfPresent() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=0-50");
  backendExpectsAnyRequestAndReturn(resp1).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_PARTIAL_CONTENT == result.getStatusLine().getStatusCode()) {
    final Header h=result.getFirstHeader("Content-Length");
    if (h != null) {
      final int contentLength=Integer.parseInt(h.getValue());
      int bytesRead=0;
      final InputStream i=result.getEntity().getContent();
      while ((i.read()) != -1) {
        bytesRead++;
      }
      i.close();
      Assert.assertEquals(contentLength,bytesRead);
    }
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCannotCombinePartialResponseIfIncomingResponseDoesNotHaveACacheValidator() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final Date twoSecondsAgo=new Date(now.getTime() - 2 * 1000L);
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(twoSecondsAgo));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("ETag","\"etag1\"");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testStaleEntryWithProxyRevalidateOnSharedCacheIsNotUsedWithoutRevalidatingWithOrigin() throws Exception {
  if (config.isSharedCache()) {
    final HttpResponse response=HttpTestUtils.make200Response();
    final Date now=new Date();
    final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
    response.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
    response.setHeader("ETag","\"etag1\"");
    response.setHeader("Cache-Control","max-age=5, proxy-revalidate");
    testStaleCacheResponseMustBeRevalidatedWithOrigin(response);
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testHEADResponseWithUpdatedContentMD5FieldMakeACacheEntryStale() throws Exception {
  testHEADResponseWithUpdatedEntityFieldsMakeACacheEntryStale("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==","Q2hlY2sgSW50ZWdyaXR5IR==");
}

</code></pre>

<pre class="type-16 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMustServeAppropriateErrorOrWarningIfNoOriginCommunicationPossible() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final Date nineSecondsAgo=new Date(now.getTime() - 9 * 1000L);
  final Date eightSecondsAgo=new Date(now.getTime() - 8 * 1000L);
  final Header[] hdrs=new Header[]{new BasicHeader("Date",DateUtils.formatDate(nineSecondsAgo)),new BasicHeader("Cache-Control","max-age=0"),new BasicHeader("Content-Length","128"),new BasicHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo))};
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpCacheEntry entry=HttpTestUtils.makeCacheEntry(tenSecondsAgo,eightSecondsAgo,hdrs,bytes);
  impl=new CachingExec(mockBackend,mockCache,config);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.eq(host),eqRequest(request));
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.eq(host),eqRequest(request))).andReturn(entry);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andThrow(new IOException("can't talk to origin!")).anyTimes();
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final int status=result.getStatusLine().getStatusCode();
  if (status == 200) {
    boolean foundWarning=false;
    for (    final Header h : result.getHeaders("Warning")) {
      if (h.getValue().split(" ")[0].equals("111")) {
        foundWarning=true;
      }
    }
    Assert.assertTrue(foundWarning);
  }
 else {
    Assert.assertTrue(status >= 500 && status <= 599);
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentRangeToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-Range");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testConditionalRequestWhereAllValidatorsMatchMayBeServedFromCache() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","W/\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","W/\"etag\"");
  req2.setHeader("If-Modified-Since",DateUtils.formatDate(tenSecondsAgo));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1)).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesExpiresCacheControlAndOrVaryIfResponseMightDiffer() throws Exception {
  final Date now=new Date();
  final Date inTwoHours=new Date(now.getTime() + 2 * 3600 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Accept-Encoding","gzip");
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"v1\"");
  resp1.setHeader("Cache-Control","max-age=7200");
  resp1.setHeader("Expires",DateUtils.formatDate(inTwoHours));
  resp1.setHeader("Vary","Accept-Encoding");
  resp1.setEntity(HttpTestUtils.makeBody(entityLength));
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Accept-Encoding","gzip");
  req1.setHeader("Cache-Control","no-cache");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"v2\"");
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Expires",DateUtils.formatDate(inTwoHours));
  resp2.setHeader("Vary","Accept-Encoding");
  resp2.setEntity(HttpTestUtils.makeBody(entityLength));
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.setHeader("Accept-Encoding","gzip");
  req3.setHeader("If-None-Match","\"v2\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2)).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("Expires"));
    Assert.assertNotNull(result.getFirstHeader("Cache-Control"));
    Assert.assertNotNull(result.getFirstHeader("Vary"));
  }
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultiHeadersAreSuccessfullyReplacedOn304Validation() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.addHeader("Cache-Control","max-age=3600");
  resp1.addHeader("Cache-Control","public");
  resp1.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-age=0, max-stale=0");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("Cache-Control","max-age=1800");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result1=impl.execute(route,req2,context,null);
  final HttpResponse result2=impl.execute(route,req3,context,null);
  verifyMocks();
  final String h="Cache-Control";
  Assert.assertEquals(HttpTestUtils.getCanonicalHeaderValue(resp2,h),HttpTestUtils.getCanonicalHeaderValue(result1,h));
  Assert.assertEquals(HttpTestUtils.getCanonicalHeaderValue(resp2,h),HttpTestUtils.getCanonicalHeaderValue(result2,h));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentRangeHeaderFromOriginResponseWithNoTransform() throws Exception {
  request.setHeader("If-Range","\"etag\"");
  request.setHeader("Range","bytes=0-49");
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,206,"Partial Content"));
  originResponse.setEntity(HttpTestUtils.makeBody(50));
  testDoesNotModifyHeaderFromOriginResponseWithNoTransform("Content-Range","bytes 0-49/128");
}

</code></pre>

<pre class="type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpiresHeaderMatchesDateIfAddedToOriginResponse() throws Exception {
  originResponse.removeHeaders("Expires");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final Header expHdr=result.getFirstHeader("Expires");
  if (expHdr != null) {
    Assert.assertEquals(result.getFirstHeader("Date").getValue(),expHdr.getValue());
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPUTWithIfMatchWeakETagIsNotAllowed() throws Exception {
  final HttpRequest put=new BasicHttpRequest("PUT","/",HttpVersion.HTTP_1_1);
  put.setEntity(HttpTestUtils.makeBody(128));
  put.setHeader("Content-Length","128");
  put.setHeader("If-Match","W/\"etag\"");
  request=HttpRequestWrapper.wrap(put,host);
  testRequestWithWeakETagValidatorIsNotAllowed("If-Match");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSharedCacheMayCacheAuthorizedResponsesWithSMaxAgeHeader() throws Exception {
  final HttpResponse resp=HttpTestUtils.make200Response();
  resp.setHeader("Cache-Control","s-maxage=3600");
  resp.setHeader("ETag","\"etag\"");
  testSharedCacheRevalidatesAuthorizedResponse(resp,0,1);
}

</code></pre>

<pre class="type-17 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
@Test @Ignore public void testOPTIONSRequestsAreWrittenThroughToOrigin() throws Exception {
  final HttpRequest req=HttpRequestWrapper.wrap(new BasicHttpRequest("OPTIONS","*",HttpVersion.HTTP_1_1),host);
  testRequestIsWrittenThroughToOrigin(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleAcceptLanguageHeadersIsPreservedOnRequests() throws Exception {
  request.addHeader("Accept-Language","da, en-gb;q=0.8, en;q=0.7");
  request.addHeader("Accept-Language","i-cherokee");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Accept-Encoding",request);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCacheIsNotUsedWhenRespondingToRequestWithCacheControlNoCache() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req.setHeader("Cache-Control","no-cache");
  testCacheIsNotUsedWhenRespondingToRequest(req);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRequestsNotExpecting100ContinueBehaviorShouldNotSetExpectContinueHeader() throws Exception {
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",HttpVersion.HTTP_1_1);
  post.setHeader("Content-Length","128");
  post.setEntity(new BasicHttpEntity());
  final Capture<HttpRequestWrapper> reqCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(reqCap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,HttpRequestWrapper.wrap(post,host),context,null);
  verifyMocks();
  final HttpRequestWrapper forwarded=reqCap.getValue();
  boolean foundExpect=false;
  for (  final Header h : forwarded.getHeaders("Expect")) {
    for (    final HeaderElement elt : h.getElements()) {
      if ("100-continue".equalsIgnoreCase(elt.getName())) {
        foundExpect=true;
        break;
      }
    }
  }
  Assert.assertFalse(foundExpect);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPutDoesNotInvalidateCacheForUriInLocationHeadersFromOtherHosts() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("PUT","/");
  testUnsafeMethodDoesNotInvalidateCacheForUriInLocationHeadersFromOtherHosts(req);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMustReturnAFreshEnoughCacheEntryIfItHasIt() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final Date nineSecondsAgo=new Date(now.getTime() - 9 * 1000L);
  final Date eightSecondsAgo=new Date(now.getTime() - 8 * 1000L);
  final Header[] hdrs=new Header[]{new BasicHeader("Date",DateUtils.formatDate(nineSecondsAgo)),new BasicHeader("Cache-Control","max-age=3600"),new BasicHeader("Content-Length","128")};
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpCacheEntry entry=HttpTestUtils.makeCacheEntry(tenSecondsAgo,eightSecondsAgo,hdrs,bytes);
  impl=new CachingExec(mockBackend,mockCache,config);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.eq(host),eqRequest(request));
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.eq(host),eqRequest(request))).andReturn(entry);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(200,result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testHigher1_XProtocolVersionsDowngradeTo1_1() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",new ProtocolVersion("HTTP",1,2)),host);
  final HttpRequestWrapper downgraded=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",HttpVersion.HTTP_1_1),host);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(downgraded),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertTrue(HttpTestUtils.semanticallyTransparent(originResponse,result));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testResponsesToOPTIONSAreNotCacheable() throws Exception {
  emptyMockCacheExpectsNoPuts();
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("OPTIONS","/",HttpVersion.HTTP_1_1),host);
  originResponse.addHeader("Cache-Control","max-age=3600");
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPutDoesNotInvalidateCacheForUriInContentLocationHeadersFromOtherHosts() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("PUT","/");
  testUnsafeMethodDoesNotInvalidateCacheForUriInContentLocationHeadersFromOtherHosts(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNotModifiedOfNonCachedEntityShouldRevalidateWithUnconditionalGET() throws Exception {
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-age=0,max-stale=0");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("ETag","\"etag2\"");
  final HttpRequestWrapper conditionalValidation=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  conditionalValidation.setHeader("If-None-Match","\"etag1\"");
  final HttpRequestWrapper unconditionalValidation=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp3=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag2\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(conditionalValidation),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2)).times(0,1);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(unconditionalValidation),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp3));
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleParametersInContentEncodingHeaderIsPreserved() throws Exception {
  originResponse.addHeader("Content-Encoding","gzip,deflate");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int total_encodings=0;
  for (  final Header hdr : result.getHeaders("Content-Encoding")) {
    for (    final HeaderElement elt : hdr.getElements()) {
switch (total_encodings) {
case 0:
        Assert.assertEquals("gzip",elt.getName());
      break;
case 1:
    Assert.assertEquals("deflate",elt.getName());
  break;
default :
Assert.fail("too many encodings");
}
total_encodings++;
}
}
Assert.assertEquals(2,total_encodings);
}

</code></pre>

<pre class="type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testTransferCodingsAreNotSentToAnHTTP_1_0Client() throws Exception {
  originResponse.setHeader("Transfer-Encoding","identity");
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",new ProtocolVersion("HTTP",1,0)),host);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertNull(result.getFirstHeader("TE"));
  Assert.assertNull(result.getFirstHeader("Transfer-Encoding"));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyLastModifiedFromOriginOnCacheHit() throws Exception {
  final String lm=DateUtils.formatDate(new Date(System.currentTimeMillis() - 10 * 1000L));
  testDoesNotModifyHeaderFromOriginOnCacheHit("Last-Modified",lm);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPutToUriInvalidatesCacheForThatUri() throws Exception {
  final HttpRequest req=makeRequestWithBody("PUT","/");
  testUnsafeOperationInvalidatesCacheForThatUri(HttpRequestWrapper.wrap(req,host));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentMD5ToOriginResponse() throws Exception {
  testDoesNotAddHeaderToOriginResponse("Content-MD5");
}

</code></pre>

<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleContentEncodingHeaderValuesIsPreserved() throws Exception {
  originResponse.addHeader("Content-Encoding","gzip");
  originResponse.addHeader("Content-Encoding","deflate");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int total_encodings=0;
  for (  final Header hdr : result.getHeaders("Content-Encoding")) {
    for (    final HeaderElement elt : hdr.getElements()) {
switch (total_encodings) {
case 0:
        Assert.assertEquals("gzip",elt.getName());
      break;
case 1:
    Assert.assertEquals("deflate",elt.getName());
  break;
default :
Assert.fail("too many encodings");
}
total_encodings++;
}
}
Assert.assertEquals(2,total_encodings);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleWarningHeadersIsPreservedOnRequests() throws Exception {
  request.addHeader("Warning","199 fred \"bargle\"");
  request.addHeader("Warning","199 barney \"bungle\"");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Warning",request);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddETagToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("ETag");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnknownMethodRequestsAreWrittenThroughToOrigin() throws Exception {
  final HttpRequest req=HttpRequestWrapper.wrap(new BasicHttpRequest("UNKNOWN","/",HttpVersion.HTTP_1_1),host);
  testRequestIsWrittenThroughToOrigin(req);
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304GeneratedFromCacheOnWeakValidatorDoesNotIncludeOtherEntityHeaders() throws Exception {
  final Date now=new Date();
  final Date oneHourAgo=new Date(now.getTime() - 3600 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","W/\"v1\"");
  resp1.setHeader("Allow","GET,HEAD");
  resp1.setHeader("Content-Encoding","x-coding");
  resp1.setHeader("Content-Language","en");
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
  resp1.setHeader("Content-Type","application/octet-stream");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(oneHourAgo));
  resp1.setHeader("Cache-Control","max-age=7200");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","W/\"v1\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1)).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNull(result.getFirstHeader("Allow"));
    Assert.assertNull(result.getFirstHeader("Content-Encoding"));
    Assert.assertNull(result.getFirstHeader("Content-Length"));
    Assert.assertNull(result.getFirstHeader("Content-MD5"));
    Assert.assertNull(result.getFirstHeader("Content-Type"));
    Assert.assertNull(result.getFirstHeader("Last-Modified"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testHEADResponseWithUpdatedETagFieldMakeACacheEntryStale() throws Exception {
  testHEADResponseWithUpdatedEntityFieldsMakeACacheEntryStale("ETag","\"etag1\"","\"etag2\"");
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test205ResponsesDoNotContainMessageBodies() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_RESET_CONTENT,"Reset Content"));
  originResponse.setEntity(HttpTestUtils.makeBody(entityLength));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertTrue(result.getEntity() == null || result.getEntity().getContentLength() == 0);
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesContentLocationIfOriginResponseDid() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.setHeader("Content-Location","http://foo.example.com/other");
  originResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("Content-Location"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExpiresHeaderEqualToDateHeaderIsTreatedAsStale() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Cache-Control","public");
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Expires",resp1.getFirstHeader("Date").getValue());
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp2=HttpTestUtils.make200Response();
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test204ResponsesDoNotContainMessageBodies() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NO_CONTENT,"No Content"));
  originResponse.setEntity(HttpTestUtils.makeBody(entityLength));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertTrue(result.getEntity() == null || result.getEntity().getContentLength() == 0);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCacheMissOnGETUsesOriginResponse() throws Exception {
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(request),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertTrue(HttpTestUtils.semanticallyTransparent(originResponse,result));
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testStripsBadlyDatedWarningsFromForwardedResponses() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  originResponse.setHeader("Date",DateUtils.formatDate(now));
  originResponse.addHeader("Warning","110 fred \"stale\", 110 wilma \"stale\" \"" + DateUtils.formatDate(tenSecondsAgo) + "\"");
  originResponse.setHeader("Cache-Control","no-cache,no-store");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  for (  final Header h : result.getHeaders("Warning")) {
    Assert.assertFalse(h.getValue().contains("wilma"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNoStoreOnRequestIsNotStoredInCache() throws Exception {
  emptyMockCacheExpectsNoPuts();
  request.setHeader("Cache-Control","no-store");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testResponsesToDELETEsAreNotCached() throws Exception {
  emptyMockCacheExpectsNoPuts();
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-7 type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testViaHeaderOnRequestProperlyRecordsClientProtocol() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_0),host);
  request.removeHeaders("Via");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
  final HttpRequest captured=cap.getValue();
  final String via=captured.getFirstHeader("Via").getValue();
  final String protocol=via.split("\\s+")[0];
  final String[] protoParts=protocol.split("/");
  if (protoParts.length > 1) {
    Assert.assertTrue("http".equalsIgnoreCase(protoParts[0]));
  }
  Assert.assertEquals("1.0",protoParts[protoParts.length - 1]);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentRangeHeaderToCachedResponseWithNoTransformIfNotPresent() throws Exception {
  originResponse.addHeader("Cache-Control","no-transform");
  testDoesNotAddHeaderOnCacheHit("Content-Range");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleViaHeadersIsPreservedOnRequests() throws Exception {
  request.addHeader("Via","1.0 fred, 1.1 nowhere.com (Apache/1.1)");
  request.addHeader("Via","1.0 ricky, 1.1 mertz, 1.0 lucy");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Via",request);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMustDiscardLeastRecentPartialResponseIfCacheValidatorsDoNotStronglyMatchEvenIfResponsesOutOfOrder() throws Exception {
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final Date twoSecondsAgo=new Date(now.getTime() - 2 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("Etag","\"etag1\"");
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("ETag","\"etag2\"");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(twoSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.setHeader("Range","bytes=50-127");
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTransmitsAgeHeaderIfIncomingAgeHeaderTooBig() throws Exception {
  final String reallyOldAge="1" + Long.MAX_VALUE;
  originResponse.setHeader("Age",reallyOldAge);
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals("2147483648",result.getFirstHeader("Age").getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTRACERequestsAreWrittenThroughToOrigin() throws Exception {
  final HttpRequest req=HttpRequestWrapper.wrap(new BasicHttpRequest("TRACE","/",HttpVersion.HTTP_1_1),host);
  testRequestIsWrittenThroughToOrigin(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMustDiscardLeastRecentPartialResponseIfCacheValidatorsDoNotStronglyMatch() throws Exception {
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final Date twoSecondsAgo=new Date(now.getTime() - 2 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("Etag","\"etag1\"");
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(twoSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("ETag","\"etag2\"");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.setHeader("Range","bytes=0-49");
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-7 type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCacheEntryIsUpdatedWithNewFieldValuesIn304Response() throws Exception {
  final Date now=new Date();
  final Date inFiveSeconds=new Date(now.getTime() + 5000L);
  final HttpRequestWrapper initialRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse cachedResponse=HttpTestUtils.make200Response();
  cachedResponse.setHeader("Cache-Control","max-age=3600");
  cachedResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper secondRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  secondRequest.setHeader("Cache-Control","max-age=0,max-stale=0");
  final HttpRequestWrapper conditionalValidationRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  conditionalValidationRequest.setHeader("If-None-Match","\"etag\"");
  final HttpRequestWrapper unconditionalValidationRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse conditionalResponse=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  conditionalResponse.setHeader("Date",DateUtils.formatDate(inFiveSeconds));
  conditionalResponse.setHeader("Server","MockUtils/1.0");
  conditionalResponse.setHeader("ETag","\"etag\"");
  conditionalResponse.setHeader("X-Extra","junk");
  final HttpResponse unconditionalResponse=HttpTestUtils.make200Response();
  unconditionalResponse.setHeader("Date",DateUtils.formatDate(inFiveSeconds));
  unconditionalResponse.setHeader("ETag","\"etag\"");
  final Capture<HttpRequestWrapper> cap1=new Capture<>();
  final Capture<HttpRequestWrapper> cap2=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(cachedResponse));
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.and(eqRequest(conditionalValidationRequest),EasyMock.capture(cap1)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(conditionalResponse)).times(0,1);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.and(eqRequest(unconditionalValidationRequest),EasyMock.capture(cap2)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(unconditionalResponse)).times(0,1);
  replayMocks();
  impl.execute(route,initialRequest,context,null);
  final HttpResponse result=impl.execute(route,secondRequest,context,null);
  verifyMocks();
  Assert.assertTrue((cap1.hasCaptured() && !cap2.hasCaptured()) || (!cap1.hasCaptured() && cap2.hasCaptured()));
  if (cap1.hasCaptured()) {
    Assert.assertEquals(DateUtils.formatDate(inFiveSeconds),result.getFirstHeader("Date").getValue());
    Assert.assertEquals("junk",result.getFirstHeader("X-Extra").getValue());
  }
}

</code></pre>

<pre class="type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is an empty test case">EmptyTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is an empty test case
"></span><br>
@Test public void testExpectHeadersAreForwardedOnRequests() throws Exception {
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDELETEWithIfNoneMatchWeakETagIsNotAllowed() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/",HttpVersion.HTTP_1_1),host);
  request.setHeader("If-None-Match","W/\"etag\"");
  testRequestWithWeakETagValidatorIsNotAllowed("If-None-Match");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyEtagFromOriginOnCacheHit() throws Exception {
  testDoesNotModifyHeaderFromOriginOnCacheHit("Etag","\"the-etag\"");
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesEtagIfOriginResponseDid() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("ETag"));
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testUpdatesWarningHeadersOnValidation() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final Date now=new Date();
  final Date twentySecondsAgo=new Date(now.getTime() - 20 * 1000L);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(twentySecondsAgo));
  resp1.setHeader("Cache-Control","public,max-age=5");
  resp1.setHeader("ETag","\"etag1\"");
  final String oldWarning="113 wilma \"stale\"";
  resp1.setHeader("Warning",oldWarning);
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp2.setHeader("ETag","\"etag1\"");
  final String newWarning="113 betty \"stale too\"";
  resp2.setHeader("Warning",newWarning);
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  boolean oldWarningFound=false;
  boolean newWarningFound=false;
  for (  final Header h : result.getHeaders("Warning")) {
    for (    final String warnValue : h.getValue().split("\\s*,\\s*")) {
      if (oldWarning.equals(warnValue)) {
        oldWarningFound=true;
      }
 else       if (newWarning.equals(warnValue)) {
        newWarningFound=true;
      }
    }
  }
  Assert.assertFalse(oldWarningFound);
  Assert.assertTrue(newWarningFound);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleAcceptEncodingHeadersIsPreservedOnRequests() throws Exception {
  request.addHeader("Accept-Encoding","identity");
  request.addHeader("Accept-Encoding","compress, gzip");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Accept-Encoding",request);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentTypeToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-Type");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDELETERequestsAreWrittenThroughToOrigin() throws Exception {
  final HttpRequest req=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/",HttpVersion.HTTP_1_1),host);
  testRequestIsWrittenThroughToOrigin(req);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testResponseToAHEADRequestMustNotHaveABody() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("HEAD","/",HttpVersion.HTTP_1_1),host);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertTrue(result.getEntity() == null || result.getEntity().getContentLength() == 0);
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
"></span><br>
@Test public void testCachedResponsesWithMissingDateHeadersShouldBeAssignedOne() throws Exception {
  originResponse.removeHeaders("Date");
  originResponse.setHeader("Cache-Control","public");
  originResponse.setHeader("ETag","\"etag\"");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertNotNull(result.getFirstHeader("Date"));
}

</code></pre>

<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSubrangeGETMustUseStrongComparisonForCachedResponse() throws Exception {
  final Date now=new Date();
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=0-50");
  req2.setHeader("If-Range","W/\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1)).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  Assert.assertFalse(HttpStatus.SC_PARTIAL_CONTENT == result.getStatusLine().getStatusCode());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUnknownHeadersOnRequestsAreForwarded() throws Exception {
  request.addHeader("X-Unknown-Header","blahblah");
  final Capture<HttpRequestWrapper> reqCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.capture(reqCap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
  final HttpRequest forwarded=reqCap.getValue();
  final Header[] hdrs=forwarded.getHeaders("X-Unknown-Header");
  Assert.assertEquals(1,hdrs.length);
  Assert.assertEquals("blahblah",hdrs[0].getValue());
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ContainsContentLocationIfA200ResponseWouldHaveIncludedIt() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Content-Location","http://foo.example.com/other/url");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNotNull(result.getFirstHeader("Content-Location"));
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testResponseToA1_0RequestShouldUse1_1() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",new ProtocolVersion("HTTP",1,0)),host);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(HttpVersion.HTTP_1_1,result.getProtocolVersion());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentEncodingHeaderOnCachedResponseWithNoTransform() throws Exception {
  testDoesNotModifyHeaderOnCachedResponseWithNoTransform("Content-Encoding","gzip");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentLocationHeaderFromOrigin() throws Exception {
  final String url="http://foo.example.com/other";
  testDoesNotModifyHeaderFromOrigin("Content-Location",url);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCacheControlPrivateIsNotCacheableBySharedCache() throws Exception {
  if (config.isSharedCache()) {
    final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    final HttpResponse resp1=HttpTestUtils.make200Response();
    resp1.setHeader("Cache-Control","private,max-age=3600");
    backendExpectsAnyRequestAndReturn(resp1);
    final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    final HttpResponse resp2=HttpTestUtils.make200Response();
    backendExpectsAnyRequestAndReturn(resp2);
    replayMocks();
    impl.execute(route,req1,context,null);
    impl.execute(route,req2,context,null);
    verifyMocks();
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test206ResponseReturnedToClientMustHaveDateHeader() throws Exception {
  request.addHeader("Range","bytes=0-50");
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content"));
  originResponse.setHeader("Date",DateUtils.formatDate(new Date()));
  originResponse.setHeader("Server","MockOrigin/1.0");
  originResponse.setEntity(HttpTestUtils.makeBody(500));
  originResponse.setHeader("Content-Range","bytes 0-499/1234");
  originResponse.removeHeaders("Date");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  Assert.assertTrue(result.getStatusLine().getStatusCode() != HttpStatus.SC_PARTIAL_CONTENT || result.getFirstHeader("Date") != null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPutInvalidatesCacheForThatUriInLocationHeader() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("PUT","/");
  testUnsafeMethodInvalidatesCacheForUriInLocationHeader(req);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRetainsWarningHeadersReceivedFromUpstream() throws Exception {
  originResponse.removeHeaders("Warning");
  final String warning="199 fred \"misc\"";
  originResponse.addHeader("Warning",warning);
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(warning,result.getFirstHeader("Warning").getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNoStoreOnRequestIsNotStoredInCacheEvenIfResponseMarkedCacheable() throws Exception {
  emptyMockCacheExpectsNoPuts();
  request.setHeader("Cache-Control","no-store");
  originResponse.setHeader("Cache-Control","max-age=3600");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ResponseToConditionalRangeRequestDoesNotIncludeOtherEntityHeaders() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final Date now=new Date();
  final Date oneHourAgo=new Date(now.getTime() - 3600 * 1000L);
  originResponse=Proxies.enhanceResponse(HttpTestUtils.make200Response());
  originResponse.addHeader("Allow","GET,HEAD");
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Content-Language","en");
  originResponse.addHeader("Content-Encoding","x-coding");
  originResponse.addHeader("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
  originResponse.addHeader("Content-Length","128");
  originResponse.addHeader("Content-Type","application/octet-stream");
  originResponse.addHeader("Last-Modified",DateUtils.formatDate(oneHourAgo));
  originResponse.addHeader("ETag","W/\"weak-tag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("If-Range","W/\"weak-tag\"");
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNull(result.getFirstHeader("Allow"));
    Assert.assertNull(result.getFirstHeader("Content-Encoding"));
    Assert.assertNull(result.getFirstHeader("Content-Language"));
    Assert.assertNull(result.getFirstHeader("Content-MD5"));
    Assert.assertNull(result.getFirstHeader("Last-Modified"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPostToUriInvalidatesCacheForThatUri() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("POST","/");
  testUnsafeOperationInvalidatesCacheForThatUri(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleExpectHeadersIsPreservedOnRequests() throws Exception {
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",HttpVersion.HTTP_1_1);
  post.setEntity(body);
  post.addHeader("Expect","100-continue");
  post.addHeader("Expect","x-expect=true");
  post.addHeader("Content-Length","128");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Expect",HttpRequestWrapper.wrap(post,host));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testResponsesToPUTsAreNotCached() throws Exception {
  emptyMockCacheExpectsNoPuts();
  final BasicHttpRequest put=new BasicHttpRequest("PUT","/",HttpVersion.HTTP_1_1);
  put.setEntity(HttpTestUtils.makeBody(128));
  put.addHeader("Content-Length","128");
  originResponse.setHeader("Cache-Control","max-age=3600");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,HttpRequestWrapper.wrap(put,host),context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMalformedExpiresHeaderIsTreatedAsStale() throws Exception {
  testInvalidExpiresHeaderIsTreatedAsStale("garbage");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPostDoesNotInvalidateCacheForUriInLocationHeadersFromOtherHosts() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("POST","/");
  testUnsafeMethodDoesNotInvalidateCacheForUriInLocationHeadersFromOtherHosts(req);
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseWithDateHeaderForwardedFromOriginIncludesDateHeader() throws Exception {
  request.setHeader("If-None-Match","\"etag\"");
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified"));
  originResponse.setHeader("Date",DateUtils.formatDate(new Date()));
  originResponse.setHeader("Server","MockServer/1.0");
  originResponse.setHeader("ETag","\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertNotNull(result.getFirstHeader("Date"));
}

</code></pre>

<pre class="type-7 type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpiresHeaderMatchesDateIfAddedToCacheHit() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.removeHeaders("Expires");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  final Header expHdr=result.getFirstHeader("Expires");
  if (expHdr != null) {
    Assert.assertEquals(result.getFirstHeader("Date").getValue(),expHdr.getValue());
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddETagHeaderOnCacheHit() throws Exception {
  testDoesNotAddHeaderOnCacheHit("ETag");
}

</code></pre>

<pre class="type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWarnDatesAreAddedToWarningsOnLowerProtocolVersions() throws Exception {
  final String dateHdr=DateUtils.formatDate(new Date());
  final String origWarning="110 fred \"stale\"";
  originResponse.setStatusLine(HttpVersion.HTTP_1_0,HttpStatus.SC_OK);
  originResponse.addHeader("Warning",origWarning);
  originResponse.setHeader("Date",dateHdr);
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  if (HttpVersion.HTTP_1_0.greaterEquals(result.getProtocolVersion())) {
    Assert.assertEquals(dateHdr,result.getFirstHeader("Date").getValue());
    boolean warningFound=false;
    final String targetWarning=origWarning + " \"" + dateHdr+ "\"";
    for (    final Header h : result.getHeaders("Warning")) {
      for (      final String warning : h.getValue().split("\\s*,\\s*")) {
        if (targetWarning.equals(warning)) {
          warningFound=true;
          break;
        }
      }
    }
    Assert.assertTrue(warningFound);
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testProperlyFormattedViaHeaderIsAddedToRequests() throws Exception {
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  request.removeHeaders("Via");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
  final HttpRequest captured=cap.getValue();
  final String via=captured.getFirstHeader("Via").getValue();
  assertValidViaHeader(via);
}

</code></pre>

<pre class="type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testForwardedTRACERequestsDoNotIncludeAnEntity() throws Exception {
  final BasicHttpRequest trace=new BasicHttpRequest("TRACE","/",HttpVersion.HTTP_1_1);
  trace.setEntity(HttpTestUtils.makeBody(entityLength));
  trace.setHeader("Content-Length",Integer.toString(entityLength));
  final Capture<HttpRequestWrapper> reqCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(reqCap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,HttpRequestWrapper.wrap(trace,host),context,null);
  verifyMocks();
  final HttpRequest bodyReq=reqCap.getValue();
  Assert.assertTrue(bodyReq.getEntity() == null || bodyReq.getEntity().getContentLength() == 0);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentMD5ToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-MD5");
}

</code></pre>

<pre class="type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRemovesWarningHeaderIfAllWarnValuesAreBadlyDated() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  originResponse.setHeader("Date",DateUtils.formatDate(now));
  originResponse.addHeader("Warning","110 wilma \"stale\" \"" + DateUtils.formatDate(tenSecondsAgo) + "\"");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final Header[] warningHeaders=result.getHeaders("Warning");
  Assert.assertTrue(warningHeaders == null || warningHeaders.length == 0);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMustDiscardLeastRecentPartialResponseIfIncomingRequestDoesNotHaveCacheValidator() throws Exception {
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final Date twoSecondsAgo=new Date(now.getTime() - 2 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(twoSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.setHeader("Range","bytes=0-49");
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testProperlyFormattedViaHeaderIsAddedToResponses() throws Exception {
  originResponse.removeHeaders("Via");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  assertValidViaHeader(result.getFirstHeader("Via").getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCacheWithoutSupportForRangeAndContentRangeHeadersDoesNotCacheA206Response() throws Exception {
  if (!supportsRangeAndContentRangeHeaders(impl)) {
    emptyMockCacheExpectsNoPuts();
    final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    req.setHeader("Range","bytes=0-50");
    final HttpResponse resp=new BasicHttpResponse(HttpVersion.HTTP_1_1,206,"Partial Content");
    resp.setHeader("Content-Range","bytes 0-50/128");
    resp.setHeader("ETag","\"etag\"");
    resp.setHeader("Cache-Control","max-age=3600");
    EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp));
    replayMocks();
    impl.execute(route,req,context,null);
    verifyMocks();
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentLocationHeaderOnCacheHit() throws Exception {
  testDoesNotAddHeaderOnCacheHit("Content-Location");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNoStoreOnResponseIsNotStoredInCacheEvenWithContraryIndicators() throws Exception {
  emptyMockCacheExpectsNoPuts();
  originResponse.setHeader("Cache-Control","no-store,max-age=3600");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentLocationToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-Location");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSharedCacheMayCacheAuthorizedResponsesWithCacheControlPublic() throws Exception {
  final HttpResponse resp=HttpTestUtils.make200Response();
  resp.setHeader("Cache-Control","public");
  testSharedCacheRevalidatesAuthorizedResponse(resp,0,1);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleAcceptCharsetHeadersIsPreservedOnRequests() throws Exception {
  request.addHeader("Accept-Charset","iso-8859-5");
  request.addHeader("Accept-Charset","unicode-1-1;q=0.8");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Accept-Charset",request);
}

</code></pre>

<pre class="type-7 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test2xxWarningsAreNotDeletedAfterSuccessfulRevalidation() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=5");
  resp1.setHeader("Via","1.1 xproxy");
  resp1.setHeader("Warning","214 xproxy \"transformed stuff\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpRequestWrapper validate=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  validate.setHeader("If-None-Match","\"etag\"");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("Date",DateUtils.formatDate(now));
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("ETag","\"etag\"");
  resp1.setHeader("Via","1.1 xproxy");
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  backendExpectsAnyRequestAndReturn(resp1);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(validate),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2));
  replayMocks();
  final HttpResponse stale=impl.execute(route,req1,context,null);
  Assert.assertNotNull(stale.getFirstHeader("Warning"));
  final HttpResponse result1=impl.execute(route,req2,context,null);
  final HttpResponse result2=impl.execute(route,req3,context,null);
  verifyMocks();
  boolean found214Warning=false;
  for (  final Header h : result1.getHeaders("Warning")) {
    for (    final HeaderElement elt : h.getElements()) {
      final String[] parts=elt.getName().split(" ");
      if ("214".equals(parts[0])) {
        found214Warning=true;
      }
    }
  }
  Assert.assertTrue(found214Warning);
  found214Warning=false;
  for (  final Header h : result2.getHeaders("Warning")) {
    for (    final HeaderElement elt : h.getElements()) {
      final String[] parts=elt.getName().split(" ");
      if ("214".equals(parts[0])) {
        found214Warning=true;
      }
    }
  }
  Assert.assertTrue(found214Warning);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteInvalidatesCacheForThatUriInContentLocationHeader() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/"),host);
  testUnsafeMethodInvalidatesCacheForUriInContentLocationHeader(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleAllowHeadersIsPreservedOnResponses() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,405,"Method Not Allowed"));
  originResponse.addHeader("Allow","HEAD");
  originResponse.addHeader("Allow","DELETE");
  testOrderOfMultipleHeadersIsPreservedOnResponses("Allow");
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testStripsBadlyDatedWarningsFromStoredResponses() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  originResponse.setHeader("Date",DateUtils.formatDate(now));
  originResponse.addHeader("Warning","110 fred \"stale\", 110 wilma \"stale\" \"" + DateUtils.formatDate(tenSecondsAgo) + "\"");
  originResponse.setHeader("Cache-Control","public,max-age=3600");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  for (  final Header h : result.getHeaders("Warning")) {
    Assert.assertFalse(h.getValue().contains("wilma"));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPUTRequestsAreWrittenThroughToOrigin() throws Exception {
  final HttpRequest req=new BasicHttpRequest("PUT","/",HttpVersion.HTTP_1_1);
  req.setEntity(HttpTestUtils.makeBody(128));
  req.setHeader("Content-Length","128");
  testRequestIsWrittenThroughToOrigin(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentTypeHeaderFromOriginResponseWithNoTransform() throws Exception {
  testDoesNotModifyHeaderFromOriginResponseWithNoTransform("Content-Type","text/html;charset=utf-8");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCacheIsNotUsedWhenRespondingToRequestWithPragmaNoCache() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req.setHeader("Pragma","no-cache");
  testCacheIsNotUsedWhenRespondingToRequest(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotForwardOPTIONSWhenMaxForwardsIsZeroOnAbsoluteURIRequest() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("OPTIONS","*",HttpVersion.HTTP_1_1),host);
  request.setHeader("Max-Forwards","0");
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleContentEncodingHeadersIsPreservedOnResponses() throws Exception {
  originResponse.addHeader("Content-Encoding","gzip");
  originResponse.addHeader("Content-Encoding","compress");
  testOrderOfMultipleHeadersIsPreservedOnResponses("Content-Encoding");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddLastModifiedToOriginResponse() throws Exception {
  testDoesNotAddHeaderToOriginResponse("Last-Modified");
}

</code></pre>

<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesDateHeader() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("Date"));
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoesNotModifyServerResponseHeader() throws Exception {
  final String server="MockServer/1.0";
  originResponse.setHeader("Server",server);
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(server,result.getFirstHeader("Server").getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteToUriInvalidatesCacheForThatUri() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/"),host);
  testUnsafeOperationInvalidatesCacheForThatUri(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentEncodingHeaderFromOriginResponseWithNoTransform() throws Exception {
  testDoesNotModifyHeaderFromOriginResponseWithNoTransform("Content-Encoding","gzip");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyEtagHeaderFromOrigin() throws Exception {
  testDoesNotModifyHeaderFromOrigin("Etag","\"the-etag\"");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPostDoesNotInvalidateCacheForUriInContentLocationHeadersFromOtherHosts() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("POST","/");
  testUnsafeMethodDoesNotInvalidateCacheForUriInContentLocationHeadersFromOtherHosts(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCannotCombinePartialResponseIfCacheEntryDoesNotHaveACacheValidator() throws Exception {
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final Date twoSecondsAgo=new Date(now.getTime() - 2 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(twoSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("ETag","\"etag1\"");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCannotServeFromCacheForVaryStar() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Vary","*");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"etag1\"");
  resp2.setHeader("Cache-Control","max-age=3600");
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentRangeHeaderToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Content-Range");
}

</code></pre>

<pre class="type-7 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testResponseIncludesCacheEntryEndToEndHeadersForResponseAfter304Validation() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("ETag","\"etag\"");
  decorateWithEndToEndHeaders(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-age=0, max-stale=0");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp2.setHeader("Date",DateUtils.formatDate(new Date()));
  resp2.setHeader("Server","MockServer/1.0");
  backendExpectsAnyRequestAndReturn(resp1);
  backendExpectsAnyRequestAndReturn(resp2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  final String[] endToEndHeaders={"Cache-Control","ETag","Allow","Content-Encoding","Content-Language","Content-Length","Content-Location","Content-MD5","Content-Type","Expires","Last-Modified","Location","Pragma","Retry-After"};
  for (  final String h : endToEndHeaders) {
    Assert.assertEquals(HttpTestUtils.getCanonicalHeaderValue(resp1,h),HttpTestUtils.getCanonicalHeaderValue(result,h));
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPostInvalidatesCacheForThatUriInContentLocationHeader() throws Exception {
  final HttpRequestWrapper req=makeRequestWithBody("POST","/");
  testUnsafeMethodInvalidatesCacheForUriInContentLocationHeader(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentTypeHeaderToOriginResponseWithNoTransformIfNotPresent() throws Exception {
  originResponse.addHeader("Cache-Control","no-transform");
  testDoesNotAddHeaderToOriginResponse("Content-Type");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentMD5HeaderOnCacheHit() throws Exception {
  testDoesNotAddHeaderOnCacheHit("Content-MD5");
}

</code></pre>

<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testMustNotAddMultipartByteRangeContentTypeTo416Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,416,"Requested Range Not Satisfiable"));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == 416) {
    for (    final Header h : result.getHeaders("Content-Type")) {
      for (      final HeaderElement elt : h.getElements()) {
        Assert.assertFalse("multipart/byteranges".equalsIgnoreCase(elt.getName()));
      }
    }
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyContentMD5HeaderFromOrigin() throws Exception {
  testDoesNotModifyHeaderFromOrigin("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRequestsExpecting100ContinueBehaviorShouldSetExpectHeader() throws Exception {
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",HttpVersion.HTTP_1_1);
  post.setHeader(HttpHeaders.EXPECT,HeaderElements.CONTINUE);
  post.setHeader("Content-Length","128");
  post.setEntity(new BasicHttpEntity());
  final Capture<HttpRequestWrapper> reqCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(reqCap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,HttpRequestWrapper.wrap(post,host),context,null);
  verifyMocks();
  final HttpRequestWrapper forwarded=reqCap.getValue();
  boolean foundExpect=false;
  for (  final Header h : forwarded.getHeaders("Expect")) {
    for (    final HeaderElement elt : h.getElements()) {
      if ("100-continue".equalsIgnoreCase(elt.getName())) {
        foundExpect=true;
        break;
      }
    }
  }
  Assert.assertTrue(foundExpect);
}

</code></pre>

<pre class="type-7 type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test206ResponseToIfRangeWithStrongValidatorReturnsAllEntityHeaders() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final Date now=new Date();
  final Date oneHourAgo=new Date(now.getTime() - 3600 * 1000L);
  originResponse.addHeader("Allow","GET,HEAD");
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Content-Language","en");
  originResponse.addHeader("Content-Encoding","x-coding");
  originResponse.addHeader("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
  originResponse.addHeader("Content-Length","128");
  originResponse.addHeader("Content-Type","application/octet-stream");
  originResponse.addHeader("Last-Modified",DateUtils.formatDate(oneHourAgo));
  originResponse.addHeader("ETag","\"strong-tag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("If-Range","\"strong-tag\"");
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertEquals("GET,HEAD",result.getFirstHeader("Allow").getValue());
    Assert.assertEquals("max-age=3600",result.getFirstHeader("Cache-Control").getValue());
    Assert.assertEquals("en",result.getFirstHeader("Content-Language").getValue());
    Assert.assertEquals("x-coding",result.getFirstHeader("Content-Encoding").getValue());
    Assert.assertEquals("Q2hlY2sgSW50ZWdyaXR5IQ==",result.getFirstHeader("Content-MD5").getValue());
    Assert.assertEquals(originResponse.getFirstHeader("Last-Modified").getValue(),result.getFirstHeader("Last-Modified").getValue());
  }
}

</code></pre>

<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testValidationMustUseETagIfProvidedByOriginServer() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","W/\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-age=0,max-stale=0");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
  final HttpRequest validation=cap.getValue();
  boolean isConditional=false;
  final String[] conditionalHeaders={"If-Range","If-Modified-Since","If-Unmodified-Since","If-Match","If-None-Match"};
  for (  final String ch : conditionalHeaders) {
    if (validation.getFirstHeader(ch) != null) {
      isConditional=true;
      break;
    }
  }
  if (isConditional) {
    boolean foundETag=false;
    for (    final Header h : validation.getHeaders("If-Match")) {
      for (      final HeaderElement elt : h.getElements()) {
        if ("W/\"etag\"".equals(elt.getName())) {
          foundETag=true;
        }
      }
    }
    for (    final Header h : validation.getHeaders("If-None-Match")) {
      for (      final HeaderElement elt : h.getElements()) {
        if ("W/\"etag\"".equals(elt.getName())) {
          foundETag=true;
        }
      }
    }
    Assert.assertTrue(foundETag);
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testStaleEntryWithMustRevalidateIsNotUsedWithoutRevalidatingWithOrigin() throws Exception {
  final HttpResponse response=HttpTestUtils.make200Response();
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  response.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  response.setHeader("ETag","\"etag1\"");
  response.setHeader("Cache-Control","max-age=5, must-revalidate");
  testStaleCacheResponseMustBeRevalidatedWithOrigin(response);
}

</code></pre>

<pre class="type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is an empty test case">EmptyTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is an empty test case
"></span><br>
@Test public void testAttachesWarningHeaderWhenGeneratingStaleResponse() throws Exception {
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testVaryStarIsNotGeneratedByProxy() throws Exception {
  request.setHeader("User-Agent","my-agent/1.0");
  originResponse.setHeader("Cache-Control","public, max-age=3600");
  originResponse.setHeader("Vary","User-Agent");
  originResponse.setHeader("ETag","\"etag\"");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  for (  final Header h : result.getHeaders("Vary")) {
    for (    final HeaderElement elt : h.getElements()) {
      Assert.assertFalse("*".equals(elt.getName()));
    }
  }
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteInvalidatesCacheForThatUriInLocationHeader() throws Exception {
  final HttpRequestWrapper req=HttpRequestWrapper.wrap(new BasicHttpRequest("DELETE","/"),host);
  testUnsafeMethodInvalidatesCacheForUriInLocationHeader(req);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddContentRangeHeaderToOriginResponseWithNoTransformIfNotPresent() throws Exception {
  originResponse.addHeader("Cache-Control","no-transform");
  testDoesNotAddHeaderToOriginResponse("Content-Range");
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotModifyExpiresHeaderFromOrigin() throws Exception {
  final long inTenSeconds=System.currentTimeMillis() + 10 * 1000L;
  final String expires=DateUtils.formatDate(new Date(inTenSeconds));
  testDoesNotModifyHeaderFromOrigin("Expires",expires);
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMustDiscardLeastRecentPartialResponseIfCachedResponseDoesNotHaveCacheValidator() throws Exception {
  final Date now=new Date();
  final Date oneSecondAgo=new Date(now.getTime() - 1 * 1000L);
  final Date twoSecondsAgo=new Date(now.getTime() - 2 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Range","bytes=0-49");
  final HttpResponse resp1=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp1.setEntity(HttpTestUtils.makeBody(50));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Content-Range","bytes 0-49/128");
  resp1.setHeader("Server","MockServer/1.0");
  resp1.setHeader("Date",DateUtils.formatDate(twoSecondsAgo));
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=50-127");
  final HttpResponse resp2=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_PARTIAL_CONTENT,"Partial Content");
  resp2.setEntity(HttpTestUtils.makeBody(78));
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Content-Range","bytes 50-127/128");
  resp2.setHeader("ETag","\"etag1\"");
  resp2.setHeader("Server","MockServer/1.0");
  resp2.setHeader("Date",DateUtils.formatDate(oneSecondAgo));
  backendExpectsAnyRequestAndReturn(resp2);
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.setHeader("Range","bytes=0-49");
  final HttpResponse resp3=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  resp3.setEntity(HttpTestUtils.makeBody(128));
  resp3.setHeader("Server","MockServer/1.0");
  resp3.setHeader("Date",DateUtils.formatDate(now));
  backendExpectsAnyRequestAndReturn(resp3);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  impl.execute(route,req3,context,null);
  verifyMocks();
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleAllowHeadersIsPreservedOnRequests() throws Exception {
  final BasicHttpRequest put=new BasicHttpRequest("PUT","/",HttpVersion.HTTP_1_1);
  put.setEntity(body);
  put.addHeader("Allow","GET, HEAD");
  put.addHeader("Allow","DELETE");
  put.addHeader("Content-Length","128");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Allow",HttpRequestWrapper.wrap(put,host));
}

</code></pre>

<pre class="type-7 type-16 type-2 type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test206ResponseGeneratedFromCacheMustHaveContentRangeOrMultipartByteRangesContentType() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=0-50");
  backendExpectsAnyRequestAndReturn(resp1).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_PARTIAL_CONTENT == result.getStatusLine().getStatusCode()) {
    if (result.getFirstHeader("Content-Range") == null) {
      final HeaderElement elt=result.getFirstHeader("Content-Type").getElements()[0];
      Assert.assertTrue("multipart/byteranges".equalsIgnoreCase(elt.getName()));
      Assert.assertNotNull(elt.getParameterByName("boundary"));
      Assert.assertNotNull(elt.getParameterByName("boundary").getValue());
      Assert.assertFalse("".equals(elt.getParameterByName("boundary").getValue().trim()));
    }
  }
}

</code></pre>

<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testMustNotUseMultipartByteRangeContentTypeOnCacheGenerated416Responses() throws Exception {
  originResponse.setEntity(HttpTestUtils.makeBody(entityLength));
  originResponse.setHeader("Content-Length","128");
  originResponse.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper rangeReq=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  rangeReq.setHeader("Range","bytes=1000-1200");
  final HttpResponse orig416=new BasicHttpResponse(HttpVersion.HTTP_1_1,416,"Requested Range Not Satisfiable");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(orig416)).times(0,1);
  replayMocks();
  impl.execute(route,request,context,null);
  final HttpResponse result=impl.execute(route,rangeReq,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == 416) {
    for (    final Header h : result.getHeaders("Content-Type")) {
      for (      final HeaderElement elt : h.getElements()) {
        Assert.assertFalse("multipart/byteranges".equalsIgnoreCase(elt.getName()));
      }
    }
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRequestsWithLowerProtocolVersionsGetUpgradedTo1_1() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",new ProtocolVersion("HTTP",1,0)),host);
  final HttpRequestWrapper upgraded=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/foo",HttpVersion.HTTP_1_1),host);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),eqRequest(upgraded),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertTrue(HttpTestUtils.semanticallyTransparent(originResponse,result));
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOrderOfMultipleContentLanguageHeadersIsPreservedOnRequests() throws Exception {
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",HttpVersion.HTTP_1_1);
  post.setEntity(body);
  post.addHeader("Content-Language","mi");
  post.addHeader("Content-Language","en");
  post.addHeader("Content-Length","128");
  testOrderOfMultipleHeadersIsPreservedOnRequests("Content-Language",HttpRequestWrapper.wrap(post,host));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUnknownHeadersOnResponsesAreForwarded() throws Exception {
  originResponse.addHeader("X-Unknown-Header","blahblah");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final Header[] hdrs=result.getHeaders("X-Unknown-Header");
  Assert.assertEquals(1,hdrs.length);
  Assert.assertEquals("blahblah",hdrs[0].getValue());
}

</code></pre>

<pre class="type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDoesNotAddLastModifiedToRequestIfNotPresent() throws Exception {
  testDoesNotAddHeaderToRequestIfNotPresent("Last-Modified");
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
