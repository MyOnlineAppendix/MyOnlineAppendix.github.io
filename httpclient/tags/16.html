<h3><span class=" glyphicon glyphicon-tag"/>&nbspBranchVerifier</h3><kbd>Verifies assertions inside branch conditions</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.hc.client5.http.impl.cache.TestBasicHttpCache </h4><pre class="type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncompleteResponseErrorProvidesNonEmptyErrorMessage() throws Exception {
  final HttpResponse resp=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_OK,"OK");
  final byte[] bytes=HttpTestUtils.getRandomBytes(128);
  final Resource resource=new HeapResource(bytes);
  resp.setEntity(new ByteArrayEntity(bytes));
  resp.setHeader("Content-Length","256");
  final HttpResponse result=impl.generateIncompleteResponseError(resp,resource);
  final int clen=Integer.parseInt(result.getFirstHeader("Content-Length").getValue());
  assertTrue(clen > 0);
  final HttpEntity body=result.getEntity();
  if (body.getContentLength() < 0) {
    final InputStream is=body.getContent();
    int bytes_read=0;
    while ((is.read()) != -1) {
      bytes_read++;
    }
    is.close();
    assertEquals(clen,bytes_read);
  }
 else {
    assertTrue(body.getContentLength() == clen);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hc.client5.http.impl.cache.TestCachingExecChain </h4><pre class="type-16 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testSetsRequestInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  impl.execute(route,request,ctx,null);
  if (!HttpTestUtils.equivalent(request,ctx.getRequest())) {
    assertSame(request,ctx.getRequest());
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testSetsResponseInContextOnCacheHit() throws Exception {
  final DummyBackend backend=new DummyBackend();
  final HttpResponse response=HttpTestUtils.make200Response();
  response.setHeader("Cache-Control","max-age=3600");
  backend.setResponse(response);
  impl=createCachingExecChain(backend,new BasicHttpCache(),CacheConfig.DEFAULT);
  final HttpClientContext ctx=HttpClientContext.create();
  ctx.setTargetHost(host);
  impl.execute(route,request,context,null);
  final HttpResponse result=impl.execute(route,request,ctx,null);
  if (!HttpTestUtils.equivalent(result,ctx.getResponse())) {
    assertSame(result,ctx.getResponse());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hc.client5.http.impl.cache.TestProtocolDeviations </h4><pre class="type-7 type-16 type-2 type-4 type-6 type-17 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore public void testHTTP1_1RequestsWithUnknownBodyLengthAreRejectedOrHaveContentLengthAdded() throws Exception {
  final BasicHttpRequest post=new BasicHttpRequest("POST","/",HTTP_1_1);
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpEntity mockBody=org.easymock.classextension.EasyMock.createMockBuilder(ByteArrayEntity.class).withConstructor(new Object[]{bytes}).addMockedMethods("getContentLength").createNiceMock();
  org.easymock.EasyMock.expect(mockBody.getContentLength()).andReturn(-1L).anyTimes();
  post.setEntity(mockBody);
  final Capture<HttpRequestWrapper> reqCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(reqCap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(0,1);
  replayMocks();
  EasyMock.replay(mockBody);
  final HttpResponse result=impl.execute(route,HttpRequestWrapper.wrap(post,host),context,null);
  verifyMocks();
  EasyMock.verify(mockBody);
  if (reqCap.hasCaptured()) {
    final HttpRequest forwarded=reqCap.getValue();
    Assert.assertNotNull(forwarded.getFirstHeader("Content-Length"));
  }
 else {
    final int status=result.getStatusLine().getStatusCode();
    Assert.assertTrue(HttpStatus.SC_LENGTH_REQUIRED == status || HttpStatus.SC_BAD_REQUEST == status);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hc.client5.http.impl.cache.TestProtocolRequirements </h4><pre class="type-7 type-16 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies whether objects are null
"></span><br>
@Test public void testCacheControlPrivateOnFieldIsNotReturnedBySharedCache() throws Exception {
  if (config.isSharedCache()) {
    final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    final HttpResponse resp1=HttpTestUtils.make200Response();
    resp1.setHeader("X-Personal","stuff");
    resp1.setHeader("Cache-Control","private=\"X-Personal\",s-maxage=3600");
    backendExpectsAnyRequestAndReturn(resp1);
    final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
    final HttpResponse resp2=HttpTestUtils.make200Response();
    backendExpectsAnyRequestAndReturn(resp2).times(0,1);
    replayMocks();
    impl.execute(route,req1,context,null);
    final HttpResponse result=impl.execute(route,req2,context,null);
    verifyMocks();
    Assert.assertNull(result.getFirstHeader("X-Personal"));
  }
}

</code></pre>

<br>
<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testMustIncludeAllowHeaderFromAnOrigin405Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,405,"Method Not Allowed"));
  originResponse.setHeader("Allow","GET, HEAD");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  if (result.getStatusLine().getStatusCode() == 405) {
    Assert.assertNotNull(result.getFirstHeader("Allow"));
  }
  verifyMocks();
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ContainsETagIfA200ResponseWouldHaveIncludedIt() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("ETag","\"etag1\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNotNull(result.getFirstHeader("ETag"));
  }
}

</code></pre>

<br>
<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleTransferEncodingHeadersIsPreserved() throws Exception {
  originResponse.addHeader("Transfer-Encoding","chunked");
  originResponse.addHeader("Transfer-Encoding","x-transfer");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int transfer_encodings=0;
  for (  final Header h : result.getHeaders("Transfer-Encoding")) {
    for (    final HeaderElement elt : h.getElements()) {
switch (transfer_encodings) {
case 0:
        Assert.assertEquals("chunked",elt.getName());
      break;
case 1:
    Assert.assertEquals("x-transfer",elt.getName());
  break;
default :
Assert.fail("too many transfer encodings");
}
transfer_encodings++;
}
}
Assert.assertEquals(2,transfer_encodings);
}

</code></pre>

<br>
<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testWarning110IsAddedToStaleResponses() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("Cache-Control","max-age=5");
  resp1.setHeader("Etag","\"etag\"");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-stale=60");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (!cap.hasCaptured()) {
    boolean found110Warning=false;
    for (    final Header h : result.getHeaders("Warning")) {
      for (      final HeaderElement elt : h.getElements()) {
        final String[] parts=elt.getName().split("\\s");
        if ("110".equals(parts[0])) {
          found110Warning=true;
          break;
        }
      }
    }
    Assert.assertTrue(found110Warning);
  }
}

</code></pre>

<br>
<pre class="type-16 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testIncompleteResponseMustNotBeReturnedToClientWithoutMarkingItAs206() throws Exception {
  originResponse.setEntity(HttpTestUtils.makeBody(128));
  originResponse.setHeader("Content-Length","256");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final int status=result.getStatusLine().getStatusCode();
  Assert.assertFalse(HttpStatus.SC_OK == status);
  if (status > 200 && status <= 299 && HttpTestUtils.equivalent(originResponse.getEntity(),result.getEntity())) {
    Assert.assertTrue(HttpStatus.SC_PARTIAL_CONTENT == status);
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ResponseGeneratedFromCacheMustHaveDateHeader() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=0-50");
  backendExpectsAnyRequestAndReturn(resp1).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_PARTIAL_CONTENT == result.getStatusLine().getStatusCode()) {
    Assert.assertNotNull(result.getFirstHeader("Date"));
  }
}

</code></pre>

<br>
<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleTransferEncodingsInSingleHeadersIsPreserved() throws Exception {
  originResponse.addHeader("Transfer-Encoding","chunked, x-transfer");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int transfer_encodings=0;
  for (  final Header h : result.getHeaders("Transfer-Encoding")) {
    for (    final HeaderElement elt : h.getElements()) {
switch (transfer_encodings) {
case 0:
        Assert.assertEquals("chunked",elt.getName());
      break;
case 1:
    Assert.assertEquals("x-transfer",elt.getName());
  break;
default :
Assert.fail("too many transfer encodings");
}
transfer_encodings++;
}
}
Assert.assertEquals(2,transfer_encodings);
}

</code></pre>

<br>
<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testMustIncludeProxyAuthenticateHeaderFromAnOrigin407Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,407,"Proxy Authentication Required"));
  originResponse.setHeader("Proxy-Authenticate","x-scheme x-param");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  if (result.getStatusLine().getStatusCode() == 407) {
    Assert.assertNotNull(result.getFirstHeader("Proxy-Authenticate"));
  }
  verifyMocks();
}

</code></pre>

<br>
<pre class="type-7 type-16 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies whether objects are null
"></span><br>
@Test public void testNoCacheOnFieldIsNotReturnedWithoutRevalidation() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("X-Stuff","things");
  resp1.setHeader("Cache-Control","no-cache=\"X-Stuff\", max-age=3600");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"etag\"");
  resp2.setHeader("X-Stuff","things");
  resp2.setHeader("Cache-Control","no-cache=\"X-Stuff\",max-age=3600");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (!cap.hasCaptured()) {
    Assert.assertNull(result.getFirstHeader("X-Stuff"));
  }
}

</code></pre>

<br>
<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testMustIncludeWWWAuthenticateHeaderOnAnOrigin401Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,401,"Unauthorized"));
  originResponse.setHeader("WWW-Authenticate","x-scheme x-param");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  if (result.getStatusLine().getStatusCode() == 401) {
    Assert.assertNotNull(result.getFirstHeader("WWW-Authenticate"));
  }
  verifyMocks();
}

</code></pre>

<br>
<pre class="type-16 type-2 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHeuristicCacheOlderThan24HoursHasWarningAttached() throws Exception {
  final Date now=new Date();
  final Date thirtySixHoursAgo=new Date(now.getTime() - 36 * 3600 * 1000L);
  final Date oneYearAgo=new Date(now.getTime() - 365 * 24 * 3600* 1000L);
  final Date requestTime=new Date(thirtySixHoursAgo.getTime() - 1000L);
  final Date responseTime=new Date(thirtySixHoursAgo.getTime() + 1000L);
  final Header[] hdrs=new Header[]{new BasicHeader("Date",DateUtils.formatDate(thirtySixHoursAgo)),new BasicHeader("Cache-Control","public"),new BasicHeader("Last-Modified",DateUtils.formatDate(oneYearAgo)),new BasicHeader("Content-Length","128")};
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpCacheEntry entry=HttpTestUtils.makeCacheEntry(requestTime,responseTime,hdrs,bytes);
  impl=new CachingExec(mockBackend,mockCache,config);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  final CloseableHttpResponse validated=Proxies.enhanceResponse(HttpTestUtils.make200Response());
  validated.setHeader("Cache-Control","public");
  validated.setHeader("Last-Modified",DateUtils.formatDate(oneYearAgo));
  validated.setHeader("Content-Length","128");
  validated.setEntity(new ByteArrayEntity(bytes));
  final CloseableHttpResponse reconstructed=Proxies.enhanceResponse(HttpTestUtils.make200Response());
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.eq(host),eqRequest(request));
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.isA(HttpHost.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpResponse.class));
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.eq(host),eqRequest(request))).andReturn(entry);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(validated).times(0,1);
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.isA(HttpHost.class),EasyMock.isA(HttpRequestWrapper.class))).andReturn(entry).times(0,1);
  EasyMock.expect(mockCache.cacheAndReturnResponse(EasyMock.isA(HttpHost.class),EasyMock.isA(HttpRequestWrapper.class),eqCloseableResponse(validated),EasyMock.isA(Date.class),EasyMock.isA(Date.class))).andReturn(reconstructed).times(0,1);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  Assert.assertEquals(200,result.getStatusLine().getStatusCode());
  if (!cap.hasCaptured()) {
    boolean found113Warning=false;
    for (    final Header h : result.getHeaders("Warning")) {
      for (      final HeaderElement elt : h.getElements()) {
        final String[] parts=elt.getName().split(" ");
        if ("113".equals(parts[0])) {
          found113Warning=true;
          break;
        }
      }
    }
    Assert.assertTrue(found113Warning);
  }
}

</code></pre>

<br>
<pre class="type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testDoesNotTransmitNoCacheDirectivesWithFieldsDownstream() throws Exception {
  request.setHeader("Cache-Control","no-cache=\"X-Field\"");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(0,1);
  replayMocks();
  try {
    impl.execute(route,request,context,null);
  }
 catch (  final ClientProtocolException acceptable) {
  }
  verifyMocks();
  if (cap.hasCaptured()) {
    final HttpRequest captured=cap.getValue();
    for (    final Header h : captured.getHeaders("Cache-Control")) {
      for (      final HeaderElement elt : h.getElements()) {
        if ("no-cache".equals(elt.getName())) {
          Assert.assertNull(elt.getValue());
        }
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testViaHeaderOnResponseProperlyRecordsOriginProtocol() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_0,HttpStatus.SC_NO_CONTENT,"No Content"));
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final String via=result.getFirstHeader("Via").getValue();
  final String protocol=via.split("\\s+")[0];
  final String[] protoParts=protocol.split("/");
  Assert.assertTrue(protoParts.length >= 1);
  Assert.assertTrue(protoParts.length <= 2);
  if (protoParts.length > 1) {
    Assert.assertTrue("http".equalsIgnoreCase(protoParts[0]));
  }
  Assert.assertEquals("1.0",protoParts[protoParts.length - 1]);
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ResponseIncludesVariantHeadersIfValueMightDiffer() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.addHeader("Accept-Encoding","gzip");
  final Date now=new Date();
  final Date inOneHour=new Date(now.getTime() + 3600 * 1000L);
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Expires",DateUtils.formatDate(inOneHour));
  originResponse.addHeader("Vary","Accept-Encoding");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("Cache-Control","no-cache");
  req2.addHeader("Accept-Encoding","gzip");
  final Date nextSecond=new Date(now.getTime() + 1000L);
  final Date inTwoHoursPlusASec=new Date(now.getTime() + 2 * 3600 * 1000L + 1000L);
  final HttpResponse originResponse2=HttpTestUtils.make200Response();
  originResponse2.setHeader("Date",DateUtils.formatDate(nextSecond));
  originResponse2.setHeader("Cache-Control","max-age=7200");
  originResponse2.setHeader("Expires",DateUtils.formatDate(inTwoHoursPlusASec));
  originResponse2.setHeader("Vary","Accept-Encoding");
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.addHeader("Range","bytes=0-50");
  req3.addHeader("Accept-Encoding","gzip");
  backendExpectsAnyRequest().andReturn(originResponse);
  backendExpectsAnyRequestAndReturn(originResponse2).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNotNull(result.getFirstHeader("Expires"));
    Assert.assertNotNull(result.getFirstHeader("Cache-Control"));
    Assert.assertNotNull(result.getFirstHeader("Vary"));
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testNonmatchingVariantCannotBeServedFromCacheUnlessConditionallyValidated() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("User-Agent","MyBrowser/1.0");
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag1\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Vary","User-Agent");
  resp1.setHeader("Content-Type","application/octet-stream");
  backendExpectsAnyRequestAndReturn(resp1);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("User-Agent","MyBrowser/1.5");
  final HttpRequestWrapper conditional=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  conditional.setHeader("User-Agent","MyBrowser/1.5");
  conditional.setHeader("If-None-Match","\"etag1\"");
  final HttpResponse resp200=HttpTestUtils.make200Response();
  resp200.setHeader("ETag","\"etag1\"");
  resp200.setHeader("Vary","User-Agent");
  final HttpResponse resp304=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  resp304.setHeader("ETag","\"etag1\"");
  resp304.setHeader("Vary","User-Agent");
  final Capture<HttpRequestWrapper> condCap=new Capture<>();
  final Capture<HttpRequestWrapper> uncondCap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.and(eqRequest(conditional),EasyMock.capture(condCap)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp304)).times(0,1);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.and(eqRequest(req2),EasyMock.capture(uncondCap)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp200)).times(0,1);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_OK == result.getStatusLine().getStatusCode()) {
    Assert.assertTrue(condCap.hasCaptured() || uncondCap.hasCaptured());
    if (uncondCap.hasCaptured()) {
      Assert.assertTrue(HttpTestUtils.semanticallyTransparent(resp200,result));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test206ResponseGeneratedFromCacheMustHaveABodyThatMatchesContentLengthHeaderIfPresent() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=0-50");
  backendExpectsAnyRequestAndReturn(resp1).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_PARTIAL_CONTENT == result.getStatusLine().getStatusCode()) {
    final Header h=result.getFirstHeader("Content-Length");
    if (h != null) {
      final int contentLength=Integer.parseInt(h.getValue());
      int bytesRead=0;
      final InputStream i=result.getEntity().getContent();
      while ((i.read()) != -1) {
        bytesRead++;
      }
      i.close();
      Assert.assertEquals(contentLength,bytesRead);
    }
  }
}

</code></pre>

<br>
<pre class="type-16 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMustServeAppropriateErrorOrWarningIfNoOriginCommunicationPossible() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final Date nineSecondsAgo=new Date(now.getTime() - 9 * 1000L);
  final Date eightSecondsAgo=new Date(now.getTime() - 8 * 1000L);
  final Header[] hdrs=new Header[]{new BasicHeader("Date",DateUtils.formatDate(nineSecondsAgo)),new BasicHeader("Cache-Control","max-age=0"),new BasicHeader("Content-Length","128"),new BasicHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo))};
  final byte[] bytes=new byte[128];
  new Random().nextBytes(bytes);
  final HttpCacheEntry entry=HttpTestUtils.makeCacheEntry(tenSecondsAgo,eightSecondsAgo,hdrs,bytes);
  impl=new CachingExec(mockBackend,mockCache,config);
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/thing",HttpVersion.HTTP_1_1),host);
  mockCache.flushInvalidatedCacheEntriesFor(EasyMock.eq(host),eqRequest(request));
  EasyMock.expect(mockCache.getCacheEntry(EasyMock.eq(host),eqRequest(request))).andReturn(entry);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andThrow(new IOException("can't talk to origin!")).anyTimes();
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final int status=result.getStatusLine().getStatusCode();
  if (status == 200) {
    boolean foundWarning=false;
    for (    final Header h : result.getHeaders("Warning")) {
      if (h.getValue().split(" ")[0].equals("111")) {
        foundWarning=true;
      }
    }
    Assert.assertTrue(foundWarning);
  }
 else {
    Assert.assertTrue(status >= 500 && status <= 599);
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesExpiresCacheControlAndOrVaryIfResponseMightDiffer() throws Exception {
  final Date now=new Date();
  final Date inTwoHours=new Date(now.getTime() + 2 * 3600 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Accept-Encoding","gzip");
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"v1\"");
  resp1.setHeader("Cache-Control","max-age=7200");
  resp1.setHeader("Expires",DateUtils.formatDate(inTwoHours));
  resp1.setHeader("Vary","Accept-Encoding");
  resp1.setEntity(HttpTestUtils.makeBody(entityLength));
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req1.setHeader("Accept-Encoding","gzip");
  req1.setHeader("Cache-Control","no-cache");
  final HttpResponse resp2=HttpTestUtils.make200Response();
  resp2.setHeader("ETag","\"v2\"");
  resp2.setHeader("Cache-Control","max-age=3600");
  resp2.setHeader("Expires",DateUtils.formatDate(inTwoHours));
  resp2.setHeader("Vary","Accept-Encoding");
  resp2.setEntity(HttpTestUtils.makeBody(entityLength));
  final HttpRequestWrapper req3=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req3.setHeader("Accept-Encoding","gzip");
  req3.setHeader("If-None-Match","\"v2\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp2)).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  final HttpResponse result=impl.execute(route,req3,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("Expires"));
    Assert.assertNotNull(result.getFirstHeader("Cache-Control"));
    Assert.assertNotNull(result.getFirstHeader("Vary"));
  }
}

</code></pre>

<br>
<pre class="type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpiresHeaderMatchesDateIfAddedToOriginResponse() throws Exception {
  originResponse.removeHeaders("Expires");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  final Header expHdr=result.getFirstHeader("Expires");
  if (expHdr != null) {
    Assert.assertEquals(result.getFirstHeader("Date").getValue(),expHdr.getValue());
  }
}

</code></pre>

<br>
<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleParametersInContentEncodingHeaderIsPreserved() throws Exception {
  originResponse.addHeader("Content-Encoding","gzip,deflate");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int total_encodings=0;
  for (  final Header hdr : result.getHeaders("Content-Encoding")) {
    for (    final HeaderElement elt : hdr.getElements()) {
switch (total_encodings) {
case 0:
        Assert.assertEquals("gzip",elt.getName());
      break;
case 1:
    Assert.assertEquals("deflate",elt.getName());
  break;
default :
Assert.fail("too many encodings");
}
total_encodings++;
}
}
Assert.assertEquals(2,total_encodings);
}

</code></pre>

<br>
<pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOrderOfMultipleContentEncodingHeaderValuesIsPreserved() throws Exception {
  originResponse.addHeader("Content-Encoding","gzip");
  originResponse.addHeader("Content-Encoding","deflate");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  int total_encodings=0;
  for (  final Header hdr : result.getHeaders("Content-Encoding")) {
    for (    final HeaderElement elt : hdr.getElements()) {
switch (total_encodings) {
case 0:
        Assert.assertEquals("gzip",elt.getName());
      break;
case 1:
    Assert.assertEquals("deflate",elt.getName());
  break;
default :
Assert.fail("too many encodings");
}
total_encodings++;
}
}
Assert.assertEquals(2,total_encodings);
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304GeneratedFromCacheOnWeakValidatorDoesNotIncludeOtherEntityHeaders() throws Exception {
  final Date now=new Date();
  final Date oneHourAgo=new Date(now.getTime() - 3600 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","W/\"v1\"");
  resp1.setHeader("Allow","GET,HEAD");
  resp1.setHeader("Content-Encoding","x-coding");
  resp1.setHeader("Content-Language","en");
  resp1.setHeader("Content-Length","128");
  resp1.setHeader("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
  resp1.setHeader("Content-Type","application/octet-stream");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(oneHourAgo));
  resp1.setHeader("Cache-Control","max-age=7200");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","W/\"v1\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1)).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNull(result.getFirstHeader("Allow"));
    Assert.assertNull(result.getFirstHeader("Content-Encoding"));
    Assert.assertNull(result.getFirstHeader("Content-Length"));
    Assert.assertNull(result.getFirstHeader("Content-MD5"));
    Assert.assertNull(result.getFirstHeader("Content-Type"));
    Assert.assertNull(result.getFirstHeader("Last-Modified"));
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesContentLocationIfOriginResponseDid() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.setHeader("Content-Location","http://foo.example.com/other");
  originResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("Content-Location"));
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testViaHeaderOnRequestProperlyRecordsClientProtocol() throws Exception {
  request=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_0),host);
  request.removeHeaders("Via");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  impl.execute(route,request,context,null);
  verifyMocks();
  final HttpRequest captured=cap.getValue();
  final String via=captured.getFirstHeader("Via").getValue();
  final String protocol=via.split("\\s+")[0];
  final String[] protoParts=protocol.split("/");
  if (protoParts.length > 1) {
    Assert.assertTrue("http".equalsIgnoreCase(protoParts[0]));
  }
  Assert.assertEquals("1.0",protoParts[protoParts.length - 1]);
}

</code></pre>

<br>
<pre class="type-7 type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCacheEntryIsUpdatedWithNewFieldValuesIn304Response() throws Exception {
  final Date now=new Date();
  final Date inFiveSeconds=new Date(now.getTime() + 5000L);
  final HttpRequestWrapper initialRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse cachedResponse=HttpTestUtils.make200Response();
  cachedResponse.setHeader("Cache-Control","max-age=3600");
  cachedResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper secondRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  secondRequest.setHeader("Cache-Control","max-age=0,max-stale=0");
  final HttpRequestWrapper conditionalValidationRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  conditionalValidationRequest.setHeader("If-None-Match","\"etag\"");
  final HttpRequestWrapper unconditionalValidationRequest=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse conditionalResponse=new BasicHttpResponse(HttpVersion.HTTP_1_1,HttpStatus.SC_NOT_MODIFIED,"Not Modified");
  conditionalResponse.setHeader("Date",DateUtils.formatDate(inFiveSeconds));
  conditionalResponse.setHeader("Server","MockUtils/1.0");
  conditionalResponse.setHeader("ETag","\"etag\"");
  conditionalResponse.setHeader("X-Extra","junk");
  final HttpResponse unconditionalResponse=HttpTestUtils.make200Response();
  unconditionalResponse.setHeader("Date",DateUtils.formatDate(inFiveSeconds));
  unconditionalResponse.setHeader("ETag","\"etag\"");
  final Capture<HttpRequestWrapper> cap1=new Capture<>();
  final Capture<HttpRequestWrapper> cap2=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(cachedResponse));
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.and(eqRequest(conditionalValidationRequest),EasyMock.capture(cap1)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(conditionalResponse)).times(0,1);
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.and(eqRequest(unconditionalValidationRequest),EasyMock.capture(cap2)),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(unconditionalResponse)).times(0,1);
  replayMocks();
  impl.execute(route,initialRequest,context,null);
  final HttpResponse result=impl.execute(route,secondRequest,context,null);
  verifyMocks();
  Assert.assertTrue((cap1.hasCaptured() && !cap2.hasCaptured()) || (!cap1.hasCaptured() && cap2.hasCaptured()));
  if (cap1.hasCaptured()) {
    Assert.assertEquals(DateUtils.formatDate(inFiveSeconds),result.getFirstHeader("Date").getValue());
    Assert.assertEquals("junk",result.getFirstHeader("X-Extra").getValue());
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesEtagIfOriginResponseDid() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("ETag"));
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ContainsContentLocationIfA200ResponseWouldHaveIncludedIt() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Content-Location","http://foo.example.com/other/url");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNotNull(result.getFirstHeader("Content-Location"));
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test206ResponseToConditionalRangeRequestDoesNotIncludeOtherEntityHeaders() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final Date now=new Date();
  final Date oneHourAgo=new Date(now.getTime() - 3600 * 1000L);
  originResponse=Proxies.enhanceResponse(HttpTestUtils.make200Response());
  originResponse.addHeader("Allow","GET,HEAD");
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Content-Language","en");
  originResponse.addHeader("Content-Encoding","x-coding");
  originResponse.addHeader("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
  originResponse.addHeader("Content-Length","128");
  originResponse.addHeader("Content-Type","application/octet-stream");
  originResponse.addHeader("Last-Modified",DateUtils.formatDate(oneHourAgo));
  originResponse.addHeader("ETag","W/\"weak-tag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("If-Range","W/\"weak-tag\"");
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertNull(result.getFirstHeader("Allow"));
    Assert.assertNull(result.getFirstHeader("Content-Encoding"));
    Assert.assertNull(result.getFirstHeader("Content-Language"));
    Assert.assertNull(result.getFirstHeader("Content-MD5"));
    Assert.assertNull(result.getFirstHeader("Last-Modified"));
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpiresHeaderMatchesDateIfAddedToCacheHit() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.removeHeaders("Expires");
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  final Header expHdr=result.getFirstHeader("Expires");
  if (expHdr != null) {
    Assert.assertEquals(result.getFirstHeader("Date").getValue(),expHdr.getValue());
  }
}

</code></pre>

<br>
<pre class="type-16 type-2 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWarnDatesAreAddedToWarningsOnLowerProtocolVersions() throws Exception {
  final String dateHdr=DateUtils.formatDate(new Date());
  final String origWarning="110 fred \"stale\"";
  originResponse.setStatusLine(HttpVersion.HTTP_1_0,HttpStatus.SC_OK);
  originResponse.addHeader("Warning",origWarning);
  originResponse.setHeader("Date",dateHdr);
  backendExpectsAnyRequest().andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  if (HttpVersion.HTTP_1_0.greaterEquals(result.getProtocolVersion())) {
    Assert.assertEquals(dateHdr,result.getFirstHeader("Date").getValue());
    boolean warningFound=false;
    final String targetWarning=origWarning + " \"" + dateHdr+ "\"";
    for (    final Header h : result.getHeaders("Warning")) {
      for (      final String warning : h.getValue().split("\\s*,\\s*")) {
        if (targetWarning.equals(warning)) {
          warningFound=true;
          break;
        }
      }
    }
    Assert.assertTrue(warningFound);
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test304ResponseGeneratedFromCacheIncludesDateHeader() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  originResponse.setHeader("Cache-Control","max-age=3600");
  originResponse.setHeader("ETag","\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("If-None-Match","\"etag\"");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_NOT_MODIFIED) {
    Assert.assertNotNull(result.getFirstHeader("Date"));
  }
}

</code></pre>

<br>
<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testMustNotAddMultipartByteRangeContentTypeTo416Response() throws Exception {
  originResponse=Proxies.enhanceResponse(new BasicHttpResponse(HttpVersion.HTTP_1_1,416,"Requested Range Not Satisfiable"));
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  replayMocks();
  final HttpResponse result=impl.execute(route,request,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == 416) {
    for (    final Header h : result.getHeaders("Content-Type")) {
      for (      final HeaderElement elt : h.getElements()) {
        Assert.assertFalse("multipart/byteranges".equalsIgnoreCase(elt.getName()));
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test206ResponseToIfRangeWithStrongValidatorReturnsAllEntityHeaders() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final Date now=new Date();
  final Date oneHourAgo=new Date(now.getTime() - 3600 * 1000L);
  originResponse.addHeader("Allow","GET,HEAD");
  originResponse.addHeader("Cache-Control","max-age=3600");
  originResponse.addHeader("Content-Language","en");
  originResponse.addHeader("Content-Encoding","x-coding");
  originResponse.addHeader("Content-MD5","Q2hlY2sgSW50ZWdyaXR5IQ==");
  originResponse.addHeader("Content-Length","128");
  originResponse.addHeader("Content-Type","application/octet-stream");
  originResponse.addHeader("Last-Modified",DateUtils.formatDate(oneHourAgo));
  originResponse.addHeader("ETag","\"strong-tag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.addHeader("If-Range","\"strong-tag\"");
  req2.addHeader("Range","bytes=0-50");
  backendExpectsAnyRequest().andReturn(originResponse).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == HttpStatus.SC_PARTIAL_CONTENT) {
    Assert.assertEquals("GET,HEAD",result.getFirstHeader("Allow").getValue());
    Assert.assertEquals("max-age=3600",result.getFirstHeader("Cache-Control").getValue());
    Assert.assertEquals("en",result.getFirstHeader("Content-Language").getValue());
    Assert.assertEquals("x-coding",result.getFirstHeader("Content-Encoding").getValue());
    Assert.assertEquals("Q2hlY2sgSW50ZWdyaXR5IQ==",result.getFirstHeader("Content-MD5").getValue());
    Assert.assertEquals(originResponse.getFirstHeader("Last-Modified").getValue(),result.getFirstHeader("Last-Modified").getValue());
  }
}

</code></pre>

<br>
<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testValidationMustUseETagIfProvidedByOriginServer() throws Exception {
  final Date now=new Date();
  final Date tenSecondsAgo=new Date(now.getTime() - 10 * 1000L);
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("Date",DateUtils.formatDate(now));
  resp1.setHeader("Cache-Control","max-age=3600");
  resp1.setHeader("Last-Modified",DateUtils.formatDate(tenSecondsAgo));
  resp1.setHeader("ETag","W/\"etag\"");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Cache-Control","max-age=0,max-stale=0");
  final Capture<HttpRequestWrapper> cap=new Capture<>();
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  EasyMock.expect(mockBackend.execute(EasyMock.eq(route),EasyMock.capture(cap),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(resp1));
  replayMocks();
  impl.execute(route,req1,context,null);
  impl.execute(route,req2,context,null);
  verifyMocks();
  final HttpRequest validation=cap.getValue();
  boolean isConditional=false;
  final String[] conditionalHeaders={"If-Range","If-Modified-Since","If-Unmodified-Since","If-Match","If-None-Match"};
  for (  final String ch : conditionalHeaders) {
    if (validation.getFirstHeader(ch) != null) {
      isConditional=true;
      break;
    }
  }
  if (isConditional) {
    boolean foundETag=false;
    for (    final Header h : validation.getHeaders("If-Match")) {
      for (      final HeaderElement elt : h.getElements()) {
        if ("W/\"etag\"".equals(elt.getName())) {
          foundETag=true;
        }
      }
    }
    for (    final Header h : validation.getHeaders("If-None-Match")) {
      for (      final HeaderElement elt : h.getElements()) {
        if ("W/\"etag\"".equals(elt.getName())) {
          foundETag=true;
        }
      }
    }
    Assert.assertTrue(foundETag);
  }
}

</code></pre>

<br>
<pre class="type-7 type-16 type-2 type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test206ResponseGeneratedFromCacheMustHaveContentRangeOrMultipartByteRangesContentType() throws Exception {
  final HttpRequestWrapper req1=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  final HttpResponse resp1=HttpTestUtils.make200Response();
  resp1.setHeader("ETag","\"etag\"");
  resp1.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper req2=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  req2.setHeader("Range","bytes=0-50");
  backendExpectsAnyRequestAndReturn(resp1).times(1,2);
  replayMocks();
  impl.execute(route,req1,context,null);
  final HttpResponse result=impl.execute(route,req2,context,null);
  verifyMocks();
  if (HttpStatus.SC_PARTIAL_CONTENT == result.getStatusLine().getStatusCode()) {
    if (result.getFirstHeader("Content-Range") == null) {
      final HeaderElement elt=result.getFirstHeader("Content-Type").getElements()[0];
      Assert.assertTrue("multipart/byteranges".equalsIgnoreCase(elt.getName()));
      Assert.assertNotNull(elt.getParameterByName("boundary"));
      Assert.assertNotNull(elt.getParameterByName("boundary").getValue());
      Assert.assertFalse("".equals(elt.getParameterByName("boundary").getValue().trim()));
    }
  }
}

</code></pre>

<br>
<pre class="type-16 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testMustNotUseMultipartByteRangeContentTypeOnCacheGenerated416Responses() throws Exception {
  originResponse.setEntity(HttpTestUtils.makeBody(entityLength));
  originResponse.setHeader("Content-Length","128");
  originResponse.setHeader("Cache-Control","max-age=3600");
  final HttpRequestWrapper rangeReq=HttpRequestWrapper.wrap(new BasicHttpRequest("GET","/",HttpVersion.HTTP_1_1),host);
  rangeReq.setHeader("Range","bytes=1000-1200");
  final HttpResponse orig416=new BasicHttpResponse(HttpVersion.HTTP_1_1,416,"Requested Range Not Satisfiable");
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(originResponse);
  EasyMock.expect(mockBackend.execute(EasyMock.isA(HttpRoute.class),EasyMock.isA(HttpRequestWrapper.class),EasyMock.isA(HttpClientContext.class),EasyMock.<HttpExecutionAware>isNull())).andReturn(Proxies.enhanceResponse(orig416)).times(0,1);
  replayMocks();
  impl.execute(route,request,context,null);
  final HttpResponse result=impl.execute(route,rangeReq,context,null);
  verifyMocks();
  if (result.getStatusLine().getStatusCode() == 416) {
    for (    final Header h : result.getHeaders("Content-Type")) {
      for (      final HeaderElement elt : h.getElements()) {
        Assert.assertFalse("multipart/byteranges".equalsIgnoreCase(elt.getName()));
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hc.client5.http.impl.integration.TestContentCodings </h4><pre class="type-16 type-8 type-4 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Try with a bunch of client threads, to check that it's thread-safe.
 * @throws Exceptionif there was a problem
 */
@Test public void testThreadSafetyOfContentCodings() throws Exception {
  final String entityText="Hello, this is some plain text coming back.";
  this.serverBootstrap.registerHandler("*",createGzipEncodingRequestHandler(entityText));
  final int clients=100;
  this.connManager.setMaxTotal(clients);
  final HttpHost target=start();
  final ExecutorService executor=Executors.newFixedThreadPool(clients);
  final CountDownLatch startGate=new CountDownLatch(1);
  final CountDownLatch endGate=new CountDownLatch(clients);
  final List<WorkerTask> workers=new ArrayList<>();
  for (int i=0; i < clients; ++i) {
    workers.add(new WorkerTask(this.httpclient,target,i % 2 == 0,startGate,endGate));
  }
  for (  final WorkerTask workerTask : workers) {
    executor.execute(workerTask);
  }
  startGate.countDown();
  endGate.await();
  for (  final WorkerTask workerTask : workers) {
    if (workerTask.isFailed()) {
      Assert.fail("A worker failed");
    }
    Assert.assertEquals(entityText,workerTask.getText());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hc.client5.http.impl.integration.TestCookieVirtualHost </h4><pre class="type-16 type-8 type-4 type-1 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCookieMatchingWithVirtualHosts() throws Exception {
  this.serverBootstrap.registerHandler("*",new HttpRequestHandler(){
    @Override public void handle(    final HttpRequest request,    final HttpResponse response,    final HttpContext context) throws HttpException, IOException {
      final int n=Integer.parseInt(request.getFirstHeader("X-Request").getValue());
switch (n) {
case 1:
        Assert.assertEquals("app.mydomain.fr",request.getFirstHeader("Host").getValue());
      response.setStatusLine(HttpVersion.HTTP_1_1,HttpStatus.SC_OK);
    response.addHeader(new BasicHeader("Set-Cookie","name1=value1; domain=mydomain.fr; path=/"));
  break;
case 2:
Assert.assertEquals("app.mydomain.fr",request.getFirstHeader("Host").getValue());
Assert.assertNotNull("We must get a cookie header",request.getFirstHeader("Cookie"));
response.setStatusLine(HttpVersion.HTTP_1_1,HttpStatus.SC_OK);
break;
case 3:
Assert.assertEquals("app.mydomain.fr",request.getFirstHeader("Host").getValue());
response.setStatusLine(HttpVersion.HTTP_1_1,HttpStatus.SC_OK);
break;
default :
Assert.fail("Unexpected value: " + n);
break;
}
}
}
);
final HttpHost target=start();
final CookieStore cookieStore=new BasicCookieStore();
final HttpClientContext context=HttpClientContext.create();
context.setCookieStore(cookieStore);
URI uri=new URI("http://app.mydomain.fr");
HttpRequest httpRequest=new HttpGet(uri);
httpRequest.addHeader("X-Request","1");
try (CloseableHttpResponse response1=this.httpclient.execute(target,httpRequest,context)){
EntityUtils.consume(response1.getEntity());
}
 final List<Cookie> cookies=cookieStore.getCookies();
Assert.assertNotNull(cookies);
Assert.assertEquals(1,cookies.size());
Assert.assertEquals("name1",cookies.get(0).getName());
uri=new URI("http://app.mydomain.fr");
httpRequest=new HttpGet(uri);
httpRequest.addHeader("X-Request","2");
try (CloseableHttpResponse response2=this.httpclient.execute(target,httpRequest,context)){
EntityUtils.consume(response2.getEntity());
}
 uri=new URI("http://app.mydomain.fr");
httpRequest=new HttpGet(uri);
httpRequest.addHeader("X-Request","3");
try (CloseableHttpResponse response3=this.httpclient.execute(target,httpRequest,context)){
EntityUtils.consume(response3.getEntity());
}
 }

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
