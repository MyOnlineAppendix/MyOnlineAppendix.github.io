<h3 style="margin:0px">Class: org.apache.james.protocols.smtp.AbstractSMTPServerTest (22 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(22)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(22)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testInvalidNoBracketsEnformance() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    Protocol protocol=createProtocol(hook);
    ((SMTPConfigurationImpl)protocol.getConfiguration()).setUseAddressBracketsEnforcement(false);
    server=createServer(protocol,address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.mail(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT1);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHeloHookTempraryError() throws Exception {
  HeloHook hook=new HeloHook(){
    public HookResult doHelo(    SMTPSession session,    String helo){
      return new HookResult(HookReturnCode.DENYSOFT);
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativeTransient(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRcptHookPermanentError() throws Exception {
  RcptHook hook=new RcptHook(){
    public HookResult doRcpt(    SMTPSession session,    MailAddress sender,    MailAddress rcpt){
      if (RCPT1.equals(rcpt.toString())) {
        return new HookResult(HookReturnCode.DENY);
      }
 else {
        return new HookResult(HookReturnCode.DECLINED);
      }
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT1);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.addRecipient(RCPT2);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSimpleDelivery() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT1);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT2);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    assertTrue(client.sendShortMessageData(MSG1));
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertTrue(queued.hasNext());
    MailEnvelope env=queued.next();
    checkEnvelope(env,SENDER,Arrays.asList(RCPT1,RCPT2),MSG1);
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHeloHookPermanentError() throws Exception {
  HeloHook hook=new HeloHook(){
    public HookResult doHelo(    SMTPSession session,    String helo){
      return new HookResult(HookReturnCode.DENY);
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHeloEnforcement() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMailWithoutBrackets() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.mail("invalid");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.addRecipient(RCPT1);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRcptHookTemporaryError() throws Exception {
  RcptHook hook=new RcptHook(){
    public HookResult doRcpt(    SMTPSession session,    MailAddress sender,    MailAddress rcpt){
      if (RCPT1.equals(rcpt.toString())) {
        return new HookResult(HookReturnCode.DENYSOFT);
      }
 else {
        return new HookResult(HookReturnCode.DECLINED);
      }
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT1);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativeTransient(client.getReplyCode()));
    client.addRecipient(RCPT2);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testStartTlsNotSupported() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.sendCommand("STARTTLS");
    assertTrue(SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testInvalidHelo() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testConnectHandlerTemporary() throws Exception {
  ConnectHandler<SMTPSession> connectHandler=new ConnectHandler<SMTPSession>(){
    public Response onConnect(    SMTPSession session){
      return new SMTPResponse("451","Bye Bye");
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(connectHandler),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativeTransient(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRcptWithoutBrackets() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.rcpt(RCPT1);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMessageHookPermanentError() throws Exception {
  TestMessageHook testHook=new TestMessageHook();
  MessageHook hook=new MessageHook(){
    public HookResult onMessage(    SMTPSession session,    MailEnvelope mail){
      return new HookResult(HookReturnCode.DENY);
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook,testHook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT2);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    assertFalse(client.sendShortMessageData(MSG1));
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=testHook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testNullSender() throws Exception {
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(new ProtocolHandler[0]),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender("");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT1);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMessageHookTemporaryError() throws Exception {
  TestMessageHook testHook=new TestMessageHook();
  MessageHook hook=new MessageHook(){
    public HookResult onMessage(    SMTPSession session,    MailEnvelope mail){
      return new HookResult(HookReturnCode.DENYSOFT);
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook,testHook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.addRecipient(RCPT2);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    assertFalse(client.sendShortMessageData(MSG1));
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativeTransient(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=testHook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testConnectHandlerPermananet() throws Exception {
  ConnectHandler<SMTPSession> connectHandler=new ConnectHandler<SMTPSession>(){
    public Response onConnect(    SMTPSession session){
      return new SMTPResponse("554","Bye Bye");
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(connectHandler),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testDisconnectHandler() throws Exception {
  final AtomicBoolean called=new AtomicBoolean(false);
  DisconnectHandler<SMTPSession> handler=new DisconnectHandler<SMTPSession>(){
    public void onDisconnect(    SMTPSession session){
      called.set(true);
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(handler),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Thread.sleep(1000);
    assertTrue(called.get());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMailHookPermanentError() throws Exception {
  MailHook hook=new MailHook(){
    public HookResult doMail(    SMTPSession session,    MailAddress sender){
      return new HookResult(HookReturnCode.DENY);
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testNoop() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.noop();
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMailHookTemporaryError() throws Exception {
  MailHook hook=new MailHook(){
    public HookResult doMail(    SMTPSession session,    MailAddress sender){
      return new HookResult(HookReturnCode.DENYSOFT);
    }
  }
;
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.helo("localhost");
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isNegativeTransient(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testUnknownCommand() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    server=createServer(createProtocol(hook),address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue(SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.sendCommand("UNKNOWN");
    assertTrue(SMTPReply.isNegativePermanent(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHeloEnforcementDisabled() throws Exception {
  TestMessageHook hook=new TestMessageHook();
  InetSocketAddress address=new InetSocketAddress("127.0.0.1",TestUtils.getFreePort());
  ProtocolServer server=null;
  try {
    Protocol protocol=createProtocol(hook);
    ((SMTPConfigurationImpl)protocol.getConfiguration()).setHeloEhloEnforcement(false);
    server=createServer(protocol,address);
    server.bind();
    SMTPClient client=createClient();
    client.connect(address.getAddress().getHostAddress(),address.getPort());
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.setSender(SENDER);
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.quit();
    assertTrue("Reply=" + client.getReplyString(),SMTPReply.isPositiveCompletion(client.getReplyCode()));
    client.disconnect();
    Iterator<MailEnvelope> queued=hook.getQueued().iterator();
    assertFalse(queued.hasNext());
  }
  finally {
    if (server != null) {
      server.unbind();
    }
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
