<h3><span class=" glyphicon glyphicon-tag"/>&nbspAPIUtilityVerifier</h3><kbd>Verifies values of objects/variables related to API calls (Java or TPL) </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.helix.TestGetProperty </h4><pre class="type-7 type-5 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetProperty(){
  String version;
  Properties props=new Properties();
  try {
    InputStream stream=Thread.currentThread().getContextClassLoader().getResourceAsStream("cluster-manager-version.properties");
    props.load(stream);
    version=props.getProperty("clustermanager.version");
    Assert.assertNotNull(version);
    System.out.println("cluster-manager-version:" + version);
  }
 catch (  IOException e) {
    Assert.fail("could not open cluster-manager-version.properties. ",e);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestRoutingTable </h4><pre class="type-4 type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testMultiThread() throws Exception {
  final RoutingTableProvider routingTable=new RoutingTableProvider();
  List<ExternalView> externalViewList=new ArrayList<ExternalView>();
  ZNRecord record=new ZNRecord("TESTDB");
  for (int i=0; i < 1000; i++) {
    add(record,"TESTDB_" + i,"localhost_8900","MASTER");
  }
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  Callable<Boolean> runnable=new Callable<Boolean>(){
    @Override public Boolean call() throws Exception {
      try {
        int count=0;
        while (count < 100) {
          List<InstanceConfig> instancesList=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
          AssertJUnit.assertEquals(instancesList.size(),1);
          Thread.sleep(5);
          count++;
        }
      }
 catch (      InterruptedException e) {
      }
      return true;
    }
  }
;
  ScheduledExecutorService executor=Executors.newSingleThreadScheduledExecutor();
  Future<Boolean> submit=executor.submit(runnable);
  int count=0;
  while (count < 10) {
    try {
      Thread.sleep(10);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    routingTable.onExternalViewChange(externalViewList,changeContext);
    count++;
  }
  Boolean result=submit.get(60,TimeUnit.SECONDS);
  AssertJUnit.assertEquals(result,Boolean.TRUE);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testGetInstanceForAllStateUnits(){
  List<InstanceConfig> instancesList;
  Set<InstanceConfig> instancesSet;
  InstanceConfig instancesArray[];
  RoutingTableProvider routingTable=new RoutingTableProvider();
  List<ExternalView> externalViewList=new ArrayList<ExternalView>();
  ZNRecord record=new ZNRecord("TESTDB");
  add(record,"TESTDB_0","localhost_8900","MASTER");
  add(record,"TESTDB_1","localhost_8900","MASTER");
  add(record,"TESTDB_2","localhost_8900","MASTER");
  add(record,"TESTDB_3","localhost_8900","SLAVE");
  add(record,"TESTDB_4","localhost_8900","SLAVE");
  add(record,"TESTDB_5","localhost_8900","SLAVE");
  add(record,"TESTDB_0","localhost_8901","SLAVE");
  add(record,"TESTDB_1","localhost_8901","SLAVE");
  add(record,"TESTDB_2","localhost_8901","SLAVE");
  add(record,"TESTDB_3","localhost_8901","MASTER");
  add(record,"TESTDB_4","localhost_8901","MASTER");
  add(record,"TESTDB_5","localhost_8901","MASTER");
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  instancesList=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
  AssertJUnit.assertNotNull(instancesList);
  AssertJUnit.assertEquals(instancesList.size(),1);
  instancesSet=routingTable.getInstances("TESTDB","MASTER");
  AssertJUnit.assertNotNull(instancesSet);
  AssertJUnit.assertEquals(instancesSet.size(),2);
  instancesSet=routingTable.getInstances("TESTDB","SLAVE");
  AssertJUnit.assertNotNull(instancesSet);
  AssertJUnit.assertEquals(instancesSet.size(),2);
  instancesArray=new InstanceConfig[instancesSet.size()];
  instancesSet.toArray(instancesArray);
  AssertJUnit.assertEquals(instancesArray[0].getHostName(),"localhost");
  AssertJUnit.assertEquals(instancesArray[0].getPort(),"8900");
  AssertJUnit.assertEquals(instancesArray[1].getHostName(),"localhost");
  AssertJUnit.assertEquals(instancesArray[1].getPort(),"8901");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZkBasis </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * after calling zkclient#unsubscribeXXXListener()
 * an already registered watch will not be removed from ZooKeeper#watchManager#XXXWatches
 * immediately.
 * the watch will get removed on the following conditions:
 * 1) there is a set/delete on the listening path via the zkclient
 * 2) session expiry on the zkclient (i.e. the watch will not be renewed after session expiry)
 * @throws Exception
 */
@Test public void testWatchRemove() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  final ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  final String path="/" + testName + "/test";
  client.createPersistent(path,true);
  ZkListener listener=new ZkListener();
  client.subscribeDataChanges(path,listener);
  client.subscribeChildChanges(path,listener);
  Map<String,Set<IZkDataListener>> dataListenerMap=ZkTestHelper.getZkDataListener(client);
  Assert.assertEquals(dataListenerMap.size(),1,"ZkClient#_dataListener should have 1 listener");
  Set<IZkDataListener> dataListenerSet=dataListenerMap.get(path);
  Assert.assertNotNull(dataListenerSet,"ZkClient#_dataListener should have 1 listener on path: " + path);
  Assert.assertEquals(dataListenerSet.size(),1,"ZkClient#_dataListener should have 1 listener on path: " + path);
  Map<String,Set<IZkChildListener>> childListenerMap=ZkTestHelper.getZkChildListener(client);
  Assert.assertEquals(childListenerMap.size(),1,"ZkClient#_childListener should have 1 listener");
  Set<IZkChildListener> childListenerSet=childListenerMap.get(path);
  Assert.assertNotNull(childListenerSet,"ZkClient#_childListener should have 1 listener on path: " + path);
  Assert.assertEquals(childListenerSet.size(),1,"ZkClient#_childListener should have 1 listener on path: " + path);
  Map<String,List<String>> watchMap=ZkTestHelper.getZkWatch(client);
  List<String> dataWatch=watchMap.get("dataWatches");
  Assert.assertNotNull(dataWatch,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  Assert.assertEquals(dataWatch.size(),1,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  Assert.assertEquals(dataWatch.get(0),path,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  List<String> childWatch=watchMap.get("childWatches");
  Assert.assertNotNull(childWatch,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  Assert.assertEquals(childWatch.size(),1,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  Assert.assertEquals(childWatch.get(0),path,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  client.unsubscribeDataChanges(path,listener);
  client.unsubscribeChildChanges(path,listener);
  ZkTestHelper.expireSession(client);
  watchMap=ZkTestHelper.getZkWatch(client);
  dataWatch=watchMap.get("dataWatches");
  Assert.assertTrue(dataWatch.isEmpty(),"ZooKeeper#watchManager#dataWatches should be empty");
  childWatch=watchMap.get("childWatches");
  Assert.assertTrue(childWatch.isEmpty(),"ZooKeeper#watchManager#childWatches should be empty");
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZnodeModify </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test() public void testDataTrigger() throws Exception {
  logger.info("RUN: " + new Date(System.currentTimeMillis()));
  List<TestCommand> commandList=new ArrayList<TestCommand>();
  String pathChild1=PREFIX + "/data_trigger_child1";
  String pathChild2=PREFIX + "/data_trigger_child2";
  ZnodeOpArg arg;
  TestCommand command;
  ZnodeOpArg arg1=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"+","key1","simpleValue1-new");
  TestCommand command1=new TestCommand(CommandType.MODIFY,new TestTrigger(0,0,"simpleValue1"),arg1);
  commandList.add(command1);
  ZNRecord record=getExampleZNRecord();
  ZNRecord recordNew=new ZNRecord(record);
  recordNew.setSimpleField(IdealStateProperty.REBALANCE_MODE.toString(),RebalanceMode.SEMI_AUTO.toString());
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"+",recordNew);
  command=new TestCommand(CommandType.MODIFY,new TestTrigger(0,3000,record),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"+",record);
  command=new TestCommand(CommandType.MODIFY,new TestTrigger(1000),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"!=","key1");
  command=new TestCommand(CommandType.VERIFY,new TestTrigger(3100,0,"simpleValue1-new"),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"==");
  command=new TestCommand(CommandType.VERIFY,new TestTrigger(3100,0,recordNew),arg);
  commandList.add(command);
  Map<TestCommand,Boolean> results=TestExecutor.executeTest(commandList,_zkaddr);
  boolean result=results.remove(command1).booleanValue();
  AssertJUnit.assertFalse(result);
  for (  Map.Entry<TestCommand,Boolean> entry : results.entrySet()) {
    Assert.assertTrue(entry.getValue());
  }
  logger.info("END: " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.TestId </h4><pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check that PartitionId doesn't need to be of the form resource_partition for compatibility
 */
@Test public void testPartitionIdCompatibility(){
  final String partitionName="Resource--3";
  PartitionId partitionId=PartitionId.from(partitionName);
  Assert.assertEquals(partitionId.stringify(),partitionName);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Make sure that a partition serializes and deserializes properly
 */
@Test public void testPartitionId(){
  final String partitionName="Resource_3";
  final String resourceName="Resource";
  final String partitionSuffix="3";
  PartitionId partitionId=PartitionId.from(partitionName);
  Assert.assertEquals(partitionId.stringify(),partitionName);
  PartitionId partitionId2=PartitionId.from(ResourceId.from(resourceName),partitionSuffix);
  Assert.assertEquals(partitionId2.stringify(),partitionName);
  Assert.assertEquals(partitionId,partitionId2);
  Assert.assertEquals(partitionId.toString(),partitionId2.toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.TestNamespacedConfig </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure that user configs are separated from helix configs in properties that hold both
 */
@Test public void testUserConfigUpdates(){
  final String testKey="testKey";
  final String prefixedKey=UserConfig.class.getSimpleName() + "!testKey";
  final String testSimpleValue="testValue";
  final List<String> testListValue=ImmutableList.of("testValue");
  final Map<String,String> testMapValue=ImmutableMap.of("testInnerKey","testValue");
  ParticipantId participantId=ParticipantId.from("testParticipant");
  InstanceConfig instanceConfig=new InstanceConfig(participantId);
  instanceConfig.setHostName("localhost");
  UserConfig userConfig=new UserConfig(Scope.participant(participantId));
  userConfig.setSimpleField(testKey,testSimpleValue);
  userConfig.setListField(testKey,testListValue);
  userConfig.setMapField(testKey,testMapValue);
  instanceConfig.addNamespacedConfig(userConfig);
  UserConfig retrievedConfig=UserConfig.from(instanceConfig);
  Assert.assertTrue(instanceConfig.getHostName().equals("localhost"));
  Assert.assertEquals(retrievedConfig.getStringField(InstanceConfigProperty.HELIX_HOST.toString(),"not localhost"),"not localhost");
  Assert.assertEquals(userConfig.getSimpleField(testKey),testSimpleValue);
  Assert.assertEquals(userConfig.getListField(testKey),testListValue);
  Assert.assertEquals(userConfig.getMapField(testKey),testMapValue);
  Assert.assertEquals(retrievedConfig.getSimpleField(testKey),testSimpleValue);
  Assert.assertEquals(retrievedConfig.getListField(testKey),testListValue);
  Assert.assertEquals(retrievedConfig.getMapField(testKey),testMapValue);
  Assert.assertEquals(instanceConfig.getRecord().getSimpleField(prefixedKey),testSimpleValue);
  Assert.assertEquals(instanceConfig.getRecord().getListField(prefixedKey),testListValue);
  Assert.assertEquals(instanceConfig.getRecord().getMapField(prefixedKey),testMapValue);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.accessor.TestAccessorRecreate </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test just makes sure that a participant is only recreated if it is incomplete. This is not
 * directly testing atomicity, but rather a use case where a machine died while creating the
 * participant.
 */
@Test public void testRecreateParticipant(){
  final String MODIFIER="modifier";
  final ClusterId clusterId=ClusterId.from("testCluster");
  final ParticipantId participantId=ParticipantId.from("testParticipant");
  boolean connected=_zkclient.waitUntilConnected(30000,TimeUnit.MILLISECONDS);
  if (!connected) {
    LOG.warn("Connection not established");
    return;
  }
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor helixAccessor=new ZKHelixDataAccessor(clusterId.stringify(),baseAccessor);
  ClusterAccessor accessor=new ClusterAccessor(clusterId,helixAccessor);
  boolean clusterCreated=createCluster(clusterId,accessor,MODIFIER,0);
  Assert.assertTrue(clusterCreated);
  boolean created=createParticipant(participantId,accessor,MODIFIER,1);
  Assert.assertTrue(created);
  Participant participantSnapshot=accessor.readParticipant(participantId);
  Assert.assertEquals(participantSnapshot.getUserConfig().getIntField(MODIFIER,-1),1);
  boolean created2=createParticipant(participantId,accessor,MODIFIER,2);
  Assert.assertFalse(created2);
  helixAccessor.removeProperty(helixAccessor.keyBuilder().messages(participantId.stringify()));
  created2=createParticipant(participantId,accessor,MODIFIER,2);
  Assert.assertTrue(created2);
  participantSnapshot=accessor.readParticipant(participantId);
  Assert.assertEquals(participantSnapshot.getUserConfig().getIntField(MODIFIER,-1),2);
  accessor.dropCluster();
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test just makes sure that a cluster is only recreated if it is incomplete. This is not
 * directly testing atomicity, but rather a use case where a machine died while creating the
 * cluster.
 */
@Test public void testRecreateCluster(){
  final String MODIFIER="modifier";
  final ClusterId clusterId=ClusterId.from("TestAccessorRecreate!testCluster");
  boolean connected=_zkclient.waitUntilConnected(30000,TimeUnit.MILLISECONDS);
  if (!connected) {
    LOG.warn("Connection not established");
    return;
  }
  HelixDataAccessor helixAccessor=new ZKHelixDataAccessor(clusterId.stringify(),_baseAccessor);
  ClusterAccessor accessor=new ClusterAccessor(clusterId,helixAccessor);
  boolean created=createCluster(clusterId,accessor,MODIFIER,1);
  Assert.assertTrue(created);
  Cluster clusterSnapshot=accessor.readCluster();
  Assert.assertEquals(clusterSnapshot.getUserConfig().getIntField(MODIFIER,-1),1);
  boolean created2=createCluster(clusterId,accessor,MODIFIER,2);
  Assert.assertFalse(created2);
  helixAccessor.removeProperty(helixAccessor.keyBuilder().liveInstances());
  created2=createCluster(clusterId,accessor,MODIFIER,2);
  Assert.assertTrue(created2);
  clusterSnapshot=accessor.readCluster();
  Assert.assertEquals(clusterSnapshot.getUserConfig().getIntField(MODIFIER,-1),2);
  accessor.dropCluster();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestClusterEventBlockingQueue </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEventQueue() throws Exception {
  ClusterEventBlockingQueue queue=new ClusterEventBlockingQueue();
  ClusterEvent event1=new ClusterEvent("event1");
  queue.put(event1);
  Assert.assertEquals(queue.size(),1);
  ClusterEvent event2=new ClusterEvent("event2");
  queue.put(event2);
  Assert.assertEquals(queue.size(),2);
  ClusterEvent newEvent1=new ClusterEvent("event1");
  newEvent1.addAttribute("attr",1);
  queue.put(newEvent1);
  Assert.assertEquals(queue.size(),2);
  ClusterEvent peeked=queue.peek();
  Assert.assertEquals(peeked.getName(),"event1");
  Assert.assertEquals(peeked.getAttribute("attr"),1);
  Assert.assertEquals(queue.size(),2);
  ListeningExecutorService service=MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());
  ClusterEvent takenEvent1=safeTake(queue,service);
  Assert.assertEquals(takenEvent1.getName(),"event1");
  Assert.assertEquals(takenEvent1.getAttribute("attr"),1);
  Assert.assertEquals(queue.size(),1);
  ClusterEvent takenEvent2=safeTake(queue,service);
  Assert.assertEquals(takenEvent2.getName(),"event2");
  Assert.assertEquals(queue.size(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestMessageThrottleStage </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testMsgThrottleConstraints() throws Exception {
  String clusterName="CLUSTER_" + _className + "_constraints";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  List<IdealState> idealStates=HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},new String[]{"TestDB"},1,2);
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  ZNRecord record=new ZNRecord(ConstraintType.MESSAGE_CONSTRAINT.toString());
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","ANY");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","50");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint2").put("INSTANCE",".*");
  record.getMapField("constraint2").put("RESOURCE","TestDB");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint3").put("INSTANCE","localhost_1");
  record.getMapField("constraint3").put("RESOURCE",".*");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint3"));
  record.setMapField("constraint4",new TreeMap<String,String>());
  record.getMapField("constraint4").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint4").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint4").put("INSTANCE",".*");
  record.getMapField("constraint4").put("RESOURCE",".*");
  record.getMapField("constraint4").put("CONSTRAINT_VALUE","10");
  ConstraintItem constraint4=new ConstraintItem(record.getMapField("constraint4"));
  record.setMapField("constraint5",new TreeMap<String,String>());
  record.getMapField("constraint5").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint5").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint5").put("INSTANCE","localhost_0");
  record.getMapField("constraint5").put("RESOURCE","TestDB");
  record.getMapField("constraint5").put("CONSTRAINT_VALUE","3");
  ConstraintItem constraint5=new ConstraintItem(record.getMapField("constraint5"));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  ClusterConstraints constraint=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  MessageThrottleStage throttleStage=new MessageThrottleStage();
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Map<ConstraintAttribute,String> msgAttr=ClusterConstraints.toConstraintAttributes(msg1);
  Set<ConstraintItem> matches=constraint.match(msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(containsConstraint(matches,constraint0));
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint2));
  Assert.assertTrue(containsConstraint(matches,constraint4));
  Assert.assertTrue(containsConstraint(matches,constraint5));
  matches=throttleStage.selectConstraints(matches,msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint5));
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_1");
  msgAttr=ClusterConstraints.toConstraintAttributes(msg2);
  matches=constraint.match(msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(containsConstraint(matches,constraint0));
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint2));
  Assert.assertTrue(containsConstraint(matches,constraint3));
  Assert.assertTrue(containsConstraint(matches,constraint4));
  matches=throttleStage.selectConstraints(matches,msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint3));
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  BestPossibleStateOutput bestPossOutput=getEmptyBestPossibleStateOutput(idealStates);
  event.addAttribute(AttributeName.BEST_POSSIBLE_STATE.toString(),bestPossOutput);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runStage(event,new ResourceComputationStage());
  MessageOutput msgSelectOutput=new MessageOutput();
  Message msg3=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-003"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg4=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-004"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg5=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-005"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg6=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-006"),"OFFLINE","SLAVE","TestDB","localhost_1");
  List<Message> selectMessages=new ArrayList<Message>();
  selectMessages.add(msg1);
  selectMessages.add(msg2);
  selectMessages.add(msg3);
  selectMessages.add(msg4);
  selectMessages.add(msg5);
  selectMessages.add(msg6);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"),selectMessages);
  event.addAttribute(AttributeName.MESSAGES_SELECTED.toString(),msgSelectOutput);
  HelixTestUtil.runStage(event,throttleStage);
  MessageOutput msgThrottleOutput=event.getAttribute(AttributeName.MESSAGES_THROTTLE.toString());
  List<Message> throttleMessages=msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"));
  Assert.assertEquals(throttleMessages.size(),4);
  Assert.assertTrue(throttleMessages.contains(msg1));
  Assert.assertTrue(throttleMessages.contains(msg2));
  Assert.assertTrue(throttleMessages.contains(msg3));
  Assert.assertTrue(throttleMessages.contains(msg4));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestRebalancePipeline </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDuplicateMsg(){
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  final String resourceName="testResource_dup";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  Pipeline rebalancePipeline=new Pipeline();
  rebalancePipeline.addStage(new ResourceComputationStage());
  rebalancePipeline.addStage(new CurrentStateComputationStage());
  rebalancePipeline.addStage(new BestPossibleStateCalcStage());
  rebalancePipeline.addStage(new MessageGenerationStage());
  rebalancePipeline.addStage(new MessageSelectionStage());
  rebalancePipeline.addStage(new MessageThrottleStage());
  rebalancePipeline.addStage(new TaskAssignmentStage());
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","OFFLINE");
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  MessageOutput msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  List<Message> messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: OFFLINE-SLAVE for node0");
  Message message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTypedToState().toString(),"SLAVE");
  Assert.assertEquals(message.getTgtName(),"localhost_0");
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),0,"Should NOT output 1 message: SLAVE-MASTER for node1");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMasterXfer(){
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  final String resourceName="testResource_xfer";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  Pipeline rebalancePipeline=new Pipeline();
  rebalancePipeline.addStage(new ResourceComputationStage());
  rebalancePipeline.addStage(new CurrentStateComputationStage());
  rebalancePipeline.addStage(new BestPossibleStateCalcStage());
  rebalancePipeline.addStage(new MessageGenerationStage());
  rebalancePipeline.addStage(new MessageSelectionStage());
  rebalancePipeline.addStage(new MessageThrottleStage());
  rebalancePipeline.addStage(new TaskAssignmentStage());
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  MessageOutput msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  List<Message> messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: SLAVE-MASTER for node1");
  Message message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"SLAVE");
  Assert.assertEquals(message.getTypedToState().toString(),"MASTER");
  Assert.assertEquals(message.getTgtName(),"localhost_1");
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0});
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),0,"Should NOT output 1 message: SLAVE-MASTER for node0");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testChangeIdealStateWithPendingMsg(){
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  ClusterDataCache cache=new ClusterDataCache();
  event.addAttribute("ClusterDataCache",cache);
  final String resourceName="testResource_pending";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  Pipeline rebalancePipeline=new Pipeline();
  rebalancePipeline.addStage(new ResourceComputationStage());
  rebalancePipeline.addStage(new CurrentStateComputationStage());
  rebalancePipeline.addStage(new BestPossibleStateCalcStage());
  rebalancePipeline.addStage(new MessageGenerationStage());
  rebalancePipeline.addStage(new MessageSelectionStage());
  rebalancePipeline.addStage(new MessageThrottleStage());
  rebalancePipeline.addStage(new TaskAssignmentStage());
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","OFFLINE");
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  MessageOutput msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  List<Message> messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: OFFLINE-SLAVE for node0");
  Message message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTypedToState().toString(),"SLAVE");
  Assert.assertEquals(message.getTgtName(),"localhost_0");
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.dropResource(clusterName,resourceName);
  List<IdealState> idealStates=accessor.getChildValues(accessor.keyBuilder().idealStates());
  cache.setIdealStates(idealStates);
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output only 1 message: OFFLINE->DROPPED for localhost_1");
  message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"SLAVE");
  Assert.assertEquals(message.getTypedToState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTgtName(),"localhost_1");
  Builder keyBuilder=accessor.keyBuilder();
  List<String> msgIds=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  accessor.removeProperty(keyBuilder.message("localhost_0",msgIds.get(0)));
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: OFFLINE->DROPPED for localhost_0");
  message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTypedToState().toString(),"DROPPED");
  Assert.assertEquals(message.getTgtName(),"localhost_0");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMsgTriggeredRebalance() throws Exception {
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final String resourceName="testResource_dup";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Thread.sleep(1000);
  Builder keyBuilder=accessor.keyBuilder();
  List<String> messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  Assert.assertEquals(messages.size(),1);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_1"));
  Assert.assertEquals(messages.size(),1);
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","SLAVE");
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  Thread.sleep(1000);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  Assert.assertEquals(messages.size(),1);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_1"));
  Assert.assertEquals(messages.size(),1);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  accessor.removeProperty(keyBuilder.message("localhost_0",messages.get(0)));
  Thread.sleep(1000);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  Assert.assertEquals(messages.size(),1);
  ZNRecord msg=accessor.getProperty(keyBuilder.message("localhost_0",messages.get(0))).getRecord();
  String toState=msg.getSimpleField(Attributes.TO_STATE.toString());
  Assert.assertEquals(toState,"MASTER");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestResourceComputationStage </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResources() throws Exception {
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResourcesWithSomeDropped() throws Exception {
  int nodes=5;
  List<String> instances=new ArrayList<String>();
  for (int i=0; i < nodes; i++) {
    instances.add("localhost_" + i);
  }
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=new ArrayList<IdealState>();
  for (int i=0; i < resources.length; i++) {
    int partitions=10;
    int replicas=1;
    String resourceName=resources[i];
    ZNRecord record=DefaultTwoStateStrategy.calculateIdealState(instances,partitions,replicas,resourceName,"MASTER","SLAVE");
    IdealState idealState=new IdealState(record);
    idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
    HelixDataAccessor accessor=manager.getHelixDataAccessor();
    Builder keyBuilder=accessor.keyBuilder();
    accessor.setProperty(keyBuilder.idealStates(resourceName),idealState);
    idealStates.add(idealState);
  }
  String instanceName="localhost_" + 3;
  LiveInstance liveInstance=new LiveInstance(instanceName);
  String sessionId=UUID.randomUUID().toString();
  liveInstance.setSessionId(sessionId);
  InstanceConfig instanceConfig=new InstanceConfig(instanceName);
  instanceConfig.setHostName("localhost");
  instanceConfig.setPort("3");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.liveInstance(instanceName),liveInstance);
  accessor.setProperty(keyBuilder.instanceConfig(instanceName),instanceConfig);
  String oldResource="testResourceOld";
  CurrentState currentState=new CurrentState(oldResource);
  currentState.setState(PartitionId.from("testResourceOld_0"),State.from("OFFLINE"));
  currentState.setState(PartitionId.from("testResourceOld_1"),State.from("SLAVE"));
  currentState.setState(PartitionId.from("testResourceOld_2"),State.from("MASTER"));
  currentState.setStateModelDefRef("MasterSlave");
  accessor.setProperty(keyBuilder.currentState(instanceName,sessionId,oldResource),currentState);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length + 1,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
  ResourceId oldResourceId=ResourceId.from(oldResource);
  AssertJUnit.assertTrue(resourceMap.containsKey(oldResourceId));
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getId(),oldResourceId);
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getIdealState().getStateModelDefId(),currentState.getStateModelDefId());
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getSubUnitSet().size(),currentState.getTypedPartitionStateMap().size());
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Case where we have one resource in IdealState
 * @throws Exception
 */
@Test public void testSimple() throws Exception {
  int nodes=5;
  List<String> instances=new ArrayList<String>();
  for (int i=0; i < nodes; i++) {
    instances.add("localhost_" + i);
  }
  int partitions=10;
  int replicas=1;
  String resourceName="testResource";
  ZNRecord record=DefaultTwoStateStrategy.calculateIdealState(instances,partitions,replicas,resourceName,"MASTER","SLAVE");
  IdealState idealState=new IdealState(record);
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.idealStates(resourceName),idealState);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resource=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(1,resource.size());
  AssertJUnit.assertEquals(resource.keySet().iterator().next(),ResourceId.from(resourceName));
  AssertJUnit.assertEquals(resource.values().iterator().next().getId(),ResourceId.from(resourceName));
  AssertJUnit.assertEquals(resource.values().iterator().next().getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
  AssertJUnit.assertEquals(resource.values().iterator().next().getSubUnitSet().size(),partitions);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestStagesWithLogicalAccessors </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadClusterDataStage(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  ClusterAccessor clusterAccessor=new ClusterAccessor(_clusterId,_dataAccessor);
  Cluster cluster=clusterAccessor.readCluster();
  ClusterId id=cluster.getId();
  Assert.assertEquals(id,_clusterId);
  Map<ParticipantId,Participant> liveParticipantMap=cluster.getLiveParticipantMap();
  Assert.assertEquals(liveParticipantMap.size(),n);
  for (  ParticipantId participantId : liveParticipantMap.keySet()) {
    Participant participant=liveParticipantMap.get(participantId);
    Map<ResourceId,CurrentState> curStateMap=participant.getCurrentStateMap();
    Assert.assertEquals(curStateMap.size(),1);
    ResourceId resourceId=ResourceId.from("TestDB0");
    Assert.assertTrue(curStateMap.containsKey(resourceId));
    CurrentState curState=curStateMap.get(resourceId);
    Map<PartitionId,State> partitionStateMap=curState.getTypedPartitionStateMap();
    Assert.assertEquals(partitionStateMap.size(),p);
  }
  Map<ResourceId,Resource> resourceMap=cluster.getResourceMap();
  Assert.assertEquals(resourceMap.size(),1);
  ResourceId resourceId=ResourceId.from("TestDB0");
  Assert.assertTrue(resourceMap.containsKey(resourceId));
  Resource resource=resourceMap.get(resourceId);
  Assert.assertNotNull(resource.getIdealState());
  Assert.assertEquals(resource.getIdealState().getRebalanceMode(),RebalanceMode.SEMI_AUTO);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.strategy.TestAutoRebalanceStrategy </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests the following scenario: there is only a single partition for a resource. Two nodes up,
 * partition should
 * be assigned to one of them. Take down that node, partition should move. Bring back up that
 * node, partition should not move unnecessarily.
 */
@Test public void testWontMoveSinglePartitionUnnecessarily(){
  final ResourceId RESOURCE=ResourceId.from("resource");
  final PartitionId partition=PartitionId.from("resource_0");
  final StateModelDefinition STATE_MODEL=new StateModelDefinition(StateModelConfigGenerator.generateConfigForOnlineOffline());
  LinkedHashMap<State,Integer> stateCount=Maps.newLinkedHashMap();
  stateCount.put(State.from("ONLINE"),1);
  final ParticipantId[] NODES={ParticipantId.from("n0"),ParticipantId.from("n1")};
  ReplicaPlacementScheme scheme=new AutoRebalanceStrategy.DefaultPlacementScheme();
  List<ParticipantId> allNodes=Lists.newArrayList(NODES);
  List<ParticipantId> liveNodes=Lists.newArrayList(NODES);
  Map<PartitionId,Map<ParticipantId,State>> currentMapping=Maps.newHashMap();
  currentMapping.put(partition,new HashMap<ParticipantId,State>());
  List<PartitionId> partitions=Lists.newArrayList(partition);
  Map<State,String> upperBounds=Maps.newHashMap();
  for (  State state : STATE_MODEL.getTypedStatesPriorityList()) {
    upperBounds.put(state,STATE_MODEL.getNumParticipantsPerState(state));
  }
  ZNRecord znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  Map<String,List<String>> preferenceLists=znRecord.getListFields();
  List<String> preferenceList=preferenceLists.get(partition.toString());
  Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
  Assert.assertEquals(preferenceList.size(),1,"invalid preference list for " + partition);
  String state=znRecord.getMapField(partition.toString()).get(preferenceList.get(0));
  Assert.assertEquals(state,"ONLINE","Invalid state for " + partition);
  ParticipantId preferredNode=ParticipantId.from(preferenceList.get(0));
  ParticipantId otherNode=preferredNode.equals(NODES[0]) ? NODES[1] : NODES[0];
  currentMapping.get(partition).put(otherNode,State.from(state));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  preferenceList=preferenceLists.get(partition.toString());
  Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
  Assert.assertEquals(preferenceList.size(),1,"invalid preference list for " + partition);
  state=znRecord.getMapField(partition.toString()).get(preferenceList.get(0));
  Assert.assertEquals(state,"ONLINE","Invalid state for " + partition);
  ParticipantId finalPreferredNode=ParticipantId.from(preferenceList.get(0));
  Assert.assertEquals(finalPreferredNode,otherNode);
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 type-11 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests the following scenario: nodes come up one by one, then one node is taken down. Preference
 * lists should prefer nodes in the current mapping at all times, but when all nodes are in the
 * current mapping, then it should distribute states as evenly as possible.
 */
@Test public void testOrphansNotPreferred(){
  final ResourceId RESOURCE=ResourceId.from("resource");
  final PartitionId[] PARTITIONS={PartitionId.from("resource_0"),PartitionId.from("resource_1"),PartitionId.from("resource_2")};
  final StateModelDefinition STATE_MODEL=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  final int REPLICA_COUNT=2;
  final ParticipantId[] NODES={ParticipantId.from("n0"),ParticipantId.from("n1"),ParticipantId.from("n2")};
  ReplicaPlacementScheme scheme=new AutoRebalanceStrategy.DefaultPlacementScheme();
  List<ParticipantId> allNodes=Lists.newArrayList(NODES[0]);
  List<ParticipantId> liveNodes=Lists.newArrayList(NODES[0]);
  Map<PartitionId,Map<ParticipantId,State>> currentMapping=Maps.newHashMap();
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.put(partition,new HashMap<ParticipantId,State>());
  }
  List<PartitionId> partitions=ImmutableList.copyOf(PARTITIONS);
  Map<State,String> upperBounds=Maps.newHashMap();
  for (  State state : STATE_MODEL.getTypedStatesPriorityList()) {
    upperBounds.put(state,STATE_MODEL.getNumParticipantsPerState(state));
  }
  LinkedHashMap<State,Integer> stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  ZNRecord znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  Map<String,List<String>> preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),1,"invalid preference list for " + partition);
  }
  allNodes.add(NODES[1]);
  liveNodes.add(NODES[1]);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).put(NODES[0],State.from("MASTER"));
  }
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.get(0),NODES[0].toString(),"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.get(1),NODES[1].toString(),"invalid preference list for " + partition);
  }
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).put(NODES[1],State.from("SLAVE"));
  }
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  Set<String> firstNodes=Sets.newHashSet();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
  }
  Assert.assertEquals(firstNodes.size(),2,"masters not evenly distributed");
  allNodes.add(NODES[2]);
  liveNodes.add(NODES[2]);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  currentMapping.get(PARTITIONS[1]).put(NODES[0],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  boolean newNodeUsed=false;
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    if (preferenceList.contains(NODES[2].toString())) {
      newNodeUsed=true;
      Assert.assertEquals(preferenceList.get(1),NODES[2].toString(),"newly added node not at preference list tail for " + partition);
    }
  }
  Assert.assertTrue(newNodeUsed,"not using " + NODES[2]);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[0],State.from("MASTER"));
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[0],State.from("MASTER"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("SLAVE"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  firstNodes.clear();
  Set<String> secondNodes=Sets.newHashSet();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
    secondNodes.add(preferenceList.get(1));
  }
  Assert.assertEquals(firstNodes.size(),3,"masters not distributed evenly");
  Assert.assertEquals(secondNodes.size(),3,"slaves not distributed evenly");
  liveNodes.remove(0);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    Map<ParticipantId,State> stateMap=currentMapping.get(partition);
    for (    ParticipantId participant : stateMap.keySet()) {
      Assert.assertTrue(preferenceList.contains(participant.toString()),"minimal movement violated for " + partition);
    }
    for (    String participant : preferenceList) {
      if (!stateMap.containsKey(ParticipantId.from(participant))) {
        Assert.assertNotSame(preferenceList.get(0),participant,"newly moved replica should not be master for " + partition);
      }
    }
  }
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[0]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("MASTER"));
  currentMapping.get(PARTITIONS[2]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  firstNodes.clear();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
  }
  Assert.assertEquals(firstNodes.size(),2,"masters not evenly distributed");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.strategy.TestEspressoStorageClusterIdealState </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testEspressoStorageClusterIdealState() throws Exception {
  List<String> instanceNames=new ArrayList<String>();
  for (int i=0; i < 5; i++) {
    instanceNames.add("localhost:123" + i);
  }
  int partitions=8, replicas=0;
  Map<String,Object> result0=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  Verify(result0,partitions,replicas);
  partitions=8192;
  replicas=3;
  instanceNames.clear();
  for (int i=0; i < 20; i++) {
    instanceNames.add("localhost:123" + i);
  }
  Map<String,Object> resultOriginal=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  Verify(resultOriginal,partitions,replicas);
  printStat(resultOriginal);
  Map<String,Object> result1=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  List<String> instanceNames2=new ArrayList<String>();
  for (int i=30; i < 35; i++) {
    instanceNames2.add("localhost:123" + i);
  }
  DefaultTwoStateStrategy.calculateNextIdealState(instanceNames2,result1);
  List<String> instanceNames3=new ArrayList<String>();
  for (int i=35; i < 40; i++) {
    instanceNames3.add("localhost:123" + i);
  }
  DefaultTwoStateStrategy.calculateNextIdealState(instanceNames3,result1);
  Double masterKeepRatio=0.0, slaveKeepRatio=0.0;
  Verify(result1,partitions,replicas);
  double[] result=compareResult(resultOriginal,result1);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(0.66 < masterKeepRatio && 0.67 > masterKeepRatio);
  Assert.assertTrue(0.66 < slaveKeepRatio && 0.67 > slaveKeepRatio);
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testRebalance2(){
  int partitions=1256, replicas=3;
  List<String> instanceNames=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    instanceNames.add("localhost:123" + i);
  }
  Map<String,Object> resultOriginal=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  ZNRecord idealState1=DefaultTwoStateStrategy.convertToZNRecord(resultOriginal,"TestDB","MASTER","SLAVE");
  Map<String,Object> result1=RebalanceUtil.buildInternalIdealState(new IdealState(idealState1));
  List<String> instanceNames2=new ArrayList<String>();
  for (int i=30; i < 35; i++) {
    instanceNames2.add("localhost:123" + i);
  }
  Map<String,Object> result2=DefaultTwoStateStrategy.calculateNextIdealState(instanceNames2,result1);
  Verify(resultOriginal,partitions,replicas);
  Verify(result2,partitions,replicas);
  Double masterKeepRatio=0.0, slaveKeepRatio=0.0;
  double[] result=compareResult(resultOriginal,result2);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(0.66 < masterKeepRatio && 0.67 > masterKeepRatio);
  Assert.assertTrue(0.66 < slaveKeepRatio && 0.67 > slaveKeepRatio);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.strategy.TestShufflingTwoStateStrategy </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testInvocation() throws Exception {
  int partitions=6, replicas=2;
  String dbName="espressoDB1";
  List<String> instanceNames=new ArrayList<String>();
  instanceNames.add("localhost_1231");
  instanceNames.add("localhost_1232");
  instanceNames.add("localhost_1233");
  instanceNames.add("localhost_1234");
  ZNRecord result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  ZNRecord result2=RUSHMasterSlaveStrategy.calculateIdealState(instanceNames,1,partitions,replicas,dbName);
  ZNRecord result3=ConsistentHashingMasterSlaveStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName,new ConsistentHashingMasterSlaveStrategy.FnvHash());
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result3,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result3,"SLAVE");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result3,"");
  ConsistentHashingMasterSlaveStrategy.printNodeOfflineOverhead(result3);
  ObjectMapper mapper=new ObjectMapper();
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,result);
  ZNRecord zn=mapper.readValue(new StringReader(sw.toString()),ZNRecord.class);
  System.out.println(result.toString());
  System.out.println(zn.toString());
  AssertJUnit.assertTrue(zn.toString().equalsIgnoreCase(result.toString()));
  System.out.println();
  sw=new StringWriter();
  mapper.writeValue(sw,result2);
  ZNRecord zn2=mapper.readValue(new StringReader(sw.toString()),ZNRecord.class);
  System.out.println(result2.toString());
  System.out.println(zn2.toString());
  AssertJUnit.assertTrue(zn2.toString().equalsIgnoreCase(result2.toString()));
  sw=new StringWriter();
  mapper.writeValue(sw,result3);
  System.out.println();
  ZNRecord zn3=mapper.readValue(new StringReader(sw.toString()),ZNRecord.class);
  System.out.println(result3.toString());
  System.out.println(zn3.toString());
  AssertJUnit.assertTrue(zn3.toString().equalsIgnoreCase(result3.toString()));
  System.out.println();
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testShuffledIdealState(){
  int partitions=6, replicas=2, instances=4;
  String dbName="espressoDB1";
  List<String> instanceNames=new ArrayList<String>();
  instanceNames.add("localhost_1231");
  instanceNames.add("localhost_1232");
  instanceNames.add("localhost_1233");
  instanceNames.add("localhost_1234");
  ZNRecord result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=3;
  instances=7;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=14;
  replicas=3;
  instances=7;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=3;
  instances=8;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=3;
  instances=12;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=2;
  instances=12;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAddNodeAfterControllerStart </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testStandalone() throws Exception {
  String testName=TestUtil.getTestName();
  String clusterName=testName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  final int nodeNr=5;
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,20,nodeNr - 1,3,"MasterSlave",true);
  MockParticipant[] participants=new MockParticipant[nodeNr];
  for (int i=0; i < nodeNr - 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  boolean result;
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12918");
  result=checkHandlers(controller.getHandlers(),msgPath);
  Assert.assertTrue(result);
  _setupTool.addInstanceToCluster(clusterName,"localhost_12922");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",3);
  participants[nodeNr - 1]=new MockParticipant(_zkaddr,clusterName,"localhost_12922");
  new Thread(participants[nodeNr - 1]).start();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12922");
  result=checkHandlers(controller.getHandlers(),msgPath);
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < nodeNr; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiCluster() throws Exception {
  String testName=TestUtil.getTestName();
  String clusterName=testName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  final String grandClusterName="GRAND_" + clusterName;
  TestHelper.setupCluster(grandClusterName,_zkaddr,0,"controller",null,0,0,1,0,null,true);
  MockMultiClusterController multiClusterController=new MockMultiClusterController(_zkaddr,grandClusterName,"controller_0");
  multiClusterController.syncStart();
  _setupTool.addCluster(clusterName,true);
  _setupTool.activateCluster(clusterName,"GRAND_" + clusterName,true);
  boolean result;
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,"GRAND_" + clusterName));
  Assert.assertTrue(result);
  final int nodeNr=2;
  for (int i=0; i < nodeNr - 1; i++) {
    int port=12918 + i;
    _setupTool.addInstanceToCluster(clusterName,"localhost_" + port);
  }
  _setupTool.addResourceToCluster(clusterName,"TestDB0",1,"LeaderStandby");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",1);
  MockParticipant[] participants=new MockParticipant[nodeNr];
  for (int i=0; i < nodeNr - 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12918");
  int numberOfListeners=ZkTestHelper.numberOfListeners(_zkaddr,msgPath);
  Assert.assertEquals(numberOfListeners,2);
  _setupTool.addInstanceToCluster(clusterName,"localhost_12919");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",2);
  participants[nodeNr - 1]=new MockParticipant(_zkaddr,clusterName,"localhost_12919");
  participants[nodeNr - 1].syncStart();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12919");
  numberOfListeners=ZkTestHelper.numberOfListeners(_zkaddr,msgPath);
  Assert.assertEquals(numberOfListeners,2);
  multiClusterController.syncStop();
  for (int i=0; i < nodeNr; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAddStateModelFactoryAfterConnect </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  _setupTool.addResourceToCluster(clusterName,"TestDB1",16,"MasterSlave");
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB1"));
  idealState.setStateModelFactoryId(StateModelFactoryId.from("TestDB1_Factory"));
  accessor.setProperty(keyBuilder.idealStates("TestDB1"),idealState);
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB1",3);
  int totalMsgs=0;
  for (int retry=0; retry < 5; retry++) {
    Thread.sleep(100);
    totalMsgs=0;
    for (int i=0; i < n; i++) {
      List<Message> msgs=accessor.getChildValues(keyBuilder.messages(participants[i].getInstanceName()));
      totalMsgs+=msgs.size();
    }
    if (totalMsgs == 48)     break;
  }
  Assert.assertEquals(totalMsgs,48,"Should accumulated 48 unprocessed messages (1 O->S per partition per replica) because TestDB1 is added without state-model-factory but was " + totalMsgs);
  for (int i=0; i < n; i++) {
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,"TestDB1_Factory",new MockMSModelFactory());
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDisable </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisablePartitionAutoIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enablePartition false "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put("localhost_12919","OFFLINE");
  expectStateMap.put("TestDB0_0",expectInstanceStateMap);
  expectStateMap.put("TestDB0_5",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,"localhost_12919" + " should be in OFFLINE for [TestDB0_0, TestDB0_5]");
  command="--zkSvr " + _zkaddr + " --enablePartition true "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,"localhost_12919" + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisablePartitionCustomIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enablePartition false "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put("localhost_12919","OFFLINE");
  expectStateMap.put("TestDB0_0",expectInstanceStateMap);
  expectStateMap.put("TestDB0_5",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,"localhost_12919" + " should be in OFFLINE for [TestDB0_0, TestDB0_5]");
  command="--zkSvr " + _zkaddr + " --enablePartition true "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,"localhost_12919" + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisableNodeAutoIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  String disableNode="localhost_12919";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " false";
  ClusterSetup.processCommandLineArgs(command.split(" "));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put(disableNode,"OFFLINE");
  expectStateMap.put(".*",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,disableNode + " should be in OFFLINE");
  command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,disableNode + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisableNodeCustomIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  String disableNode="localhost_12918";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " false";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put(disableNode,"OFFLINE");
  expectStateMap.put(".*",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,disableNode + " should be in OFFLINE");
  command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,disableNode + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDisableCustomCodeRunner </h4><pre class="type-7 type-14 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,PARTITION_NUM,N,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  Map<String,HelixCustomCodeRunner> customCodeRunners=new HashMap<String,HelixCustomCodeRunner>();
  Map<String,DummyCallback> callbacks=new HashMap<String,DummyCallback>();
  for (int i=0; i < N; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants.put(instanceName,new MockParticipant(_zkaddr,clusterName,instanceName));
    customCodeRunners.put(instanceName,new HelixCustomCodeRunner(participants.get(instanceName),_zkaddr));
    callbacks.put(instanceName,new DummyCallback());
    customCodeRunners.get(instanceName).invoke(callbacks.get(instanceName)).on(ChangeType.LIVE_INSTANCE).usingLeaderStandbyModel("TestParticLeader").start();
    participants.get(instanceName).syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  final String customCodeRunnerResource=customCodeRunners.get("localhost_12918").getResourceName();
  ExternalView extView=accessor.getProperty(keyBuilder.externalView(customCodeRunnerResource));
  Map<String,String> instanceStates=extView.getStateMap(customCodeRunnerResource + "_0");
  String leader=null;
  for (  String instance : instanceStates.keySet()) {
    String state=instanceStates.get(instance);
    if ("LEADER".equals(state)) {
      leader=instance;
      break;
    }
  }
  Assert.assertNotNull(leader);
  for (  String instance : callbacks.keySet()) {
    DummyCallback callback=callbacks.get(instance);
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isInitTypeInvoked());
    }
 else {
      Assert.assertFalse(callback.isInitTypeInvoked());
    }
    callback.reset();
  }
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.enableResource(clusterName,customCodeRunnerResource,false);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      PropertyKey.Builder keyBuilder=accessor.keyBuilder();
      ExternalView extView=accessor.getProperty(keyBuilder.externalView(customCodeRunnerResource));
      if (extView == null) {
        return false;
      }
      Set<String> partitionSet=extView.getPartitionSet();
      if (partitionSet == null || partitionSet.size() != PARTITION_NUM) {
        return false;
      }
      for (      String partition : partitionSet) {
        Map<String,String> instanceStates=extView.getStateMap(partition);
        for (        String state : instanceStates.values()) {
          if (!"OFFLINE".equals(state)) {
            return false;
          }
        }
      }
      return true;
    }
  }
,10 * 1000);
  Assert.assertTrue(result);
  LiveInstance fakeInstance=new LiveInstance("fakeInstance");
  fakeInstance.setSessionId("fakeSessionId");
  fakeInstance.setHelixVersion("0.6");
  accessor.setProperty(keyBuilder.liveInstance("fakeInstance"),fakeInstance);
  Thread.sleep(1000);
  for (  Map.Entry<String,DummyCallback> e : callbacks.entrySet()) {
    String instance=e.getKey();
    DummyCallback callback=e.getValue();
    Assert.assertFalse(callback.isInitTypeInvoked());
    Assert.assertFalse(callback.isCallbackTypeInvoked());
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isFinalizeTypeInvoked());
    }
  }
  accessor.removeProperty(keyBuilder.liveInstance("fakeInstance"));
  admin.enableResource(clusterName,customCodeRunnerResource,true);
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  extView=accessor.getProperty(keyBuilder.externalView(customCodeRunnerResource));
  instanceStates=extView.getStateMap(customCodeRunnerResource + "_0");
  leader=null;
  for (  String instance : instanceStates.keySet()) {
    String state=instanceStates.get(instance);
    if ("LEADER".equals(state)) {
      leader=instance;
      break;
    }
  }
  Assert.assertNotNull(leader);
  for (  String instance : callbacks.keySet()) {
    DummyCallback callback=callbacks.get(instance);
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isInitTypeInvoked());
    }
 else {
      Assert.assertFalse(callback.isInitTypeInvoked());
    }
    callback.reset();
  }
  accessor.setProperty(keyBuilder.liveInstance("fakeInstance"),fakeInstance);
  Thread.sleep(1000);
  for (  String instance : callbacks.keySet()) {
    DummyCallback callback=callbacks.get(instance);
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isCallbackTypeInvoked());
    }
 else {
      Assert.assertFalse(callback.isCallbackTypeInvoked());
    }
  }
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDrop </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailToDropResourceWithErrorPartitionSemiAuto() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errTransitions=new HashMap<String,Set<String>>();
  errTransitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errTransitions.put("ERROR-DROPPED",TestHelper.setOf("TestDB0_4"));
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errTransitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropResource",clusterName,"TestDB0"});
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  InstanceConfig config=accessor.getProperty(keyBuilder.instanceConfig("localhost_12918"));
  List<String> disabledPartitions=config.getDisabledPartitions();
  Assert.assertEquals(disabledPartitions.size(),1,"TestDB0_4 should be disabled");
  Assert.assertEquals(disabledPartitions.get(0),"TestDB0_4");
  ExternalView ev=accessor.getProperty(keyBuilder.externalView("TestDB0"));
  Set<String> partitions=ev.getPartitionSet();
  Assert.assertEquals(partitions.size(),1,"Should have TestDB0_4->localhost_12918->ERROR");
  String errPartition=partitions.iterator().next();
  Assert.assertEquals(errPartition,"TestDB0_4");
  Map<String,String> stateMap=ev.getStateMap(errPartition);
  Assert.assertEquals(stateMap.size(),1);
  Assert.assertEquals(stateMap.keySet().iterator().next(),"localhost_12918");
  Assert.assertEquals(stateMap.get("localhost_12918"),HelixDefinedState.ERROR.name());
  CurrentState cs=accessor.getProperty(keyBuilder.currentState(participants[0].getInstanceName(),participants[0].getSessionId(),"TestDB0"));
  Map<String,String> partitionStateMap=cs.getPartitionStateMap();
  Assert.assertEquals(partitionStateMap.size(),1);
  Assert.assertEquals(partitionStateMap.keySet().iterator().next(),"TestDB0_4");
  Assert.assertEquals(partitionStateMap.get("TestDB0_4"),HelixDefinedState.ERROR.name());
  for (int i=1; i < n; i++) {
    String instanceName=participants[i].getInstanceName();
    String sessionId=participants[i].getSessionId();
    Assert.assertNull(accessor.getProperty(keyBuilder.currentState(instanceName,sessionId,"TestDB0")));
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestExpandCluster </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testExpandCluster() throws Exception {
  String DB2="TestDB2";
  int partitions=100;
  int replica=3;
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB2,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB2,replica,"keyX");
  String DB3="TestDB3";
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB3,partitions,STATE_MODEL);
  IdealState testDB0=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,TEST_DB);
  IdealState testDB2=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB2);
  IdealState testDB3=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB3);
  for (int i=0; i < 5; i++) {
    String storageNodeName="localhost_" + (27960 + i);
    _setupTool.addInstanceToCluster(CLUSTER_NAME,storageNodeName);
  }
  String command="-zkSvr localhost:2183 -expandCluster " + CLUSTER_NAME;
  ClusterSetup.processCommandLineArgs(command.split(" "));
  IdealState testDB0_1=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,TEST_DB);
  IdealState testDB2_1=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB2);
  IdealState testDB3_1=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB3);
  Map<String,Object> resultOld2=RebalanceUtil.buildInternalIdealState(testDB2);
  Map<String,Object> result2=RebalanceUtil.buildInternalIdealState(testDB2_1);
  TestEspressoStorageClusterIdealState.Verify(result2,partitions,replica - 1);
  Double masterKeepRatio=0.0, slaveKeepRatio=0.0;
  double[] result=TestEspressoStorageClusterIdealState.compareResult(resultOld2,result2);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(masterKeepRatio > 0.49 && masterKeepRatio < 0.51);
  Assert.assertTrue(testDB3_1.getRecord().getListFields().size() == 0);
  Assert.assertTrue(testDB0_1.getRecord().getListFields().keySet().containsAll(testDB0.getRecord().getListFields().keySet()));
  Assert.assertTrue(testDB0_1.getRecord().getListFields().size() == testDB0.getRecord().getListFields().size());
  Assert.assertTrue(testDB2_1.getRecord().getMapFields().keySet().containsAll(testDB2.getRecord().getMapFields().keySet()));
  Assert.assertTrue(testDB2_1.getRecord().getMapFields().size() == testDB2.getRecord().getMapFields().size());
  Assert.assertTrue(testDB3_1.getRecord().getMapFields().keySet().containsAll(testDB3.getRecord().getMapFields().keySet()));
  Assert.assertTrue(testDB3_1.getRecord().getMapFields().size() == testDB3.getRecord().getMapFields().size());
  Map<String,Object> resultOld=RebalanceUtil.buildInternalIdealState(testDB0);
  Map<String,Object> resultNew=RebalanceUtil.buildInternalIdealState(testDB0_1);
  result=TestEspressoStorageClusterIdealState.compareResult(resultOld,resultNew);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(masterKeepRatio > 0.49 && masterKeepRatio < 0.51);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestExternalCmd </h4><pre class="type-7 type-1 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testExternalCmd() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  ExternalCommand cmd=ScriptTestHelper.runCommandLineTest("dummy.sh");
  String output=cmd.getStringOutput("UTF8");
  int idx=output.indexOf("this is a dummy test for verify ExternalCommand works");
  Assert.assertNotSame(idx,-1);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestExternalViewUpdates </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testExternalViewUpdates() throws Exception {
  System.out.println("START testExternalViewUpdates at " + new Date(System.currentTimeMillis()));
  String clusterName=TestUtil.getTestName();
  MockParticipant[] participants=new MockParticipant[5];
  int resourceNb=10;
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",resourceNb,1,5,1,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Builder keyBuilder=new Builder(clusterName);
  String parentPath=keyBuilder.externalViews().getPath();
  List<String> childNames=_baseAccessor.getChildNames(parentPath,0);
  List<String> paths=new ArrayList<String>();
  for (  String name : childNames) {
    paths.add(parentPath + "/" + name);
  }
  for (  String path : paths) {
    Stat stat=_baseAccessor.getStat(path,0);
    Assert.assertTrue(stat.getVersion() <= 2,"ExternalView should be updated at most 2 times");
  }
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END testExternalViewUpdates at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestFullAutoNodeTagging </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUntag() throws Exception {
  final int NUM_PARTICIPANTS=2;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=1;
  final String RESOURCE_NAME="TestResource0";
  final String TAG="ASSIGNABLE";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestResource",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"OnlineOffline",RebalanceMode.FULL_AUTO,true);
  final HelixAdmin helixAdmin=new ZKHelixAdmin(_zkclient);
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,RESOURCE_NAME);
  idealState.setInstanceGroupTag(TAG);
  helixAdmin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    helixAdmin.addInstanceTag(clusterName,instanceName,TAG);
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  Verifier v=new Verifier(){
    @Override public boolean verify() throws Exception {
      ExternalView externalView=HelixTestUtil.pollForProperty(ExternalView.class,accessor,keyBuilder.externalView(RESOURCE_NAME),true);
      if (externalView == null) {
        return false;
      }
      Set<String> taggedInstances=Sets.newHashSet(helixAdmin.getInstancesInClusterWithTag(clusterName,TAG));
      Set<String> partitionSet=externalView.getPartitionSet();
      if (partitionSet.size() != NUM_PARTITIONS) {
        return false;
      }
      for (      String partitionName : partitionSet) {
        Map<String,String> stateMap=externalView.getStateMap(partitionName);
        if (stateMap.size() != NUM_REPLICAS) {
          return false;
        }
        for (        String participantName : stateMap.keySet()) {
          if (!taggedInstances.contains(participantName)) {
            return false;
          }
          String state=stateMap.get(participantName);
          if (!state.equalsIgnoreCase("ONLINE")) {
            return false;
          }
        }
      }
      return true;
    }
  }
;
  boolean initialResult=TestHelper.verify(v,10 * 1000);
  Assert.assertTrue(initialResult);
  helixAdmin.removeInstanceTag(clusterName,"localhost_12918",TAG);
  boolean finalResult=TestHelper.verify(v,10 * 1000);
  Assert.assertTrue(finalResult);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * Basic test for tagging behavior. 10 participants, of which 4 are tagged. Launch all 10,
 * checking external view every time a tagged node is started. Then shut down all 10, checking
 * external view every time a tagged node is killed.
 */
@Test public void testSafeAssignment() throws Exception {
  final int NUM_PARTICIPANTS=10;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  final String RESOURCE_NAME="TestDB0";
  final String TAG="ASSIGNABLE";
  final String[] TAGGED_NODES={"localhost_12920","localhost_12922","localhost_12924","localhost_12925"};
  Set<String> taggedNodes=Sets.newHashSet(TAGGED_NODES);
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  HelixAdmin helixAdmin=new ZKHelixAdmin(_zkaddr);
  for (  String taggedNode : TAGGED_NODES) {
    helixAdmin.addInstanceTag(clusterName,taggedNode,TAG);
  }
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,RESOURCE_NAME);
  idealState.setInstanceGroupTag(TAG);
  helixAdmin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
    if (taggedNodes.contains(instanceName)) {
      Thread.sleep(500);
      boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
      Assert.assertTrue(result);
      result=ClusterStateVerifier.verifyByZkCallback(new TaggedZkVerifier(clusterName,RESOURCE_NAME,TAGGED_NODES,false));
      Assert.assertTrue(result,"initial assignment with all tagged nodes live is invalid");
    }
  }
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    String participantName=participants[i].getInstanceName();
    participants[i].syncStop();
    if (taggedNodes.contains(participantName)) {
      taggedNodes.remove(participantName);
      Thread.sleep(500);
      boolean result=ClusterStateVerifier.verifyByZkCallback(new TaggedZkVerifier(clusterName,RESOURCE_NAME,TAGGED_NODES,taggedNodes.isEmpty()));
      Assert.assertTrue(result,"incorrect state after removing " + participantName + ", "+ taggedNodes+ " remain");
    }
  }
  controller.syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestHelixConnection </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ClusterId clusterId=ClusterId.from(clusterName);
  ControllerId controllerId=ControllerId.from("controller");
  final ParticipantId participantId=ParticipantId.from("participant1");
  ResourceId resourceId=ResourceId.from("testDB");
  State master=State.from("MASTER");
  State slave=State.from("SLAVE");
  State offline=State.from("OFFLINE");
  State dropped=State.from("DROPPED");
  StateModelDefId stateModelDefId=StateModelDefId.from("MasterSlave");
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterAccessor clusterAccessor=connection.createClusterAccessor(clusterId);
  clusterAccessor.dropCluster();
  StateModelDefinition stateModelDef=new StateModelDefinition.Builder(stateModelDefId).addState(master,1).addState(slave,2).addState(offline,3).addState(dropped).addTransition(offline,slave,3).addTransition(slave,offline,4).addTransition(slave,master,2).addTransition(master,slave,1).addTransition(offline,dropped).initialState(offline).upperBound(master,1).dynamicUpperBound(slave,"R").build();
  PartitionId partition0=PartitionId.from(resourceId,"0");
  AutoModeISBuilder idealStateBuilder=new AutoModeISBuilder(resourceId).add(partition0);
  idealStateBuilder.setNumReplica(1).setStateModelDefId(stateModelDefId);
  idealStateBuilder.assignPreferenceList(partition0,participantId);
  IdealState idealState=idealStateBuilder.build();
  clusterAccessor.createCluster(new ClusterConfig.Builder(clusterId).addStateModelDefinition(stateModelDef).build());
  clusterAccessor.addResource(new ResourceConfig.Builder(resourceId).idealState(idealState).build());
  clusterAccessor.addParticipant(new ParticipantConfig.Builder(participantId).build());
  HelixController controller=connection.createController(clusterId,controllerId);
  controller.start();
  HelixParticipant participant=connection.createParticipant(clusterId,participantId);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("MasterSlave"),new MockStateModelFactory());
  participant.start();
  Thread.sleep(1000);
  final HelixDataAccessor accessor=connection.createDataAccessor(clusterId);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      ExternalView externalView=accessor.getProperty(keyBuilder.externalView("testDB"));
      Map<ParticipantId,State> stateMap=externalView.getStateMap(PartitionId.from("testDB_0"));
      if (stateMap == null || !stateMap.containsKey(participantId)) {
        return false;
      }
      return stateMap.get(participantId).equals(State.from("MASTER"));
    }
  }
,10 * 1000);
  Assert.assertTrue(success);
  controller.stop();
  participant.stop();
  connection.disconnect();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestHelixInstanceTag </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceTag() throws Exception {
  HelixManager manager=_controller;
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  String DB2="TestDB2";
  int partitions=100;
  String DB2tag="TestDB2_tag";
  int replica=2;
  for (int i=0; i < 2; i++) {
    String instanceName="localhost_" + (12918 + i);
    _setupTool.getClusterManagementTool().addInstanceTag(CLUSTER_NAME,instanceName,DB2tag);
  }
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB2,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB2,DB2tag,replica);
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME)));
  Assert.assertTrue(result,"Cluster verification fails");
  ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView(DB2));
  Set<String> hosts=new HashSet<String>();
  for (  String p : ev.getPartitionSet()) {
    for (    String hostName : ev.getStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(hostName));
      Assert.assertTrue(config.containsTag(DB2tag));
      hosts.add(hostName);
    }
  }
  Assert.assertEquals(hosts.size(),2);
  String DB3="TestDB3";
  String DB3Tag="TestDB3_tag";
  partitions=10;
  replica=3;
  for (int i=1; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    _setupTool.getClusterManagementTool().addInstanceTag(CLUSTER_NAME,instanceName,DB3Tag);
  }
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB3,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB3,DB3Tag,replica);
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME)));
  Assert.assertTrue(result,"Cluster verification fails");
  ev=accessor.getProperty(accessor.keyBuilder().externalView(DB3));
  hosts=new HashSet<String>();
  for (  String p : ev.getPartitionSet()) {
    for (    String hostName : ev.getStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(hostName));
      Assert.assertTrue(config.containsTag(DB3Tag));
      hosts.add(hostName);
    }
  }
  Assert.assertEquals(hosts.size(),4);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestMessagingService </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testMessageSimpleSend() throws Exception {
  String hostSrc="localhost_" + START_PORT;
  String hostDest="localhost_" + (START_PORT + 1);
  TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
  _participants[1].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  MessageId msgId=MessageId.from(new UUID(123,456).toString());
  Message msg=new Message(factory.getMessageType(),msgId);
  msg.setMessageId(msgId);
  msg.setSrcName(hostSrc);
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setMsgState(MessageState.NEW);
  String para="Testing messaging para";
  msg.getRecord().setSimpleField("TestMessagingPara",para);
  Criteria cr=new Criteria();
  cr.setInstanceName(hostDest);
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  int nMsgs=_participants[0].getMessagingService().send(cr,msg);
  AssertJUnit.assertTrue(nMsgs == 1);
  Thread.sleep(2500);
  AssertJUnit.assertTrue(TestMessagingHandlerFactory._processedMsgIds.contains(para));
  cr=new Criteria();
  cr.setInstanceName(hostDest);
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setDataSource(DataSource.IDEALSTATES);
  nMsgs=_participants[0].getMessagingService().send(cr,msg);
  AssertJUnit.assertTrue(nMsgs == 1);
  Thread.sleep(2500);
  AssertJUnit.assertTrue(TestMessagingHandlerFactory._processedMsgIds.contains(para));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSchedulerMessage </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSchedulerMsgContraints() throws JsonGenerationException, JsonMappingException, IOException, InterruptedException {
  TestMessagingHandlerFactoryLatch factory=new TestMessagingHandlerFactoryLatch();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsgContraints");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("SentMessageCount")) {
      Assert.assertEquals(statusUpdate.getMapFields().get("SentMessageCount").get("MessageCount"),"" + (_PARTITIONS * 3));
      break;
    }
  }
  for (int i=0; i < _PARTITIONS * 3 / 5; i++) {
    for (int j=0; j < 10; j++) {
      Thread.sleep(300);
      if (factory._messageCount == 5 * (i + 1))       break;
    }
    Thread.sleep(300);
    Assert.assertEquals(factory._messageCount,5 * (i + 1));
    factory.signal();
  }
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
  int messageResultCount=0;
  for (  String key : statusUpdate.getMapFields().keySet()) {
    if (key.startsWith("MessageResult ")) {
      messageResultCount++;
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  manager.getClusterManagmentTool().removeConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsgUsingQueue() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg3() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg3");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  for (int i=0; i < 4; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
    Builder keyBuilder=helixDataAccessor.keyBuilder();
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
    boolean success=false;
    for (int j=0; j < 6; j++) {
      int count=0;
      for (      Set<String> val : _factory._results.values()) {
        count+=val.size();
      }
      success=count == _PARTITIONS * 3 / 5 * (i + 1);
      if (success) {
        break;
      }
      Thread.sleep(500);
    }
    Assert.assertTrue(success);
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg2() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg2");
  MockAsyncCallback callback=new MockAsyncCallback();
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  for (int i=0; i < 10; i++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
  int messageResultCount=0;
  for (  String key : statusUpdate.getMapFields().keySet()) {
    if (key.startsWith("MessageResult ")) {
      messageResultCount++;
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    Thread.sleep(1000);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
        Assert.assertTrue(statusUpdate.getMapField(key).size() > 1);
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  String controllerStatusPath=HelixUtil.getControllerPropertyPath(manager.getClusterName(),PropertyType.STATUSUPDATES_CONTROLLER);
  List<String> subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
  }
  String instanceStatusPath=HelixUtil.getInstancePropertyPath(manager.getClusterName(),"localhost_" + (START_PORT),PropertyType.STATUSUPDATES);
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() > 0);
    }
  }
  Thread.sleep(3000);
  ZKPathDataDumpTask dumpTask=new ZKPathDataDumpTask(manager,0L,0L,Integer.MAX_VALUE);
  dumpTask.run();
  subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() == 0);
  }
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() == 0);
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg4() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msgTemplate=new Message(_factory.getMessageType(),"Template");
  msgTemplate.setTgtSessionId("*");
  msgTemplate.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("TestDB");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msgTemplate.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg4");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgIdPrime=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      return count(_factory) == 60;
    }
  }
,10 * 1000);
  Assert.assertTrue(success,"If not specifying participant, controller will send 60 messages");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  ArrayList<String> msgIds=new ArrayList<String>();
  for (int i=0; i < NODE_NR; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    Thread.sleep(5000);
    System.err.println("count: " + count(_factory));
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    msgIds.add(msgId);
  }
  for (int i=0; i < NODE_NR; i++) {
    String msgId=msgIds.get(i);
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    if (messageResultCount != _PARTITIONS * 3 / 5) {
      int x=10;
      x=x + messageResultCount;
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
  }
  for (int j=0; j < 100; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgIdPrime);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3 * 2);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerZeroMsg() throws Exception {
  TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_DOESNOTEXIST");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  PropertyKey controllerMessageKey=keyBuilder.controllerMessage(schedulerMessage.getMsgId());
  helixDataAccessor.setProperty(controllerMessageKey,schedulerMessage);
  Thread.sleep(3000);
  Assert.assertEquals(0,factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  for (int i=0; i < 10; i++) {
    StatusUpdate update=helixDataAccessor.getProperty(controllerTaskStatus);
    if (update == null || update.getRecord().getMapField("SentMessageCount") == null) {
      Thread.sleep(1000);
    }
  }
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("0"));
  int count=0;
  for (  Set<String> val : factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestStartMultipleControllersWithSameName </h4><pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=3;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,1,"OnlineOffline",RebalanceMode.FULL_AUTO,true);
  MockController[] controllers=new MockController[4];
  for (int i=0; i < 4; i++) {
    controllers[i]=new MockController(_zkaddr,clusterName,"controller_0");
    controllers[i].syncStart();
  }
  Thread.sleep(500);
  String liPath=PropertyPathConfig.getPath(PropertyType.LIVEINSTANCES,clusterName);
  int listenerNb=ZkTestHelper.numberOfListeners(_zkaddr,liPath);
  Assert.assertEquals(listenerNb,1,"Only one controller should succeed in becoming leader");
  for (int i=0; i < 4; i++) {
    controllers[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestStateTransitionTimeout </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStateTransitionTimeOut() throws Exception {
  Map<String,SleepStateModelFactory> factories=new HashMap<String,SleepStateModelFactory>();
  IdealState idealState=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,TEST_DB);
  for (int i=0; i < NODE_NR; i++) {
    String instanceName="localhost_" + (START_PORT + i);
    SleepStateModelFactory factory=new SleepStateModelFactory(1000);
    factories.put(instanceName,factory);
    for (    PartitionId p : idealState.getPartitionIdSet()) {
      if (idealState.getPreferenceList(p).get(0).equals(ParticipantId.from(instanceName))) {
        factory.addPartition(p);
      }
    }
    _participants[i]=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName);
    _participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("MasterSlave"),factory);
    _participants[i].syncStart();
  }
  String controllerName="controller_0";
  _controller=new MockController(_zkaddr,CLUSTER_NAME,controllerName);
  _controller.syncStart();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=_participants[0].getHelixDataAccessor();
  Builder kb=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(kb.externalView(TEST_DB));
  for (  PartitionId p : idealState.getPartitionIdSet()) {
    ParticipantId idealMaster=idealState.getPreferenceList(p).get(0);
    Assert.assertTrue(ev.getStateMap(p).get(idealMaster).equals(State.from("ERROR")));
    TimeOutStateModel model=factories.get(idealMaster.stringify()).getTransitionHandler(ResourceId.from(TEST_DB),p);
    Assert.assertEquals(model._errorCallcount,1);
    Assert.assertEquals(model._error.getCode(),ErrorCode.TIMEOUT);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSwapInstance </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestSwap() throws Exception {
  HelixManager manager=_controller;
  HelixDataAccessor helixAccessor=manager.getHelixDataAccessor();
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB",_replica);
  ZNRecord idealStateOld1=new ZNRecord("TestDB");
  ZNRecord idealStateOld2=new ZNRecord("MyDB");
  IdealState is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  idealStateOld1.merge(is1.getRecord());
  IdealState is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  idealStateOld2.merge(is2.getRecord());
  String instanceName="localhost_" + (START_PORT + 0);
  _setupTool.getClusterManagementTool().enableInstance(CLUSTER_NAME,instanceName,false);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  String instanceName2="localhost_" + (START_PORT + 444);
  _setupTool.addInstanceToCluster(CLUSTER_NAME,instanceName2);
  boolean exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    exception=true;
  }
  Assert.assertTrue(exception);
  _participants[0].syncStop();
  Thread.sleep(1000);
  exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    e.printStackTrace();
    exception=true;
  }
  Assert.assertFalse(exception);
  MockParticipant newParticipant=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName2);
  newParticipant.syncStart();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  for (  String key : idealStateOld1.getMapFields().keySet()) {
    for (    String host : idealStateOld1.getMapField(key).keySet()) {
      if (host.equals(instanceName)) {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(instanceName).equals(is1.getRecord().getMapField(key).get(instanceName2)));
      }
 else {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(host).equals(is1.getRecord().getMapField(key).get(host)));
      }
    }
  }
  for (  String key : idealStateOld1.getListFields().keySet()) {
    Assert.assertEquals(idealStateOld1.getListField(key).size(),is1.getRecord().getListField(key).size());
    for (int i=0; i < idealStateOld1.getListField(key).size(); i++) {
      String host=idealStateOld1.getListField(key).get(i);
      String newHost=is1.getRecord().getListField(key).get(i);
      if (host.equals(instanceName)) {
        Assert.assertTrue(newHost.equals(instanceName2));
      }
 else {
        Assert.assertTrue(host.equals(newHost));
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestZkCallbackHandlerLeak </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCbHandlerLeakOnControllerSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  final MockParticipant participantManager=participants[0];
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      int controllerHandlerNb=controller.getHandlers().size();
      int particHandlerNb=participantManager.getHandlers().size();
      if (controllerHandlerNb == 10 && particHandlerNb == 2)       return true;
 else       return false;
    }
  }
,1000);
  int controllerHandlerNb=controller.getHandlers().size();
  int particHandlerNb=participantManager.getHandlers().size();
  TestHelper.printHandlers(controller,controller.getHandlers());
  Assert.assertEquals(controllerHandlerNb,12,"HelixController should have 12 (6+2n) callback handlers for 2 participant, but was " + controllerHandlerNb);
  TestHelper.printHandlers(participantManager,participantManager.getHandlers());
  Assert.assertEquals(particHandlerNb,1,"HelixParticipant should have 1 (msg->HelixTaskExecutor) callback handler, but was " + particHandlerNb);
  System.out.println("Expiring controller session...");
  String oldSessionId=controller.getSessionId();
  ZkTestHelper.expireSession(controller.getZkClient());
  String newSessionId=controller.getSessionId();
  System.out.println("Expired controller session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers after session expiry.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManager.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher after session expiry.");
  int handlerNb=controller.getHandlers().size();
  TestHelper.printHandlers(controller,controller.getHandlers());
  Assert.assertTrue(handlerNb <= controllerHandlerNb,"controller callback handlers should not increase after participant session expiry (expected no more than " + controllerHandlerNb + ", found "+ handlerNb+ ")");
  handlerNb=participantManager.getHandlers().size();
  TestHelper.printHandlers(participantManager,participantManager.getHandlers());
  Assert.assertEquals(handlerNb,particHandlerNb,"participant callback handlers should not increase after participant session expiry");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCbHandlerLeakOnParticipantSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  final MockParticipant participantManagerToExpire=participants[1];
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManagerToExpire.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher. MESSAGES->HelixTaskExecutor");
  TestHelper.printHandlers(controller,controller.getHandlers());
  TestHelper.printHandlers(participantManagerToExpire,participantManagerToExpire.getHandlers());
  int controllerHandlerNb=controller.getHandlers().size();
  int particHandlerNb=participantManagerToExpire.getHandlers().size();
  Assert.assertEquals(controllerHandlerNb,12,"HelixController should have 10 (8+2n) callback handlers for 2 (n) participant");
  Assert.assertEquals(particHandlerNb,1,"HelixParticipant should have 1 (msg->HelixTaskExecutor) callback handlers");
  System.out.println("Expiring participant session...");
  String oldSessionId=participantManagerToExpire.getSessionId();
  ZkTestHelper.expireSession(participantManagerToExpire.getZkClient());
  String newSessionId=participantManagerToExpire.getSessionId();
  System.out.println("Expried participant session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers after session expiry.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManagerToExpire.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher after session expiry.");
  int handlerNb=controller.getHandlers().size();
  Assert.assertEquals(handlerNb,controllerHandlerNb,"controller callback handlers should not increase after participant session expiry");
  handlerNb=participantManagerToExpire.getHandlers().size();
  Assert.assertEquals(handlerNb,particHandlerNb,"participant callback handlers should not increase after participant session expiry");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestZkReconnect </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testZKReconnect() throws Exception {
  final AtomicReference<ZkServer> zkServerRef=new AtomicReference<ZkServer>();
  final int zkPort=ZkTestUtil.availableTcpPort();
  final String zkAddr=String.format("localhost:%d",zkPort);
  ZkServer zkServer=TestHelper.startZkServer(zkAddr);
  zkServerRef.set(zkServer);
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  LOG.info("Setup clusters");
  ClusterSetup clusterSetup=new ClusterSetup(zkAddr);
  clusterSetup.addCluster(clusterName,true);
  LOG.info("Starts controller");
  HelixManager controller=HelixManagerFactory.getZKHelixManager(clusterName,null,InstanceType.CONTROLLER,zkAddr);
  controller.connect();
  LOG.info("Starts participant");
  String hostname="localhost";
  String instanceId=String.format("%s_%d",hostname,1);
  clusterSetup.addInstanceToCluster(clusterName,instanceId);
  HelixManager participant=HelixManagerFactory.getZKHelixManager(clusterName,instanceId,InstanceType.PARTICIPANT,zkAddr);
  participant.connect();
  LOG.info("Register state machine");
  final CountDownLatch latch=new CountDownLatch(1);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.OnlineOffline,"test",new StateTransitionHandlerFactory<TransitionHandler>(){
    @Override public TransitionHandler createStateTransitionHandler(    ResourceId resource,    PartitionId stateUnitKey){
      return new SimpleStateModel(latch);
    }
  }
);
  String resourceName="test-resource";
  LOG.info("Ideal state assignment");
  HelixAdmin helixAdmin=participant.getClusterManagmentTool();
  helixAdmin.addResource(clusterName,resourceName,1,"OnlineOffline",IdealState.RebalanceMode.CUSTOMIZED.toString());
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,resourceName);
  idealState.setReplicas("1");
  idealState.setStateModelFactoryId(StateModelFactoryId.from("test"));
  idealState.setPartitionState(PartitionId.from(ResourceId.from(resourceName),"0"),ParticipantId.from(instanceId),State.from("ONLINE"));
  LOG.info("Shutdown ZK server");
  TestHelper.stopZkServer(zkServerRef.get());
  Executors.newSingleThreadScheduledExecutor().schedule(new Runnable(){
    @Override public void run(){
      try {
        LOG.info("Restart ZK server");
        zkServerRef.set(TestHelper.startZkServer(zkAddr,null,false));
      }
 catch (      Exception e) {
        LOG.error(e.getMessage(),e);
      }
    }
  }
,2L,TimeUnit.SECONDS);
  LOG.info("Before update ideal state");
  helixAdmin.setResourceIdealState(clusterName,resourceName,idealState);
  LOG.info("After update ideal state");
  LOG.info("Wait for OFFLINE->ONLINE state transition");
  try {
    Assert.assertTrue(latch.await(10,TimeUnit.SECONDS));
    boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(zkAddr,clusterName));
    Assert.assertTrue(result);
  }
  finally {
    participant.disconnect();
    zkServerRef.get().shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestConsecutiveZkSessionExpiry </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiClusterController() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  MockMultiClusterController[] multiClusterControllers=new MockMultiClusterController[n];
  CountDownLatch startCountdown=new CountDownLatch(1);
  CountDownLatch endCountdown=new CountDownLatch(1);
  for (int i=0; i < n; i++) {
    String contrllerName="localhost_" + (12918 + i);
    multiClusterControllers[i]=new MockMultiClusterController(_zkaddr,clusterName,contrllerName);
    multiClusterControllers[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
    if (i == 0) {
      multiClusterControllers[i].addPreConnectCallback(new PreConnectTestCallback(contrllerName,startCountdown,endCountdown));
    }
    multiClusterControllers[i].connect();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  LOG.info("1st Expiring multiClusterController session...");
  String oldSessionId=multiClusterControllers[0].getSessionId();
  ZkTestHelper.asyncExpireSession(multiClusterControllers[0].getZkClient());
  String newSessionId=multiClusterControllers[0].getSessionId();
  LOG.info("Expried multiClusterController session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  startCountdown.await();
  LOG.info("2nd Expiring multiClusterController session...");
  oldSessionId=multiClusterControllers[0].getSessionId();
  ZkTestHelper.asyncExpireSession(multiClusterControllers[0].getZkClient());
  newSessionId=multiClusterControllers[0].getSessionId();
  LOG.info("Expried multiClusterController session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  endCountdown.countDown();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNotNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12918"),true));
  LiveInstance leader=HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.controllerLeader(),true);
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getId(),"localhost_12919");
  TestHelper.printHandlers(multiClusterControllers[0],multiClusterControllers[0].getHandlers());
  List<ZkCallbackHandler> handlers=multiClusterControllers[0].getHandlers();
  Assert.assertEquals(handlers.size(),2,"MultiCluster controller should have 2 handler (message and leader election) after lose leadership, but was " + handlers.size());
  multiClusterControllers[0].disconnect();
  multiClusterControllers[1].disconnect();
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12918"),false));
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12919"),false));
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.controllerLeader(),false));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestParticipantManager </h4><pre class="type-7 type-1 type-8 type-11 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSessionExpiryInTransition() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  int n=1;
  CountDownLatch startCountdown=new CountDownLatch(1);
  CountDownLatch endCountdown=new CountDownLatch(1);
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,1,n,1,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].setTransition(new SessionExpiryTransition(startCountdown,endCountdown));
    participants[i].syncStart();
  }
  startCountdown.await();
  String oldSessionId=participants[0].getSessionId();
  System.out.println("oldSessionId: " + oldSessionId);
  ZkTestHelper.expireSession(participants[0].getZkClient());
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String newSessionId=participants[0].getSessionId();
  Assert.assertNotSame(newSessionId,oldSessionId);
  String errPath=PropertyPathConfig.getPath(PropertyType.ERRORS,clusterName,"localhost_12918",oldSessionId,"TestDB0","TestDB0_0");
  ZNRecord error=_zkclient.readData(errPath);
  Assert.assertNotNull(error,"InterruptedException should happen in old session since task is being cancelled during handleNewSession");
  String errString=new String(new ZNRecordSerializer().serialize(error));
  Assert.assertTrue(errString.indexOf("InterruptedException") != -1);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestIndependentTaskRebalancer </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDelayedRetry() throws Exception {
  int delay=3000;
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(1);
  Map<String,String> taskConfigMap=Maps.newHashMap();
  TaskConfig taskConfig1=new TaskConfig("SingleFailTask",taskConfigMap,false);
  taskConfigs.add(taskConfig1);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  workflowBuilder.addConfig(jobName,JobConfig.TASK_RETRY_DELAY,String.valueOf(delay));
  Map<String,String> jobConfigMap=Maps.newHashMap();
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  SingleFailTask.hasFailed=false;
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  JobContext jobCtx=TaskUtil.getJobContext(_manager,jobName + "_" + jobName);
  Assert.assertEquals(jobCtx.getPartitionNumAttempts(0),2);
  Assert.assertTrue(jobCtx.getFinishTime() - jobCtx.getStartTime() >= delay);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testOneTimeScheduled() throws Exception {
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(1);
  Map<String,String> taskConfigMap=Maps.newHashMap();
  TaskConfig taskConfig1=new TaskConfig("TaskOne",taskConfigMap,false);
  taskConfigs.add(taskConfig1);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  Map<String,String> jobConfigMap=Maps.newHashMap();
  jobConfigMap.put("Timeout","1000");
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  long inFiveSeconds=System.currentTimeMillis() + (5 * 1000);
  workflowBuilder.setScheduleConfig(ScheduleConfig.oneTimeDelayedStart(new Date(inFiveSeconds)));
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Assert.assertTrue(_invokedClasses.contains(TaskOne.class.getName()));
  WorkflowContext workflowCtx=TaskUtil.getWorkflowContext(_manager,jobName);
  long startTime=workflowCtx.getStartTime();
  Assert.assertTrue((startTime + 1000) >= inFiveSeconds);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestTaskRebalancer </h4><pre class="type-7 type-1 type-8 type-11 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpiry() throws Exception {
  String jobName="Expiry";
  long expiry=1000;
  Map<String,String> commandConfig=ImmutableMap.of(TIMEOUT_CONFIG,String.valueOf(100));
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobName,commandConfig).setExpiry(expiry).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  HelixDataAccessor accessor=_manager.getHelixDataAccessor();
  PropertyKey workflowCfgKey=accessor.keyBuilder().resourceConfig(jobName);
  String workflowPropStoreKey=Joiner.on("/").join(TaskConstants.REBALANCER_CONTEXT_ROOT,jobName);
  Assert.assertTrue(_manager.getHelixPropertyStore().exists(workflowPropStoreKey,AccessOption.PERSISTENT));
  Assert.assertNotSame(accessor.getProperty(workflowCfgKey),null);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Thread.sleep(expiry);
  _driver.invokeRebalance();
  Thread.sleep(expiry);
  Assert.assertFalse(_manager.getHelixPropertyStore().exists(workflowPropStoreKey,AccessOption.PERSISTENT));
  Assert.assertEquals(accessor.getProperty(workflowCfgKey),null);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void timeouts() throws Exception {
  final String jobResource="timeouts";
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobResource,WorkflowGenerator.DEFAULT_COMMAND_CONFIG,JobConfig.MAX_ATTEMPTS_PER_TASK,String.valueOf(2),JobConfig.TIMEOUT_PER_TASK,String.valueOf(100)).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobResource,TaskState.FAILED);
  JobContext ctx=TaskUtil.getJobContext(_manager,TaskUtil.getNamespacedJobName(jobResource));
  int maxAttempts=0;
  for (int i=0; i < NUM_PARTITIONS; i++) {
    TaskPartitionState state=ctx.getPartitionState(i);
    if (state != null) {
      Assert.assertEquals(state,TaskPartitionState.TIMED_OUT);
      maxAttempts=Math.max(maxAttempts,ctx.getPartitionNumAttempts(i));
    }
  }
  Assert.assertEquals(maxAttempts,2);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNamedQueue() throws Exception {
  String queueName=TestHelper.getTestMethodName();
  JobQueue queue=new JobQueue.Builder(queueName).build();
  _driver.createQueue(queue);
  Set<String> master=Sets.newHashSet("MASTER");
  Set<String> slave=Sets.newHashSet("SLAVE");
  JobConfig.Builder job1=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(master);
  JobConfig.Builder job2=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(slave);
  _driver.enqueueJob(queueName,"masterJob",job1);
  _driver.enqueueJob(queueName,"slaveJob",job2);
  String namespacedJob1=queueName + "_masterJob";
  String namespacedJob2=queueName + "_slaveJob";
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.COMPLETED);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob2,TaskState.COMPLETED);
  JobContext masterJobContext=TaskUtil.getJobContext(_manager,namespacedJob1);
  JobContext slaveJobContext=TaskUtil.getJobContext(_manager,namespacedJob2);
  long job1Finish=masterJobContext.getFinishTime();
  long job2Start=slaveJobContext.getStartTime();
  Assert.assertTrue(job2Start >= job1Finish);
  _driver.flushQueue(queueName);
  HelixDataAccessor accessor=_manager.getHelixDataAccessor();
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNull(accessor.getProperty(keyBuilder.idealStates(namespacedJob1)));
  Assert.assertNull(accessor.getProperty(keyBuilder.resourceConfig(namespacedJob1)));
  Assert.assertNull(accessor.getProperty(keyBuilder.idealStates(namespacedJob2)));
  Assert.assertNull(accessor.getProperty(keyBuilder.resourceConfig(namespacedJob2)));
  WorkflowConfig workflowCfg=TaskUtil.getWorkflowCfg(_manager,queueName);
  JobDag dag=workflowCfg.getJobDag();
  Assert.assertFalse(dag.getAllNodes().contains(namespacedJob1));
  Assert.assertFalse(dag.getAllNodes().contains(namespacedJob2));
  Assert.assertFalse(dag.getChildrenToParents().containsKey(namespacedJob1));
  Assert.assertFalse(dag.getChildrenToParents().containsKey(namespacedJob2));
  Assert.assertFalse(dag.getParentsToChildren().containsKey(namespacedJob1));
  Assert.assertFalse(dag.getParentsToChildren().containsKey(namespacedJob2));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void partitionSet() throws Exception {
  final String jobResource="partitionSet";
  ImmutableList<String> targetPartitions=ImmutableList.of("TestDB_1","TestDB_2","TestDB_3","TestDB_5","TestDB_8","TestDB_13");
  Map<String,String> commandConfig=ImmutableMap.of(TIMEOUT_CONFIG,String.valueOf(100));
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobResource,commandConfig,JobConfig.MAX_ATTEMPTS_PER_TASK,String.valueOf(1),JobConfig.TARGET_PARTITIONS,Joiner.on(",").join(targetPartitions)).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobResource,TaskState.COMPLETED);
  String namespacedName=TaskUtil.getNamespacedJobName(jobResource);
  JobContext ctx=TaskUtil.getJobContext(_manager,namespacedName);
  WorkflowContext workflowContext=TaskUtil.getWorkflowContext(_manager,jobResource);
  Assert.assertNotNull(ctx);
  Assert.assertNotNull(workflowContext);
  Assert.assertEquals(workflowContext.getJobState(namespacedName),TaskState.COMPLETED);
  for (  String pName : targetPartitions) {
    int i=ctx.getPartitionsByTarget().get(pName).get(0);
    Assert.assertEquals(ctx.getPartitionState(i),TaskPartitionState.COMPLETED);
    Assert.assertEquals(ctx.getPartitionNumAttempts(i),1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestTaskRebalancerStopResume </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void stopAndResumeNamedQueue() throws Exception {
  String queueName=TestHelper.getTestMethodName();
  LOG.info("Starting job-queue: " + queueName);
  JobQueue queue=new JobQueue.Builder(queueName).build();
  _driver.createQueue(queue);
  Set<String> master=Sets.newHashSet("MASTER");
  JobConfig.Builder job1=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(master);
  String job1Name="masterJob";
  LOG.info("Enqueuing job: " + job1Name);
  _driver.enqueueJob(queueName,job1Name,job1);
  Set<String> slave=Sets.newHashSet("SLAVE");
  JobConfig.Builder job2=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(slave);
  String job2Name="slaveJob";
  LOG.info("Enqueuing job: " + job2Name);
  _driver.enqueueJob(queueName,job2Name,job2);
  String namespacedJob1=String.format("%s_%s",queueName,job1Name);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  TimeUnit.MILLISECONDS.sleep(200);
  String namespacedJob2=String.format("%s_%s",queueName,job2Name);
  TestUtil.pollForEmptyJobState(_manager,queueName,job2Name);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.COMPLETED);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob2,TaskState.COMPLETED);
  JobContext masterJobContext=TaskUtil.getJobContext(_manager,namespacedJob1);
  JobContext slaveJobContext=TaskUtil.getJobContext(_manager,namespacedJob2);
  long job1Finish=masterJobContext.getFinishTime();
  long job2Start=slaveJobContext.getStartTime();
  Assert.assertTrue(job2Start >= job1Finish);
  LOG.info("Flusing job-queue: " + queueName);
  _driver.flushQueue(queueName);
  verifyJobDeleted(queueName,namespacedJob1);
  verifyJobDeleted(queueName,namespacedJob2);
  verifyJobNotInQueue(queueName,namespacedJob1);
  verifyJobNotInQueue(queueName,namespacedJob2);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void stopDeleteAndResumeNamedQueue() throws Exception {
  String queueName=TestHelper.getTestMethodName();
  LOG.info("Starting job-queue: " + queueName);
  JobQueue queue=new JobQueue.Builder(queueName).build();
  _driver.createQueue(queue);
  List<String> currentJobNames=new ArrayList<String>();
  for (int i=0; i <= 4; i++) {
    String targetPartition=(i == 0) ? "MASTER" : "SLAVE";
    JobConfig.Builder job=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(Sets.newHashSet(targetPartition));
    String jobName=targetPartition.toLowerCase() + "Job" + i;
    LOG.info("Enqueuing job: " + jobName);
    _driver.enqueueJob(queueName,jobName,job);
    currentJobNames.add(i,jobName);
  }
  String deletedJob1=currentJobNames.get(0);
  String namedSpaceDeletedJob1=String.format("%s_%s",queueName,deletedJob1);
  TestUtil.pollForJobState(_manager,queueName,namedSpaceDeletedJob1,TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,namedSpaceDeletedJob1,TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  _driver.deleteJob(queueName,deletedJob1);
  verifyJobDeleted(queueName,namedSpaceDeletedJob1);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  TestUtil.pollForJobState(_manager,queueName,String.format("%s_%s",queueName,currentJobNames.get(1)),TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,String.format("%s_%s",queueName,currentJobNames.get(1)),TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  String deletedJob2=currentJobNames.get(2);
  String namedSpaceDeletedJob2=String.format("%s_%s",queueName,deletedJob2);
  TestUtil.pollForEmptyJobState(_manager,queueName,namedSpaceDeletedJob2);
  _driver.deleteJob(queueName,deletedJob2);
  verifyJobDeleted(queueName,namedSpaceDeletedJob2);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  currentJobNames.remove(deletedJob1);
  currentJobNames.remove(deletedJob2);
  long preJobFinish=0;
  for (int i=0; i < currentJobNames.size(); i++) {
    String namedSpaceJobName=String.format("%s_%s",queueName,currentJobNames.get(i));
    TestUtil.pollForJobState(_manager,queueName,namedSpaceJobName,TaskState.COMPLETED);
    JobContext jobContext=TaskUtil.getJobContext(_manager,namedSpaceJobName);
    long jobStart=jobContext.getStartTime();
    Assert.assertTrue(jobStart >= preJobFinish);
    preJobFinish=jobContext.getFinishTime();
  }
  LOG.info("Flusing job-queue: " + queueName);
  _driver.flushQueue(queueName);
  TimeUnit.MILLISECONDS.sleep(200);
  for (int i=0; i < currentJobNames.size(); i++) {
    String namedSpaceJobName=String.format("%s_%s",queueName,currentJobNames.get(i));
    verifyJobDeleted(queueName,namedSpaceJobName);
    verifyJobNotInQueue(queueName,namedSpaceJobName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.ipc.TestNettyHelixIPCService </h4><pre class="type-7 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testService() throws Exception {
  final int numMessages=1000;
  final int messageType=1;
  final ConcurrentMap<String,AtomicInteger> firstCounts=new ConcurrentHashMap<String,AtomicInteger>();
  final HelixIPCService firstIPC=new NettyHelixIPCService(new NettyHelixIPCService.Config().setInstanceName(firstNode.getInstanceName()).setPort(firstPort));
  firstIPC.registerCallback(messageType,new HelixIPCCallback(){
    @Override public void onMessage(    HelixMessageScope scope,    UUID messageId,    ByteBuf message){
      String key=scope.getPartition() + ":" + scope.getState();
      firstCounts.putIfAbsent(key,new AtomicInteger());
      firstCounts.get(key).incrementAndGet();
    }
  }
);
  firstIPC.start();
  final ConcurrentMap<String,AtomicInteger> secondCounts=new ConcurrentHashMap<String,AtomicInteger>();
  final HelixIPCService secondIPC=new NettyHelixIPCService(new NettyHelixIPCService.Config().setInstanceName(secondNode.getInstanceName()).setPort(secondPort));
  secondIPC.registerCallback(messageType,new HelixIPCCallback(){
    @Override public void onMessage(    HelixMessageScope scope,    UUID messageId,    ByteBuf message){
      String key=scope.getPartition() + ":" + scope.getState();
      secondCounts.putIfAbsent(key,new AtomicInteger());
      secondCounts.get(key).incrementAndGet();
    }
  }
);
  secondIPC.start();
  Thread.sleep(500);
  String secondName="localhost_" + secondPort;
  Set<String> secondPartitions=new HashSet<String>();
  IdealState idealState=controller.getClusterManagmentTool().getResourceIdealState(CLUSTER_NAME,RESOURCE_NAME);
  for (  String partitionName : idealState.getPartitionSet()) {
    for (    Map.Entry<String,String> stateEntry : idealState.getInstanceStateMap(partitionName).entrySet()) {
      if (stateEntry.getKey().equals(secondName)) {
        secondPartitions.add(partitionName);
      }
    }
  }
  for (  String partitionName : secondPartitions) {
    for (int i=0; i < numMessages; i++) {
      HelixMessageScope scope=new HelixMessageScope.Builder().cluster(firstNode.getClusterName()).resource(RESOURCE_NAME).partition(partitionName).state("ONLINE").build();
      Set<HelixAddress> destinations=firstResolver.getDestinations(scope);
      for (      HelixAddress destination : destinations) {
        ByteBuf message=Unpooled.wrappedBuffer(("Hello" + i).getBytes());
        firstIPC.send(destination,messageType,UUID.randomUUID(),message);
      }
    }
  }
  for (  String partitionName : secondPartitions) {
    for (int i=0; i < numMessages; i++) {
      HelixMessageScope scope=new HelixMessageScope.Builder().cluster(secondNode.getClusterName()).resource(RESOURCE_NAME).partition(partitionName).state("ONLINE").build();
      Set<HelixAddress> destinations=secondResolver.getDestinations(scope);
      for (      HelixAddress destination : destinations) {
        ByteBuf message=Unpooled.wrappedBuffer(("Hello" + i).getBytes());
        secondIPC.send(destination,messageType,UUID.randomUUID(),message);
      }
    }
  }
  Thread.sleep(500);
  for (  String partitionName : secondPartitions) {
    AtomicInteger count=secondCounts.get(partitionName + ":ONLINE");
    Assert.assertNotNull(count);
    Assert.assertEquals(count.get(),2 * numMessages);
  }
  firstIPC.shutdown();
  secondIPC.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.lock.zk.TestZKHelixLock </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void basicTest() throws InterruptedException {
  final long TIMEOUT=30000;
  final long RETRY_INTERVAL=100;
  _zkclient.waitUntilConnected(TIMEOUT,TimeUnit.MILLISECONDS);
  final AtomicBoolean t1Locked=new AtomicBoolean(false);
  final AtomicBoolean t1Done=new AtomicBoolean(false);
  final AtomicInteger field1=new AtomicInteger(0);
  final AtomicInteger field2=new AtomicInteger(1);
  final ClusterId clusterId=ClusterId.from("testCluster");
  final HelixLock lock1=new ZKHelixLock(clusterId,Scope.cluster(clusterId),_zkclient);
  final HelixLock lock2=new ZKHelixLock(clusterId,Scope.cluster(clusterId),_zkclient);
  Thread t1=new Thread(){
    @Override public void run(){
      lock1.lock();
synchronized (t1Locked) {
        t1Locked.set(true);
        t1Locked.notify();
      }
      yield();
      field1.set(1);
      field2.set(1);
synchronized (t1Done) {
        t1Done.set(true);
        t1Done.notify();
      }
    }
  }
;
  Thread t2=new Thread(){
    @Override public void run(){
synchronized (t1Locked) {
        while (!t1Locked.get()) {
          try {
            t1Locked.wait();
          }
 catch (          InterruptedException e) {
          }
        }
      }
      lock2.lock();
      field1.set(2);
      field2.set(2);
    }
  }
;
  t1.setPriority(Thread.MIN_PRIORITY);
  t2.setPriority(Thread.MAX_PRIORITY);
  t1.start();
  t2.start();
synchronized (t1Done) {
    while (!t1Done.get()) {
      try {
        t1Done.wait();
      }
 catch (      InterruptedException e) {
      }
    }
  }
  Assert.assertEquals(field1.get(),1);
  Assert.assertEquals(field2.get(),1);
  long count=0;
  while (!lock2.isBlocked()) {
    if (count > TIMEOUT) {
      break;
    }
    Thread.sleep(RETRY_INTERVAL);
    count+=RETRY_INTERVAL;
  }
  Assert.assertTrue(lock2.isBlocked());
  lock1.unlock();
  try {
    t2.join(10000);
    Assert.assertEquals(field1.get(),2);
    Assert.assertEquals(field2.get(),2);
  }
 catch (  InterruptedException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheAsyncOpMultiThread </h4><pre class="type-7 type-1 type-8 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<Callable<Boolean>> threads=new ArrayList<Callable<Boolean>>();
  for (int i=0; i < 2; i++) {
    threads.add(new TestCreateZkCacheBaseDataAccessor(accessor,clusterName,i));
  }
  TestHelper.startThreadsConcurrently(threads,1000);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  threads.clear();
  for (int i=0; i < 2; i++) {
    threads.add(new TestUpdateZkCacheBaseDataAccessor(accessor,clusterName,i));
  }
  TestHelper.startThreadsConcurrently(threads,1000);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  threads.clear();
  for (int i=0; i < 2; i++) {
    threads.add(new TestSetZkCacheBaseDataAccessor(accessor,clusterName,i));
  }
  TestHelper.startThreadsConcurrently(threads,1000);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateFailZkCacheBaseAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,Arrays.asList(curStatePath,extViewPath),null);
  Assert.assertEquals(accessor._wtCache._cache.size(),1,"Should contain only:\n" + curStatePath);
  Assert.assertTrue(accessor._wtCache._cache.containsKey(curStatePath));
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertFalse(success[i],"Should fail on create: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: TestDB" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCreateFailZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,Arrays.asList(curStatePath),null);
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertFalse(success,"Should fail in create due to NodeExists: " + path);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    boolean success=accessor.set(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in set: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=accessor.get(path,null,0);
    Assert.assertEquals(record.getId(),"TestDB" + i);
  }
  List<String> childNames=accessor.getChildNames(extViewPath,0);
  Assert.assertEquals(childNames.size(),10,"Should contain only: TestDB0-9");
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(childNames.contains("TestDB" + i));
  }
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    Assert.assertTrue(accessor.exists(path,0));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZKLiveInstanceData </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDataChange() throws Exception {
  HelixManager adminManager=HelixManagerFactory.getZKHelixManager(clusterName,null,InstanceType.ADMINISTRATOR,_zkaddr);
  adminManager.connect();
  final BlockingQueue<List<LiveInstance>> changeList=new LinkedBlockingQueue<List<LiveInstance>>();
  adminManager.addLiveInstanceChangeListener(new LiveInstanceChangeListener(){
    @Override public void onLiveInstanceChange(    List<LiveInstance> liveInstances,    NotificationContext changeContext){
      changeList.add(deepCopy(liveInstances));
    }
  }
);
  List<LiveInstance> instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertTrue(instances.isEmpty(),"Expecting an empty list of live instance");
  HelixManager manager=HelixManagerFactory.getZKHelixManager(clusterName,"localhost_54321",InstanceType.PARTICIPANT,_zkaddr);
  manager.connect();
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertEquals(instances.size(),1,"Expecting one live instance");
  Assert.assertEquals(instances.get(0).getInstanceName(),manager.getInstanceName());
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  PropertyKey propertyKey=helixDataAccessor.keyBuilder().liveInstance(manager.getInstanceName());
  LiveInstance instance=helixDataAccessor.getProperty(propertyKey);
  Map<String,String> map=new TreeMap<String,String>();
  map.put("k1","v1");
  instance.getRecord().setMapField("test",map);
  Assert.assertTrue(helixDataAccessor.updateProperty(propertyKey,instance),"Failed to update live instance node");
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertEquals(instances.get(0).getRecord().getMapField("test"),map,"Wrong map data.");
  manager.disconnect();
  Thread.sleep(1000);
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertTrue(instances.isEmpty(),"Expecting an empty list of live instance");
  adminManager.disconnect();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZKUtil </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testCreateOrUpdate(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id7");
  ZNRecord record=new ZNRecord("id7");
  ZKUtil.createOrUpdate(_zkClient,path,record,true,true);
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id7",record.getId());
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test() public void testIsClusterSetup(){
  boolean result=ZKUtil.isClusterSetup(clusterName,_zkClient);
  AssertJUnit.assertTrue(result);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test() public void testSubtract(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id5");
  ZNRecord record=new ZNRecord("id5");
  record.setSimpleField("key1","value1");
  _zkClient.createPersistent(path,record);
  ZKUtil.subtract(_zkClient,path,record);
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertNull(record.getSimpleField("key1"));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testCreateOrReplace(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id8");
  ZNRecord record=new ZNRecord("id8");
  ZKUtil.createOrReplace(_zkClient,path,record,true);
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id8",record.getId());
  record=new ZNRecord("id9");
  ZKUtil.createOrReplace(_zkClient,path,record,true);
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id9",record.getId());
}

</code></pre>

<br>
<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testChildrenOperations(){
  List<ZNRecord> list=new ArrayList<ZNRecord>();
  list.add(new ZNRecord("id1"));
  list.add(new ZNRecord("id2"));
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString());
  ZKUtil.createChildren(_zkClient,path,list);
  list=ZKUtil.getChildren(_zkClient,path);
  AssertJUnit.assertEquals(2,list.size());
  ZKUtil.dropChildren(_zkClient,path,list);
  ZKUtil.dropChildren(_zkClient,path,new ZNRecord("id1"));
  list=ZKUtil.getChildren(_zkClient,path);
  AssertJUnit.assertEquals(0,list.size());
  ZKUtil.dropChildren(_zkClient,path,(List<ZNRecord>)null);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testUpdateIfExists(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id3");
  ZNRecord record=new ZNRecord("id4");
  ZKUtil.updateIfExists(_zkClient,path,record,false);
  AssertJUnit.assertFalse(_zkClient.exists(path));
  _zkClient.createPersistent(path);
  ZKUtil.updateIfExists(_zkClient,path,record,false);
  AssertJUnit.assertTrue(_zkClient.exists(path));
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id4",record.getId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZNRecordSizeLimit </h4><pre class="type-7 type-5 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZNRecordSizeLimitUseZNRecordSerializer(){
  String className=TestUtil.getTestName();
  System.out.println("START testZNRecordSizeLimitUseZNRecordSerializer at " + new Date(System.currentTimeMillis()));
  String root=className;
  byte[] buf=new byte[1024];
  for (int i=0; i < 1024; i++) {
    buf[i]='a';
  }
  String bufStr=new String(buf);
  final ZNRecord smallRecord=new ZNRecord("normalsize");
  smallRecord.getSimpleFields().clear();
  for (int i=0; i < 900; i++) {
    smallRecord.setSimpleField(i + "",bufStr);
  }
  String path1="/" + root + "/test1";
  _zkclient.createPersistent(path1,true);
  _zkclient.writeData(path1,smallRecord);
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord record=_zkclient.readData(path1);
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  final ZNRecord largeRecord=new ZNRecord("oversize");
  largeRecord.getSimpleFields().clear();
  for (int i=0; i < 1024; i++) {
    largeRecord.setSimpleField(i + "",bufStr);
  }
  String path2="/" + root + "/test2";
  _zkclient.createPersistent(path2,true);
  try {
    _zkclient.writeData(path2,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  record=_zkclient.readData(path2);
  Assert.assertNull(record);
  record=_zkclient.readData(path1);
  try {
    _zkclient.writeData(path1,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  ZNRecord recordNew=_zkclient.readData(path1);
  byte[] arr=serializer.serialize(record);
  byte[] arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  ZKHelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.addCluster(className,true);
  InstanceConfig instanceConfig=new InstanceConfig("localhost_12918");
  admin.addInstance(className,instanceConfig);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(className,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=new IdealState("currentState");
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  boolean succeed=accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  Assert.assertFalse(succeed);
  HelixProperty property=accessor.getProperty(keyBuilder.stateTransitionStatus("localhost_12918","session_1","partition_1"));
  Assert.assertNull(property);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 900; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.setProperty(keyBuilder.idealStates("TestDB1"),idealState);
  Assert.assertTrue(succeed);
  record=accessor.getProperty(keyBuilder.idealStates("TestDB1")).getRecord();
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=900; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.updateProperty(keyBuilder.idealStates("TestDB1"),idealState);
  Assert.assertFalse(succeed);
  recordNew=accessor.getProperty(keyBuilder.idealStates("TestDB1")).getRecord();
  arr=serializer.serialize(record);
  arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  System.out.println("END testZNRecordSizeLimitUseZNRecordSerializer at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZNRecordSizeLimitUseZNRecordStreamingSerializer(){
  String className=TestUtil.getTestName();
  System.out.println("START testZNRecordSizeLimitUseZNRecordStreamingSerializer at " + new Date(System.currentTimeMillis()));
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  String root=className;
  byte[] buf=new byte[1024];
  for (int i=0; i < 1024; i++) {
    buf[i]='a';
  }
  String bufStr=new String(buf);
  final ZNRecord smallRecord=new ZNRecord("normalsize");
  smallRecord.getSimpleFields().clear();
  for (int i=0; i < 900; i++) {
    smallRecord.setSimpleField(i + "",bufStr);
  }
  String path1="/" + root + "/test1";
  _zkclient.createPersistent(path1,true);
  _zkclient.writeData(path1,smallRecord);
  ZNRecord record=_zkclient.readData(path1);
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  final ZNRecord largeRecord=new ZNRecord("oversize");
  largeRecord.getSimpleFields().clear();
  for (int i=0; i < 1024; i++) {
    largeRecord.setSimpleField(i + "",bufStr);
  }
  String path2="/" + root + "/test2";
  _zkclient.createPersistent(path2,true);
  try {
    _zkclient.writeData(path2,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  record=_zkclient.readData(path2);
  Assert.assertNull(record);
  record=_zkclient.readData(path1);
  try {
    _zkclient.writeData(path1,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  ZNRecord recordNew=_zkclient.readData(path1);
  byte[] arr=serializer.serialize(record);
  byte[] arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  ZKHelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.addCluster(className,true);
  InstanceConfig instanceConfig=new InstanceConfig("localhost_12918");
  admin.addInstance(className,instanceConfig);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(className,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=new IdealState("currentState");
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  boolean succeed=accessor.setProperty(keyBuilder.idealStates("TestDB_1"),idealState);
  Assert.assertFalse(succeed);
  HelixProperty property=accessor.getProperty(keyBuilder.idealStates("TestDB_1"));
  Assert.assertNull(property);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 900; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.setProperty(keyBuilder.idealStates("TestDB_2"),idealState);
  Assert.assertTrue(succeed);
  record=accessor.getProperty(keyBuilder.idealStates("TestDB_2")).getRecord();
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=900; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.updateProperty(keyBuilder.idealStates("TestDB_2"),idealState);
  Assert.assertFalse(succeed);
  recordNew=accessor.getProperty(keyBuilder.idealStates("TestDB_2")).getRecord();
  arr=serializer.serialize(record);
  arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  System.out.println("END testZNRecordSizeLimitUseZNRecordStreamingSerializer at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZNRecordStreamingSerializer </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that the json still deserizalizes correctly if id is not first
 */
@Test public void idNotFirstTest(){
  StringBuilder jsonString=new StringBuilder("{\n").append("  \"simpleFields\": {},\n").append("  \"listFields\": {},\n").append("  \"mapFields\": {},\n").append("\"id\": \"myId\"\n").append("}");
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord result=(ZNRecord)serializer.deserialize(jsonString.toString().getBytes());
  Assert.assertNotNull(result);
  Assert.assertEquals(result.getId(),"myId");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that simple, list, and map fields are initialized as empty even when not in json
 */
@Test public void fieldAutoInitTest(){
  StringBuilder jsonString=new StringBuilder("{\n").append("\"id\": \"myId\"\n").append("}");
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord result=(ZNRecord)serializer.deserialize(jsonString.toString().getBytes());
  Assert.assertNotNull(result);
  Assert.assertEquals(result.getId(),"myId");
  Assert.assertNotNull(result.getSimpleFields());
  Assert.assertTrue(result.getSimpleFields().isEmpty());
  Assert.assertNotNull(result.getListFields());
  Assert.assertTrue(result.getListFields().isEmpty());
  Assert.assertNotNull(result.getMapFields());
  Assert.assertTrue(result.getMapFields().isEmpty());
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * Check that the ZNRecord is not constructed if there is no id in the json
 */
@Test public void noIdTest(){
  StringBuilder jsonString=new StringBuilder("{\n").append("  \"simpleFields\": {},\n").append("  \"listFields\": {},\n").append("  \"mapFields\": {}\n").append("}\n");
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord result=(ZNRecord)serializer.deserialize(jsonString.toString().getBytes());
  Assert.assertNull(result);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkBaseDataAccessor </h4><pre class="type-7 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  boolean success=_baseAccessor.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSyncExist(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.exists(path,0);
  Assert.assertFalse(success);
  success=accessor.create(path,record,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  success=accessor.exists(path,0);
  Assert.assertTrue(success);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncCreate(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  record.setSimpleField("key0","value0");
  success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertFalse(success,"Should fail since node already exists");
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),0);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAsyncZkBaseDataAccessor(){
  System.out.println("START TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
  String root="TestZkBaseDataAccessor_asyn";
  ZkClient zkClient=new ZkClient(_zkaddr);
  zkClient.setZkSerializer(new ZNRecordSerializer());
  zkClient.deleteRecursive("/" + root);
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(zkClient);
  String parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    records.add(new ZNRecord(msgId));
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in create " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getId(),msgId,"Should get what we created");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=new ArrayList<ZNRecord>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key1","value1");
    records.add(newRecord);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in set " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),1,"Should have 1 simple field set");
    Assert.assertEquals(record.getSimpleField("key1"),"value1","Should have value1 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<DataUpdater<ZNRecord>> znrecordUpdaters=new ArrayList<DataUpdater<ZNRecord>>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key2","value2");
    znrecordUpdaters.add(new ZNRecordUpdater(newRecord));
  }
  success=accessor.updateChildren(paths,znrecordUpdaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in update " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=accessor.getChildren(parentPath,null,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    ZNRecord record=records.get(i);
    Assert.assertEquals(record.getId(),msgId,"Should get what we updated");
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  boolean[] exists=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(exists[i],"Should exist " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  Stat[] stats=accessor.getStats(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertNotNull(stats[i],"Stat should exist for " + msgId);
    Assert.assertEquals(stats[i].getVersion(),2,"DataVersion should be 2, since we set 1 and update 1 for " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  success=accessor.remove(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in remove " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    boolean pathExists=zkClient.exists(path);
    Assert.assertFalse(pathExists,"Should be removed " + msgId);
  }
  zkClient.close();
  System.out.println("END TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-11 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncGetStat(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  Stat stat=accessor.getStat(path,0);
  Assert.assertNull(stat);
  boolean success=accessor.create(path,record,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  stat=accessor.getStat(path,0);
  Assert.assertNotNull(stat);
  Assert.assertEquals(stat.getVersion(),0);
  Assert.assertNotSame(stat.getEphemeralOwner(),0);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncDoSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s/%s",testName,"msg_0","submsg_0");
  ZNRecord record=new ZNRecord("submsg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  AccessResult result=accessor.doSet(path,record,-1,AccessOption.PERSISTENT);
  Assert.assertEquals(result._retCode,RetCode.OK);
  Assert.assertEquals(result._pathCreated.size(),3);
  Assert.assertTrue(result._pathCreated.contains(String.format("/%s",testName)));
  Assert.assertTrue(result._pathCreated.contains(String.format("/%s/%s",testName,"msg_0")));
  Assert.assertTrue(result._pathCreated.contains(path));
  Assert.assertTrue(_zkclient.exists(String.format("/%s",testName)));
  Assert.assertTrue(_zkclient.exists(String.format("/%s/%s",testName,"msg_0")));
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"submsg_0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncUpdate(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.update(path,new ZNRecordUpdater(record),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  record.setSimpleField("key0","value0");
  success=accessor.update(path,new ZNRecordUpdater(record),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  success=accessor.update(path,new DataUpdater<ZNRecord>(){
    @Override public ZNRecord update(    ZNRecord currentData){
      throw new RuntimeException("IGNORABLE: test throw exception from updater");
    }
  }
,AccessOption.PERSISTENT);
  Assert.assertFalse(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncSetWithVersion(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  boolean success=_baseAccessor.set(path,record,0,AccessOption.PERSISTENT);
  Assert.assertFalse(success,"Should fail since version not match");
  try {
    _zkclient.readData(path,false);
    Assert.fail("Should get no node exception");
  }
 catch (  Exception e) {
  }
  success=_baseAccessor.set(path,record,-1,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  path=String.format("/%s/%s",testName,"msg_1");
  record=new ZNRecord("msg_1");
  success=_baseAccessor.set(path,record,0,AccessOption.EPHEMERAL);
  Assert.assertFalse(success);
  try {
    _zkclient.readData(path,false);
    Assert.fail("Should get no node exception");
  }
 catch (  Exception e) {
  }
  success=_baseAccessor.set(path,record,-1,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_1");
  record.setSimpleField("key0","value0");
  success=_baseAccessor.set(path,record,0,AccessOption.PERSISTENT);
  Assert.assertTrue(success,"Should pass. AccessOption.PERSISTENT is ignored");
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncRemove(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.remove(path,0);
  Assert.assertFalse(success);
  success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  success=accessor.remove(path,0);
  Assert.assertTrue(success);
  Assert.assertFalse(_zkclient.exists(path));
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  Stat stat=new Stat();
  ZNRecord getRecord=accessor.get(path,stat,0);
  Assert.assertNull(getRecord);
  try {
    accessor.get(path,stat,AccessOption.THROW_EXCEPTION_IFNOTEXIST);
    Assert.fail("Should throw exception if not exist");
  }
 catch (  Exception e) {
  }
  boolean success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  Assert.assertEquals(stat.getVersion(),0);
  record.setSimpleField("key0","value0");
  success=accessor.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(record.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  Assert.assertEquals(stat.getVersion(),1);
  ZNRecord newRecord=new ZNRecord("msg_0");
  newRecord.setSimpleField("key1","value1");
  success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),2);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  Assert.assertNotNull(getRecord.getSimpleField("key1"));
  Assert.assertEquals(getRecord.getSimpleField("key1"),"value1");
  Assert.assertEquals(stat.getVersion(),2);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testHappyPathExtOpZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient extZkclient=new ZkClient(_zkaddr);
  extZkclient.setZkSerializer(new ZNRecordSerializer());
  ZkBaseDataAccessor<ZNRecord> extBaseAccessor=new ZkBaseDataAccessor<ZNRecord>(extZkclient);
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  extBaseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> zkCacheInitPaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,zkCacheInitPaths);
  boolean ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=extBaseAccessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  for (int i=0; i < 10; i++) {
    ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
    if (ret == true)     break;
    Thread.sleep(100);
  }
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=extBaseAccessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  success=extBaseAccessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    paths.add(path);
  }
  success=extBaseAccessor.remove(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in remove: " + paths.get(i));
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  extZkclient.close();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathSelfOpZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> zkCacheInitPaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,zkCacheInitPaths);
  boolean ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int j=0; j < 10; j++) {
    for (int i=0; i < 10; i++) {
      String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
      ZNRecord record=new ZNRecord("TestDB" + i);
      record.setSimpleField("setKey","" + j);
      paths.add(path);
      records.add(record);
    }
    success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=extViewPath + "/TestDB" + i;
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZkCacheCallbackExternalOpNoChroot() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient zkclient=new ZkClient(_zkaddr);
  zkclient.setZkSerializer(new ZNRecordSerializer());
  ZkBaseDataAccessor<ZNRecord> extBaseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  extBaseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,cachePaths);
  TestListener listener=new TestListener();
  accessor.subscribe(curStatePath,listener);
  List<String> createPaths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    createPaths.add(path);
    boolean success=extBaseAccessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  Thread.sleep(500);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("createCnt: " + listener._createPathQueue.size());
  Assert.assertEquals(listener._createPathQueue.size(),11,"Shall get 11 onCreate callbacks.");
  createPaths.add(curStatePath + "/session_0");
  List<String> createCallbackPaths=new ArrayList<String>(listener._createPathQueue);
  Collections.sort(createPaths);
  Collections.sort(createCallbackPaths);
  Assert.assertEquals(createCallbackPaths,createPaths,"Should get create callbacks at " + createPaths + ", but was "+ createCallbackPaths);
  List<String> updatePaths=new ArrayList<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      updatePaths.add(path);
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("changeCnt: " + listener._changePathQueue.size());
  Assert.assertEquals(listener._changePathQueue.size(),100,"Shall get 100 onChange callbacks.");
  List<String> updateCallbackPaths=new ArrayList<String>(listener._changePathQueue);
  Collections.sort(updatePaths);
  Collections.sort(updateCallbackPaths);
  Assert.assertEquals(updateCallbackPaths,updatePaths,"Should get change callbacks at " + updatePaths + ", but was "+ updateCallbackPaths);
  TreeSet<String> removePaths=new TreeSet<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    removePaths.add(path);
    boolean success=accessor.remove(path,AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in remove: " + path);
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("deleteCnt: " + listener._deletePathQueue.size());
  Assert.assertTrue(listener._deletePathQueue.size() >= 10,"Shall get at least 10 onDelete callbacks.");
  Set<String> removeCallbackPaths=new TreeSet<String>(listener._deletePathQueue);
  Assert.assertEquals(removeCallbackPaths,removePaths,"Should get remove callbacks at " + removePaths + ", but was "+ removeCallbackPaths);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkFlapping </h4><pre class="type-7 type-1 type-8 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZkSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  String path=String.format("/%s",clusterName);
  client.createEphemeral(path);
  String oldSessionId=ZkTestHelper.getSessionId(client);
  ZkTestHelper.expireSession(client);
  String newSessionId=ZkTestHelper.getSessionId(client);
  Assert.assertNotSame(newSessionId,oldSessionId);
  Assert.assertFalse(client.exists(path),"Ephemeral znode should be gone after session expiry");
  client.close();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParticipantFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  final String instanceName="localhost_12918";
  MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
  participant.syncStart();
  final ZkClient client=participant.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  client.unsubscribeStateChanges(listener);
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
  Assert.assertNotNull(liveInstance,"Live-instance should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
      return liveInstance == null;
    }
  }
,3 * 1000);
  Assert.assertTrue(success,"Live-instance should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testCloseZkClientInZkClientEventThread() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  final CountDownLatch waitCallback=new CountDownLatch(1);
  final ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  String path=String.format("/%s",clusterName);
  client.createEphemeral(path);
  client.subscribeDataChanges(path,new IZkDataListener(){
    @Override public void handleDataDeleted(    String dataPath) throws Exception {
    }
    @Override public void handleDataChange(    String dataPath,    Object data) throws Exception {
      client.close();
      waitCallback.countDown();
    }
  }
);
  client.writeData(path,new ZNRecord("test"));
  waitCallback.await();
  Assert.assertFalse(_zkclient.exists(path),"Ephemeral node: " + path + " should be removed after ZkClient#close() in its own event-thread");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testCloseZkClient(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  String path=String.format("/%s",clusterName);
  client.createEphemeral(path);
  client.close();
  Assert.assertFalse(_zkclient.exists(path),"Ephemeral node: " + path + " should be removed after ZkClient#close()");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testControllerFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  final ZkClient client=controller.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader,"Leader should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      return leader == null;
    }
  }
,5 * 1000);
  Assert.assertTrue(success,"Leader should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixAdmin </h4><pre class="type-4 type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testZkHelixAdmin(){
  System.out.println("START testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
  final String clusterName=TestUtil.getTestName();
  String rootPath="/" + clusterName;
  if (_zkclient.exists(rootPath)) {
    _zkclient.deleteRecursive(rootPath);
  }
  HelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  List<String> list=tool.getClusters();
  AssertJUnit.assertTrue(list.size() > 0);
  try {
    Stat oldstat=_zkclient.getStat(rootPath);
    Assert.assertNotNull(oldstat);
    boolean success=tool.addCluster(clusterName,false);
    Assert.assertTrue(success);
    Stat newstat=_zkclient.getStat(rootPath);
    Assert.assertEquals(oldstat,newstat);
  }
 catch (  HelixException e) {
  }
  InstanceConfig config=new InstanceConfig("host1_9999");
  config.setHostName("host1");
  config.setPort("9999");
  tool.addInstance(clusterName,config);
  tool.enableInstance(clusterName,"host1_9999",true);
  String path=PropertyPathConfig.getPath(PropertyType.INSTANCES,clusterName,"host1_9999");
  AssertJUnit.assertTrue(_zkclient.exists(path));
  try {
    tool.addInstance(clusterName,config);
    Assert.fail("should fail if add an alredy-existing instance");
  }
 catch (  HelixException e) {
  }
  config=tool.getInstanceConfig(clusterName,"host1_9999");
  AssertJUnit.assertEquals(config.getId(),"host1_9999");
  tool.dropInstance(clusterName,config);
  try {
    tool.getInstanceConfig(clusterName,"host1_9999");
    Assert.fail("should fail if get a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.dropInstance(clusterName,config);
    Assert.fail("should fail if drop on a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.enableInstance(clusterName,"host1_9999",false);
    Assert.fail("should fail if enable a non-existent instance");
  }
 catch (  HelixException e) {
  }
  ZNRecord stateModelRecord=new ZNRecord("id1");
  try {
    tool.addStateModelDef(clusterName,"id1",new StateModelDefinition(stateModelRecord));
    path=PropertyPathConfig.getPath(PropertyType.STATEMODELDEFS,clusterName,"id1");
    AssertJUnit.assertTrue(_zkclient.exists(path));
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
catch (  IllegalArgumentException ex) {
  }
  tool.addStateModelDef(clusterName,"MasterSlave",new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave()));
  stateModelRecord=StateModelConfigGenerator.generateConfigForMasterSlave();
  try {
    tool.addStateModelDef(clusterName,stateModelRecord.getId(),new StateModelDefinition(stateModelRecord));
    Assert.fail("should fail if add an already-existing state model");
  }
 catch (  HelixException e) {
  }
  list=tool.getStateModelDefs(clusterName);
  AssertJUnit.assertEquals(list.size(),1);
  try {
    tool.addResource(clusterName,"resource",10,"nonexistStateModelDef");
    Assert.fail("should fail if add a resource without an existing state model");
  }
 catch (  HelixException e) {
  }
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  ExternalView resourceExternalView=tool.getResourceExternalView(clusterName,"resource");
  AssertJUnit.assertNull(resourceExternalView);
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("pKey1","pValue1");
  properties.put("pKey2","pValue2");
  for (int i=0; i < 100; i++) {
    tool.setConfig(scope,properties);
    Map<String,String> newProperties=tool.getConfig(scope,new ArrayList<String>(properties.keySet()));
    Assert.assertEquals(newProperties.size(),2);
    Assert.assertEquals(newProperties.get("pKey1"),"pValue1");
    Assert.assertEquals(newProperties.get("pKey2"),"pValue2");
  }
  System.out.println("END testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixController </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnConnectedAndDisconnecting() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  ControllerId controllerId=ControllerId.from("controller");
  HelixController controller=connection.createController(clusterId,controllerId);
  controller.start();
  HelixDataAccessor accessor=connection.createDataAccessor(clusterId);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getInstanceName(),controllerId.stringify());
  controller.stop();
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  connection.disconnect();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.TestDefaultMessagingService </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void TestMessageSend(){
  HelixManager manager=new MockHelixManager();
  DefaultMessagingService svc=new DefaultMessagingService(manager);
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  svc.registerMessageHandlerFactory(factory.getMessageType(),factory);
  Criteria recipientCriteria=new Criteria();
  recipientCriteria.setInstanceName("localhost_12919");
  recipientCriteria.setRecipientInstanceType(InstanceType.PARTICIPANT);
  recipientCriteria.setSelfExcluded(true);
  Message template=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
  AssertJUnit.assertEquals(0,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  AssertJUnit.assertEquals(1,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  recipientCriteria.setInstanceName("%");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(200,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  recipientCriteria.setInstanceName("*");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("*");
  AssertJUnit.assertEquals(200,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  recipientCriteria.setInstanceName("localhost%");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(200,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("%");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(159,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("localhost_12920");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("l_calhost_12_20");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("%12920");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("l%_12920");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("localhost_12920");
  recipientCriteria.setRecipientInstanceType(InstanceType.CONTROLLER);
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(1,svc.send(recipientCriteria,template));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestHelixTaskExecutor </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testNormalMsgExecution() throws InterruptedException {
  System.out.println("START TestCMTaskExecutor.testNormalMsgExecution()");
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  executor.registerMessageHandlerFactory(factory2.getMessageType(),factory2);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setCorrelationId(UUID.randomUUID().toString());
    msgList.add(msg);
  }
  int nMsgs2=6;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setCorrelationId(UUID.randomUUID().toString());
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory2._processedMsgIds.size() == nMsgs2);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(factory2._handlersCreated == nMsgs2);
  for (  Message record : msgList) {
    AssertJUnit.assertTrue(factory._processedMsgIds.containsKey(record.getId()) || factory2._processedMsgIds.containsKey(record.getId()));
    AssertJUnit.assertFalse(factory._processedMsgIds.containsKey(record.getId()) && factory2._processedMsgIds.containsKey(record.getId()));
  }
  System.out.println("END TestCMTaskExecutor.testNormalMsgExecution()");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testCreateHandlerException() throws InterruptedException {
  System.out.println("START TestCMTaskExecutor.testCreateHandlerException()");
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setCorrelationId(UUID.randomUUID().toString());
    msgList.add(msg);
  }
  Message exceptionMsg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
  exceptionMsg.setTgtSessionId(SessionId.from(manager.getSessionId()));
  exceptionMsg.setMsgSubType("EXCEPTION");
  exceptionMsg.setTgtName("Localhost_1123");
  exceptionMsg.setSrcName("127.101.1.23_2234");
  exceptionMsg.setCorrelationId(UUID.randomUUID().toString());
  msgList.add(exceptionMsg);
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(exceptionMsg.getMsgState() == MessageState.UNPROCESSABLE);
  System.out.println("END TestCMTaskExecutor.testCreateHandlerException()");
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test() public void testShutdown() throws InterruptedException {
  System.out.println("START TestCMTaskExecutor.testShutdown()");
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  executor.registerMessageHandlerFactory(factory2.getMessageType(),factory2);
  CancellableHandlerFactory factory3=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory3.getMessageType(),factory3);
  int nMsg1=10, nMsg2=10, nMsg3=10;
  List<Message> msgList=new ArrayList<Message>();
  for (int i=0; i < nMsg1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  for (int i=0; i < nMsg2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msgList.add(msg);
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  for (int i=0; i < nMsg3; i++) {
    Message msg=new Message(factory3.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msgList.add(msg);
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  NotificationContext changeContext=new NotificationContext(manager);
  executor.onMessage("some",msgList,changeContext);
  Thread.sleep(500);
  for (  ExecutorService svc : executor._executorMap.values()) {
    Assert.assertFalse(svc.isShutdown());
  }
  Assert.assertTrue(factory._processedMsgIds.size() > 0);
  executor.shutdown();
  for (  ExecutorService svc : executor._executorMap.values()) {
    Assert.assertTrue(svc.isShutdown());
  }
  System.out.println("END TestCMTaskExecutor.testShutdown()");
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testNoRetry() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setExecutionTimeout((i + 1) * 600);
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(4000);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs2);
  AssertJUnit.assertEquals(factory._timedOutMsgIds.size(),2);
  for (int i=0; i < nMsgs2 - 2; i++) {
    if (msgList.get(i).getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(msgList.get(i).getRecord().getSimpleFields().containsKey("Cancelcount"));
      AssertJUnit.assertTrue(factory._timedOutMsgIds.containsKey(msgList.get(i).getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testTaskCancellation() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=0;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  List<Message> msgListToCancel=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msgList.add(msg);
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgListToCancel.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(500);
  for (int i=0; i < nMsgs2; i++) {
    HelixTask task=new HelixTask(msgListToCancel.get(i),changeContext,null,null);
    executor.cancelTask(task);
  }
  Thread.sleep(1500);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1 + nMsgs2);
  AssertJUnit.assertTrue(factory._processingMsgIds.size() == nMsgs1 + nMsgs2);
  for (  Message message : msgList) {
    if (message.getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(factory._processingMsgIds.containsKey(message.getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testUnknownTypeMsgExecution() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory2._processedMsgIds.size() == 0);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(factory2._handlersCreated == 0);
  for (  Message message : msgList) {
    if (message.getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(factory._processedMsgIds.containsKey(message.getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testMsgSessionId() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  executor.registerMessageHandlerFactory(factory2.getMessageType(),factory2);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("");
    msgList.add(msg);
  }
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("some other session id"));
    msg.setTgtName("");
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory2._processedMsgIds.size() == 0);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(factory2._handlersCreated == 0);
  for (  Message message : msgList) {
    if (message.getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(factory._processedMsgIds.containsKey(message.getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testRetryOnce() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setExecutionTimeout((i + 1) * 600);
    msg.setRetryCount(1);
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(3500);
  AssertJUnit.assertEquals(factory._processedMsgIds.size(),3);
  AssertJUnit.assertTrue(msgList.get(0).getRecord().getSimpleField("Cancelcount").equals("2"));
  AssertJUnit.assertTrue(msgList.get(1).getRecord().getSimpleField("Cancelcount").equals("1"));
  AssertJUnit.assertEquals(factory._timedOutMsgIds.size(),2);
  AssertJUnit.assertTrue(executor._taskMap.size() == 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestResourceThreadpoolSize </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestThreadPoolSizeConfig(){
  HelixManager manager=_participants[0];
  ConfigAccessor accessor=manager.getConfigAccessor();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(manager.getClusterName()).forResource("NextDB").build();
  accessor.set(scope,HelixTaskExecutor.MAX_THREADS,"" + 12);
  _setupTool.addResourceToCluster(CLUSTER_NAME,"NextDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"NextDB",3);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  long taskcount=0;
  for (int i=0; i < NODE_NR; i++) {
    DefaultMessagingService svc=(DefaultMessagingService)(_participants[i].getMessagingService());
    HelixTaskExecutor helixExecutor=svc.getExecutor();
    ThreadPoolExecutor executor=(ThreadPoolExecutor)(helixExecutor._executorMap.get(MessageType.STATE_TRANSITION + "." + "NextDB"));
    Assert.assertEquals(12,executor.getMaximumPoolSize());
    taskcount+=executor.getCompletedTaskCount();
    Assert.assertTrue(executor.getCompletedTaskCount() > 0);
  }
  Assert.assertEquals(taskcount,64 * 4);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.TestConstraint </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMsgConstraint(){
  String className=TestUtil.getTestName();
  System.out.println("START testMsgConstraint() at " + new Date(System.currentTimeMillis()));
  String clusterName="CLUSTER_" + className + "_msg";
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  ZNRecord record=new ZNRecord("testMsgConstraint");
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","ANY");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","50");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint2").put("INSTANCE",".*");
  record.getMapField("constraint2").put("RESOURCE","TestDB");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint3").put("INSTANCE","localhost_12919");
  record.getMapField("constraint3").put("RESOURCE",".*");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint3"));
  record.setMapField("constraint4",new TreeMap<String,String>());
  record.getMapField("constraint4").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint4").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint4").put("INSTANCE",".*");
  record.getMapField("constraint4").put("RESOURCE",".*");
  record.getMapField("constraint4").put("CONSTRAINT_VALUE","10");
  ConstraintItem constraint4=new ConstraintItem(record.getMapField("constraint4"));
  record.setMapField("constraint5",new TreeMap<String,String>());
  record.getMapField("constraint5").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint5").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint5").put("INSTANCE","localhost_12918");
  record.getMapField("constraint5").put("RESOURCE","TestDB");
  record.getMapField("constraint5").put("CONSTRAINT_VALUE","5");
  ConstraintItem constraint5=new ConstraintItem(record.getMapField("constraint5"));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  record=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString())).getRecord();
  ClusterConstraints constraint=new ClusterConstraints(record);
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_12918");
  Map<ConstraintAttribute,String> msgAttr=ClusterConstraints.toConstraintAttributes(msg1);
  Set<ConstraintItem> matches=constraint.match(msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Assert.assertTrue(contains(matches,constraint4));
  Assert.assertTrue(contains(matches,constraint5));
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_12919");
  msgAttr=ClusterConstraints.toConstraintAttributes(msg2);
  matches=constraint.match(msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Assert.assertTrue(contains(matches,constraint3));
  Assert.assertTrue(contains(matches,constraint4));
  System.out.println("END testMsgConstraint() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.mbeans.TestClusterStatusMonitor </h4><pre class="type-7 type-5 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testReportData() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  String testDB="TestDB";
  String testDB_0=testDB + "_0";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ClusterStatusMonitor monitor=new ClusterStatusMonitor(clusterName);
  ObjectName clusterMonitorObjName=monitor.getObjectName(monitor.clusterBeanName());
  try {
    _server.getMBeanInfo(clusterMonitorObjName);
  }
 catch (  Exception e) {
    Assert.fail("Fail to register ClusterStatusMonitor");
  }
  BestPossibleStateOutput bestPossibleStates=new BestPossibleStateOutput();
  ResourceAssignment assignment=new ResourceAssignment(ResourceId.from(testDB));
  Map<ParticipantId,State> replicaMap=Maps.newHashMap();
  replicaMap.put(ParticipantId.from("localhost_12918"),State.from("MASTER"));
  replicaMap.put(ParticipantId.from("localhost_12919"),State.from("SLAVE"));
  replicaMap.put(ParticipantId.from("localhost_12920"),State.from("SLAVE"));
  replicaMap.put(ParticipantId.from("localhost_12921"),State.from("OFFLINE"));
  replicaMap.put(ParticipantId.from("localhost_12922"),State.from("DROPPED"));
  assignment.addReplicaMap(PartitionId.from(testDB_0),replicaMap);
  bestPossibleStates.setResourceAssignment(ResourceId.from(testDB),assignment);
  Map<String,InstanceConfig> instanceConfigMap=Maps.newHashMap();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    InstanceConfig config=new InstanceConfig(instanceName);
    instanceConfigMap.put(instanceName,config);
  }
  Map<ResourceId,ResourceConfig> resourceMap=Maps.newHashMap();
  ResourceId resourceId=ResourceId.from(testDB);
  AutoModeISBuilder idealStateBuilder=new AutoModeISBuilder(resourceId).add(testDB_0);
  idealStateBuilder.setStateModel("MasterSlave");
  IdealState idealState=idealStateBuilder.build();
  ResourceConfig resourceConfig=new ResourceConfig.Builder(resourceId).idealState(idealState).build();
  resourceMap.put(resourceId,resourceConfig);
  Map<String,StateModelDefinition> stateModelDefMap=Maps.newHashMap();
  StateModelDefinition msStateModelDef=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  stateModelDefMap.put("MasterSlave",msStateModelDef);
  monitor.setPerInstanceResourceStatus(bestPossibleStates,instanceConfigMap,resourceMap,stateModelDefMap);
  ObjectName objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12918",testDB));
  Object value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(1));
  value=_server.getAttribute(objName,"SensorName");
  Assert.assertTrue(value instanceof String);
  Assert.assertEquals((String)value,String.format("%s.%s.%s.%s.%s",ClusterStatusMonitor.PARTICIPANT_STATUS_KEY,clusterName,ClusterStatusMonitor.DEFAULT_TAG,"localhost_12918",testDB));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12919",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(1));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12921",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(0));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12922",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(0));
  replicaMap.remove(ParticipantId.from("localhost_12918"));
  assignment.addReplicaMap(PartitionId.from(testDB_0),replicaMap);
  bestPossibleStates.setResourceAssignment(ResourceId.from(testDB),assignment);
  monitor.setPerInstanceResourceStatus(bestPossibleStates,instanceConfigMap,resourceMap,stateModelDefMap);
  try {
    objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12918",testDB));
    _server.getMBeanInfo(objName);
    Assert.fail("Fail to unregister PerInstanceResource mbean for localhost_12918");
  }
 catch (  InstanceNotFoundException e) {
  }
  monitor.reset();
  try {
    objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12920",testDB));
    _server.getMBeanInfo(objName);
    Assert.fail("Fail to unregister PerInstanceResource mbean for localhost_12920");
  }
 catch (  InstanceNotFoundException e) {
  }
  try {
    _server.getMBeanInfo(clusterMonitorObjName);
    Assert.fail("Fail to unregister ClusterStatusMonitor");
  }
 catch (  InstanceNotFoundException e) {
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.mbeans.TestDropResourceMetricsReset </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testBasic() throws Exception {
  final int NUM_PARTICIPANTS=4;
  final int NUM_PARTITIONS=64;
  final int NUM_REPLICAS=1;
  final String RESOURCE_NAME="TestDB0";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ParticipantMonitorListener listener=new ParticipantMonitorListener("ClusterStatus",clusterName,RESOURCE_NAME);
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  ClusterSetup setupTool=new ClusterSetup(_zkclient);
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    participants[i]=new MockParticipant(_zkaddr,clusterName,"localhost_" + (12918 + i));
    participants[i].syncStart();
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  boolean noTimeout=_registerLatch.await(30000,TimeUnit.MILLISECONDS);
  Assert.assertTrue(noTimeout);
  setupTool.dropResourceFromCluster(clusterName,RESOURCE_NAME);
  noTimeout=_unregisterLatch.await(30000,TimeUnit.MILLISECONDS);
  Assert.assertTrue(noTimeout);
  listener.disconnect();
  controller.syncStop();
  for (  MockParticipant participant : participants) {
    participant.syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.participant.statemachine.TestStateModelParser </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsingAnnotation(){
  StateModelParser parser=new StateModelParser();
  StateModelUsingAnnotation testModel=new StateModelUsingAnnotation();
  Method method=parser.getMethodForTransitionUsingAnnotation(testModel.getClass(),"offline","slave",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"onBecomeSlaveFromOffline");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedUsingAnnotation(){
  StateModelParser parser=new StateModelParser();
  DerivedStateModelUsingAnnotation testModel=new DerivedStateModelUsingAnnotation();
  Method method=parser.getMethodForTransitionUsingAnnotation(testModel.getClass(),"offline","slave",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"derivedOnBecomeSlaveFromOffline");
  method=parser.getMethodForTransitionUsingAnnotation(testModel.getClass(),"error","dropped",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"onBecomeDroppedFromError");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsingNameConvention(){
  StateModelParser parser=new StateModelParser();
  StateModelUsingNameConvention testModel=new StateModelUsingNameConvention();
  Method method=parser.getMethodForTransition(testModel.getClass(),"error","dropped",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"onBecomeDroppedFromError");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.resolver.TestZKHelixResolver </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResolution(){
  HelixMessageScope clusterScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).build();
  Set<HelixAddress> destinations=_resolver.getDestinations(clusterScope);
  Assert.assertNotNull(destinations);
  Set<InetSocketAddress> addresses=new HashSet<InetSocketAddress>();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertTrue(addresses.containsAll(_socketMap.values()),"Expected " + _socketMap.values() + ", found "+ addresses);
  HelixMessageScope resourceScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).build();
  destinations=_resolver.getDestinations(resourceScope);
  Assert.assertNotNull(destinations);
  addresses.clear();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertTrue(addresses.containsAll(_socketMap.values()),"Expected " + _socketMap.values() + ", found "+ addresses);
  HelixMessageScope partition0Scope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).partition(RESOURCE_NAME + "_0").build();
  destinations=_resolver.getDestinations(partition0Scope);
  Assert.assertNotNull(destinations);
  ExternalView externalView=_setupTool.getClusterManagementTool().getResourceExternalView(CLUSTER_NAME,RESOURCE_NAME);
  Set<String> instanceSet=externalView.getStateMap(RESOURCE_NAME + "_0").keySet();
  Set<InetSocketAddress> expectedSocketAddrs=Sets.newHashSet();
  for (  String instanceName : instanceSet) {
    expectedSocketAddrs.add(_socketMap.get(instanceName));
  }
  addresses.clear();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertEquals(addresses,expectedSocketAddrs,"Expected " + expectedSocketAddrs + ", found "+ addresses);
  HelixMessageScope sourceInstanceScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).partition(RESOURCE_NAME + "_0").sourceInstance(_participants[0].getInstanceName()).build();
  HelixAddress sourceAddress=_resolver.getSource(sourceInstanceScope);
  Assert.assertNotNull(sourceAddress);
  Assert.assertEquals(sourceAddress.getSocketAddress(),_socketMap.get(_participants[0].getInstanceName()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestAutoFallbackPropertyStore </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 20; i++) {
    if (i < 10) {
      String path=String.format("%s/%d",fallbackRoot,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
 else {
      String path=String.format("%s/%d",root,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
    }
    paths.add(path);
  }
  List<String> childs=store.getChildNames("/",0);
  Assert.assertNotNull(childs);
  Assert.assertEquals(childs.size(),20);
  for (int i=0; i < 20; i++) {
    String child=childs.get(i);
    Assert.assertTrue(childs.contains(child));
  }
  List<ZNRecord> records=store.getChildren("/",null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    Assert.assertNotNull(record);
    String id=record.getId();
    Assert.assertTrue(childs.contains(id));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test void testMultiGetOnFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertTrue(exists[i]);
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertNotNull(stats[i]);
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),10);
  for (int i=0; i < 10; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNull(record.getSimpleField("key"));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key"));
    Assert.assertEquals(record.getSimpleField("key"),"value");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleUpdateUsingFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean succeed=store.update(path,new MyDataUpdater("new0"),AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNull(record.getSimpleField("key"));
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNotNull(record.getSimpleField("key"));
  Assert.assertEquals(record.getSimpleField("key"),"value");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingNewath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    path=String.format("%s/%d",root,i);
    baseAccessor.create(path,new ZNRecord("new" + i),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    if (i < 10) {
      ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),"" + i);
      Assert.assertNull(record.getSimpleField("key"));
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    ZNRecord record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
    if (i < 10) {
      Assert.assertNotNull(record.getSimpleField("key"));
      Assert.assertEquals(record.getSimpleField("key"),"value");
    }
 else {
      Assert.assertNull(record.getSimpleField("key"));
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    ZNRecord record=new ZNRecord("new" + i);
    records.add(record);
  }
  boolean succeed[]=store.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=String.format("/%d",i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  ZNRecord record=new ZNRecord("new0");
  boolean succeed=store.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"new0");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailOnMultiGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertTrue(exists[i]);
    }
 else {
      Assert.assertFalse(exists[i]);
    }
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertNotNull(stats[i]);
    }
 else {
      Assert.assertNull(stats[i]);
    }
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    if (i < 10) {
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),Integer.toString(i));
    }
 else {
      Assert.assertNull(record);
    }
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailOnSingleGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
  boolean exist=store.exists(path,0);
  Assert.assertFalse(exist);
  Stat stat=store.getStat(path,0);
  Assert.assertNull(stat);
  ZNRecord record=store.get(path,null,0);
  Assert.assertNull(record);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleUpdateUsingNewPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",root,i);
    baseAccessor.create(path,new ZNRecord("new" + i),AccessOption.PERSISTENT);
    path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean succeed=store.update(path,new MyDataUpdater("0"),AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNull(record.getSimpleField("key"));
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"new0");
  Assert.assertNotNull(record.getSimpleField("key"));
  Assert.assertEquals(record.getSimpleField("key"),"value");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleGetOnFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean exist=store.exists(path,0);
  Assert.assertTrue(exist);
  Stat stat=store.getStat(path,0);
  Assert.assertNotNull(stat);
  ZNRecord record=store.get(path,null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestZkHelixPropertyStore </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet(){
  System.out.println("START testSet() at " + new Date(System.currentTimeMillis()));
  String subRoot=_root + "/" + "set";
  List<String> subscribedPaths=new ArrayList<String>();
  subscribedPaths.add(subRoot);
  ZkHelixPropertyStore<ZNRecord> store=new ZkHelixPropertyStore<ZNRecord>(new ZkBaseDataAccessor<ZNRecord>(_zkclient),subRoot,subscribedPaths);
  setNodes(store,'a',false);
  for (int i=0; i < 10; i++) {
    for (int j=0; j < 10; j++) {
      String nodeId=getNodeId(i,j);
      String key=getSecondLevelKey(i,j);
      ZNRecord record=store.get(key,null,0);
      Assert.assertEquals(record.getId(),nodeId);
    }
  }
  long startT=System.currentTimeMillis();
  for (int i=0; i < 1000; i++) {
    ZNRecord record=store.get("/node_0/childNode_0_0",null,0);
    Assert.assertNotNull(record);
  }
  long endT=System.currentTimeMillis();
  System.out.println("1000 Get() time used: " + (endT - startT) + "ms");
  long latency=endT - startT;
  Assert.assertTrue(latency < 200,"1000 Gets should be finished within 200ms, but was " + latency + " ms");
  store.stop();
  System.out.println("END testSet() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestZkManagerWithAutoFallbackStore </h4><pre class="type-4 type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",false);
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  BaseDataAccessor<ZNRecord> accessor=participants[0].getHelixDataAccessor().getBaseDataAccessor();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%s/HELIX_PROPERTYSTORE/%d",clusterName,i);
    ZNRecord record=new ZNRecord("" + i);
    record.setSimpleField("key1","value1");
    accessor.set(path,record,AccessOption.PERSISTENT);
  }
  ZkHelixPropertyStore<ZNRecord> store=participants[0].getHelixPropertyStore();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key1"));
    Assert.assertEquals(record.getSimpleField("key1"),"value1");
  }
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    store.update(path,new DataUpdater<ZNRecord>(){
      @Override public ZNRecord update(      ZNRecord currentData){
        if (currentData != null) {
          currentData.setSimpleField("key2","value2");
        }
        return currentData;
      }
    }
,AccessOption.PERSISTENT);
  }
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key1"));
    Assert.assertEquals(record.getSimpleField("key1"),"value1");
    Assert.assertNotNull(record.getSimpleField("key2"));
    Assert.assertEquals(record.getSimpleField("key2"),"value2");
  }
  for (int i=10; i < 20; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=new ZNRecord("" + i);
    record.setSimpleField("key3","value3");
    store.set(path,record,AccessOption.PERSISTENT);
  }
  for (int i=10; i < 20; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key3"));
    Assert.assertEquals(record.getSimpleField("key3"),"value3");
  }
  participants[0].syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestClusterSetup </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSetGetRemoveParticipantConfig() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  _setupTool.addCluster(clusterName,true);
  _setupTool.addInstanceToCluster(clusterName,"localhost_0");
  String scopeArgs=clusterName + ",localhost_0";
  String keyValueMap="key1=value1,key2=value2";
  String keys="key1,key2";
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--setConfig",ConfigScopeProperty.PARTICIPANT.toString(),scopeArgs,keyValueMap});
  String valuesStr=_setupTool.getConfig(ConfigScopeProperty.PARTICIPANT,scopeArgs,keys);
  ZNRecordSerializer serializer=new ZNRecordSerializer();
  ZNRecord record=(ZNRecord)serializer.deserialize(valuesStr.getBytes());
  Assert.assertEquals(record.getSimpleField("key1"),"value1");
  Assert.assertEquals(record.getSimpleField("key2"),"value2");
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--removeConfig",ConfigScopeProperty.PARTICIPANT.toString(),scopeArgs,keys});
  valuesStr=_setupTool.getConfig(ConfigScopeProperty.PARTICIPANT,scopeArgs,keys);
  record=(ZNRecord)serializer.deserialize(valuesStr.getBytes());
  Assert.assertNull(record.getSimpleField("key1"));
  Assert.assertNull(record.getSimpleField("key2"));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestClusterStateVerifier </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testResourceSubset() throws InterruptedException {
  _admin.enableInstance(_clusterName,"localhost_12918",false);
  Thread.sleep(1000);
  _admin.enableCluster(_clusterName,false);
  Thread.sleep(1000);
  _admin.enableInstance(_clusterName,"localhost_12918",true);
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,_clusterName,null,Sets.newHashSet(RESOURCES[1])));
  Assert.assertTrue(result);
  String[] args={"--zkSvr",_zkaddr,"--cluster",_clusterName,"--resources",RESOURCES[1]};
  result=ClusterStateVerifier.verifyState(args);
  Assert.assertTrue(result);
  boolean fullResult=new BestPossAndExtViewZkVerifier(_zkaddr,_clusterName).verify();
  Assert.assertFalse(fullResult);
  _admin.enableCluster(_clusterName,true);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestZkCopy </h4><pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testSkipCopyExistZnode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String srcClusterName=testName + "_src";
  String dstClusterName=testName + "_dst";
  int n=5;
  TestHelper.setupCluster(srcClusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  TestHelper.setupEmptyCluster(_zkclient,dstClusterName);
  String fromPath=String.format("/%s/INSTANCES",srcClusterName);
  String toPath=String.format("/%s/INSTANCES",dstClusterName);
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  fromPath=String.format("/%s/CONFIGS/PARTICIPANT",srcClusterName);
  toPath=String.format("/%s/CONFIGS/PARTICIPANT",dstClusterName);
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    boolean ret=ZKUtil.isInstanceSetup(_zkclient,dstClusterName,instanceName,InstanceType.PARTICIPANT);
    Assert.assertTrue(ret);
  }
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String fromPath="/" + clusterName + "/from";
  _zkclient.createPersistent(fromPath,true);
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",fromPath,i,j);
      _zkclient.createPersistent(path,true);
      _zkclient.writeData(path,new ZNRecord(String.format("%d/%d",i,j)));
    }
  }
  String toPath="/" + clusterName + "/to";
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  Assert.assertTrue(_zkclient.exists(toPath));
  Assert.assertNull(_zkclient.readData(toPath));
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",toPath,i,j);
      Assert.assertTrue(_zkclient.exists(path));
      ZNRecord record=_zkclient.readData(path);
      Assert.assertEquals(String.format("%d/%d",i,j),record.getId());
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.util.TestZKClientPool </h4><pre class="type-7 type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String testName="TestZKClientPool";
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String zkAddr="localhost:2189";
  ZkServer zkServer=TestHelper.startZkServer(zkAddr);
  ZkClient zkClient=ZKClientPool.getZkClient(zkAddr);
  zkClient.createPersistent("/" + testName,new ZNRecord(testName));
  ZNRecord record=zkClient.readData("/" + testName);
  Assert.assertEquals(record.getId(),testName);
  TestHelper.stopZkServer(zkServer);
  zkServer=TestHelper.startZkServer(zkAddr);
  try {
    zkClient=ZKClientPool.getZkClient(zkAddr);
    record=zkClient.readData("/" + testName);
    Assert.fail("should fail on zk no node exception");
  }
 catch (  ZkNoNodeException e) {
  }
catch (  Exception e) {
    Assert.fail("should not fail on exception other than ZkNoNodeException");
  }
  zkClient.createPersistent("/" + testName,new ZNRecord(testName));
  record=zkClient.readData("/" + testName);
  Assert.assertEquals(record.getId(),testName);
  zkClient.close();
  TestHelper.stopZkServer(zkServer);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestHelixAdminScenariosRest </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testStartCluster() throws Exception {
  final String clusterName="clusterTestStartCluster";
  final String controllerClusterName="controllerClusterTestStartCluster";
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  Map<String,MockMultiClusterController> multiClusterControllers=new HashMap<String,MockMultiClusterController>();
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",8);
  rebalanceResource(clusterName,"db_11");
  addCluster(controllerClusterName);
  addInstancesToCluster(controllerClusterName,"controller_900",2,null);
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  for (int i=0; i < 2; i++) {
    String controllerName="controller_900" + i;
    MockMultiClusterController multiClusterController=new MockMultiClusterController(_zkaddr,controllerClusterName,controllerName);
    multiClusterController.syncStart();
    multiClusterControllers.put(controllerName,multiClusterController);
  }
  Thread.sleep(100);
  String clusterUrl=getClusterUrl(clusterName);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd("nonExistCluster",true),true);
  clusterUrl=getClusterUrl("nonExistCluster");
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,true),true);
  clusterUrl=getClusterUrl(clusterName);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,true),false);
  Thread.sleep(500);
  deleteUrl(clusterUrl,true);
  HelixDataAccessor accessor=multiClusterControllers.get("controller_9001").getHelixDataAccessor();
  LiveInstance controllerLeader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  Assert.assertTrue(controllerLeader.getInstanceName().startsWith("controller_900"));
  accessor=participants.get("localhost_1232").getHelixDataAccessor();
  LiveInstance leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  for (int i=0; i < 5; i++) {
    if (leader != null) {
      break;
    }
    Thread.sleep(1000);
    leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  }
  Assert.assertTrue(leader.getInstanceName().startsWith("controller_900"));
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  Thread.sleep(1000);
  for (  MockMultiClusterController controller : multiClusterControllers.values()) {
    controller.syncStop();
  }
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testGetInstances() throws IOException {
  final String clusterName="TestTagAwareness_testGetResources";
  final String[] TAGS={"tag1","tag2"};
  final String URL_BASE="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/instances";
  _setupTool.addCluster(clusterName,true);
  HelixAdmin admin=_setupTool.getClusterManagementTool();
  InstanceConfig instance1=new InstanceConfig("localhost_1");
  instance1.addTag(TAGS[0]);
  admin.addInstance(clusterName,instance1);
  InstanceConfig instance2=new InstanceConfig("localhost_2");
  instance2.addTag(TAGS[1]);
  admin.addInstance(clusterName,instance2);
  InstanceConfig instance3=new InstanceConfig("localhost_3");
  instance3.addTag(TAGS[0]);
  instance3.addTag(TAGS[1]);
  admin.addInstance(clusterName,instance3);
  InstanceConfig instance4=new InstanceConfig("localhost_4");
  admin.addInstance(clusterName,instance4);
  Reference resourceRef=new Reference(URL_BASE);
  Request request=new Request(Method.GET,resourceRef);
  Response response=_gClient.handle(request);
  ListInstancesWrapper responseWrapper=ClusterRepresentationUtil.JsonToObject(ListInstancesWrapper.class,response.getEntityAsText());
  Map<String,List<String>> tagInfo=responseWrapper.tagInfo;
  Assert.assertTrue(tagInfo.containsKey(TAGS[0]));
  Assert.assertTrue(tagInfo.containsKey(TAGS[1]));
  Assert.assertTrue(tagInfo.get(TAGS[0]).contains("localhost_1"));
  Assert.assertFalse(tagInfo.get(TAGS[0]).contains("localhost_2"));
  Assert.assertTrue(tagInfo.get(TAGS[0]).contains("localhost_3"));
  Assert.assertFalse(tagInfo.get(TAGS[0]).contains("localhost_4"));
  Assert.assertFalse(tagInfo.get(TAGS[1]).contains("localhost_1"));
  Assert.assertTrue(tagInfo.get(TAGS[1]).contains("localhost_2"));
  Assert.assertTrue(tagInfo.get(TAGS[1]).contains("localhost_3"));
  Assert.assertFalse(tagInfo.get(TAGS[1]).contains("localhost_4"));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testAddCluster() throws Exception {
  String url="http://localhost:" + ADMIN_PORT + "/clusters";
  String response=assertSuccessPostOperation(url,addClusterCmd("clusterTest"),false);
  Assert.assertTrue(response.contains("clusterTest"));
  response=assertSuccessPostOperation(url,addClusterCmd("/ClusterTest"),true);
  response=assertSuccessPostOperation(url,addClusterCmd("Klazt3rz"),false);
  Assert.assertTrue(response.contains("Klazt3rz"));
  response=assertSuccessPostOperation(url,addClusterCmd("\\ClusterTest"),false);
  Assert.assertTrue(response.contains("\\ClusterTest"));
  response=assertSuccessPostOperation(url,addClusterCmd("clusterTest"),true);
  Assert.assertTrue(ZKUtil.isClusterSetup("Klazt3rz",_zkclient));
  Assert.assertTrue(ZKUtil.isClusterSetup("clusterTest",_zkclient));
  Assert.assertTrue(ZKUtil.isClusterSetup("\\ClusterTest",_zkclient));
  String clusterUrl=getClusterUrl("\\ClusterTest");
  deleteUrl(clusterUrl,false);
  String clustersUrl="http://localhost:" + ADMIN_PORT + "/clusters";
  response=getUrl(clustersUrl);
  clusterUrl=getClusterUrl("clusterTest1");
  deleteUrl(clusterUrl,false);
  response=getUrl(clustersUrl);
  Assert.assertFalse(response.contains("clusterTest1"));
  clusterUrl=getClusterUrl("clusterTest");
  deleteUrl(clusterUrl,false);
  response=getUrl(clustersUrl);
  Assert.assertFalse(response.contains("clusterTest"));
  clusterUrl=getClusterUrl("clusterTestOK");
  deleteUrl(clusterUrl,false);
  Assert.assertFalse(_zkclient.exists("/clusterTest"));
  Assert.assertFalse(_zkclient.exists("/clusterTest1"));
  Assert.assertFalse(_zkclient.exists("/clusterTestOK"));
  response=assertSuccessPostOperation(url,addClusterCmd("clusterTest1"),false);
  response=getUrl(clustersUrl);
  Assert.assertTrue(response.contains("clusterTest1"));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testInstanceOperations() throws Exception {
  final String clusterName="clusterTestInstanceOperations";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",8);
  rebalanceResource(clusterName,"db_11");
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  HelixDataAccessor accessor;
  String instanceUrl=getInstanceUrl(clusterName,"localhost_1232");
  deleteUrl(instanceUrl,true);
  String response=assertSuccessPostOperation(instanceUrl,enableInstanceCmd(false),false);
  Assert.assertTrue(response.contains("false"));
  deleteUrl(instanceUrl,true);
  String instancesUrl=getClusterUrl(clusterName) + "/instances";
  response=assertSuccessPostOperation(instancesUrl,swapInstanceCmd("localhost_1232","localhost_12320"),true);
  participants.get("localhost_1232").syncStop();
  response=assertSuccessPostOperation(instancesUrl,addInstanceCmd("localhost_12320"),false);
  Assert.assertTrue(response.contains("localhost_12320"));
  response=assertSuccessPostOperation(instancesUrl,swapInstanceCmd("localhost_1232","localhost_12320"),false);
  Assert.assertTrue(response.contains("localhost_12320"));
  Assert.assertFalse(response.contains("localhost_1232\""));
  accessor=participants.get("localhost_1231").getHelixDataAccessor();
  String path=accessor.keyBuilder().instanceConfig("localhost_1232").getPath();
  Assert.assertFalse(_zkclient.exists(path));
  MockParticipant newParticipant=new MockParticipant(_zkaddr,clusterName,"localhost_12320");
  newParticipant.syncStart();
  participants.put("localhost_12320",newParticipant);
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEnablePartitions() throws IOException, InterruptedException {
  final String clusterName="clusterTestEnablePartitions";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",22);
  rebalanceResource(clusterName,"db_11");
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  HelixDataAccessor accessor=participants.get("localhost_1231").getHelixDataAccessor();
  String hostName="localhost_1231";
  String instanceUrl=getInstanceUrl(clusterName,hostName);
  ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  String response=assertSuccessPostOperation(instanceUrl,enablePartitionCmd("db_11","db_11_0;db_11_11",false),false);
  Assert.assertTrue(response.contains("DISABLED_PARTITION"));
  Assert.assertTrue(response.contains("db_11_0"));
  Assert.assertTrue(response.contains("db_11_11"));
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  Assert.assertEquals(ev.getStateMap("db_11_0").get(hostName),"OFFLINE");
  Assert.assertEquals(ev.getStateMap("db_11_11").get(hostName),"OFFLINE");
  response=assertSuccessPostOperation(instanceUrl,enablePartitionCmd("db_11","db_11_0;db_11_11",true),false);
  Assert.assertFalse(response.contains("db_11_0"));
  Assert.assertFalse(response.contains("db_11_11"));
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  Assert.assertEquals(ev.getStateMap("db_11_0").get(hostName),"MASTER");
  Assert.assertEquals(ev.getStateMap("db_11_11").get(hostName),"SLAVE");
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResources() throws IOException {
  final String clusterName="TestTagAwareness_testGetResources";
  final String TAG="tag";
  final String URL_BASE="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  _setupTool.addCluster(clusterName,true);
  HelixAdmin admin=_setupTool.getClusterManagementTool();
  IdealState taggedResource=new IdealState("taggedResource");
  taggedResource.setInstanceGroupTag(TAG);
  taggedResource.setStateModelDefRef("OnlineOffline");
  admin.addResource(clusterName,taggedResource.getId(),taggedResource);
  IdealState untaggedResource=new IdealState("untaggedResource");
  untaggedResource.setStateModelDefRef("OnlineOffline");
  admin.addResource(clusterName,untaggedResource.getId(),untaggedResource);
  Reference resourceRef=new Reference(URL_BASE);
  Request request=new Request(Method.GET,resourceRef);
  Response response=_gClient.handle(request);
  ZNRecord responseRecord=ClusterRepresentationUtil.JsonToObject(ZNRecord.class,response.getEntityAsText());
  Assert.assertNotNull(responseRecord.getMapField("ResourceTags"));
  Assert.assertEquals(TAG,responseRecord.getMapField("ResourceTags").get(taggedResource.getId()));
  Assert.assertFalse(responseRecord.getMapField("ResourceTags").containsKey(untaggedResource.getId()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testAddInstance() throws Exception {
  final String clusterName="clusterTestAddInstance";
  addCluster(clusterName);
  String clusterUrl=getClusterUrl(clusterName);
  String instancesUrl=clusterUrl + "/instances";
  addInstancesToCluster(clusterName,"localhost:123",3,null);
  String instances="localhost:1233;localhost:1234;localhost:1235;localhost:1236";
  String response=assertSuccessPostOperation(instancesUrl,addInstanceCmd(instances),false);
  for (int i=3; i <= 6; i++) {
    Assert.assertTrue(response.contains("localhost_123" + i));
  }
  String instanceUrl=instancesUrl + "/localhost_1236";
  deleteUrl(instanceUrl,true);
  response=getUrl(instancesUrl);
  Assert.assertTrue(response.contains("localhost_1236"));
  instanceUrl=instancesUrl + "/localhost_12367";
  deleteUrl(instanceUrl,true);
  response=getUrl(instancesUrl);
  Assert.assertFalse(response.contains("localhost_12367"));
  instanceUrl=instancesUrl + "/localhost_1236";
  response=assertSuccessPostOperation(instanceUrl,enableInstanceCmd(false),false);
  Assert.assertTrue(response.contains("false"));
  deleteUrl(instanceUrl,false);
  final String controllerClusterName="controllerClusterTestAddInstance";
  addCluster(controllerClusterName);
  String controllers="controller:9000;controller:9001";
  String controllerUrl=getClusterUrl(controllerClusterName) + "/instances";
  response=assertSuccessPostOperation(controllerUrl,addInstanceCmd(controllers),false);
  Assert.assertTrue(response.contains("controller_9000"));
  Assert.assertTrue(response.contains("controller_9001"));
  response=assertSuccessPostOperation(instancesUrl,addInstanceCmd("localhost:1234"),true);
  for (int i=0; i < 4; i++) {
    instanceUrl=instancesUrl + "/localhost_123" + i;
    response=assertSuccessPostOperation(instanceUrl,addInstanceTagCmd(_tag1),false);
    Assert.assertTrue(response.contains(_tag1));
  }
  instanceUrl=instancesUrl + "/localhost_1233";
  response=assertSuccessPostOperation(instanceUrl,removeInstanceTagCmd(_tag1),false);
  Assert.assertFalse(response.contains(_tag1));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDeactivateCluster() throws Exception {
  final String clusterName="clusterTestDeactivateCluster";
  final String controllerClusterName="controllerClusterTestDeactivateCluster";
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  Map<String,MockMultiClusterController> multiClusterControllers=new HashMap<String,MockMultiClusterController>();
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",16);
  rebalanceResource(clusterName,"db_11");
  addCluster(controllerClusterName);
  addInstancesToCluster(controllerClusterName,"controller_900",2,null);
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  for (int i=0; i < 2; i++) {
    String controllerName="controller_900" + i;
    MockMultiClusterController multiClusterController=new MockMultiClusterController(_zkaddr,controllerClusterName,controllerName);
    multiClusterController.syncStart();
    multiClusterControllers.put(controllerName,multiClusterController);
  }
  String clusterUrl=getClusterUrl(clusterName);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,true),false);
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,false),false);
  Thread.sleep(6000);
  Assert.assertFalse(_zkclient.exists("/" + controllerClusterName + "/IDEALSTATES/"+ clusterName));
  HelixDataAccessor accessor=participants.get("localhost_1231").getHelixDataAccessor();
  String path=accessor.keyBuilder().controllerLeader().getPath();
  Assert.assertFalse(_zkclient.exists(path));
  deleteUrl(clusterUrl,true);
  Assert.assertTrue(_zkclient.exists("/" + clusterName));
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
  deleteUrl(clusterUrl,false);
  Assert.assertFalse(_zkclient.exists("/" + clusterName));
  for (  MockMultiClusterController controller : multiClusterControllers.values()) {
    controller.syncStop();
  }
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRebalanceResource() throws Exception {
  final String clusterName="clusterTestRebalanceResource";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",3,_tag1);
  addResource(clusterName,"db_11",44);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  String idealStateUrl=resourceUrl + "/idealState";
  String response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  ZNRecord record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  deleteUrl(resourceUrl,false);
  final String reourcesUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  response=getUrl(reourcesUrl);
  Assert.assertFalse(response.contains("db_11"));
  addResource(clusterName,"db_11",48);
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  addResource(clusterName,"db_22",55);
  resourceUrl=getResourceUrl(clusterName,"db_22");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_22"));
  Assert.assertEquals(record.getListField("alias_0").size(),2);
  Assert.assertEquals(record.getMapField("alias_0").size(),2);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  Assert.assertFalse(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  addResource(clusterName,"db_33",44);
  resourceUrl=getResourceUrl(clusterName,"db_33");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,null,_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
  addResource(clusterName,"db_44",44);
  resourceUrl=getResourceUrl(clusterName,"db_44");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testExpandCluster() throws Exception {
  final String clusterName="clusterTestExpandCluster";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",22);
  rebalanceResource(clusterName,"db_11");
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  String clusterUrl=getClusterUrl(clusterName);
  String instancesUrl=clusterUrl + "/instances";
  String instances="localhost:12331;localhost:12341;localhost:12351;localhost:12361";
  String response=assertSuccessPostOperation(instancesUrl,addInstanceCmd(instances),false);
  String[] hosts=instances.split(";");
  for (  String host : hosts) {
    Assert.assertTrue(response.contains(host.replace(':','_')));
  }
  response=assertSuccessPostOperation(clusterUrl,expandClusterCmd(),false);
  for (int i=3; i <= 6; i++) {
    String instanceName="localhost_123" + i + "1";
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testAddResource() throws Exception {
  final String clusterName="clusterTestAddResource";
  addCluster(clusterName);
  String reourcesUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  String response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_22","MasterSlave",144),false);
  Assert.assertTrue(response.contains("db_22"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_11","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_11"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_22","OnlineOffline",55),true);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  deleteUrl(resourceUrl,false);
  Assert.assertFalse(_zkclient.exists("/" + clusterName + "/IDEALSTATES/db_11"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_11","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_11"));
  Assert.assertTrue(_zkclient.exists("/" + clusterName + "/IDEALSTATES/db_11"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_33","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_33"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_44","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_44"));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDropAddResource() throws Exception {
  final String clusterName="clusterTestDropAddResource";
  addCluster(clusterName);
  addResource(clusterName,"db_11",22);
  addInstancesToCluster(clusterName,"localhost_123",6,null);
  rebalanceResource(clusterName,"db_11");
  ZNRecord record=_setupTool.getClusterManagementTool().getResourceIdealState(clusterName,"db_11").getRecord();
  String x=ObjectToJson(record);
  FileWriter fos=new FileWriter("/tmp/temp.log");
  PrintWriter pw=new PrintWriter(fos);
  pw.write(x);
  pw.close();
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  deleteUrl(resourceUrl,false);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  addResource(clusterName,"db_11",22);
  String idealStateUrl=getResourceUrl(clusterName,"db_11") + "/idealState";
  Map<String,String> extraform=new HashMap<String,String>();
  extraform.put(JsonParameters.NEW_IDEAL_STATE,x);
  assertSuccessPostOperation(idealStateUrl,addIdealStateCmd(),extraform,false);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ZNRecord record2=_setupTool.getClusterManagementTool().getResourceIdealState(clusterName,"db_11").getRecord();
  Assert.assertTrue(record2.equals(record));
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
