<h3><span class=" glyphicon glyphicon-tag"/>&nbspEqualityVerifier</h3><kbd>Verifies whether objects/variable are equal to an expected value </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.helix.TestConfigAccessor </h4><pre class="type-4 type-5 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ConfigAccessor configAccessor=new ConfigAccessor(_zkclient);
  HelixConfigScope clusterScope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build();
  String clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue);
  for (int i=0; i < 2; i++) {
    configAccessor.set(clusterScope,"clusterConfigKey" + i,"clusterConfigValue" + i);
    clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey" + i);
    Assert.assertEquals(clusterConfigValue,"clusterConfigValue" + i);
  }
  HelixConfigScope resourceScope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).forResource("testResource").build();
  configAccessor.set(resourceScope,"resourceConfigKey","resourceConfigValue");
  String resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertEquals(resourceConfigValue,"resourceConfigValue");
  HelixConfigScope partitionScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  configAccessor.set(partitionScope,"partitionConfigKey","partitionConfigValue");
  String partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertEquals(partitionConfigValue,"partitionConfigValue");
  HelixConfigScope participantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build();
  configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
  String participantConfigValue=configAccessor.get(participantScope,"participantConfigKey");
  Assert.assertEquals(participantConfigValue,"participantConfigValue");
  HelixConfigScope partialResourceScope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).build();
  List<String> keys=configAccessor.getKeys(partialResourceScope);
  Assert.assertEquals(keys.size(),1,"should be [testResource]");
  Assert.assertEquals(keys.get(0),"testResource");
  keys=configAccessor.getKeys(clusterScope);
  Assert.assertEquals(keys.size(),2,"should be [clusterConfigKey0, clusterConfigKey1]");
  Assert.assertEquals(keys.get(0),"clusterConfigKey0");
  Assert.assertEquals(keys.get(1),"clusterConfigKey1");
  HelixConfigScope partialParticipantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).build();
  keys=configAccessor.getKeys(partialParticipantScope);
  Assert.assertEquals(keys.size(),5,"should be [localhost_12918~22] sorted");
  Assert.assertEquals(keys.get(0),"localhost_12918");
  Assert.assertEquals(keys.get(4),"localhost_12922");
  HelixConfigScope partialPartitionScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").build();
  keys=configAccessor.getKeys(partialPartitionScope);
  Assert.assertEquals(keys.size(),1,"should be [testPartition]");
  Assert.assertEquals(keys.get(0),"testPartition");
  keys=configAccessor.getKeys(resourceScope);
  Assert.assertEquals(keys.size(),1,"should be [resourceConfigKey]");
  Assert.assertEquals(keys.get(0),"resourceConfigKey");
  keys=configAccessor.getKeys(participantScope);
  System.out.println((keys));
  Assert.assertEquals(keys.size(),4,"should be [HELIX_ENABLED, HELIX_HOST, HELIX_PORT, participantConfigKey]");
  Assert.assertEquals(keys.get(3),"participantConfigKey");
  keys=configAccessor.getKeys(partitionScope);
  Assert.assertEquals(keys.size(),1,"should be [partitionConfigKey]");
  Assert.assertEquals(keys.get(0),"partitionConfigKey");
  configAccessor.remove(clusterScope,"clusterConfigKey");
  clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue,"Should be null since it's removed");
  configAccessor.remove(resourceScope,"resourceConfigKey");
  resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertNull(resourceConfigValue,"Should be null since it's removed");
  configAccessor.remove(partitionScope,"partitionConfigKey");
  partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertNull(partitionConfigValue,"Should be null since it's removed");
  configAccessor.remove(participantScope,"participantConfigKey");
  participantConfigValue=configAccessor.get(partitionScope,"participantConfigKey");
  Assert.assertNull(participantConfigValue,"Should be null since it's removed");
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forPartition("testPartition").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster("testCluster").forPartition("testPartition").build();
    Assert.fail("Should fail since resource name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forParticipant("testParticipant").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetNonexistentParticipantConfig() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZKHelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.addCluster(clusterName,true);
  ConfigAccessor configAccessor=new ConfigAccessor(_zkclient);
  HelixConfigScope participantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build();
  try {
    configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
    Assert.fail("Except fail to set participant-config because participant: localhost_12918 is not added to cluster yet");
  }
 catch (  HelixException e) {
  }
  admin.addInstance(clusterName,new InstanceConfig("localhost_12918"));
  try {
    configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
  }
 catch (  Exception e) {
    Assert.fail("Except succeed to set participant-config because participant: localhost_12918 has been added to cluster");
  }
  String participantConfigValue=configAccessor.get(participantScope,"participantConfigKey");
  Assert.assertEquals(participantConfigValue,"participantConfigValue");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestHelixConfigAccessor </h4><pre class="type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ConfigAccessor configAccessor=new ConfigAccessor(_zkclient);
  HelixConfigScope clusterScope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build();
  String clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue);
  configAccessor.set(clusterScope,"clusterConfigKey","clusterConfigValue");
  clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertEquals(clusterConfigValue,"clusterConfigValue");
  HelixConfigScope resourceScope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).forResource("testResource").build();
  configAccessor.set(resourceScope,"resourceConfigKey","resourceConfigValue");
  String resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertEquals(resourceConfigValue,"resourceConfigValue");
  HelixConfigScope partitionScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  configAccessor.set(partitionScope,"partitionConfigKey","partitionConfigValue");
  String partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertEquals(partitionConfigValue,"partitionConfigValue");
  HelixConfigScope participantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build();
  configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
  String participantConfigValue=configAccessor.get(participantScope,"participantConfigKey");
  Assert.assertEquals(participantConfigValue,"participantConfigValue");
  List<String> keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).build());
  Assert.assertEquals(keys.size(),1,"should be [testResource]");
  Assert.assertEquals(keys.get(0),"testResource");
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).build());
  Assert.assertEquals(keys.size(),5,"should be [localhost_12918~22] sorted");
  Assert.assertTrue(keys.contains("localhost_12918"));
  Assert.assertTrue(keys.contains("localhost_12922"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").build());
  Assert.assertEquals(keys.size(),1,"should be [testPartition]");
  Assert.assertEquals(keys.get(0),"testPartition");
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).forResource("testResource").build());
  Assert.assertEquals(keys.size(),1,"should be [resourceConfigKey]");
  Assert.assertTrue(keys.contains("resourceConfigKey"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build());
  Assert.assertEquals(keys.size(),1,"should be [clusterConfigKey]");
  Assert.assertTrue(keys.contains("clusterConfigKey"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build());
  Assert.assertEquals(keys.size(),4,"should be [HELIX_ENABLED, HELIX_PORT, HELIX_HOST, participantConfigKey]");
  Assert.assertTrue(keys.contains("participantConfigKey"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build());
  Assert.assertEquals(keys.size(),1,"should be [partitionConfigKey]");
  Assert.assertEquals(keys.get(0),"partitionConfigKey");
  configAccessor.remove(clusterScope,"clusterConfigKey");
  clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue,"Should be null since it's removed");
  configAccessor.remove(resourceScope,"resourceConfigKey");
  resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertNull(resourceConfigValue,"Should be null since it's removed");
  configAccessor.remove(partitionScope,"partitionConfigKey");
  partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertNull(partitionConfigValue,"Should be null since it's removed");
  configAccessor.remove(participantScope,"participantConfigKey");
  participantConfigValue=configAccessor.get(partitionScope,"participantConfigKey");
  Assert.assertNull(participantConfigValue,"Should be null since it's removed");
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forPartition("testPartition").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forParticipant("testParticipant").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster("testCluster").forPartition("testPartition").build();
    Assert.fail("Should fail since resource name is not set");
  }
 catch (  Exception e) {
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetNonexistentParticipantConfig() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZKHelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.addCluster(clusterName,true);
  ConfigAccessor configAccessor=new ConfigAccessor(_zkclient);
  HelixConfigScope participantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build();
  try {
    configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
    Assert.fail("Except fail to set participant-config because participant: localhost_12918 is not added to cluster yet");
  }
 catch (  HelixException e) {
  }
  admin.addInstance(clusterName,new InstanceConfig("localhost_12918"));
  try {
    configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
  }
 catch (  Exception e) {
    Assert.fail("Except succeed to set participant-config because participant: localhost_12918 has been added to cluster");
  }
  String participantConfigValue=configAccessor.get(participantScope,"participantConfigKey");
  Assert.assertEquals(participantConfigValue,"participantConfigValue");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestPropertyPathConfig </h4><pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetPath(){
  String actual;
  actual=PropertyPathConfig.getPath(PropertyType.IDEALSTATES,"test_cluster");
  AssertJUnit.assertEquals(actual,"/test_cluster/IDEALSTATES");
  actual=PropertyPathConfig.getPath(PropertyType.IDEALSTATES,"test_cluster","resource");
  AssertJUnit.assertEquals(actual,"/test_cluster/IDEALSTATES/resource");
  actual=PropertyPathConfig.getPath(PropertyType.INSTANCES,"test_cluster","instanceName1");
  AssertJUnit.assertEquals(actual,"/test_cluster/INSTANCES/instanceName1");
  actual=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,"test_cluster","instanceName1");
  AssertJUnit.assertEquals(actual,"/test_cluster/INSTANCES/instanceName1/CURRENTSTATES");
  actual=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,"test_cluster","instanceName1","sessionId");
  AssertJUnit.assertEquals(actual,"/test_cluster/INSTANCES/instanceName1/CURRENTSTATES/sessionId");
  actual=PropertyPathConfig.getPath(PropertyType.CONTROLLER,"test_cluster");
  AssertJUnit.assertEquals(actual,"/test_cluster/CONTROLLER");
  actual=PropertyPathConfig.getPath(PropertyType.MESSAGES_CONTROLLER,"test_cluster");
  AssertJUnit.assertEquals(actual,"/test_cluster/CONTROLLER/MESSAGES");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestRoutingTable </h4><pre class="type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSimple(){
  List<InstanceConfig> instances;
  RoutingTableProvider routingTable=new RoutingTableProvider();
  ZNRecord record=new ZNRecord("TESTDB");
  add(record,"TESTDB_0","localhost_8900","MASTER");
  List<ExternalView> externalViewList=new ArrayList<ExternalView>();
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  instances=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
  AssertJUnit.assertNotNull(instances);
  AssertJUnit.assertEquals(instances.size(),1);
  add(record,"TESTDB_0","localhost_8901","MASTER");
  add(record,"TESTDB_1","localhost_8900","SLAVE");
  externalViewList=new ArrayList<ExternalView>();
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  instances=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
  AssertJUnit.assertNotNull(instances);
  AssertJUnit.assertEquals(instances.size(),2);
  instances=routingTable.getInstances("TESTDB","TESTDB_1","SLAVE");
  AssertJUnit.assertNotNull(instances);
  AssertJUnit.assertEquals(instances.size(),1);
  add(record,"TESTDB_0","localhost_8901","SLAVE");
  externalViewList=new ArrayList<ExternalView>();
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  instances=routingTable.getInstances("TESTDB","TESTDB_0","SLAVE");
  AssertJUnit.assertNotNull(instances);
  AssertJUnit.assertEquals(instances.size(),1);
}

</code></pre>

<br>
<pre class="type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testStateUnitGroupDeletion(){
  List<InstanceConfig> instances;
  RoutingTableProvider routingTable=new RoutingTableProvider();
  List<ExternalView> externalViewList=new ArrayList<ExternalView>();
  ZNRecord record=new ZNRecord("TESTDB");
  add(record,"TESTDB_0","localhost_8900","MASTER");
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  instances=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
  AssertJUnit.assertNotNull(instances);
  AssertJUnit.assertEquals(instances.size(),1);
  externalViewList.clear();
  routingTable.onExternalViewChange(externalViewList,changeContext);
  instances=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
  AssertJUnit.assertNotNull(instances);
  AssertJUnit.assertEquals(instances.size(),0);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testMultiThread() throws Exception {
  final RoutingTableProvider routingTable=new RoutingTableProvider();
  List<ExternalView> externalViewList=new ArrayList<ExternalView>();
  ZNRecord record=new ZNRecord("TESTDB");
  for (int i=0; i < 1000; i++) {
    add(record,"TESTDB_" + i,"localhost_8900","MASTER");
  }
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  Callable<Boolean> runnable=new Callable<Boolean>(){
    @Override public Boolean call() throws Exception {
      try {
        int count=0;
        while (count < 100) {
          List<InstanceConfig> instancesList=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
          AssertJUnit.assertEquals(instancesList.size(),1);
          Thread.sleep(5);
          count++;
        }
      }
 catch (      InterruptedException e) {
      }
      return true;
    }
  }
;
  ScheduledExecutorService executor=Executors.newSingleThreadScheduledExecutor();
  Future<Boolean> submit=executor.submit(runnable);
  int count=0;
  while (count < 10) {
    try {
      Thread.sleep(10);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    routingTable.onExternalViewChange(externalViewList,changeContext);
    count++;
  }
  Boolean result=submit.get(60,TimeUnit.SECONDS);
  AssertJUnit.assertEquals(result,Boolean.TRUE);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testGetInstanceForAllStateUnits(){
  List<InstanceConfig> instancesList;
  Set<InstanceConfig> instancesSet;
  InstanceConfig instancesArray[];
  RoutingTableProvider routingTable=new RoutingTableProvider();
  List<ExternalView> externalViewList=new ArrayList<ExternalView>();
  ZNRecord record=new ZNRecord("TESTDB");
  add(record,"TESTDB_0","localhost_8900","MASTER");
  add(record,"TESTDB_1","localhost_8900","MASTER");
  add(record,"TESTDB_2","localhost_8900","MASTER");
  add(record,"TESTDB_3","localhost_8900","SLAVE");
  add(record,"TESTDB_4","localhost_8900","SLAVE");
  add(record,"TESTDB_5","localhost_8900","SLAVE");
  add(record,"TESTDB_0","localhost_8901","SLAVE");
  add(record,"TESTDB_1","localhost_8901","SLAVE");
  add(record,"TESTDB_2","localhost_8901","SLAVE");
  add(record,"TESTDB_3","localhost_8901","MASTER");
  add(record,"TESTDB_4","localhost_8901","MASTER");
  add(record,"TESTDB_5","localhost_8901","MASTER");
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  instancesList=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
  AssertJUnit.assertNotNull(instancesList);
  AssertJUnit.assertEquals(instancesList.size(),1);
  instancesSet=routingTable.getInstances("TESTDB","MASTER");
  AssertJUnit.assertNotNull(instancesSet);
  AssertJUnit.assertEquals(instancesSet.size(),2);
  instancesSet=routingTable.getInstances("TESTDB","SLAVE");
  AssertJUnit.assertNotNull(instancesSet);
  AssertJUnit.assertEquals(instancesSet.size(),2);
  instancesArray=new InstanceConfig[instancesSet.size()];
  instancesSet.toArray(instancesArray);
  AssertJUnit.assertEquals(instancesArray[0].getHostName(),"localhost");
  AssertJUnit.assertEquals(instancesArray[0].getPort(),"8900");
  AssertJUnit.assertEquals(instancesArray[1].getHostName(),"localhost");
  AssertJUnit.assertEquals(instancesArray[1].getPort(),"8901");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZNRecord </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMerge(){
  ZNRecord record=new ZNRecord("record1");
  record.setSimpleField("simpleKey1","simpleValue1");
  List<String> list1=new ArrayList<String>();
  list1.add("list1Value1");
  list1.add("list1Value2");
  record.setListField("listKey1",list1);
  Map<String,String> map1=new HashMap<String,String>();
  map1.put("map1Key1","map1Value1");
  record.setMapField("mapKey1",map1);
  ZNRecord updateRecord=new ZNRecord("updateRecord");
  updateRecord.setSimpleField("simpleKey2","simpleValue2");
  List<String> newList1=new ArrayList<String>();
  newList1.add("list1Value1");
  newList1.add("list1Value2");
  newList1.add("list1NewValue1");
  newList1.add("list1NewValue2");
  updateRecord.setListField("listKey1",newList1);
  List<String> list2=new ArrayList<String>();
  list2.add("list2Value1");
  list2.add("list2Value2");
  updateRecord.setListField("listKey2",list2);
  Map<String,String> newMap1=new HashMap<String,String>();
  newMap1.put("map1NewKey1","map1NewValue1");
  updateRecord.setMapField("mapKey1",newMap1);
  Map<String,String> map2=new HashMap<String,String>();
  map2.put("map2Key1","map2Value1");
  updateRecord.setMapField("mapKey2",map2);
  record.merge(updateRecord);
  ZNRecord expectRecord=new ZNRecord("record1");
  expectRecord.setSimpleField("simpleKey1","simpleValue1");
  expectRecord.setSimpleField("simpleKey2","simpleValue2");
  List<String> expectList1=new ArrayList<String>();
  expectList1.add("list1Value1");
  expectList1.add("list1Value2");
  expectList1.add("list1Value1");
  expectList1.add("list1Value2");
  expectList1.add("list1NewValue1");
  expectList1.add("list1NewValue2");
  expectRecord.setListField("listKey1",expectList1);
  List<String> expectList2=new ArrayList<String>();
  expectList2.add("list2Value1");
  expectList2.add("list2Value2");
  expectRecord.setListField("listKey2",expectList2);
  Map<String,String> expectMap1=new HashMap<String,String>();
  expectMap1.put("map1Key1","map1Value1");
  expectMap1.put("map1NewKey1","map1NewValue1");
  expectRecord.setMapField("mapKey1",expectMap1);
  Map<String,String> expectMap2=new HashMap<String,String>();
  expectMap2.put("map2Key1","map2Value1");
  expectRecord.setMapField("mapKey2",expectMap2);
  Assert.assertEquals(record,expectRecord,"Should be equal.");
}

</code></pre>

<br>
<pre class="type-1 type-11 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEquals(){
  ZNRecord record1=new ZNRecord("id");
  record1.setSimpleField("k1","v1");
  record1.setMapField("m1",new HashMap<String,String>());
  record1.getMapField("m1").put("k1","v1");
  record1.setListField("l1",new ArrayList<String>());
  record1.getListField("l1").add("v1");
  ZNRecord record2=new ZNRecord("id");
  record2.setSimpleField("k1","v1");
  record2.setMapField("m1",new HashMap<String,String>());
  record2.getMapField("m1").put("k1","v1");
  record2.setListField("l1",new ArrayList<String>());
  record2.getListField("l1").add("v1");
  AssertJUnit.assertEquals(record1,record2);
  record2.setSimpleField("k2","v1");
  AssertJUnit.assertNotSame(record1,record2);
}

</code></pre>

<br>
<pre class="type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSubtract(){
  ZNRecord record=new ZNRecord("test");
  Map<String,String> map=new HashMap<String,String>();
  map.put("mapKey1","mapValue1");
  map.put("mapKey2","mapValue2");
  record.setMapField("key1",map);
  ZNRecord delta=new ZNRecord("test");
  Map<String,String> deltaMap=new HashMap<String,String>();
  deltaMap.put("mapKey1","mapValue1");
  delta.setMapField("key1",deltaMap);
  record.subtract(delta);
  Assert.assertEquals(record.getMapFields().size(),1);
  Assert.assertNotNull(record.getMapField("key1"));
  Assert.assertEquals(record.getMapField("key1").size(),1);
  Assert.assertNotNull(record.getMapField("key1").get("mapKey2"));
  Assert.assertEquals(record.getMapField("key1").get("mapKey2"),"mapValue2");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZNRecordBucketizer </h4><pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testZNRecordBucketizer(){
  final int bucketSize=3;
  ZNRecordBucketizer bucketizer=new ZNRecordBucketizer(bucketSize);
  String[] partitionNames={"TestDB_0","TestDB_1","TestDB_2","TestDB_3","TestDB_4"};
  for (int i=0; i < partitionNames.length; i++) {
    String partitionName=partitionNames[i];
    String bucketName=bucketizer.getBucketName(partitionName);
    int startBucketNb=i / bucketSize * bucketSize;
    int endBucketNb=startBucketNb + bucketSize - 1;
    String expectBucketName="TestDB_p" + startBucketNb + "-p"+ endBucketNb;
    System.out.println("Expect: " + expectBucketName + ", actual: "+ bucketName);
    Assert.assertEquals(expectBucketName,bucketName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZkBasis </h4><pre class="type-8 type-2 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test zk watchers are renewed automatically after session expiry
 * zookeeper-client side keeps all registered watchers see ZooKeeper.WatchRegistration.register()
 * after session expiry, all watchers are renewed
 * if a path that has watches on it has been removed during session expiry,
 * the watchers on that path will still get callbacks after session renewal, especially:
 * a data-watch will get data-deleted callback
 * a child-watch will get a child-change callback with current-child-list = null
 * this can be used for cleanup watchers on the zookeeper-client side
 */
@Test public void testWatchRenew() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  final ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  final String path="/" + testName + "/test";
  client.delete(path);
  ZkListener listener=new ZkListener();
  client.subscribeDataChanges(path,listener);
  client.subscribeChildChanges(path,listener);
  ZkTestHelper.expireSession(client);
  boolean succeed=listener._childChangeCountDown.await(10,TimeUnit.SECONDS);
  Assert.assertTrue(succeed,"fail to wait on child-change count-down in 10 seconds after session-expiry");
  Assert.assertEquals(listener._parentPath,path,"fail to get child-change callback after session-expiry");
  Assert.assertNull(listener._currentChilds,"fail to get child-change callback with currentChilds=null after session expiry");
  succeed=listener._dataDeleteCountDown.await(10,TimeUnit.SECONDS);
  Assert.assertTrue(succeed,"fail to wait on data-delete count-down in 10 seconds after session-expiry");
  Assert.assertEquals(listener._dataDeletePath,path,"fail to get data-delete callback after session-expiry");
  client.close();
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * after calling zkclient#unsubscribeXXXListener()
 * an already registered watch will not be removed from ZooKeeper#watchManager#XXXWatches
 * immediately.
 * the watch will get removed on the following conditions:
 * 1) there is a set/delete on the listening path via the zkclient
 * 2) session expiry on the zkclient (i.e. the watch will not be renewed after session expiry)
 * @throws Exception
 */
@Test public void testWatchRemove() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  final ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  final String path="/" + testName + "/test";
  client.createPersistent(path,true);
  ZkListener listener=new ZkListener();
  client.subscribeDataChanges(path,listener);
  client.subscribeChildChanges(path,listener);
  Map<String,Set<IZkDataListener>> dataListenerMap=ZkTestHelper.getZkDataListener(client);
  Assert.assertEquals(dataListenerMap.size(),1,"ZkClient#_dataListener should have 1 listener");
  Set<IZkDataListener> dataListenerSet=dataListenerMap.get(path);
  Assert.assertNotNull(dataListenerSet,"ZkClient#_dataListener should have 1 listener on path: " + path);
  Assert.assertEquals(dataListenerSet.size(),1,"ZkClient#_dataListener should have 1 listener on path: " + path);
  Map<String,Set<IZkChildListener>> childListenerMap=ZkTestHelper.getZkChildListener(client);
  Assert.assertEquals(childListenerMap.size(),1,"ZkClient#_childListener should have 1 listener");
  Set<IZkChildListener> childListenerSet=childListenerMap.get(path);
  Assert.assertNotNull(childListenerSet,"ZkClient#_childListener should have 1 listener on path: " + path);
  Assert.assertEquals(childListenerSet.size(),1,"ZkClient#_childListener should have 1 listener on path: " + path);
  Map<String,List<String>> watchMap=ZkTestHelper.getZkWatch(client);
  List<String> dataWatch=watchMap.get("dataWatches");
  Assert.assertNotNull(dataWatch,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  Assert.assertEquals(dataWatch.size(),1,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  Assert.assertEquals(dataWatch.get(0),path,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  List<String> childWatch=watchMap.get("childWatches");
  Assert.assertNotNull(childWatch,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  Assert.assertEquals(childWatch.size(),1,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  Assert.assertEquals(childWatch.get(0),path,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  client.unsubscribeDataChanges(path,listener);
  client.unsubscribeChildChanges(path,listener);
  ZkTestHelper.expireSession(client);
  watchMap=ZkTestHelper.getZkWatch(client);
  dataWatch=watchMap.get("dataWatches");
  Assert.assertTrue(dataWatch.isEmpty(),"ZooKeeper#watchManager#dataWatches should be empty");
  childWatch=watchMap.get("childWatches");
  Assert.assertTrue(childWatch.isEmpty(),"ZooKeeper#watchManager#childWatches should be empty");
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZkClientWrapper </h4><pre class="type-1 type-11 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() void testGetStat(){
  String path="/tmp/getStatTest";
  _zkClient.deleteRecursive(path);
  Stat stat, newStat;
  stat=_zkClient.getStat(path);
  AssertJUnit.assertNull(stat);
  _zkClient.createPersistent(path,true);
  stat=_zkClient.getStat(path);
  AssertJUnit.assertNotNull(stat);
  newStat=_zkClient.getStat(path);
  AssertJUnit.assertEquals(stat,newStat);
  _zkClient.writeData(path,new ZNRecord("Test"));
  newStat=_zkClient.getStat(path);
  AssertJUnit.assertNotSame(stat,newStat);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.TestId </h4><pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check that ids can be converted back and forth between strings and concrete classes
 */
@Test public void basicIdTest(){
  final String resourceName="Resource";
  final String clusterName="Cluster";
  final String participantName="Participant";
  final String sessionName="Session";
  final String processName="Process";
  final String stateModelName="StateModel";
  final String stateModelFactoryName="StateModelFactory";
  final String messageName="Message";
  Assert.assertEquals(ResourceId.from(resourceName).stringify(),resourceName);
  Assert.assertEquals(ClusterId.from(clusterName).stringify(),clusterName);
  Assert.assertEquals(ParticipantId.from(participantName).stringify(),participantName);
  Assert.assertEquals(SessionId.from(sessionName).stringify(),sessionName);
  Assert.assertEquals(ProcId.from(processName).stringify(),processName);
  Assert.assertEquals(StateModelDefId.from(stateModelName).stringify(),stateModelName);
  Assert.assertEquals(StateModelFactoryId.from(stateModelFactoryName).stringify(),stateModelFactoryName);
  Assert.assertEquals(MessageId.from(messageName).stringify(),messageName);
}

</code></pre>

<br>
<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check that PartitionId doesn't need to be of the form resource_partition for compatibility
 */
@Test public void testPartitionIdCompatibility(){
  final String partitionName="Resource--3";
  PartitionId partitionId=PartitionId.from(partitionName);
  Assert.assertEquals(partitionId.stringify(),partitionName);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Make sure that a partition serializes and deserializes properly
 */
@Test public void testPartitionId(){
  final String partitionName="Resource_3";
  final String resourceName="Resource";
  final String partitionSuffix="3";
  PartitionId partitionId=PartitionId.from(partitionName);
  Assert.assertEquals(partitionId.stringify(),partitionName);
  PartitionId partitionId2=PartitionId.from(ResourceId.from(resourceName),partitionSuffix);
  Assert.assertEquals(partitionId2.stringify(),partitionName);
  Assert.assertEquals(partitionId,partitionId2);
  Assert.assertEquals(partitionId.toString(),partitionId2.toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.TestNamespacedConfig </h4><pre class="type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResourceUserConfigCompatibility(){
  final String KEY1="key1";
  final String VALUE1="value1";
  final String KEY2="key2";
  final String VALUE2="value2";
  final String KEY3="key3";
  final String VALUE3="value3";
  ResourceId resourceId=ResourceId.from("resourceId");
  UserConfig userConfig=new UserConfig(Scope.resource(resourceId));
  userConfig.setSimpleField(KEY1,VALUE1);
  ResourceConfiguration resourceConfig=new ResourceConfiguration(resourceId);
  resourceConfig.addNamespacedConfig(userConfig);
  resourceConfig.getRecord().setSimpleField(KEY2,VALUE2);
  IdealState idealState=new IdealState(resourceId);
  idealState.setRebalanceMode(RebalanceMode.USER_DEFINED);
  idealState.getRecord().setSimpleField(KEY3,VALUE3);
  UserConfig result=resourceConfig.getUserConfig();
  idealState.updateUserConfig(result);
  Assert.assertEquals(result.getSimpleField(KEY1),VALUE1);
  Assert.assertEquals(result.getSimpleField(KEY2),VALUE2);
  Assert.assertEquals(result.getSimpleField(KEY3),VALUE3);
  Assert.assertNull(result.getSimpleField(IdealState.IdealStateProperty.REBALANCE_MODE.toString()));
}

</code></pre>

<br>
<pre class="type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParticipantUserConfigCompatibility(){
  final String KEY1="key1";
  final String VALUE1="value1";
  final String KEY2="key2";
  final String VALUE2="value2";
  ParticipantId participantId=ParticipantId.from("participantId");
  UserConfig userConfig=new UserConfig(Scope.participant(participantId));
  userConfig.setSimpleField(KEY1,VALUE1);
  InstanceConfig instanceConfig=new InstanceConfig(participantId);
  instanceConfig.setHostName("localhost");
  instanceConfig.addNamespacedConfig(userConfig);
  instanceConfig.getRecord().setSimpleField(KEY2,VALUE2);
  UserConfig result=instanceConfig.getUserConfig();
  Assert.assertEquals(result.getSimpleField(KEY1),VALUE1);
  Assert.assertEquals(result.getSimpleField(KEY2),VALUE2);
  Assert.assertNull(result.getSimpleField(InstanceConfig.InstanceConfigProperty.HELIX_HOST.toString()));
}

</code></pre>

<br>
<pre class="type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClusterUserConfigCompatibility(){
  final String KEY1="key1";
  final String VALUE1="value1";
  final String KEY2="key2";
  final String VALUE2="value2";
  ClusterId clusterId=ClusterId.from("clusterId");
  UserConfig userConfig=new UserConfig(Scope.cluster(clusterId));
  userConfig.setSimpleField(KEY1,VALUE1);
  ClusterConfiguration clusterConfiguration=new ClusterConfiguration(clusterId);
  clusterConfiguration.addNamespacedConfig(userConfig);
  clusterConfiguration.getRecord().setSimpleField(KEY2,VALUE2);
  clusterConfiguration.setAutoJoinAllowed(true);
  UserConfig result=clusterConfiguration.getUserConfig();
  Assert.assertEquals(result.getSimpleField(KEY1),VALUE1);
  Assert.assertEquals(result.getSimpleField(KEY2),VALUE2);
  Assert.assertNull(result.getSimpleField(ZKHelixManager.ALLOW_PARTICIPANT_AUTO_JOIN));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure that user configs are separated from helix configs in properties that hold both
 */
@Test public void testUserConfigUpdates(){
  final String testKey="testKey";
  final String prefixedKey=UserConfig.class.getSimpleName() + "!testKey";
  final String testSimpleValue="testValue";
  final List<String> testListValue=ImmutableList.of("testValue");
  final Map<String,String> testMapValue=ImmutableMap.of("testInnerKey","testValue");
  ParticipantId participantId=ParticipantId.from("testParticipant");
  InstanceConfig instanceConfig=new InstanceConfig(participantId);
  instanceConfig.setHostName("localhost");
  UserConfig userConfig=new UserConfig(Scope.participant(participantId));
  userConfig.setSimpleField(testKey,testSimpleValue);
  userConfig.setListField(testKey,testListValue);
  userConfig.setMapField(testKey,testMapValue);
  instanceConfig.addNamespacedConfig(userConfig);
  UserConfig retrievedConfig=UserConfig.from(instanceConfig);
  Assert.assertTrue(instanceConfig.getHostName().equals("localhost"));
  Assert.assertEquals(retrievedConfig.getStringField(InstanceConfigProperty.HELIX_HOST.toString(),"not localhost"),"not localhost");
  Assert.assertEquals(userConfig.getSimpleField(testKey),testSimpleValue);
  Assert.assertEquals(userConfig.getListField(testKey),testListValue);
  Assert.assertEquals(userConfig.getMapField(testKey),testMapValue);
  Assert.assertEquals(retrievedConfig.getSimpleField(testKey),testSimpleValue);
  Assert.assertEquals(retrievedConfig.getListField(testKey),testListValue);
  Assert.assertEquals(retrievedConfig.getMapField(testKey),testMapValue);
  Assert.assertEquals(instanceConfig.getRecord().getSimpleField(prefixedKey),testSimpleValue);
  Assert.assertEquals(instanceConfig.getRecord().getListField(prefixedKey),testListValue);
  Assert.assertEquals(instanceConfig.getRecord().getMapField(prefixedKey),testMapValue);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.accessor.TestAccessorRecreate </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test just makes sure that a participant is only recreated if it is incomplete. This is not
 * directly testing atomicity, but rather a use case where a machine died while creating the
 * participant.
 */
@Test public void testRecreateParticipant(){
  final String MODIFIER="modifier";
  final ClusterId clusterId=ClusterId.from("testCluster");
  final ParticipantId participantId=ParticipantId.from("testParticipant");
  boolean connected=_zkclient.waitUntilConnected(30000,TimeUnit.MILLISECONDS);
  if (!connected) {
    LOG.warn("Connection not established");
    return;
  }
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor helixAccessor=new ZKHelixDataAccessor(clusterId.stringify(),baseAccessor);
  ClusterAccessor accessor=new ClusterAccessor(clusterId,helixAccessor);
  boolean clusterCreated=createCluster(clusterId,accessor,MODIFIER,0);
  Assert.assertTrue(clusterCreated);
  boolean created=createParticipant(participantId,accessor,MODIFIER,1);
  Assert.assertTrue(created);
  Participant participantSnapshot=accessor.readParticipant(participantId);
  Assert.assertEquals(participantSnapshot.getUserConfig().getIntField(MODIFIER,-1),1);
  boolean created2=createParticipant(participantId,accessor,MODIFIER,2);
  Assert.assertFalse(created2);
  helixAccessor.removeProperty(helixAccessor.keyBuilder().messages(participantId.stringify()));
  created2=createParticipant(participantId,accessor,MODIFIER,2);
  Assert.assertTrue(created2);
  participantSnapshot=accessor.readParticipant(participantId);
  Assert.assertEquals(participantSnapshot.getUserConfig().getIntField(MODIFIER,-1),2);
  accessor.dropCluster();
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test just makes sure that a cluster is only recreated if it is incomplete. This is not
 * directly testing atomicity, but rather a use case where a machine died while creating the
 * cluster.
 */
@Test public void testRecreateCluster(){
  final String MODIFIER="modifier";
  final ClusterId clusterId=ClusterId.from("TestAccessorRecreate!testCluster");
  boolean connected=_zkclient.waitUntilConnected(30000,TimeUnit.MILLISECONDS);
  if (!connected) {
    LOG.warn("Connection not established");
    return;
  }
  HelixDataAccessor helixAccessor=new ZKHelixDataAccessor(clusterId.stringify(),_baseAccessor);
  ClusterAccessor accessor=new ClusterAccessor(clusterId,helixAccessor);
  boolean created=createCluster(clusterId,accessor,MODIFIER,1);
  Assert.assertTrue(created);
  Cluster clusterSnapshot=accessor.readCluster();
  Assert.assertEquals(clusterSnapshot.getUserConfig().getIntField(MODIFIER,-1),1);
  boolean created2=createCluster(clusterId,accessor,MODIFIER,2);
  Assert.assertFalse(created2);
  helixAccessor.removeProperty(helixAccessor.keyBuilder().liveInstances());
  created2=createCluster(clusterId,accessor,MODIFIER,2);
  Assert.assertTrue(created2);
  clusterSnapshot=accessor.readCluster();
  Assert.assertEquals(clusterSnapshot.getUserConfig().getIntField(MODIFIER,-1),2);
  accessor.dropCluster();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestBestPossibleCalcStageCompatibility </h4><pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCustomModeCompatibility(){
  System.out.println("START TestBestPossibleStateCalcStageCompatibility_testCustomModeCompatibility at " + new Date(System.currentTimeMillis()));
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealStateDeprecated(5,resources,10,1,IdealStateModeProperty.CUSTOMIZED);
  setupLiveInstances(5);
  setupStateModel();
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  ResourceCurrentState currentStateOutput=new ResourceCurrentState();
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  event.addAttribute(AttributeName.CURRENT_STATE.toString(),currentStateOutput);
  ReadClusterDataStage stage1=new ReadClusterDataStage();
  runStage(event,stage1);
  BestPossibleStateCalcStage stage2=new BestPossibleStateCalcStage();
  runStage(event,stage2);
  BestPossibleStateOutput output=event.getAttribute(AttributeName.BEST_POSSIBLE_STATE.toString());
  for (int p=0; p < 5; p++) {
    Map<ParticipantId,State> replicaMap=output.getResourceAssignment(ResourceId.from("testResourceName")).getReplicaMap(PartitionId.from("testResourceName_" + p));
    AssertJUnit.assertEquals(State.from("MASTER"),replicaMap.get(ParticipantId.from("localhost_" + (p + 1) % 5)));
  }
  System.out.println("END TestBestPossibleStateCalcStageCompatibility_testCustomModeCompatibility at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSemiAutoModeCompatibility(){
  System.out.println("START TestBestPossibleStateCalcStageCompatibility_testSemiAutoModeCompatibility at " + new Date(System.currentTimeMillis()));
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealStateDeprecated(5,resources,10,1,IdealStateModeProperty.AUTO);
  setupLiveInstances(5);
  setupStateModel();
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  ResourceCurrentState currentStateOutput=new ResourceCurrentState();
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  event.addAttribute(AttributeName.CURRENT_STATE.toString(),currentStateOutput);
  ReadClusterDataStage stage1=new ReadClusterDataStage();
  runStage(event,stage1);
  BestPossibleStateCalcStage stage2=new BestPossibleStateCalcStage();
  runStage(event,stage2);
  BestPossibleStateOutput output=event.getAttribute(AttributeName.BEST_POSSIBLE_STATE.toString());
  for (int p=0; p < 5; p++) {
    Map<ParticipantId,State> replicaMap=output.getResourceAssignment(ResourceId.from("testResourceName")).getReplicaMap(PartitionId.from("testResourceName_" + p));
    AssertJUnit.assertEquals(State.from("MASTER"),replicaMap.get(ParticipantId.from("localhost_" + (p + 1) % 5)));
  }
  System.out.println("END TestBestPossibleStateCalcStageCompatibility_testSemiAutoModeCompatibility at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestBestPossibleStateCalcStage </h4><pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSimple(){
  System.out.println("START TestBestPossibleStateCalcStage at " + new Date(System.currentTimeMillis()));
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  setupLiveInstances(5);
  setupStateModel();
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  ResourceCurrentState currentStateOutput=new ResourceCurrentState();
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  event.addAttribute(AttributeName.CURRENT_STATE.toString(),currentStateOutput);
  ReadClusterDataStage stage1=new ReadClusterDataStage();
  runStage(event,stage1);
  BestPossibleStateCalcStage stage2=new BestPossibleStateCalcStage();
  runStage(event,stage2);
  BestPossibleStateOutput output=event.getAttribute(AttributeName.BEST_POSSIBLE_STATE.toString());
  for (int p=0; p < 5; p++) {
    Map<ParticipantId,State> replicaMap=output.getResourceAssignment(ResourceId.from("testResourceName")).getReplicaMap(PartitionId.from("testResourceName_" + p));
    AssertJUnit.assertEquals(State.from("MASTER"),replicaMap.get(ParticipantId.from("localhost_" + (p + 1) % 5)));
  }
  System.out.println("END TestBestPossibleStateCalcStage at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestClusterEvent </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSimplePutandGet(){
  ClusterEvent event=new ClusterEvent("name");
  AssertJUnit.assertEquals(event.getName(),"name");
  event.addAttribute("attr1","value");
  AssertJUnit.assertEquals(event.getAttribute("attr1"),"value");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestClusterEventBlockingQueue </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEventQueue() throws Exception {
  ClusterEventBlockingQueue queue=new ClusterEventBlockingQueue();
  ClusterEvent event1=new ClusterEvent("event1");
  queue.put(event1);
  Assert.assertEquals(queue.size(),1);
  ClusterEvent event2=new ClusterEvent("event2");
  queue.put(event2);
  Assert.assertEquals(queue.size(),2);
  ClusterEvent newEvent1=new ClusterEvent("event1");
  newEvent1.addAttribute("attr",1);
  queue.put(newEvent1);
  Assert.assertEquals(queue.size(),2);
  ClusterEvent peeked=queue.peek();
  Assert.assertEquals(peeked.getName(),"event1");
  Assert.assertEquals(peeked.getAttribute("attr"),1);
  Assert.assertEquals(queue.size(),2);
  ListeningExecutorService service=MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());
  ClusterEvent takenEvent1=safeTake(queue,service);
  Assert.assertEquals(takenEvent1.getName(),"event1");
  Assert.assertEquals(takenEvent1.getAttribute("attr"),1);
  Assert.assertEquals(queue.size(),1);
  ClusterEvent takenEvent2=safeTake(queue,service);
  Assert.assertEquals(takenEvent2.getName(),"event2");
  Assert.assertEquals(queue.size(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestCurrentStateComputationStage </h4><pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEmptyCS(){
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  CurrentStateComputationStage stage=new CurrentStateComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  ResourceCurrentState output=event.getAttribute(AttributeName.CURRENT_STATE.toString());
  AssertJUnit.assertEquals(output.getCurrentStateMap(ResourceId.from("testResourceName"),PartitionId.from("testResourceName_0")).size(),0);
}

</code></pre>

<br>
<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSimpleCS(){
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  setupLiveInstances(5);
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  CurrentStateComputationStage stage=new CurrentStateComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  ResourceCurrentState output1=event.getAttribute(AttributeName.CURRENT_STATE.toString());
  AssertJUnit.assertEquals(output1.getCurrentStateMap(ResourceId.from("testResourceName"),PartitionId.from("testResourceName_0")).size(),0);
  Message message=new Message(Message.MessageType.STATE_TRANSITION,MessageId.from("msg1"));
  message.setFromState(State.from("OFFLINE"));
  message.setToState(State.from("SLAVE"));
  message.setResourceId(ResourceId.from("testResourceName"));
  message.setPartitionId(PartitionId.from("testResourceName_1"));
  message.setTgtName("localhost_3");
  message.setTgtSessionId(SessionId.from("session_3"));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.message("localhost_" + 3,message.getId()),message);
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  ResourceCurrentState output2=event.getAttribute(AttributeName.CURRENT_STATE.toString());
  State pendingState=output2.getPendingState(ResourceId.from("testResourceName"),PartitionId.from("testResourceName_1"),ParticipantId.from("localhost_3"));
  AssertJUnit.assertEquals(pendingState,State.from("SLAVE"));
  ZNRecord record1=new ZNRecord("testResourceName");
  CurrentState stateWithLiveSession=new CurrentState(record1);
  stateWithLiveSession.setSessionId(SessionId.from("session_3"));
  stateWithLiveSession.setStateModelDefRef("MasterSlave");
  stateWithLiveSession.setState(PartitionId.from("testResourceName_1"),State.from("OFFLINE"));
  ZNRecord record2=new ZNRecord("testResourceName");
  CurrentState stateWithDeadSession=new CurrentState(record2);
  stateWithDeadSession.setSessionId(SessionId.from("session_dead"));
  stateWithDeadSession.setStateModelDefRef("MasterSlave");
  stateWithDeadSession.setState(PartitionId.from("testResourceName_1"),State.from("MASTER"));
  accessor.setProperty(keyBuilder.currentState("localhost_3","session_3","testResourceName"),stateWithLiveSession);
  accessor.setProperty(keyBuilder.currentState("localhost_3","session_dead","testResourceName"),stateWithDeadSession);
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  ResourceCurrentState output3=event.getAttribute(AttributeName.CURRENT_STATE.toString());
  State currentState=output3.getCurrentState(ResourceId.from("testResourceName"),PartitionId.from("testResourceName_1"),ParticipantId.from("localhost_3"));
  AssertJUnit.assertEquals(currentState,State.from("OFFLINE"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestMessageThrottleStage </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testMsgThrottleConstraints() throws Exception {
  String clusterName="CLUSTER_" + _className + "_constraints";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  List<IdealState> idealStates=HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},new String[]{"TestDB"},1,2);
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  ZNRecord record=new ZNRecord(ConstraintType.MESSAGE_CONSTRAINT.toString());
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","ANY");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","50");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint2").put("INSTANCE",".*");
  record.getMapField("constraint2").put("RESOURCE","TestDB");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint3").put("INSTANCE","localhost_1");
  record.getMapField("constraint3").put("RESOURCE",".*");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint3"));
  record.setMapField("constraint4",new TreeMap<String,String>());
  record.getMapField("constraint4").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint4").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint4").put("INSTANCE",".*");
  record.getMapField("constraint4").put("RESOURCE",".*");
  record.getMapField("constraint4").put("CONSTRAINT_VALUE","10");
  ConstraintItem constraint4=new ConstraintItem(record.getMapField("constraint4"));
  record.setMapField("constraint5",new TreeMap<String,String>());
  record.getMapField("constraint5").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint5").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint5").put("INSTANCE","localhost_0");
  record.getMapField("constraint5").put("RESOURCE","TestDB");
  record.getMapField("constraint5").put("CONSTRAINT_VALUE","3");
  ConstraintItem constraint5=new ConstraintItem(record.getMapField("constraint5"));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  ClusterConstraints constraint=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  MessageThrottleStage throttleStage=new MessageThrottleStage();
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Map<ConstraintAttribute,String> msgAttr=ClusterConstraints.toConstraintAttributes(msg1);
  Set<ConstraintItem> matches=constraint.match(msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(containsConstraint(matches,constraint0));
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint2));
  Assert.assertTrue(containsConstraint(matches,constraint4));
  Assert.assertTrue(containsConstraint(matches,constraint5));
  matches=throttleStage.selectConstraints(matches,msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint5));
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_1");
  msgAttr=ClusterConstraints.toConstraintAttributes(msg2);
  matches=constraint.match(msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(containsConstraint(matches,constraint0));
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint2));
  Assert.assertTrue(containsConstraint(matches,constraint3));
  Assert.assertTrue(containsConstraint(matches,constraint4));
  matches=throttleStage.selectConstraints(matches,msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint3));
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  BestPossibleStateOutput bestPossOutput=getEmptyBestPossibleStateOutput(idealStates);
  event.addAttribute(AttributeName.BEST_POSSIBLE_STATE.toString(),bestPossOutput);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runStage(event,new ResourceComputationStage());
  MessageOutput msgSelectOutput=new MessageOutput();
  Message msg3=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-003"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg4=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-004"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg5=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-005"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg6=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-006"),"OFFLINE","SLAVE","TestDB","localhost_1");
  List<Message> selectMessages=new ArrayList<Message>();
  selectMessages.add(msg1);
  selectMessages.add(msg2);
  selectMessages.add(msg3);
  selectMessages.add(msg4);
  selectMessages.add(msg5);
  selectMessages.add(msg6);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"),selectMessages);
  event.addAttribute(AttributeName.MESSAGES_SELECTED.toString(),msgSelectOutput);
  HelixTestUtil.runStage(event,throttleStage);
  MessageOutput msgThrottleOutput=event.getAttribute(AttributeName.MESSAGES_THROTTLE.toString());
  List<Message> throttleMessages=msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"));
  Assert.assertEquals(throttleMessages.size(),4);
  Assert.assertTrue(throttleMessages.contains(msg1));
  Assert.assertTrue(throttleMessages.contains(msg2));
  Assert.assertTrue(throttleMessages.contains(msg3));
  Assert.assertTrue(throttleMessages.contains(msg4));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMsgThrottleBasic() throws Exception {
  String clusterName="CLUSTER_" + _className + "_basic";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  List<IdealState> idealStates=HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},new String[]{"TestDB"},1,2);
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  BestPossibleStateOutput bestPossOutput=getEmptyBestPossibleStateOutput(idealStates);
  event.addAttribute(AttributeName.BEST_POSSIBLE_STATE.toString(),bestPossOutput);
  MessageThrottleStage throttleStage=new MessageThrottleStage();
  try {
    HelixTestUtil.runStage(event,throttleStage);
    Assert.fail("Should throw exception since DATA_CACHE is null");
  }
 catch (  Exception e) {
  }
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  HelixTestUtil.runPipeline(event,dataRefresh);
  try {
    HelixTestUtil.runStage(event,throttleStage);
    Assert.fail("Should throw exception since RESOURCE is null");
  }
 catch (  Exception e) {
  }
  HelixTestUtil.runStage(event,new ResourceComputationStage());
  try {
    HelixTestUtil.runStage(event,throttleStage);
    Assert.fail("Should throw exception since MESSAGE_SELECT is null");
  }
 catch (  Exception e) {
  }
  MessageOutput msgSelectOutput=new MessageOutput();
  List<Message> selectMessages=new ArrayList<Message>();
  Message msg=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_0");
  selectMessages.add(msg);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"),selectMessages);
  event.addAttribute(AttributeName.MESSAGES_SELECTED.toString(),msgSelectOutput);
  HelixTestUtil.runStage(event,throttleStage);
  MessageOutput msgThrottleOutput=event.getAttribute(AttributeName.MESSAGES_THROTTLE.toString());
  Assert.assertEquals(msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0")).size(),1);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testMsgThrottleConstraintsQuota() throws Exception {
  String clusterName="CLUSTER_" + _className + "_constraints_quota";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  List<IdealState> idealStates=HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},new String[]{"TestDB"},2,2);
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  ZNRecord record=new ZNRecord(ConstraintType.MESSAGE_CONSTRAINT.toString());
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("INSTANCE","localhost_0");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("INSTANCE","localhost_1");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("PARTITION","TestDB_0");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("PARTITION","TestDB_1");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint1"));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  ClusterConstraints constraint=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  MessageThrottleStage throttleStage=new MessageThrottleStage();
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  BestPossibleStateOutput bestPossOutput=getEmptyBestPossibleStateOutput(idealStates);
  event.addAttribute(AttributeName.BEST_POSSIBLE_STATE.toString(),bestPossOutput);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runStage(event,new ResourceComputationStage());
  MessageOutput msgSelectOutput=new MessageOutput();
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_0","TestDB_0");
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_0","TestDB_1");
  Message msg3=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-003"),"OFFLINE","SLAVE","TestDB","localhost_1","TestDB_0");
  Message msg4=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-004"),"OFFLINE","SLAVE","TestDB","localhost_1","TestDB_1");
  List<Message> selectMessages0=new ArrayList<Message>();
  selectMessages0.add(msg1);
  selectMessages0.add(msg2);
  List<Message> selectMessages1=new ArrayList<Message>();
  selectMessages1.add(msg3);
  selectMessages1.add(msg4);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"),selectMessages0);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_1"),selectMessages1);
  event.addAttribute(AttributeName.MESSAGES_SELECTED.toString(),msgSelectOutput);
  HelixTestUtil.runStage(event,throttleStage);
  MessageOutput msgThrottleOutput=event.getAttribute(AttributeName.MESSAGES_THROTTLE.toString());
  List<Message> throttleMessages=msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"));
  Assert.assertEquals(throttleMessages.size(),1);
  Assert.assertTrue(throttleMessages.contains(msg1));
  throttleMessages=msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_1"));
  Assert.assertEquals(throttleMessages.size(),1);
  Assert.assertTrue(throttleMessages.contains(msg4));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestMsgSelectionStage </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMasterXferAfterMasterResume(){
  System.out.println("START testMasterXferAfterMasterResume at " + new Date(System.currentTimeMillis()));
  Map<ParticipantId,Participant> liveParticipants=new HashMap<ParticipantId,Participant>();
  Map<ResourceId,CurrentState> currentStateMap=Collections.emptyMap();
  Map<MessageId,Message> messageMap=Collections.emptyMap();
  ParticipantId participantId0=ParticipantId.from("localhost_0");
  ParticipantId participantId1=ParticipantId.from("localhost_1");
  LiveInstance[] liveInstances=new LiveInstance[2];
  for (int i=0; i < 2; i++) {
    liveInstances[i]=new LiveInstance("localhost_" + i);
    liveInstances[i].setSessionId("session_" + i);
    liveInstances[i].setHelixVersion("1.2.3.4");
    liveInstances[i].setLiveInstance(i + "@localhost");
  }
  liveParticipants.put(participantId0,new Participant(new ParticipantConfig.Builder(participantId0).hostName("localhost").port(0).build(),liveInstances[0],currentStateMap,messageMap,null));
  liveParticipants.put(participantId1,new Participant(new ParticipantConfig.Builder(participantId1).hostName("localhost").port(1).build(),liveInstances[1],currentStateMap,messageMap,null));
  Map<ParticipantId,State> currentStates=new HashMap<ParticipantId,State>();
  currentStates.put(ParticipantId.from("localhost_0"),State.from("SLAVE"));
  currentStates.put(ParticipantId.from("localhost_1"),State.from("SLAVE"));
  Map<ParticipantId,State> pendingStates=new HashMap<ParticipantId,State>();
  pendingStates.put(ParticipantId.from("localhost_1"),State.from("MASTER"));
  List<Message> messages=new ArrayList<Message>();
  messages.add(TestHelper.createMessage(MessageId.from("msgId_0"),"SLAVE","MASTER","localhost_0","TestDB","TestDB_0"));
  Map<State,Bounds> stateConstraints=new HashMap<State,Bounds>();
  stateConstraints.put(State.from("MASTER"),new Bounds(0,1));
  stateConstraints.put(State.from("SLAVE"),new Bounds(0,2));
  Map<String,Integer> stateTransitionPriorities=new HashMap<String,Integer>();
  stateTransitionPriorities.put("MASTER-SLAVE",0);
  stateTransitionPriorities.put("SLAVE-MASTER",1);
  List<Message> selectedMsg=new MessageSelectionStage().selectMessages(liveParticipants,currentStates,pendingStates,messages,stateConstraints,stateTransitionPriorities,State.from("OFFLINE"));
  Assert.assertEquals(selectedMsg.size(),0);
  System.out.println("END testMasterXferAfterMasterResume at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMasterXfer(){
  System.out.println("START testMasterXfer at " + new Date(System.currentTimeMillis()));
  Map<ParticipantId,Participant> liveParticipants=new HashMap<ParticipantId,Participant>();
  Map<ResourceId,CurrentState> currentStateMap=Collections.emptyMap();
  Map<MessageId,Message> messageMap=Collections.emptyMap();
  ParticipantId participantId0=ParticipantId.from("localhost_0");
  ParticipantId participantId1=ParticipantId.from("localhost_1");
  LiveInstance[] liveInstances=new LiveInstance[2];
  for (int i=0; i < 2; i++) {
    liveInstances[i]=new LiveInstance("localhost_" + i);
    liveInstances[i].setSessionId("session_" + i);
    liveInstances[i].setHelixVersion("1.2.3.4");
    liveInstances[i].setLiveInstance(i + "@localhost");
  }
  liveParticipants.put(participantId0,new Participant(new ParticipantConfig.Builder(participantId0).hostName("localhost").port(0).build(),liveInstances[0],currentStateMap,messageMap,null));
  liveParticipants.put(participantId1,new Participant(new ParticipantConfig.Builder(participantId1).hostName("localhost").port(1).build(),liveInstances[1],currentStateMap,messageMap,null));
  Map<ParticipantId,State> currentStates=new HashMap<ParticipantId,State>();
  currentStates.put(ParticipantId.from("localhost_0"),State.from("SLAVE"));
  currentStates.put(ParticipantId.from("localhost_1"),State.from("MASTER"));
  Map<ParticipantId,State> pendingStates=new HashMap<ParticipantId,State>();
  List<Message> messages=new ArrayList<Message>();
  messages.add(TestHelper.createMessage(MessageId.from("msgId_0"),"SLAVE","MASTER","localhost_0","TestDB","TestDB_0"));
  messages.add(TestHelper.createMessage(MessageId.from("msgId_1"),"MASTER","SLAVE","localhost_1","TestDB","TestDB_0"));
  Map<State,Bounds> stateConstraints=new HashMap<State,Bounds>();
  stateConstraints.put(State.from("MASTER"),new Bounds(0,1));
  stateConstraints.put(State.from("SLAVE"),new Bounds(0,2));
  Map<String,Integer> stateTransitionPriorities=new HashMap<String,Integer>();
  stateTransitionPriorities.put("MASTER-SLAVE",0);
  stateTransitionPriorities.put("SLAVE-MASTER",1);
  List<Message> selectedMsg=new MessageSelectionStage().selectMessages(liveParticipants,currentStates,pendingStates,messages,stateConstraints,stateTransitionPriorities,State.from("OFFLINE"));
  Assert.assertEquals(selectedMsg.size(),1);
  Assert.assertEquals(selectedMsg.get(0).getMessageId(),MessageId.from("msgId_1"));
  System.out.println("END testMasterXfer at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestRebalancePipeline </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDuplicateMsg(){
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  final String resourceName="testResource_dup";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  Pipeline rebalancePipeline=new Pipeline();
  rebalancePipeline.addStage(new ResourceComputationStage());
  rebalancePipeline.addStage(new CurrentStateComputationStage());
  rebalancePipeline.addStage(new BestPossibleStateCalcStage());
  rebalancePipeline.addStage(new MessageGenerationStage());
  rebalancePipeline.addStage(new MessageSelectionStage());
  rebalancePipeline.addStage(new MessageThrottleStage());
  rebalancePipeline.addStage(new TaskAssignmentStage());
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","OFFLINE");
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  MessageOutput msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  List<Message> messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: OFFLINE-SLAVE for node0");
  Message message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTypedToState().toString(),"SLAVE");
  Assert.assertEquals(message.getTgtName(),"localhost_0");
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),0,"Should NOT output 1 message: SLAVE-MASTER for node1");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMasterXfer(){
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  final String resourceName="testResource_xfer";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  Pipeline rebalancePipeline=new Pipeline();
  rebalancePipeline.addStage(new ResourceComputationStage());
  rebalancePipeline.addStage(new CurrentStateComputationStage());
  rebalancePipeline.addStage(new BestPossibleStateCalcStage());
  rebalancePipeline.addStage(new MessageGenerationStage());
  rebalancePipeline.addStage(new MessageSelectionStage());
  rebalancePipeline.addStage(new MessageThrottleStage());
  rebalancePipeline.addStage(new TaskAssignmentStage());
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  MessageOutput msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  List<Message> messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: SLAVE-MASTER for node1");
  Message message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"SLAVE");
  Assert.assertEquals(message.getTypedToState().toString(),"MASTER");
  Assert.assertEquals(message.getTgtName(),"localhost_1");
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0});
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),0,"Should NOT output 1 message: SLAVE-MASTER for node0");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testChangeIdealStateWithPendingMsg(){
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  ClusterDataCache cache=new ClusterDataCache();
  event.addAttribute("ClusterDataCache",cache);
  final String resourceName="testResource_pending";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  Pipeline rebalancePipeline=new Pipeline();
  rebalancePipeline.addStage(new ResourceComputationStage());
  rebalancePipeline.addStage(new CurrentStateComputationStage());
  rebalancePipeline.addStage(new BestPossibleStateCalcStage());
  rebalancePipeline.addStage(new MessageGenerationStage());
  rebalancePipeline.addStage(new MessageSelectionStage());
  rebalancePipeline.addStage(new MessageThrottleStage());
  rebalancePipeline.addStage(new TaskAssignmentStage());
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","OFFLINE");
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  MessageOutput msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  List<Message> messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: OFFLINE-SLAVE for node0");
  Message message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTypedToState().toString(),"SLAVE");
  Assert.assertEquals(message.getTgtName(),"localhost_0");
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.dropResource(clusterName,resourceName);
  List<IdealState> idealStates=accessor.getChildValues(accessor.keyBuilder().idealStates());
  cache.setIdealStates(idealStates);
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output only 1 message: OFFLINE->DROPPED for localhost_1");
  message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"SLAVE");
  Assert.assertEquals(message.getTypedToState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTgtName(),"localhost_1");
  Builder keyBuilder=accessor.keyBuilder();
  List<String> msgIds=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  accessor.removeProperty(keyBuilder.message("localhost_0",msgIds.get(0)));
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runPipeline(event,rebalancePipeline);
  msgSelOutput=event.getAttribute(AttributeName.MESSAGES_SELECTED.toString());
  messages=msgSelOutput.getMessages(ResourceId.from(resourceName),PartitionId.from(resourceName + "_0"));
  Assert.assertEquals(messages.size(),1,"Should output 1 message: OFFLINE->DROPPED for localhost_0");
  message=messages.get(0);
  Assert.assertEquals(message.getTypedFromState().toString(),"OFFLINE");
  Assert.assertEquals(message.getTypedToState().toString(),"DROPPED");
  Assert.assertEquals(message.getTgtName(),"localhost_0");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMsgTriggeredRebalance() throws Exception {
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final String resourceName="testResource_dup";
  String[] resourceGroups=new String[]{resourceName};
  HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},resourceGroups,1,2);
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  HelixTestUtil.setupInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Thread.sleep(1000);
  Builder keyBuilder=accessor.keyBuilder();
  List<String> messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  Assert.assertEquals(messages.size(),1);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_1"));
  Assert.assertEquals(messages.size(),1);
  setCurrentState(clusterName,"localhost_0",resourceName,resourceName + "_0","session_0","SLAVE");
  setCurrentState(clusterName,"localhost_1",resourceName,resourceName + "_0","session_1","SLAVE");
  Thread.sleep(1000);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  Assert.assertEquals(messages.size(),1);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_1"));
  Assert.assertEquals(messages.size(),1);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  accessor.removeProperty(keyBuilder.message("localhost_0",messages.get(0)));
  Thread.sleep(1000);
  messages=accessor.getChildNames(keyBuilder.messages("localhost_0"));
  Assert.assertEquals(messages.size(),1);
  ZNRecord msg=accessor.getProperty(keyBuilder.message("localhost_0",messages.get(0))).getRecord();
  String toState=msg.getSimpleField(Attributes.TO_STATE.toString());
  Assert.assertEquals(toState,"MASTER");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestResourceComputationStage </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResources() throws Exception {
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResourcesWithSomeDropped() throws Exception {
  int nodes=5;
  List<String> instances=new ArrayList<String>();
  for (int i=0; i < nodes; i++) {
    instances.add("localhost_" + i);
  }
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=new ArrayList<IdealState>();
  for (int i=0; i < resources.length; i++) {
    int partitions=10;
    int replicas=1;
    String resourceName=resources[i];
    ZNRecord record=DefaultTwoStateStrategy.calculateIdealState(instances,partitions,replicas,resourceName,"MASTER","SLAVE");
    IdealState idealState=new IdealState(record);
    idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
    HelixDataAccessor accessor=manager.getHelixDataAccessor();
    Builder keyBuilder=accessor.keyBuilder();
    accessor.setProperty(keyBuilder.idealStates(resourceName),idealState);
    idealStates.add(idealState);
  }
  String instanceName="localhost_" + 3;
  LiveInstance liveInstance=new LiveInstance(instanceName);
  String sessionId=UUID.randomUUID().toString();
  liveInstance.setSessionId(sessionId);
  InstanceConfig instanceConfig=new InstanceConfig(instanceName);
  instanceConfig.setHostName("localhost");
  instanceConfig.setPort("3");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.liveInstance(instanceName),liveInstance);
  accessor.setProperty(keyBuilder.instanceConfig(instanceName),instanceConfig);
  String oldResource="testResourceOld";
  CurrentState currentState=new CurrentState(oldResource);
  currentState.setState(PartitionId.from("testResourceOld_0"),State.from("OFFLINE"));
  currentState.setState(PartitionId.from("testResourceOld_1"),State.from("SLAVE"));
  currentState.setState(PartitionId.from("testResourceOld_2"),State.from("MASTER"));
  currentState.setStateModelDefRef("MasterSlave");
  accessor.setProperty(keyBuilder.currentState(instanceName,sessionId,oldResource),currentState);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length + 1,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
  ResourceId oldResourceId=ResourceId.from(oldResource);
  AssertJUnit.assertTrue(resourceMap.containsKey(oldResourceId));
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getId(),oldResourceId);
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getIdealState().getStateModelDefId(),currentState.getStateModelDefId());
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getSubUnitSet().size(),currentState.getTypedPartitionStateMap().size());
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Case where we have one resource in IdealState
 * @throws Exception
 */
@Test public void testSimple() throws Exception {
  int nodes=5;
  List<String> instances=new ArrayList<String>();
  for (int i=0; i < nodes; i++) {
    instances.add("localhost_" + i);
  }
  int partitions=10;
  int replicas=1;
  String resourceName="testResource";
  ZNRecord record=DefaultTwoStateStrategy.calculateIdealState(instances,partitions,replicas,resourceName,"MASTER","SLAVE");
  IdealState idealState=new IdealState(record);
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.idealStates(resourceName),idealState);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resource=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(1,resource.size());
  AssertJUnit.assertEquals(resource.keySet().iterator().next(),ResourceId.from(resourceName));
  AssertJUnit.assertEquals(resource.values().iterator().next().getId(),ResourceId.from(resourceName));
  AssertJUnit.assertEquals(resource.values().iterator().next().getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
  AssertJUnit.assertEquals(resource.values().iterator().next().getSubUnitSet().size(),partitions);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestStagesWithLogicalAccessors </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadClusterDataStage(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  ClusterAccessor clusterAccessor=new ClusterAccessor(_clusterId,_dataAccessor);
  Cluster cluster=clusterAccessor.readCluster();
  ClusterId id=cluster.getId();
  Assert.assertEquals(id,_clusterId);
  Map<ParticipantId,Participant> liveParticipantMap=cluster.getLiveParticipantMap();
  Assert.assertEquals(liveParticipantMap.size(),n);
  for (  ParticipantId participantId : liveParticipantMap.keySet()) {
    Participant participant=liveParticipantMap.get(participantId);
    Map<ResourceId,CurrentState> curStateMap=participant.getCurrentStateMap();
    Assert.assertEquals(curStateMap.size(),1);
    ResourceId resourceId=ResourceId.from("TestDB0");
    Assert.assertTrue(curStateMap.containsKey(resourceId));
    CurrentState curState=curStateMap.get(resourceId);
    Map<PartitionId,State> partitionStateMap=curState.getTypedPartitionStateMap();
    Assert.assertEquals(partitionStateMap.size(),p);
  }
  Map<ResourceId,Resource> resourceMap=cluster.getResourceMap();
  Assert.assertEquals(resourceMap.size(),1);
  ResourceId resourceId=ResourceId.from("TestDB0");
  Assert.assertTrue(resourceMap.containsKey(resourceId));
  Resource resource=resourceMap.get(resourceId);
  Assert.assertNotNull(resource.getIdealState());
  Assert.assertEquals(resource.getIdealState().getRebalanceMode(),RebalanceMode.SEMI_AUTO);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.strategy.TestAutoRebalanceStrategy </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests the following scenario: there is only a single partition for a resource. Two nodes up,
 * partition should
 * be assigned to one of them. Take down that node, partition should move. Bring back up that
 * node, partition should not move unnecessarily.
 */
@Test public void testWontMoveSinglePartitionUnnecessarily(){
  final ResourceId RESOURCE=ResourceId.from("resource");
  final PartitionId partition=PartitionId.from("resource_0");
  final StateModelDefinition STATE_MODEL=new StateModelDefinition(StateModelConfigGenerator.generateConfigForOnlineOffline());
  LinkedHashMap<State,Integer> stateCount=Maps.newLinkedHashMap();
  stateCount.put(State.from("ONLINE"),1);
  final ParticipantId[] NODES={ParticipantId.from("n0"),ParticipantId.from("n1")};
  ReplicaPlacementScheme scheme=new AutoRebalanceStrategy.DefaultPlacementScheme();
  List<ParticipantId> allNodes=Lists.newArrayList(NODES);
  List<ParticipantId> liveNodes=Lists.newArrayList(NODES);
  Map<PartitionId,Map<ParticipantId,State>> currentMapping=Maps.newHashMap();
  currentMapping.put(partition,new HashMap<ParticipantId,State>());
  List<PartitionId> partitions=Lists.newArrayList(partition);
  Map<State,String> upperBounds=Maps.newHashMap();
  for (  State state : STATE_MODEL.getTypedStatesPriorityList()) {
    upperBounds.put(state,STATE_MODEL.getNumParticipantsPerState(state));
  }
  ZNRecord znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  Map<String,List<String>> preferenceLists=znRecord.getListFields();
  List<String> preferenceList=preferenceLists.get(partition.toString());
  Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
  Assert.assertEquals(preferenceList.size(),1,"invalid preference list for " + partition);
  String state=znRecord.getMapField(partition.toString()).get(preferenceList.get(0));
  Assert.assertEquals(state,"ONLINE","Invalid state for " + partition);
  ParticipantId preferredNode=ParticipantId.from(preferenceList.get(0));
  ParticipantId otherNode=preferredNode.equals(NODES[0]) ? NODES[1] : NODES[0];
  currentMapping.get(partition).put(otherNode,State.from(state));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  preferenceList=preferenceLists.get(partition.toString());
  Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
  Assert.assertEquals(preferenceList.size(),1,"invalid preference list for " + partition);
  state=znRecord.getMapField(partition.toString()).get(preferenceList.get(0));
  Assert.assertEquals(state,"ONLINE","Invalid state for " + partition);
  ParticipantId finalPreferredNode=ParticipantId.from(preferenceList.get(0));
  Assert.assertEquals(finalPreferredNode,otherNode);
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 type-11 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests the following scenario: nodes come up one by one, then one node is taken down. Preference
 * lists should prefer nodes in the current mapping at all times, but when all nodes are in the
 * current mapping, then it should distribute states as evenly as possible.
 */
@Test public void testOrphansNotPreferred(){
  final ResourceId RESOURCE=ResourceId.from("resource");
  final PartitionId[] PARTITIONS={PartitionId.from("resource_0"),PartitionId.from("resource_1"),PartitionId.from("resource_2")};
  final StateModelDefinition STATE_MODEL=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  final int REPLICA_COUNT=2;
  final ParticipantId[] NODES={ParticipantId.from("n0"),ParticipantId.from("n1"),ParticipantId.from("n2")};
  ReplicaPlacementScheme scheme=new AutoRebalanceStrategy.DefaultPlacementScheme();
  List<ParticipantId> allNodes=Lists.newArrayList(NODES[0]);
  List<ParticipantId> liveNodes=Lists.newArrayList(NODES[0]);
  Map<PartitionId,Map<ParticipantId,State>> currentMapping=Maps.newHashMap();
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.put(partition,new HashMap<ParticipantId,State>());
  }
  List<PartitionId> partitions=ImmutableList.copyOf(PARTITIONS);
  Map<State,String> upperBounds=Maps.newHashMap();
  for (  State state : STATE_MODEL.getTypedStatesPriorityList()) {
    upperBounds.put(state,STATE_MODEL.getNumParticipantsPerState(state));
  }
  LinkedHashMap<State,Integer> stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  ZNRecord znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  Map<String,List<String>> preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),1,"invalid preference list for " + partition);
  }
  allNodes.add(NODES[1]);
  liveNodes.add(NODES[1]);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).put(NODES[0],State.from("MASTER"));
  }
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.get(0),NODES[0].toString(),"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.get(1),NODES[1].toString(),"invalid preference list for " + partition);
  }
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).put(NODES[1],State.from("SLAVE"));
  }
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  Set<String> firstNodes=Sets.newHashSet();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
  }
  Assert.assertEquals(firstNodes.size(),2,"masters not evenly distributed");
  allNodes.add(NODES[2]);
  liveNodes.add(NODES[2]);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  currentMapping.get(PARTITIONS[1]).put(NODES[0],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  boolean newNodeUsed=false;
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    if (preferenceList.contains(NODES[2].toString())) {
      newNodeUsed=true;
      Assert.assertEquals(preferenceList.get(1),NODES[2].toString(),"newly added node not at preference list tail for " + partition);
    }
  }
  Assert.assertTrue(newNodeUsed,"not using " + NODES[2]);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[0],State.from("MASTER"));
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[0],State.from("MASTER"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("SLAVE"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  firstNodes.clear();
  Set<String> secondNodes=Sets.newHashSet();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
    secondNodes.add(preferenceList.get(1));
  }
  Assert.assertEquals(firstNodes.size(),3,"masters not distributed evenly");
  Assert.assertEquals(secondNodes.size(),3,"slaves not distributed evenly");
  liveNodes.remove(0);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    Map<ParticipantId,State> stateMap=currentMapping.get(partition);
    for (    ParticipantId participant : stateMap.keySet()) {
      Assert.assertTrue(preferenceList.contains(participant.toString()),"minimal movement violated for " + partition);
    }
    for (    String participant : preferenceList) {
      if (!stateMap.containsKey(ParticipantId.from(participant))) {
        Assert.assertNotSame(preferenceList.get(0),participant,"newly moved replica should not be master for " + partition);
      }
    }
  }
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[0]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("MASTER"));
  currentMapping.get(PARTITIONS[2]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  firstNodes.clear();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
  }
  Assert.assertEquals(firstNodes.size(),2,"masters not evenly distributed");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAddNodeAfterControllerStart </h4><pre class="type-7 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiCluster() throws Exception {
  String testName=TestUtil.getTestName();
  String clusterName=testName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  final String grandClusterName="GRAND_" + clusterName;
  TestHelper.setupCluster(grandClusterName,_zkaddr,0,"controller",null,0,0,1,0,null,true);
  MockMultiClusterController multiClusterController=new MockMultiClusterController(_zkaddr,grandClusterName,"controller_0");
  multiClusterController.syncStart();
  _setupTool.addCluster(clusterName,true);
  _setupTool.activateCluster(clusterName,"GRAND_" + clusterName,true);
  boolean result;
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,"GRAND_" + clusterName));
  Assert.assertTrue(result);
  final int nodeNr=2;
  for (int i=0; i < nodeNr - 1; i++) {
    int port=12918 + i;
    _setupTool.addInstanceToCluster(clusterName,"localhost_" + port);
  }
  _setupTool.addResourceToCluster(clusterName,"TestDB0",1,"LeaderStandby");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",1);
  MockParticipant[] participants=new MockParticipant[nodeNr];
  for (int i=0; i < nodeNr - 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12918");
  int numberOfListeners=ZkTestHelper.numberOfListeners(_zkaddr,msgPath);
  Assert.assertEquals(numberOfListeners,2);
  _setupTool.addInstanceToCluster(clusterName,"localhost_12919");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",2);
  participants[nodeNr - 1]=new MockParticipant(_zkaddr,clusterName,"localhost_12919");
  participants[nodeNr - 1].syncStart();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12919");
  numberOfListeners=ZkTestHelper.numberOfListeners(_zkaddr,msgPath);
  Assert.assertEquals(numberOfListeners,2);
  multiClusterController.syncStop();
  for (int i=0; i < nodeNr; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAddStateModelFactoryAfterConnect </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  _setupTool.addResourceToCluster(clusterName,"TestDB1",16,"MasterSlave");
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB1"));
  idealState.setStateModelFactoryId(StateModelFactoryId.from("TestDB1_Factory"));
  accessor.setProperty(keyBuilder.idealStates("TestDB1"),idealState);
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB1",3);
  int totalMsgs=0;
  for (int retry=0; retry < 5; retry++) {
    Thread.sleep(100);
    totalMsgs=0;
    for (int i=0; i < n; i++) {
      List<Message> msgs=accessor.getChildValues(keyBuilder.messages(participants[i].getInstanceName()));
      totalMsgs+=msgs.size();
    }
    if (totalMsgs == 48)     break;
  }
  Assert.assertEquals(totalMsgs,48,"Should accumulated 48 unprocessed messages (1 O->S per partition per replica) because TestDB1 is added without state-model-factory but was " + totalMsgs);
  for (int i=0; i < n; i++) {
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,"TestDB1_Factory",new MockMSModelFactory());
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAutoRebalance </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testAutoRebalance() throws Exception {
  _participants[0].syncStop();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  for (int i=0; i < 2; i++) {
    String storageNodeName="localhost_" + (1000 + i);
    _setupTool.addInstanceToCluster(CLUSTER_NAME,storageNodeName);
    MockParticipant participant=new MockParticipant(_zkaddr,CLUSTER_NAME,storageNodeName.replace(':','_'));
    participant.syncStart();
  }
  Thread.sleep(5000);
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,db2));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(CLUSTER_NAME,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(keyBuilder.externalView(db2));
  Set<String> instancesSet=new HashSet<String>();
  for (  String partitionName : ev.getRecord().getMapFields().keySet()) {
    Map<String,String> assignmentMap=ev.getRecord().getMapField(partitionName);
    for (    String instance : assignmentMap.keySet()) {
      instancesSet.add(instance);
    }
  }
  Assert.assertEquals(instancesSet.size(),2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAutoRebalancePartitionLimit </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testAutoRebalanceWithMaxPartitionPerNode() throws Exception {
  HelixManager manager=_controller;
  _participants[0].syncStop();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  final HelixDataAccessor accessor=manager.getHelixDataAccessor();
  ExternalView ev=manager.getHelixDataAccessor().getProperty(accessor.keyBuilder().externalView(TEST_DB));
  Assert.assertEquals(ev.getPartitionSet().size(),100);
  _participants[1].syncStop();
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView(TEST_DB));
      return ev.getPartitionSet().size() == 75;
    }
  }
,3 * 1000);
  for (int i=0; i < 2; i++) {
    String storageNodeName="localhost_" + (1000 + i);
    _setupTool.addInstanceToCluster(CLUSTER_NAME,storageNodeName);
    String newInstanceName=storageNodeName.replace(':','_');
    MockParticipant participant=new MockParticipant(_zkaddr,CLUSTER_NAME,newInstanceName);
    participant.syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestBatchMessageWrapper </h4><pre class="type-4 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"MasterSlave",true);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setBatchMessageMode(true);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  TestMockMSModelFactory[] ftys=new TestMockMSModelFactory[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    ftys[i]=new TestMockMSModelFactory();
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,ftys[i]);
    participants[i].syncStart();
    boolean result=false;
    do {
      Thread.sleep(100);
      result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
    }
 while (result == false);
    Assert.assertTrue(result,"participant: " + instanceName + " fails to complete all transitions");
  }
  MockBatchMsgWrapper wrapper=(MockBatchMsgWrapper)ftys[0].getBatchMessageWrapper(ResourceId.from("TestDB0"));
  Assert.assertEquals(wrapper._startCount,3,"Expect 3 batch.start: O->S, S->M, and M->S for 1st participant");
  Assert.assertEquals(wrapper._endCount,3,"Expect 3 batch.end: O->S, S->M, and M->S for 1st participant");
  wrapper=(MockBatchMsgWrapper)ftys[1].getBatchMessageWrapper(ResourceId.from("TestDB0"));
  Assert.assertEquals(wrapper._startCount,2,"Expect 2 batch.start: O->S and S->M for 2nd participant");
  Assert.assertEquals(wrapper._startCount,2,"Expect 2 batch.end: O->S and S->M for 2nd participant");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestCorrectnessOnConnectivityLoss </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@SuppressWarnings("deprecation") @Test public void testSpectator() throws Exception {
  Map<String,Integer> stateReachedCounts=Maps.newHashMap();
  HelixManager participant=HelixManagerFactory.getZKHelixManager(_clusterName,"localhost_12918",InstanceType.PARTICIPANT,ZK_ADDR);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("OnlineOffline"),new MyStateModelFactory(stateReachedCounts));
  participant.connect();
  RoutingTableProvider routingTableProvider=new RoutingTableProvider();
  HelixManager spectator=HelixManagerFactory.getZKHelixManager(_clusterName,"spectator",InstanceType.SPECTATOR,ZK_ADDR);
  spectator.connect();
  spectator.addInstanceConfigChangeListener(routingTableProvider);
  spectator.addExternalViewChangeListener(routingTableProvider);
  Thread.sleep(1000);
  TestHelper.stopZkServer(_zkServer);
  Thread.sleep(1000);
  Assert.assertEquals(routingTableProvider.getInstances("resource0","ONLINE").size(),1);
  Assert.assertEquals(routingTableProvider.getInstances("resource0","OFFLINE").size(),0);
}

</code></pre>

<br>
<pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParticipant() throws Exception {
  Map<String,Integer> stateReachedCounts=Maps.newHashMap();
  HelixManager participant=HelixManagerFactory.getZKHelixManager(_clusterName,"localhost_12918",InstanceType.PARTICIPANT,ZK_ADDR);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("OnlineOffline"),new MyStateModelFactory(stateReachedCounts));
  participant.connect();
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(ZK_ADDR,_clusterName));
  Assert.assertTrue(result);
  Assert.assertEquals(stateReachedCounts.size(),1);
  Assert.assertTrue(stateReachedCounts.containsKey("ONLINE"));
  Assert.assertEquals(stateReachedCounts.get("ONLINE").intValue(),1);
  TestHelper.stopZkServer(_zkServer);
  Thread.sleep(1000);
  Assert.assertEquals(stateReachedCounts.size(),1);
  Assert.assertTrue(stateReachedCounts.containsKey("ONLINE"));
  Assert.assertEquals(stateReachedCounts.get("ONLINE").intValue(),1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestCustomizedIdealStateRebalancer </h4><pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomizedIdealStateRebalancer() throws InterruptedException {
  _setupTool.addResourceToCluster(CLUSTER_NAME,db2,60,"MasterSlave");
  _setupTool.addResourceProperty(CLUSTER_NAME,db2,IdealStateProperty.REBALANCER_CLASS_NAME.toString(),TestCustomizedIdealStateRebalancer.TestRebalancer.class.getName());
  _setupTool.addResourceProperty(CLUSTER_NAME,db2,IdealStateProperty.REBALANCE_MODE.toString(),RebalanceMode.USER_DEFINED.toString());
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,db2,3);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,db2));
  Assert.assertTrue(result);
  Thread.sleep(1000);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(CLUSTER_NAME,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(keyBuilder.externalView(db2));
  Assert.assertEquals(ev.getPartitionSet().size(),60);
  for (  String partition : ev.getPartitionSet()) {
    Assert.assertEquals(ev.getStateMap(partition).size(),1);
  }
  IdealState is=accessor.getProperty(keyBuilder.idealStates(db2));
  for (  PartitionId partition : is.getPartitionIdSet()) {
    Assert.assertEquals(is.getPreferenceList(partition).size(),0);
    Assert.assertEquals(is.getParticipantStateMap(partition).size(),0);
  }
  Assert.assertTrue(testRebalancerCreated);
  Assert.assertTrue(testRebalancerInvoked);
  ControllerContextHolder holder=accessor.getProperty(keyBuilder.controllerContext(db2));
  Assert.assertNotNull(holder);
  Assert.assertNotNull(holder.getContext());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDrop </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailToDropResourceWithErrorPartitionSemiAuto() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errTransitions=new HashMap<String,Set<String>>();
  errTransitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errTransitions.put("ERROR-DROPPED",TestHelper.setOf("TestDB0_4"));
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errTransitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropResource",clusterName,"TestDB0"});
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  InstanceConfig config=accessor.getProperty(keyBuilder.instanceConfig("localhost_12918"));
  List<String> disabledPartitions=config.getDisabledPartitions();
  Assert.assertEquals(disabledPartitions.size(),1,"TestDB0_4 should be disabled");
  Assert.assertEquals(disabledPartitions.get(0),"TestDB0_4");
  ExternalView ev=accessor.getProperty(keyBuilder.externalView("TestDB0"));
  Set<String> partitions=ev.getPartitionSet();
  Assert.assertEquals(partitions.size(),1,"Should have TestDB0_4->localhost_12918->ERROR");
  String errPartition=partitions.iterator().next();
  Assert.assertEquals(errPartition,"TestDB0_4");
  Map<String,String> stateMap=ev.getStateMap(errPartition);
  Assert.assertEquals(stateMap.size(),1);
  Assert.assertEquals(stateMap.keySet().iterator().next(),"localhost_12918");
  Assert.assertEquals(stateMap.get("localhost_12918"),HelixDefinedState.ERROR.name());
  CurrentState cs=accessor.getProperty(keyBuilder.currentState(participants[0].getInstanceName(),participants[0].getSessionId(),"TestDB0"));
  Map<String,String> partitionStateMap=cs.getPartitionStateMap();
  Assert.assertEquals(partitionStateMap.size(),1);
  Assert.assertEquals(partitionStateMap.keySet().iterator().next(),"TestDB0_4");
  Assert.assertEquals(partitionStateMap.get("TestDB0_4"),HelixDefinedState.ERROR.name());
  for (int i=1; i < n; i++) {
    String instanceName=participants[i].getInstanceName();
    String sessionId=participants[i].getSessionId();
    Assert.assertNull(accessor.getProperty(keyBuilder.currentState(instanceName,sessionId,"TestDB0")));
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestEnablePartitionDuringDisable </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEnablePartitionDuringDisable() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  EnablePartitionTransition transition=new EnablePartitionTransition();
  MockParticipant[] participants=new MockParticipant[5];
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (instanceName.equals("localhost_12919")) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(transition);
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enablePartition false "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  long startT=System.currentTimeMillis();
  while (System.currentTimeMillis() - startT < 10000) {
    if (transition.slaveToOfflineCnt > 0 && transition.offlineToSlave > 0) {
      break;
    }
    Thread.sleep(100);
  }
  long endT=System.currentTimeMillis();
  System.out.println("1 disable and re-enable took: " + (endT - startT) + "ms");
  Assert.assertEquals(transition.slaveToOfflineCnt,1,"should get 1 slaveToOffline transition");
  Assert.assertEquals(transition.offlineToSlave,1,"should get 1 offlineToSlave transition");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestHelixInstanceTag </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceTag() throws Exception {
  HelixManager manager=_controller;
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  String DB2="TestDB2";
  int partitions=100;
  String DB2tag="TestDB2_tag";
  int replica=2;
  for (int i=0; i < 2; i++) {
    String instanceName="localhost_" + (12918 + i);
    _setupTool.getClusterManagementTool().addInstanceTag(CLUSTER_NAME,instanceName,DB2tag);
  }
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB2,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB2,DB2tag,replica);
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME)));
  Assert.assertTrue(result,"Cluster verification fails");
  ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView(DB2));
  Set<String> hosts=new HashSet<String>();
  for (  String p : ev.getPartitionSet()) {
    for (    String hostName : ev.getStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(hostName));
      Assert.assertTrue(config.containsTag(DB2tag));
      hosts.add(hostName);
    }
  }
  Assert.assertEquals(hosts.size(),2);
  String DB3="TestDB3";
  String DB3Tag="TestDB3_tag";
  partitions=10;
  replica=3;
  for (int i=1; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    _setupTool.getClusterManagementTool().addInstanceTag(CLUSTER_NAME,instanceName,DB3Tag);
  }
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB3,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB3,DB3Tag,replica);
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME)));
  Assert.assertTrue(result,"Cluster verification fails");
  ev=accessor.getProperty(accessor.keyBuilder().externalView(DB3));
  hosts=new HashSet<String>();
  for (  String p : ev.getPartitionSet()) {
    for (    String hostName : ev.getStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(hostName));
      Assert.assertTrue(config.containsTag(DB3Tag));
      hosts.add(hostName);
    }
  }
  Assert.assertEquals(hosts.size(),4);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestLocalContainerProvider </h4><pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBasic() throws Exception {
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  resourceName="TestDB0";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  allocated=0;
  started=0;
  stopped=0;
  deallocated=0;
  connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  ClusterAccessor clusterAccessor=connection.createClusterAccessor(clusterId);
  StateModelDefinition masterSlave=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  clusterAccessor.createCluster(new ClusterConfig.Builder(clusterId).addStateModelDefinition(masterSlave).build());
  ResourceId resourceId=ResourceId.from(resourceName);
  ProvisionerConfig provisionerConfig=new LocalProvisionerConfig(resourceId);
  AutoRebalanceModeISBuilder idealStateBuilder=new AutoRebalanceModeISBuilder(resourceId);
  for (int i=0; i < NUM_PARTITIONS; i++) {
    idealStateBuilder.add(PartitionId.from(resourceId,String.valueOf(i)));
  }
  idealStateBuilder.setNumReplica(NUM_REPLICAS).setStateModelDefId(masterSlave.getStateModelDefId());
  clusterAccessor.addResource(new ResourceConfig.Builder(ResourceId.from(resourceName)).provisionerConfig(provisionerConfig).idealState(idealStateBuilder.build()).build());
  ControllerId controllerId=ControllerId.from("controller1");
  HelixController controller=connection.createController(clusterId,controllerId);
  controller.start();
  latch.await(30000,TimeUnit.MILLISECONDS);
  controller.stop();
  connection.disconnect();
  Assert.assertEquals(allocated,MAX_PARTICIPANTS);
  Assert.assertEquals(started,MAX_PARTICIPANTS);
  Assert.assertEquals(stopped,MAX_PARTICIPANTS);
  Assert.assertEquals(deallocated,MAX_PARTICIPANTS);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestPartitionLevelTransitionConstraint </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,1,n,2,"MasterSlave",false);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  StateModelDefinition stateModelDef=defineStateModel();
  accessor.setProperty(accessor.keyBuilder().stateModelDef("Bootstrap"),stateModelDef);
  IdealState idealState=accessor.getProperty(accessor.keyBuilder().idealStates("TestDB0"));
  idealState.setStateModelDefRef("Bootstrap");
  idealState.setReplicas("2");
  idealState.getRecord().setListField("TestDB0_0",Arrays.asList("localhost_12919","localhost_12918"));
  accessor.setProperty(accessor.keyBuilder().idealStates("TestDB0"),idealState);
  ConstraintItemBuilder constraintItemBuilder=new ConstraintItemBuilder();
  constraintItemBuilder.addConstraintAttribute(ConstraintAttribute.MESSAGE_TYPE.toString(),"STATE_TRANSITION").addConstraintAttribute(ConstraintAttribute.PARTITION.toString(),".*").addConstraintAttribute(ConstraintAttribute.CONSTRAINT_VALUE.toString(),"1");
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.setConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1",constraintItemBuilder.build());
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  String instanceName1="localhost_12918";
  participants[0]=new MockParticipant(_zkaddr,clusterName,instanceName1);
  participants[0].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("Bootstrap"),new BootstrapStateModelFactory());
  participants[0].syncStart();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String instanceName2="localhost_12919";
  participants[1]=new MockParticipant(_zkaddr,clusterName,instanceName2);
  participants[1].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("Bootstrap"),new BootstrapStateModelFactory());
  participants[1].syncStart();
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertEquals(_msgOrderList.size(),7);
  Message[] _msgOrderArray=_msgOrderList.toArray(new Message[0]);
  assertMessage(_msgOrderArray[0],"OFFLINE","BOOTSTRAP",instanceName1);
  assertMessage(_msgOrderArray[1],"BOOTSTRAP","SLAVE",instanceName1);
  assertMessage(_msgOrderArray[2],"SLAVE","MASTER",instanceName1);
  assertMessage(_msgOrderArray[3],"OFFLINE","BOOTSTRAP",instanceName2);
  assertMessage(_msgOrderArray[4],"BOOTSTRAP","SLAVE",instanceName2);
  assertMessage(_msgOrderArray[5],"MASTER","SLAVE",instanceName1);
  assertMessage(_msgOrderArray[6],"SLAVE","MASTER",instanceName2);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestResetPartitionState </h4><pre class="type-5 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testResetPartitionState() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  try {
    String command="--zkSvr " + _zkaddr + " --resetPartition "+ clusterName+ " localhost_12918 TestDB0 TestDB0_nonExist";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("Should throw exception on reset a non-exist partition");
  }
 catch (  Exception e) {
  }
  errPartitions.remove("SLAVE-MASTER");
  participants[0].setTransition(new ErrTransitionWithResetCnt(errPartitions));
  clearStatusUpdate(clusterName,"localhost_12918","TestDB0","TestDB0_4");
  _errToOfflineInvoked=0;
  String command="--zkSvr " + _zkaddr + " --resetPartition "+ clusterName+ " localhost_12918 TestDB0 TestDB0_4";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Thread.sleep(200);
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("Should throw exception on reset a partition not in ERROR state");
  }
 catch (  Exception e) {
  }
  errStateMap.get("TestDB0").remove("TestDB0_4");
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  Assert.assertEquals(_errToOfflineInvoked,1);
  participants[0].setTransition(new ErrTransitionWithResetCnt(null));
  clearStatusUpdate(clusterName,"localhost_12918","TestDB0","TestDB0_8");
  command="--zkSvr " + _zkaddr + " --resetPartition "+ clusterName+ " localhost_12918 TestDB0 TestDB0_8";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result,"Cluster verification fails");
  Assert.assertEquals(_errToOfflineInvoked,2,"Should reset 2 partitions");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSchedulerMessage </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSchedulerMsgContraints() throws JsonGenerationException, JsonMappingException, IOException, InterruptedException {
  TestMessagingHandlerFactoryLatch factory=new TestMessagingHandlerFactoryLatch();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsgContraints");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("SentMessageCount")) {
      Assert.assertEquals(statusUpdate.getMapFields().get("SentMessageCount").get("MessageCount"),"" + (_PARTITIONS * 3));
      break;
    }
  }
  for (int i=0; i < _PARTITIONS * 3 / 5; i++) {
    for (int j=0; j < 10; j++) {
      Thread.sleep(300);
      if (factory._messageCount == 5 * (i + 1))       break;
    }
    Thread.sleep(300);
    Assert.assertEquals(factory._messageCount,5 * (i + 1));
    factory.signal();
  }
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
  int messageResultCount=0;
  for (  String key : statusUpdate.getMapFields().keySet()) {
    if (key.startsWith("MessageResult ")) {
      messageResultCount++;
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  manager.getClusterManagmentTool().removeConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsgUsingQueue() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg3() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg3");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  for (int i=0; i < 4; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
    Builder keyBuilder=helixDataAccessor.keyBuilder();
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
    boolean success=false;
    for (int j=0; j < 6; j++) {
      int count=0;
      for (      Set<String> val : _factory._results.values()) {
        count+=val.size();
      }
      success=count == _PARTITIONS * 3 / 5 * (i + 1);
      if (success) {
        break;
      }
      Thread.sleep(500);
    }
    Assert.assertTrue(success);
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg2() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg2");
  MockAsyncCallback callback=new MockAsyncCallback();
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  for (int i=0; i < 10; i++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
  int messageResultCount=0;
  for (  String key : statusUpdate.getMapFields().keySet()) {
    if (key.startsWith("MessageResult ")) {
      messageResultCount++;
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    Thread.sleep(1000);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
        Assert.assertTrue(statusUpdate.getMapField(key).size() > 1);
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  String controllerStatusPath=HelixUtil.getControllerPropertyPath(manager.getClusterName(),PropertyType.STATUSUPDATES_CONTROLLER);
  List<String> subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
  }
  String instanceStatusPath=HelixUtil.getInstancePropertyPath(manager.getClusterName(),"localhost_" + (START_PORT),PropertyType.STATUSUPDATES);
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() > 0);
    }
  }
  Thread.sleep(3000);
  ZKPathDataDumpTask dumpTask=new ZKPathDataDumpTask(manager,0L,0L,Integer.MAX_VALUE);
  dumpTask.run();
  subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() == 0);
  }
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() == 0);
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg4() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msgTemplate=new Message(_factory.getMessageType(),"Template");
  msgTemplate.setTgtSessionId("*");
  msgTemplate.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("TestDB");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msgTemplate.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg4");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgIdPrime=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      return count(_factory) == 60;
    }
  }
,10 * 1000);
  Assert.assertTrue(success,"If not specifying participant, controller will send 60 messages");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  ArrayList<String> msgIds=new ArrayList<String>();
  for (int i=0; i < NODE_NR; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    Thread.sleep(5000);
    System.err.println("count: " + count(_factory));
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    msgIds.add(msgId);
  }
  for (int i=0; i < NODE_NR; i++) {
    String msgId=msgIds.get(i);
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    if (messageResultCount != _PARTITIONS * 3 / 5) {
      int x=10;
      x=x + messageResultCount;
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
  }
  for (int j=0; j < 100; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgIdPrime);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3 * 2);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerZeroMsg() throws Exception {
  TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_DOESNOTEXIST");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  PropertyKey controllerMessageKey=keyBuilder.controllerMessage(schedulerMessage.getMsgId());
  helixDataAccessor.setProperty(controllerMessageKey,schedulerMessage);
  Thread.sleep(3000);
  Assert.assertEquals(0,factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  for (int i=0; i < 10; i++) {
    StatusUpdate update=helixDataAccessor.getProperty(controllerTaskStatus);
    if (update == null || update.getRecord().getMapField("SentMessageCount") == null) {
      Thread.sleep(1000);
    }
  }
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("0"));
  int count=0;
  for (  Set<String> val : factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSchemataSM </h4><pre class="type-4 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSchemataSM() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  MockParticipant[] participants=new MockParticipant[n];
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestSchemata",1,1,n,0,"STORAGE_DEFAULT_SM_SCHEMATA",false);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  PropertyKey key=keyBuilder.idealStates("TestSchemata0");
  IdealState idealState=accessor.getProperty(key);
  idealState.setReplicas(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString());
  idealState.getRecord().setListField("TestSchemata0_0",Arrays.asList(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString()));
  accessor.setProperty(key,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  for (int i=1; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  participants[0]=new MockParticipant(_zkaddr,clusterName,"localhost_12918");
  participants[0].syncStart();
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  key=keyBuilder.externalView("TestSchemata0");
  ExternalView externalView=accessor.getProperty(key);
  Map<String,String> stateMap=externalView.getStateMap("TestSchemata0_0");
  Assert.assertNotNull(stateMap);
  Assert.assertEquals(stateMap.size(),n,"all " + n + " participants should be in Master state");
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    Assert.assertNotNull(stateMap.get(instanceName));
    Assert.assertEquals(stateMap.get(instanceName),"MASTER");
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSharedConnection </h4><pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Ensure that only one controller with a shared connection thinks it's leader
 */
@Test public void testSharedControllerConnection() throws Exception {
  final int NUM_PARTICIPANTS=2;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  final int NUM_CONTROLLERS=2;
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"OnlineOffline",RebalanceMode.CUSTOMIZED,true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  HelixController[] controllers=new HelixController[NUM_CONTROLLERS];
  for (int i=0; i < NUM_CONTROLLERS; i++) {
    controllers[i]=connection.createController(ClusterId.from(clusterName),ControllerId.from("controller_" + i));
    controllers[i].start();
  }
  Thread.sleep(1000);
  int leaderCount=0;
  for (  HelixController controller : controllers) {
    HelixManager adaptor=new ZKHelixManager(controller);
    boolean result=ZkHelixLeaderElection.tryUpdateController(adaptor);
    if (result) {
      leaderCount++;
    }
  }
  Assert.assertEquals(leaderCount,1);
  for (  HelixController controller : controllers) {
    controller.stop();
  }
  HelixAdmin admin=connection.createClusterManagementTool();
  admin.dropCluster(clusterName);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestStartMultipleControllersWithSameName </h4><pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=3;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,1,"OnlineOffline",RebalanceMode.FULL_AUTO,true);
  MockController[] controllers=new MockController[4];
  for (int i=0; i < 4; i++) {
    controllers[i]=new MockController(_zkaddr,clusterName,"controller_0");
    controllers[i].syncStart();
  }
  Thread.sleep(500);
  String liPath=PropertyPathConfig.getPath(PropertyType.LIVEINSTANCES,clusterName);
  int listenerNb=ZkTestHelper.numberOfListeners(_zkaddr,liPath);
  Assert.assertEquals(listenerNb,1,"Only one controller should succeed in becoming leader");
  for (int i=0; i < 4; i++) {
    controllers[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestStateTransitionTimeout </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStateTransitionTimeOut() throws Exception {
  Map<String,SleepStateModelFactory> factories=new HashMap<String,SleepStateModelFactory>();
  IdealState idealState=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,TEST_DB);
  for (int i=0; i < NODE_NR; i++) {
    String instanceName="localhost_" + (START_PORT + i);
    SleepStateModelFactory factory=new SleepStateModelFactory(1000);
    factories.put(instanceName,factory);
    for (    PartitionId p : idealState.getPartitionIdSet()) {
      if (idealState.getPreferenceList(p).get(0).equals(ParticipantId.from(instanceName))) {
        factory.addPartition(p);
      }
    }
    _participants[i]=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName);
    _participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("MasterSlave"),factory);
    _participants[i].syncStart();
  }
  String controllerName="controller_0";
  _controller=new MockController(_zkaddr,CLUSTER_NAME,controllerName);
  _controller.syncStart();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=_participants[0].getHelixDataAccessor();
  Builder kb=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(kb.externalView(TEST_DB));
  for (  PartitionId p : idealState.getPartitionIdSet()) {
    ParticipantId idealMaster=idealState.getPreferenceList(p).get(0);
    Assert.assertTrue(ev.getStateMap(p).get(idealMaster).equals(State.from("ERROR")));
    TimeOutStateModel model=factories.get(idealMaster.stringify()).getTransitionHandler(ResourceId.from(TEST_DB),p);
    Assert.assertEquals(model._errorCallcount,1);
    Assert.assertEquals(model._error.getCode(),ErrorCode.TIMEOUT);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSwapInstance </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestSwap() throws Exception {
  HelixManager manager=_controller;
  HelixDataAccessor helixAccessor=manager.getHelixDataAccessor();
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB",_replica);
  ZNRecord idealStateOld1=new ZNRecord("TestDB");
  ZNRecord idealStateOld2=new ZNRecord("MyDB");
  IdealState is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  idealStateOld1.merge(is1.getRecord());
  IdealState is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  idealStateOld2.merge(is2.getRecord());
  String instanceName="localhost_" + (START_PORT + 0);
  _setupTool.getClusterManagementTool().enableInstance(CLUSTER_NAME,instanceName,false);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  String instanceName2="localhost_" + (START_PORT + 444);
  _setupTool.addInstanceToCluster(CLUSTER_NAME,instanceName2);
  boolean exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    exception=true;
  }
  Assert.assertTrue(exception);
  _participants[0].syncStop();
  Thread.sleep(1000);
  exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    e.printStackTrace();
    exception=true;
  }
  Assert.assertFalse(exception);
  MockParticipant newParticipant=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName2);
  newParticipant.syncStart();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  for (  String key : idealStateOld1.getMapFields().keySet()) {
    for (    String host : idealStateOld1.getMapField(key).keySet()) {
      if (host.equals(instanceName)) {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(instanceName).equals(is1.getRecord().getMapField(key).get(instanceName2)));
      }
 else {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(host).equals(is1.getRecord().getMapField(key).get(host)));
      }
    }
  }
  for (  String key : idealStateOld1.getListFields().keySet()) {
    Assert.assertEquals(idealStateOld1.getListField(key).size(),is1.getRecord().getListField(key).size());
    for (int i=0; i < idealStateOld1.getListField(key).size(); i++) {
      String host=idealStateOld1.getListField(key).get(i);
      String newHost=is1.getRecord().getListField(key).get(i);
      if (host.equals(instanceName)) {
        Assert.assertTrue(newHost.equals(instanceName2));
      }
 else {
        Assert.assertTrue(host.equals(newHost));
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestUserDefRebalancerCompatibility </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomizedIdealStateRebalancer() throws InterruptedException {
  _setupTool.addResourceToCluster(CLUSTER_NAME,db2,60,"MasterSlave");
  _setupTool.addResourceProperty(CLUSTER_NAME,db2,IdealStateProperty.REBALANCER_CLASS_NAME.toString(),TestUserDefRebalancerCompatibility.TestRebalancer.class.getName());
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,db2,3);
  try {
    boolean result=ClusterStateVerifier.verifyByZkCallback(new TestCustomizedIdealStateRebalancer.ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,db2));
    Assert.assertTrue(result);
    Thread.sleep(1000);
    HelixDataAccessor accessor=new ZKHelixDataAccessor(CLUSTER_NAME,_baseAccessor);
    Builder keyBuilder=accessor.keyBuilder();
    ExternalView ev=accessor.getProperty(keyBuilder.externalView(db2));
    Assert.assertEquals(ev.getPartitionSet().size(),60);
    for (    String partition : ev.getPartitionSet()) {
      Assert.assertEquals(ev.getStateMap(partition).size(),1);
    }
    IdealState is=accessor.getProperty(keyBuilder.idealStates(db2));
    for (    PartitionId partition : is.getPartitionIdSet()) {
      Assert.assertEquals(is.getPreferenceList(partition).size(),3);
      Assert.assertEquals(is.getParticipantStateMap(partition).size(),3);
    }
    Assert.assertTrue(testRebalancerCreated);
    Assert.assertTrue(testRebalancerInvoked);
  }
  finally {
    _setupTool.dropResourceFromCluster(CLUSTER_NAME,db2);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestZkCallbackHandlerLeak </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCbHandlerLeakOnControllerSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  final MockParticipant participantManager=participants[0];
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      int controllerHandlerNb=controller.getHandlers().size();
      int particHandlerNb=participantManager.getHandlers().size();
      if (controllerHandlerNb == 10 && particHandlerNb == 2)       return true;
 else       return false;
    }
  }
,1000);
  int controllerHandlerNb=controller.getHandlers().size();
  int particHandlerNb=participantManager.getHandlers().size();
  TestHelper.printHandlers(controller,controller.getHandlers());
  Assert.assertEquals(controllerHandlerNb,12,"HelixController should have 12 (6+2n) callback handlers for 2 participant, but was " + controllerHandlerNb);
  TestHelper.printHandlers(participantManager,participantManager.getHandlers());
  Assert.assertEquals(particHandlerNb,1,"HelixParticipant should have 1 (msg->HelixTaskExecutor) callback handler, but was " + particHandlerNb);
  System.out.println("Expiring controller session...");
  String oldSessionId=controller.getSessionId();
  ZkTestHelper.expireSession(controller.getZkClient());
  String newSessionId=controller.getSessionId();
  System.out.println("Expired controller session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers after session expiry.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManager.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher after session expiry.");
  int handlerNb=controller.getHandlers().size();
  TestHelper.printHandlers(controller,controller.getHandlers());
  Assert.assertTrue(handlerNb <= controllerHandlerNb,"controller callback handlers should not increase after participant session expiry (expected no more than " + controllerHandlerNb + ", found "+ handlerNb+ ")");
  handlerNb=participantManager.getHandlers().size();
  TestHelper.printHandlers(participantManager,participantManager.getHandlers());
  Assert.assertEquals(handlerNb,particHandlerNb,"participant callback handlers should not increase after participant session expiry");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCbHandlerLeakOnParticipantSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  final MockParticipant participantManagerToExpire=participants[1];
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManagerToExpire.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher. MESSAGES->HelixTaskExecutor");
  TestHelper.printHandlers(controller,controller.getHandlers());
  TestHelper.printHandlers(participantManagerToExpire,participantManagerToExpire.getHandlers());
  int controllerHandlerNb=controller.getHandlers().size();
  int particHandlerNb=participantManagerToExpire.getHandlers().size();
  Assert.assertEquals(controllerHandlerNb,12,"HelixController should have 10 (8+2n) callback handlers for 2 (n) participant");
  Assert.assertEquals(particHandlerNb,1,"HelixParticipant should have 1 (msg->HelixTaskExecutor) callback handlers");
  System.out.println("Expiring participant session...");
  String oldSessionId=participantManagerToExpire.getSessionId();
  ZkTestHelper.expireSession(participantManagerToExpire.getZkClient());
  String newSessionId=participantManagerToExpire.getSessionId();
  System.out.println("Expried participant session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers after session expiry.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManagerToExpire.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher after session expiry.");
  int handlerNb=controller.getHandlers().size();
  Assert.assertEquals(handlerNb,controllerHandlerNb,"controller callback handlers should not increase after participant session expiry");
  handlerNb=participantManagerToExpire.getHandlers().size();
  Assert.assertEquals(handlerNb,particHandlerNb,"participant callback handlers should not increase after participant session expiry");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRemoveUserCbHandlerOnPathRemoval() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=3;
  final String zkAddr=_zkaddr;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,zkAddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(zkAddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(zkAddr,clusterName,instanceName);
    participants[i].syncStart();
    if (i == 0) {
      MockParticipant manager=participants[0];
      manager.addCurrentStateChangeListener(new CurrentStateChangeListener(){
        @Override public void onStateChange(        String instanceName,        List<CurrentState> statesInfo,        NotificationContext changeContext){
        }
      }
,manager.getInstanceName(),manager.getSessionId());
    }
  }
  Boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(zkAddr,clusterName));
  Assert.assertTrue(result);
  MockParticipant participantToExpire=participants[0];
  String oldSessionId=participantToExpire.getSessionId();
  PropertyKey.Builder keyBuilder=new PropertyKey.Builder(clusterName);
  Assert.assertEquals(participantToExpire.getHandlers().size(),2,"Should have 2 handlers: CURRENTSTATE/{sessionId}, and MESSAGES");
  Map<String,Set<IZkDataListener>> dataListeners=ZkTestHelper.getZkDataListener(participantToExpire.getZkClient());
  Map<String,Set<IZkChildListener>> childListeners=ZkTestHelper.getZkChildListener(participantToExpire.getZkClient());
  Assert.assertEquals(dataListeners.size(),1,"Should have 1 path (CURRENTSTATE/{sessionId}/TestDB0) which has 1 data-listeners");
  String path=keyBuilder.currentState(participantToExpire.getInstanceName(),oldSessionId,"TestDB0").getPath();
  Assert.assertEquals(dataListeners.get(path).size(),1,"Should have 1 data-listeners on path: " + path);
  Assert.assertEquals(childListeners.size(),2,"Should have 2 paths (CURRENTSTATE/{sessionId}, and MESSAGES) each of which has 1 child-listener");
  path=keyBuilder.currentStates(participantToExpire.getInstanceName(),oldSessionId).getPath();
  Assert.assertEquals(childListeners.get(path).size(),1,"Should have 1 child-listener on path: " + path);
  path=keyBuilder.messages(participantToExpire.getInstanceName()).getPath();
  Assert.assertEquals(childListeners.get(path).size(),1,"Should have 1 child-listener on path: " + path);
  path=keyBuilder.controller().getPath();
  Assert.assertNull(childListeners.get(path),"Should have no child-listener on path: " + path);
  Map<String,List<String>> watchPaths=ZkTestHelper.getZkWatch(participantToExpire.getZkClient());
  Assert.assertEquals(watchPaths.get("dataWatches").size(),3,"Should have 3 data-watches: CURRENTSTATE/{sessionId}, CURRENTSTATE/{sessionId}/TestDB, MESSAGES");
  Assert.assertEquals(watchPaths.get("childWatches").size(),2,"Should have 2 child-watches: MESSAGES, and CURRENTSTATE/{sessionId}");
  System.out.println("Expire participant: " + participantToExpire.getInstanceName() + ", session: "+ participantToExpire.getSessionId());
  ZkTestHelper.expireSession(participantToExpire.getZkClient());
  String newSessionId=participantToExpire.getSessionId();
  System.out.println(participantToExpire.getInstanceName() + " oldSessionId: " + oldSessionId+ ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(zkAddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertEquals(participantToExpire.getHandlers().size(),1,"Should have 1 handlers: MESSAGES. CURRENTSTATE/{sessionId} handler should be removed by CallbackHandler#handleChildChange()");
  dataListeners=ZkTestHelper.getZkDataListener(participantToExpire.getZkClient());
  childListeners=ZkTestHelper.getZkChildListener(participantToExpire.getZkClient());
  Assert.assertTrue(dataListeners.isEmpty(),"Should have no data-listeners");
  Assert.assertEquals(childListeners.size(),2,"Should have 2 paths (CURRENTSTATE/{oldSessionId}, and MESSAGES). " + "CONTROLLER and MESSAGE has 1 child-listener each. CURRENTSTATE/{oldSessionId} doesn't have listener (ZkClient doesn't remove empty childListener set. probably a ZkClient bug. see ZkClient#unsubscribeChildChange())");
  path=keyBuilder.currentStates(participantToExpire.getInstanceName(),oldSessionId).getPath();
  Assert.assertEquals(childListeners.get(path).size(),0,"Should have no child-listener on path: " + path);
  path=keyBuilder.messages(participantToExpire.getInstanceName()).getPath();
  Assert.assertEquals(childListeners.get(path).size(),1,"Should have 1 child-listener on path: " + path);
  path=keyBuilder.controller().getPath();
  Assert.assertNull(childListeners.get(path),"Should have no child-listener on path: " + path);
  watchPaths=ZkTestHelper.getZkWatch(participantToExpire.getZkClient());
  Assert.assertEquals(watchPaths.get("dataWatches").size(),1,"Should have 1 data-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("childWatches").size(),1,"Should have 1 child-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("existWatches").size(),2,"Should have 2 exist-watches: CURRENTSTATE/{oldSessionId} and CURRENTSTATE/{oldSessionId}/TestDB0");
  System.out.println("Expire participant: " + participantToExpire.getInstanceName() + ", session: "+ participantToExpire.getSessionId());
  ZkTestHelper.expireSession(participantToExpire.getZkClient());
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(zkAddr,clusterName));
  Assert.assertTrue(result);
  watchPaths=ZkTestHelper.getZkWatch(participantToExpire.getZkClient());
  Assert.assertEquals(watchPaths.get("dataWatches").size(),1,"Should have 1 data-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("childWatches").size(),1,"Should have 1 child-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("existWatches").size(),0,"Should have no exist-watches. exist-watches on CURRENTSTATE/{oldSessionId} and CURRENTSTATE/{oldSessionId}/TestDB0 should be cleared during handleNewSession");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestConsecutiveZkSessionExpiry </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiClusterController() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  MockMultiClusterController[] multiClusterControllers=new MockMultiClusterController[n];
  CountDownLatch startCountdown=new CountDownLatch(1);
  CountDownLatch endCountdown=new CountDownLatch(1);
  for (int i=0; i < n; i++) {
    String contrllerName="localhost_" + (12918 + i);
    multiClusterControllers[i]=new MockMultiClusterController(_zkaddr,clusterName,contrllerName);
    multiClusterControllers[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
    if (i == 0) {
      multiClusterControllers[i].addPreConnectCallback(new PreConnectTestCallback(contrllerName,startCountdown,endCountdown));
    }
    multiClusterControllers[i].connect();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  LOG.info("1st Expiring multiClusterController session...");
  String oldSessionId=multiClusterControllers[0].getSessionId();
  ZkTestHelper.asyncExpireSession(multiClusterControllers[0].getZkClient());
  String newSessionId=multiClusterControllers[0].getSessionId();
  LOG.info("Expried multiClusterController session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  startCountdown.await();
  LOG.info("2nd Expiring multiClusterController session...");
  oldSessionId=multiClusterControllers[0].getSessionId();
  ZkTestHelper.asyncExpireSession(multiClusterControllers[0].getZkClient());
  newSessionId=multiClusterControllers[0].getSessionId();
  LOG.info("Expried multiClusterController session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  endCountdown.countDown();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNotNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12918"),true));
  LiveInstance leader=HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.controllerLeader(),true);
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getId(),"localhost_12919");
  TestHelper.printHandlers(multiClusterControllers[0],multiClusterControllers[0].getHandlers());
  List<ZkCallbackHandler> handlers=multiClusterControllers[0].getHandlers();
  Assert.assertEquals(handlers.size(),2,"MultiCluster controller should have 2 handler (message and leader election) after lose leadership, but was " + handlers.size());
  multiClusterControllers[0].disconnect();
  multiClusterControllers[1].disconnect();
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12918"),false));
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12919"),false));
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.controllerLeader(),false));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestControllerManager </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleControllersOfSameName() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,16,n,3,"MasterSlave",true);
  int m=3;
  MockController[] controllers=new MockController[m];
  for (int i=0; i < m; i++) {
    controllers[i]=new MockController(_zkaddr,clusterName,"controller");
    controllers[i].syncStart();
  }
  int leaderCnt=0;
  for (int i=0; i < m; i++) {
    if (controllers[i].isLeader()) {
      leaderCnt++;
    }
  }
  Assert.assertEquals(leaderCnt,1,"Should have only 1 leader but was " + leaderCnt);
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (int i=0; i < m; i++) {
    controllers[i].syncStop();
  }
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestHelixMultiClusterController </h4><pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void simpleIntegrationTest() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  HelixManager[] multiClusterControllers=new HelixManager[n];
  for (int i=0; i < n; i++) {
    int port=12918 + i;
    multiClusterControllers[i]=new ZKHelixManager(clusterName,"localhost_" + port,InstanceType.CONTROLLER_PARTICIPANT,_zkaddr);
    multiClusterControllers[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
    multiClusterControllers[i].connect();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  multiClusterControllers[0].disconnect();
  Thread.sleep(100);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance("localhost_12918")));
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getId(),"localhost_12919");
  multiClusterControllers[1].disconnect();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance("localhost_12919")));
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestIndependentTaskRebalancer </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReassignment() throws Exception {
  final int NUM_INSTANCES=2;
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(2);
  Map<String,String> taskConfigMap=Maps.newHashMap(ImmutableMap.of("fail","" + true,"failInstance","localhost_" + START_PORT));
  TaskConfig taskConfig1=new TaskConfig("TaskOne",taskConfigMap,false);
  taskConfigs.add(taskConfig1);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  workflowBuilder.addConfig(jobName,JobConfig.MAX_FORCED_REASSIGNMENTS_PER_TASK,"" + (NUM_INSTANCES - 1));
  Map<String,String> jobConfigMap=Maps.newHashMap();
  jobConfigMap.put("Timeout","1000");
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Assert.assertTrue(_invokedClasses.contains(TaskOne.class.getName()));
  Assert.assertEquals(_runCounts.size(),NUM_INSTANCES);
  Assert.assertTrue(_runCounts.values().contains(JobConfig.DEFAULT_MAX_ATTEMPTS_PER_TASK / NUM_INSTANCES));
  Assert.assertTrue(_runCounts.values().contains(1));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDelayedRetry() throws Exception {
  int delay=3000;
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(1);
  Map<String,String> taskConfigMap=Maps.newHashMap();
  TaskConfig taskConfig1=new TaskConfig("SingleFailTask",taskConfigMap,false);
  taskConfigs.add(taskConfig1);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  workflowBuilder.addConfig(jobName,JobConfig.TASK_RETRY_DELAY,String.valueOf(delay));
  Map<String,String> jobConfigMap=Maps.newHashMap();
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  SingleFailTask.hasFailed=false;
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  JobContext jobCtx=TaskUtil.getJobContext(_manager,jobName + "_" + jobName);
  Assert.assertEquals(jobCtx.getPartitionNumAttempts(0),2);
  Assert.assertTrue(jobCtx.getFinishTime() - jobCtx.getStartTime() >= delay);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestTaskRebalancer </h4><pre class="type-7 type-1 type-8 type-11 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpiry() throws Exception {
  String jobName="Expiry";
  long expiry=1000;
  Map<String,String> commandConfig=ImmutableMap.of(TIMEOUT_CONFIG,String.valueOf(100));
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobName,commandConfig).setExpiry(expiry).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  HelixDataAccessor accessor=_manager.getHelixDataAccessor();
  PropertyKey workflowCfgKey=accessor.keyBuilder().resourceConfig(jobName);
  String workflowPropStoreKey=Joiner.on("/").join(TaskConstants.REBALANCER_CONTEXT_ROOT,jobName);
  Assert.assertTrue(_manager.getHelixPropertyStore().exists(workflowPropStoreKey,AccessOption.PERSISTENT));
  Assert.assertNotSame(accessor.getProperty(workflowCfgKey),null);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Thread.sleep(expiry);
  _driver.invokeRebalance();
  Thread.sleep(expiry);
  Assert.assertFalse(_manager.getHelixPropertyStore().exists(workflowPropStoreKey,AccessOption.PERSISTENT));
  Assert.assertEquals(accessor.getProperty(workflowCfgKey),null);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void timeouts() throws Exception {
  final String jobResource="timeouts";
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobResource,WorkflowGenerator.DEFAULT_COMMAND_CONFIG,JobConfig.MAX_ATTEMPTS_PER_TASK,String.valueOf(2),JobConfig.TIMEOUT_PER_TASK,String.valueOf(100)).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobResource,TaskState.FAILED);
  JobContext ctx=TaskUtil.getJobContext(_manager,TaskUtil.getNamespacedJobName(jobResource));
  int maxAttempts=0;
  for (int i=0; i < NUM_PARTITIONS; i++) {
    TaskPartitionState state=ctx.getPartitionState(i);
    if (state != null) {
      Assert.assertEquals(state,TaskPartitionState.TIMED_OUT);
      maxAttempts=Math.max(maxAttempts,ctx.getPartitionNumAttempts(i));
    }
  }
  Assert.assertEquals(maxAttempts,2);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void partitionSet() throws Exception {
  final String jobResource="partitionSet";
  ImmutableList<String> targetPartitions=ImmutableList.of("TestDB_1","TestDB_2","TestDB_3","TestDB_5","TestDB_8","TestDB_13");
  Map<String,String> commandConfig=ImmutableMap.of(TIMEOUT_CONFIG,String.valueOf(100));
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobResource,commandConfig,JobConfig.MAX_ATTEMPTS_PER_TASK,String.valueOf(1),JobConfig.TARGET_PARTITIONS,Joiner.on(",").join(targetPartitions)).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobResource,TaskState.COMPLETED);
  String namespacedName=TaskUtil.getNamespacedJobName(jobResource);
  JobContext ctx=TaskUtil.getJobContext(_manager,namespacedName);
  WorkflowContext workflowContext=TaskUtil.getWorkflowContext(_manager,jobResource);
  Assert.assertNotNull(ctx);
  Assert.assertNotNull(workflowContext);
  Assert.assertEquals(workflowContext.getJobState(namespacedName),TaskState.COMPLETED);
  for (  String pName : targetPartitions) {
    int i=ctx.getPartitionsByTarget().get(pName).get(0);
    Assert.assertEquals(ctx.getPartitionState(i),TaskPartitionState.COMPLETED);
    Assert.assertEquals(ctx.getPartitionNumAttempts(i),1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.ipc.TestNettyHelixIPCService </h4><pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMessageManager() throws Exception {
  final int numMessages=1000;
  final int messageType=1;
  final int ackMessageType=2;
  final HelixIPCService firstIPC=new NettyHelixIPCService(new NettyHelixIPCService.Config().setInstanceName(firstNode.getInstanceName()).setPort(firstPort));
  firstIPC.registerCallback(messageType,new HelixIPCCallback(){
    final Random random=new Random();
    @Override public void onMessage(    HelixMessageScope scope,    UUID messageId,    ByteBuf message){
      if (random.nextInt() % 2 == 0) {
        HelixAddress sender=firstResolver.getSource(scope);
        firstIPC.send(sender,ackMessageType,messageId,null);
      }
    }
  }
);
  firstIPC.start();
  final HelixIPCService secondIPC=new NettyHelixIPCService(new NettyHelixIPCService.Config().setInstanceName(secondNode.getInstanceName()).setPort(secondPort));
  secondIPC.registerCallback(messageType,new HelixIPCCallback(){
    final Random random=new Random();
    @Override public void onMessage(    HelixMessageScope scope,    UUID messageId,    ByteBuf message){
      if (random.nextInt() % 2 == 0) {
        HelixAddress sender=secondResolver.getSource(scope);
        secondIPC.send(sender,ackMessageType,messageId,null);
      }
    }
  }
);
  secondIPC.start();
  Thread.sleep(500);
  final AtomicInteger numAcks=new AtomicInteger();
  final AtomicInteger numErrors=new AtomicInteger();
  HelixIPCService messageManager=new HelixIPCMessageManager(Executors.newSingleThreadScheduledExecutor(),firstIPC,300,-1);
  messageManager.registerCallback(ackMessageType,new HelixIPCCallback(){
    @Override public void onMessage(    HelixMessageScope scope,    UUID messageId,    ByteBuf message){
      numAcks.incrementAndGet();
    }
  }
);
  messageManager.start();
  String secondName="localhost_" + secondPort;
  Set<String> secondPartitions=new HashSet<String>();
  IdealState idealState=controller.getClusterManagmentTool().getResourceIdealState(CLUSTER_NAME,RESOURCE_NAME);
  for (  String partitionName : idealState.getPartitionSet()) {
    for (    Map.Entry<String,String> stateEntry : idealState.getInstanceStateMap(partitionName).entrySet()) {
      if (stateEntry.getKey().equals(secondName)) {
        secondPartitions.add(partitionName);
      }
    }
  }
  for (  String partitionName : secondPartitions) {
    for (int i=0; i < numMessages; i++) {
      HelixMessageScope scope=new HelixMessageScope.Builder().cluster(firstNode.getClusterName()).resource(RESOURCE_NAME).partition(partitionName).state("ONLINE").build();
      Set<HelixAddress> destinations=firstResolver.getDestinations(scope);
      for (      HelixAddress destination : destinations) {
        ByteBuf message=Unpooled.wrappedBuffer(("Hello" + i).getBytes());
        messageManager.send(destination,messageType,UUID.randomUUID(),message);
      }
    }
  }
  Thread.sleep(5000);
  Assert.assertEquals(numAcks.get() + numErrors.get(),numMessages * secondPartitions.size());
  messageManager.shutdown();
  firstIPC.shutdown();
  secondIPC.shutdown();
}

</code></pre>

<br>
<pre class="type-7 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testService() throws Exception {
  final int numMessages=1000;
  final int messageType=1;
  final ConcurrentMap<String,AtomicInteger> firstCounts=new ConcurrentHashMap<String,AtomicInteger>();
  final HelixIPCService firstIPC=new NettyHelixIPCService(new NettyHelixIPCService.Config().setInstanceName(firstNode.getInstanceName()).setPort(firstPort));
  firstIPC.registerCallback(messageType,new HelixIPCCallback(){
    @Override public void onMessage(    HelixMessageScope scope,    UUID messageId,    ByteBuf message){
      String key=scope.getPartition() + ":" + scope.getState();
      firstCounts.putIfAbsent(key,new AtomicInteger());
      firstCounts.get(key).incrementAndGet();
    }
  }
);
  firstIPC.start();
  final ConcurrentMap<String,AtomicInteger> secondCounts=new ConcurrentHashMap<String,AtomicInteger>();
  final HelixIPCService secondIPC=new NettyHelixIPCService(new NettyHelixIPCService.Config().setInstanceName(secondNode.getInstanceName()).setPort(secondPort));
  secondIPC.registerCallback(messageType,new HelixIPCCallback(){
    @Override public void onMessage(    HelixMessageScope scope,    UUID messageId,    ByteBuf message){
      String key=scope.getPartition() + ":" + scope.getState();
      secondCounts.putIfAbsent(key,new AtomicInteger());
      secondCounts.get(key).incrementAndGet();
    }
  }
);
  secondIPC.start();
  Thread.sleep(500);
  String secondName="localhost_" + secondPort;
  Set<String> secondPartitions=new HashSet<String>();
  IdealState idealState=controller.getClusterManagmentTool().getResourceIdealState(CLUSTER_NAME,RESOURCE_NAME);
  for (  String partitionName : idealState.getPartitionSet()) {
    for (    Map.Entry<String,String> stateEntry : idealState.getInstanceStateMap(partitionName).entrySet()) {
      if (stateEntry.getKey().equals(secondName)) {
        secondPartitions.add(partitionName);
      }
    }
  }
  for (  String partitionName : secondPartitions) {
    for (int i=0; i < numMessages; i++) {
      HelixMessageScope scope=new HelixMessageScope.Builder().cluster(firstNode.getClusterName()).resource(RESOURCE_NAME).partition(partitionName).state("ONLINE").build();
      Set<HelixAddress> destinations=firstResolver.getDestinations(scope);
      for (      HelixAddress destination : destinations) {
        ByteBuf message=Unpooled.wrappedBuffer(("Hello" + i).getBytes());
        firstIPC.send(destination,messageType,UUID.randomUUID(),message);
      }
    }
  }
  for (  String partitionName : secondPartitions) {
    for (int i=0; i < numMessages; i++) {
      HelixMessageScope scope=new HelixMessageScope.Builder().cluster(secondNode.getClusterName()).resource(RESOURCE_NAME).partition(partitionName).state("ONLINE").build();
      Set<HelixAddress> destinations=secondResolver.getDestinations(scope);
      for (      HelixAddress destination : destinations) {
        ByteBuf message=Unpooled.wrappedBuffer(("Hello" + i).getBytes());
        secondIPC.send(destination,messageType,UUID.randomUUID(),message);
      }
    }
  }
  Thread.sleep(500);
  for (  String partitionName : secondPartitions) {
    AtomicInteger count=secondCounts.get(partitionName + ":ONLINE");
    Assert.assertNotNull(count);
    Assert.assertEquals(count.get(),2 * numMessages);
  }
  firstIPC.shutdown();
  secondIPC.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.lock.zk.TestZKHelixLock </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void basicTest() throws InterruptedException {
  final long TIMEOUT=30000;
  final long RETRY_INTERVAL=100;
  _zkclient.waitUntilConnected(TIMEOUT,TimeUnit.MILLISECONDS);
  final AtomicBoolean t1Locked=new AtomicBoolean(false);
  final AtomicBoolean t1Done=new AtomicBoolean(false);
  final AtomicInteger field1=new AtomicInteger(0);
  final AtomicInteger field2=new AtomicInteger(1);
  final ClusterId clusterId=ClusterId.from("testCluster");
  final HelixLock lock1=new ZKHelixLock(clusterId,Scope.cluster(clusterId),_zkclient);
  final HelixLock lock2=new ZKHelixLock(clusterId,Scope.cluster(clusterId),_zkclient);
  Thread t1=new Thread(){
    @Override public void run(){
      lock1.lock();
synchronized (t1Locked) {
        t1Locked.set(true);
        t1Locked.notify();
      }
      yield();
      field1.set(1);
      field2.set(1);
synchronized (t1Done) {
        t1Done.set(true);
        t1Done.notify();
      }
    }
  }
;
  Thread t2=new Thread(){
    @Override public void run(){
synchronized (t1Locked) {
        while (!t1Locked.get()) {
          try {
            t1Locked.wait();
          }
 catch (          InterruptedException e) {
          }
        }
      }
      lock2.lock();
      field1.set(2);
      field2.set(2);
    }
  }
;
  t1.setPriority(Thread.MIN_PRIORITY);
  t2.setPriority(Thread.MAX_PRIORITY);
  t1.start();
  t2.start();
synchronized (t1Done) {
    while (!t1Done.get()) {
      try {
        t1Done.wait();
      }
 catch (      InterruptedException e) {
      }
    }
  }
  Assert.assertEquals(field1.get(),1);
  Assert.assertEquals(field2.get(),1);
  long count=0;
  while (!lock2.isBlocked()) {
    if (count > TIMEOUT) {
      break;
    }
    Thread.sleep(RETRY_INTERVAL);
    count+=RETRY_INTERVAL;
  }
  Assert.assertTrue(lock2.isBlocked());
  lock1.unlock();
  try {
    t2.join(10000);
    Assert.assertEquals(field1.get(),2);
    Assert.assertEquals(field2.get(),2);
  }
 catch (  InterruptedException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestLiveInstanceBounce </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceBounce() throws Exception {
  int handlerSize=_controller.getHandlers().size();
  for (int i=0; i < 2; i++) {
    String instanceName="localhost_" + (START_PORT + i);
    _participants[i].syncStop();
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    _participants[i]=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName);
    _participants[i].syncStart();
    Thread.sleep(100);
  }
  Thread.sleep(4000);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME),50 * 1000);
  Assert.assertTrue(result);
  for (int j=0; j < 10; j++) {
    if (_controller.getHandlers().size() == (handlerSize)) {
      break;
    }
    Thread.sleep(400);
  }
  Assert.assertEquals(_controller.getHandlers().size(),handlerSize);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateFailZkCacheBaseAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,Arrays.asList(curStatePath,extViewPath),null);
  Assert.assertEquals(accessor._wtCache._cache.size(),1,"Should contain only:\n" + curStatePath);
  Assert.assertTrue(accessor._wtCache._cache.containsKey(curStatePath));
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertFalse(success[i],"Should fail on create: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: TestDB" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    boolean success=accessor.set(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in set: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=accessor.get(path,null,0);
    Assert.assertEquals(record.getId(),"TestDB" + i);
  }
  List<String> childNames=accessor.getChildNames(extViewPath,0);
  Assert.assertEquals(childNames.size(),10,"Should contain only: TestDB0-9");
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(childNames.contains("TestDB" + i));
  }
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    Assert.assertTrue(accessor.exists(path,0));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZKLiveInstanceData </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDataChange() throws Exception {
  HelixManager adminManager=HelixManagerFactory.getZKHelixManager(clusterName,null,InstanceType.ADMINISTRATOR,_zkaddr);
  adminManager.connect();
  final BlockingQueue<List<LiveInstance>> changeList=new LinkedBlockingQueue<List<LiveInstance>>();
  adminManager.addLiveInstanceChangeListener(new LiveInstanceChangeListener(){
    @Override public void onLiveInstanceChange(    List<LiveInstance> liveInstances,    NotificationContext changeContext){
      changeList.add(deepCopy(liveInstances));
    }
  }
);
  List<LiveInstance> instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertTrue(instances.isEmpty(),"Expecting an empty list of live instance");
  HelixManager manager=HelixManagerFactory.getZKHelixManager(clusterName,"localhost_54321",InstanceType.PARTICIPANT,_zkaddr);
  manager.connect();
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertEquals(instances.size(),1,"Expecting one live instance");
  Assert.assertEquals(instances.get(0).getInstanceName(),manager.getInstanceName());
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  PropertyKey propertyKey=helixDataAccessor.keyBuilder().liveInstance(manager.getInstanceName());
  LiveInstance instance=helixDataAccessor.getProperty(propertyKey);
  Map<String,String> map=new TreeMap<String,String>();
  map.put("k1","v1");
  instance.getRecord().setMapField("test",map);
  Assert.assertTrue(helixDataAccessor.updateProperty(propertyKey,instance),"Failed to update live instance node");
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertEquals(instances.get(0).getRecord().getMapField("test"),map,"Wrong map data.");
  manager.disconnect();
  Thread.sleep(1000);
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertTrue(instances.isEmpty(),"Expecting an empty list of live instance");
  adminManager.disconnect();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZKUtil </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testCreateOrUpdate(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id7");
  ZNRecord record=new ZNRecord("id7");
  ZKUtil.createOrUpdate(_zkClient,path,record,true,true);
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id7",record.getId());
}

</code></pre>

<br>
<pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testCreateOrReplace(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id8");
  ZNRecord record=new ZNRecord("id8");
  ZKUtil.createOrReplace(_zkClient,path,record,true);
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id8",record.getId());
  record=new ZNRecord("id9");
  ZKUtil.createOrReplace(_zkClient,path,record,true);
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id9",record.getId());
}

</code></pre>

<br>
<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testChildrenOperations(){
  List<ZNRecord> list=new ArrayList<ZNRecord>();
  list.add(new ZNRecord("id1"));
  list.add(new ZNRecord("id2"));
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString());
  ZKUtil.createChildren(_zkClient,path,list);
  list=ZKUtil.getChildren(_zkClient,path);
  AssertJUnit.assertEquals(2,list.size());
  ZKUtil.dropChildren(_zkClient,path,list);
  ZKUtil.dropChildren(_zkClient,path,new ZNRecord("id1"));
  list=ZKUtil.getChildren(_zkClient,path);
  AssertJUnit.assertEquals(0,list.size());
  ZKUtil.dropChildren(_zkClient,path,(List<ZNRecord>)null);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testUpdateIfExists(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id3");
  ZNRecord record=new ZNRecord("id4");
  ZKUtil.updateIfExists(_zkClient,path,record,false);
  AssertJUnit.assertFalse(_zkClient.exists(path));
  _zkClient.createPersistent(path);
  ZKUtil.updateIfExists(_zkClient,path,record,false);
  AssertJUnit.assertTrue(_zkClient.exists(path));
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id4",record.getId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZNRecordStreamingSerializer </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test the normal case of serialize/deserialize where ZNRecord is well-formed
 */
@Test public void basicTest(){
  ZNRecord record=new ZNRecord("testId");
  record.setMapField("k1",ImmutableMap.of("a","b","c","d"));
  record.setMapField("k2",ImmutableMap.of("e","f","g","h"));
  record.setListField("k3",ImmutableList.of("a","b","c","d"));
  record.setListField("k4",ImmutableList.of("d","e","f","g"));
  record.setSimpleField("k5","a");
  record.setSimpleField("k5","b");
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord result=(ZNRecord)serializer.deserialize(serializer.serialize(record));
  Assert.assertEquals(result,record);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that the json still deserizalizes correctly if id is not first
 */
@Test public void idNotFirstTest(){
  StringBuilder jsonString=new StringBuilder("{\n").append("  \"simpleFields\": {},\n").append("  \"listFields\": {},\n").append("  \"mapFields\": {},\n").append("\"id\": \"myId\"\n").append("}");
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord result=(ZNRecord)serializer.deserialize(jsonString.toString().getBytes());
  Assert.assertNotNull(result);
  Assert.assertEquals(result.getId(),"myId");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that simple, list, and map fields are initialized as empty even when not in json
 */
@Test public void fieldAutoInitTest(){
  StringBuilder jsonString=new StringBuilder("{\n").append("\"id\": \"myId\"\n").append("}");
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord result=(ZNRecord)serializer.deserialize(jsonString.toString().getBytes());
  Assert.assertNotNull(result);
  Assert.assertEquals(result.getId(),"myId");
  Assert.assertNotNull(result.getSimpleFields());
  Assert.assertTrue(result.getSimpleFields().isEmpty());
  Assert.assertNotNull(result.getListFields());
  Assert.assertTrue(result.getListFields().isEmpty());
  Assert.assertNotNull(result.getMapFields());
  Assert.assertTrue(result.getMapFields().isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkBaseDataAccessor </h4><pre class="type-7 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  boolean success=_baseAccessor.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncCreate(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  record.setSimpleField("key0","value0");
  success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertFalse(success,"Should fail since node already exists");
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),0);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAsyncZkBaseDataAccessor(){
  System.out.println("START TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
  String root="TestZkBaseDataAccessor_asyn";
  ZkClient zkClient=new ZkClient(_zkaddr);
  zkClient.setZkSerializer(new ZNRecordSerializer());
  zkClient.deleteRecursive("/" + root);
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(zkClient);
  String parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    records.add(new ZNRecord(msgId));
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in create " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getId(),msgId,"Should get what we created");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=new ArrayList<ZNRecord>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key1","value1");
    records.add(newRecord);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in set " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),1,"Should have 1 simple field set");
    Assert.assertEquals(record.getSimpleField("key1"),"value1","Should have value1 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<DataUpdater<ZNRecord>> znrecordUpdaters=new ArrayList<DataUpdater<ZNRecord>>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key2","value2");
    znrecordUpdaters.add(new ZNRecordUpdater(newRecord));
  }
  success=accessor.updateChildren(paths,znrecordUpdaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in update " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=accessor.getChildren(parentPath,null,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    ZNRecord record=records.get(i);
    Assert.assertEquals(record.getId(),msgId,"Should get what we updated");
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  boolean[] exists=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(exists[i],"Should exist " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  Stat[] stats=accessor.getStats(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertNotNull(stats[i],"Stat should exist for " + msgId);
    Assert.assertEquals(stats[i].getVersion(),2,"DataVersion should be 2, since we set 1 and update 1 for " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  success=accessor.remove(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in remove " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    boolean pathExists=zkClient.exists(path);
    Assert.assertFalse(pathExists,"Should be removed " + msgId);
  }
  zkClient.close();
  System.out.println("END TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-11 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncGetStat(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  Stat stat=accessor.getStat(path,0);
  Assert.assertNull(stat);
  boolean success=accessor.create(path,record,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  stat=accessor.getStat(path,0);
  Assert.assertNotNull(stat);
  Assert.assertEquals(stat.getVersion(),0);
  Assert.assertNotSame(stat.getEphemeralOwner(),0);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncDoSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s/%s",testName,"msg_0","submsg_0");
  ZNRecord record=new ZNRecord("submsg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  AccessResult result=accessor.doSet(path,record,-1,AccessOption.PERSISTENT);
  Assert.assertEquals(result._retCode,RetCode.OK);
  Assert.assertEquals(result._pathCreated.size(),3);
  Assert.assertTrue(result._pathCreated.contains(String.format("/%s",testName)));
  Assert.assertTrue(result._pathCreated.contains(String.format("/%s/%s",testName,"msg_0")));
  Assert.assertTrue(result._pathCreated.contains(path));
  Assert.assertTrue(_zkclient.exists(String.format("/%s",testName)));
  Assert.assertTrue(_zkclient.exists(String.format("/%s/%s",testName,"msg_0")));
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"submsg_0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncUpdate(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.update(path,new ZNRecordUpdater(record),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  record.setSimpleField("key0","value0");
  success=accessor.update(path,new ZNRecordUpdater(record),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  success=accessor.update(path,new DataUpdater<ZNRecord>(){
    @Override public ZNRecord update(    ZNRecord currentData){
      throw new RuntimeException("IGNORABLE: test throw exception from updater");
    }
  }
,AccessOption.PERSISTENT);
  Assert.assertFalse(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncSetWithVersion(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  boolean success=_baseAccessor.set(path,record,0,AccessOption.PERSISTENT);
  Assert.assertFalse(success,"Should fail since version not match");
  try {
    _zkclient.readData(path,false);
    Assert.fail("Should get no node exception");
  }
 catch (  Exception e) {
  }
  success=_baseAccessor.set(path,record,-1,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  path=String.format("/%s/%s",testName,"msg_1");
  record=new ZNRecord("msg_1");
  success=_baseAccessor.set(path,record,0,AccessOption.EPHEMERAL);
  Assert.assertFalse(success);
  try {
    _zkclient.readData(path,false);
    Assert.fail("Should get no node exception");
  }
 catch (  Exception e) {
  }
  success=_baseAccessor.set(path,record,-1,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_1");
  record.setSimpleField("key0","value0");
  success=_baseAccessor.set(path,record,0,AccessOption.PERSISTENT);
  Assert.assertTrue(success,"Should pass. AccessOption.PERSISTENT is ignored");
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncRemove(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.remove(path,0);
  Assert.assertFalse(success);
  success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  success=accessor.remove(path,0);
  Assert.assertTrue(success);
  Assert.assertFalse(_zkclient.exists(path));
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  Stat stat=new Stat();
  ZNRecord getRecord=accessor.get(path,stat,0);
  Assert.assertNull(getRecord);
  try {
    accessor.get(path,stat,AccessOption.THROW_EXCEPTION_IFNOTEXIST);
    Assert.fail("Should throw exception if not exist");
  }
 catch (  Exception e) {
  }
  boolean success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  Assert.assertEquals(stat.getVersion(),0);
  record.setSimpleField("key0","value0");
  success=accessor.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(record.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  Assert.assertEquals(stat.getVersion(),1);
  ZNRecord newRecord=new ZNRecord("msg_0");
  newRecord.setSimpleField("key1","value1");
  success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),2);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  Assert.assertNotNull(getRecord.getSimpleField("key1"));
  Assert.assertEquals(getRecord.getSimpleField("key1"),"value1");
  Assert.assertEquals(stat.getVersion(),2);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathSelfOpZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> zkCacheInitPaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,zkCacheInitPaths);
  boolean ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int j=0; j < 10; j++) {
    for (int i=0; i < 10; i++) {
      String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
      ZNRecord record=new ZNRecord("TestDB" + i);
      record.setSimpleField("setKey","" + j);
      paths.add(path);
      records.add(record);
    }
    success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=extViewPath + "/TestDB" + i;
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZkCacheCallbackExternalOpNoChroot() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient zkclient=new ZkClient(_zkaddr);
  zkclient.setZkSerializer(new ZNRecordSerializer());
  ZkBaseDataAccessor<ZNRecord> extBaseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  extBaseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,cachePaths);
  TestListener listener=new TestListener();
  accessor.subscribe(curStatePath,listener);
  List<String> createPaths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    createPaths.add(path);
    boolean success=extBaseAccessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  Thread.sleep(500);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("createCnt: " + listener._createPathQueue.size());
  Assert.assertEquals(listener._createPathQueue.size(),11,"Shall get 11 onCreate callbacks.");
  createPaths.add(curStatePath + "/session_0");
  List<String> createCallbackPaths=new ArrayList<String>(listener._createPathQueue);
  Collections.sort(createPaths);
  Collections.sort(createCallbackPaths);
  Assert.assertEquals(createCallbackPaths,createPaths,"Should get create callbacks at " + createPaths + ", but was "+ createCallbackPaths);
  List<String> updatePaths=new ArrayList<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      updatePaths.add(path);
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("changeCnt: " + listener._changePathQueue.size());
  Assert.assertEquals(listener._changePathQueue.size(),100,"Shall get 100 onChange callbacks.");
  List<String> updateCallbackPaths=new ArrayList<String>(listener._changePathQueue);
  Collections.sort(updatePaths);
  Collections.sort(updateCallbackPaths);
  Assert.assertEquals(updateCallbackPaths,updatePaths,"Should get change callbacks at " + updatePaths + ", but was "+ updateCallbackPaths);
  TreeSet<String> removePaths=new TreeSet<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    removePaths.add(path);
    boolean success=accessor.remove(path,AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in remove: " + path);
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("deleteCnt: " + listener._deletePathQueue.size());
  Assert.assertTrue(listener._deletePathQueue.size() >= 10,"Shall get at least 10 onDelete callbacks.");
  Set<String> removeCallbackPaths=new TreeSet<String>(listener._deletePathQueue);
  Assert.assertEquals(removeCallbackPaths,removePaths,"Should get remove callbacks at " + removePaths + ", but was "+ removeCallbackPaths);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkClusterManager </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testAdministrator() throws Exception {
  final String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZKHelixManager admin=new ZKHelixManager(clusterName,null,InstanceType.ADMINISTRATOR,_zkaddr);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  admin.connect();
  AssertJUnit.assertTrue(admin.isConnected());
  HelixAdmin adminTool=admin.getClusterManagmentTool();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("pKey1","pValue1");
  properties.put("pKey2","pValue2");
  adminTool.setConfig(scope,properties);
  properties=adminTool.getConfig(scope,Arrays.asList("pKey1","pKey2"));
  Assert.assertEquals(properties.size(),2);
  Assert.assertEquals(properties.get("pKey1"),"pValue1");
  Assert.assertEquals(properties.get("pKey2"),"pValue2");
  admin.disconnect();
  AssertJUnit.assertFalse(admin.isConnected());
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testController() throws Exception {
  final String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  try {
    controller.connect();
    Assert.fail("Should throw HelixException if initial cluster structure is not setup");
  }
 catch (  HelixException e) {
  }
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  controller.connect();
  AssertJUnit.assertTrue(controller.isConnected());
  controller.connect();
  AssertJUnit.assertTrue(controller.isConnected());
  MockListener listener=new MockListener();
  listener.reset();
  try {
    controller.addControllerListener(null);
    Assert.fail("Should throw HelixException");
  }
 catch (  HelixException e) {
  }
  Builder keyBuilder=new Builder(controller.getClusterName());
  controller.addControllerListener(listener);
  AssertJUnit.assertTrue(listener.isControllerChangeListenerInvoked);
  controller.removeListener(keyBuilder.controller(),listener);
  ZkHelixPropertyStore<ZNRecord> store=controller.getHelixPropertyStore();
  ZNRecord record=new ZNRecord("node_1");
  int options=0;
  store.set("/node_1",record,AccessOption.PERSISTENT);
  Stat stat=new Stat();
  record=store.get("/node_1",stat,options);
  AssertJUnit.assertEquals("node_1",record.getId());
  controller.getMessagingService();
  controller.getClusterManagmentTool();
  controller.getConn().handleNewSession();
  controller.disconnect();
  AssertJUnit.assertFalse(controller.isConnected());
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkFlapping </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParticipantFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  final String instanceName="localhost_12918";
  MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
  participant.syncStart();
  final ZkClient client=participant.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  client.unsubscribeStateChanges(listener);
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
  Assert.assertNotNull(liveInstance,"Live-instance should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
      return liveInstance == null;
    }
  }
,3 * 1000);
  Assert.assertTrue(success,"Live-instance should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testControllerFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  final ZkClient client=controller.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader,"Leader should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      return leader == null;
    }
  }
,5 * 1000);
  Assert.assertTrue(success,"Leader should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixAdmin </h4><pre class="type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddRemoveMsgConstraint(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient),"Cluster should be setup");
  ClusterConstraints constraints=tool.getConstraints(clusterName,ConstraintType.MESSAGE_CONSTRAINT);
  Assert.assertNull(constraints,"message-constraint should NOT exist for cluster: " + className);
  try {
    tool.removeConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
  }
 catch (  Exception e) {
    Assert.fail("Should not throw exception when remove a non-exist constraint.");
  }
  ConstraintItemBuilder builder=new ConstraintItemBuilder();
  builder.addConstraintAttribute(ConstraintAttribute.RESOURCE.toString(),"MyDB").addConstraintAttribute(ConstraintAttribute.CONSTRAINT_VALUE.toString(),"1");
  tool.setConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1",builder.build());
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  PropertyKey.Builder keyBuilder=new PropertyKey.Builder(clusterName);
  constraints=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  Assert.assertNotNull(constraints,"message-constraint should exist");
  ConstraintItem item=constraints.getConstraintItem(ConstraintId.from("constraint1"));
  Assert.assertNotNull(item,"message-constraint for constraint1 should exist");
  Assert.assertEquals(item.getConstraintValue(),"1");
  Assert.assertEquals(item.getAttributeValue(ConstraintAttribute.RESOURCE),"MyDB");
  constraints=tool.getConstraints(clusterName,ConstraintType.MESSAGE_CONSTRAINT);
  Assert.assertNotNull(constraints,"message-constraint should exist");
  item=constraints.getConstraintItem(ConstraintId.from("constraint1"));
  Assert.assertNotNull(item,"message-constraint for constraint1 should exist");
  Assert.assertEquals(item.getConstraintValue(),"1");
  Assert.assertEquals(item.getAttributeValue(ConstraintAttribute.RESOURCE),"MyDB");
  tool.removeConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
  constraints=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  Assert.assertNotNull(constraints,"message-constraint should exist");
  item=constraints.getConstraintItem(ConstraintId.from("constraint1"));
  Assert.assertNull(item,"message-constraint for constraint1 should NOT exist");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testZkHelixAdmin(){
  System.out.println("START testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
  final String clusterName=TestUtil.getTestName();
  String rootPath="/" + clusterName;
  if (_zkclient.exists(rootPath)) {
    _zkclient.deleteRecursive(rootPath);
  }
  HelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  List<String> list=tool.getClusters();
  AssertJUnit.assertTrue(list.size() > 0);
  try {
    Stat oldstat=_zkclient.getStat(rootPath);
    Assert.assertNotNull(oldstat);
    boolean success=tool.addCluster(clusterName,false);
    Assert.assertTrue(success);
    Stat newstat=_zkclient.getStat(rootPath);
    Assert.assertEquals(oldstat,newstat);
  }
 catch (  HelixException e) {
  }
  InstanceConfig config=new InstanceConfig("host1_9999");
  config.setHostName("host1");
  config.setPort("9999");
  tool.addInstance(clusterName,config);
  tool.enableInstance(clusterName,"host1_9999",true);
  String path=PropertyPathConfig.getPath(PropertyType.INSTANCES,clusterName,"host1_9999");
  AssertJUnit.assertTrue(_zkclient.exists(path));
  try {
    tool.addInstance(clusterName,config);
    Assert.fail("should fail if add an alredy-existing instance");
  }
 catch (  HelixException e) {
  }
  config=tool.getInstanceConfig(clusterName,"host1_9999");
  AssertJUnit.assertEquals(config.getId(),"host1_9999");
  tool.dropInstance(clusterName,config);
  try {
    tool.getInstanceConfig(clusterName,"host1_9999");
    Assert.fail("should fail if get a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.dropInstance(clusterName,config);
    Assert.fail("should fail if drop on a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.enableInstance(clusterName,"host1_9999",false);
    Assert.fail("should fail if enable a non-existent instance");
  }
 catch (  HelixException e) {
  }
  ZNRecord stateModelRecord=new ZNRecord("id1");
  try {
    tool.addStateModelDef(clusterName,"id1",new StateModelDefinition(stateModelRecord));
    path=PropertyPathConfig.getPath(PropertyType.STATEMODELDEFS,clusterName,"id1");
    AssertJUnit.assertTrue(_zkclient.exists(path));
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
catch (  IllegalArgumentException ex) {
  }
  tool.addStateModelDef(clusterName,"MasterSlave",new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave()));
  stateModelRecord=StateModelConfigGenerator.generateConfigForMasterSlave();
  try {
    tool.addStateModelDef(clusterName,stateModelRecord.getId(),new StateModelDefinition(stateModelRecord));
    Assert.fail("should fail if add an already-existing state model");
  }
 catch (  HelixException e) {
  }
  list=tool.getStateModelDefs(clusterName);
  AssertJUnit.assertEquals(list.size(),1);
  try {
    tool.addResource(clusterName,"resource",10,"nonexistStateModelDef");
    Assert.fail("should fail if add a resource without an existing state model");
  }
 catch (  HelixException e) {
  }
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  ExternalView resourceExternalView=tool.getResourceExternalView(clusterName,"resource");
  AssertJUnit.assertNull(resourceExternalView);
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("pKey1","pValue1");
  properties.put("pKey2","pValue2");
  for (int i=0; i < 100; i++) {
    tool.setConfig(scope,properties);
    Map<String,String> newProperties=tool.getConfig(scope,new ArrayList<String>(properties.keySet()));
    Assert.assertEquals(newProperties.size(),2);
    Assert.assertEquals(newProperties.get("pKey1"),"pValue1");
    Assert.assertEquals(newProperties.get("pKey2"),"pValue2");
  }
  System.out.println("END testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixController </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnConnectedAndDisconnecting() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  ControllerId controllerId=ControllerId.from("controller");
  HelixController controller=connection.createController(clusterId,controllerId);
  controller.start();
  HelixDataAccessor accessor=connection.createDataAccessor(clusterId);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getInstanceName(),controllerId.stringify());
  controller.stop();
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  connection.disconnect();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Remove leader znode externally should invoke another round of leader-election
 * this simulates the race condition in{@link ZkHelixLeaderElection#onControllerChange(org.apache.helix.NotificationContext)}
 * @throws Exception
 */
@Test public void testRemoveLeaderZnode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  final ControllerId controllerId=ControllerId.from("controller");
  HelixController controller=connection.createController(clusterId,controllerId);
  controller.start();
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getInstanceName(),controllerId.stringify());
  accessor.removeProperty(keyBuilder.controllerLeader());
  boolean result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      if (leader == null) {
        return false;
      }
      return leader.getInstanceName().equals(controllerId.stringify());
    }
  }
,3 * 1000);
  Assert.assertTrue(result,"Fail to re-elect a new leader");
  connection.disconnect();
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixMultiClusterController </h4><pre class="type-4 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnConnectedAndDisconnecting() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  final HelixMultiClusterController[] controllers=new HelixMultiClusterController[n];
  for (int i=0; i < n; i++) {
    int port=12918 + i;
    ControllerId controllerId=ControllerId.from("localhost_" + port);
    controllers[i]=connection.createMultiClusterController(clusterId,controllerId);
    controllers[i].start();
  }
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    String instanceName=controllers[i].getControllerId().stringify();
    Assert.assertNotNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  }
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getInstanceName(),controllers[0].getControllerId().stringify());
  controllers[0].stop();
  String instanceName=controllers[0].getControllerId().stringify();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      if (leader == null) {
        return false;
      }
      return leader.getInstanceName().equals(controllers[1].getControllerId().stringify());
    }
  }
,3 * 1000);
  Assert.assertTrue(success,"fail to re-elect new leader");
  connection.disconnect();
  instanceName=controllers[1].getControllerId().stringify();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.serializer.TestJacksonPayloadSerializer </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that the payload can be deserialized after serializing and deserializing the ZNRecord
 * that encloses it. This uses ZNRecordStreamingSerializer.
 */
@Test public void testFullZNRecordStreamingSerializeDeserialize(){
  final String RECORD_ID="testFullZNRecordStreamingSerializeDeserialize";
  SampleDeserialized sample=getSample();
  ZNRecord znRecord=new ZNRecord(RECORD_ID);
  znRecord.setPayloadSerializer(new JacksonPayloadSerializer());
  znRecord.setPayload(sample);
  ZNRecordStreamingSerializer znRecordSerializer=new ZNRecordStreamingSerializer();
  byte[] serialized=znRecordSerializer.serialize(znRecord);
  ZNRecord deserialized=(ZNRecord)znRecordSerializer.deserialize(serialized);
  deserialized.setPayloadSerializer(new JacksonPayloadSerializer());
  SampleDeserialized duplicate=deserialized.getPayload(SampleDeserialized.class);
  Assert.assertEquals(duplicate,sample);
}

</code></pre>

<br>
<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that the payload can be deserialized after serializing and deserializing the ZNRecord
 * that encloses it. This uses ZNRecordSerializer.
 */
@Test public void testFullZNRecordSerializeDeserialize(){
  final String RECORD_ID="testFullZNRecordSerializeDeserialize";
  SampleDeserialized sample=getSample();
  ZNRecord znRecord=new ZNRecord(RECORD_ID);
  znRecord.setPayloadSerializer(new JacksonPayloadSerializer());
  znRecord.setPayload(sample);
  ZNRecordSerializer znRecordSerializer=new ZNRecordSerializer();
  byte[] serialized=znRecordSerializer.serialize(znRecord);
  ZNRecord deserialized=(ZNRecord)znRecordSerializer.deserialize(serialized);
  deserialized.setPayloadSerializer(new JacksonPayloadSerializer());
  SampleDeserialized duplicate=deserialized.getPayload(SampleDeserialized.class);
  Assert.assertEquals(duplicate,sample);
}

</code></pre>

<br>
<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Ensure that the JacksonPayloadSerializer can serialize and deserialize arbitrary objects
 */
@Test public void testJacksonSerializeDeserialize(){
  final String RECORD_ID="testJacksonSerializeDeserialize";
  SampleDeserialized sample=getSample();
  ZNRecord znRecord=new ZNRecord(RECORD_ID);
  znRecord.setPayloadSerializer(new JacksonPayloadSerializer());
  znRecord.setPayload(sample);
  SampleDeserialized duplicate=znRecord.getPayload(SampleDeserialized.class);
  Assert.assertEquals(duplicate,sample);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.CriteriaEvaluatorTest </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEvaluateCriteria(){
  CriteriaEvaluator criteriaEvaluator=new CriteriaEvaluator();
  Criteria recipientCriteria=new Criteria();
  recipientCriteria.setInstanceName("%");
  recipientCriteria.setResource("%");
  recipientCriteria.setPartition("%");
  recipientCriteria.setRecipientInstanceType(InstanceType.PARTICIPANT);
  recipientCriteria.setDataSource(Criteria.DataSource.LIVEINSTANCES);
  List<Map<String,String>> result=criteriaEvaluator.evaluateCriteria(recipientCriteria,_helixManager);
  Assert.assertEquals(result.size(),5);
  Set<String> expectedInstances=Sets.newHashSet();
  for (int i=0; i < PARTICIPANTS; i++) {
    expectedInstances.add(INSTANCE_NAME_PREFIX + i);
  }
  Set<String> actualInstances=Sets.newHashSet();
  for (  Map<String,String> row : result) {
    actualInstances.add(row.get("instanceName"));
  }
  Assert.assertEquals(actualInstances,expectedInstances);
  recipientCriteria.setInstanceName(INSTANCE_NAME_PREFIX + 2);
  result=criteriaEvaluator.evaluateCriteria(recipientCriteria,_helixManager);
  Assert.assertEquals(result.size(),1);
  Assert.assertEquals(result.get(0).get("instanceName"),INSTANCE_NAME_PREFIX + 2);
  recipientCriteria.setInstanceName("%");
  recipientCriteria.setDataSource(Criteria.DataSource.IDEALSTATES);
  result=criteriaEvaluator.evaluateCriteria(recipientCriteria,_helixManager);
  Assert.assertEquals(result.size(),40);
  recipientCriteria.setInstanceName(INSTANCE_NAME_PREFIX + 4);
  result=criteriaEvaluator.evaluateCriteria(recipientCriteria,_helixManager);
  Assert.assertEquals(result.size(),8);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.TestDefaultMessagingService </h4><pre class="type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void TestMessageSend(){
  HelixManager manager=new MockHelixManager();
  DefaultMessagingService svc=new DefaultMessagingService(manager);
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  svc.registerMessageHandlerFactory(factory.getMessageType(),factory);
  Criteria recipientCriteria=new Criteria();
  recipientCriteria.setInstanceName("localhost_12919");
  recipientCriteria.setRecipientInstanceType(InstanceType.PARTICIPANT);
  recipientCriteria.setSelfExcluded(true);
  Message template=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
  AssertJUnit.assertEquals(0,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  AssertJUnit.assertEquals(1,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  recipientCriteria.setInstanceName("%");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(200,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  recipientCriteria.setInstanceName("*");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("*");
  AssertJUnit.assertEquals(200,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(false);
  recipientCriteria.setInstanceName("localhost%");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(200,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("%");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(159,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("localhost_12920");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("l_calhost_12_20");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("%12920");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("l%_12920");
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(39,svc.send(recipientCriteria,template));
  recipientCriteria.setSelfExcluded(true);
  recipientCriteria.setInstanceName("localhost_12920");
  recipientCriteria.setRecipientInstanceType(InstanceType.CONTROLLER);
  recipientCriteria.setResource("DB");
  recipientCriteria.setPartition("%");
  AssertJUnit.assertEquals(1,svc.send(recipientCriteria,template));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestConfigThreadpoolSize </h4><pre class="type-4 type-14 type-1 type-6 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void TestThreadPoolSizeConfig(){
  String instanceName="localhost_" + (START_PORT + 0);
  HelixManager manager=_participants[0];
  ConfigAccessor accessor=manager.getConfigAccessor();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(manager.getClusterName()).forParticipant(instanceName).build();
  accessor.set(scope,"TestMsg." + HelixTaskExecutor.MAX_THREADS,"" + 12);
  scope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(manager.getClusterName()).build();
  accessor.set(scope,"TestMsg." + HelixTaskExecutor.MAX_THREADS,"" + 8);
  for (int i=0; i < NODE_NR; i++) {
    instanceName="localhost_" + (START_PORT + i);
    _participants[i].getMessagingService().registerMessageHandlerFactory("TestMsg",new TestMessagingHandlerFactory());
    _participants[i].getMessagingService().registerMessageHandlerFactory("TestMsg2",new TestMessagingHandlerFactory2());
  }
  for (int i=0; i < NODE_NR; i++) {
    instanceName="localhost_" + (START_PORT + i);
    DefaultMessagingService svc=(DefaultMessagingService)(_participants[i].getMessagingService());
    HelixTaskExecutor helixExecutor=svc.getExecutor();
    ThreadPoolExecutor executor=(ThreadPoolExecutor)(helixExecutor._executorMap.get("TestMsg"));
    ThreadPoolExecutor executor2=(ThreadPoolExecutor)(helixExecutor._executorMap.get("TestMsg2"));
    if (i != 0) {
      Assert.assertEquals(8,executor.getMaximumPoolSize());
    }
 else {
      Assert.assertEquals(12,executor.getMaximumPoolSize());
    }
    Assert.assertEquals(HelixTaskExecutor.DEFAULT_PARALLEL_TASKS,executor2.getMaximumPoolSize());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestHelixTaskExecutor </h4><pre class="type-4 type-7 type-14 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testNoRetry() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setExecutionTimeout((i + 1) * 600);
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(4000);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs2);
  AssertJUnit.assertEquals(factory._timedOutMsgIds.size(),2);
  for (int i=0; i < nMsgs2 - 2; i++) {
    if (msgList.get(i).getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(msgList.get(i).getRecord().getSimpleFields().containsKey("Cancelcount"));
      AssertJUnit.assertTrue(factory._timedOutMsgIds.containsKey(msgList.get(i).getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testRetryOnce() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setExecutionTimeout((i + 1) * 600);
    msg.setRetryCount(1);
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(3500);
  AssertJUnit.assertEquals(factory._processedMsgIds.size(),3);
  AssertJUnit.assertTrue(msgList.get(0).getRecord().getSimpleField("Cancelcount").equals("2"));
  AssertJUnit.assertTrue(msgList.get(1).getRecord().getSimpleField("Cancelcount").equals("1"));
  AssertJUnit.assertEquals(factory._timedOutMsgIds.size(),2);
  AssertJUnit.assertTrue(executor._taskMap.size() == 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestResourceThreadpoolSize </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestThreadPoolSizeConfig(){
  HelixManager manager=_participants[0];
  ConfigAccessor accessor=manager.getConfigAccessor();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(manager.getClusterName()).forResource("NextDB").build();
  accessor.set(scope,HelixTaskExecutor.MAX_THREADS,"" + 12);
  _setupTool.addResourceToCluster(CLUSTER_NAME,"NextDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"NextDB",3);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  long taskcount=0;
  for (int i=0; i < NODE_NR; i++) {
    DefaultMessagingService svc=(DefaultMessagingService)(_participants[i].getMessagingService());
    HelixTaskExecutor helixExecutor=svc.getExecutor();
    ThreadPoolExecutor executor=(ThreadPoolExecutor)(helixExecutor._executorMap.get(MessageType.STATE_TRANSITION + "." + "NextDB"));
    Assert.assertEquals(12,executor.getMaximumPoolSize());
    taskcount+=executor.getCompletedTaskCount();
    Assert.assertTrue(executor.getCompletedTaskCount() > 0);
  }
  Assert.assertEquals(taskcount,64 * 4);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.TestConstraint </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStateConstraint(){
  String className=TestUtil.getTestName();
  System.out.println("START testStateConstraint() at " + new Date(System.currentTimeMillis()));
  String clusterName="CLUSTER_" + className + "_state";
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  ZNRecord record=new ZNRecord("testStateConstraint");
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("STATE","MASTER");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("STATE","MASTER");
  record.getMapField("constraint1").put("RESOURCE","TestDB");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("STATE","MASTER");
  record.getMapField("constraint2").put("RESOURCE",".*");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.STATE_CONSTRAINT.toString()),new ClusterConstraints(record));
  record=accessor.getProperty(keyBuilder.constraint(ConstraintType.STATE_CONSTRAINT.toString())).getRecord();
  ClusterConstraints constraint=new ClusterConstraints(record);
  Map<ConstraintAttribute,String> stateAttr1=new HashMap<ConstraintAttribute,String>();
  stateAttr1.put(ConstraintAttribute.STATE,"MASTER");
  stateAttr1.put(ConstraintAttribute.RESOURCE,"TestDB");
  Set<ConstraintItem> matches=constraint.match(stateAttr1);
  System.out.println(stateAttr1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),3);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Map<ConstraintAttribute,String> stateAttr2=new HashMap<ConstraintAttribute,String>();
  stateAttr2.put(ConstraintAttribute.STATE,"MASTER");
  stateAttr2.put(ConstraintAttribute.RESOURCE,"MyDB");
  matches=constraint.match(stateAttr2);
  System.out.println(stateAttr2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint2));
  System.out.println("END testStateConstraint() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMsgConstraint(){
  String className=TestUtil.getTestName();
  System.out.println("START testMsgConstraint() at " + new Date(System.currentTimeMillis()));
  String clusterName="CLUSTER_" + className + "_msg";
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  ZNRecord record=new ZNRecord("testMsgConstraint");
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","ANY");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","50");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint2").put("INSTANCE",".*");
  record.getMapField("constraint2").put("RESOURCE","TestDB");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint3").put("INSTANCE","localhost_12919");
  record.getMapField("constraint3").put("RESOURCE",".*");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint3"));
  record.setMapField("constraint4",new TreeMap<String,String>());
  record.getMapField("constraint4").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint4").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint4").put("INSTANCE",".*");
  record.getMapField("constraint4").put("RESOURCE",".*");
  record.getMapField("constraint4").put("CONSTRAINT_VALUE","10");
  ConstraintItem constraint4=new ConstraintItem(record.getMapField("constraint4"));
  record.setMapField("constraint5",new TreeMap<String,String>());
  record.getMapField("constraint5").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint5").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint5").put("INSTANCE","localhost_12918");
  record.getMapField("constraint5").put("RESOURCE","TestDB");
  record.getMapField("constraint5").put("CONSTRAINT_VALUE","5");
  ConstraintItem constraint5=new ConstraintItem(record.getMapField("constraint5"));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  record=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString())).getRecord();
  ClusterConstraints constraint=new ClusterConstraints(record);
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_12918");
  Map<ConstraintAttribute,String> msgAttr=ClusterConstraints.toConstraintAttributes(msg1);
  Set<ConstraintItem> matches=constraint.match(msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Assert.assertTrue(contains(matches,constraint4));
  Assert.assertTrue(contains(matches,constraint5));
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_12919");
  msgAttr=ClusterConstraints.toConstraintAttributes(msg2);
  matches=constraint.match(msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Assert.assertTrue(contains(matches,constraint3));
  Assert.assertTrue(contains(matches,constraint4));
  System.out.println("END testMsgConstraint() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.TestIdealState </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSemiAutoModeCompatibility(){
  IdealState idealStateOld=new IdealState("old-test-db");
  idealStateOld.setIdealStateMode(IdealStateModeProperty.AUTO.toString());
  Assert.assertEquals(idealStateOld.getRebalanceMode(),RebalanceMode.SEMI_AUTO);
  Assert.assertEquals(idealStateOld.getIdealStateMode(),IdealStateModeProperty.AUTO);
  IdealState idealStateNew=new IdealState("new-test-db");
  idealStateNew.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  Assert.assertEquals(idealStateNew.getIdealStateMode(),IdealStateModeProperty.AUTO);
  Assert.assertEquals(idealStateNew.getRebalanceMode(),RebalanceMode.SEMI_AUTO);
}

</code></pre>

<br>
<pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetInstanceSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  IdealState idealState=new IdealState("idealState");
  idealState.getRecord().setListField("TestDB_0",Arrays.asList("node_1","node_2"));
  Map<String,String> instanceState=new HashMap<String,String>();
  instanceState.put("node_3","MASTER");
  instanceState.put("node_4","SLAVE");
  idealState.getRecord().setMapField("TestDB_1",instanceState);
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  Set<ParticipantId> instances=idealState.getParticipantSet(PartitionId.from("TestDB_0"));
  Assert.assertEquals(instances.size(),2,"Should contain node_1 and node_2");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_1")),"Should contain node_1 and node_2");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_2")),"Should contain node_1 and node_2");
  instances=idealState.getParticipantSet(PartitionId.from("TestDB_nonExist_auto"));
  Assert.assertEquals(instances,Collections.emptySet(),"Should get empty set");
  idealState.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  instances=idealState.getParticipantSet(PartitionId.from("TestDB_1"));
  Assert.assertEquals(instances.size(),2,"Should contain node_3 and node_4");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_3")),"Should contain node_3 and node_4");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_4")),"Should contain node_3 and node_4");
  instances=idealState.getParticipantSet(PartitionId.from("TestDB_nonExist_custom"));
  Assert.assertEquals(instances,Collections.emptySet(),"Should get empty set");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCustomizedModeCompatibility(){
  IdealState idealStateOld=new IdealState("old-test-db");
  idealStateOld.setIdealStateMode(IdealStateModeProperty.CUSTOMIZED.toString());
  Assert.assertEquals(idealStateOld.getRebalanceMode(),RebalanceMode.CUSTOMIZED);
  Assert.assertEquals(idealStateOld.getIdealStateMode(),IdealStateModeProperty.CUSTOMIZED);
  IdealState idealStateNew=new IdealState("new-test-db");
  idealStateNew.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  Assert.assertEquals(idealStateNew.getIdealStateMode(),IdealStateModeProperty.CUSTOMIZED);
  Assert.assertEquals(idealStateNew.getRebalanceMode(),RebalanceMode.CUSTOMIZED);
}

</code></pre>

<br>
<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFullAutoModeCompatibility(){
  IdealState idealStateOld=new IdealState("old-test-db");
  idealStateOld.setIdealStateMode(IdealStateModeProperty.AUTO_REBALANCE.toString());
  Assert.assertEquals(idealStateOld.getRebalanceMode(),RebalanceMode.FULL_AUTO);
  Assert.assertEquals(idealStateOld.getIdealStateMode(),IdealStateModeProperty.AUTO_REBALANCE);
  IdealState idealStateNew=new IdealState("new-test-db");
  idealStateNew.setRebalanceMode(RebalanceMode.FULL_AUTO);
  Assert.assertEquals(idealStateNew.getIdealStateMode(),IdealStateModeProperty.AUTO_REBALANCE);
  Assert.assertEquals(idealStateNew.getRebalanceMode(),RebalanceMode.FULL_AUTO);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.builder.TestIdealStateBuilder </h4><pre class="type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomModeISBuilder(){
  CustomModeISBuilder builder=new CustomModeISBuilder("test-db");
  builder.setStateModel("MasterSlave").setNumPartitions(2).setNumReplica(2);
  builder.assignInstanceAndState("test-db_0","node_0","MASTER").assignInstanceAndState("test-db_0","node_1","SLAVE").assignInstanceAndState("test-db_1","node_0","SLAVE").assignInstanceAndState("test-db_1","node_1","MASTER");
  IdealState idealState=null;
  try {
    idealState=builder.build();
  }
 catch (  Exception e) {
    Assert.fail("fail to build a custom mode ideal-state.",e);
  }
  Assert.assertEquals(idealState.getRebalanceMode(),IdealState.RebalanceMode.CUSTOMIZED,"rebalancer mode should be customized");
}

</code></pre>

<br>
<pre class="type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAutoISBuilder(){
  AutoModeISBuilder builder=new AutoModeISBuilder("test-db");
  builder.setStateModel("MasterSlave").setNumPartitions(2).setNumReplica(2);
  builder.assignPreferenceList("test-db_0","node_0","node_1").assignPreferenceList("test-db_1","node_1","node_0");
  IdealState idealState=null;
  try {
    idealState=builder.build();
  }
 catch (  Exception e) {
    Assert.fail("fail to build an auto mode ideal-state.",e);
  }
  Assert.assertEquals(idealState.getRebalanceMode(),IdealState.RebalanceMode.SEMI_AUTO,"rebalancer mode should be semi-auto");
}

</code></pre>

<br>
<pre class="type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAutoRebalanceISModeBuilder(){
  AutoRebalanceModeISBuilder builder=new AutoRebalanceModeISBuilder("test-db");
  builder.setStateModel("MasterSlave").setNumPartitions(2).setNumReplica(2);
  builder.add("test-db_0").add("test-db_1");
  IdealState idealState=null;
  try {
    idealState=builder.build();
  }
 catch (  Exception e) {
    Assert.fail("fail to build an auto-rebalance mode ideal-state.",e);
  }
  Assert.assertEquals(idealState.getRebalanceMode(),IdealState.RebalanceMode.FULL_AUTO,"rebalancer mode should be auto");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.TestClusterStatusMonitorLifecycle </h4><pre class="type-6 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testClusterStatusMonitorLifecycle() throws InstanceNotFoundException, MalformedObjectNameException, NullPointerException, IOException, InterruptedException {
  ParticipantMonitorListener listener=new ParticipantMonitorListener("ClusterStatus");
  int nMbeansUnregistered=listener._nMbeansUnregistered;
  int nMbeansRegistered=listener._nMbeansRegistered;
  _participants[0].disconnect();
  Thread.sleep(1000);
  Assert.assertEquals(nMbeansUnregistered,listener._nMbeansUnregistered - 2);
  Assert.assertEquals(nMbeansRegistered,listener._nMbeansRegistered);
  HelixDataAccessor accessor=_participants[n - 1].getHelixDataAccessor();
  String firstControllerName=accessor.getProperty(accessor.keyBuilder().controllerLeader()).getId();
  MockMultiClusterController firstController=null;
  for (  MockMultiClusterController controller : _controllers) {
    if (controller.getInstanceName().equals(firstControllerName)) {
      firstController=controller;
    }
  }
  firstController.disconnect();
  Thread.sleep(1000);
  Assert.assertEquals(nMbeansUnregistered,listener._nMbeansUnregistered - 16);
  Assert.assertEquals(nMbeansRegistered,listener._nMbeansRegistered - 12);
  String instanceName="localhost0_" + (12918 + 0);
  _participants[0]=new MockParticipant(_zkaddr,_firstClusterName,instanceName);
  _participants[0].syncStart();
  Thread.sleep(1000);
  Assert.assertEquals(nMbeansUnregistered,listener._nMbeansUnregistered - 16);
  Assert.assertEquals(nMbeansRegistered,listener._nMbeansRegistered - 14);
  IdealState idealState=accessor.getProperty(accessor.keyBuilder().idealStates("TestDB00"));
  _setupTool.addResourceToCluster(_firstClusterName,"TestDB1",idealState.getNumPartitions(),"MasterSlave");
  _setupTool.rebalanceResource(_firstClusterName,"TestDB1",Integer.parseInt(idealState.getReplicas()));
  Thread.sleep(1000);
  Assert.assertEquals(nMbeansUnregistered,listener._nMbeansUnregistered - 16);
  Assert.assertEquals(nMbeansRegistered,listener._nMbeansRegistered - 20);
  _setupTool.dropResourceFromCluster(_firstClusterName,"TestDB1");
  Thread.sleep(1000);
  Assert.assertEquals(nMbeansUnregistered,listener._nMbeansUnregistered - 22);
  Assert.assertEquals(nMbeansRegistered,listener._nMbeansRegistered - 20);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.TestParticipantMonitor </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testReportData() throws InstanceNotFoundException, MalformedObjectNameException, NullPointerException, IOException, InterruptedException {
  System.out.println("START TestParticipantMonitor");
  ParticipantMonitor monitor=new ParticipantMonitor();
  int monitorNum=0;
  StateTransitionContext cxt=new StateTransitionContext("cluster","instance","db_1","a-b");
  StateTransitionDataPoint data=new StateTransitionDataPoint(1000,1000,true);
  monitor.reportTransitionStat(cxt,data);
  data=new StateTransitionDataPoint(1000,1200,true);
  monitor.reportTransitionStat(cxt,data);
  ParticipantMonitorListener monitorListener=new ParticipantMonitorListener("CLMParticipantReport");
  Thread.sleep(1000);
  AssertJUnit.assertTrue(monitorListener._beanValueMap.size() == monitorNum + 1);
  data=new StateTransitionDataPoint(1000,500,true);
  monitor.reportTransitionStat(cxt,data);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(monitorListener._beanValueMap.size() == monitorNum + 1);
  data=new StateTransitionDataPoint(1000,500,true);
  StateTransitionContext cxt2=new StateTransitionContext("cluster","instance","db_2","a-b");
  monitor.reportTransitionStat(cxt2,data);
  monitor.reportTransitionStat(cxt2,data);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(monitorListener._beanValueMap.size() == monitorNum + 2);
  AssertJUnit.assertFalse(cxt.equals(cxt2));
  AssertJUnit.assertFalse(cxt.equals(new Object()));
  AssertJUnit.assertTrue(cxt.equals(new StateTransitionContext("cluster","instance","db_1","a-b")));
  cxt2.getInstanceName();
  ParticipantMonitorListener monitorListener2=new ParticipantMonitorListener("CLMParticipantReport");
  Thread.sleep(1000);
  AssertJUnit.assertEquals(monitorListener2._beanValueMap.size(),monitorNum + 2);
  monitorListener2.disconnect();
  monitorListener.disconnect();
  System.out.println("END TestParticipantMonitor");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.TestStatCollector </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testCollectData(){
  StatCollector collector=new StatCollector();
  int nPoints=100;
  for (int i=0; i < nPoints; i++) {
    collector.addData(i * 1000);
  }
  AssertJUnit.assertEquals(collector.getNumDataPoints(),nPoints);
  AssertJUnit.assertEquals((long)collector.getMax(),99000);
  AssertJUnit.assertEquals(collector.getTotalSum(),4950000);
  AssertJUnit.assertEquals((long)collector.getPercentile(40),39400);
  AssertJUnit.assertEquals((long)collector.getMean(),49500);
  AssertJUnit.assertEquals((long)collector.getMin(),0);
  collector.reset();
  AssertJUnit.assertEquals(collector.getNumDataPoints(),0);
  AssertJUnit.assertEquals((long)collector.getMax(),0);
  AssertJUnit.assertEquals(collector.getTotalSum(),0);
  AssertJUnit.assertEquals((long)collector.getPercentile(40),0);
  AssertJUnit.assertEquals((long)collector.getMean(),0);
  AssertJUnit.assertEquals((long)collector.getMin(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.mbeans.TestClusterStatusMonitor </h4><pre class="type-7 type-5 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testReportData() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  String testDB="TestDB";
  String testDB_0=testDB + "_0";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ClusterStatusMonitor monitor=new ClusterStatusMonitor(clusterName);
  ObjectName clusterMonitorObjName=monitor.getObjectName(monitor.clusterBeanName());
  try {
    _server.getMBeanInfo(clusterMonitorObjName);
  }
 catch (  Exception e) {
    Assert.fail("Fail to register ClusterStatusMonitor");
  }
  BestPossibleStateOutput bestPossibleStates=new BestPossibleStateOutput();
  ResourceAssignment assignment=new ResourceAssignment(ResourceId.from(testDB));
  Map<ParticipantId,State> replicaMap=Maps.newHashMap();
  replicaMap.put(ParticipantId.from("localhost_12918"),State.from("MASTER"));
  replicaMap.put(ParticipantId.from("localhost_12919"),State.from("SLAVE"));
  replicaMap.put(ParticipantId.from("localhost_12920"),State.from("SLAVE"));
  replicaMap.put(ParticipantId.from("localhost_12921"),State.from("OFFLINE"));
  replicaMap.put(ParticipantId.from("localhost_12922"),State.from("DROPPED"));
  assignment.addReplicaMap(PartitionId.from(testDB_0),replicaMap);
  bestPossibleStates.setResourceAssignment(ResourceId.from(testDB),assignment);
  Map<String,InstanceConfig> instanceConfigMap=Maps.newHashMap();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    InstanceConfig config=new InstanceConfig(instanceName);
    instanceConfigMap.put(instanceName,config);
  }
  Map<ResourceId,ResourceConfig> resourceMap=Maps.newHashMap();
  ResourceId resourceId=ResourceId.from(testDB);
  AutoModeISBuilder idealStateBuilder=new AutoModeISBuilder(resourceId).add(testDB_0);
  idealStateBuilder.setStateModel("MasterSlave");
  IdealState idealState=idealStateBuilder.build();
  ResourceConfig resourceConfig=new ResourceConfig.Builder(resourceId).idealState(idealState).build();
  resourceMap.put(resourceId,resourceConfig);
  Map<String,StateModelDefinition> stateModelDefMap=Maps.newHashMap();
  StateModelDefinition msStateModelDef=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  stateModelDefMap.put("MasterSlave",msStateModelDef);
  monitor.setPerInstanceResourceStatus(bestPossibleStates,instanceConfigMap,resourceMap,stateModelDefMap);
  ObjectName objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12918",testDB));
  Object value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(1));
  value=_server.getAttribute(objName,"SensorName");
  Assert.assertTrue(value instanceof String);
  Assert.assertEquals((String)value,String.format("%s.%s.%s.%s.%s",ClusterStatusMonitor.PARTICIPANT_STATUS_KEY,clusterName,ClusterStatusMonitor.DEFAULT_TAG,"localhost_12918",testDB));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12919",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(1));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12921",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(0));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12922",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(0));
  replicaMap.remove(ParticipantId.from("localhost_12918"));
  assignment.addReplicaMap(PartitionId.from(testDB_0),replicaMap);
  bestPossibleStates.setResourceAssignment(ResourceId.from(testDB),assignment);
  monitor.setPerInstanceResourceStatus(bestPossibleStates,instanceConfigMap,resourceMap,stateModelDefMap);
  try {
    objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12918",testDB));
    _server.getMBeanInfo(objName);
    Assert.fail("Fail to unregister PerInstanceResource mbean for localhost_12918");
  }
 catch (  InstanceNotFoundException e) {
  }
  monitor.reset();
  try {
    objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12920",testDB));
    _server.getMBeanInfo(objName);
    Assert.fail("Fail to unregister PerInstanceResource mbean for localhost_12920");
  }
 catch (  InstanceNotFoundException e) {
  }
  try {
    _server.getMBeanInfo(clusterMonitorObjName);
    Assert.fail("Fail to unregister ClusterStatusMonitor");
  }
 catch (  InstanceNotFoundException e) {
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.mbeans.TestResourceMonitor </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testReportData(){
  final int n=5;
  ResourceMonitor monitor=new ResourceMonitor(_clusterName,_dbName);
  List<String> instances=new ArrayList<String>();
  for (int i=0; i < n; i++) {
    String instance="localhost_" + (12918 + i);
    instances.add(instance);
  }
  ZNRecord idealStateRecord=DefaultTwoStateStrategy.calculateIdealState(instances,_partitions,_replicas,_dbName,"MASTER","SLAVE");
  IdealState idealState=new IdealState(idealStateRecord);
  ExternalView externalView=new ExternalView(idealStateRecord);
  monitor.updateResource(externalView,idealState,"MASTER");
  Assert.assertEquals(monitor.getDifferenceWithIdealStateGauge(),0);
  Assert.assertEquals(monitor.getErrorPartitionGauge(),0);
  Assert.assertEquals(monitor.getExternalViewPartitionGauge(),_partitions);
  Assert.assertEquals(monitor.getPartitionGauge(),_partitions);
  final int m=n - 1;
  for (int i=0; i < m; i++) {
    Map<String,String> map=externalView.getStateMap(_dbName + "_" + 3 * i);
    String key=map.keySet().toArray()[0].toString();
    map.put(key,"ERROR");
    externalView.setStateMap(_dbName + "_" + 3 * i,map);
  }
  monitor.updateResource(externalView,idealState,"MASTER");
  Assert.assertEquals(monitor.getDifferenceWithIdealStateGauge(),0);
  Assert.assertEquals(monitor.getErrorPartitionGauge(),m);
  Assert.assertEquals(monitor.getExternalViewPartitionGauge(),_partitions);
  Assert.assertEquals(monitor.getPartitionGauge(),_partitions);
  for (int i=0; i < n; i++) {
    externalView.getRecord().getMapFields().remove(_dbName + "_" + 4 * i);
  }
  monitor.updateResource(externalView,idealState,"MASTER");
  Assert.assertEquals(monitor.getDifferenceWithIdealStateGauge(),n * (_replicas + 1));
  Assert.assertEquals(monitor.getErrorPartitionGauge(),3);
  Assert.assertEquals(monitor.getExternalViewPartitionGauge(),_partitions - n);
  Assert.assertEquals(monitor.getPartitionGauge(),_partitions);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.participant.TestControllerElection </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testController() throws Exception {
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  String controllerName="controller_0";
  MockController controller=new MockController(_zkaddr,clusterName,controllerName);
  GenericHelixController pipeline=new GenericHelixController();
  ZkHelixLeaderElection leader=new ZkHelixLeaderElection(controller.getController(),pipeline);
  NotificationContext context=new NotificationContext(controller);
  context.setType(NotificationContext.Type.INIT);
  leader.onControllerChange(context);
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.controllerLeader());
  AssertJUnit.assertEquals(controllerName,liveInstance.getInstanceName());
  String controllerName1="controller_1";
  MockController controller1=new MockController(_zkaddr,clusterName,controllerName1);
  GenericHelixController pipeline1=new GenericHelixController();
  ZkHelixLeaderElection leader1=new ZkHelixLeaderElection(controller1.getController(),pipeline1);
  NotificationContext context1=new NotificationContext(controller1);
  context1.setType(NotificationContext.Type.INIT);
  leader1.onControllerChange(context1);
  liveInstance=accessor.getProperty(keyBuilder.controllerLeader());
  AssertJUnit.assertEquals(controllerName,liveInstance.getInstanceName());
  controller1.getConn().disconnect();
  controller.getConn().disconnect();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testMultiClusterController() throws Exception {
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  String controllerName="controller_0";
  MockMultiClusterController controller=new MockMultiClusterController(_zkaddr,clusterName,controllerName);
  GenericHelixController pipeline=new GenericHelixController();
  ZkHelixLeaderElection leader=new ZkHelixLeaderElection(controller.getController(),pipeline);
  NotificationContext context=new NotificationContext(controller);
  context.setType(NotificationContext.Type.CALLBACK);
  leader.onControllerChange(context);
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.controllerLeader());
  AssertJUnit.assertEquals(controllerName,liveInstance.getInstanceName());
  MockMultiClusterController controller1=new MockMultiClusterController(_zkaddr,clusterName,"controller_1");
  GenericHelixController pipeline1=new GenericHelixController();
  ZkHelixLeaderElection leader1=new ZkHelixLeaderElection(controller.getController(),pipeline1);
  context=new NotificationContext(controller);
  context.setType(NotificationContext.Type.CALLBACK);
  leader1.onControllerChange(context);
  liveInstance=accessor.getProperty(keyBuilder.controllerLeader());
  AssertJUnit.assertEquals(controllerName,liveInstance.getInstanceName());
  controller1.getConn().disconnect();
  controller.getConn().disconnect();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.participant.statemachine.TestStateModelParser </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsingAnnotation(){
  StateModelParser parser=new StateModelParser();
  StateModelUsingAnnotation testModel=new StateModelUsingAnnotation();
  Method method=parser.getMethodForTransitionUsingAnnotation(testModel.getClass(),"offline","slave",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"onBecomeSlaveFromOffline");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedUsingAnnotation(){
  StateModelParser parser=new StateModelParser();
  DerivedStateModelUsingAnnotation testModel=new DerivedStateModelUsingAnnotation();
  Method method=parser.getMethodForTransitionUsingAnnotation(testModel.getClass(),"offline","slave",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"derivedOnBecomeSlaveFromOffline");
  method=parser.getMethodForTransitionUsingAnnotation(testModel.getClass(),"error","dropped",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"onBecomeDroppedFromError");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsingNameConvention(){
  StateModelParser parser=new StateModelParser();
  StateModelUsingNameConvention testModel=new StateModelUsingNameConvention();
  Method method=parser.getMethodForTransition(testModel.getClass(),"error","dropped",new Class[]{Message.class,NotificationContext.class});
  Assert.assertNotNull(method);
  Assert.assertEquals(method.getName(),"onBecomeDroppedFromError");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.resolver.TestZKHelixResolver </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResolution(){
  HelixMessageScope clusterScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).build();
  Set<HelixAddress> destinations=_resolver.getDestinations(clusterScope);
  Assert.assertNotNull(destinations);
  Set<InetSocketAddress> addresses=new HashSet<InetSocketAddress>();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertTrue(addresses.containsAll(_socketMap.values()),"Expected " + _socketMap.values() + ", found "+ addresses);
  HelixMessageScope resourceScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).build();
  destinations=_resolver.getDestinations(resourceScope);
  Assert.assertNotNull(destinations);
  addresses.clear();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertTrue(addresses.containsAll(_socketMap.values()),"Expected " + _socketMap.values() + ", found "+ addresses);
  HelixMessageScope partition0Scope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).partition(RESOURCE_NAME + "_0").build();
  destinations=_resolver.getDestinations(partition0Scope);
  Assert.assertNotNull(destinations);
  ExternalView externalView=_setupTool.getClusterManagementTool().getResourceExternalView(CLUSTER_NAME,RESOURCE_NAME);
  Set<String> instanceSet=externalView.getStateMap(RESOURCE_NAME + "_0").keySet();
  Set<InetSocketAddress> expectedSocketAddrs=Sets.newHashSet();
  for (  String instanceName : instanceSet) {
    expectedSocketAddrs.add(_socketMap.get(instanceName));
  }
  addresses.clear();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertEquals(addresses,expectedSocketAddrs,"Expected " + expectedSocketAddrs + ", found "+ addresses);
  HelixMessageScope sourceInstanceScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).partition(RESOURCE_NAME + "_0").sourceInstance(_participants[0].getInstanceName()).build();
  HelixAddress sourceAddress=_resolver.getSource(sourceInstanceScope);
  Assert.assertNotNull(sourceAddress);
  Assert.assertEquals(sourceAddress.getSocketAddress(),_socketMap.get(_participants[0].getInstanceName()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.TestPropertyStat </h4><pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(groups={"unitTest"}) public void testPropertyStat(){
  PropertyStat stat=new PropertyStat(0,0);
  AssertJUnit.assertEquals(0,stat.getLastModifiedTime());
  AssertJUnit.assertEquals(0,stat.getVersion());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.TestPropertyStoreException </h4><pre class="type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(groups={"unitTest"}) public void testPropertyStoreException(){
  PropertyStoreException exception=new PropertyStoreException("msg");
  AssertJUnit.assertEquals(exception.getMessage(),"msg");
  exception=new PropertyStoreException();
  AssertJUnit.assertNull(exception.getMessage());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestAutoFallbackPropertyStore </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 20; i++) {
    if (i < 10) {
      String path=String.format("%s/%d",fallbackRoot,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
 else {
      String path=String.format("%s/%d",root,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
    }
    paths.add(path);
  }
  List<String> childs=store.getChildNames("/",0);
  Assert.assertNotNull(childs);
  Assert.assertEquals(childs.size(),20);
  for (int i=0; i < 20; i++) {
    String child=childs.get(i);
    Assert.assertTrue(childs.contains(child));
  }
  List<ZNRecord> records=store.getChildren("/",null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    Assert.assertNotNull(record);
    String id=record.getId();
    Assert.assertTrue(childs.contains(id));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test void testMultiGetOnFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertTrue(exists[i]);
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertNotNull(stats[i]);
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),10);
  for (int i=0; i < 10; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNull(record.getSimpleField("key"));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key"));
    Assert.assertEquals(record.getSimpleField("key"),"value");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleUpdateUsingFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean succeed=store.update(path,new MyDataUpdater("new0"),AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNull(record.getSimpleField("key"));
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNotNull(record.getSimpleField("key"));
  Assert.assertEquals(record.getSimpleField("key"),"value");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingNewath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    path=String.format("%s/%d",root,i);
    baseAccessor.create(path,new ZNRecord("new" + i),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    if (i < 10) {
      ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),"" + i);
      Assert.assertNull(record.getSimpleField("key"));
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    ZNRecord record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
    if (i < 10) {
      Assert.assertNotNull(record.getSimpleField("key"));
      Assert.assertEquals(record.getSimpleField("key"),"value");
    }
 else {
      Assert.assertNull(record.getSimpleField("key"));
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    ZNRecord record=new ZNRecord("new" + i);
    records.add(record);
  }
  boolean succeed[]=store.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=String.format("/%d",i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  ZNRecord record=new ZNRecord("new0");
  boolean succeed=store.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"new0");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailOnMultiGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertTrue(exists[i]);
    }
 else {
      Assert.assertFalse(exists[i]);
    }
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertNotNull(stats[i]);
    }
 else {
      Assert.assertNull(stats[i]);
    }
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    if (i < 10) {
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),Integer.toString(i));
    }
 else {
      Assert.assertNull(record);
    }
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleUpdateUsingNewPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",root,i);
    baseAccessor.create(path,new ZNRecord("new" + i),AccessOption.PERSISTENT);
    path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean succeed=store.update(path,new MyDataUpdater("0"),AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNull(record.getSimpleField("key"));
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"new0");
  Assert.assertNotNull(record.getSimpleField("key"));
  Assert.assertEquals(record.getSimpleField("key"),"value");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleGetOnFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean exist=store.exists(path,0);
  Assert.assertTrue(exist);
  Stat stat=store.getStat(path,0);
  Assert.assertNotNull(stat);
  ZNRecord record=store.get(path,null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestZkHelixPropertyStore </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet(){
  System.out.println("START testSet() at " + new Date(System.currentTimeMillis()));
  String subRoot=_root + "/" + "set";
  List<String> subscribedPaths=new ArrayList<String>();
  subscribedPaths.add(subRoot);
  ZkHelixPropertyStore<ZNRecord> store=new ZkHelixPropertyStore<ZNRecord>(new ZkBaseDataAccessor<ZNRecord>(_zkclient),subRoot,subscribedPaths);
  setNodes(store,'a',false);
  for (int i=0; i < 10; i++) {
    for (int j=0; j < 10; j++) {
      String nodeId=getNodeId(i,j);
      String key=getSecondLevelKey(i,j);
      ZNRecord record=store.get(key,null,0);
      Assert.assertEquals(record.getId(),nodeId);
    }
  }
  long startT=System.currentTimeMillis();
  for (int i=0; i < 1000; i++) {
    ZNRecord record=store.get("/node_0/childNode_0_0",null,0);
    Assert.assertNotNull(record);
  }
  long endT=System.currentTimeMillis();
  System.out.println("1000 Get() time used: " + (endT - startT) + "ms");
  long latency=endT - startT;
  Assert.assertTrue(latency < 200,"1000 Gets should be finished within 200ms, but was " + latency + " ms");
  store.stop();
  System.out.println("END testSet() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBackToBackRemoveAndSet() throws Exception {
  System.out.println("START testBackToBackRemoveAndSet() at " + new Date(System.currentTimeMillis()));
  String subRoot=_root + "/" + "backToBackRemoveAndSet";
  List<String> subscribedPaths=new ArrayList<String>();
  subscribedPaths.add(subRoot);
  ZkHelixPropertyStore<ZNRecord> store=new ZkHelixPropertyStore<ZNRecord>(new ZkBaseDataAccessor<ZNRecord>(_zkclient),subRoot,subscribedPaths);
  store.set("/child0",new ZNRecord("child0"),AccessOption.PERSISTENT);
  ZNRecord record=store.get("/child0",null,0);
  Assert.assertEquals(record.getId(),"child0");
  String child0Path=subRoot + "/child0";
  for (int i=0; i < 2; i++) {
    _zkclient.delete(child0Path);
    _zkclient.createPersistent(child0Path,new ZNRecord("child0-new-" + i));
  }
  Thread.sleep(500);
  record=store.get("/child0",null,0);
  Assert.assertEquals(record.getId(),"child0-new-1","Cache shoulde be updated to latest create");
  _zkclient.delete(child0Path);
  Thread.sleep(500);
  try {
    record=store.get("/child0",null,AccessOption.THROW_EXCEPTION_IFNOTEXIST);
    Assert.fail("/child0 should have been removed");
  }
 catch (  ZkNoNodeException e) {
  }
  store.stop();
  System.out.println("END testBackToBackRemoveAndSet() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestZkManagerWithAutoFallbackStore </h4><pre class="type-4 type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",false);
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  BaseDataAccessor<ZNRecord> accessor=participants[0].getHelixDataAccessor().getBaseDataAccessor();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%s/HELIX_PROPERTYSTORE/%d",clusterName,i);
    ZNRecord record=new ZNRecord("" + i);
    record.setSimpleField("key1","value1");
    accessor.set(path,record,AccessOption.PERSISTENT);
  }
  ZkHelixPropertyStore<ZNRecord> store=participants[0].getHelixPropertyStore();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key1"));
    Assert.assertEquals(record.getSimpleField("key1"),"value1");
  }
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    store.update(path,new DataUpdater<ZNRecord>(){
      @Override public ZNRecord update(      ZNRecord currentData){
        if (currentData != null) {
          currentData.setSimpleField("key2","value2");
        }
        return currentData;
      }
    }
,AccessOption.PERSISTENT);
  }
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key1"));
    Assert.assertEquals(record.getSimpleField("key1"),"value1");
    Assert.assertNotNull(record.getSimpleField("key2"));
    Assert.assertEquals(record.getSimpleField("key2"),"value2");
  }
  for (int i=10; i < 20; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=new ZNRecord("" + i);
    record.setSimpleField("key3","value3");
    store.set(path,record,AccessOption.PERSISTENT);
  }
  for (int i=10; i < 20; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key3"));
    Assert.assertEquals(record.getSimpleField("key3"),"value3");
  }
  participants[0].syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestClusterSetup </h4><pre class="type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSetGetRemoveParticipantConfig() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  _setupTool.addCluster(clusterName,true);
  _setupTool.addInstanceToCluster(clusterName,"localhost_0");
  String scopeArgs=clusterName + ",localhost_0";
  String keyValueMap="key1=value1,key2=value2";
  String keys="key1,key2";
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--setConfig",ConfigScopeProperty.PARTICIPANT.toString(),scopeArgs,keyValueMap});
  String valuesStr=_setupTool.getConfig(ConfigScopeProperty.PARTICIPANT,scopeArgs,keys);
  ZNRecordSerializer serializer=new ZNRecordSerializer();
  ZNRecord record=(ZNRecord)serializer.deserialize(valuesStr.getBytes());
  Assert.assertEquals(record.getSimpleField("key1"),"value1");
  Assert.assertEquals(record.getSimpleField("key2"),"value2");
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--removeConfig",ConfigScopeProperty.PARTICIPANT.toString(),scopeArgs,keys});
  valuesStr=_setupTool.getConfig(ConfigScopeProperty.PARTICIPANT,scopeArgs,keys);
  record=(ZNRecord)serializer.deserialize(valuesStr.getBytes());
  Assert.assertNull(record.getSimpleField("key1"));
  Assert.assertNull(record.getSimpleField("key2"));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestHelixAdminCli </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceGroupTags() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String command="-zkSvr " + _zkaddr + " -addCluster "+ clusterName;
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr localhost:2183 -addResource " + clusterName + " db_11 12 MasterSlave";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  for (int i=0; i < 6; i++) {
    command="-zkSvr " + _zkaddr + " -addNode "+ clusterName+ " localhost:123"+ i;
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  for (int i=0; i < 2; i++) {
    command="-zkSvr " + _zkaddr + " -addInstanceTag "+ clusterName+ " localhost_123"+ i+ "  tag1";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  for (int i=2; i < 6; i++) {
    command="-zkSvr " + _zkaddr + " -addInstanceTag "+ clusterName+ " localhost_123"+ i+ "  tag2";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 2 -instanceGroupTag tag1";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  IdealState dbIs=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  Set<ParticipantId> hosts=new HashSet<ParticipantId>();
  for (  PartitionId p : dbIs.getPartitionIdSet()) {
    for (    ParticipantId participantId : dbIs.getParticipantStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(participantId.stringify()));
      Assert.assertTrue(config.containsTag("tag1"));
      hosts.add(participantId);
    }
  }
  Assert.assertEquals(hosts.size(),2);
  command="-zkSvr " + _zkaddr + " -dropResource "+ clusterName+ " db_11 ";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -addResource "+ clusterName+ " db_11 48 MasterSlave";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 3 -instanceGroupTag tag2";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  dbIs=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  hosts=new HashSet<ParticipantId>();
  for (  PartitionId p : dbIs.getPartitionIdSet()) {
    for (    ParticipantId participantId : dbIs.getParticipantStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(participantId.stringify()));
      Assert.assertTrue(config.containsTag("tag2"));
      hosts.add(participantId);
    }
  }
  Assert.assertEquals(hosts.size(),4);
  command="-zkSvr " + _zkaddr + " -dropResource "+ clusterName+ " db_11 ";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  for (int i=3; i <= 3; i++) {
    command="-zkSvr " + _zkaddr + " -removeInstanceTag "+ clusterName+ " localhost_123"+ i+ " tag2";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  command="-zkSvr " + _zkaddr + " -addResource "+ clusterName+ " db_11 48 MasterSlave";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 3 -instanceGroupTag tag2";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  dbIs=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  hosts=new HashSet<ParticipantId>();
  for (  PartitionId p : dbIs.getPartitionIdSet()) {
    for (    ParticipantId participantId : dbIs.getParticipantStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(participantId.stringify()));
      Assert.assertTrue(config.containsTag("tag2"));
      hosts.add(participantId);
    }
  }
  Assert.assertEquals(hosts.size(),3);
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 2 -key alias";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestZkCopy </h4><pre class="type-4 type-7 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String fromPath="/" + clusterName + "/from";
  _zkclient.createPersistent(fromPath,true);
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",fromPath,i,j);
      _zkclient.createPersistent(path,true);
      _zkclient.writeData(path,new ZNRecord(String.format("%d/%d",i,j)));
    }
  }
  String toPath="/" + clusterName + "/to";
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  Assert.assertTrue(_zkclient.exists(toPath));
  Assert.assertNull(_zkclient.readData(toPath));
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",toPath,i,j);
      Assert.assertTrue(_zkclient.exists(path));
      ZNRecord record=_zkclient.readData(path);
      Assert.assertEquals(String.format("%d/%d",i,j),record.getId());
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.util.TestZKClientPool </h4><pre class="type-7 type-5 type-1 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String testName="TestZKClientPool";
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String zkAddr="localhost:2189";
  ZkServer zkServer=TestHelper.startZkServer(zkAddr);
  ZkClient zkClient=ZKClientPool.getZkClient(zkAddr);
  zkClient.createPersistent("/" + testName,new ZNRecord(testName));
  ZNRecord record=zkClient.readData("/" + testName);
  Assert.assertEquals(record.getId(),testName);
  TestHelper.stopZkServer(zkServer);
  zkServer=TestHelper.startZkServer(zkAddr);
  try {
    zkClient=ZKClientPool.getZkClient(zkAddr);
    record=zkClient.readData("/" + testName);
    Assert.fail("should fail on zk no node exception");
  }
 catch (  ZkNoNodeException e) {
  }
catch (  Exception e) {
    Assert.fail("should not fail on exception other than ZkNoNodeException");
  }
  zkClient.createPersistent("/" + testName,new ZNRecord(testName));
  record=zkClient.readData("/" + testName);
  Assert.assertEquals(record.getId(),testName);
  zkClient.close();
  TestHelper.stopZkServer(zkServer);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestHelixAdminScenariosRest </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEnablePartitions() throws IOException, InterruptedException {
  final String clusterName="clusterTestEnablePartitions";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",22);
  rebalanceResource(clusterName,"db_11");
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  HelixDataAccessor accessor=participants.get("localhost_1231").getHelixDataAccessor();
  String hostName="localhost_1231";
  String instanceUrl=getInstanceUrl(clusterName,hostName);
  ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  String response=assertSuccessPostOperation(instanceUrl,enablePartitionCmd("db_11","db_11_0;db_11_11",false),false);
  Assert.assertTrue(response.contains("DISABLED_PARTITION"));
  Assert.assertTrue(response.contains("db_11_0"));
  Assert.assertTrue(response.contains("db_11_11"));
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  Assert.assertEquals(ev.getStateMap("db_11_0").get(hostName),"OFFLINE");
  Assert.assertEquals(ev.getStateMap("db_11_11").get(hostName),"OFFLINE");
  response=assertSuccessPostOperation(instanceUrl,enablePartitionCmd("db_11","db_11_0;db_11_11",true),false);
  Assert.assertFalse(response.contains("db_11_0"));
  Assert.assertFalse(response.contains("db_11_11"));
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  Assert.assertEquals(ev.getStateMap("db_11_0").get(hostName),"MASTER");
  Assert.assertEquals(ev.getStateMap("db_11_11").get(hostName),"SLAVE");
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResources() throws IOException {
  final String clusterName="TestTagAwareness_testGetResources";
  final String TAG="tag";
  final String URL_BASE="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  _setupTool.addCluster(clusterName,true);
  HelixAdmin admin=_setupTool.getClusterManagementTool();
  IdealState taggedResource=new IdealState("taggedResource");
  taggedResource.setInstanceGroupTag(TAG);
  taggedResource.setStateModelDefRef("OnlineOffline");
  admin.addResource(clusterName,taggedResource.getId(),taggedResource);
  IdealState untaggedResource=new IdealState("untaggedResource");
  untaggedResource.setStateModelDefRef("OnlineOffline");
  admin.addResource(clusterName,untaggedResource.getId(),untaggedResource);
  Reference resourceRef=new Reference(URL_BASE);
  Request request=new Request(Method.GET,resourceRef);
  Response response=_gClient.handle(request);
  ZNRecord responseRecord=ClusterRepresentationUtil.JsonToObject(ZNRecord.class,response.getEntityAsText());
  Assert.assertNotNull(responseRecord.getMapField("ResourceTags"));
  Assert.assertEquals(TAG,responseRecord.getMapField("ResourceTags").get(taggedResource.getId()));
  Assert.assertFalse(responseRecord.getMapField("ResourceTags").containsKey(untaggedResource.getId()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRebalanceResource() throws Exception {
  final String clusterName="clusterTestRebalanceResource";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",3,_tag1);
  addResource(clusterName,"db_11",44);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  String idealStateUrl=resourceUrl + "/idealState";
  String response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  ZNRecord record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  deleteUrl(resourceUrl,false);
  final String reourcesUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  response=getUrl(reourcesUrl);
  Assert.assertFalse(response.contains("db_11"));
  addResource(clusterName,"db_11",48);
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  addResource(clusterName,"db_22",55);
  resourceUrl=getResourceUrl(clusterName,"db_22");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_22"));
  Assert.assertEquals(record.getListField("alias_0").size(),2);
  Assert.assertEquals(record.getMapField("alias_0").size(),2);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  Assert.assertFalse(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  addResource(clusterName,"db_33",44);
  resourceUrl=getResourceUrl(clusterName,"db_33");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,null,_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
  addResource(clusterName,"db_44",44);
  resourceUrl=getResourceUrl(clusterName,"db_44");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestResetPartitionState </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testResetPartitionState() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  String hostName="localhost_12918";
  String instanceUrl=getInstanceUrl(clusterName,hostName);
  Map<String,String> paramMap=new HashMap<String,String>();
  paramMap.put(JsonParameters.MANAGEMENT_COMMAND,ClusterSetup.resetPartition);
  paramMap.put(JsonParameters.PARTITION,"TestDB0_nonExist");
  paramMap.put(JsonParameters.RESOURCE,"TestDB0");
  LOG.info("IGNORABLE exception: test reset non-exist partition");
  TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,true);
  errPartitions.clear();
  participants[0].setTransition(new ErrTransitionWithResetCnt(errPartitions));
  clearStatusUpdate(clusterName,"localhost_12918","TestDB0","TestDB0_4");
  _errToOfflineInvoked.set(0);
  paramMap.put(JsonParameters.PARTITION,"TestDB0_4 TestDB0_8");
  TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,false);
  for (int i=0; i < 10; i++) {
    Thread.sleep(400);
    LOG.info("IGNORABLE exception: test reset non-error partition");
    TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,true);
    result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
    if (result == true) {
      break;
    }
  }
  Assert.assertTrue(result);
  Assert.assertEquals(_errToOfflineInvoked.get(),2,"reset() should be invoked 2 times");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
