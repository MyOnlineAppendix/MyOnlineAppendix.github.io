<h3><span class=" glyphicon glyphicon-tag"/>&nbspBooleanVerifier</h3><kbd>Verifies boolean conditions</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.helix.TestHelixConfigAccessor </h4><pre class="type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ConfigAccessor configAccessor=new ConfigAccessor(_zkclient);
  HelixConfigScope clusterScope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build();
  String clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue);
  configAccessor.set(clusterScope,"clusterConfigKey","clusterConfigValue");
  clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertEquals(clusterConfigValue,"clusterConfigValue");
  HelixConfigScope resourceScope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).forResource("testResource").build();
  configAccessor.set(resourceScope,"resourceConfigKey","resourceConfigValue");
  String resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertEquals(resourceConfigValue,"resourceConfigValue");
  HelixConfigScope partitionScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  configAccessor.set(partitionScope,"partitionConfigKey","partitionConfigValue");
  String partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertEquals(partitionConfigValue,"partitionConfigValue");
  HelixConfigScope participantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build();
  configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
  String participantConfigValue=configAccessor.get(participantScope,"participantConfigKey");
  Assert.assertEquals(participantConfigValue,"participantConfigValue");
  List<String> keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).build());
  Assert.assertEquals(keys.size(),1,"should be [testResource]");
  Assert.assertEquals(keys.get(0),"testResource");
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).build());
  Assert.assertEquals(keys.size(),5,"should be [localhost_12918~22] sorted");
  Assert.assertTrue(keys.contains("localhost_12918"));
  Assert.assertTrue(keys.contains("localhost_12922"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").build());
  Assert.assertEquals(keys.size(),1,"should be [testPartition]");
  Assert.assertEquals(keys.get(0),"testPartition");
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).forResource("testResource").build());
  Assert.assertEquals(keys.size(),1,"should be [resourceConfigKey]");
  Assert.assertTrue(keys.contains("resourceConfigKey"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build());
  Assert.assertEquals(keys.size(),1,"should be [clusterConfigKey]");
  Assert.assertTrue(keys.contains("clusterConfigKey"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build());
  Assert.assertEquals(keys.size(),4,"should be [HELIX_ENABLED, HELIX_PORT, HELIX_HOST, participantConfigKey]");
  Assert.assertTrue(keys.contains("participantConfigKey"));
  keys=configAccessor.getKeys(new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build());
  Assert.assertEquals(keys.size(),1,"should be [partitionConfigKey]");
  Assert.assertEquals(keys.get(0),"partitionConfigKey");
  configAccessor.remove(clusterScope,"clusterConfigKey");
  clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue,"Should be null since it's removed");
  configAccessor.remove(resourceScope,"resourceConfigKey");
  resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertNull(resourceConfigValue,"Should be null since it's removed");
  configAccessor.remove(partitionScope,"partitionConfigKey");
  partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertNull(partitionConfigValue,"Should be null since it's removed");
  configAccessor.remove(participantScope,"participantConfigKey");
  participantConfigValue=configAccessor.get(partitionScope,"participantConfigKey");
  Assert.assertNull(participantConfigValue,"Should be null since it's removed");
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forPartition("testPartition").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forParticipant("testParticipant").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster("testCluster").forPartition("testPartition").build();
    Assert.fail("Should fail since resource name is not set");
  }
 catch (  Exception e) {
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestHelixTaskExecutor </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testCMTaskExecutor() throws Exception {
  System.out.println("START TestCMTaskExecutor");
  MessageId msgId=MessageId.from("TestMessageId");
  Message message=new Message(MessageType.TASK_REPLY,msgId);
  message.setMessageId(msgId);
  message.setSrcName("cm-instance-0");
  message.setTgtName("cm-instance-1");
  message.setTgtSessionId(SessionId.from("1234"));
  message.setFromState(State.from("Offline"));
  message.setToState(State.from("Slave"));
  message.setPartitionId(PartitionId.from("TestDB_0"));
  message.setResourceId(ResourceId.from("TestDB"));
  message.setStateModelDef(StateModelDefId.from("MasterSlave"));
  MockManager manager=new MockManager("clusterName");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  StateModelDefinition stateModelDef=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.stateModelDef("MasterSlave"),stateModelDef);
  MockHelixTaskExecutor executor=new MockHelixTaskExecutor();
  MockStateModel stateModel=new MockStateModel();
  executor.registerMessageHandlerFactory(MessageType.TASK_REPLY.toString(),new AsyncCallbackService());
  NotificationContext context=new NotificationContext(manager);
  CurrentState currentStateDelta=new CurrentState("TestDB");
  currentStateDelta.setState(PartitionId.from("TestDB_0"),State.from("OFFLINE"));
  StateTransitionHandlerFactory<MockStateModel> stateModelFactory=new StateTransitionHandlerFactory<MockStateModel>(){
    @Override public MockStateModel createStateTransitionHandler(    ResourceId resource,    PartitionId partition){
      return new MockStateModel();
    }
  }
;
  HelixStateTransitionHandler handler=new HelixStateTransitionHandler(stateModelFactory,stateModel,message,context,currentStateDelta);
  HelixTask task=new HelixTask(message,context,handler,executor);
  executor.scheduleTask(task);
  for (int i=0; i < 10; i++) {
    if (!executor.isDone(task.getTaskId())) {
      Thread.sleep(500);
    }
  }
  AssertJUnit.assertTrue(stateModel.stateModelInvoked);
  System.out.println("END TestCMTaskExecutor");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestHelixTaskHandler </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testInvocationAnnotated() throws Exception {
  System.out.println("START TestCMTaskHandler.testInvocationAnnotated() at " + new Date(System.currentTimeMillis()));
  HelixTaskExecutor executor=new HelixTaskExecutor();
  Message message=new Message(MessageType.STATE_TRANSITION,MessageId.from("Some unique id"));
  message.setSrcName("cm-instance-0");
  message.setTgtSessionId(SessionId.from("1234"));
  message.setFromState(State.from("Offline"));
  message.setToState(State.from("Slave"));
  message.setPartitionId(PartitionId.from("TestDB_0"));
  message.setMessageId(MessageId.from("Some unique message id"));
  message.setResourceId(ResourceId.from("TestDB"));
  message.setTgtName("localhost");
  message.setStateModelDef(StateModelDefId.from("MasterSlave"));
  message.setStateModelFactoryName(HelixConstants.DEFAULT_STATE_MODEL_FACTORY);
  MockStateModelAnnotated stateModel=new MockStateModelAnnotated();
  NotificationContext context;
  MockManager manager=new MockManager("clusterName");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  StateModelDefinition stateModelDef=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.stateModelDef("MasterSlave"),stateModelDef);
  context=new NotificationContext(manager);
  CurrentState currentStateDelta=new CurrentState("TestDB");
  currentStateDelta.setState(PartitionId.from("TestDB_0"),State.from("OFFLINE"));
  StateTransitionHandlerFactory<MockStateModelAnnotated> stateModelFactory=new StateTransitionHandlerFactory<MockStateModelAnnotated>(){
    @Override public MockStateModelAnnotated createStateTransitionHandler(    ResourceId resource,    PartitionId partitionName){
      return new MockStateModelAnnotated();
    }
  }
;
  HelixStateTransitionHandler stHandler=new HelixStateTransitionHandler(stateModelFactory,stateModel,message,context,currentStateDelta);
  HelixTask handler=new HelixTask(message,context,stHandler,executor);
  handler.call();
  AssertJUnit.assertTrue(stateModel.stateModelInvoked);
  System.out.println("END TestCMTaskHandler.testInvocationAnnotated() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testInvocation() throws Exception {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  System.out.println("START TestCMTaskHandler.testInvocation()");
  Message message=new Message(MessageType.STATE_TRANSITION,MessageId.from("Some unique id"));
  message.setSrcName("cm-instance-0");
  message.setTgtSessionId(SessionId.from("1234"));
  message.setFromState(State.from("Offline"));
  message.setToState(State.from("Slave"));
  message.setPartitionId(PartitionId.from("TestDB_0"));
  message.setMessageId(MessageId.from("Some unique message id"));
  message.setResourceId(ResourceId.from("TestDB"));
  message.setTgtName("localhost");
  message.setStateModelDef(StateModelDefId.from("MasterSlave"));
  message.setStateModelFactoryName(HelixConstants.DEFAULT_STATE_MODEL_FACTORY);
  MockStateModel stateModel=new MockStateModel();
  NotificationContext context;
  MockManager manager=new MockManager("clusterName");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  StateModelDefinition stateModelDef=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.stateModelDef("MasterSlave"),stateModelDef);
  context=new NotificationContext(manager);
  CurrentState currentStateDelta=new CurrentState("TestDB");
  currentStateDelta.setState(PartitionId.from("TestDB_0"),State.from("OFFLINE"));
  HelixStateTransitionHandler stHandler=new HelixStateTransitionHandler(null,stateModel,message,context,currentStateDelta);
  HelixTask handler;
  handler=new HelixTask(message,context,stHandler,executor);
  handler.call();
  AssertJUnit.assertTrue(stateModel.stateModelInvoked);
  System.out.println("END TestCMTaskHandler.testInvocation() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestHelixVersionCompare </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNonNumericalVersionCompare(){
  boolean isNoLessThan=HelixManagerProperties.versionNoLessThan("project.version1","project.version2");
  Assert.assertTrue(isNoLessThan,"Skip version compare if non-numerical version is specified");
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNullVersionCompare(){
  boolean isNoLessThan=HelixManagerProperties.versionNoLessThan(null,null);
  Assert.assertTrue(isNoLessThan,"Skip version compare if no version is specified");
  isNoLessThan=HelixManagerProperties.versionNoLessThan("1.0",null);
  Assert.assertTrue(isNoLessThan,"Skip version compare if no version is specified");
  isNoLessThan=HelixManagerProperties.versionNoLessThan(null,"1.0");
  Assert.assertTrue(isNoLessThan,"Skip version compare if no version is specified");
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testEmptyVersionCompare(){
  boolean isNoLessThan=HelixManagerProperties.versionNoLessThan("","");
  Assert.assertTrue(isNoLessThan,"Skip version compare if empty version is specified");
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNumericalVersionCompare(){
  boolean isNoLessThan=HelixManagerProperties.versionNoLessThan("0.7.0","0.6.1");
  Assert.assertTrue(isNoLessThan);
  isNoLessThan=HelixManagerProperties.versionNoLessThan("0.5.31","0.6.1");
  Assert.assertFalse(isNoLessThan);
  isNoLessThan=HelixManagerProperties.versionNoLessThan("0.5.31-SNAPSHOT","0.6.1");
  Assert.assertFalse(isNoLessThan);
  isNoLessThan=HelixManagerProperties.versionNoLessThan("0.5.31-incubating","0.6.1");
  Assert.assertFalse(isNoLessThan);
  isNoLessThan=HelixManagerProperties.versionNoLessThan("0.7.0","0.6.1-SNAPSHOT");
  Assert.assertTrue(isNoLessThan);
  isNoLessThan=HelixManagerProperties.versionNoLessThan("0.7.0","0.6.1-incubating");
  Assert.assertTrue(isNoLessThan);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestHierarchicalDataStore </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testHierarchicalDataStore(){
  client=new ZkClient(_zkaddr,1000,3000);
  String path="/tmp/testHierarchicalDataStore";
  FileFilter filter=null;
  client.deleteRecursive(path);
  HierarchicalDataHolder<ZNRecord> dataHolder=new HierarchicalDataHolder<ZNRecord>(client,path,filter);
  dataHolder.print();
  AssertJUnit.assertFalse(dataHolder.refreshData());
  add(path,"root data");
  AssertJUnit.assertTrue(dataHolder.refreshData());
  dataHolder.print();
  add(path + "/child1","child 1 data");
  add(path + "/child2","child 2 data");
  AssertJUnit.assertTrue(dataHolder.refreshData());
  dataHolder.print();
  add(path + "/child1" + "/grandchild1","grand child 1 data");
  add(path + "/child1" + "/grandchild2","grand child 2 data");
  AssertJUnit.assertTrue(dataHolder.refreshData());
  dataHolder.print();
  AssertJUnit.assertFalse(dataHolder.refreshData());
  set(path + "/child1","new child 1 data");
  AssertJUnit.assertTrue(dataHolder.refreshData());
  dataHolder.print();
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestListenerCallback </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixManager manager=HelixManagerFactory.getZKHelixManager(clusterName,"localhost",InstanceType.SPECTATOR,_zkaddr);
  manager.connect();
  TestListener listener=new TestListener();
  listener._instanceConfigChanged=false;
  manager.addInstanceConfigChangeListener(listener);
  Assert.assertTrue(listener._instanceConfigChanged,"Should get initial instanceConfig callback invoked");
  listener._configChanged=false;
  manager.addConfigChangeListener(listener,ConfigScopeProperty.CLUSTER);
  Assert.assertTrue(listener._configChanged,"Should get initial clusterConfig callback invoked");
  listener._configChanged=false;
  manager.addConfigChangeListener(listener,ConfigScopeProperty.RESOURCE);
  Assert.assertTrue(listener._configChanged,"Should get initial resourceConfig callback invoked");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  String instanceName="localhost_12918";
  HelixProperty value=accessor.getProperty(keyBuilder.instanceConfig(instanceName));
  value._record.setSimpleField("" + System.currentTimeMillis(),"newValue");
  listener._instanceConfigChanged=false;
  accessor.setProperty(keyBuilder.instanceConfig(instanceName),value);
  Thread.sleep(1000);
  Assert.assertTrue(listener._instanceConfigChanged,"Should get instanceConfig callback invoked since we change instanceConfig");
  value=accessor.getProperty(keyBuilder.clusterConfig());
  value._record.setSimpleField("" + System.currentTimeMillis(),"newValue");
  listener._configChanged=false;
  accessor.setProperty(keyBuilder.clusterConfig(),value);
  Thread.sleep(1000);
  Assert.assertTrue(listener._configChanged,"Should get clusterConfig callback invoked since we change clusterConfig");
  String resourceName="TestDB_0";
  value=new HelixProperty(resourceName);
  value._record.setSimpleField("" + System.currentTimeMillis(),"newValue");
  listener._configChanged=false;
  accessor.setProperty(keyBuilder.resourceConfig(resourceName),value);
  Thread.sleep(1000);
  Assert.assertTrue(listener._configChanged,"Should get resourceConfig callback invoked since we add resourceConfig");
  value._record.setSimpleField("" + System.currentTimeMillis(),"newValue");
  listener._configChanged=false;
  accessor.setProperty(keyBuilder.resourceConfig(resourceName),value);
  Thread.sleep(1000);
  Assert.assertTrue(listener._configChanged,"Should get resourceConfig callback invoked since we change resourceConfig");
  listener._configChanged=false;
  accessor.removeProperty(keyBuilder.resourceConfig(resourceName));
  Thread.sleep(1000);
  Assert.assertTrue(listener._configChanged,"Should get resourceConfig callback invoked since we delete resourceConfig");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZKCallback </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testInvocation() throws Exception {
  HelixManager testHelixManager=HelixManagerFactory.getZKHelixManager(clusterName,"localhost_8900",InstanceType.PARTICIPANT,_zkaddr);
  testHelixManager.connect();
  TestZKCallback test=new TestZKCallback();
  TestZKCallback.TestCallbackListener testListener=test.new TestCallbackListener();
  testHelixManager.addMessageListener(testListener,"localhost_8900");
  testHelixManager.addCurrentStateChangeListener(testListener,"localhost_8900",testHelixManager.getSessionId());
  testHelixManager.addInstanceConfigChangeListener(testListener);
  testHelixManager.addIdealStateChangeListener(testListener);
  testHelixManager.addExternalViewChangeListener(testListener);
  testHelixManager.addLiveInstanceChangeListener(testListener);
  AssertJUnit.assertTrue(testListener.configChangeReceived & testListener.currentStateChangeReceived & testListener.externalViewChangeReceived& testListener.idealStateChangeReceived& testListener.liveInstanceChangeReceived& testListener.messageChangeReceived);
  testListener.Reset();
  HelixDataAccessor accessor=testHelixManager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  ExternalView extView=new ExternalView("db-12345");
  accessor.setProperty(keyBuilder.externalView("db-12345"),extView);
  Thread.sleep(100);
  AssertJUnit.assertTrue(testListener.externalViewChangeReceived);
  testListener.Reset();
  CurrentState curState=new CurrentState("db-12345");
  curState.setSessionId(SessionId.from("sessionId"));
  curState.setStateModelDefRef("StateModelDef");
  accessor.setProperty(keyBuilder.currentState("localhost_8900",testHelixManager.getSessionId(),curState.getId()),curState);
  Thread.sleep(100);
  AssertJUnit.assertTrue(testListener.currentStateChangeReceived);
  testListener.Reset();
  IdealState idealState=new IdealState("db-1234");
  idealState.setNumPartitions(400);
  idealState.setReplicas(Integer.toString(2));
  idealState.setStateModelDefId(StateModelDefId.from("StateModeldef"));
  accessor.setProperty(keyBuilder.idealStates("db-1234"),idealState);
  Thread.sleep(100);
  AssertJUnit.assertTrue(testListener.idealStateChangeReceived);
  testListener.Reset();
  testListener.Reset();
  Message message=new Message(MessageType.STATE_TRANSITION,MessageId.from(UUID.randomUUID().toString()));
  message.setTgtSessionId(SessionId.from("*"));
  message.setResourceId(ResourceId.from("testResource"));
  message.setPartitionId(PartitionId.from("testPartitionKey"));
  message.setStateModelDef(StateModelDefId.from("MasterSlave"));
  message.setToState(State.from("toState"));
  message.setFromState(State.from("fromState"));
  message.setTgtName("testTarget");
  message.setStateModelFactoryName(HelixConstants.DEFAULT_STATE_MODEL_FACTORY);
  accessor.setProperty(keyBuilder.message("localhost_8900",message.getId()),message);
  Thread.sleep(500);
  AssertJUnit.assertTrue(testListener.messageChangeReceived);
  LiveInstance liveInstance=new LiveInstance("localhost_9801");
  liveInstance.setSessionId(UUID.randomUUID().toString());
  liveInstance.setHelixVersion(UUID.randomUUID().toString());
  accessor.setProperty(keyBuilder.liveInstance("localhost_9801"),liveInstance);
  Thread.sleep(500);
  AssertJUnit.assertTrue(testListener.liveInstanceChangeReceived);
  testListener.Reset();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZkBasis </h4><pre class="type-8 type-2 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test zk watchers are renewed automatically after session expiry
 * zookeeper-client side keeps all registered watchers see ZooKeeper.WatchRegistration.register()
 * after session expiry, all watchers are renewed
 * if a path that has watches on it has been removed during session expiry,
 * the watchers on that path will still get callbacks after session renewal, especially:
 * a data-watch will get data-deleted callback
 * a child-watch will get a child-change callback with current-child-list = null
 * this can be used for cleanup watchers on the zookeeper-client side
 */
@Test public void testWatchRenew() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  final ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  final String path="/" + testName + "/test";
  client.delete(path);
  ZkListener listener=new ZkListener();
  client.subscribeDataChanges(path,listener);
  client.subscribeChildChanges(path,listener);
  ZkTestHelper.expireSession(client);
  boolean succeed=listener._childChangeCountDown.await(10,TimeUnit.SECONDS);
  Assert.assertTrue(succeed,"fail to wait on child-change count-down in 10 seconds after session-expiry");
  Assert.assertEquals(listener._parentPath,path,"fail to get child-change callback after session-expiry");
  Assert.assertNull(listener._currentChilds,"fail to get child-change callback with currentChilds=null after session expiry");
  succeed=listener._dataDeleteCountDown.await(10,TimeUnit.SECONDS);
  Assert.assertTrue(succeed,"fail to wait on data-delete count-down in 10 seconds after session-expiry");
  Assert.assertEquals(listener._dataDeletePath,path,"fail to get data-delete callback after session-expiry");
  client.close();
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * after calling zkclient#unsubscribeXXXListener()
 * an already registered watch will not be removed from ZooKeeper#watchManager#XXXWatches
 * immediately.
 * the watch will get removed on the following conditions:
 * 1) there is a set/delete on the listening path via the zkclient
 * 2) session expiry on the zkclient (i.e. the watch will not be renewed after session expiry)
 * @throws Exception
 */
@Test public void testWatchRemove() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  final ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  final String path="/" + testName + "/test";
  client.createPersistent(path,true);
  ZkListener listener=new ZkListener();
  client.subscribeDataChanges(path,listener);
  client.subscribeChildChanges(path,listener);
  Map<String,Set<IZkDataListener>> dataListenerMap=ZkTestHelper.getZkDataListener(client);
  Assert.assertEquals(dataListenerMap.size(),1,"ZkClient#_dataListener should have 1 listener");
  Set<IZkDataListener> dataListenerSet=dataListenerMap.get(path);
  Assert.assertNotNull(dataListenerSet,"ZkClient#_dataListener should have 1 listener on path: " + path);
  Assert.assertEquals(dataListenerSet.size(),1,"ZkClient#_dataListener should have 1 listener on path: " + path);
  Map<String,Set<IZkChildListener>> childListenerMap=ZkTestHelper.getZkChildListener(client);
  Assert.assertEquals(childListenerMap.size(),1,"ZkClient#_childListener should have 1 listener");
  Set<IZkChildListener> childListenerSet=childListenerMap.get(path);
  Assert.assertNotNull(childListenerSet,"ZkClient#_childListener should have 1 listener on path: " + path);
  Assert.assertEquals(childListenerSet.size(),1,"ZkClient#_childListener should have 1 listener on path: " + path);
  Map<String,List<String>> watchMap=ZkTestHelper.getZkWatch(client);
  List<String> dataWatch=watchMap.get("dataWatches");
  Assert.assertNotNull(dataWatch,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  Assert.assertEquals(dataWatch.size(),1,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  Assert.assertEquals(dataWatch.get(0),path,"ZooKeeper#watchManager#dataWatches should have 1 data watch on path: " + path);
  List<String> childWatch=watchMap.get("childWatches");
  Assert.assertNotNull(childWatch,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  Assert.assertEquals(childWatch.size(),1,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  Assert.assertEquals(childWatch.get(0),path,"ZooKeeper#watchManager#childWatches should have 1 child watch on path: " + path);
  client.unsubscribeDataChanges(path,listener);
  client.unsubscribeChildChanges(path,listener);
  ZkTestHelper.expireSession(client);
  watchMap=ZkTestHelper.getZkWatch(client);
  dataWatch=watchMap.get("dataWatches");
  Assert.assertTrue(dataWatch.isEmpty(),"ZooKeeper#watchManager#dataWatches should be empty");
  childWatch=watchMap.get("childWatches");
  Assert.assertTrue(childWatch.isEmpty(),"ZooKeeper#watchManager#childWatches should be empty");
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZnodeModify </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDataTriggerWithTimeout() throws Exception {
  logger.info("RUN: " + new Date(System.currentTimeMillis()));
  List<TestCommand> commandList=new ArrayList<TestCommand>();
  final String pathChild1=PREFIX + "/dataTriggerWithTimeout_child1";
  final ZNRecord record=getExampleZNRecord();
  ZNRecord recordNew=new ZNRecord(record);
  recordNew.setSimpleField(IdealStateProperty.REBALANCE_MODE.toString(),RebalanceMode.SEMI_AUTO.toString());
  ZnodeOpArg arg1=new ZnodeOpArg(pathChild1,ZnodePropertyType.ZNODE,"+",recordNew);
  TestCommand command1=new TestCommand(CommandType.MODIFY,new TestTrigger(0,8000,record),arg1);
  commandList.add(command1);
  arg1=new ZnodeOpArg(pathChild1,ZnodePropertyType.ZNODE,"==");
  command1=new TestCommand(CommandType.VERIFY,new TestTrigger(9000,500,recordNew),arg1);
  commandList.add(command1);
  new Thread(){
    @Override public void run(){
      try {
        Thread.sleep(3000);
        final ZkClient zkClient=new ZkClient(_zkaddr);
        zkClient.setZkSerializer(new ZNRecordSerializer());
        zkClient.createPersistent(pathChild1,true);
        zkClient.writeData(pathChild1,record);
      }
 catch (      InterruptedException e) {
        logger.error("Interrupted sleep",e);
      }
    }
  }
.start();
  Map<TestCommand,Boolean> results=TestExecutor.executeTest(commandList,_zkaddr);
  for (  Map.Entry<TestCommand,Boolean> entry : results.entrySet()) {
    Assert.assertTrue(entry.getValue());
  }
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testBasic() throws Exception {
  logger.info("RUN: " + new Date(System.currentTimeMillis()));
  List<TestCommand> commandList=new ArrayList<TestCommand>();
  String pathChild1=PREFIX + "/basic_child1";
  String pathChild2=PREFIX + "/basic_child2";
  TestCommand command;
  ZnodeOpArg arg;
  arg=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"+","key1","simpleValue1");
  command=new TestCommand(CommandType.MODIFY,arg);
  commandList.add(command);
  List<String> list=new ArrayList<String>();
  list.add("listValue1");
  list.add("listValue2");
  arg=new ZnodeOpArg(pathChild1,ZnodePropertyType.LIST,"+","key2",list);
  command=new TestCommand(CommandType.MODIFY,arg);
  commandList.add(command);
  ZNRecord record=getExampleZNRecord();
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"+",record);
  command=new TestCommand(CommandType.MODIFY,arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"==","key1");
  command=new TestCommand(CommandType.VERIFY,new TestTrigger(1000,0,"simpleValue1"),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild1,ZnodePropertyType.LIST,"==","key2");
  command=new TestCommand(CommandType.VERIFY,new TestTrigger(1000,0,list),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"==");
  command=new TestCommand(CommandType.VERIFY,new TestTrigger(1000,0,record),arg);
  commandList.add(command);
  Map<TestCommand,Boolean> results=TestExecutor.executeTest(commandList,_zkaddr);
  for (  Map.Entry<TestCommand,Boolean> entry : results.entrySet()) {
    Assert.assertTrue(entry.getValue());
  }
  logger.info("END: " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test() public void testDataTrigger() throws Exception {
  logger.info("RUN: " + new Date(System.currentTimeMillis()));
  List<TestCommand> commandList=new ArrayList<TestCommand>();
  String pathChild1=PREFIX + "/data_trigger_child1";
  String pathChild2=PREFIX + "/data_trigger_child2";
  ZnodeOpArg arg;
  TestCommand command;
  ZnodeOpArg arg1=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"+","key1","simpleValue1-new");
  TestCommand command1=new TestCommand(CommandType.MODIFY,new TestTrigger(0,0,"simpleValue1"),arg1);
  commandList.add(command1);
  ZNRecord record=getExampleZNRecord();
  ZNRecord recordNew=new ZNRecord(record);
  recordNew.setSimpleField(IdealStateProperty.REBALANCE_MODE.toString(),RebalanceMode.SEMI_AUTO.toString());
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"+",recordNew);
  command=new TestCommand(CommandType.MODIFY,new TestTrigger(0,3000,record),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"+",record);
  command=new TestCommand(CommandType.MODIFY,new TestTrigger(1000),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"!=","key1");
  command=new TestCommand(CommandType.VERIFY,new TestTrigger(3100,0,"simpleValue1-new"),arg);
  commandList.add(command);
  arg=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"==");
  command=new TestCommand(CommandType.VERIFY,new TestTrigger(3100,0,recordNew),arg);
  commandList.add(command);
  Map<TestCommand,Boolean> results=TestExecutor.executeTest(commandList,_zkaddr);
  boolean result=results.remove(command1).booleanValue();
  AssertJUnit.assertFalse(result);
  for (  Map.Entry<TestCommand,Boolean> entry : results.entrySet()) {
    Assert.assertTrue(entry.getValue());
  }
  logger.info("END: " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testTimeout() throws Exception {
  logger.info("RUN: " + new Date(System.currentTimeMillis()));
  List<TestCommand> commandList=new ArrayList<TestCommand>();
  String pathChild1=PREFIX + "/timeout_child1";
  String pathChild2=PREFIX + "/timeout_child2";
  ZnodeOpArg arg1=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"+","key1","simpleValue1-new");
  TestCommand command1=new TestCommand(CommandType.MODIFY,new TestTrigger(0,1000,"simpleValue1"),arg1);
  commandList.add(command1);
  ZNRecord record=getExampleZNRecord();
  ZNRecord recordNew=new ZNRecord(record);
  recordNew.setSimpleField(IdealStateProperty.REBALANCE_MODE.toString(),RebalanceMode.SEMI_AUTO.toString());
  arg1=new ZnodeOpArg(pathChild2,ZnodePropertyType.ZNODE,"+",recordNew);
  command1=new TestCommand(CommandType.MODIFY,new TestTrigger(0,500,record),arg1);
  commandList.add(command1);
  arg1=new ZnodeOpArg(pathChild1,ZnodePropertyType.SIMPLE,"==","key1");
  command1=new TestCommand(CommandType.VERIFY,new TestTrigger(1000,500,"simpleValue1-new"),arg1);
  commandList.add(command1);
  arg1=new ZnodeOpArg(pathChild1,ZnodePropertyType.ZNODE,"==");
  command1=new TestCommand(CommandType.VERIFY,new TestTrigger(1000,500,recordNew),arg1);
  commandList.add(command1);
  Map<TestCommand,Boolean> results=TestExecutor.executeTest(commandList,_zkaddr);
  for (  Map.Entry<TestCommand,Boolean> entry : results.entrySet()) {
    Assert.assertFalse(entry.getValue());
  }
  logger.info("END: " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.agent.TestHelixAgent </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  final int n=1;
  final String zkAddr=_zkaddr;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,zkAddr,12918,"localhost","TestDB",1,1,n,1,"MasterSlave",true);
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build();
  ConfigAccessor configAccessor=new ConfigAccessor(_zkclient);
  CommandConfig.Builder builder=new CommandConfig.Builder();
  CommandConfig cmdConfig=builder.setTransition("SLAVE","MASTER").setCommand("simpleHttpClient.py SLAVE-MASTER").setCommandWorkingDir(workingDir).setCommandTimeout("0").build();
  configAccessor.set(scope,cmdConfig.toKeyValueMap());
  builder=new CommandConfig.Builder();
  cmdConfig=builder.setTransition("OFFLINE","SLAVE").setCommand("simpleHttpClient.py OFFLINE-SLAVE").setCommandWorkingDir(workingDir).build();
  configAccessor.set(scope,cmdConfig.toKeyValueMap());
  builder=new CommandConfig.Builder();
  cmdConfig=builder.setTransition("MASTER","SLAVE").setCommand("simpleHttpClient.py MASTER-SLAVE").setCommandWorkingDir(workingDir).build();
  configAccessor.set(scope,cmdConfig.toKeyValueMap());
  builder=new CommandConfig.Builder();
  cmdConfig=builder.setTransition("SLAVE","OFFLINE").setCommand("simpleHttpClient.py SLAVE-OFFLINE").setCommandWorkingDir(workingDir).build();
  configAccessor.set(scope,cmdConfig.toKeyValueMap());
  builder=new CommandConfig.Builder();
  cmdConfig=builder.setTransition("OFFLINE","DROPPED").setCommand(CommandAttribute.NOP.getName()).build();
  configAccessor.set(scope,cmdConfig.toKeyValueMap());
  MockController controller=new MockController(zkAddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Thread> agents=new HashMap<String,Thread>();
  for (int i=0; i < n; i++) {
    final String instanceName="localhost_" + (12918 + i);
    Thread agentThread=new Thread(){
      @Override public void run(){
        try {
          HelixAgentMain.main(new String[]{"--zkSvr",zkAddr,"--cluster",clusterName,"--instanceName",instanceName,"--stateModel","MasterSlave"});
        }
 catch (        Exception e) {
          LOG.error("Exception start helix-agent",e);
        }
      }
    }
;
    agents.put(instanceName,agentThread);
    agentThread.start();
    Thread.sleep(1000);
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropResource",clusterName,"TestDB0"});
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (  Thread agentThread : agents.values()) {
    agentThread.interrupt();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.TestId </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Check that equality with string works
 */
@Test public void testStringEquality(){
  final String resourceName="Resource";
  Assert.assertTrue(ResourceId.from(resourceName).equals(resourceName));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.TestNamespacedConfig </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure that user configs are separated from helix configs in properties that hold both
 */
@Test public void testUserConfigUpdates(){
  final String testKey="testKey";
  final String prefixedKey=UserConfig.class.getSimpleName() + "!testKey";
  final String testSimpleValue="testValue";
  final List<String> testListValue=ImmutableList.of("testValue");
  final Map<String,String> testMapValue=ImmutableMap.of("testInnerKey","testValue");
  ParticipantId participantId=ParticipantId.from("testParticipant");
  InstanceConfig instanceConfig=new InstanceConfig(participantId);
  instanceConfig.setHostName("localhost");
  UserConfig userConfig=new UserConfig(Scope.participant(participantId));
  userConfig.setSimpleField(testKey,testSimpleValue);
  userConfig.setListField(testKey,testListValue);
  userConfig.setMapField(testKey,testMapValue);
  instanceConfig.addNamespacedConfig(userConfig);
  UserConfig retrievedConfig=UserConfig.from(instanceConfig);
  Assert.assertTrue(instanceConfig.getHostName().equals("localhost"));
  Assert.assertEquals(retrievedConfig.getStringField(InstanceConfigProperty.HELIX_HOST.toString(),"not localhost"),"not localhost");
  Assert.assertEquals(userConfig.getSimpleField(testKey),testSimpleValue);
  Assert.assertEquals(userConfig.getListField(testKey),testListValue);
  Assert.assertEquals(userConfig.getMapField(testKey),testMapValue);
  Assert.assertEquals(retrievedConfig.getSimpleField(testKey),testSimpleValue);
  Assert.assertEquals(retrievedConfig.getListField(testKey),testListValue);
  Assert.assertEquals(retrievedConfig.getMapField(testKey),testMapValue);
  Assert.assertEquals(instanceConfig.getRecord().getSimpleField(prefixedKey),testSimpleValue);
  Assert.assertEquals(instanceConfig.getRecord().getListField(prefixedKey),testListValue);
  Assert.assertEquals(instanceConfig.getRecord().getMapField(prefixedKey),testMapValue);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.accessor.TestAccessorRecreate </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test just makes sure that a participant is only recreated if it is incomplete. This is not
 * directly testing atomicity, but rather a use case where a machine died while creating the
 * participant.
 */
@Test public void testRecreateParticipant(){
  final String MODIFIER="modifier";
  final ClusterId clusterId=ClusterId.from("testCluster");
  final ParticipantId participantId=ParticipantId.from("testParticipant");
  boolean connected=_zkclient.waitUntilConnected(30000,TimeUnit.MILLISECONDS);
  if (!connected) {
    LOG.warn("Connection not established");
    return;
  }
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor helixAccessor=new ZKHelixDataAccessor(clusterId.stringify(),baseAccessor);
  ClusterAccessor accessor=new ClusterAccessor(clusterId,helixAccessor);
  boolean clusterCreated=createCluster(clusterId,accessor,MODIFIER,0);
  Assert.assertTrue(clusterCreated);
  boolean created=createParticipant(participantId,accessor,MODIFIER,1);
  Assert.assertTrue(created);
  Participant participantSnapshot=accessor.readParticipant(participantId);
  Assert.assertEquals(participantSnapshot.getUserConfig().getIntField(MODIFIER,-1),1);
  boolean created2=createParticipant(participantId,accessor,MODIFIER,2);
  Assert.assertFalse(created2);
  helixAccessor.removeProperty(helixAccessor.keyBuilder().messages(participantId.stringify()));
  created2=createParticipant(participantId,accessor,MODIFIER,2);
  Assert.assertTrue(created2);
  participantSnapshot=accessor.readParticipant(participantId);
  Assert.assertEquals(participantSnapshot.getUserConfig().getIntField(MODIFIER,-1),2);
  accessor.dropCluster();
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test just makes sure that a cluster is only recreated if it is incomplete. This is not
 * directly testing atomicity, but rather a use case where a machine died while creating the
 * cluster.
 */
@Test public void testRecreateCluster(){
  final String MODIFIER="modifier";
  final ClusterId clusterId=ClusterId.from("TestAccessorRecreate!testCluster");
  boolean connected=_zkclient.waitUntilConnected(30000,TimeUnit.MILLISECONDS);
  if (!connected) {
    LOG.warn("Connection not established");
    return;
  }
  HelixDataAccessor helixAccessor=new ZKHelixDataAccessor(clusterId.stringify(),_baseAccessor);
  ClusterAccessor accessor=new ClusterAccessor(clusterId,helixAccessor);
  boolean created=createCluster(clusterId,accessor,MODIFIER,1);
  Assert.assertTrue(created);
  Cluster clusterSnapshot=accessor.readCluster();
  Assert.assertEquals(clusterSnapshot.getUserConfig().getIntField(MODIFIER,-1),1);
  boolean created2=createCluster(clusterId,accessor,MODIFIER,2);
  Assert.assertFalse(created2);
  helixAccessor.removeProperty(helixAccessor.keyBuilder().liveInstances());
  created2=createCluster(clusterId,accessor,MODIFIER,2);
  Assert.assertTrue(created2);
  clusterSnapshot=accessor.readCluster();
  Assert.assertEquals(clusterSnapshot.getUserConfig().getIntField(MODIFIER,-1),2);
  accessor.dropCluster();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.api.accessor.TestAtomicAccessors </h4><pre class="type-14 type-5 type-1 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClusterUpdates(){
  final ClusterId clusterId=ClusterId.from("TestAtomicAccessors!testCluster");
  final HelixDataAccessor helixAccessor=new ZKHelixDataAccessor(clusterId.stringify(),_baseAccessor);
  final LockProvider lockProvider=new LockProvider();
  final String key1="key1";
  final String key2="key2";
  ClusterAccessor accessor=new ClusterAccessor(clusterId,helixAccessor);
  ClusterConfig config=new ClusterConfig.Builder(clusterId).build();
  boolean created=accessor.createCluster(config);
  Assert.assertTrue(created);
  Thread t1=new Thread(){
    @Override public void run(){
      UserConfig userConfig=new UserConfig(Scope.cluster(clusterId));
      userConfig.setBooleanField(key1,true);
      ClusterConfig.Delta delta=new ClusterConfig.Delta(clusterId).addUserConfig(userConfig);
      ClusterAccessor accessor=new AtomicClusterAccessor(clusterId,helixAccessor,lockProvider);
      accessor.updateCluster(delta);
    }
  }
;
  Thread t2=new Thread(){
    @Override public void run(){
      UserConfig userConfig=new UserConfig(Scope.cluster(clusterId));
      userConfig.setBooleanField(key2,true);
      ClusterConfig.Delta delta=new ClusterConfig.Delta(clusterId).addUserConfig(userConfig);
      ClusterAccessor accessor=new AtomicClusterAccessor(clusterId,helixAccessor,lockProvider);
      accessor.updateCluster(delta);
    }
  }
;
  t1.start();
  t2.start();
  long startTime=System.currentTimeMillis();
  try {
    t1.join(TIMEOUT);
    t2.join(TIMEOUT);
  }
 catch (  InterruptedException e) {
    Assert.fail(e.getMessage());
    t1.interrupt();
    t2.interrupt();
  }
  long endTime=System.currentTimeMillis();
  if (endTime - startTime > TIMEOUT - EXTRA_WAIT) {
    Assert.fail("Test timed out");
    t1.interrupt();
    t2.interrupt();
  }
  Assert.assertTrue(lockProvider.hasLockBlocked());
  accessor.dropCluster();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestMessageThrottleStage </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testMsgThrottleConstraints() throws Exception {
  String clusterName="CLUSTER_" + _className + "_constraints";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  List<IdealState> idealStates=HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},new String[]{"TestDB"},1,2);
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  ZNRecord record=new ZNRecord(ConstraintType.MESSAGE_CONSTRAINT.toString());
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","ANY");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","50");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint2").put("INSTANCE",".*");
  record.getMapField("constraint2").put("RESOURCE","TestDB");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint3").put("INSTANCE","localhost_1");
  record.getMapField("constraint3").put("RESOURCE",".*");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint3"));
  record.setMapField("constraint4",new TreeMap<String,String>());
  record.getMapField("constraint4").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint4").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint4").put("INSTANCE",".*");
  record.getMapField("constraint4").put("RESOURCE",".*");
  record.getMapField("constraint4").put("CONSTRAINT_VALUE","10");
  ConstraintItem constraint4=new ConstraintItem(record.getMapField("constraint4"));
  record.setMapField("constraint5",new TreeMap<String,String>());
  record.getMapField("constraint5").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint5").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint5").put("INSTANCE","localhost_0");
  record.getMapField("constraint5").put("RESOURCE","TestDB");
  record.getMapField("constraint5").put("CONSTRAINT_VALUE","3");
  ConstraintItem constraint5=new ConstraintItem(record.getMapField("constraint5"));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  ClusterConstraints constraint=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  MessageThrottleStage throttleStage=new MessageThrottleStage();
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Map<ConstraintAttribute,String> msgAttr=ClusterConstraints.toConstraintAttributes(msg1);
  Set<ConstraintItem> matches=constraint.match(msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(containsConstraint(matches,constraint0));
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint2));
  Assert.assertTrue(containsConstraint(matches,constraint4));
  Assert.assertTrue(containsConstraint(matches,constraint5));
  matches=throttleStage.selectConstraints(matches,msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint5));
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_1");
  msgAttr=ClusterConstraints.toConstraintAttributes(msg2);
  matches=constraint.match(msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(containsConstraint(matches,constraint0));
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint2));
  Assert.assertTrue(containsConstraint(matches,constraint3));
  Assert.assertTrue(containsConstraint(matches,constraint4));
  matches=throttleStage.selectConstraints(matches,msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(containsConstraint(matches,constraint1));
  Assert.assertTrue(containsConstraint(matches,constraint3));
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  BestPossibleStateOutput bestPossOutput=getEmptyBestPossibleStateOutput(idealStates);
  event.addAttribute(AttributeName.BEST_POSSIBLE_STATE.toString(),bestPossOutput);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runStage(event,new ResourceComputationStage());
  MessageOutput msgSelectOutput=new MessageOutput();
  Message msg3=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-003"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg4=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-004"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg5=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-005"),"OFFLINE","SLAVE","TestDB","localhost_0");
  Message msg6=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-006"),"OFFLINE","SLAVE","TestDB","localhost_1");
  List<Message> selectMessages=new ArrayList<Message>();
  selectMessages.add(msg1);
  selectMessages.add(msg2);
  selectMessages.add(msg3);
  selectMessages.add(msg4);
  selectMessages.add(msg5);
  selectMessages.add(msg6);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"),selectMessages);
  event.addAttribute(AttributeName.MESSAGES_SELECTED.toString(),msgSelectOutput);
  HelixTestUtil.runStage(event,throttleStage);
  MessageOutput msgThrottleOutput=event.getAttribute(AttributeName.MESSAGES_THROTTLE.toString());
  List<Message> throttleMessages=msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"));
  Assert.assertEquals(throttleMessages.size(),4);
  Assert.assertTrue(throttleMessages.contains(msg1));
  Assert.assertTrue(throttleMessages.contains(msg2));
  Assert.assertTrue(throttleMessages.contains(msg3));
  Assert.assertTrue(throttleMessages.contains(msg4));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testMsgThrottleConstraintsQuota() throws Exception {
  String clusterName="CLUSTER_" + _className + "_constraints_quota";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  HelixManager manager=new DummyClusterManager(clusterName,accessor);
  List<IdealState> idealStates=HelixTestUtil.setupIdealState(_baseAccessor,clusterName,new int[]{0,1},new String[]{"TestDB"},2,2);
  HelixTestUtil.setupLiveInstances(_baseAccessor,clusterName,new int[]{0,1});
  HelixTestUtil.setupStateModel(_baseAccessor,clusterName);
  ZNRecord record=new ZNRecord(ConstraintType.MESSAGE_CONSTRAINT.toString());
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("INSTANCE","localhost_0");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("INSTANCE","localhost_1");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("PARTITION","TestDB_0");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("PARTITION","TestDB_1");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint1"));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  ClusterConstraints constraint=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  MessageThrottleStage throttleStage=new MessageThrottleStage();
  ClusterEvent event=new ClusterEvent("testEvent");
  event.addAttribute("helixmanager",manager);
  BestPossibleStateOutput bestPossOutput=getEmptyBestPossibleStateOutput(idealStates);
  event.addAttribute(AttributeName.BEST_POSSIBLE_STATE.toString(),bestPossOutput);
  Pipeline dataRefresh=new Pipeline();
  dataRefresh.addStage(new ReadClusterDataStage());
  HelixTestUtil.runPipeline(event,dataRefresh);
  HelixTestUtil.runStage(event,new ResourceComputationStage());
  MessageOutput msgSelectOutput=new MessageOutput();
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_0","TestDB_0");
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_0","TestDB_1");
  Message msg3=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-003"),"OFFLINE","SLAVE","TestDB","localhost_1","TestDB_0");
  Message msg4=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-004"),"OFFLINE","SLAVE","TestDB","localhost_1","TestDB_1");
  List<Message> selectMessages0=new ArrayList<Message>();
  selectMessages0.add(msg1);
  selectMessages0.add(msg2);
  List<Message> selectMessages1=new ArrayList<Message>();
  selectMessages1.add(msg3);
  selectMessages1.add(msg4);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"),selectMessages0);
  msgSelectOutput.setMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_1"),selectMessages1);
  event.addAttribute(AttributeName.MESSAGES_SELECTED.toString(),msgSelectOutput);
  HelixTestUtil.runStage(event,throttleStage);
  MessageOutput msgThrottleOutput=event.getAttribute(AttributeName.MESSAGES_THROTTLE.toString());
  List<Message> throttleMessages=msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_0"));
  Assert.assertEquals(throttleMessages.size(),1);
  Assert.assertTrue(throttleMessages.contains(msg1));
  throttleMessages=msgThrottleOutput.getMessages(ResourceId.from("TestDB"),PartitionId.from("TestDB_1"));
  Assert.assertEquals(throttleMessages.size(),1);
  Assert.assertTrue(throttleMessages.contains(msg4));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestResourceComputationStage </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResources() throws Exception {
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResourcesWithSomeDropped() throws Exception {
  int nodes=5;
  List<String> instances=new ArrayList<String>();
  for (int i=0; i < nodes; i++) {
    instances.add("localhost_" + i);
  }
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=new ArrayList<IdealState>();
  for (int i=0; i < resources.length; i++) {
    int partitions=10;
    int replicas=1;
    String resourceName=resources[i];
    ZNRecord record=DefaultTwoStateStrategy.calculateIdealState(instances,partitions,replicas,resourceName,"MASTER","SLAVE");
    IdealState idealState=new IdealState(record);
    idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
    HelixDataAccessor accessor=manager.getHelixDataAccessor();
    Builder keyBuilder=accessor.keyBuilder();
    accessor.setProperty(keyBuilder.idealStates(resourceName),idealState);
    idealStates.add(idealState);
  }
  String instanceName="localhost_" + 3;
  LiveInstance liveInstance=new LiveInstance(instanceName);
  String sessionId=UUID.randomUUID().toString();
  liveInstance.setSessionId(sessionId);
  InstanceConfig instanceConfig=new InstanceConfig(instanceName);
  instanceConfig.setHostName("localhost");
  instanceConfig.setPort("3");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.liveInstance(instanceName),liveInstance);
  accessor.setProperty(keyBuilder.instanceConfig(instanceName),instanceConfig);
  String oldResource="testResourceOld";
  CurrentState currentState=new CurrentState(oldResource);
  currentState.setState(PartitionId.from("testResourceOld_0"),State.from("OFFLINE"));
  currentState.setState(PartitionId.from("testResourceOld_1"),State.from("SLAVE"));
  currentState.setState(PartitionId.from("testResourceOld_2"),State.from("MASTER"));
  currentState.setStateModelDefRef("MasterSlave");
  accessor.setProperty(keyBuilder.currentState(instanceName,sessionId,oldResource),currentState);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length + 1,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
  ResourceId oldResourceId=ResourceId.from(oldResource);
  AssertJUnit.assertTrue(resourceMap.containsKey(oldResourceId));
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getId(),oldResourceId);
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getIdealState().getStateModelDefId(),currentState.getStateModelDefId());
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getSubUnitSet().size(),currentState.getTypedPartitionStateMap().size());
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNull(){
  ClusterEvent event=new ClusterEvent("sampleEvent");
  ResourceComputationStage stage=new ResourceComputationStage();
  StageContext context=new StageContext();
  stage.init(context);
  stage.preProcess();
  boolean exceptionCaught=false;
  try {
    stage.process(event);
  }
 catch (  Exception e) {
    exceptionCaught=true;
  }
  AssertJUnit.assertTrue(exceptionCaught);
  stage.postProcess();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestResourceValidationStage </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIdealStateValidity() throws Exception {
  Mocks.MockAccessor accessor=new Mocks.MockAccessor();
  ResourceId masterSlaveCustomResource=ResourceId.from("masterSlaveCustomResource");
  ResourceId onlineOfflineFullAutoResource=ResourceId.from("onlineOfflineFullAutoResource");
  ResourceId masterSlaveSemiAutoInvalidResource=ResourceId.from("masterSlaveSemiAutoInvalidResource");
  createIS(accessor,masterSlaveCustomResource,"MasterSlave",RebalanceMode.CUSTOMIZED);
  createIS(accessor,onlineOfflineFullAutoResource,"OnlineOffline",RebalanceMode.FULL_AUTO);
  createIS(accessor,masterSlaveSemiAutoInvalidResource,"MasterSlave",RebalanceMode.SEMI_AUTO);
  createISSpec(accessor,masterSlaveCustomResource + "_spec","MasterSlave",RebalanceMode.CUSTOMIZED);
  createISSpec(accessor,onlineOfflineFullAutoResource + "_spec","OnlineOffline",RebalanceMode.FULL_AUTO);
  ClusterConfiguration clusterConfiguration=accessor.getProperty(accessor.keyBuilder().clusterConfig());
  addStateModels(accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  ClusterId clusterId=new ClusterId("sampleClusterId");
  ClusterAccessor clusterAccessor=new MockClusterAccessor(clusterId,accessor);
  Cluster cluster=clusterAccessor.readCluster();
  event.addAttribute("Cluster",cluster);
  event.addAttribute(AttributeName.IDEAL_STATE_RULES.toString(),clusterConfiguration.getIdealStateRules());
  new ResourceComputationStage().process(event);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  Assert.assertTrue(resourceMap.containsKey(masterSlaveCustomResource));
  Assert.assertTrue(resourceMap.containsKey(onlineOfflineFullAutoResource));
  Assert.assertTrue(resourceMap.containsKey(masterSlaveSemiAutoInvalidResource));
  new ResourceValidationStage().process(event);
  Map<ResourceId,ResourceConfig> finalResourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  Assert.assertTrue(finalResourceMap.containsKey(masterSlaveCustomResource));
  Assert.assertTrue(finalResourceMap.containsKey(onlineOfflineFullAutoResource));
  Assert.assertFalse(finalResourceMap.containsKey(masterSlaveSemiAutoInvalidResource));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testMissingStateModel() throws Exception {
  Mocks.MockAccessor accessor=new Mocks.MockAccessor();
  ResourceId masterSlaveCustomResource=ResourceId.from("masterSlaveCustomResource");
  ResourceId leaderStandbyCustomResource=ResourceId.from("leaderStandbyCustomResource");
  createIS(accessor,masterSlaveCustomResource,"MasterSlave",RebalanceMode.CUSTOMIZED);
  createIS(accessor,leaderStandbyCustomResource,"LeaderStandby",RebalanceMode.CUSTOMIZED);
  addStateModels(accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  ClusterId clusterId=new ClusterId("sampleClusterId");
  ClusterAccessor clusterAccessor=new MockClusterAccessor(clusterId,accessor);
  Cluster cluster=clusterAccessor.readCluster();
  event.addAttribute("Cluster",cluster);
  Map<String,Map<String,String>> emptyMap=Maps.newHashMap();
  event.addAttribute(AttributeName.IDEAL_STATE_RULES.toString(),emptyMap);
  new ResourceComputationStage().process(event);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  Assert.assertTrue(resourceMap.containsKey(masterSlaveCustomResource));
  Assert.assertTrue(resourceMap.containsKey(leaderStandbyCustomResource));
  new ResourceValidationStage().process(event);
  Map<ResourceId,ResourceConfig> finalResourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  Assert.assertTrue(finalResourceMap.containsKey(masterSlaveCustomResource));
  Assert.assertFalse(finalResourceMap.containsKey(leaderStandbyCustomResource));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNoSpec() throws Exception {
  Mocks.MockAccessor accessor=new Mocks.MockAccessor();
  ResourceId masterSlaveCustomResource=ResourceId.from("masterSlaveCustomResource");
  createIS(accessor,masterSlaveCustomResource,"MasterSlave",RebalanceMode.CUSTOMIZED);
  addStateModels(accessor);
  ClusterEvent event=new ClusterEvent("testEvent");
  ClusterId clusterId=new ClusterId("sampleClusterId");
  ClusterAccessor clusterAccessor=new MockClusterAccessor(clusterId,accessor);
  Cluster cluster=clusterAccessor.readCluster();
  event.addAttribute("Cluster",cluster);
  Map<String,Map<String,String>> emptyMap=Maps.newHashMap();
  event.addAttribute(AttributeName.IDEAL_STATE_RULES.toString(),emptyMap);
  new ResourceComputationStage().process(event);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  Assert.assertTrue(resourceMap.containsKey(masterSlaveCustomResource));
  new ResourceValidationStage().process(event);
  Map<ResourceId,ResourceConfig> finalResourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  Assert.assertTrue(finalResourceMap.containsKey(masterSlaveCustomResource));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestStagesWithLogicalAccessors </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadClusterDataStage(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  ClusterAccessor clusterAccessor=new ClusterAccessor(_clusterId,_dataAccessor);
  Cluster cluster=clusterAccessor.readCluster();
  ClusterId id=cluster.getId();
  Assert.assertEquals(id,_clusterId);
  Map<ParticipantId,Participant> liveParticipantMap=cluster.getLiveParticipantMap();
  Assert.assertEquals(liveParticipantMap.size(),n);
  for (  ParticipantId participantId : liveParticipantMap.keySet()) {
    Participant participant=liveParticipantMap.get(participantId);
    Map<ResourceId,CurrentState> curStateMap=participant.getCurrentStateMap();
    Assert.assertEquals(curStateMap.size(),1);
    ResourceId resourceId=ResourceId.from("TestDB0");
    Assert.assertTrue(curStateMap.containsKey(resourceId));
    CurrentState curState=curStateMap.get(resourceId);
    Map<PartitionId,State> partitionStateMap=curState.getTypedPartitionStateMap();
    Assert.assertEquals(partitionStateMap.size(),p);
  }
  Map<ResourceId,Resource> resourceMap=cluster.getResourceMap();
  Assert.assertEquals(resourceMap.size(),1);
  ResourceId resourceId=ResourceId.from("TestDB0");
  Assert.assertTrue(resourceMap.containsKey(resourceId));
  Resource resource=resourceMap.get(resourceId);
  Assert.assertNotNull(resource.getIdealState());
  Assert.assertEquals(resource.getIdealState().getRebalanceMode(),RebalanceMode.SEMI_AUTO);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.strategy.TestAutoRebalanceStrategy </h4><pre class="type-7 type-14 type-1 type-8 type-11 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests the following scenario: nodes come up one by one, then one node is taken down. Preference
 * lists should prefer nodes in the current mapping at all times, but when all nodes are in the
 * current mapping, then it should distribute states as evenly as possible.
 */
@Test public void testOrphansNotPreferred(){
  final ResourceId RESOURCE=ResourceId.from("resource");
  final PartitionId[] PARTITIONS={PartitionId.from("resource_0"),PartitionId.from("resource_1"),PartitionId.from("resource_2")};
  final StateModelDefinition STATE_MODEL=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  final int REPLICA_COUNT=2;
  final ParticipantId[] NODES={ParticipantId.from("n0"),ParticipantId.from("n1"),ParticipantId.from("n2")};
  ReplicaPlacementScheme scheme=new AutoRebalanceStrategy.DefaultPlacementScheme();
  List<ParticipantId> allNodes=Lists.newArrayList(NODES[0]);
  List<ParticipantId> liveNodes=Lists.newArrayList(NODES[0]);
  Map<PartitionId,Map<ParticipantId,State>> currentMapping=Maps.newHashMap();
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.put(partition,new HashMap<ParticipantId,State>());
  }
  List<PartitionId> partitions=ImmutableList.copyOf(PARTITIONS);
  Map<State,String> upperBounds=Maps.newHashMap();
  for (  State state : STATE_MODEL.getTypedStatesPriorityList()) {
    upperBounds.put(state,STATE_MODEL.getNumParticipantsPerState(state));
  }
  LinkedHashMap<State,Integer> stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  ZNRecord znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  Map<String,List<String>> preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),1,"invalid preference list for " + partition);
  }
  allNodes.add(NODES[1]);
  liveNodes.add(NODES[1]);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).put(NODES[0],State.from("MASTER"));
  }
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.get(0),NODES[0].toString(),"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.get(1),NODES[1].toString(),"invalid preference list for " + partition);
  }
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).put(NODES[1],State.from("SLAVE"));
  }
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  Set<String> firstNodes=Sets.newHashSet();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
  }
  Assert.assertEquals(firstNodes.size(),2,"masters not evenly distributed");
  allNodes.add(NODES[2]);
  liveNodes.add(NODES[2]);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  currentMapping.get(PARTITIONS[1]).put(NODES[0],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  boolean newNodeUsed=false;
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    if (preferenceList.contains(NODES[2].toString())) {
      newNodeUsed=true;
      Assert.assertEquals(preferenceList.get(1),NODES[2].toString(),"newly added node not at preference list tail for " + partition);
    }
  }
  Assert.assertTrue(newNodeUsed,"not using " + NODES[2]);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[0],State.from("MASTER"));
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[0],State.from("MASTER"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("SLAVE"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  firstNodes.clear();
  Set<String> secondNodes=Sets.newHashSet();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
    secondNodes.add(preferenceList.get(1));
  }
  Assert.assertEquals(firstNodes.size(),3,"masters not distributed evenly");
  Assert.assertEquals(secondNodes.size(),3,"slaves not distributed evenly");
  liveNodes.remove(0);
  stateCount=ConstraintBasedAssignment.stateCount(upperBounds,STATE_MODEL,liveNodes.size(),REPLICA_COUNT);
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    Map<ParticipantId,State> stateMap=currentMapping.get(partition);
    for (    ParticipantId participant : stateMap.keySet()) {
      Assert.assertTrue(preferenceList.contains(participant.toString()),"minimal movement violated for " + partition);
    }
    for (    String participant : preferenceList) {
      if (!stateMap.containsKey(ParticipantId.from(participant))) {
        Assert.assertNotSame(preferenceList.get(0),participant,"newly moved replica should not be master for " + partition);
      }
    }
  }
  for (  PartitionId partition : PARTITIONS) {
    currentMapping.get(partition).clear();
  }
  currentMapping.get(PARTITIONS[0]).put(NODES[1],State.from("MASTER"));
  currentMapping.get(PARTITIONS[0]).put(NODES[2],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[1]).put(NODES[2],State.from("MASTER"));
  currentMapping.get(PARTITIONS[2]).put(NODES[1],State.from("SLAVE"));
  currentMapping.get(PARTITIONS[2]).put(NODES[2],State.from("MASTER"));
  znRecord=new AutoRebalanceStrategy(RESOURCE,partitions,stateCount,Integer.MAX_VALUE,scheme).typedComputePartitionAssignment(liveNodes,currentMapping,allNodes);
  preferenceLists=znRecord.getListFields();
  firstNodes.clear();
  for (  PartitionId partition : currentMapping.keySet()) {
    List<String> preferenceList=preferenceLists.get(partition.toString());
    Assert.assertNotNull(preferenceList,"invalid preference list for " + partition);
    Assert.assertEquals(preferenceList.size(),2,"invalid preference list for " + partition);
    firstNodes.add(preferenceList.get(0));
  }
  Assert.assertEquals(firstNodes.size(),2,"masters not evenly distributed");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.strategy.TestEspressoStorageClusterIdealState </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testEspressoStorageClusterIdealState() throws Exception {
  List<String> instanceNames=new ArrayList<String>();
  for (int i=0; i < 5; i++) {
    instanceNames.add("localhost:123" + i);
  }
  int partitions=8, replicas=0;
  Map<String,Object> result0=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  Verify(result0,partitions,replicas);
  partitions=8192;
  replicas=3;
  instanceNames.clear();
  for (int i=0; i < 20; i++) {
    instanceNames.add("localhost:123" + i);
  }
  Map<String,Object> resultOriginal=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  Verify(resultOriginal,partitions,replicas);
  printStat(resultOriginal);
  Map<String,Object> result1=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  List<String> instanceNames2=new ArrayList<String>();
  for (int i=30; i < 35; i++) {
    instanceNames2.add("localhost:123" + i);
  }
  DefaultTwoStateStrategy.calculateNextIdealState(instanceNames2,result1);
  List<String> instanceNames3=new ArrayList<String>();
  for (int i=35; i < 40; i++) {
    instanceNames3.add("localhost:123" + i);
  }
  DefaultTwoStateStrategy.calculateNextIdealState(instanceNames3,result1);
  Double masterKeepRatio=0.0, slaveKeepRatio=0.0;
  Verify(result1,partitions,replicas);
  double[] result=compareResult(resultOriginal,result1);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(0.66 < masterKeepRatio && 0.67 > masterKeepRatio);
  Assert.assertTrue(0.66 < slaveKeepRatio && 0.67 > slaveKeepRatio);
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testRebalance2(){
  int partitions=1256, replicas=3;
  List<String> instanceNames=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    instanceNames.add("localhost:123" + i);
  }
  Map<String,Object> resultOriginal=DefaultTwoStateStrategy.calculateInitialIdealState(instanceNames,partitions,replicas);
  ZNRecord idealState1=DefaultTwoStateStrategy.convertToZNRecord(resultOriginal,"TestDB","MASTER","SLAVE");
  Map<String,Object> result1=RebalanceUtil.buildInternalIdealState(new IdealState(idealState1));
  List<String> instanceNames2=new ArrayList<String>();
  for (int i=30; i < 35; i++) {
    instanceNames2.add("localhost:123" + i);
  }
  Map<String,Object> result2=DefaultTwoStateStrategy.calculateNextIdealState(instanceNames2,result1);
  Verify(resultOriginal,partitions,replicas);
  Verify(result2,partitions,replicas);
  Double masterKeepRatio=0.0, slaveKeepRatio=0.0;
  double[] result=compareResult(resultOriginal,result2);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(0.66 < masterKeepRatio && 0.67 > masterKeepRatio);
  Assert.assertTrue(0.66 < slaveKeepRatio && 0.67 > slaveKeepRatio);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.strategy.TestShufflingTwoStateStrategy </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testInvocation() throws Exception {
  int partitions=6, replicas=2;
  String dbName="espressoDB1";
  List<String> instanceNames=new ArrayList<String>();
  instanceNames.add("localhost_1231");
  instanceNames.add("localhost_1232");
  instanceNames.add("localhost_1233");
  instanceNames.add("localhost_1234");
  ZNRecord result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  ZNRecord result2=RUSHMasterSlaveStrategy.calculateIdealState(instanceNames,1,partitions,replicas,dbName);
  ZNRecord result3=ConsistentHashingMasterSlaveStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName,new ConsistentHashingMasterSlaveStrategy.FnvHash());
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result3,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result3,"SLAVE");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result3,"");
  ConsistentHashingMasterSlaveStrategy.printNodeOfflineOverhead(result3);
  ObjectMapper mapper=new ObjectMapper();
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,result);
  ZNRecord zn=mapper.readValue(new StringReader(sw.toString()),ZNRecord.class);
  System.out.println(result.toString());
  System.out.println(zn.toString());
  AssertJUnit.assertTrue(zn.toString().equalsIgnoreCase(result.toString()));
  System.out.println();
  sw=new StringWriter();
  mapper.writeValue(sw,result2);
  ZNRecord zn2=mapper.readValue(new StringReader(sw.toString()),ZNRecord.class);
  System.out.println(result2.toString());
  System.out.println(zn2.toString());
  AssertJUnit.assertTrue(zn2.toString().equalsIgnoreCase(result2.toString()));
  sw=new StringWriter();
  mapper.writeValue(sw,result3);
  System.out.println();
  ZNRecord zn3=mapper.readValue(new StringReader(sw.toString()),ZNRecord.class);
  System.out.println(result3.toString());
  System.out.println(zn3.toString());
  AssertJUnit.assertTrue(zn3.toString().equalsIgnoreCase(result3.toString()));
  System.out.println();
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testShuffledIdealState(){
  int partitions=6, replicas=2, instances=4;
  String dbName="espressoDB1";
  List<String> instanceNames=new ArrayList<String>();
  instanceNames.add("localhost_1231");
  instanceNames.add("localhost_1232");
  instanceNames.add("localhost_1233");
  instanceNames.add("localhost_1234");
  ZNRecord result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=3;
  instances=7;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=14;
  replicas=3;
  instances=7;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=3;
  instances=8;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=3;
  instances=12;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
  instanceNames.clear();
  partitions=4;
  replicas=2;
  instances=12;
  for (int i=0; i < instances; i++) {
    instanceNames.add("localhost_" + (1231 + i));
  }
  result=ShufflingTwoStateStrategy.calculateIdealState(instanceNames,partitions,replicas,dbName);
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"MASTER");
  ConsistentHashingMasterSlaveStrategy.printIdealStateStats(result,"SLAVE");
  Assert.assertTrue(verify(result));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.IntegrationTest </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String clusterName=TestUtil.getTestName();
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.SinglePartitionLeaderStandByTest </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String clusterName=TestUtil.getTestName();
  int n=4;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,0,"LeaderStandby",RebalanceMode.FULL_AUTO,false);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  PropertyKey key=keyBuilder.idealStates("TestDB0");
  IdealState idealState=accessor.getProperty(key);
  idealState.setReplicas(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString());
  idealState.getRecord().setListField("TestDB0_0",Arrays.asList(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString()));
  accessor.setProperty(key,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  participants[0].syncStop();
  Thread.sleep(10000);
  for (int i=0; i < 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAddNodeAfterControllerStart </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testStandalone() throws Exception {
  String testName=TestUtil.getTestName();
  String clusterName=testName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  final int nodeNr=5;
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,20,nodeNr - 1,3,"MasterSlave",true);
  MockParticipant[] participants=new MockParticipant[nodeNr];
  for (int i=0; i < nodeNr - 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  boolean result;
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12918");
  result=checkHandlers(controller.getHandlers(),msgPath);
  Assert.assertTrue(result);
  _setupTool.addInstanceToCluster(clusterName,"localhost_12922");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",3);
  participants[nodeNr - 1]=new MockParticipant(_zkaddr,clusterName,"localhost_12922");
  new Thread(participants[nodeNr - 1]).start();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12922");
  result=checkHandlers(controller.getHandlers(),msgPath);
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < nodeNr; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiCluster() throws Exception {
  String testName=TestUtil.getTestName();
  String clusterName=testName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  final String grandClusterName="GRAND_" + clusterName;
  TestHelper.setupCluster(grandClusterName,_zkaddr,0,"controller",null,0,0,1,0,null,true);
  MockMultiClusterController multiClusterController=new MockMultiClusterController(_zkaddr,grandClusterName,"controller_0");
  multiClusterController.syncStart();
  _setupTool.addCluster(clusterName,true);
  _setupTool.activateCluster(clusterName,"GRAND_" + clusterName,true);
  boolean result;
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,"GRAND_" + clusterName));
  Assert.assertTrue(result);
  final int nodeNr=2;
  for (int i=0; i < nodeNr - 1; i++) {
    int port=12918 + i;
    _setupTool.addInstanceToCluster(clusterName,"localhost_" + port);
  }
  _setupTool.addResourceToCluster(clusterName,"TestDB0",1,"LeaderStandby");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",1);
  MockParticipant[] participants=new MockParticipant[nodeNr];
  for (int i=0; i < nodeNr - 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12918");
  int numberOfListeners=ZkTestHelper.numberOfListeners(_zkaddr,msgPath);
  Assert.assertEquals(numberOfListeners,2);
  _setupTool.addInstanceToCluster(clusterName,"localhost_12919");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB0",2);
  participants[nodeNr - 1]=new MockParticipant(_zkaddr,clusterName,"localhost_12919");
  participants[nodeNr - 1].syncStart();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,"localhost_12919");
  numberOfListeners=ZkTestHelper.numberOfListeners(_zkaddr,msgPath);
  Assert.assertEquals(numberOfListeners,2);
  multiClusterController.syncStop();
  for (int i=0; i < nodeNr; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAddStateModelFactoryAfterConnect </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  _setupTool.addResourceToCluster(clusterName,"TestDB1",16,"MasterSlave");
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB1"));
  idealState.setStateModelFactoryId(StateModelFactoryId.from("TestDB1_Factory"));
  accessor.setProperty(keyBuilder.idealStates("TestDB1"),idealState);
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB1",3);
  int totalMsgs=0;
  for (int retry=0; retry < 5; retry++) {
    Thread.sleep(100);
    totalMsgs=0;
    for (int i=0; i < n; i++) {
      List<Message> msgs=accessor.getChildValues(keyBuilder.messages(participants[i].getInstanceName()));
      totalMsgs+=msgs.size();
    }
    if (totalMsgs == 48)     break;
  }
  Assert.assertEquals(totalMsgs,48,"Should accumulated 48 unprocessed messages (1 O->S per partition per replica) because TestDB1 is added without state-model-factory but was " + totalMsgs);
  for (int i=0; i < n; i++) {
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,"TestDB1_Factory",new MockMSModelFactory());
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAutoIsWithEmptyMap </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testAutoIsWithEmptyMap() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"LeaderStandby",false);
  String idealPath=PropertyPathConfig.getPath(PropertyType.IDEALSTATES,clusterName,"TestDB0");
  ZNRecord curIdealState=_zkclient.readData(idealPath);
  List<String> instanceNames=new ArrayList<String>(5);
  for (int i=0; i < 5; i++) {
    int port=12918 + i;
    instanceNames.add("localhost_" + port);
  }
  ZNRecord idealState=DefaultTwoStateStrategy.calculateIdealState(instanceNames,10,2,"TestDB0","LEADER","STANDBY");
  curIdealState.setSimpleField(IdealState.IdealStateProperty.REPLICAS.toString(),"3");
  curIdealState.setListFields(idealState.getListFields());
  _zkclient.writeData(idealPath,curIdealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[5];
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAutoRebalance </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testAutoRebalance() throws Exception {
  _participants[0].syncStop();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  for (int i=0; i < 2; i++) {
    String storageNodeName="localhost_" + (1000 + i);
    _setupTool.addInstanceToCluster(CLUSTER_NAME,storageNodeName);
    MockParticipant participant=new MockParticipant(_zkaddr,CLUSTER_NAME,storageNodeName.replace(':','_'));
    participant.syncStart();
  }
  Thread.sleep(5000);
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,db2));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(CLUSTER_NAME,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(keyBuilder.externalView(db2));
  Set<String> instancesSet=new HashSet<String>();
  for (  String partitionName : ev.getRecord().getMapFields().keySet()) {
    Map<String,String> assignmentMap=ev.getRecord().getMapField(partitionName);
    for (    String instance : assignmentMap.keySet()) {
      instancesSet.add(instance);
    }
  }
  Assert.assertEquals(instancesSet.size(),2);
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDropResourceAutoRebalance() throws Exception {
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB",_PARTITIONS,"OnlineOffline",RebalanceMode.FULL_AUTO + "");
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB",1);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,"MyDB"));
  Assert.assertTrue(result);
  String command="-zkSvr " + _zkaddr + " -dropResource "+ CLUSTER_NAME+ " "+ "MyDB";
  ClusterSetup.processCommandLineArgs(command.split(" "));
  TestHelper.verifyWithTimeout("verifyEmptyCurStateAndExtView",30 * 1000,CLUSTER_NAME,"MyDB",TestHelper.<String>setOf("localhost_12918","localhost_12919","localhost_12920","localhost_12921","localhost_12922"),_zkaddr);
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB2",_PARTITIONS,"MasterSlave",RebalanceMode.FULL_AUTO + "");
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB2",3);
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,"MyDB2"));
  Assert.assertTrue(result);
  command="-zkSvr " + _zkaddr + " -dropResource "+ CLUSTER_NAME+ " "+ "MyDB2";
  ClusterSetup.processCommandLineArgs(command.split(" "));
  TestHelper.verifyWithTimeout("verifyEmptyCurStateAndExtView",30 * 1000,CLUSTER_NAME,"MyDB2",TestHelper.<String>setOf("localhost_12918","localhost_12919","localhost_12920","localhost_12921","localhost_12922"),_zkaddr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestAutoRebalancePartitionLimit </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testAutoRebalanceWithMaxPartitionPerNode() throws Exception {
  HelixManager manager=_controller;
  _participants[0].syncStop();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  final HelixDataAccessor accessor=manager.getHelixDataAccessor();
  ExternalView ev=manager.getHelixDataAccessor().getProperty(accessor.keyBuilder().externalView(TEST_DB));
  Assert.assertEquals(ev.getPartitionSet().size(),100);
  _participants[1].syncStop();
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView(TEST_DB));
      return ev.getPartitionSet().size() == 75;
    }
  }
,3 * 1000);
  for (int i=0; i < 2; i++) {
    String storageNodeName="localhost_" + (1000 + i);
    _setupTool.addInstanceToCluster(CLUSTER_NAME,storageNodeName);
    String newInstanceName=storageNodeName.replace(':','_');
    MockParticipant participant=new MockParticipant(_zkaddr,CLUSTER_NAME,newInstanceName);
    participant.syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,TEST_DB));
  Assert.assertTrue(result);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestBasicSpectator </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testSpectator() throws Exception {
  HelixManager relayHelixManager=HelixManagerFactory.getZKHelixManager(CLUSTER_NAME,null,InstanceType.SPECTATOR,_zkaddr);
  relayHelixManager.connect();
  relayHelixManager.addExternalViewChangeListener(this);
  _setupTool.addResourceToCluster(CLUSTER_NAME,"NextDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"NextDB",3);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  Assert.assertTrue(_externalViewChanges.containsKey("NextDB"));
  Assert.assertTrue(_externalViewChanges.containsKey(TEST_DB));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestBatchMessage </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testChangeBatchMessageMode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setBatchMessageMode(true);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  TestZkChildListener listener=new TestZkChildListener();
  _zkclient.subscribeChildChanges(keyBuilder.messages("localhost_12918").getPath(),listener);
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertTrue(listener._maxNbOfChilds <= 2,"Should get no more than 2 messages (O->S and S->M)");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setBatchMessageMode(true);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  TestZkChildListener listener=new TestZkChildListener();
  _zkclient.subscribeChildChanges(keyBuilder.messages("localhost_12918").getPath(),listener);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertTrue(listener._maxNbOfChilds <= 2,"Should get no more than 2 messages (O->S and S->M)");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testParticipantIncompatibleWithBatchMsg() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--addResourceProperty",clusterName,"TestDB0",HelixPropertyAttribute.BATCH_MESSAGE_MODE.toString(),"true"});
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  TestZkChildListener listener=new TestZkChildListener();
  _zkclient.subscribeChildChanges(keyBuilder.messages("localhost_12918").getPath(),listener);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--enableCluster",clusterName,"false"});
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance("localhost_12918"));
  liveInstance.setHelixVersion("0.5");
  accessor.setProperty(keyBuilder.liveInstance("localhost_12918"),liveInstance);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--enableCluster",clusterName,"true"});
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertTrue(listener._maxNbOfChilds > 16,"Should see more than 16 messages at the same time (32 O->S and 32 S->M)");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testSubMsgExecutionFail() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  MockParticipant[] participants=new MockParticipant[n];
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,6,n,3,"MasterSlave",true);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setBatchMessageMode(true);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  final String hostToFail="localhost_12921";
  final String partitionToFail="TestDB0_4";
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (instanceName.equals(hostToFail)) {
      Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
      errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStates=new HashMap<String,Map<String,String>>();
  errStates.put("TestDB0",new HashMap<String,String>());
  errStates.get("TestDB0").put(partitionToFail,hostToFail);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStates));
  Assert.assertTrue(result);
  Map<String,Set<String>> errorStateMap=new HashMap<String,Set<String>>();
  errorStateMap.put(partitionToFail,TestHelper.setOf(hostToFail));
  TestHelper.verifyState(clusterName,_zkaddr,errorStateMap,"ERROR");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestBatchMessageWrapper </h4><pre class="type-4 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"MasterSlave",true);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setBatchMessageMode(true);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  TestMockMSModelFactory[] ftys=new TestMockMSModelFactory[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    ftys[i]=new TestMockMSModelFactory();
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,ftys[i]);
    participants[i].syncStart();
    boolean result=false;
    do {
      Thread.sleep(100);
      result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
    }
 while (result == false);
    Assert.assertTrue(result,"participant: " + instanceName + " fails to complete all transitions");
  }
  MockBatchMsgWrapper wrapper=(MockBatchMsgWrapper)ftys[0].getBatchMessageWrapper(ResourceId.from("TestDB0"));
  Assert.assertEquals(wrapper._startCount,3,"Expect 3 batch.start: O->S, S->M, and M->S for 1st participant");
  Assert.assertEquals(wrapper._endCount,3,"Expect 3 batch.end: O->S, S->M, and M->S for 1st participant");
  wrapper=(MockBatchMsgWrapper)ftys[1].getBatchMessageWrapper(ResourceId.from("TestDB0"));
  Assert.assertEquals(wrapper._startCount,2,"Expect 2 batch.start: O->S and S->M for 2nd participant");
  Assert.assertEquals(wrapper._startCount,2,"Expect 2 batch.end: O->S and S->M for 2nd participant");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestBucketizedResource </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testBucketizedResource() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[5];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setBucketSize(1);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestCarryOverBadCurState </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCarryOverBadCurState() throws Exception {
  System.out.println("START testCarryOverBadCurState at " + new Date(System.currentTimeMillis()));
  String testName=TestUtil.getTestName();
  String clusterName=testName;
  MockParticipant[] participants=new MockParticipant[5];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ZNRecord badCurState=new ZNRecord("TestDB0");
  String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_12918","session_0","TestDB0");
  _zkclient.createPersistent(path,true);
  _zkclient.writeData(path,badCurState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END testCarryOverBadCurState at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestCleanupExternalView </h4><pre class="type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  ZKHelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.enableCluster(clusterName,false);
  ZkTestHelper.tryWaitZkEventsCleaned(controller.getZkClient());
  admin.dropResource(clusterName,"TestDB0");
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance("localhost_12918"));
  accessor.removeProperty(keyBuilder.currentState("localhost_12918",liveInstance.getTypedSessionId().stringify(),"TestDB0"));
  liveInstance=accessor.getProperty(keyBuilder.liveInstance("localhost_12919"));
  accessor.removeProperty(keyBuilder.currentState("localhost_12919",liveInstance.getTypedSessionId().stringify(),"TestDB0"));
  admin.enableCluster(clusterName,true);
  ExternalView externalView=null;
  for (int i=0; i < 10; i++) {
    Thread.sleep(100);
    externalView=accessor.getProperty(keyBuilder.externalView("TestDB0"));
    if (externalView == null) {
      break;
    }
  }
  Assert.assertNull(externalView,"external-view for TestDB0 should be removed, but was: " + externalView);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestClusterStartsup </h4><pre class="type-14 type-5 type-1 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testParticipantStartUp() throws Exception {
  setupCluster();
  String controllerMsgPath=HelixUtil.getControllerPropertyPath(CLUSTER_NAME,PropertyType.MESSAGES_CONTROLLER);
  _zkclient.deleteRecursive(controllerMsgPath);
  HelixManager manager=null;
  try {
    manager=HelixManagerFactory.getZKHelixManager(CLUSTER_NAME,"localhost_" + (START_PORT + 1),InstanceType.PARTICIPANT,_zkaddr);
    manager.connect();
    Assert.fail("Should fail on connect() since cluster structure is not set up");
  }
 catch (  HelixException e) {
  }
  if (manager != null) {
    AssertJUnit.assertFalse(manager.isConnected());
  }
  try {
    manager=HelixManagerFactory.getZKHelixManager(CLUSTER_NAME,"localhost_" + (START_PORT + 3),InstanceType.PARTICIPANT,_zkaddr);
    manager.connect();
    Assert.fail("Should fail on connect() since cluster structure is not set up");
  }
 catch (  HelixException e) {
  }
  if (manager != null) {
    AssertJUnit.assertFalse(manager.isConnected());
  }
  setupCluster();
  String stateModelPath=HelixUtil.getStateModelDefinitionPath(CLUSTER_NAME);
  _zkclient.deleteRecursive(stateModelPath);
  try {
    manager=HelixManagerFactory.getZKHelixManager(CLUSTER_NAME,"localhost_" + (START_PORT + 1),InstanceType.PARTICIPANT,_zkaddr);
    manager.connect();
    Assert.fail("Should fail on connect() since cluster structure is not set up");
  }
 catch (  HelixException e) {
  }
  if (manager != null) {
    AssertJUnit.assertFalse(manager.isConnected());
  }
  setupCluster();
  String instanceStatusUpdatePath=HelixUtil.getInstancePropertyPath(CLUSTER_NAME,"localhost_" + (START_PORT + 1),PropertyType.STATUSUPDATES);
  _zkclient.deleteRecursive(instanceStatusUpdatePath);
  try {
    manager=HelixManagerFactory.getZKHelixManager(CLUSTER_NAME,"localhost_" + (START_PORT + 1),InstanceType.PARTICIPANT,_zkaddr);
    manager.connect();
    Assert.fail("Should fail on connect() since cluster structure is not set up");
  }
 catch (  HelixException e) {
  }
  if (manager != null) {
    AssertJUnit.assertFalse(manager.isConnected());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestCorrectnessOnConnectivityLoss </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParticipant() throws Exception {
  Map<String,Integer> stateReachedCounts=Maps.newHashMap();
  HelixManager participant=HelixManagerFactory.getZKHelixManager(_clusterName,"localhost_12918",InstanceType.PARTICIPANT,ZK_ADDR);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("OnlineOffline"),new MyStateModelFactory(stateReachedCounts));
  participant.connect();
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(ZK_ADDR,_clusterName));
  Assert.assertTrue(result);
  Assert.assertEquals(stateReachedCounts.size(),1);
  Assert.assertTrue(stateReachedCounts.containsKey("ONLINE"));
  Assert.assertEquals(stateReachedCounts.get("ONLINE").intValue(),1);
  TestHelper.stopZkServer(_zkServer);
  Thread.sleep(1000);
  Assert.assertEquals(stateReachedCounts.size(),1);
  Assert.assertTrue(stateReachedCounts.containsKey("ONLINE"));
  Assert.assertEquals(stateReachedCounts.get("ONLINE").intValue(),1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestCustomizedIdealStateRebalancer </h4><pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomizedIdealStateRebalancer() throws InterruptedException {
  _setupTool.addResourceToCluster(CLUSTER_NAME,db2,60,"MasterSlave");
  _setupTool.addResourceProperty(CLUSTER_NAME,db2,IdealStateProperty.REBALANCER_CLASS_NAME.toString(),TestCustomizedIdealStateRebalancer.TestRebalancer.class.getName());
  _setupTool.addResourceProperty(CLUSTER_NAME,db2,IdealStateProperty.REBALANCE_MODE.toString(),RebalanceMode.USER_DEFINED.toString());
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,db2,3);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,db2));
  Assert.assertTrue(result);
  Thread.sleep(1000);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(CLUSTER_NAME,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(keyBuilder.externalView(db2));
  Assert.assertEquals(ev.getPartitionSet().size(),60);
  for (  String partition : ev.getPartitionSet()) {
    Assert.assertEquals(ev.getStateMap(partition).size(),1);
  }
  IdealState is=accessor.getProperty(keyBuilder.idealStates(db2));
  for (  PartitionId partition : is.getPartitionIdSet()) {
    Assert.assertEquals(is.getPreferenceList(partition).size(),0);
    Assert.assertEquals(is.getParticipantStateMap(partition).size(),0);
  }
  Assert.assertTrue(testRebalancerCreated);
  Assert.assertTrue(testRebalancerInvoked);
  ControllerContextHolder holder=accessor.getProperty(keyBuilder.controllerContext(db2));
  Assert.assertNotNull(holder);
  Assert.assertNotNull(holder.getContext());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDisable </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisablePartitionAutoIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enablePartition false "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put("localhost_12919","OFFLINE");
  expectStateMap.put("TestDB0_0",expectInstanceStateMap);
  expectStateMap.put("TestDB0_5",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,"localhost_12919" + " should be in OFFLINE for [TestDB0_0, TestDB0_5]");
  command="--zkSvr " + _zkaddr + " --enablePartition true "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,"localhost_12919" + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisablePartitionCustomIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enablePartition false "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put("localhost_12919","OFFLINE");
  expectStateMap.put("TestDB0_0",expectInstanceStateMap);
  expectStateMap.put("TestDB0_5",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,"localhost_12919" + " should be in OFFLINE for [TestDB0_0, TestDB0_5]");
  command="--zkSvr " + _zkaddr + " --enablePartition true "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0 TestDB0_5";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,"localhost_12919" + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisableNodeAutoIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  String disableNode="localhost_12919";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " false";
  ClusterSetup.processCommandLineArgs(command.split(" "));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put(disableNode,"OFFLINE");
  expectStateMap.put(".*",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,disableNode + " should be in OFFLINE");
  command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,disableNode + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDisableNodeCustomIS() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  String disableNode="localhost_12918";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " false";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Map<String,Map<String,String>> expectStateMap=new HashMap<String,Map<String,String>>();
  Map<String,String> expectInstanceStateMap=new HashMap<String,String>();
  expectInstanceStateMap.put(disableNode,"OFFLINE");
  expectStateMap.put(".*",expectInstanceStateMap);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"==");
  Assert.assertTrue(result,disableNode + " should be in OFFLINE");
  command="--zkSvr " + _zkaddr + " --enableInstance "+ clusterName+ " "+ disableNode+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ZkTestHelper.verifyState(_zkclient,clusterName,"TestDB0",expectStateMap,"!=");
  Assert.assertTrue(result,disableNode + " should NOT be in OFFLINE");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDisableCustomCodeRunner </h4><pre class="type-7 type-14 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,PARTITION_NUM,N,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  Map<String,HelixCustomCodeRunner> customCodeRunners=new HashMap<String,HelixCustomCodeRunner>();
  Map<String,DummyCallback> callbacks=new HashMap<String,DummyCallback>();
  for (int i=0; i < N; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants.put(instanceName,new MockParticipant(_zkaddr,clusterName,instanceName));
    customCodeRunners.put(instanceName,new HelixCustomCodeRunner(participants.get(instanceName),_zkaddr));
    callbacks.put(instanceName,new DummyCallback());
    customCodeRunners.get(instanceName).invoke(callbacks.get(instanceName)).on(ChangeType.LIVE_INSTANCE).usingLeaderStandbyModel("TestParticLeader").start();
    participants.get(instanceName).syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  final String customCodeRunnerResource=customCodeRunners.get("localhost_12918").getResourceName();
  ExternalView extView=accessor.getProperty(keyBuilder.externalView(customCodeRunnerResource));
  Map<String,String> instanceStates=extView.getStateMap(customCodeRunnerResource + "_0");
  String leader=null;
  for (  String instance : instanceStates.keySet()) {
    String state=instanceStates.get(instance);
    if ("LEADER".equals(state)) {
      leader=instance;
      break;
    }
  }
  Assert.assertNotNull(leader);
  for (  String instance : callbacks.keySet()) {
    DummyCallback callback=callbacks.get(instance);
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isInitTypeInvoked());
    }
 else {
      Assert.assertFalse(callback.isInitTypeInvoked());
    }
    callback.reset();
  }
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.enableResource(clusterName,customCodeRunnerResource,false);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      PropertyKey.Builder keyBuilder=accessor.keyBuilder();
      ExternalView extView=accessor.getProperty(keyBuilder.externalView(customCodeRunnerResource));
      if (extView == null) {
        return false;
      }
      Set<String> partitionSet=extView.getPartitionSet();
      if (partitionSet == null || partitionSet.size() != PARTITION_NUM) {
        return false;
      }
      for (      String partition : partitionSet) {
        Map<String,String> instanceStates=extView.getStateMap(partition);
        for (        String state : instanceStates.values()) {
          if (!"OFFLINE".equals(state)) {
            return false;
          }
        }
      }
      return true;
    }
  }
,10 * 1000);
  Assert.assertTrue(result);
  LiveInstance fakeInstance=new LiveInstance("fakeInstance");
  fakeInstance.setSessionId("fakeSessionId");
  fakeInstance.setHelixVersion("0.6");
  accessor.setProperty(keyBuilder.liveInstance("fakeInstance"),fakeInstance);
  Thread.sleep(1000);
  for (  Map.Entry<String,DummyCallback> e : callbacks.entrySet()) {
    String instance=e.getKey();
    DummyCallback callback=e.getValue();
    Assert.assertFalse(callback.isInitTypeInvoked());
    Assert.assertFalse(callback.isCallbackTypeInvoked());
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isFinalizeTypeInvoked());
    }
  }
  accessor.removeProperty(keyBuilder.liveInstance("fakeInstance"));
  admin.enableResource(clusterName,customCodeRunnerResource,true);
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  extView=accessor.getProperty(keyBuilder.externalView(customCodeRunnerResource));
  instanceStates=extView.getStateMap(customCodeRunnerResource + "_0");
  leader=null;
  for (  String instance : instanceStates.keySet()) {
    String state=instanceStates.get(instance);
    if ("LEADER".equals(state)) {
      leader=instance;
      break;
    }
  }
  Assert.assertNotNull(leader);
  for (  String instance : callbacks.keySet()) {
    DummyCallback callback=callbacks.get(instance);
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isInitTypeInvoked());
    }
 else {
      Assert.assertFalse(callback.isInitTypeInvoked());
    }
    callback.reset();
  }
  accessor.setProperty(keyBuilder.liveInstance("fakeInstance"),fakeInstance);
  Thread.sleep(1000);
  for (  String instance : callbacks.keySet()) {
    DummyCallback callback=callbacks.get(instance);
    if (instance.equals(leader)) {
      Assert.assertTrue(callback.isCallbackTypeInvoked());
    }
 else {
      Assert.assertFalse(callback.isCallbackTypeInvoked());
    }
  }
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDisableNode </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDisableNode() throws Exception {
  String command="-zkSvr " + _zkaddr + " -enableInstance "+ CLUSTER_NAME+ " "+ "localhost_12918"+ " TestDB TestDB_0 false";
  ClusterSetup.processCommandLineArgs(command.split(" "));
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  ZKHelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.enableInstance(CLUSTER_NAME,"localhost_12918",true);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDisablePartition </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDisablePartition() throws Exception {
  LOG.info("START testDisablePartition() at " + new Date(System.currentTimeMillis()));
  String command="--zkSvr " + _zkaddr + " --enablePartition false "+ CLUSTER_NAME+ " localhost_12919 TestDB TestDB_0 TestDB_9";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Map<String,Set<String>> map=new HashMap<String,Set<String>>();
  map.put("TestDB_0",TestHelper.setOf("localhost_12919"));
  map.put("TestDB_9",TestHelper.setOf("localhost_12919"));
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  TestHelper.verifyState(CLUSTER_NAME,_zkaddr,map,"OFFLINE");
  ZKHelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.enablePartition(true,CLUSTER_NAME,"localhost_12919","TestDB",Arrays.asList("TestDB_9"));
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  map.clear();
  map.put("TestDB_0",TestHelper.setOf("localhost_12919"));
  TestHelper.verifyState(CLUSTER_NAME,_zkaddr,map,"OFFLINE");
  map.clear();
  map.put("TestDB_9",TestHelper.setOf("localhost_12919"));
  TestHelper.verifyState(CLUSTER_NAME,_zkaddr,map,"MASTER");
  LOG.info("STOP testDisablePartition() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDisableResource </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDisableResourceInCustomMode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,PARTITION_NUM,N,2,"MasterSlave",RebalanceMode.CUSTOMIZED,true);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setPartitionState("TestDB0_0","localhost_12918","SLAVE");
  idealState.setPartitionState("TestDB0_0","localhost_12919","SLAVE");
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant participants[]=new MockParticipant[N];
  for (int i=0; i < N; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  enableResource(clusterName,false);
  checkExternalView(clusterName);
  enableResource(clusterName,true);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < N; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDisableResourceInFullAutoMode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,PARTITION_NUM,N,2,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant participants[]=new MockParticipant[N];
  for (int i=0; i < N; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  enableResource(clusterName,false);
  checkExternalView(clusterName);
  enableResource(clusterName,true);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < N; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDisableResourceInSemiAutoMode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,PARTITION_NUM,N,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant participants[]=new MockParticipant[N];
  for (int i=0; i < N; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  enableResource(clusterName,false);
  checkExternalView(clusterName);
  enableResource(clusterName,true);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < N; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDrop </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDropResourceWithErrorPartitionSemiAuto() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errTransitions=new HashMap<String,Set<String>>();
  errTransitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errTransitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errTransitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropResource",clusterName,"TestDB0"});
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  assertEmptyCSandEV(className,"TestDB0",participants);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.dropResource(clusterName,"TestDB0");
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  assertEmptyCSandEV(clusterName,"TestDB0",participants);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDropResourceWithErrorPartitionCustom() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"MasterSlave",false);
  CustomModeISBuilder isBuilder=new CustomModeISBuilder("TestDB0");
  isBuilder.setNumPartitions(2);
  isBuilder.setNumReplica(2);
  isBuilder.setStateModel("MasterSlave");
  isBuilder.assignInstanceAndState("TestDB0_0","localhost_12918","MASTER");
  isBuilder.assignInstanceAndState("TestDB0_0","localhost_12919","SLAVE");
  isBuilder.assignInstanceAndState("TestDB0_1","localhost_12919","MASTER");
  isBuilder.assignInstanceAndState("TestDB0_1","localhost_12918","SLAVE");
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),isBuilder.build());
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errTransitions=new HashMap<String,Set<String>>();
  errTransitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_0"));
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errTransitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_0","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropResource",clusterName,"TestDB0"});
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result,"Should be empty exeternal-view");
  assertEmptyCSandEV(clusterName,"TestDB0",participants);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailToDropResourceWithErrorPartitionSemiAuto() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errTransitions=new HashMap<String,Set<String>>();
  errTransitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errTransitions.put("ERROR-DROPPED",TestHelper.setOf("TestDB0_4"));
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errTransitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropResource",clusterName,"TestDB0"});
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  InstanceConfig config=accessor.getProperty(keyBuilder.instanceConfig("localhost_12918"));
  List<String> disabledPartitions=config.getDisabledPartitions();
  Assert.assertEquals(disabledPartitions.size(),1,"TestDB0_4 should be disabled");
  Assert.assertEquals(disabledPartitions.get(0),"TestDB0_4");
  ExternalView ev=accessor.getProperty(keyBuilder.externalView("TestDB0"));
  Set<String> partitions=ev.getPartitionSet();
  Assert.assertEquals(partitions.size(),1,"Should have TestDB0_4->localhost_12918->ERROR");
  String errPartition=partitions.iterator().next();
  Assert.assertEquals(errPartition,"TestDB0_4");
  Map<String,String> stateMap=ev.getStateMap(errPartition);
  Assert.assertEquals(stateMap.size(),1);
  Assert.assertEquals(stateMap.keySet().iterator().next(),"localhost_12918");
  Assert.assertEquals(stateMap.get("localhost_12918"),HelixDefinedState.ERROR.name());
  CurrentState cs=accessor.getProperty(keyBuilder.currentState(participants[0].getInstanceName(),participants[0].getSessionId(),"TestDB0"));
  Map<String,String> partitionStateMap=cs.getPartitionStateMap();
  Assert.assertEquals(partitionStateMap.size(),1);
  Assert.assertEquals(partitionStateMap.keySet().iterator().next(),"TestDB0_4");
  Assert.assertEquals(partitionStateMap.get("TestDB0_4"),HelixDefinedState.ERROR.name());
  for (int i=1; i < n; i++) {
    String instanceName=participants[i].getInstanceName();
    String sessionId=participants[i].getSessionId();
    Assert.assertNull(accessor.getProperty(keyBuilder.currentState(instanceName,sessionId,"TestDB0")));
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDropSchemataResource() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --addResource "+ clusterName+ " schemata 1 STORAGE_DEFAULT_SM_SCHEMATA";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="--zkSvr " + _zkaddr + " --rebalance "+ clusterName+ " schemata "+ n;
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  command="--zkSvr " + _zkaddr + " --dropResource "+ clusterName+ " schemata";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  assertEmptyCSandEV(clusterName,"schemata",participants);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDrop.testDropSinglePartition(IdealState </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(dataProvider="RebalanceModeProvider") public void testDropSinglePartition(IdealState.RebalanceMode mode) throws Exception {
  if (!mode.equals(IdealState.RebalanceMode.FULL_AUTO) && !mode.equals(IdealState.RebalanceMode.SEMI_AUTO) && !mode.equals(IdealState.RebalanceMode.CUSTOMIZED)) {
    return;
  }
  String clusterName=TestHelper.getTestClassName() + "_" + TestHelper.getTestMethodName()+ "_"+ mode.name();
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",mode,true);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String partitionToDrop="TestDB0_1";
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.getRecord().getListFields().remove(partitionToDrop);
  idealState.getRecord().getMapFields().remove(partitionToDrop);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  ExternalView externalView=accessor.getProperty(keyBuilder.externalView("TestDB0"));
  Assert.assertFalse(externalView.getPartitionSet().contains(partitionToDrop),"TestDB0_0 should be dropped since it's not in ideal-state");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDropResource </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDropResource() throws Exception {
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB",6,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB",3);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  String command="-zkSvr " + _zkaddr + " -dropResource "+ CLUSTER_NAME+ " "+ "MyDB";
  ClusterSetup.processCommandLineArgs(command.split(" "));
  TestHelper.verifyWithTimeout("verifyEmptyCurStateAndExtView",30 * 1000,CLUSTER_NAME,"MyDB",TestHelper.<String>setOf("localhost_12918","localhost_12919","localhost_12920","localhost_12921","localhost_12922"),_zkaddr);
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDropResourceWhileNodeDead() throws Exception {
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB2",16,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB2",3);
  boolean verifyResult=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(verifyResult);
  String hostToKill="localhost_12920";
  _participants[2].syncStop();
  Thread.sleep(1000);
  String command="-zkSvr " + _zkaddr + " -dropResource "+ CLUSTER_NAME+ " "+ "MyDB2";
  ClusterSetup.processCommandLineArgs(command.split(" "));
  TestHelper.verifyWithTimeout("verifyEmptyCurStateAndExtView",30 * 1000,CLUSTER_NAME,"MyDB2",TestHelper.<String>setOf("localhost_12918","localhost_12919","localhost_12921","localhost_12922"),_zkaddr);
  _participants[2]=new MockParticipant(_zkaddr,CLUSTER_NAME,hostToKill);
  _participants[2].syncStart();
  TestHelper.verifyWithTimeout("verifyEmptyCurStateAndExtView",30 * 1000,CLUSTER_NAME,"MyDB2",TestHelper.<String>setOf("localhost_12918","localhost_12919","localhost_12920","localhost_12921","localhost_12922"),_zkaddr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestEnablePartitionDuringDisable </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEnablePartitionDuringDisable() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  EnablePartitionTransition transition=new EnablePartitionTransition();
  MockParticipant[] participants=new MockParticipant[5];
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (instanceName.equals("localhost_12919")) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(transition);
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String command="--zkSvr " + _zkaddr + " --enablePartition false "+ clusterName+ " localhost_12919 TestDB0 TestDB0_0";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  long startT=System.currentTimeMillis();
  while (System.currentTimeMillis() - startT < 10000) {
    if (transition.slaveToOfflineCnt > 0 && transition.offlineToSlave > 0) {
      break;
    }
    Thread.sleep(100);
  }
  long endT=System.currentTimeMillis();
  System.out.println("1 disable and re-enable took: " + (endT - startT) + "ms");
  Assert.assertEquals(transition.slaveToOfflineCnt,1,"should get 1 slaveToOffline transition");
  Assert.assertEquals(transition.offlineToSlave,1,"should get 1 offlineToSlave transition");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestEntropyFreeNodeBounce </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testBounceAll() throws Exception {
  final int NUM_PARTICIPANTS=5;
  final int NUM_PARTITIONS=123;
  final int NUM_REPLICAS=1;
  final String RESOURCE_PREFIX="TestDB";
  final String RESOURCE_NAME=RESOURCE_PREFIX + "0";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"OnlineOffline",RebalanceMode.FULL_AUTO,true);
  HelixManager[] participants=new HelixManager[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=createParticipant(clusterName,instanceName);
    participants[i].connect();
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  HelixAdmin helixAdmin=new ZKHelixAdmin(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  try {
    Thread.sleep(1000);
    boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
    Assert.assertTrue(result);
    ExternalView stableExternalView=accessor.getProperty(keyBuilder.externalView(RESOURCE_NAME));
    for (int i=0; i < NUM_PARTICIPANTS; i++) {
      helixAdmin.enableCluster(clusterName,false);
      participants[i].disconnect();
      Thread.sleep(1000);
      participants[i]=createParticipant(clusterName,participants[i].getInstanceName());
      participants[i].connect();
      Thread.sleep(1000);
      helixAdmin.enableCluster(clusterName,true);
      Thread.sleep(1000);
      result=ClusterStateVerifier.verifyByZkCallback(new MatchingExternalViewVerifier(stableExternalView,clusterName,1));
      if (!result) {
        ExternalView currentExternalView=accessor.getProperty(keyBuilder.externalView(RESOURCE_NAME));
        for (        String partition : stableExternalView.getPartitionSet()) {
          Map<String,String> expect=stableExternalView.getStateMap(partition);
          Map<String,String> actual=currentExternalView.getStateMap(partition);
          if (!expect.equals(actual)) {
            LOG.error(partition + " is moved. expect: " + expect+ ", actual: "+ actual);
          }
        }
      }
      Assert.assertTrue(result);
      stableExternalView=accessor.getProperty(keyBuilder.externalView(RESOURCE_NAME));
    }
  }
  finally {
    controller.syncStop();
    for (    HelixManager participant : participants) {
      participant.disconnect();
    }
    System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestErrorPartition </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testErrorPartition() throws Exception {
  String clusterName=TestUtil.getTestName();
  MockParticipant[] participants=new MockParticipant[5];
  System.out.println("START testErrorPartition() at " + new Date(System.currentTimeMillis()));
  ZKHelixAdmin tool=new ZKHelixAdmin(_zkclient);
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
      errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStates=new HashMap<String,Map<String,String>>();
  errStates.put("TestDB0",new HashMap<String,String>());
  errStates.get("TestDB0").put("TestDB0_4","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStates));
  Assert.assertTrue(result);
  Map<String,Set<String>> errorStateMap=new HashMap<String,Set<String>>();
  errorStateMap.put("TestDB0_4",TestHelper.setOf("localhost_12918"));
  TestHelper.verifyState(clusterName,_zkaddr,errorStateMap,"ERROR");
  tool.enablePartition(false,clusterName,"localhost_12918","TestDB0",Arrays.asList("TestDB0_4"));
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStates));
  Assert.assertTrue(result);
  TestHelper.verifyState(clusterName,_zkaddr,errorStateMap,"ERROR");
  tool.enableInstance(clusterName,"localhost_12918",false);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStates));
  Assert.assertTrue(result);
  tool.enablePartition(true,clusterName,"localhost_12918","TestDB0",Arrays.asList("TestDB0_4"));
  tool.enableInstance(clusterName,"localhost_12918",true);
  participants[0].syncStop();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  participants[0]=new MockParticipant(_zkaddr,clusterName,"localhost_12918");
  new Thread(participants[0]).start();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END testErrorPartition() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestExpandCluster </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testExpandCluster() throws Exception {
  String DB2="TestDB2";
  int partitions=100;
  int replica=3;
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB2,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB2,replica,"keyX");
  String DB3="TestDB3";
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB3,partitions,STATE_MODEL);
  IdealState testDB0=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,TEST_DB);
  IdealState testDB2=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB2);
  IdealState testDB3=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB3);
  for (int i=0; i < 5; i++) {
    String storageNodeName="localhost_" + (27960 + i);
    _setupTool.addInstanceToCluster(CLUSTER_NAME,storageNodeName);
  }
  String command="-zkSvr localhost:2183 -expandCluster " + CLUSTER_NAME;
  ClusterSetup.processCommandLineArgs(command.split(" "));
  IdealState testDB0_1=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,TEST_DB);
  IdealState testDB2_1=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB2);
  IdealState testDB3_1=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,DB3);
  Map<String,Object> resultOld2=RebalanceUtil.buildInternalIdealState(testDB2);
  Map<String,Object> result2=RebalanceUtil.buildInternalIdealState(testDB2_1);
  TestEspressoStorageClusterIdealState.Verify(result2,partitions,replica - 1);
  Double masterKeepRatio=0.0, slaveKeepRatio=0.0;
  double[] result=TestEspressoStorageClusterIdealState.compareResult(resultOld2,result2);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(masterKeepRatio > 0.49 && masterKeepRatio < 0.51);
  Assert.assertTrue(testDB3_1.getRecord().getListFields().size() == 0);
  Assert.assertTrue(testDB0_1.getRecord().getListFields().keySet().containsAll(testDB0.getRecord().getListFields().keySet()));
  Assert.assertTrue(testDB0_1.getRecord().getListFields().size() == testDB0.getRecord().getListFields().size());
  Assert.assertTrue(testDB2_1.getRecord().getMapFields().keySet().containsAll(testDB2.getRecord().getMapFields().keySet()));
  Assert.assertTrue(testDB2_1.getRecord().getMapFields().size() == testDB2.getRecord().getMapFields().size());
  Assert.assertTrue(testDB3_1.getRecord().getMapFields().keySet().containsAll(testDB3.getRecord().getMapFields().keySet()));
  Assert.assertTrue(testDB3_1.getRecord().getMapFields().size() == testDB3.getRecord().getMapFields().size());
  Map<String,Object> resultOld=RebalanceUtil.buildInternalIdealState(testDB0);
  Map<String,Object> resultNew=RebalanceUtil.buildInternalIdealState(testDB0_1);
  result=TestEspressoStorageClusterIdealState.compareResult(resultOld,resultNew);
  masterKeepRatio=result[0];
  slaveKeepRatio=result[1];
  Assert.assertTrue(masterKeepRatio > 0.49 && masterKeepRatio < 0.51);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestExternalViewUpdates </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testExternalViewUpdates() throws Exception {
  System.out.println("START testExternalViewUpdates at " + new Date(System.currentTimeMillis()));
  String clusterName=TestUtil.getTestName();
  MockParticipant[] participants=new MockParticipant[5];
  int resourceNb=10;
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",resourceNb,1,5,1,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Builder keyBuilder=new Builder(clusterName);
  String parentPath=keyBuilder.externalViews().getPath();
  List<String> childNames=_baseAccessor.getChildNames(parentPath,0);
  List<String> paths=new ArrayList<String>();
  for (  String name : childNames) {
    paths.add(parentPath + "/" + name);
  }
  for (  String path : paths) {
    Stat stat=_baseAccessor.getStat(path,0);
    Assert.assertTrue(stat.getVersion() <= 2,"ExternalView should be updated at most 2 times");
  }
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END testExternalViewUpdates at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestFullAutoNodeTagging </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUntag() throws Exception {
  final int NUM_PARTICIPANTS=2;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=1;
  final String RESOURCE_NAME="TestResource0";
  final String TAG="ASSIGNABLE";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestResource",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"OnlineOffline",RebalanceMode.FULL_AUTO,true);
  final HelixAdmin helixAdmin=new ZKHelixAdmin(_zkclient);
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,RESOURCE_NAME);
  idealState.setInstanceGroupTag(TAG);
  helixAdmin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    helixAdmin.addInstanceTag(clusterName,instanceName,TAG);
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  Verifier v=new Verifier(){
    @Override public boolean verify() throws Exception {
      ExternalView externalView=HelixTestUtil.pollForProperty(ExternalView.class,accessor,keyBuilder.externalView(RESOURCE_NAME),true);
      if (externalView == null) {
        return false;
      }
      Set<String> taggedInstances=Sets.newHashSet(helixAdmin.getInstancesInClusterWithTag(clusterName,TAG));
      Set<String> partitionSet=externalView.getPartitionSet();
      if (partitionSet.size() != NUM_PARTITIONS) {
        return false;
      }
      for (      String partitionName : partitionSet) {
        Map<String,String> stateMap=externalView.getStateMap(partitionName);
        if (stateMap.size() != NUM_REPLICAS) {
          return false;
        }
        for (        String participantName : stateMap.keySet()) {
          if (!taggedInstances.contains(participantName)) {
            return false;
          }
          String state=stateMap.get(participantName);
          if (!state.equalsIgnoreCase("ONLINE")) {
            return false;
          }
        }
      }
      return true;
    }
  }
;
  boolean initialResult=TestHelper.verify(v,10 * 1000);
  Assert.assertTrue(initialResult);
  helixAdmin.removeInstanceTag(clusterName,"localhost_12918",TAG);
  boolean finalResult=TestHelper.verify(v,10 * 1000);
  Assert.assertTrue(finalResult);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that no assignments happen when there are no tagged nodes, but the resource is tagged
 */
@Test public void testResourceTaggedFirst() throws Exception {
  final int NUM_PARTICIPANTS=10;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  final String RESOURCE_NAME="TestDB0";
  final String TAG="ASSIGNABLE";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  HelixAdmin helixAdmin=new ZKHelixAdmin(_zkaddr);
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,RESOURCE_NAME);
  idealState.setInstanceGroupTag(TAG);
  helixAdmin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new HelixTestUtil.EmptyZkVerifier(clusterName,RESOURCE_NAME,_zkclient));
  Assert.assertTrue(result,"External view and current state must be empty");
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    participants[i].syncStop();
  }
  controller.syncStop();
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * Basic test for tagging behavior. 10 participants, of which 4 are tagged. Launch all 10,
 * checking external view every time a tagged node is started. Then shut down all 10, checking
 * external view every time a tagged node is killed.
 */
@Test public void testSafeAssignment() throws Exception {
  final int NUM_PARTICIPANTS=10;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  final String RESOURCE_NAME="TestDB0";
  final String TAG="ASSIGNABLE";
  final String[] TAGGED_NODES={"localhost_12920","localhost_12922","localhost_12924","localhost_12925"};
  Set<String> taggedNodes=Sets.newHashSet(TAGGED_NODES);
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  HelixAdmin helixAdmin=new ZKHelixAdmin(_zkaddr);
  for (  String taggedNode : TAGGED_NODES) {
    helixAdmin.addInstanceTag(clusterName,taggedNode,TAG);
  }
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,RESOURCE_NAME);
  idealState.setInstanceGroupTag(TAG);
  helixAdmin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
    if (taggedNodes.contains(instanceName)) {
      Thread.sleep(500);
      boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
      Assert.assertTrue(result);
      result=ClusterStateVerifier.verifyByZkCallback(new TaggedZkVerifier(clusterName,RESOURCE_NAME,TAGGED_NODES,false));
      Assert.assertTrue(result,"initial assignment with all tagged nodes live is invalid");
    }
  }
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    String participantName=participants[i].getInstanceName();
    participants[i].syncStop();
    if (taggedNodes.contains(participantName)) {
      taggedNodes.remove(participantName);
      Thread.sleep(500);
      boolean result=ClusterStateVerifier.verifyByZkCallback(new TaggedZkVerifier(clusterName,RESOURCE_NAME,TAGGED_NODES,taggedNodes.isEmpty()));
      Assert.assertTrue(result,"incorrect state after removing " + participantName + ", "+ taggedNodes+ " remain");
    }
  }
  controller.syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestHelixConnection </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ClusterId clusterId=ClusterId.from(clusterName);
  ControllerId controllerId=ControllerId.from("controller");
  final ParticipantId participantId=ParticipantId.from("participant1");
  ResourceId resourceId=ResourceId.from("testDB");
  State master=State.from("MASTER");
  State slave=State.from("SLAVE");
  State offline=State.from("OFFLINE");
  State dropped=State.from("DROPPED");
  StateModelDefId stateModelDefId=StateModelDefId.from("MasterSlave");
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterAccessor clusterAccessor=connection.createClusterAccessor(clusterId);
  clusterAccessor.dropCluster();
  StateModelDefinition stateModelDef=new StateModelDefinition.Builder(stateModelDefId).addState(master,1).addState(slave,2).addState(offline,3).addState(dropped).addTransition(offline,slave,3).addTransition(slave,offline,4).addTransition(slave,master,2).addTransition(master,slave,1).addTransition(offline,dropped).initialState(offline).upperBound(master,1).dynamicUpperBound(slave,"R").build();
  PartitionId partition0=PartitionId.from(resourceId,"0");
  AutoModeISBuilder idealStateBuilder=new AutoModeISBuilder(resourceId).add(partition0);
  idealStateBuilder.setNumReplica(1).setStateModelDefId(stateModelDefId);
  idealStateBuilder.assignPreferenceList(partition0,participantId);
  IdealState idealState=idealStateBuilder.build();
  clusterAccessor.createCluster(new ClusterConfig.Builder(clusterId).addStateModelDefinition(stateModelDef).build());
  clusterAccessor.addResource(new ResourceConfig.Builder(resourceId).idealState(idealState).build());
  clusterAccessor.addParticipant(new ParticipantConfig.Builder(participantId).build());
  HelixController controller=connection.createController(clusterId,controllerId);
  controller.start();
  HelixParticipant participant=connection.createParticipant(clusterId,participantId);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("MasterSlave"),new MockStateModelFactory());
  participant.start();
  Thread.sleep(1000);
  final HelixDataAccessor accessor=connection.createDataAccessor(clusterId);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      ExternalView externalView=accessor.getProperty(keyBuilder.externalView("testDB"));
      Map<ParticipantId,State> stateMap=externalView.getStateMap(PartitionId.from("testDB_0"));
      if (stateMap == null || !stateMap.containsKey(participantId)) {
        return false;
      }
      return stateMap.get(participantId).equals(State.from("MASTER"));
    }
  }
,10 * 1000);
  Assert.assertTrue(success);
  controller.stop();
  participant.stop();
  connection.disconnect();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestHelixCustomCodeRunner </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCustomCodeRunner() throws Exception {
  System.out.println("START " + _clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(_clusterName,_zkaddr,_startPort,"localhost","TestDB",1,5,_nodeNb,_nodeNb,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,_clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[5];
  for (int i=0; i < _nodeNb; i++) {
    String instanceName="localhost_" + (_startPort + i);
    participants[i]=new MockParticipant(_zkaddr,_clusterName,instanceName);
    registerCustomCodeRunner(participants[i]);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,_clusterName));
  Assert.assertTrue(result);
  Thread.sleep(1000);
  Assert.assertTrue(_callback._isCallbackInvoked);
  _callback._isCallbackInvoked=false;
  HelixDataAccessor accessor=new ZKHelixDataAccessor(_clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  LiveInstance newLiveIns=new LiveInstance("newLiveInstance");
  newLiveIns.setHelixVersion("0.6.0");
  newLiveIns.setSessionId("randomSessionId");
  accessor.setProperty(keyBuilder.liveInstance("newLiveInstance"),newLiveIns);
  Thread.sleep(1000);
  Assert.assertTrue(_callback._isCallbackInvoked);
  controller.syncStop();
  for (int i=0; i < _nodeNb; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + _clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestHelixInstanceTag </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceTag() throws Exception {
  HelixManager manager=_controller;
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  String DB2="TestDB2";
  int partitions=100;
  String DB2tag="TestDB2_tag";
  int replica=2;
  for (int i=0; i < 2; i++) {
    String instanceName="localhost_" + (12918 + i);
    _setupTool.getClusterManagementTool().addInstanceTag(CLUSTER_NAME,instanceName,DB2tag);
  }
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB2,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB2,DB2tag,replica);
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME)));
  Assert.assertTrue(result,"Cluster verification fails");
  ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView(DB2));
  Set<String> hosts=new HashSet<String>();
  for (  String p : ev.getPartitionSet()) {
    for (    String hostName : ev.getStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(hostName));
      Assert.assertTrue(config.containsTag(DB2tag));
      hosts.add(hostName);
    }
  }
  Assert.assertEquals(hosts.size(),2);
  String DB3="TestDB3";
  String DB3Tag="TestDB3_tag";
  partitions=10;
  replica=3;
  for (int i=1; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    _setupTool.getClusterManagementTool().addInstanceTag(CLUSTER_NAME,instanceName,DB3Tag);
  }
  _setupTool.addResourceToCluster(CLUSTER_NAME,DB3,partitions,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,DB3,DB3Tag,replica);
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME)));
  Assert.assertTrue(result,"Cluster verification fails");
  ev=accessor.getProperty(accessor.keyBuilder().externalView(DB3));
  hosts=new HashSet<String>();
  for (  String p : ev.getPartitionSet()) {
    for (    String hostName : ev.getStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(hostName));
      Assert.assertTrue(config.containsTag(DB3Tag));
      hosts.add(hostName);
    }
  }
  Assert.assertEquals(hosts.size(),4);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestInstanceAutoJoin </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testInstanceAutoJoin() throws Exception {
  HelixManager manager=_participants[0];
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  _setupTool.addResourceToCluster(CLUSTER_NAME,db2,60,"OnlineOffline",RebalanceMode.FULL_AUTO + "");
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,db2,1);
  String instance2="localhost_279699";
  MockParticipant newParticipant=new MockParticipant(_zkaddr,CLUSTER_NAME,instance2);
  newParticipant.syncStart();
  Thread.sleep(500);
  Assert.assertTrue(null == manager.getHelixDataAccessor().getProperty(accessor.keyBuilder().liveInstance(instance2)));
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(CLUSTER_NAME).build();
  manager.getConfigAccessor().set(scope,ZKHelixManager.ALLOW_PARTICIPANT_AUTO_JOIN,"true");
  newParticipant=new MockParticipant(_zkaddr,CLUSTER_NAME,instance2);
  newParticipant.syncStart();
  Thread.sleep(500);
  for (int i=0; i < 20; i++) {
    if (null == manager.getHelixDataAccessor().getProperty(accessor.keyBuilder().liveInstance(instance2))) {
      Thread.sleep(100);
    }
 else     break;
  }
  Assert.assertTrue(null != manager.getHelixDataAccessor().getProperty(accessor.keyBuilder().liveInstance(instance2)));
  newParticipant.syncStop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestInvalidResourceRebalance </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that the Helix controller doesn't attempt to rebalance resources with invalid ideal
 * states
 */
@Test public void testResourceRebalanceSkipped() throws Exception {
  final int NUM_PARTICIPANTS=2;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  final String RESOURCE_NAME="TestDB0";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.SEMI_AUTO,true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  HelixAdmin helixAdmin=controller.getClusterManagmentTool();
  Map<String,String> properties=Maps.newHashMap();
  properties.put("IdealStateRule!sampleRuleName","IDEAL_STATE_MODE=CUSTOMIZED,STATE_MODEL_DEF_REF=MasterSlave");
  helixAdmin.setConfig(new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build(),properties);
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new HelixTestUtil.EmptyZkVerifier(clusterName,RESOURCE_NAME,_zkclient));
  Assert.assertTrue(result,"External view and current state must be empty");
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    participants[i].syncStop();
  }
  controller.syncStop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestMessagePartitionStateMismatch </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testStateMismatch() throws InterruptedException {
  HelixManager manager=_controller;
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder kb=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(kb.externalView(TEST_DB));
  Map<String,LiveInstance> liveinstanceMap=accessor.getChildValuesMap(accessor.keyBuilder().liveInstances());
  for (  String instanceName : liveinstanceMap.keySet()) {
    String sessionid=liveinstanceMap.get(instanceName).getTypedSessionId().stringify();
    for (    String partition : ev.getPartitionSet()) {
      if (ev.getStateMap(partition).containsKey(instanceName)) {
        MessageId uuid=MessageId.from(UUID.randomUUID().toString());
        Message message=new Message(MessageType.STATE_TRANSITION,uuid);
        boolean rand=new Random().nextInt(10) > 5;
        if (ev.getStateMap(partition).get(instanceName).equals("MASTER")) {
          message.setSrcName(manager.getInstanceName());
          message.setTgtName(instanceName);
          message.setMsgState(MessageState.NEW);
          message.setPartitionId(PartitionId.from(partition));
          message.setResourceId(ResourceId.from(TEST_DB));
          message.setFromState(State.from(rand ? "SLAVE" : "OFFLINE"));
          message.setToState(State.from(rand ? "MASTER" : "SLAVE"));
          message.setTgtSessionId(SessionId.from(sessionid));
          message.setSrcSessionId(SessionId.from(manager.getSessionId()));
          message.setStateModelDef(StateModelDefId.from("MasterSlave"));
          message.setStateModelFactoryName("DEFAULT");
        }
 else         if (ev.getStateMap(partition).get(instanceName).equals("SLAVE")) {
          message.setSrcName(manager.getInstanceName());
          message.setTgtName(instanceName);
          message.setMsgState(MessageState.NEW);
          message.setPartitionId(PartitionId.from(partition));
          message.setResourceId(ResourceId.from(TEST_DB));
          message.setFromState(State.from(rand ? "MASTER" : "OFFLINE"));
          message.setToState(State.from(rand ? "SLAVE" : "SLAVE"));
          message.setTgtSessionId(SessionId.from(sessionid));
          message.setSrcSessionId(SessionId.from(manager.getSessionId()));
          message.setStateModelDef(StateModelDefId.from("MasterSlave"));
          message.setStateModelFactoryName("DEFAULT");
        }
        accessor.setProperty(accessor.keyBuilder().message(instanceName,message.getMessageId().stringify()),message);
      }
    }
  }
  Thread.sleep(3000);
  ExternalView ev2=accessor.getProperty(kb.externalView(TEST_DB));
  Assert.assertTrue(ev.equals(ev2));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestMessageThrottle </h4><pre class="type-14 type-5 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testMessageThrottle() throws Exception {
  String clusterName=TestUtil.getTestName();
  MockParticipant[] participants=new MockParticipant[5];
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  ConstraintItemBuilder builder=new ConstraintItemBuilder();
  builder.addConstraintAttribute("MESSAGE_TYPE","STATE_TRANSITION").addConstraintAttribute("INSTANCE",".*").addConstraintAttribute("CONSTRAINT_VALUE","1");
  admin.setConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1",builder.build());
  final ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final AtomicBoolean success=new AtomicBoolean(true);
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    String msgPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,clusterName,instanceName);
    _zkclient.subscribeChildChanges(msgPath,new IZkChildListener(){
      @Override public void handleChildChange(      String parentPath,      List<String> currentChilds) throws Exception {
        if (currentChilds != null && currentChilds.size() > 1) {
          List<ZNRecord> records=accessor.getBaseDataAccessor().getChildren(parentPath,null,0);
          int transitionMsgCount=0;
          for (          ZNRecord record : records) {
            Message msg=new Message(record);
            if (msg.getMsgType().equals(Message.MessageType.STATE_TRANSITION.toString())) {
              transitionMsgCount++;
            }
          }
          if (transitionMsgCount > 1) {
            success.set(false);
            Assert.fail("Should not see more than 1 message");
          }
        }
      }
    }
);
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertTrue(success.get());
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestMessageThrottle2 </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  startAdmin();
  startController();
  Node.main(new String[]{"2"});
  final Builder keyBuilder=new Builder(clusterName);
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      ExternalView view=accessor.getProperty(keyBuilder.externalView(resourceName));
      String state=null;
      if (view != null) {
        Map<String,String> map=view.getStateMap(resourceName);
        if (map != null) {
          state=map.get("node2");
        }
      }
      return state != null && state.equals("MASTER");
    }
  }
,10 * 1000);
  Node.main(new String[]{"1"});
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestMessagingService </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testBlockingSendReceive() throws Exception {
  String hostSrc="localhost_" + START_PORT;
  String hostDest="localhost_" + (START_PORT + 1);
  TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
  _participants[1].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  MessageId msgId=MessageId.from(new UUID(123,456).toString());
  Message msg=new Message(factory.getMessageType(),msgId);
  msg.setMessageId(msgId);
  msg.setSrcName(hostSrc);
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setMsgState(MessageState.NEW);
  String para="Testing messaging para";
  msg.getRecord().setSimpleField("TestMessagingPara",para);
  Criteria cr=new Criteria();
  cr.setInstanceName(hostDest);
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  AsyncCallback asyncCallback=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,asyncCallback,60000);
  AssertJUnit.assertTrue(asyncCallback.getMessageReplied().get(0).getRecord().getMapField(Message.Attributes.MESSAGE_RESULT.toString()).get("ReplyMessage").equals("TestReplyMessage"));
  AssertJUnit.assertTrue(asyncCallback.getMessageReplied().size() == 1);
  AsyncCallback asyncCallback2=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,asyncCallback2,500);
  AssertJUnit.assertTrue(asyncCallback2.isTimedOut());
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testMultiMessageCriteria() throws Exception {
  String hostSrc="localhost_" + START_PORT;
  for (int i=0; i < NODE_NR; i++) {
    TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
    _participants[0].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  }
  MessageId msgId=MessageId.from(new UUID(123,456).toString());
  Message msg=new Message(new TestMessagingHandlerFactory().getMessageType(),msgId);
  msg.setMessageId(msgId);
  msg.setSrcName(hostSrc);
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setMsgState(MessageState.NEW);
  String para="Testing messaging para";
  msg.getRecord().setSimpleField("TestMessagingPara",para);
  Criteria cr=new Criteria();
  cr.setInstanceName("%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  AsyncCallback callback1=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback1,10000);
  AssertJUnit.assertTrue(callback1.getMessageReplied().get(0).getRecord().getMapField(Message.Attributes.MESSAGE_RESULT.toString()).get("ReplyMessage").equals("TestReplyMessage"));
  AssertJUnit.assertTrue(callback1.getMessageReplied().size() == NODE_NR - 1);
  AsyncCallback callback2=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback2,500);
  AssertJUnit.assertTrue(callback2.isTimedOut());
  cr.setPartition("TestDB_17");
  AsyncCallback callback3=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback3,10000);
  AssertJUnit.assertTrue(callback3.getMessageReplied().size() == _replica - 1);
  cr.setPartition("TestDB_15");
  AsyncCallback callback4=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback4,10000);
  AssertJUnit.assertTrue(callback4.getMessageReplied().size() == _replica);
  cr.setPartitionState("SLAVE");
  AsyncCallback callback5=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback5,10000);
  AssertJUnit.assertTrue(callback5.getMessageReplied().size() == _replica - 1);
  cr.setDataSource(DataSource.IDEALSTATES);
  AsyncCallback callback6=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback6,10000);
  AssertJUnit.assertTrue(callback6.getMessageReplied().size() == _replica - 1);
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testControllerMessage() throws Exception {
  String hostSrc="localhost_" + START_PORT;
  for (int i=0; i < NODE_NR; i++) {
    TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  }
  MessageId msgId=MessageId.from(new UUID(123,456).toString());
  Message msg=new Message(MessageType.CONTROLLER_MSG,msgId);
  msg.setMessageId(msgId);
  msg.setSrcName(hostSrc);
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setMsgState(MessageState.NEW);
  String para="Testing messaging para";
  msg.getRecord().setSimpleField("TestMessagingPara",para);
  Criteria cr=new Criteria();
  cr.setInstanceName("*");
  cr.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr.setSessionSpecific(false);
  AsyncCallback callback1=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback1,10000);
  AssertJUnit.assertTrue(callback1.getMessageReplied().get(0).getRecord().getMapField(Message.Attributes.MESSAGE_RESULT.toString()).get("ControllerResult").indexOf(hostSrc) != -1);
  AssertJUnit.assertTrue(callback1.getMessageReplied().size() == 1);
  msgId=MessageId.from(UUID.randomUUID().toString());
  msg.setMessageId(msgId);
  cr.setPartition("TestDB_17");
  AsyncCallback callback2=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback2,10000);
  AssertJUnit.assertTrue(callback2.getMessageReplied().get(0).getRecord().getMapField(Message.Attributes.MESSAGE_RESULT.toString()).get("ControllerResult").indexOf(hostSrc) != -1);
  AssertJUnit.assertTrue(callback2.getMessageReplied().size() == 1);
  msgId=MessageId.from(UUID.randomUUID().toString());
  msg.setMessageId(msgId);
  cr.setPartitionState("SLAVE");
  AsyncCallback callback3=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback3,10000);
  AssertJUnit.assertTrue(callback3.getMessageReplied().get(0).getRecord().getMapField(Message.Attributes.MESSAGE_RESULT.toString()).get("ControllerResult").indexOf(hostSrc) != -1);
  AssertJUnit.assertTrue(callback3.getMessageReplied().size() == 1);
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testMessageSimpleSendReceiveAsync() throws Exception {
  String hostSrc="localhost_" + START_PORT;
  String hostDest="localhost_" + (START_PORT + 1);
  TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
  _participants[1].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  _participants[0].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  MessageId msgId=MessageId.from(new UUID(123,456).toString());
  Message msg=new Message(factory.getMessageType(),msgId);
  msg.setMessageId(msgId);
  msg.setSrcName(hostSrc);
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setMsgState(MessageState.NEW);
  String para="Testing messaging para";
  msg.getRecord().setSimpleField("TestMessagingPara",para);
  Criteria cr=new Criteria();
  cr.setInstanceName(hostDest);
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  TestAsyncCallback callback=new TestAsyncCallback(60000);
  _participants[0].getMessagingService().send(cr,msg,callback,60000);
  Thread.sleep(2000);
  AssertJUnit.assertTrue(TestAsyncCallback._replyedMessageContents.contains("TestReplyMessage"));
  AssertJUnit.assertTrue(callback.getMessageReplied().size() == 1);
  TestAsyncCallback callback2=new TestAsyncCallback(500);
  _participants[0].getMessagingService().send(cr,msg,callback2,500);
  Thread.sleep(3000);
  AssertJUnit.assertTrue(callback2.isTimedOut());
  cr=new Criteria();
  cr.setInstanceName(hostDest);
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setDataSource(DataSource.IDEALSTATES);
  callback=new TestAsyncCallback(60000);
  _participants[0].getMessagingService().send(cr,msg,callback,60000);
  Thread.sleep(2000);
  AssertJUnit.assertTrue(TestAsyncCallback._replyedMessageContents.contains("TestReplyMessage"));
  AssertJUnit.assertTrue(callback.getMessageReplied().size() == 1);
  callback2=new TestAsyncCallback(500);
  _participants[0].getMessagingService().send(cr,msg,callback2,500);
  Thread.sleep(3000);
  AssertJUnit.assertTrue(callback2.isTimedOut());
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void sendSelfMsg(){
  String hostSrc="localhost_" + START_PORT;
  for (int i=0; i < NODE_NR; i++) {
    TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  }
  MessageId msgId=MessageId.from(new UUID(123,456).toString());
  Message msg=new Message(new TestMessagingHandlerFactory().getMessageType(),msgId);
  msg.setMessageId(msgId);
  msg.setSrcName(hostSrc);
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setMsgState(MessageState.NEW);
  String para="Testing messaging para";
  msg.getRecord().setSimpleField("TestMessagingPara",para);
  Criteria cr=new Criteria();
  cr.setInstanceName("%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setSelfExcluded(false);
  AsyncCallback callback1=new MockAsyncCallback();
  _participants[0].getMessagingService().sendAndWait(cr,msg,callback1,10000);
  AssertJUnit.assertTrue(callback1.getMessageReplied().size() == NODE_NR);
  AssertJUnit.assertTrue(callback1.getMessageReplied().get(0).getRecord().getMapField(Message.Attributes.MESSAGE_RESULT.toString()).get("ReplyMessage").equals("TestReplyMessage"));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testMessageSimpleSend() throws Exception {
  String hostSrc="localhost_" + START_PORT;
  String hostDest="localhost_" + (START_PORT + 1);
  TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
  _participants[1].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
  MessageId msgId=MessageId.from(new UUID(123,456).toString());
  Message msg=new Message(factory.getMessageType(),msgId);
  msg.setMessageId(msgId);
  msg.setSrcName(hostSrc);
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setMsgState(MessageState.NEW);
  String para="Testing messaging para";
  msg.getRecord().setSimpleField("TestMessagingPara",para);
  Criteria cr=new Criteria();
  cr.setInstanceName(hostDest);
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  int nMsgs=_participants[0].getMessagingService().send(cr,msg);
  AssertJUnit.assertTrue(nMsgs == 1);
  Thread.sleep(2500);
  AssertJUnit.assertTrue(TestMessagingHandlerFactory._processedMsgIds.contains(para));
  cr=new Criteria();
  cr.setInstanceName(hostDest);
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setDataSource(DataSource.IDEALSTATES);
  nMsgs=_participants[0].getMessagingService().send(cr,msg);
  AssertJUnit.assertTrue(nMsgs == 1);
  Thread.sleep(2500);
  AssertJUnit.assertTrue(TestMessagingHandlerFactory._processedMsgIds.contains(para));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestMultiClusterController </h4><pre class="type-4 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testAddAndStop() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterNamePrefix=className + "_" + methodName;
  final int n=5;
  final int clusterNb=10;
  System.out.println("START " + clusterNamePrefix + " at "+ new Date(System.currentTimeMillis()));
  for (int i=0; i < clusterNb; i++) {
    String clusterName=clusterNamePrefix + "0_" + i;
    String participantName="localhost" + i;
    String resourceName="TestDB" + i;
    TestHelper.setupCluster(clusterName,_zkaddr,12918,participantName,resourceName,1,8,n,3,"MasterSlave",true);
  }
  final String controllerClusterName="CONTROLLER_" + clusterNamePrefix;
  TestHelper.setupCluster("CONTROLLER_" + clusterNamePrefix,_zkaddr,0,"controller",clusterNamePrefix,1,clusterNb,n,3,"LeaderStandby",true);
  MockMultiClusterController[] controllers=new MockMultiClusterController[n + n];
  for (int i=0; i < n; i++) {
    controllers[i]=new MockMultiClusterController(_zkaddr,controllerClusterName,"controller_" + i);
    controllers[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName),30000);
  Assert.assertTrue(result,"Controller cluster NOT in ideal state");
  MockParticipant[] participants=new MockParticipant[n];
  final String firstClusterName=clusterNamePrefix + "0_0";
  for (int i=0; i < n; i++) {
    String instanceName="localhost0_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,firstClusterName,instanceName);
    participants[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,firstClusterName));
  Assert.assertTrue(result,"first cluster NOT in ideal state");
  for (int i=0; i < n; i++) {
    String controller="controller_" + (n + i);
    _setupTool.addInstanceToCluster(controllerClusterName,controller);
  }
  _setupTool.rebalanceStorageCluster(controllerClusterName,clusterNamePrefix + "0",6);
  for (int i=n; i < 2 * n; i++) {
    controllers[i]=new MockMultiClusterController(_zkaddr,controllerClusterName,"controller_" + i);
    controllers[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
  Assert.assertTrue(result,"Controller cluster NOT in ideal state");
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,firstClusterName));
  Assert.assertTrue(result,"first cluster NOT in ideal state");
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(controllerClusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
    String leaderName=leader.getId();
    int j=Integer.parseInt(leaderName.substring(leaderName.lastIndexOf('_') + 1));
    controllers[j].syncStop();
    result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
    Assert.assertTrue(result,"Controller cluster NOT in ideal state");
    result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,firstClusterName));
    Assert.assertTrue(result,"first cluster NOT in ideal state");
  }
  System.out.println("Cleaning up...");
  for (int i=0; i < 5; i++) {
    result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
    controllers[i].syncStop();
  }
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterNamePrefix + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterNamePrefix=className + "_" + methodName;
  final int n=5;
  final int clusterNb=10;
  System.out.println("START " + clusterNamePrefix + " at "+ new Date(System.currentTimeMillis()));
  for (int i=0; i < clusterNb; i++) {
    String clusterName=clusterNamePrefix + "0_" + i;
    String participantName="localhost" + i;
    String resourceName="TestDB" + i;
    TestHelper.setupCluster(clusterName,_zkaddr,12918,participantName,resourceName,1,8,n,3,"MasterSlave",true);
  }
  final String controllerClusterName="CONTROLLER_" + clusterNamePrefix;
  TestHelper.setupCluster("CONTROLLER_" + clusterNamePrefix,_zkaddr,0,"controller",clusterNamePrefix,1,clusterNb,n,3,"LeaderStandby",true);
  MockMultiClusterController[] controllers=new MockMultiClusterController[n];
  for (int i=0; i < n; i++) {
    controllers[i]=new MockMultiClusterController(_zkaddr,controllerClusterName,"controller_" + i);
    controllers[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName),30000);
  Assert.assertTrue(result,"Controller cluster NOT in ideal state");
  MockParticipant[] participants=new MockParticipant[n];
  final String firstClusterName=clusterNamePrefix + "0_0";
  for (int i=0; i < n; i++) {
    String instanceName="localhost0_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,firstClusterName,instanceName);
    participants[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,firstClusterName));
  Assert.assertTrue(result,"first cluster NOT in ideal state");
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(controllerClusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  String leaderName=leader.getId();
  int j=Integer.parseInt(leaderName.substring(leaderName.lastIndexOf('_') + 1));
  controllers[j].syncStop();
  MockParticipant[] participants2=new MockParticipant[n];
  final String secondClusterName=clusterNamePrefix + "0_1";
  for (int i=0; i < n; i++) {
    String instanceName="localhost1_" + (12918 + i);
    participants2[i]=new MockParticipant(_zkaddr,secondClusterName,instanceName);
    participants2[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,secondClusterName));
  Assert.assertTrue(result,"second cluster NOT in ideal state");
  System.out.println("Cleaning up...");
  for (int i=0; i < 5; i++) {
    result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
    controllers[i].syncStop();
  }
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterNamePrefix + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestNonOfflineInitState </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNonOfflineInitState() throws Exception {
  System.out.println("START testNonOfflineInitState at " + new Date(System.currentTimeMillis()));
  String clusterName=TestUtil.getTestName();
  setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,1,"Bootstrap",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[5];
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    StateMachineEngine stateMach=participants[i].getStateMachineEngine();
    MockBootstrapModelFactory bootstrapFactory=new MockBootstrapModelFactory();
    stateMach.registerStateModelFactory(StateModelDefId.from("Bootstrap"),bootstrapFactory);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END testNonOfflineInitState at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestNullReplica </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNullReplica() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[5];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  String idealStatePath=PropertyPathConfig.getPath(PropertyType.IDEALSTATES,clusterName,"TestDB0");
  ZNRecord idealState=_zkclient.readData(idealStatePath);
  idealState.getSimpleFields().remove(IdealState.IdealStateProperty.REPLICAS.toString());
  _zkclient.writeData(idealStatePath,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestParticipantErrorMessage </h4><pre class="type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void TestParticipantErrorMessageSend(){
  String participant1="localhost_" + START_PORT;
  String participant2="localhost_" + (START_PORT + 1);
  Message errorMessage1=new Message(MessageType.PARTICIPANT_ERROR_REPORT,MessageId.from(UUID.randomUUID().toString()));
  errorMessage1.setTgtSessionId(SessionId.from("*"));
  errorMessage1.getRecord().setSimpleField(DefaultParticipantErrorMessageHandlerFactory.ACTIONKEY,ActionOnError.DISABLE_INSTANCE.toString());
  Criteria recipientCriteria=new Criteria();
  recipientCriteria.setRecipientInstanceType(InstanceType.CONTROLLER);
  recipientCriteria.setSessionSpecific(false);
  _participants[0].getMessagingService().send(recipientCriteria,errorMessage1);
  Message errorMessage2=new Message(MessageType.PARTICIPANT_ERROR_REPORT,MessageId.from(UUID.randomUUID().toString()));
  errorMessage2.setTgtSessionId(SessionId.from("*"));
  errorMessage2.setResourceId(ResourceId.from("TestDB"));
  errorMessage2.setPartitionId(PartitionId.from("TestDB_14"));
  errorMessage2.getRecord().setSimpleField(DefaultParticipantErrorMessageHandlerFactory.ACTIONKEY,ActionOnError.DISABLE_PARTITION.toString());
  Criteria recipientCriteria2=new Criteria();
  recipientCriteria2.setRecipientInstanceType(InstanceType.CONTROLLER);
  recipientCriteria2.setSessionSpecific(false);
  _participants[1].getMessagingService().send(recipientCriteria2,errorMessage2);
  try {
    Thread.sleep(1500);
  }
 catch (  InterruptedException e) {
    LOG.error("Interrupted sleep",e);
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  Builder kb=_participants[1].getHelixDataAccessor().keyBuilder();
  ExternalView externalView=_participants[1].getHelixDataAccessor().getProperty(kb.externalView("TestDB"));
  for (  String partitionName : externalView.getRecord().getMapFields().keySet()) {
    for (    String hostName : externalView.getRecord().getMapField(partitionName).keySet()) {
      if (hostName.equals(participant1)) {
        Assert.assertTrue(externalView.getRecord().getMapField(partitionName).get(hostName).equalsIgnoreCase("OFFLINE"));
      }
    }
  }
  Assert.assertTrue(externalView.getRecord().getMapField("TestDB_14").get(participant2).equalsIgnoreCase("OFFLINE"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestPartitionLevelTransitionConstraint </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,1,n,2,"MasterSlave",false);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  StateModelDefinition stateModelDef=defineStateModel();
  accessor.setProperty(accessor.keyBuilder().stateModelDef("Bootstrap"),stateModelDef);
  IdealState idealState=accessor.getProperty(accessor.keyBuilder().idealStates("TestDB0"));
  idealState.setStateModelDefRef("Bootstrap");
  idealState.setReplicas("2");
  idealState.getRecord().setListField("TestDB0_0",Arrays.asList("localhost_12919","localhost_12918"));
  accessor.setProperty(accessor.keyBuilder().idealStates("TestDB0"),idealState);
  ConstraintItemBuilder constraintItemBuilder=new ConstraintItemBuilder();
  constraintItemBuilder.addConstraintAttribute(ConstraintAttribute.MESSAGE_TYPE.toString(),"STATE_TRANSITION").addConstraintAttribute(ConstraintAttribute.PARTITION.toString(),".*").addConstraintAttribute(ConstraintAttribute.CONSTRAINT_VALUE.toString(),"1");
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.setConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1",constraintItemBuilder.build());
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  String instanceName1="localhost_12918";
  participants[0]=new MockParticipant(_zkaddr,clusterName,instanceName1);
  participants[0].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("Bootstrap"),new BootstrapStateModelFactory());
  participants[0].syncStart();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String instanceName2="localhost_12919";
  participants[1]=new MockParticipant(_zkaddr,clusterName,instanceName2);
  participants[1].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("Bootstrap"),new BootstrapStateModelFactory());
  participants[1].syncStart();
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertEquals(_msgOrderList.size(),7);
  Message[] _msgOrderArray=_msgOrderList.toArray(new Message[0]);
  assertMessage(_msgOrderArray[0],"OFFLINE","BOOTSTRAP",instanceName1);
  assertMessage(_msgOrderArray[1],"BOOTSTRAP","SLAVE",instanceName1);
  assertMessage(_msgOrderArray[2],"SLAVE","MASTER",instanceName1);
  assertMessage(_msgOrderArray[3],"OFFLINE","BOOTSTRAP",instanceName2);
  assertMessage(_msgOrderArray[4],"BOOTSTRAP","SLAVE",instanceName2);
  assertMessage(_msgOrderArray[5],"MASTER","SLAVE",instanceName1);
  assertMessage(_msgOrderArray[6],"SLAVE","MASTER",instanceName2);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestPauseSignal </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testPauseSignal() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[5];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  ZkClient zkClient=new ZkClient(_zkaddr);
  zkClient.setZkSerializer(new ZNRecordSerializer());
  final HelixDataAccessor tmpAccessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(zkClient));
  String cmd="-zkSvr " + _zkaddr + " -enableCluster "+ clusterName+ " false";
  ClusterSetup.processCommandLineArgs(cmd.split(" "));
  tmpAccessor.setProperty(tmpAccessor.keyBuilder().pause(),new PauseSignal("pause"));
  zkClient.close();
  Thread.sleep(1000);
  _setupTool.addResourceToCluster(clusterName,"TestDB1",10,"MasterSlave");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB1",3);
  TestHelper.verifyWithTimeout("verifyEmptyCurStateAndExtView",1000,clusterName,"TestDB1",TestHelper.<String>setOf("localhost_12918","localhost_12919","localhost_12920","localhost_12921","localhost_12922"),_zkaddr);
  cmd="-zkSvr " + _zkaddr + " -enableCluster "+ clusterName+ " true";
  ClusterSetup.processCommandLineArgs(cmd.split(" "));
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestRedefineStateModelDef </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,2,"MasterSlave",false);
  autoRebalance(clusterName);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  redefineStateModelDef(clusterName);
  controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Thread.sleep(1000);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestReelectedPipelineCorrectness </h4><pre class="type-14 type-5 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReelection() throws Exception {
  final int NUM_CONTROLLERS=2;
  final int NUM_PARTICIPANTS=4;
  final int NUM_PARTITIONS=8;
  final int NUM_REPLICAS=2;
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  String controllerCluster=clusterName + "_controllers";
  _setupTool.addCluster(controllerCluster,true);
  for (int i=0; i < NUM_CONTROLLERS; i++) {
    _setupTool.addInstanceToCluster(controllerCluster,"controller_" + i);
  }
  _setupTool.activateCluster(clusterName,controllerCluster,true);
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  MockMultiClusterController[] controllers=new MockMultiClusterController[NUM_CONTROLLERS];
  for (int i=0; i < NUM_CONTROLLERS; i++) {
    controllers[i]=new MockMultiClusterController(_zkaddr,controllerCluster,"controller_" + i);
    controllers[i].syncStart();
  }
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=participants[0].getHelixDataAccessor();
  LiveInstance leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  int totalWait=0;
  while (leader == null && totalWait < CHECK_TIMEOUT) {
    Thread.sleep(CHECK_INTERVAL);
    totalWait+=CHECK_INTERVAL;
    leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  }
  if (totalWait >= CHECK_TIMEOUT) {
    Assert.fail("No leader was ever elected!");
  }
  String leaderId=leader.getId();
  String standbyId=(leaderId.equals("controller_0")) ? "controller_1" : "controller_0";
  HelixAdmin admin=_setupTool.getClusterManagementTool();
  admin.enableInstance(controllerCluster,leaderId,false);
  Thread.sleep(500);
  participants[0].syncStop();
  Thread.sleep(500);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  admin.enableInstance(controllerCluster,standbyId,false);
  Thread.sleep(500);
  participants[1].syncStop();
  IdealState idealState=admin.getResourceIdealState(clusterName,"TestDB0");
  idealState.setMaxPartitionsPerInstance(1);
  admin.setResourceIdealState(clusterName,"TestDB0",idealState);
  Thread.sleep(500);
  admin.enableInstance(clusterName,"localhost_12920",false);
  admin.enableInstance(controllerCluster,leaderId,true);
  Thread.sleep(500);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (int i=0; i < NUM_CONTROLLERS; i++) {
    controllers[i].syncStop();
  }
  for (int i=2; i < NUM_PARTICIPANTS; i++) {
    participants[i].syncStop();
  }
  System.out.println("STOP " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestRenamePartition </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testRenamePartitionAutoIS() throws Exception {
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  startAndVerify(clusterName);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  List<String> prioList=idealState.getRecord().getListFields().remove("TestDB0_0");
  idealState.getRecord().getListFields().put("TestDB0_100",prioList);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  stop(clusterName);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testRenamePartitionCustomIS() throws Exception {
  String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",false);
  List<String> instanceNames=Arrays.asList("localhost_12918","localhost_12919","localhost_12920","localhost_12921","localhost_12922");
  ZNRecord destIS=DefaultTwoStateStrategy.calculateIdealState(instanceNames,10,3 - 1,"TestDB0","MASTER","SLAVE");
  IdealState idealState=new IdealState(destIS);
  idealState.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  idealState.setReplicas("3");
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  startAndVerify(clusterName);
  Map<String,String> stateMap=idealState.getRecord().getMapFields().remove("TestDB0_0");
  idealState.getRecord().getMapFields().put("TestDB0_100",stateMap);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  stop(clusterName);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestResetInstance </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testResetInstance() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  participants[0].setTransition(null);
  String command="--zkSvr " + _zkaddr + " --resetInstance "+ clusterName+ " localhost_12918";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName)));
  Assert.assertTrue(result,"Cluster verification fails");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestResetPartitionState </h4><pre class="type-5 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testResetPartitionState() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  try {
    String command="--zkSvr " + _zkaddr + " --resetPartition "+ clusterName+ " localhost_12918 TestDB0 TestDB0_nonExist";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("Should throw exception on reset a non-exist partition");
  }
 catch (  Exception e) {
  }
  errPartitions.remove("SLAVE-MASTER");
  participants[0].setTransition(new ErrTransitionWithResetCnt(errPartitions));
  clearStatusUpdate(clusterName,"localhost_12918","TestDB0","TestDB0_4");
  _errToOfflineInvoked=0;
  String command="--zkSvr " + _zkaddr + " --resetPartition "+ clusterName+ " localhost_12918 TestDB0 TestDB0_4";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Thread.sleep(200);
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("Should throw exception on reset a partition not in ERROR state");
  }
 catch (  Exception e) {
  }
  errStateMap.get("TestDB0").remove("TestDB0_4");
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  Assert.assertEquals(_errToOfflineInvoked,1);
  participants[0].setTransition(new ErrTransitionWithResetCnt(null));
  clearStatusUpdate(clusterName,"localhost_12918","TestDB0","TestDB0_8");
  command="--zkSvr " + _zkaddr + " --resetPartition "+ clusterName+ " localhost_12918 TestDB0 TestDB0_8";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result,"Cluster verification fails");
  Assert.assertEquals(_errToOfflineInvoked,2,"Should reset 2 partitions");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestResetResource </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testResetNode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  participants[0].setTransition(null);
  String command="--zkSvr " + _zkaddr + " --resetResource "+ clusterName+ " TestDB0";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName)));
  Assert.assertTrue(result,"Cluster verification fails");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestResourceWithSamePartitionKey </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"OnlineOffline",RebalanceMode.CUSTOMIZED,false);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setReplicas("2");
  idealState.setPartitionState("0","localhost_12918","ONLINE");
  idealState.setPartitionState("0","localhost_12919","ONLINE");
  idealState.setPartitionState("1","localhost_12918","ONLINE");
  idealState.setPartitionState("1","localhost_12919","ONLINE");
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  IdealState newIdealState=new IdealState("TestDB1");
  newIdealState.getRecord().setSimpleFields(idealState.getRecord().getSimpleFields());
  newIdealState.setPartitionState("0","localhost_12918","ONLINE");
  newIdealState.setPartitionState("0","localhost_12919","ONLINE");
  newIdealState.setPartitionState("1","localhost_12918","ONLINE");
  newIdealState.setPartitionState("1","localhost_12919","ONLINE");
  accessor.setProperty(keyBuilder.idealStates("TestDB1"),newIdealState);
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    List<String> errs=accessor.getChildNames(keyBuilder.errors(instanceName));
    Assert.assertTrue(errs.isEmpty());
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestRestartParticipant </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testRestartParticipant() throws Exception {
  System.out.println("START testRestartParticipant at " + new Date(System.currentTimeMillis()));
  String clusterName=TestUtil.getTestName();
  MockParticipant[] participants=new MockParticipant[5];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 4) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new KillOtherTransition(participants[0]));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Thread.sleep(500);
  MockParticipant participant=new MockParticipant(_zkaddr,participants[0].getClusterName(),participants[0].getInstanceName());
  System.err.println("Restart " + participant.getInstanceName());
  participant.syncStart();
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  participant.syncStop();
  System.out.println("START testRestartParticipant at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSchedulerMessage </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSchedulerMsgContraints() throws JsonGenerationException, JsonMappingException, IOException, InterruptedException {
  TestMessagingHandlerFactoryLatch factory=new TestMessagingHandlerFactoryLatch();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsgContraints");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("SentMessageCount")) {
      Assert.assertEquals(statusUpdate.getMapFields().get("SentMessageCount").get("MessageCount"),"" + (_PARTITIONS * 3));
      break;
    }
  }
  for (int i=0; i < _PARTITIONS * 3 / 5; i++) {
    for (int j=0; j < 10; j++) {
      Thread.sleep(300);
      if (factory._messageCount == 5 * (i + 1))       break;
    }
    Thread.sleep(300);
    Assert.assertEquals(factory._messageCount,5 * (i + 1));
    factory.signal();
  }
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
  int messageResultCount=0;
  for (  String key : statusUpdate.getMapFields().keySet()) {
    if (key.startsWith("MessageResult ")) {
      messageResultCount++;
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  manager.getClusterManagmentTool().removeConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsgUsingQueue() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg3() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg3");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  for (int i=0; i < 4; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
    Builder keyBuilder=helixDataAccessor.keyBuilder();
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
    boolean success=false;
    for (int j=0; j < 6; j++) {
      int count=0;
      for (      Set<String> val : _factory._results.values()) {
        count+=val.size();
      }
      success=count == _PARTITIONS * 3 / 5 * (i + 1);
      if (success) {
        break;
      }
      Thread.sleep(500);
    }
    Assert.assertTrue(success);
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg2() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg2");
  MockAsyncCallback callback=new MockAsyncCallback();
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  for (int i=0; i < 10; i++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
  int messageResultCount=0;
  for (  String key : statusUpdate.getMapFields().keySet()) {
    if (key.startsWith("MessageResult ")) {
      messageResultCount++;
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    Thread.sleep(1000);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
        Assert.assertTrue(statusUpdate.getMapField(key).size() > 1);
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  String controllerStatusPath=HelixUtil.getControllerPropertyPath(manager.getClusterName(),PropertyType.STATUSUPDATES_CONTROLLER);
  List<String> subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
  }
  String instanceStatusPath=HelixUtil.getInstancePropertyPath(manager.getClusterName(),"localhost_" + (START_PORT),PropertyType.STATUSUPDATES);
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() > 0);
    }
  }
  Thread.sleep(3000);
  ZKPathDataDumpTask dumpTask=new ZKPathDataDumpTask(manager,0L,0L,Integer.MAX_VALUE);
  dumpTask.run();
  subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() == 0);
  }
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() == 0);
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg4() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msgTemplate=new Message(_factory.getMessageType(),"Template");
  msgTemplate.setTgtSessionId("*");
  msgTemplate.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("TestDB");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msgTemplate.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg4");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgIdPrime=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      return count(_factory) == 60;
    }
  }
,10 * 1000);
  Assert.assertTrue(success,"If not specifying participant, controller will send 60 messages");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  ArrayList<String> msgIds=new ArrayList<String>();
  for (int i=0; i < NODE_NR; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    Thread.sleep(5000);
    System.err.println("count: " + count(_factory));
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    msgIds.add(msgId);
  }
  for (int i=0; i < NODE_NR; i++) {
    String msgId=msgIds.get(i);
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    if (messageResultCount != _PARTITIONS * 3 / 5) {
      int x=10;
      x=x + messageResultCount;
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
  }
  for (int j=0; j < 100; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgIdPrime);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3 * 2);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerZeroMsg() throws Exception {
  TestMessagingHandlerFactory factory=new TestMessagingHandlerFactory();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_DOESNOTEXIST");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  PropertyKey controllerMessageKey=keyBuilder.controllerMessage(schedulerMessage.getMsgId());
  helixDataAccessor.setProperty(controllerMessageKey,schedulerMessage);
  Thread.sleep(3000);
  Assert.assertEquals(0,factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  for (int i=0; i < 10; i++) {
    StatusUpdate update=helixDataAccessor.getProperty(controllerTaskStatus);
    if (update == null || update.getRecord().getMapField("SentMessageCount") == null) {
      Thread.sleep(1000);
    }
  }
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("0"));
  int count=0;
  for (  Set<String> val : factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSchemataSM </h4><pre class="type-4 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSchemataSM() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  MockParticipant[] participants=new MockParticipant[n];
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestSchemata",1,1,n,0,"STORAGE_DEFAULT_SM_SCHEMATA",false);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  PropertyKey key=keyBuilder.idealStates("TestSchemata0");
  IdealState idealState=accessor.getProperty(key);
  idealState.setReplicas(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString());
  idealState.getRecord().setListField("TestSchemata0_0",Arrays.asList(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString()));
  accessor.setProperty(key,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  for (int i=1; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  participants[0]=new MockParticipant(_zkaddr,clusterName,"localhost_12918");
  participants[0].syncStart();
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  key=keyBuilder.externalView("TestSchemata0");
  ExternalView externalView=accessor.getProperty(key);
  Map<String,String> stateMap=externalView.getStateMap("TestSchemata0_0");
  Assert.assertNotNull(stateMap);
  Assert.assertEquals(stateMap.size(),n,"all " + n + " participants should be in Master state");
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    Assert.assertNotNull(stateMap.get(instanceName));
    Assert.assertEquals(stateMap.get(instanceName),"MASTER");
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSessionExpiryInTransition </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testSessionExpiryInTransition() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[5];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].setTransition(new SessionExpiryTransition(participants[i]));
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSharedConnection </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that the external view is able to update properly when participants share a connection.
 */
@Test public void testSharedParticipantConnection() throws Exception {
  final int NUM_PARTICIPANTS=2;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  final String RESOURCE_NAME="TestDB0";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"OnlineOffline",RebalanceMode.CUSTOMIZED,true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  HelixParticipant[] participants=new HelixParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    participants[i]=connection.createParticipant(ClusterId.from(clusterName),ParticipantId.from("localhost_" + (12918 + i)));
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("OnlineOffline"),new TestHelixConnection.MockStateModelFactory());
    participants[i].start();
  }
  HelixController controller=connection.createController(ClusterId.from(clusterName),ControllerId.from("controller"));
  controller.start();
  Thread.sleep(500);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  HelixAdmin admin=connection.createClusterManagementTool();
  IdealState idealState=admin.getResourceIdealState(clusterName,RESOURCE_NAME);
  Map<ParticipantId,State> participantStateMap=idealState.getParticipantStateMap(PartitionId.from(RESOURCE_NAME + "_0"));
  participantStateMap.remove(ParticipantId.from("localhost_12918"));
  idealState.setParticipantStateMap(PartitionId.from(RESOURCE_NAME + "_0"),participantStateMap);
  admin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  Thread.sleep(1000);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  participantStateMap=idealState.getParticipantStateMap(PartitionId.from(RESOURCE_NAME + "_1"));
  participantStateMap.remove(ParticipantId.from("localhost_12919"));
  idealState.setParticipantStateMap(PartitionId.from(RESOURCE_NAME + "_1"),participantStateMap);
  admin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  Thread.sleep(1000);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.stop();
  for (  HelixParticipant participant : participants) {
    participant.stop();
  }
  admin.dropCluster(clusterName);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestStandAloneCMMain </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testStandAloneCMMain() throws Exception {
  logger.info("RUN testStandAloneCMMain() at " + new Date(System.currentTimeMillis()));
  MockController newController=null;
  for (int i=1; i <= 2; i++) {
    String controllerName="controller_" + i;
    newController=new MockController(_zkaddr,CLUSTER_NAME,controllerName);
    newController.syncStart();
  }
  _controller.syncStop();
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(CLUSTER_NAME,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  final String newControllerName=newController.getInstanceName();
  TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      if (leader == null) {
        return false;
      }
      return leader.getInstanceName().equals(newControllerName);
    }
  }
,30 * 1000);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  logger.info("STOP testStandAloneCMMain() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestStandAloneCMSessionExpiry </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testStandAloneCMSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,20,5,3,"MasterSlave",true);
  MockParticipant[] participants=new MockParticipant[5];
  for (int i=0; i < 5; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  boolean result;
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  MockParticipant participantToExpire=participants[1];
  System.out.println("Expire participant session");
  String oldSessionId=participantToExpire.getSessionId();
  ZkTestHelper.expireSession(participantToExpire.getZkClient());
  String newSessionId=participantToExpire.getSessionId();
  System.out.println("oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  Assert.assertTrue(newSessionId.compareTo(oldSessionId) > 0,"Session id should be increased after expiry");
  _setupTool.addResourceToCluster(clusterName,"TestDB1",10,"MasterSlave");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB1",3);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  System.out.println("Expire controller session");
  oldSessionId=controller.getSessionId();
  ZkTestHelper.expireSession(controller.getZkClient());
  newSessionId=controller.getSessionId();
  System.out.println("oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  Assert.assertTrue(newSessionId.compareTo(oldSessionId) > 0,"Session id should be increased after expiry");
  _setupTool.addResourceToCluster(clusterName,"TestDB2",8,"MasterSlave");
  _setupTool.rebalanceStorageCluster(clusterName,"TestDB2",3);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  System.out.println("Clean up ...");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestStateTransitionTimeout </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStateTransitionTimeOut() throws Exception {
  Map<String,SleepStateModelFactory> factories=new HashMap<String,SleepStateModelFactory>();
  IdealState idealState=_setupTool.getClusterManagementTool().getResourceIdealState(CLUSTER_NAME,TEST_DB);
  for (int i=0; i < NODE_NR; i++) {
    String instanceName="localhost_" + (START_PORT + i);
    SleepStateModelFactory factory=new SleepStateModelFactory(1000);
    factories.put(instanceName,factory);
    for (    PartitionId p : idealState.getPartitionIdSet()) {
      if (idealState.getPreferenceList(p).get(0).equals(ParticipantId.from(instanceName))) {
        factory.addPartition(p);
      }
    }
    _participants[i]=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName);
    _participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("MasterSlave"),factory);
    _participants[i].syncStart();
  }
  String controllerName="controller_0";
  _controller=new MockController(_zkaddr,CLUSTER_NAME,controllerName);
  _controller.syncStart();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=_participants[0].getHelixDataAccessor();
  Builder kb=accessor.keyBuilder();
  ExternalView ev=accessor.getProperty(kb.externalView(TEST_DB));
  for (  PartitionId p : idealState.getPartitionIdSet()) {
    ParticipantId idealMaster=idealState.getPreferenceList(p).get(0);
    Assert.assertTrue(ev.getStateMap(p).get(idealMaster).equals(State.from("ERROR")));
    TimeOutStateModel model=factories.get(idealMaster.stringify()).getTransitionHandler(ResourceId.from(TEST_DB),p);
    Assert.assertEquals(model._errorCallcount,1);
    Assert.assertEquals(model._error.getCode(),ErrorCode.TIMEOUT);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSwapInstance </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestSwap() throws Exception {
  HelixManager manager=_controller;
  HelixDataAccessor helixAccessor=manager.getHelixDataAccessor();
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB",_replica);
  ZNRecord idealStateOld1=new ZNRecord("TestDB");
  ZNRecord idealStateOld2=new ZNRecord("MyDB");
  IdealState is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  idealStateOld1.merge(is1.getRecord());
  IdealState is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  idealStateOld2.merge(is2.getRecord());
  String instanceName="localhost_" + (START_PORT + 0);
  _setupTool.getClusterManagementTool().enableInstance(CLUSTER_NAME,instanceName,false);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  String instanceName2="localhost_" + (START_PORT + 444);
  _setupTool.addInstanceToCluster(CLUSTER_NAME,instanceName2);
  boolean exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    exception=true;
  }
  Assert.assertTrue(exception);
  _participants[0].syncStop();
  Thread.sleep(1000);
  exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    e.printStackTrace();
    exception=true;
  }
  Assert.assertFalse(exception);
  MockParticipant newParticipant=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName2);
  newParticipant.syncStart();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  for (  String key : idealStateOld1.getMapFields().keySet()) {
    for (    String host : idealStateOld1.getMapField(key).keySet()) {
      if (host.equals(instanceName)) {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(instanceName).equals(is1.getRecord().getMapField(key).get(instanceName2)));
      }
 else {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(host).equals(is1.getRecord().getMapField(key).get(host)));
      }
    }
  }
  for (  String key : idealStateOld1.getListFields().keySet()) {
    Assert.assertEquals(idealStateOld1.getListField(key).size(),is1.getRecord().getListField(key).size());
    for (int i=0; i < idealStateOld1.getListField(key).size(); i++) {
      String host=idealStateOld1.getListField(key).get(i);
      String newHost=is1.getRecord().getListField(key).get(i);
      if (host.equals(instanceName)) {
        Assert.assertTrue(newHost.equals(instanceName2));
      }
 else {
        Assert.assertTrue(host.equals(newHost));
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestUserDefRebalancerCompatibility </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomizedIdealStateRebalancer() throws InterruptedException {
  _setupTool.addResourceToCluster(CLUSTER_NAME,db2,60,"MasterSlave");
  _setupTool.addResourceProperty(CLUSTER_NAME,db2,IdealStateProperty.REBALANCER_CLASS_NAME.toString(),TestUserDefRebalancerCompatibility.TestRebalancer.class.getName());
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,db2,3);
  try {
    boolean result=ClusterStateVerifier.verifyByZkCallback(new TestCustomizedIdealStateRebalancer.ExternalViewBalancedVerifier(_zkclient,CLUSTER_NAME,db2));
    Assert.assertTrue(result);
    Thread.sleep(1000);
    HelixDataAccessor accessor=new ZKHelixDataAccessor(CLUSTER_NAME,_baseAccessor);
    Builder keyBuilder=accessor.keyBuilder();
    ExternalView ev=accessor.getProperty(keyBuilder.externalView(db2));
    Assert.assertEquals(ev.getPartitionSet().size(),60);
    for (    String partition : ev.getPartitionSet()) {
      Assert.assertEquals(ev.getStateMap(partition).size(),1);
    }
    IdealState is=accessor.getProperty(keyBuilder.idealStates(db2));
    for (    PartitionId partition : is.getPartitionIdSet()) {
      Assert.assertEquals(is.getPreferenceList(partition).size(),3);
      Assert.assertEquals(is.getParticipantStateMap(partition).size(),3);
    }
    Assert.assertTrue(testRebalancerCreated);
    Assert.assertTrue(testRebalancerInvoked);
  }
  finally {
    _setupTool.dropResourceFromCluster(CLUSTER_NAME,db2);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestZkCallbackHandlerLeak </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCbHandlerLeakOnControllerSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  final MockParticipant participantManager=participants[0];
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      int controllerHandlerNb=controller.getHandlers().size();
      int particHandlerNb=participantManager.getHandlers().size();
      if (controllerHandlerNb == 10 && particHandlerNb == 2)       return true;
 else       return false;
    }
  }
,1000);
  int controllerHandlerNb=controller.getHandlers().size();
  int particHandlerNb=participantManager.getHandlers().size();
  TestHelper.printHandlers(controller,controller.getHandlers());
  Assert.assertEquals(controllerHandlerNb,12,"HelixController should have 12 (6+2n) callback handlers for 2 participant, but was " + controllerHandlerNb);
  TestHelper.printHandlers(participantManager,participantManager.getHandlers());
  Assert.assertEquals(particHandlerNb,1,"HelixParticipant should have 1 (msg->HelixTaskExecutor) callback handler, but was " + particHandlerNb);
  System.out.println("Expiring controller session...");
  String oldSessionId=controller.getSessionId();
  ZkTestHelper.expireSession(controller.getZkClient());
  String newSessionId=controller.getSessionId();
  System.out.println("Expired controller session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers after session expiry.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManager.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher after session expiry.");
  int handlerNb=controller.getHandlers().size();
  TestHelper.printHandlers(controller,controller.getHandlers());
  Assert.assertTrue(handlerNb <= controllerHandlerNb,"controller callback handlers should not increase after participant session expiry (expected no more than " + controllerHandlerNb + ", found "+ handlerNb+ ")");
  handlerNb=participantManager.getHandlers().size();
  TestHelper.printHandlers(participantManager,participantManager.getHandlers());
  Assert.assertEquals(handlerNb,particHandlerNb,"participant callback handlers should not increase after participant session expiry");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCbHandlerLeakOnParticipantSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  final MockParticipant participantManagerToExpire=participants[1];
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManagerToExpire.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher. MESSAGES->HelixTaskExecutor");
  TestHelper.printHandlers(controller,controller.getHandlers());
  TestHelper.printHandlers(participantManagerToExpire,participantManagerToExpire.getHandlers());
  int controllerHandlerNb=controller.getHandlers().size();
  int particHandlerNb=participantManagerToExpire.getHandlers().size();
  Assert.assertEquals(controllerHandlerNb,12,"HelixController should have 10 (8+2n) callback handlers for 2 (n) participant");
  Assert.assertEquals(particHandlerNb,1,"HelixParticipant should have 1 (msg->HelixTaskExecutor) callback handlers");
  System.out.println("Expiring participant session...");
  String oldSessionId=participantManagerToExpire.getSessionId();
  ZkTestHelper.expireSession(participantManagerToExpire.getZkClient());
  String newSessionId=participantManagerToExpire.getSessionId();
  System.out.println("Expried participant session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + controller.getSessionId());
      return watchPaths.size() == (8 + 5 * n);
    }
  }
,500);
  Assert.assertTrue(result,"Controller should have 8 + 5*n zk-watchers after session expiry.");
  result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      Map<String,Set<String>> watchers=ZkTestHelper.getListenersBySession(_zkaddr);
      Set<String> watchPaths=watchers.get("0x" + participantManagerToExpire.getSessionId());
      return watchPaths.size() == 1;
    }
  }
,500);
  Assert.assertTrue(result,"Participant should have 1 zk-watcher after session expiry.");
  int handlerNb=controller.getHandlers().size();
  Assert.assertEquals(handlerNb,controllerHandlerNb,"controller callback handlers should not increase after participant session expiry");
  handlerNb=participantManagerToExpire.getHandlers().size();
  Assert.assertEquals(handlerNb,particHandlerNb,"participant callback handlers should not increase after participant session expiry");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRemoveUserCbHandlerOnPathRemoval() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=3;
  final String zkAddr=_zkaddr;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,zkAddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(zkAddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(zkAddr,clusterName,instanceName);
    participants[i].syncStart();
    if (i == 0) {
      MockParticipant manager=participants[0];
      manager.addCurrentStateChangeListener(new CurrentStateChangeListener(){
        @Override public void onStateChange(        String instanceName,        List<CurrentState> statesInfo,        NotificationContext changeContext){
        }
      }
,manager.getInstanceName(),manager.getSessionId());
    }
  }
  Boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(zkAddr,clusterName));
  Assert.assertTrue(result);
  MockParticipant participantToExpire=participants[0];
  String oldSessionId=participantToExpire.getSessionId();
  PropertyKey.Builder keyBuilder=new PropertyKey.Builder(clusterName);
  Assert.assertEquals(participantToExpire.getHandlers().size(),2,"Should have 2 handlers: CURRENTSTATE/{sessionId}, and MESSAGES");
  Map<String,Set<IZkDataListener>> dataListeners=ZkTestHelper.getZkDataListener(participantToExpire.getZkClient());
  Map<String,Set<IZkChildListener>> childListeners=ZkTestHelper.getZkChildListener(participantToExpire.getZkClient());
  Assert.assertEquals(dataListeners.size(),1,"Should have 1 path (CURRENTSTATE/{sessionId}/TestDB0) which has 1 data-listeners");
  String path=keyBuilder.currentState(participantToExpire.getInstanceName(),oldSessionId,"TestDB0").getPath();
  Assert.assertEquals(dataListeners.get(path).size(),1,"Should have 1 data-listeners on path: " + path);
  Assert.assertEquals(childListeners.size(),2,"Should have 2 paths (CURRENTSTATE/{sessionId}, and MESSAGES) each of which has 1 child-listener");
  path=keyBuilder.currentStates(participantToExpire.getInstanceName(),oldSessionId).getPath();
  Assert.assertEquals(childListeners.get(path).size(),1,"Should have 1 child-listener on path: " + path);
  path=keyBuilder.messages(participantToExpire.getInstanceName()).getPath();
  Assert.assertEquals(childListeners.get(path).size(),1,"Should have 1 child-listener on path: " + path);
  path=keyBuilder.controller().getPath();
  Assert.assertNull(childListeners.get(path),"Should have no child-listener on path: " + path);
  Map<String,List<String>> watchPaths=ZkTestHelper.getZkWatch(participantToExpire.getZkClient());
  Assert.assertEquals(watchPaths.get("dataWatches").size(),3,"Should have 3 data-watches: CURRENTSTATE/{sessionId}, CURRENTSTATE/{sessionId}/TestDB, MESSAGES");
  Assert.assertEquals(watchPaths.get("childWatches").size(),2,"Should have 2 child-watches: MESSAGES, and CURRENTSTATE/{sessionId}");
  System.out.println("Expire participant: " + participantToExpire.getInstanceName() + ", session: "+ participantToExpire.getSessionId());
  ZkTestHelper.expireSession(participantToExpire.getZkClient());
  String newSessionId=participantToExpire.getSessionId();
  System.out.println(participantToExpire.getInstanceName() + " oldSessionId: " + oldSessionId+ ", newSessionId: "+ newSessionId);
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(zkAddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertEquals(participantToExpire.getHandlers().size(),1,"Should have 1 handlers: MESSAGES. CURRENTSTATE/{sessionId} handler should be removed by CallbackHandler#handleChildChange()");
  dataListeners=ZkTestHelper.getZkDataListener(participantToExpire.getZkClient());
  childListeners=ZkTestHelper.getZkChildListener(participantToExpire.getZkClient());
  Assert.assertTrue(dataListeners.isEmpty(),"Should have no data-listeners");
  Assert.assertEquals(childListeners.size(),2,"Should have 2 paths (CURRENTSTATE/{oldSessionId}, and MESSAGES). " + "CONTROLLER and MESSAGE has 1 child-listener each. CURRENTSTATE/{oldSessionId} doesn't have listener (ZkClient doesn't remove empty childListener set. probably a ZkClient bug. see ZkClient#unsubscribeChildChange())");
  path=keyBuilder.currentStates(participantToExpire.getInstanceName(),oldSessionId).getPath();
  Assert.assertEquals(childListeners.get(path).size(),0,"Should have no child-listener on path: " + path);
  path=keyBuilder.messages(participantToExpire.getInstanceName()).getPath();
  Assert.assertEquals(childListeners.get(path).size(),1,"Should have 1 child-listener on path: " + path);
  path=keyBuilder.controller().getPath();
  Assert.assertNull(childListeners.get(path),"Should have no child-listener on path: " + path);
  watchPaths=ZkTestHelper.getZkWatch(participantToExpire.getZkClient());
  Assert.assertEquals(watchPaths.get("dataWatches").size(),1,"Should have 1 data-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("childWatches").size(),1,"Should have 1 child-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("existWatches").size(),2,"Should have 2 exist-watches: CURRENTSTATE/{oldSessionId} and CURRENTSTATE/{oldSessionId}/TestDB0");
  System.out.println("Expire participant: " + participantToExpire.getInstanceName() + ", session: "+ participantToExpire.getSessionId());
  ZkTestHelper.expireSession(participantToExpire.getZkClient());
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(zkAddr,clusterName));
  Assert.assertTrue(result);
  watchPaths=ZkTestHelper.getZkWatch(participantToExpire.getZkClient());
  Assert.assertEquals(watchPaths.get("dataWatches").size(),1,"Should have 1 data-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("childWatches").size(),1,"Should have 1 child-watches: MESSAGES");
  Assert.assertEquals(watchPaths.get("existWatches").size(),0,"Should have no exist-watches. exist-watches on CURRENTSTATE/{oldSessionId} and CURRENTSTATE/{oldSessionId}/TestDB0 should be cleared during handleNewSession");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestZkReconnect </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testZKReconnect() throws Exception {
  final AtomicReference<ZkServer> zkServerRef=new AtomicReference<ZkServer>();
  final int zkPort=ZkTestUtil.availableTcpPort();
  final String zkAddr=String.format("localhost:%d",zkPort);
  ZkServer zkServer=TestHelper.startZkServer(zkAddr);
  zkServerRef.set(zkServer);
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  LOG.info("Setup clusters");
  ClusterSetup clusterSetup=new ClusterSetup(zkAddr);
  clusterSetup.addCluster(clusterName,true);
  LOG.info("Starts controller");
  HelixManager controller=HelixManagerFactory.getZKHelixManager(clusterName,null,InstanceType.CONTROLLER,zkAddr);
  controller.connect();
  LOG.info("Starts participant");
  String hostname="localhost";
  String instanceId=String.format("%s_%d",hostname,1);
  clusterSetup.addInstanceToCluster(clusterName,instanceId);
  HelixManager participant=HelixManagerFactory.getZKHelixManager(clusterName,instanceId,InstanceType.PARTICIPANT,zkAddr);
  participant.connect();
  LOG.info("Register state machine");
  final CountDownLatch latch=new CountDownLatch(1);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.OnlineOffline,"test",new StateTransitionHandlerFactory<TransitionHandler>(){
    @Override public TransitionHandler createStateTransitionHandler(    ResourceId resource,    PartitionId stateUnitKey){
      return new SimpleStateModel(latch);
    }
  }
);
  String resourceName="test-resource";
  LOG.info("Ideal state assignment");
  HelixAdmin helixAdmin=participant.getClusterManagmentTool();
  helixAdmin.addResource(clusterName,resourceName,1,"OnlineOffline",IdealState.RebalanceMode.CUSTOMIZED.toString());
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,resourceName);
  idealState.setReplicas("1");
  idealState.setStateModelFactoryId(StateModelFactoryId.from("test"));
  idealState.setPartitionState(PartitionId.from(ResourceId.from(resourceName),"0"),ParticipantId.from(instanceId),State.from("ONLINE"));
  LOG.info("Shutdown ZK server");
  TestHelper.stopZkServer(zkServerRef.get());
  Executors.newSingleThreadScheduledExecutor().schedule(new Runnable(){
    @Override public void run(){
      try {
        LOG.info("Restart ZK server");
        zkServerRef.set(TestHelper.startZkServer(zkAddr,null,false));
      }
 catch (      Exception e) {
        LOG.error(e.getMessage(),e);
      }
    }
  }
,2L,TimeUnit.SECONDS);
  LOG.info("Before update ideal state");
  helixAdmin.setResourceIdealState(clusterName,resourceName,idealState);
  LOG.info("After update ideal state");
  LOG.info("Wait for OFFLINE->ONLINE state transition");
  try {
    Assert.assertTrue(latch.await(10,TimeUnit.SECONDS));
    boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(zkAddr,clusterName));
    Assert.assertTrue(result);
  }
  finally {
    participant.disconnect();
    zkServerRef.get().shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestZkSessionExpiry </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testMsgHdlrFtyReRegistration() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Set<String> handledMsgSet=new HashSet<String>();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].getMessagingService().registerMessageHandlerFactory(DUMMY_MSG_TYPE,new DummyMessageHandlerFactory(handledMsgSet));
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  checkDummyMsgHandler(participants[0],handledMsgSet);
  ZkTestHelper.expireSession(participants[0].getZkClient());
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  checkDummyMsgHandler(participants[0],handledMsgSet);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestConsecutiveZkSessionExpiry </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiClusterController() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  MockMultiClusterController[] multiClusterControllers=new MockMultiClusterController[n];
  CountDownLatch startCountdown=new CountDownLatch(1);
  CountDownLatch endCountdown=new CountDownLatch(1);
  for (int i=0; i < n; i++) {
    String contrllerName="localhost_" + (12918 + i);
    multiClusterControllers[i]=new MockMultiClusterController(_zkaddr,clusterName,contrllerName);
    multiClusterControllers[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
    if (i == 0) {
      multiClusterControllers[i].addPreConnectCallback(new PreConnectTestCallback(contrllerName,startCountdown,endCountdown));
    }
    multiClusterControllers[i].connect();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  LOG.info("1st Expiring multiClusterController session...");
  String oldSessionId=multiClusterControllers[0].getSessionId();
  ZkTestHelper.asyncExpireSession(multiClusterControllers[0].getZkClient());
  String newSessionId=multiClusterControllers[0].getSessionId();
  LOG.info("Expried multiClusterController session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  startCountdown.await();
  LOG.info("2nd Expiring multiClusterController session...");
  oldSessionId=multiClusterControllers[0].getSessionId();
  ZkTestHelper.asyncExpireSession(multiClusterControllers[0].getZkClient());
  newSessionId=multiClusterControllers[0].getSessionId();
  LOG.info("Expried multiClusterController session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  endCountdown.countDown();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNotNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12918"),true));
  LiveInstance leader=HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.controllerLeader(),true);
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getId(),"localhost_12919");
  TestHelper.printHandlers(multiClusterControllers[0],multiClusterControllers[0].getHandlers());
  List<ZkCallbackHandler> handlers=multiClusterControllers[0].getHandlers();
  Assert.assertEquals(handlers.size(),2,"MultiCluster controller should have 2 handler (message and leader election) after lose leadership, but was " + handlers.size());
  multiClusterControllers[0].disconnect();
  multiClusterControllers[1].disconnect();
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12918"),false));
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.liveInstance("localhost_12919"),false));
  Assert.assertNull(HelixTestUtil.pollForProperty(LiveInstance.class,accessor,keyBuilder.controllerLeader(),false));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testParticipant() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  final MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  CountDownLatch startCountdown=new CountDownLatch(1);
  CountDownLatch endCountdown=new CountDownLatch(1);
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    if (i == 0) {
      participants[i].addPreConnectCallback(new PreConnectTestCallback(instanceName,startCountdown,endCountdown));
    }
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  LOG.info("1st Expiring participant session...");
  String oldSessionId=participants[0].getSessionId();
  ZkTestHelper.asyncExpireSession(participants[0].getZkClient());
  String newSessionId=participants[0].getSessionId();
  LOG.info("Expried participant session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  startCountdown.await();
  LOG.info("2nd Expiring participant session...");
  oldSessionId=participants[0].getSessionId();
  ZkTestHelper.asyncExpireSession(participants[0].getZkClient());
  newSessionId=participants[0].getSessionId();
  LOG.info("Expried participant session. oldSessionId: " + oldSessionId + ", newSessionId: "+ newSessionId);
  endCountdown.countDown();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestControllerManager </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleControllersOfSameName() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,16,n,3,"MasterSlave",true);
  int m=3;
  MockController[] controllers=new MockController[m];
  for (int i=0; i < m; i++) {
    controllers[i]=new MockController(_zkaddr,clusterName,"controller");
    controllers[i].syncStart();
  }
  int leaderCnt=0;
  for (int i=0; i < m; i++) {
    if (controllers[i].isLeader()) {
      leaderCnt++;
    }
  }
  Assert.assertEquals(leaderCnt,1,"Should have only 1 leader but was " + leaderCnt);
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (int i=0; i < m; i++) {
    controllers[i].syncStop();
  }
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void simpleSessionExpiryTest() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,16,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String oldSessionId=controller.getSessionId();
  ZkTestHelper.expireSession(controller.getZkClient());
  TimeUnit.MILLISECONDS.sleep(100);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String newSessionId=controller.getSessionId();
  Assert.assertNotSame(newSessionId,oldSessionId);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestHelixMultiClusterController </h4><pre class="type-4 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void simpleSessionExpiryTest() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  MockMultiClusterController[] multiClusterControllers=new MockMultiClusterController[n];
  for (int i=0; i < n; i++) {
    String contrllerName="localhost_" + (12918 + i);
    multiClusterControllers[i]=new MockMultiClusterController(_zkaddr,clusterName,contrllerName);
    multiClusterControllers[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
    multiClusterControllers[i].connect();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  expireController(multiClusterControllers[0],multiClusterControllers[1]);
  expireController(multiClusterControllers[1],multiClusterControllers[0]);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    multiClusterControllers[i].disconnect();
    Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(multiClusterControllers[i].getInstanceName())));
  }
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void simpleIntegrationTest() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  HelixManager[] multiClusterControllers=new HelixManager[n];
  for (int i=0; i < n; i++) {
    int port=12918 + i;
    multiClusterControllers[i]=new ZKHelixManager(clusterName,"localhost_" + port,InstanceType.CONTROLLER_PARTICIPANT,_zkaddr);
    multiClusterControllers[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
    multiClusterControllers[i].connect();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  multiClusterControllers[0].disconnect();
  Thread.sleep(100);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance("localhost_12918")));
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getId(),"localhost_12919");
  multiClusterControllers[1].disconnect();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance("localhost_12919")));
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestParticipantManager </h4><pre class="type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void simpleIntegrationTest() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=1;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,1,"MasterSlave",true);
  HelixManager participant=new ZKHelixManager(clusterName,"localhost_12918",InstanceType.PARTICIPANT,_zkaddr);
  participant.getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
  participant.connect();
  HelixManager controller=new ZKHelixManager(clusterName,"controller_0",InstanceType.CONTROLLER,_zkaddr);
  controller.connect();
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  controller.disconnect();
  participant.disconnect();
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance("localhost_12918")));
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-11 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSessionExpiryInTransition() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  int n=1;
  CountDownLatch startCountdown=new CountDownLatch(1);
  CountDownLatch endCountdown=new CountDownLatch(1);
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,1,n,1,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].setTransition(new SessionExpiryTransition(startCountdown,endCountdown));
    participants[i].syncStart();
  }
  startCountdown.await();
  String oldSessionId=participants[0].getSessionId();
  System.out.println("oldSessionId: " + oldSessionId);
  ZkTestHelper.expireSession(participants[0].getZkClient());
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String newSessionId=participants[0].getSessionId();
  Assert.assertNotSame(newSessionId,oldSessionId);
  String errPath=PropertyPathConfig.getPath(PropertyType.ERRORS,clusterName,"localhost_12918",oldSessionId,"TestDB0","TestDB0_0");
  ZNRecord error=_zkclient.readData(errPath);
  Assert.assertNotNull(error,"InterruptedException should happen in old session since task is being cancelled during handleNewSession");
  String errString=new String(new ZNRecordSerializer().serialize(error));
  Assert.assertTrue(errString.indexOf("InterruptedException") != -1);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void simpleSessionExpiryTest() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  int n=1;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,1,n,1,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String oldSessionId=participants[0].getSessionId();
  ZkTestHelper.expireSession(participants[0].getZkClient());
  TimeUnit.MILLISECONDS.sleep(100);
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  String newSessionId=participants[0].getSessionId();
  Assert.assertNotSame(newSessionId,oldSessionId);
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestStateModelLeak </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * test drop resource in error state should remove all state-models
 * @throws Exception
 */
@Test public void testDropErrorPartition() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    if (i == 0) {
      Map<String,Set<String>> errTransitionMap=new HashMap<String,Set<String>>();
      Set<String> partitions=new HashSet<String>();
      partitions.add("TestDB0_0");
      errTransitionMap.put("OFFLINE-SLAVE",partitions);
      participants[0].setTransition(new ErrTransition(errTransitionMap));
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStates=new HashMap<String,Map<String,String>>();
  errStates.put("TestDB0",new HashMap<String,String>());
  errStates.get("TestDB0").put("TestDB0_0","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStates));
  Assert.assertTrue(result);
  HelixStateMachineEngine stateMachine=(HelixStateMachineEngine)participants[0].getStateMachineEngine();
  StateTransitionHandlerFactory<? extends TransitionHandler> fty=stateMachine.getStateModelFactory(StateModelDefId.from("MasterSlave"));
  Map<PartitionId,String> expectStateModelMap=new TreeMap<PartitionId,String>();
  expectStateModelMap.put(PartitionId.from("TestDB0_0"),"ERROR");
  expectStateModelMap.put(PartitionId.from("TestDB0_1"),"MASTER");
  expectStateModelMap.put(PartitionId.from("TestDB0_2"),"SLAVE");
  expectStateModelMap.put(PartitionId.from("TestDB0_3"),"MASTER");
  checkStateModelMap(fty,expectStateModelMap);
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.dropResource(clusterName,"TestDB0");
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (  ResourceId resource : fty.getResourceSet()) {
    Assert.assertTrue(fty.getPartitionSet(resource).isEmpty(),"All state-models should be dropped, but was " + fty.getPartitionSet(resource));
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * test drop resource should remove all state models
 * @throws Exception
 */
@Test public void testDrop() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  HelixStateMachineEngine stateMachine=(HelixStateMachineEngine)participants[0].getStateMachineEngine();
  StateTransitionHandlerFactory<? extends TransitionHandler> fty=stateMachine.getStateModelFactory(StateModelDefId.from("MasterSlave"));
  Map<PartitionId,String> expectStateModelMap=new TreeMap<PartitionId,String>();
  expectStateModelMap.put(PartitionId.from("TestDB0_0"),"SLAVE");
  expectStateModelMap.put(PartitionId.from("TestDB0_1"),"MASTER");
  expectStateModelMap.put(PartitionId.from("TestDB0_2"),"SLAVE");
  expectStateModelMap.put(PartitionId.from("TestDB0_3"),"MASTER");
  checkStateModelMap(fty,expectStateModelMap);
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.dropResource(clusterName,"TestDB0");
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (  ResourceId resource : fty.getResourceSet()) {
    Assert.assertTrue(fty.getPartitionSet(resource).isEmpty(),"All state-models should be dropped, but was " + fty.getPartitionSet(resource));
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestIndependentTaskRebalancer </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReassignment() throws Exception {
  final int NUM_INSTANCES=2;
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(2);
  Map<String,String> taskConfigMap=Maps.newHashMap(ImmutableMap.of("fail","" + true,"failInstance","localhost_" + START_PORT));
  TaskConfig taskConfig1=new TaskConfig("TaskOne",taskConfigMap,false);
  taskConfigs.add(taskConfig1);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  workflowBuilder.addConfig(jobName,JobConfig.MAX_FORCED_REASSIGNMENTS_PER_TASK,"" + (NUM_INSTANCES - 1));
  Map<String,String> jobConfigMap=Maps.newHashMap();
  jobConfigMap.put("Timeout","1000");
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Assert.assertTrue(_invokedClasses.contains(TaskOne.class.getName()));
  Assert.assertEquals(_runCounts.size(),NUM_INSTANCES);
  Assert.assertTrue(_runCounts.values().contains(JobConfig.DEFAULT_MAX_ATTEMPTS_PER_TASK / NUM_INSTANCES));
  Assert.assertTrue(_runCounts.values().contains(1));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDifferentTasks() throws Exception {
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(2);
  TaskConfig taskConfig1=new TaskConfig("TaskOne",null,true);
  TaskConfig taskConfig2=new TaskConfig("TaskTwo",null,true);
  taskConfigs.add(taskConfig1);
  taskConfigs.add(taskConfig2);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  Map<String,String> jobConfigMap=Maps.newHashMap();
  jobConfigMap.put("Timeout","1000");
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Assert.assertTrue(_invokedClasses.contains(TaskOne.class.getName()));
  Assert.assertTrue(_invokedClasses.contains(TaskTwo.class.getName()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDelayedRetry() throws Exception {
  int delay=3000;
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(1);
  Map<String,String> taskConfigMap=Maps.newHashMap();
  TaskConfig taskConfig1=new TaskConfig("SingleFailTask",taskConfigMap,false);
  taskConfigs.add(taskConfig1);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  workflowBuilder.addConfig(jobName,JobConfig.TASK_RETRY_DELAY,String.valueOf(delay));
  Map<String,String> jobConfigMap=Maps.newHashMap();
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  SingleFailTask.hasFailed=false;
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  JobContext jobCtx=TaskUtil.getJobContext(_manager,jobName + "_" + jobName);
  Assert.assertEquals(jobCtx.getPartitionNumAttempts(0),2);
  Assert.assertTrue(jobCtx.getFinishTime() - jobCtx.getStartTime() >= delay);
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testOptionalTaskFailure() throws Exception {
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(2);
  Map<String,String> taskConfigMap=Maps.newHashMap(ImmutableMap.of("fail","" + true));
  TaskConfig taskConfig1=new TaskConfig("TaskOne",taskConfigMap,true);
  TaskConfig taskConfig2=new TaskConfig("TaskTwo",null,false);
  taskConfigs.add(taskConfig1);
  taskConfigs.add(taskConfig2);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  Map<String,String> jobConfigMap=Maps.newHashMap();
  jobConfigMap.put("Timeout","1000");
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Assert.assertTrue(_invokedClasses.contains(TaskOne.class.getName()));
  Assert.assertTrue(_invokedClasses.contains(TaskTwo.class.getName()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testThresholdFailure() throws Exception {
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(2);
  Map<String,String> taskConfigMap=Maps.newHashMap(ImmutableMap.of("fail","" + true));
  TaskConfig taskConfig1=new TaskConfig("TaskOne",taskConfigMap,false);
  TaskConfig taskConfig2=new TaskConfig("TaskTwo",null,false);
  taskConfigs.add(taskConfig1);
  taskConfigs.add(taskConfig2);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  workflowBuilder.addConfig(jobName,JobConfig.FAILURE_THRESHOLD,"" + 1);
  Map<String,String> jobConfigMap=Maps.newHashMap();
  jobConfigMap.put("Timeout","1000");
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Assert.assertTrue(_invokedClasses.contains(TaskOne.class.getName()));
  Assert.assertTrue(_invokedClasses.contains(TaskTwo.class.getName()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testOneTimeScheduled() throws Exception {
  String jobName=TestHelper.getTestMethodName();
  Workflow.Builder workflowBuilder=new Workflow.Builder(jobName);
  List<TaskConfig> taskConfigs=Lists.newArrayListWithCapacity(1);
  Map<String,String> taskConfigMap=Maps.newHashMap();
  TaskConfig taskConfig1=new TaskConfig("TaskOne",taskConfigMap,false);
  taskConfigs.add(taskConfig1);
  workflowBuilder.addTaskConfigs(jobName,taskConfigs);
  workflowBuilder.addConfig(jobName,JobConfig.COMMAND,"DummyCommand");
  Map<String,String> jobConfigMap=Maps.newHashMap();
  jobConfigMap.put("Timeout","1000");
  workflowBuilder.addJobCommandConfigMap(jobName,jobConfigMap);
  long inFiveSeconds=System.currentTimeMillis() + (5 * 1000);
  workflowBuilder.setScheduleConfig(ScheduleConfig.oneTimeDelayedStart(new Date(inFiveSeconds)));
  _driver.start(workflowBuilder.build());
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Assert.assertTrue(_invokedClasses.contains(TaskOne.class.getName()));
  WorkflowContext workflowCtx=TaskUtil.getWorkflowContext(_manager,jobName);
  long startTime=workflowCtx.getStartTime();
  Assert.assertTrue((startTime + 1000) >= inFiveSeconds);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestTaskRebalancer </h4><pre class="type-7 type-1 type-8 type-11 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpiry() throws Exception {
  String jobName="Expiry";
  long expiry=1000;
  Map<String,String> commandConfig=ImmutableMap.of(TIMEOUT_CONFIG,String.valueOf(100));
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobName,commandConfig).setExpiry(expiry).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.IN_PROGRESS);
  HelixDataAccessor accessor=_manager.getHelixDataAccessor();
  PropertyKey workflowCfgKey=accessor.keyBuilder().resourceConfig(jobName);
  String workflowPropStoreKey=Joiner.on("/").join(TaskConstants.REBALANCER_CONTEXT_ROOT,jobName);
  Assert.assertTrue(_manager.getHelixPropertyStore().exists(workflowPropStoreKey,AccessOption.PERSISTENT));
  Assert.assertNotSame(accessor.getProperty(workflowCfgKey),null);
  TestUtil.pollForWorkflowState(_manager,jobName,TaskState.COMPLETED);
  Thread.sleep(expiry);
  _driver.invokeRebalance();
  Thread.sleep(expiry);
  Assert.assertFalse(_manager.getHelixPropertyStore().exists(workflowPropStoreKey,AccessOption.PERSISTENT));
  Assert.assertEquals(accessor.getProperty(workflowCfgKey),null);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNamedQueue() throws Exception {
  String queueName=TestHelper.getTestMethodName();
  JobQueue queue=new JobQueue.Builder(queueName).build();
  _driver.createQueue(queue);
  Set<String> master=Sets.newHashSet("MASTER");
  Set<String> slave=Sets.newHashSet("SLAVE");
  JobConfig.Builder job1=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(master);
  JobConfig.Builder job2=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(slave);
  _driver.enqueueJob(queueName,"masterJob",job1);
  _driver.enqueueJob(queueName,"slaveJob",job2);
  String namespacedJob1=queueName + "_masterJob";
  String namespacedJob2=queueName + "_slaveJob";
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.COMPLETED);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob2,TaskState.COMPLETED);
  JobContext masterJobContext=TaskUtil.getJobContext(_manager,namespacedJob1);
  JobContext slaveJobContext=TaskUtil.getJobContext(_manager,namespacedJob2);
  long job1Finish=masterJobContext.getFinishTime();
  long job2Start=slaveJobContext.getStartTime();
  Assert.assertTrue(job2Start >= job1Finish);
  _driver.flushQueue(queueName);
  HelixDataAccessor accessor=_manager.getHelixDataAccessor();
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  Assert.assertNull(accessor.getProperty(keyBuilder.idealStates(namespacedJob1)));
  Assert.assertNull(accessor.getProperty(keyBuilder.resourceConfig(namespacedJob1)));
  Assert.assertNull(accessor.getProperty(keyBuilder.idealStates(namespacedJob2)));
  Assert.assertNull(accessor.getProperty(keyBuilder.resourceConfig(namespacedJob2)));
  WorkflowConfig workflowCfg=TaskUtil.getWorkflowCfg(_manager,queueName);
  JobDag dag=workflowCfg.getJobDag();
  Assert.assertFalse(dag.getAllNodes().contains(namespacedJob1));
  Assert.assertFalse(dag.getAllNodes().contains(namespacedJob2));
  Assert.assertFalse(dag.getChildrenToParents().containsKey(namespacedJob1));
  Assert.assertFalse(dag.getChildrenToParents().containsKey(namespacedJob2));
  Assert.assertFalse(dag.getParentsToChildren().containsKey(namespacedJob1));
  Assert.assertFalse(dag.getParentsToChildren().containsKey(namespacedJob2));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestTaskRebalancerStopResume </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void stopAndResumeNamedQueue() throws Exception {
  String queueName=TestHelper.getTestMethodName();
  LOG.info("Starting job-queue: " + queueName);
  JobQueue queue=new JobQueue.Builder(queueName).build();
  _driver.createQueue(queue);
  Set<String> master=Sets.newHashSet("MASTER");
  JobConfig.Builder job1=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(master);
  String job1Name="masterJob";
  LOG.info("Enqueuing job: " + job1Name);
  _driver.enqueueJob(queueName,job1Name,job1);
  Set<String> slave=Sets.newHashSet("SLAVE");
  JobConfig.Builder job2=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(slave);
  String job2Name="slaveJob";
  LOG.info("Enqueuing job: " + job2Name);
  _driver.enqueueJob(queueName,job2Name,job2);
  String namespacedJob1=String.format("%s_%s",queueName,job1Name);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  TimeUnit.MILLISECONDS.sleep(200);
  String namespacedJob2=String.format("%s_%s",queueName,job2Name);
  TestUtil.pollForEmptyJobState(_manager,queueName,job2Name);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob1,TaskState.COMPLETED);
  TestUtil.pollForJobState(_manager,queueName,namespacedJob2,TaskState.COMPLETED);
  JobContext masterJobContext=TaskUtil.getJobContext(_manager,namespacedJob1);
  JobContext slaveJobContext=TaskUtil.getJobContext(_manager,namespacedJob2);
  long job1Finish=masterJobContext.getFinishTime();
  long job2Start=slaveJobContext.getStartTime();
  Assert.assertTrue(job2Start >= job1Finish);
  LOG.info("Flusing job-queue: " + queueName);
  _driver.flushQueue(queueName);
  verifyJobDeleted(queueName,namespacedJob1);
  verifyJobDeleted(queueName,namespacedJob2);
  verifyJobNotInQueue(queueName,namespacedJob1);
  verifyJobNotInQueue(queueName,namespacedJob2);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void stopDeleteAndResumeNamedQueue() throws Exception {
  String queueName=TestHelper.getTestMethodName();
  LOG.info("Starting job-queue: " + queueName);
  JobQueue queue=new JobQueue.Builder(queueName).build();
  _driver.createQueue(queue);
  List<String> currentJobNames=new ArrayList<String>();
  for (int i=0; i <= 4; i++) {
    String targetPartition=(i == 0) ? "MASTER" : "SLAVE";
    JobConfig.Builder job=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(Sets.newHashSet(targetPartition));
    String jobName=targetPartition.toLowerCase() + "Job" + i;
    LOG.info("Enqueuing job: " + jobName);
    _driver.enqueueJob(queueName,jobName,job);
    currentJobNames.add(i,jobName);
  }
  String deletedJob1=currentJobNames.get(0);
  String namedSpaceDeletedJob1=String.format("%s_%s",queueName,deletedJob1);
  TestUtil.pollForJobState(_manager,queueName,namedSpaceDeletedJob1,TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,namedSpaceDeletedJob1,TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  _driver.deleteJob(queueName,deletedJob1);
  verifyJobDeleted(queueName,namedSpaceDeletedJob1);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  TestUtil.pollForJobState(_manager,queueName,String.format("%s_%s",queueName,currentJobNames.get(1)),TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,String.format("%s_%s",queueName,currentJobNames.get(1)),TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  String deletedJob2=currentJobNames.get(2);
  String namedSpaceDeletedJob2=String.format("%s_%s",queueName,deletedJob2);
  TestUtil.pollForEmptyJobState(_manager,queueName,namedSpaceDeletedJob2);
  _driver.deleteJob(queueName,deletedJob2);
  verifyJobDeleted(queueName,namedSpaceDeletedJob2);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  currentJobNames.remove(deletedJob1);
  currentJobNames.remove(deletedJob2);
  long preJobFinish=0;
  for (int i=0; i < currentJobNames.size(); i++) {
    String namedSpaceJobName=String.format("%s_%s",queueName,currentJobNames.get(i));
    TestUtil.pollForJobState(_manager,queueName,namedSpaceJobName,TaskState.COMPLETED);
    JobContext jobContext=TaskUtil.getJobContext(_manager,namedSpaceJobName);
    long jobStart=jobContext.getStartTime();
    Assert.assertTrue(jobStart >= preJobFinish);
    preJobFinish=jobContext.getFinishTime();
  }
  LOG.info("Flusing job-queue: " + queueName);
  _driver.flushQueue(queueName);
  TimeUnit.MILLISECONDS.sleep(200);
  for (int i=0; i < currentJobNames.size(); i++) {
    String namedSpaceJobName=String.format("%s_%s",queueName,currentJobNames.get(i));
    verifyJobDeleted(queueName,namedSpaceJobName);
    verifyJobNotInQueue(queueName,namedSpaceJobName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.lock.zk.TestZKHelixLock </h4><pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void basicTest() throws InterruptedException {
  final long TIMEOUT=30000;
  final long RETRY_INTERVAL=100;
  _zkclient.waitUntilConnected(TIMEOUT,TimeUnit.MILLISECONDS);
  final AtomicBoolean t1Locked=new AtomicBoolean(false);
  final AtomicBoolean t1Done=new AtomicBoolean(false);
  final AtomicInteger field1=new AtomicInteger(0);
  final AtomicInteger field2=new AtomicInteger(1);
  final ClusterId clusterId=ClusterId.from("testCluster");
  final HelixLock lock1=new ZKHelixLock(clusterId,Scope.cluster(clusterId),_zkclient);
  final HelixLock lock2=new ZKHelixLock(clusterId,Scope.cluster(clusterId),_zkclient);
  Thread t1=new Thread(){
    @Override public void run(){
      lock1.lock();
synchronized (t1Locked) {
        t1Locked.set(true);
        t1Locked.notify();
      }
      yield();
      field1.set(1);
      field2.set(1);
synchronized (t1Done) {
        t1Done.set(true);
        t1Done.notify();
      }
    }
  }
;
  Thread t2=new Thread(){
    @Override public void run(){
synchronized (t1Locked) {
        while (!t1Locked.get()) {
          try {
            t1Locked.wait();
          }
 catch (          InterruptedException e) {
          }
        }
      }
      lock2.lock();
      field1.set(2);
      field2.set(2);
    }
  }
;
  t1.setPriority(Thread.MIN_PRIORITY);
  t2.setPriority(Thread.MAX_PRIORITY);
  t1.start();
  t2.start();
synchronized (t1Done) {
    while (!t1Done.get()) {
      try {
        t1Done.wait();
      }
 catch (      InterruptedException e) {
      }
    }
  }
  Assert.assertEquals(field1.get(),1);
  Assert.assertEquals(field2.get(),1);
  long count=0;
  while (!lock2.isBlocked()) {
    if (count > TIMEOUT) {
      break;
    }
    Thread.sleep(RETRY_INTERVAL);
    count+=RETRY_INTERVAL;
  }
  Assert.assertTrue(lock2.isBlocked());
  lock1.unlock();
  try {
    t2.join(10000);
    Assert.assertEquals(field1.get(),2);
    Assert.assertEquals(field2.get(),2);
  }
 catch (  InterruptedException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestDefaultControllerMsgHandlerFactory </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDefaultControllerMsgHandlerFactory(){
  System.out.println("START TestDefaultControllerMsgHandlerFactory at " + new Date(System.currentTimeMillis()));
  DefaultControllerMessageHandlerFactory facotry=new DefaultControllerMessageHandlerFactory();
  Message message=new Message(MessageType.NO_OP,MessageId.from("0"));
  NotificationContext context=new NotificationContext(null);
  boolean exceptionCaught=false;
  try {
    facotry.createHandler(message,context);
  }
 catch (  HelixException e) {
    exceptionCaught=true;
  }
  AssertJUnit.assertTrue(exceptionCaught);
  message=new Message(MessageType.CONTROLLER_MSG,MessageId.from("1"));
  exceptionCaught=false;
  try {
    facotry.createHandler(message,context);
  }
 catch (  HelixException e) {
    exceptionCaught=true;
  }
  AssertJUnit.assertFalse(exceptionCaught);
  message=new Message(MessageType.NO_OP,MessageId.from("3"));
  DefaultControllerMessageHandler defaultHandler=new DefaultControllerMessageHandler(message,context);
  try {
    defaultHandler.handleMessage();
  }
 catch (  HelixException e) {
    exceptionCaught=true;
  }
catch (  InterruptedException e) {
    LOG.error("Interrupted handling message",e);
  }
  AssertJUnit.assertTrue(exceptionCaught);
  message=new Message(MessageType.CONTROLLER_MSG,MessageId.from("4"));
  defaultHandler=new DefaultControllerMessageHandler(message,context);
  exceptionCaught=false;
  try {
    defaultHandler.handleMessage();
  }
 catch (  HelixException e) {
    exceptionCaught=true;
  }
catch (  InterruptedException e) {
    LOG.error("Interrupted handling message",e);
  }
  AssertJUnit.assertFalse(exceptionCaught);
  System.out.println("END TestDefaultControllerMsgHandlerFactory at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestHandleNewSession </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testHandleNewSession() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockParticipant participant=new MockParticipant(_zkaddr,clusterName,"localhost_12918");
  participant.syncStart();
  String lastSessionId=participant.getSessionId();
  for (int i=0; i < 3; i++) {
    ZkTestHelper.expireSession(participant.getZkClient());
    String sessionId=participant.getSessionId();
    Assert.assertTrue(sessionId.compareTo(lastSessionId) > 0,"Session id should be increased after expiry");
    lastSessionId=sessionId;
    Assert.assertFalse(sessionId.equals("0"),"Hit race condition in zhclient.handleNewSession(). sessionId is not returned yet.");
  }
  System.out.println("Disconnecting ...");
  participant.syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestLiveInstanceBounce </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceBounce() throws Exception {
  int handlerSize=_controller.getHandlers().size();
  for (int i=0; i < 2; i++) {
    String instanceName="localhost_" + (START_PORT + i);
    _participants[i].syncStop();
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    _participants[i]=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName);
    _participants[i].syncStart();
    Thread.sleep(100);
  }
  Thread.sleep(4000);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME),50 * 1000);
  Assert.assertTrue(result);
  for (int j=0; j < 10; j++) {
    if (_controller.getHandlers().size() == (handlerSize)) {
      break;
    }
    Thread.sleep(400);
  }
  Assert.assertEquals(_controller.getHandlers().size(),handlerSize);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheAsyncOpMultiThread </h4><pre class="type-7 type-1 type-8 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<Callable<Boolean>> threads=new ArrayList<Callable<Boolean>>();
  for (int i=0; i < 2; i++) {
    threads.add(new TestCreateZkCacheBaseDataAccessor(accessor,clusterName,i));
  }
  TestHelper.startThreadsConcurrently(threads,1000);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  threads.clear();
  for (int i=0; i < 2; i++) {
    threads.add(new TestUpdateZkCacheBaseDataAccessor(accessor,clusterName,i));
  }
  TestHelper.startThreadsConcurrently(threads,1000);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  threads.clear();
  for (int i=0; i < 2; i++) {
    threads.add(new TestSetZkCacheBaseDataAccessor(accessor,clusterName,i));
  }
  TestHelper.startThreadsConcurrently(threads,1000);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateFailZkCacheBaseAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,Arrays.asList(curStatePath,extViewPath),null);
  Assert.assertEquals(accessor._wtCache._cache.size(),1,"Should contain only:\n" + curStatePath);
  Assert.assertTrue(accessor._wtCache._cache.containsKey(curStatePath));
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertFalse(success[i],"Should fail on create: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: TestDB" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCreateFailZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,Arrays.asList(curStatePath),null);
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertFalse(success,"Should fail in create due to NodeExists: " + path);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    boolean success=accessor.set(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in set: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=accessor.get(path,null,0);
    Assert.assertEquals(record.getId(),"TestDB" + i);
  }
  List<String> childNames=accessor.getChildNames(extViewPath,0);
  Assert.assertEquals(childNames.size(),10,"Should contain only: TestDB0-9");
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(childNames.contains("TestDB" + i));
  }
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    Assert.assertTrue(accessor.exists(path,0));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZKLiveInstanceData </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDataChange() throws Exception {
  HelixManager adminManager=HelixManagerFactory.getZKHelixManager(clusterName,null,InstanceType.ADMINISTRATOR,_zkaddr);
  adminManager.connect();
  final BlockingQueue<List<LiveInstance>> changeList=new LinkedBlockingQueue<List<LiveInstance>>();
  adminManager.addLiveInstanceChangeListener(new LiveInstanceChangeListener(){
    @Override public void onLiveInstanceChange(    List<LiveInstance> liveInstances,    NotificationContext changeContext){
      changeList.add(deepCopy(liveInstances));
    }
  }
);
  List<LiveInstance> instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertTrue(instances.isEmpty(),"Expecting an empty list of live instance");
  HelixManager manager=HelixManagerFactory.getZKHelixManager(clusterName,"localhost_54321",InstanceType.PARTICIPANT,_zkaddr);
  manager.connect();
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertEquals(instances.size(),1,"Expecting one live instance");
  Assert.assertEquals(instances.get(0).getInstanceName(),manager.getInstanceName());
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  PropertyKey propertyKey=helixDataAccessor.keyBuilder().liveInstance(manager.getInstanceName());
  LiveInstance instance=helixDataAccessor.getProperty(propertyKey);
  Map<String,String> map=new TreeMap<String,String>();
  map.put("k1","v1");
  instance.getRecord().setMapField("test",map);
  Assert.assertTrue(helixDataAccessor.updateProperty(propertyKey,instance),"Failed to update live instance node");
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertEquals(instances.get(0).getRecord().getMapField("test"),map,"Wrong map data.");
  manager.disconnect();
  Thread.sleep(1000);
  instances=changeList.poll(1,TimeUnit.SECONDS);
  Assert.assertNotNull(instances,"Expecting a list of live instance");
  Assert.assertTrue(instances.isEmpty(),"Expecting an empty list of live instance");
  adminManager.disconnect();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZKUtil </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test() public void testIsClusterSetup(){
  boolean result=ZKUtil.isClusterSetup(clusterName,_zkClient);
  AssertJUnit.assertTrue(result);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testUpdateIfExists(){
  String path=PropertyPathConfig.getPath(PropertyType.CONFIGS,clusterName,ConfigScopeProperty.PARTICIPANT.toString(),"id3");
  ZNRecord record=new ZNRecord("id4");
  ZKUtil.updateIfExists(_zkClient,path,record,false);
  AssertJUnit.assertFalse(_zkClient.exists(path));
  _zkClient.createPersistent(path);
  ZKUtil.updateIfExists(_zkClient,path,record,false);
  AssertJUnit.assertTrue(_zkClient.exists(path));
  record=_zkClient.<ZNRecord>readData(path);
  AssertJUnit.assertEquals("id4",record.getId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZNRecordSizeLimit </h4><pre class="type-7 type-5 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZNRecordSizeLimitUseZNRecordSerializer(){
  String className=TestUtil.getTestName();
  System.out.println("START testZNRecordSizeLimitUseZNRecordSerializer at " + new Date(System.currentTimeMillis()));
  String root=className;
  byte[] buf=new byte[1024];
  for (int i=0; i < 1024; i++) {
    buf[i]='a';
  }
  String bufStr=new String(buf);
  final ZNRecord smallRecord=new ZNRecord("normalsize");
  smallRecord.getSimpleFields().clear();
  for (int i=0; i < 900; i++) {
    smallRecord.setSimpleField(i + "",bufStr);
  }
  String path1="/" + root + "/test1";
  _zkclient.createPersistent(path1,true);
  _zkclient.writeData(path1,smallRecord);
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord record=_zkclient.readData(path1);
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  final ZNRecord largeRecord=new ZNRecord("oversize");
  largeRecord.getSimpleFields().clear();
  for (int i=0; i < 1024; i++) {
    largeRecord.setSimpleField(i + "",bufStr);
  }
  String path2="/" + root + "/test2";
  _zkclient.createPersistent(path2,true);
  try {
    _zkclient.writeData(path2,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  record=_zkclient.readData(path2);
  Assert.assertNull(record);
  record=_zkclient.readData(path1);
  try {
    _zkclient.writeData(path1,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  ZNRecord recordNew=_zkclient.readData(path1);
  byte[] arr=serializer.serialize(record);
  byte[] arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  ZKHelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.addCluster(className,true);
  InstanceConfig instanceConfig=new InstanceConfig("localhost_12918");
  admin.addInstance(className,instanceConfig);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(className,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=new IdealState("currentState");
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  boolean succeed=accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  Assert.assertFalse(succeed);
  HelixProperty property=accessor.getProperty(keyBuilder.stateTransitionStatus("localhost_12918","session_1","partition_1"));
  Assert.assertNull(property);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 900; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.setProperty(keyBuilder.idealStates("TestDB1"),idealState);
  Assert.assertTrue(succeed);
  record=accessor.getProperty(keyBuilder.idealStates("TestDB1")).getRecord();
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=900; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.updateProperty(keyBuilder.idealStates("TestDB1"),idealState);
  Assert.assertFalse(succeed);
  recordNew=accessor.getProperty(keyBuilder.idealStates("TestDB1")).getRecord();
  arr=serializer.serialize(record);
  arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  System.out.println("END testZNRecordSizeLimitUseZNRecordSerializer at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZNRecordSizeLimitUseZNRecordStreamingSerializer(){
  String className=TestUtil.getTestName();
  System.out.println("START testZNRecordSizeLimitUseZNRecordStreamingSerializer at " + new Date(System.currentTimeMillis()));
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  String root=className;
  byte[] buf=new byte[1024];
  for (int i=0; i < 1024; i++) {
    buf[i]='a';
  }
  String bufStr=new String(buf);
  final ZNRecord smallRecord=new ZNRecord("normalsize");
  smallRecord.getSimpleFields().clear();
  for (int i=0; i < 900; i++) {
    smallRecord.setSimpleField(i + "",bufStr);
  }
  String path1="/" + root + "/test1";
  _zkclient.createPersistent(path1,true);
  _zkclient.writeData(path1,smallRecord);
  ZNRecord record=_zkclient.readData(path1);
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  final ZNRecord largeRecord=new ZNRecord("oversize");
  largeRecord.getSimpleFields().clear();
  for (int i=0; i < 1024; i++) {
    largeRecord.setSimpleField(i + "",bufStr);
  }
  String path2="/" + root + "/test2";
  _zkclient.createPersistent(path2,true);
  try {
    _zkclient.writeData(path2,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  record=_zkclient.readData(path2);
  Assert.assertNull(record);
  record=_zkclient.readData(path1);
  try {
    _zkclient.writeData(path1,largeRecord);
    Assert.fail("Should fail because data size is larger than 1M");
  }
 catch (  HelixException e) {
  }
  ZNRecord recordNew=_zkclient.readData(path1);
  byte[] arr=serializer.serialize(record);
  byte[] arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  ZKHelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.addCluster(className,true);
  InstanceConfig instanceConfig=new InstanceConfig("localhost_12918");
  admin.addInstance(className,instanceConfig);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(className,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=new IdealState("currentState");
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  boolean succeed=accessor.setProperty(keyBuilder.idealStates("TestDB_1"),idealState);
  Assert.assertFalse(succeed);
  HelixProperty property=accessor.getProperty(keyBuilder.idealStates("TestDB_1"));
  Assert.assertNull(property);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=0; i < 900; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.setProperty(keyBuilder.idealStates("TestDB_2"),idealState);
  Assert.assertTrue(succeed);
  record=accessor.getProperty(keyBuilder.idealStates("TestDB_2")).getRecord();
  Assert.assertTrue(serializer.serialize(record).length > 900 * 1024);
  idealState.getRecord().getSimpleFields().clear();
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(10);
  for (int i=900; i < 1024; i++) {
    idealState.getRecord().setSimpleField(i + "",bufStr);
  }
  succeed=accessor.updateProperty(keyBuilder.idealStates("TestDB_2"),idealState);
  Assert.assertFalse(succeed);
  recordNew=accessor.getProperty(keyBuilder.idealStates("TestDB_2")).getRecord();
  arr=serializer.serialize(record);
  arrNew=serializer.serialize(recordNew);
  Assert.assertTrue(Arrays.equals(arr,arrNew));
  System.out.println("END testZNRecordSizeLimitUseZNRecordStreamingSerializer at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZNRecordStreamingSerializer </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that simple, list, and map fields are initialized as empty even when not in json
 */
@Test public void fieldAutoInitTest(){
  StringBuilder jsonString=new StringBuilder("{\n").append("\"id\": \"myId\"\n").append("}");
  ZNRecordStreamingSerializer serializer=new ZNRecordStreamingSerializer();
  ZNRecord result=(ZNRecord)serializer.deserialize(jsonString.toString().getBytes());
  Assert.assertNotNull(result);
  Assert.assertEquals(result.getId(),"myId");
  Assert.assertNotNull(result.getSimpleFields());
  Assert.assertTrue(result.getSimpleFields().isEmpty());
  Assert.assertNotNull(result.getListFields());
  Assert.assertTrue(result.getListFields().isEmpty());
  Assert.assertNotNull(result.getMapFields());
  Assert.assertTrue(result.getMapFields().isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkBaseDataAccessor </h4><pre class="type-7 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  boolean success=_baseAccessor.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSyncExist(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.exists(path,0);
  Assert.assertFalse(success);
  success=accessor.create(path,record,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  success=accessor.exists(path,0);
  Assert.assertTrue(success);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncCreate(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  record.setSimpleField("key0","value0");
  success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertFalse(success,"Should fail since node already exists");
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),0);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAsyncZkBaseDataAccessor(){
  System.out.println("START TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
  String root="TestZkBaseDataAccessor_asyn";
  ZkClient zkClient=new ZkClient(_zkaddr);
  zkClient.setZkSerializer(new ZNRecordSerializer());
  zkClient.deleteRecursive("/" + root);
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(zkClient);
  String parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    records.add(new ZNRecord(msgId));
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in create " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getId(),msgId,"Should get what we created");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=new ArrayList<ZNRecord>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key1","value1");
    records.add(newRecord);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in set " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),1,"Should have 1 simple field set");
    Assert.assertEquals(record.getSimpleField("key1"),"value1","Should have value1 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<DataUpdater<ZNRecord>> znrecordUpdaters=new ArrayList<DataUpdater<ZNRecord>>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key2","value2");
    znrecordUpdaters.add(new ZNRecordUpdater(newRecord));
  }
  success=accessor.updateChildren(paths,znrecordUpdaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in update " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=accessor.getChildren(parentPath,null,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    ZNRecord record=records.get(i);
    Assert.assertEquals(record.getId(),msgId,"Should get what we updated");
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  boolean[] exists=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(exists[i],"Should exist " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  Stat[] stats=accessor.getStats(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertNotNull(stats[i],"Stat should exist for " + msgId);
    Assert.assertEquals(stats[i].getVersion(),2,"DataVersion should be 2, since we set 1 and update 1 for " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  success=accessor.remove(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in remove " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    boolean pathExists=zkClient.exists(path);
    Assert.assertFalse(pathExists,"Should be removed " + msgId);
  }
  zkClient.close();
  System.out.println("END TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-11 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncGetStat(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  Stat stat=accessor.getStat(path,0);
  Assert.assertNull(stat);
  boolean success=accessor.create(path,record,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  stat=accessor.getStat(path,0);
  Assert.assertNotNull(stat);
  Assert.assertEquals(stat.getVersion(),0);
  Assert.assertNotSame(stat.getEphemeralOwner(),0);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncDoSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s/%s",testName,"msg_0","submsg_0");
  ZNRecord record=new ZNRecord("submsg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  AccessResult result=accessor.doSet(path,record,-1,AccessOption.PERSISTENT);
  Assert.assertEquals(result._retCode,RetCode.OK);
  Assert.assertEquals(result._pathCreated.size(),3);
  Assert.assertTrue(result._pathCreated.contains(String.format("/%s",testName)));
  Assert.assertTrue(result._pathCreated.contains(String.format("/%s/%s",testName,"msg_0")));
  Assert.assertTrue(result._pathCreated.contains(path));
  Assert.assertTrue(_zkclient.exists(String.format("/%s",testName)));
  Assert.assertTrue(_zkclient.exists(String.format("/%s/%s",testName,"msg_0")));
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"submsg_0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncUpdate(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.update(path,new ZNRecordUpdater(record),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  record.setSimpleField("key0","value0");
  success=accessor.update(path,new ZNRecordUpdater(record),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  success=accessor.update(path,new DataUpdater<ZNRecord>(){
    @Override public ZNRecord update(    ZNRecord currentData){
      throw new RuntimeException("IGNORABLE: test throw exception from updater");
    }
  }
,AccessOption.PERSISTENT);
  Assert.assertFalse(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncSetWithVersion(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  boolean success=_baseAccessor.set(path,record,0,AccessOption.PERSISTENT);
  Assert.assertFalse(success,"Should fail since version not match");
  try {
    _zkclient.readData(path,false);
    Assert.fail("Should get no node exception");
  }
 catch (  Exception e) {
  }
  success=_baseAccessor.set(path,record,-1,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  path=String.format("/%s/%s",testName,"msg_1");
  record=new ZNRecord("msg_1");
  success=_baseAccessor.set(path,record,0,AccessOption.EPHEMERAL);
  Assert.assertFalse(success);
  try {
    _zkclient.readData(path,false);
    Assert.fail("Should get no node exception");
  }
 catch (  Exception e) {
  }
  success=_baseAccessor.set(path,record,-1,AccessOption.EPHEMERAL);
  Assert.assertTrue(success);
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_1");
  record.setSimpleField("key0","value0");
  success=_baseAccessor.set(path,record,0,AccessOption.PERSISTENT);
  Assert.assertTrue(success,"Should pass. AccessOption.PERSISTENT is ignored");
  getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncRemove(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  boolean success=accessor.remove(path,0);
  Assert.assertFalse(success);
  success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  ZNRecord getRecord=_zkclient.readData(path);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  success=accessor.remove(path,0);
  Assert.assertTrue(success);
  Assert.assertFalse(_zkclient.exists(path));
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSyncGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String path=String.format("/%s/%s",testName,"msg_0");
  ZNRecord record=new ZNRecord("msg_0");
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  Stat stat=new Stat();
  ZNRecord getRecord=accessor.get(path,stat,0);
  Assert.assertNull(getRecord);
  try {
    accessor.get(path,stat,AccessOption.THROW_EXCEPTION_IFNOTEXIST);
    Assert.fail("Should throw exception if not exist");
  }
 catch (  Exception e) {
  }
  boolean success=accessor.create(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getId(),"msg_0");
  Assert.assertEquals(stat.getVersion(),0);
  record.setSimpleField("key0","value0");
  success=accessor.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(record.getSimpleFields().size(),1);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  Assert.assertEquals(stat.getVersion(),1);
  ZNRecord newRecord=new ZNRecord("msg_0");
  newRecord.setSimpleField("key1","value1");
  success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
  Assert.assertTrue(success);
  getRecord=accessor.get(path,stat,0);
  Assert.assertNotNull(getRecord);
  Assert.assertEquals(getRecord.getSimpleFields().size(),2);
  Assert.assertNotNull(getRecord.getSimpleField("key0"));
  Assert.assertEquals(getRecord.getSimpleField("key0"),"value0");
  Assert.assertNotNull(getRecord.getSimpleField("key1"));
  Assert.assertEquals(getRecord.getSimpleField("key1"),"value1");
  Assert.assertEquals(stat.getVersion(),2);
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testHappyPathExtOpZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient extZkclient=new ZkClient(_zkaddr);
  extZkclient.setZkSerializer(new ZNRecordSerializer());
  ZkBaseDataAccessor<ZNRecord> extBaseAccessor=new ZkBaseDataAccessor<ZNRecord>(extZkclient);
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  extBaseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> zkCacheInitPaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,zkCacheInitPaths);
  boolean ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=extBaseAccessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  for (int i=0; i < 10; i++) {
    ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
    if (ret == true)     break;
    Thread.sleep(100);
  }
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=extBaseAccessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  success=extBaseAccessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    paths.add(path);
  }
  success=extBaseAccessor.remove(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in remove: " + paths.get(i));
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  extZkclient.close();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathSelfOpZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> zkCacheInitPaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,zkCacheInitPaths);
  boolean ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int j=0; j < 10; j++) {
    for (int i=0; i < 10; i++) {
      String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
      ZNRecord record=new ZNRecord("TestDB" + i);
      record.setSimpleField("setKey","" + j);
      paths.add(path);
      records.add(record);
    }
    success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=extViewPath + "/TestDB" + i;
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZkCacheCallbackExternalOpNoChroot() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient zkclient=new ZkClient(_zkaddr);
  zkclient.setZkSerializer(new ZNRecordSerializer());
  ZkBaseDataAccessor<ZNRecord> extBaseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  extBaseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,cachePaths);
  TestListener listener=new TestListener();
  accessor.subscribe(curStatePath,listener);
  List<String> createPaths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    createPaths.add(path);
    boolean success=extBaseAccessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  Thread.sleep(500);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("createCnt: " + listener._createPathQueue.size());
  Assert.assertEquals(listener._createPathQueue.size(),11,"Shall get 11 onCreate callbacks.");
  createPaths.add(curStatePath + "/session_0");
  List<String> createCallbackPaths=new ArrayList<String>(listener._createPathQueue);
  Collections.sort(createPaths);
  Collections.sort(createCallbackPaths);
  Assert.assertEquals(createCallbackPaths,createPaths,"Should get create callbacks at " + createPaths + ", but was "+ createCallbackPaths);
  List<String> updatePaths=new ArrayList<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      updatePaths.add(path);
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("changeCnt: " + listener._changePathQueue.size());
  Assert.assertEquals(listener._changePathQueue.size(),100,"Shall get 100 onChange callbacks.");
  List<String> updateCallbackPaths=new ArrayList<String>(listener._changePathQueue);
  Collections.sort(updatePaths);
  Collections.sort(updateCallbackPaths);
  Assert.assertEquals(updateCallbackPaths,updatePaths,"Should get change callbacks at " + updatePaths + ", but was "+ updateCallbackPaths);
  TreeSet<String> removePaths=new TreeSet<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    removePaths.add(path);
    boolean success=accessor.remove(path,AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in remove: " + path);
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("deleteCnt: " + listener._deletePathQueue.size());
  Assert.assertTrue(listener._deletePathQueue.size() >= 10,"Shall get at least 10 onDelete callbacks.");
  Set<String> removeCallbackPaths=new TreeSet<String>(listener._deletePathQueue);
  Assert.assertEquals(removeCallbackPaths,removePaths,"Should get remove callbacks at " + removePaths + ", but was "+ removeCallbackPaths);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkClusterManager </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testAdministrator() throws Exception {
  final String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZKHelixManager admin=new ZKHelixManager(clusterName,null,InstanceType.ADMINISTRATOR,_zkaddr);
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  admin.connect();
  AssertJUnit.assertTrue(admin.isConnected());
  HelixAdmin adminTool=admin.getClusterManagmentTool();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("pKey1","pValue1");
  properties.put("pKey2","pValue2");
  adminTool.setConfig(scope,properties);
  properties=adminTool.getConfig(scope,Arrays.asList("pKey1","pKey2"));
  Assert.assertEquals(properties.size(),2);
  Assert.assertEquals(properties.get("pKey1"),"pValue1");
  Assert.assertEquals(properties.get("pKey2"),"pValue2");
  admin.disconnect();
  AssertJUnit.assertFalse(admin.isConnected());
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testLiveInstanceInfoProvider() throws Exception {
  final String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
class provider implements LiveInstanceInfoProvider {
    boolean _flag=false;
    public provider(    boolean genSessionId){
      _flag=genSessionId;
    }
    @Override public ZNRecord getAdditionalLiveInstanceInfo(){
      ZNRecord record=new ZNRecord("info");
      record.setSimpleField("simple","value");
      List<String> listFieldVal=new ArrayList<String>();
      listFieldVal.add("val1");
      listFieldVal.add("val2");
      listFieldVal.add("val3");
      record.setListField("list",listFieldVal);
      Map<String,String> mapFieldVal=new HashMap<String,String>();
      mapFieldVal.put("k1","val1");
      mapFieldVal.put("k2","val2");
      mapFieldVal.put("k3","val3");
      record.setMapField("map",mapFieldVal);
      if (_flag) {
        record.setSimpleField("SESSION_ID","value");
        record.setSimpleField("LIVE_INSTANCE","value");
        record.setSimpleField("Others","value");
      }
      return record;
    }
  }
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  int[] ids={0,1,2,3,4,5};
  setupInstances(clusterName,ids);
  ZKHelixManager manager=new ZKHelixManager(clusterName,"localhost_0",InstanceType.PARTICIPANT,_zkaddr);
  manager.connect();
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  LiveInstance liveInstance=accessor.getProperty(accessor.keyBuilder().liveInstance("localhost_0"));
  Assert.assertTrue(liveInstance.getRecord().getListFields().size() == 0);
  Assert.assertTrue(liveInstance.getRecord().getMapFields().size() == 0);
  Assert.assertTrue(liveInstance.getRecord().getSimpleFields().size() == 3);
  manager=new ZKHelixManager(clusterName,"localhost_1",InstanceType.PARTICIPANT,_zkaddr);
  manager.setLiveInstanceInfoProvider(new provider(false));
  manager.connect();
  accessor=manager.getHelixDataAccessor();
  liveInstance=accessor.getProperty(accessor.keyBuilder().liveInstance("localhost_1"));
  Assert.assertTrue(liveInstance.getRecord().getListFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getMapFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getSimpleFields().size() == 4);
  manager=new ZKHelixManager(clusterName,"localhost_2",InstanceType.PARTICIPANT,_zkaddr);
  manager.setLiveInstanceInfoProvider(new provider(true));
  manager.connect();
  accessor=manager.getHelixDataAccessor();
  liveInstance=accessor.getProperty(accessor.keyBuilder().liveInstance("localhost_2"));
  Assert.assertTrue(liveInstance.getRecord().getListFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getMapFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getSimpleFields().size() == 5);
  Assert.assertFalse(liveInstance.getTypedSessionId().stringify().equals("value"));
  Assert.assertFalse(liveInstance.getLiveInstance().equals("value"));
  MockParticipant manager2=new MockParticipant(_zkaddr,clusterName,"localhost_3");
  manager2.setLiveInstanceInfoProvider(new provider(true));
  manager2.connect();
  accessor=manager2.getHelixDataAccessor();
  liveInstance=accessor.getProperty(accessor.keyBuilder().liveInstance("localhost_3"));
  Assert.assertTrue(liveInstance.getRecord().getListFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getMapFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getSimpleFields().size() == 5);
  Assert.assertFalse(liveInstance.getTypedSessionId().stringify().equals("value"));
  Assert.assertFalse(liveInstance.getLiveInstance().equals("value"));
  String sessionId=liveInstance.getTypedSessionId().stringify();
  ZkTestHelper.expireSession(manager2.getZkClient());
  Thread.sleep(1000);
  liveInstance=accessor.getProperty(accessor.keyBuilder().liveInstance("localhost_3"));
  Assert.assertTrue(liveInstance.getRecord().getListFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getMapFields().size() == 1);
  Assert.assertTrue(liveInstance.getRecord().getSimpleFields().size() == 5);
  Assert.assertFalse(liveInstance.getTypedSessionId().stringify().equals("value"));
  Assert.assertFalse(liveInstance.getLiveInstance().equals("value"));
  Assert.assertFalse(sessionId.equals(liveInstance.getTypedSessionId().stringify()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testController() throws Exception {
  final String clusterName=TestUtil.getTestName();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  try {
    controller.connect();
    Assert.fail("Should throw HelixException if initial cluster structure is not setup");
  }
 catch (  HelixException e) {
  }
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  controller.connect();
  AssertJUnit.assertTrue(controller.isConnected());
  controller.connect();
  AssertJUnit.assertTrue(controller.isConnected());
  MockListener listener=new MockListener();
  listener.reset();
  try {
    controller.addControllerListener(null);
    Assert.fail("Should throw HelixException");
  }
 catch (  HelixException e) {
  }
  Builder keyBuilder=new Builder(controller.getClusterName());
  controller.addControllerListener(listener);
  AssertJUnit.assertTrue(listener.isControllerChangeListenerInvoked);
  controller.removeListener(keyBuilder.controller(),listener);
  ZkHelixPropertyStore<ZNRecord> store=controller.getHelixPropertyStore();
  ZNRecord record=new ZNRecord("node_1");
  int options=0;
  store.set("/node_1",record,AccessOption.PERSISTENT);
  Stat stat=new Stat();
  record=store.get("/node_1",stat,options);
  AssertJUnit.assertEquals("node_1",record.getId());
  controller.getMessagingService();
  controller.getClusterManagmentTool();
  controller.getConn().handleNewSession();
  controller.disconnect();
  AssertJUnit.assertFalse(controller.isConnected());
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkFlapping </h4><pre class="type-7 type-1 type-8 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZkSessionExpiry() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  String path=String.format("/%s",clusterName);
  client.createEphemeral(path);
  String oldSessionId=ZkTestHelper.getSessionId(client);
  ZkTestHelper.expireSession(client);
  String newSessionId=ZkTestHelper.getSessionId(client);
  Assert.assertNotSame(newSessionId,oldSessionId);
  Assert.assertFalse(client.exists(path),"Ephemeral znode should be gone after session expiry");
  client.close();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParticipantFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  final String instanceName="localhost_12918";
  MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
  participant.syncStart();
  final ZkClient client=participant.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  client.unsubscribeStateChanges(listener);
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
  Assert.assertNotNull(liveInstance,"Live-instance should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
      return liveInstance == null;
    }
  }
,3 * 1000);
  Assert.assertTrue(success,"Live-instance should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testCloseZkClientInZkClientEventThread() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  final CountDownLatch waitCallback=new CountDownLatch(1);
  final ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  String path=String.format("/%s",clusterName);
  client.createEphemeral(path);
  client.subscribeDataChanges(path,new IZkDataListener(){
    @Override public void handleDataDeleted(    String dataPath) throws Exception {
    }
    @Override public void handleDataChange(    String dataPath,    Object data) throws Exception {
      client.close();
      waitCallback.countDown();
    }
  }
);
  client.writeData(path,new ZNRecord("test"));
  waitCallback.await();
  Assert.assertFalse(_zkclient.exists(path),"Ephemeral node: " + path + " should be removed after ZkClient#close() in its own event-thread");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testCloseZkClient(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient client=new ZkClient(_zkaddr,ZkClient.DEFAULT_SESSION_TIMEOUT,ZkClient.DEFAULT_CONNECTION_TIMEOUT,new ZNRecordSerializer());
  String path=String.format("/%s",clusterName);
  client.createEphemeral(path);
  client.close();
  Assert.assertFalse(_zkclient.exists(path),"Ephemeral node: " + path + " should be removed after ZkClient#close()");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testControllerFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  final ZkClient client=controller.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader,"Leader should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      return leader == null;
    }
  }
,5 * 1000);
  Assert.assertTrue(success,"Leader should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixAdmin </h4><pre class="type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddRemoveMsgConstraint(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient),"Cluster should be setup");
  ClusterConstraints constraints=tool.getConstraints(clusterName,ConstraintType.MESSAGE_CONSTRAINT);
  Assert.assertNull(constraints,"message-constraint should NOT exist for cluster: " + className);
  try {
    tool.removeConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
  }
 catch (  Exception e) {
    Assert.fail("Should not throw exception when remove a non-exist constraint.");
  }
  ConstraintItemBuilder builder=new ConstraintItemBuilder();
  builder.addConstraintAttribute(ConstraintAttribute.RESOURCE.toString(),"MyDB").addConstraintAttribute(ConstraintAttribute.CONSTRAINT_VALUE.toString(),"1");
  tool.setConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1",builder.build());
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  PropertyKey.Builder keyBuilder=new PropertyKey.Builder(clusterName);
  constraints=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  Assert.assertNotNull(constraints,"message-constraint should exist");
  ConstraintItem item=constraints.getConstraintItem(ConstraintId.from("constraint1"));
  Assert.assertNotNull(item,"message-constraint for constraint1 should exist");
  Assert.assertEquals(item.getConstraintValue(),"1");
  Assert.assertEquals(item.getAttributeValue(ConstraintAttribute.RESOURCE),"MyDB");
  constraints=tool.getConstraints(clusterName,ConstraintType.MESSAGE_CONSTRAINT);
  Assert.assertNotNull(constraints,"message-constraint should exist");
  item=constraints.getConstraintItem(ConstraintId.from("constraint1"));
  Assert.assertNotNull(item,"message-constraint for constraint1 should exist");
  Assert.assertEquals(item.getConstraintValue(),"1");
  Assert.assertEquals(item.getAttributeValue(ConstraintAttribute.RESOURCE),"MyDB");
  tool.removeConstraint(clusterName,ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
  constraints=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()));
  Assert.assertNotNull(constraints,"message-constraint should exist");
  item=constraints.getConstraintItem(ConstraintId.from("constraint1"));
  Assert.assertNull(item,"message-constraint for constraint1 should NOT exist");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDropResource(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient),"Cluster should be setup");
  tool.addStateModelDef(clusterName,"MasterSlave",new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave()));
  tool.addResource(clusterName,"test-db",4,"MasterSlave");
  Map<String,String> resourceConfig=new HashMap<String,String>();
  resourceConfig.put("key1","value1");
  tool.setConfig(new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).forResource("test-db").build(),resourceConfig);
  PropertyKey.Builder keyBuilder=new PropertyKey.Builder(clusterName);
  Assert.assertTrue(_zkclient.exists(keyBuilder.idealStates("test-db").getPath()),"test-db ideal-state should exist");
  Assert.assertTrue(_zkclient.exists(keyBuilder.resourceConfig("test-db").getPath()),"test-db resource config should exist");
  tool.dropResource(clusterName,"test-db");
  Assert.assertFalse(_zkclient.exists(keyBuilder.idealStates("test-db").getPath()),"test-db ideal-state should be dropped");
  Assert.assertFalse(_zkclient.exists(keyBuilder.resourceConfig("test-db").getPath()),"test-db resource config should be dropped");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDisableResource(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  HelixAdmin admin=new ZKHelixAdmin(_zkclient);
  admin.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient),"Cluster should be setup");
  String resourceName="TestDB";
  admin.addStateModelDef(clusterName,"MasterSlave",new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave()));
  admin.addResource(clusterName,resourceName,4,"MasterSlave");
  admin.enableResource(clusterName,resourceName,false);
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates(resourceName));
  Assert.assertFalse(idealState.isEnabled());
  admin.enableResource(clusterName,resourceName,true);
  idealState=accessor.getProperty(keyBuilder.idealStates(resourceName));
  Assert.assertTrue(idealState.isEnabled());
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testZkHelixAdmin(){
  System.out.println("START testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
  final String clusterName=TestUtil.getTestName();
  String rootPath="/" + clusterName;
  if (_zkclient.exists(rootPath)) {
    _zkclient.deleteRecursive(rootPath);
  }
  HelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  List<String> list=tool.getClusters();
  AssertJUnit.assertTrue(list.size() > 0);
  try {
    Stat oldstat=_zkclient.getStat(rootPath);
    Assert.assertNotNull(oldstat);
    boolean success=tool.addCluster(clusterName,false);
    Assert.assertTrue(success);
    Stat newstat=_zkclient.getStat(rootPath);
    Assert.assertEquals(oldstat,newstat);
  }
 catch (  HelixException e) {
  }
  InstanceConfig config=new InstanceConfig("host1_9999");
  config.setHostName("host1");
  config.setPort("9999");
  tool.addInstance(clusterName,config);
  tool.enableInstance(clusterName,"host1_9999",true);
  String path=PropertyPathConfig.getPath(PropertyType.INSTANCES,clusterName,"host1_9999");
  AssertJUnit.assertTrue(_zkclient.exists(path));
  try {
    tool.addInstance(clusterName,config);
    Assert.fail("should fail if add an alredy-existing instance");
  }
 catch (  HelixException e) {
  }
  config=tool.getInstanceConfig(clusterName,"host1_9999");
  AssertJUnit.assertEquals(config.getId(),"host1_9999");
  tool.dropInstance(clusterName,config);
  try {
    tool.getInstanceConfig(clusterName,"host1_9999");
    Assert.fail("should fail if get a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.dropInstance(clusterName,config);
    Assert.fail("should fail if drop on a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.enableInstance(clusterName,"host1_9999",false);
    Assert.fail("should fail if enable a non-existent instance");
  }
 catch (  HelixException e) {
  }
  ZNRecord stateModelRecord=new ZNRecord("id1");
  try {
    tool.addStateModelDef(clusterName,"id1",new StateModelDefinition(stateModelRecord));
    path=PropertyPathConfig.getPath(PropertyType.STATEMODELDEFS,clusterName,"id1");
    AssertJUnit.assertTrue(_zkclient.exists(path));
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
catch (  IllegalArgumentException ex) {
  }
  tool.addStateModelDef(clusterName,"MasterSlave",new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave()));
  stateModelRecord=StateModelConfigGenerator.generateConfigForMasterSlave();
  try {
    tool.addStateModelDef(clusterName,stateModelRecord.getId(),new StateModelDefinition(stateModelRecord));
    Assert.fail("should fail if add an already-existing state model");
  }
 catch (  HelixException e) {
  }
  list=tool.getStateModelDefs(clusterName);
  AssertJUnit.assertEquals(list.size(),1);
  try {
    tool.addResource(clusterName,"resource",10,"nonexistStateModelDef");
    Assert.fail("should fail if add a resource without an existing state model");
  }
 catch (  HelixException e) {
  }
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  ExternalView resourceExternalView=tool.getResourceExternalView(clusterName,"resource");
  AssertJUnit.assertNull(resourceExternalView);
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("pKey1","pValue1");
  properties.put("pKey2","pValue2");
  for (int i=0; i < 100; i++) {
    tool.setConfig(scope,properties);
    Map<String,String> newProperties=tool.getConfig(scope,new ArrayList<String>(properties.keySet()));
    Assert.assertEquals(newProperties.size(),2);
    Assert.assertEquals(newProperties.get("pKey1"),"pValue1");
    Assert.assertEquals(newProperties.get("pKey2"),"pValue2");
  }
  System.out.println("END testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixController </h4><pre class="type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Remove leader znode externally should invoke another round of leader-election
 * this simulates the race condition in{@link ZkHelixLeaderElection#onControllerChange(org.apache.helix.NotificationContext)}
 * @throws Exception
 */
@Test public void testRemoveLeaderZnode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  final ControllerId controllerId=ControllerId.from("controller");
  HelixController controller=connection.createController(clusterId,controllerId);
  controller.start();
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getInstanceName(),controllerId.stringify());
  accessor.removeProperty(keyBuilder.controllerLeader());
  boolean result=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      if (leader == null) {
        return false;
      }
      return leader.getInstanceName().equals(controllerId.stringify());
    }
  }
,3 * 1000);
  Assert.assertTrue(result,"Fail to re-elect a new leader");
  connection.disconnect();
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixMultiClusterController </h4><pre class="type-4 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnConnectedAndDisconnecting() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  final HelixMultiClusterController[] controllers=new HelixMultiClusterController[n];
  for (int i=0; i < n; i++) {
    int port=12918 + i;
    ControllerId controllerId=ControllerId.from("localhost_" + port);
    controllers[i]=connection.createMultiClusterController(clusterId,controllerId);
    controllers[i].start();
  }
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    String instanceName=controllers[i].getControllerId().stringify();
    Assert.assertNotNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  }
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getInstanceName(),controllers[0].getControllerId().stringify());
  controllers[0].stop();
  String instanceName=controllers[0].getControllerId().stringify();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      if (leader == null) {
        return false;
      }
      return leader.getInstanceName().equals(controllers[1].getControllerId().stringify());
    }
  }
,3 * 1000);
  Assert.assertTrue(success,"fail to re-elect new leader");
  connection.disconnect();
  instanceName=controllers[1].getControllerId().stringify();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkManagerFlappingDetection </h4><pre class="type-4 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDisconnectHistory() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  String instanceName="localhost_" + (12918 + 0);
  MockParticipant manager=new MockParticipant(_zkaddr,clusterName,instanceName);
  manager.connect();
  ZkClient zkClient=manager.getZkClient();
  ZkTestHelper.expireSession(zkClient);
  for (int i=0; i < 4; i++) {
    ZkTestHelper.expireSession(zkClient);
    Thread.sleep(1000);
    if (i < 5) {
      Assert.assertTrue(manager.isConnected());
    }
  }
  ZkTestHelper.disconnectSession(zkClient);
  for (int i=0; i < 20; i++) {
    Thread.sleep(500);
    System.out.println(i);
    if (!manager.isConnected())     break;
  }
  Assert.assertFalse(manager.isConnected());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.serializer.TestJacksonPayloadSerializer </h4><pre class="type-5 type-1 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that the payload is not included whenever it is not null. This is mainly to maintain
 * backward
 * compatibility.
 */
@Test public void testRawPayloadMissingIfUnspecified(){
  final String RECORD_ID="testRawPayloadMissingIfUnspecified";
  ZNRecord znRecord=new ZNRecord(RECORD_ID);
  ZNRecordSerializer znRecordSerializer=new ZNRecordSerializer();
  byte[] serialized=znRecordSerializer.serialize(znRecord);
  ZNRecordStreamingSerializer znRecordStreamingSerializer=new ZNRecordStreamingSerializer();
  byte[] streamingSerialized=znRecordStreamingSerializer.serialize(znRecord);
  ObjectMapper mapper=new ObjectMapper();
  try {
    JsonNode jsonNode=mapper.readTree(new String(serialized));
    Assert.assertFalse(jsonNode.has("rawPayload"));
    JsonNode streamingJsonNode=mapper.readTree(new String(streamingSerialized));
    Assert.assertFalse(streamingJsonNode.has("rawPayload"));
  }
 catch (  JsonProcessingException e) {
    Assert.fail();
  }
catch (  IOException e) {
    Assert.fail();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.TestAsyncCallback </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testAsyncCallback() throws Exception {
  System.out.println("START TestAsyncCallback at " + new Date(System.currentTimeMillis()));
  AsyncCallbackSample callback=new AsyncCallbackSample();
  AssertJUnit.assertFalse(callback.isInterrupted());
  AssertJUnit.assertFalse(callback.isTimedOut());
  AssertJUnit.assertTrue(callback.getMessageReplied().size() == 0);
  int nMsgs=5;
  List<Message> messageSent=new ArrayList<Message>();
  for (int i=0; i < nMsgs; i++) {
    messageSent.add(new Message("Test",MessageId.from(UUID.randomUUID().toString())));
  }
  callback.setMessagesSent(messageSent);
  for (int i=0; i < nMsgs; i++) {
    AssertJUnit.assertFalse(callback.isDone());
    callback.onReply(new Message("TestReply",MessageId.from(UUID.randomUUID().toString())));
  }
  AssertJUnit.assertTrue(callback.isDone());
  AssertJUnit.assertTrue(callback._onTimeOutCalled == 0);
  sleep(50);
  callback=new AsyncCallbackSample();
  callback.setMessagesSent(messageSent);
  callback.setTimeout(1000);
  sleep(50);
  callback.startTimer();
  AssertJUnit.assertFalse(callback.isTimedOut());
  for (int i=0; i < nMsgs - 1; i++) {
    sleep(50);
    AssertJUnit.assertFalse(callback.isDone());
    AssertJUnit.assertTrue(callback._onReplyMessageCalled == i);
    callback.onReply(new Message("TestReply",MessageId.from(UUID.randomUUID().toString())));
  }
  sleep(1000);
  AssertJUnit.assertTrue(callback.isTimedOut());
  AssertJUnit.assertTrue(callback._onTimeOutCalled == 1);
  AssertJUnit.assertFalse(callback.isDone());
  callback=new AsyncCallbackSample();
  callback.setMessagesSent(messageSent);
  callback.setTimeout(1000);
  callback.startTimer();
  sleep(50);
  AssertJUnit.assertFalse(callback.isTimedOut());
  for (int i=0; i < nMsgs; i++) {
    AssertJUnit.assertFalse(callback.isDone());
    sleep(50);
    AssertJUnit.assertTrue(callback._onReplyMessageCalled == i);
    callback.onReply(new Message("TestReply",MessageId.from(UUID.randomUUID().toString())));
  }
  AssertJUnit.assertTrue(callback.isDone());
  sleep(1300);
  AssertJUnit.assertFalse(callback.isTimedOut());
  AssertJUnit.assertTrue(callback._onTimeOutCalled == 0);
  System.out.println("END TestAsyncCallback at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.TestAsyncCallbackSvc </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testAsyncCallbackSvc() throws Exception {
  AsyncCallbackService svc=new AsyncCallbackService();
  HelixManager manager=new MockHelixManager();
  NotificationContext changeContext=new NotificationContext(manager);
  Message msg=new Message(svc.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
  msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
  try {
    svc.createHandler(msg,changeContext);
  }
 catch (  HelixException e) {
    AssertJUnit.assertTrue(e.getMessage().indexOf(msg.getMessageId().stringify()) != -1);
  }
  Message msg2=new Message("RandomType",MessageId.from(UUID.randomUUID().toString()));
  msg2.setTgtSessionId(SessionId.from(manager.getSessionId()));
  try {
    svc.createHandler(msg2,changeContext);
  }
 catch (  HelixException e) {
    AssertJUnit.assertTrue(e.getMessage().indexOf(msg2.getMessageId().stringify()) != -1);
  }
  Message msg3=new Message(svc.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
  msg3.setTgtSessionId(SessionId.from(manager.getSessionId()));
  msg3.setCorrelationId("wfwegw");
  try {
    svc.createHandler(msg3,changeContext);
  }
 catch (  HelixException e) {
    AssertJUnit.assertTrue(e.getMessage().indexOf(msg3.getMessageId().stringify()) != -1);
  }
  TestAsyncCallback callback=new TestAsyncCallback();
  String corrId=UUID.randomUUID().toString();
  svc.registerAsyncCallback(corrId,new TestAsyncCallback());
  svc.registerAsyncCallback(corrId,callback);
  List<Message> msgSent=new ArrayList<Message>();
  msgSent.add(new Message("Test",MessageId.from(UUID.randomUUID().toString())));
  callback.setMessagesSent(msgSent);
  msg=new Message(svc.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
  msg.setTgtSessionId(SessionId.from("*"));
  msg.setCorrelationId(corrId);
  MessageHandler aHandler=svc.createHandler(msg,changeContext);
  aHandler.handleMessage();
  AssertJUnit.assertTrue(callback.isDone());
  AssertJUnit.assertTrue(callback._repliedMessageId.contains(msg.getMessageId()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestHelixTaskExecutor </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testNormalMsgExecution() throws InterruptedException {
  System.out.println("START TestCMTaskExecutor.testNormalMsgExecution()");
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  executor.registerMessageHandlerFactory(factory2.getMessageType(),factory2);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setCorrelationId(UUID.randomUUID().toString());
    msgList.add(msg);
  }
  int nMsgs2=6;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setCorrelationId(UUID.randomUUID().toString());
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory2._processedMsgIds.size() == nMsgs2);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(factory2._handlersCreated == nMsgs2);
  for (  Message record : msgList) {
    AssertJUnit.assertTrue(factory._processedMsgIds.containsKey(record.getId()) || factory2._processedMsgIds.containsKey(record.getId()));
    AssertJUnit.assertFalse(factory._processedMsgIds.containsKey(record.getId()) && factory2._processedMsgIds.containsKey(record.getId()));
  }
  System.out.println("END TestCMTaskExecutor.testNormalMsgExecution()");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testCreateHandlerException() throws InterruptedException {
  System.out.println("START TestCMTaskExecutor.testCreateHandlerException()");
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setCorrelationId(UUID.randomUUID().toString());
    msgList.add(msg);
  }
  Message exceptionMsg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
  exceptionMsg.setTgtSessionId(SessionId.from(manager.getSessionId()));
  exceptionMsg.setMsgSubType("EXCEPTION");
  exceptionMsg.setTgtName("Localhost_1123");
  exceptionMsg.setSrcName("127.101.1.23_2234");
  exceptionMsg.setCorrelationId(UUID.randomUUID().toString());
  msgList.add(exceptionMsg);
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(exceptionMsg.getMsgState() == MessageState.UNPROCESSABLE);
  System.out.println("END TestCMTaskExecutor.testCreateHandlerException()");
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test() public void testShutdown() throws InterruptedException {
  System.out.println("START TestCMTaskExecutor.testShutdown()");
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  executor.registerMessageHandlerFactory(factory2.getMessageType(),factory2);
  CancellableHandlerFactory factory3=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory3.getMessageType(),factory3);
  int nMsg1=10, nMsg2=10, nMsg3=10;
  List<Message> msgList=new ArrayList<Message>();
  for (int i=0; i < nMsg1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  for (int i=0; i < nMsg2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msgList.add(msg);
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  for (int i=0; i < nMsg3; i++) {
    Message msg=new Message(factory3.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msgList.add(msg);
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  NotificationContext changeContext=new NotificationContext(manager);
  executor.onMessage("some",msgList,changeContext);
  Thread.sleep(500);
  for (  ExecutorService svc : executor._executorMap.values()) {
    Assert.assertFalse(svc.isShutdown());
  }
  Assert.assertTrue(factory._processedMsgIds.size() > 0);
  executor.shutdown();
  for (  ExecutorService svc : executor._executorMap.values()) {
    Assert.assertTrue(svc.isShutdown());
  }
  System.out.println("END TestCMTaskExecutor.testShutdown()");
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testNoRetry() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setExecutionTimeout((i + 1) * 600);
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(4000);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs2);
  AssertJUnit.assertEquals(factory._timedOutMsgIds.size(),2);
  for (int i=0; i < nMsgs2 - 2; i++) {
    if (msgList.get(i).getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(msgList.get(i).getRecord().getSimpleFields().containsKey("Cancelcount"));
      AssertJUnit.assertTrue(factory._timedOutMsgIds.containsKey(msgList.get(i).getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testTaskCancellation() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=0;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  List<Message> msgListToCancel=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msgList.add(msg);
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgListToCancel.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(500);
  for (int i=0; i < nMsgs2; i++) {
    HelixTask task=new HelixTask(msgListToCancel.get(i),changeContext,null,null);
    executor.cancelTask(task);
  }
  Thread.sleep(1500);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1 + nMsgs2);
  AssertJUnit.assertTrue(factory._processingMsgIds.size() == nMsgs1 + nMsgs2);
  for (  Message message : msgList) {
    if (message.getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(factory._processingMsgIds.containsKey(message.getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testUnknownTypeMsgExecution() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from(manager.getSessionId()));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory2._processedMsgIds.size() == 0);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(factory2._handlersCreated == 0);
  for (  Message message : msgList) {
    if (message.getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(factory._processedMsgIds.containsKey(message.getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testMsgSessionId() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  TestMessageHandlerFactory factory=new TestMessageHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  TestMessageHandlerFactory2 factory2=new TestMessageHandlerFactory2();
  executor.registerMessageHandlerFactory(factory2.getMessageType(),factory2);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs1=5;
  for (int i=0; i < nMsgs1; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("");
    msgList.add(msg);
  }
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory2.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("some other session id"));
    msg.setTgtName("");
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(factory._processedMsgIds.size() == nMsgs1);
  AssertJUnit.assertTrue(factory2._processedMsgIds.size() == 0);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs1);
  AssertJUnit.assertTrue(factory2._handlersCreated == 0);
  for (  Message message : msgList) {
    if (message.getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(factory._processedMsgIds.containsKey(message.getId()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testRetryOnce() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setExecutionTimeout((i + 1) * 600);
    msg.setRetryCount(1);
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(3500);
  AssertJUnit.assertEquals(factory._processedMsgIds.size(),3);
  AssertJUnit.assertTrue(msgList.get(0).getRecord().getSimpleField("Cancelcount").equals("2"));
  AssertJUnit.assertTrue(msgList.get(1).getRecord().getSimpleField("Cancelcount").equals("1"));
  AssertJUnit.assertEquals(factory._timedOutMsgIds.size(),2);
  AssertJUnit.assertTrue(executor._taskMap.size() == 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestResourceThreadpoolSize </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestThreadPoolSizeConfig(){
  HelixManager manager=_participants[0];
  ConfigAccessor accessor=manager.getConfigAccessor();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(manager.getClusterName()).forResource("NextDB").build();
  accessor.set(scope,HelixTaskExecutor.MAX_THREADS,"" + 12);
  _setupTool.addResourceToCluster(CLUSTER_NAME,"NextDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"NextDB",3);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  long taskcount=0;
  for (int i=0; i < NODE_NR; i++) {
    DefaultMessagingService svc=(DefaultMessagingService)(_participants[i].getMessagingService());
    HelixTaskExecutor helixExecutor=svc.getExecutor();
    ThreadPoolExecutor executor=(ThreadPoolExecutor)(helixExecutor._executorMap.get(MessageType.STATE_TRANSITION + "." + "NextDB"));
    Assert.assertEquals(12,executor.getMaximumPoolSize());
    taskcount+=executor.getCompletedTaskCount();
    Assert.assertTrue(executor.getCompletedTaskCount() > 0);
  }
  Assert.assertEquals(taskcount,64 * 4);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.TestConstraint </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStateConstraint(){
  String className=TestUtil.getTestName();
  System.out.println("START testStateConstraint() at " + new Date(System.currentTimeMillis()));
  String clusterName="CLUSTER_" + className + "_state";
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  ZNRecord record=new ZNRecord("testStateConstraint");
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("STATE","MASTER");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("STATE","MASTER");
  record.getMapField("constraint1").put("RESOURCE","TestDB");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("STATE","MASTER");
  record.getMapField("constraint2").put("RESOURCE",".*");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.STATE_CONSTRAINT.toString()),new ClusterConstraints(record));
  record=accessor.getProperty(keyBuilder.constraint(ConstraintType.STATE_CONSTRAINT.toString())).getRecord();
  ClusterConstraints constraint=new ClusterConstraints(record);
  Map<ConstraintAttribute,String> stateAttr1=new HashMap<ConstraintAttribute,String>();
  stateAttr1.put(ConstraintAttribute.STATE,"MASTER");
  stateAttr1.put(ConstraintAttribute.RESOURCE,"TestDB");
  Set<ConstraintItem> matches=constraint.match(stateAttr1);
  System.out.println(stateAttr1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),3);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Map<ConstraintAttribute,String> stateAttr2=new HashMap<ConstraintAttribute,String>();
  stateAttr2.put(ConstraintAttribute.STATE,"MASTER");
  stateAttr2.put(ConstraintAttribute.RESOURCE,"MyDB");
  matches=constraint.match(stateAttr2);
  System.out.println(stateAttr2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),2);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint2));
  System.out.println("END testStateConstraint() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMsgConstraint(){
  String className=TestUtil.getTestName();
  System.out.println("START testMsgConstraint() at " + new Date(System.currentTimeMillis()));
  String clusterName="CLUSTER_" + className + "_msg";
  TestHelper.setupEmptyCluster(_zkclient,clusterName);
  ZNRecord record=new ZNRecord("testMsgConstraint");
  record.setMapField("constraint0",new TreeMap<String,String>());
  record.getMapField("constraint0").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint0").put("CONSTRAINT_VALUE","ANY");
  ConstraintItem constraint0=new ConstraintItem(record.getMapField("constraint0"));
  record.setMapField("constraint1",new TreeMap<String,String>());
  record.getMapField("constraint1").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint1").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint1").put("CONSTRAINT_VALUE","50");
  ConstraintItem constraint1=new ConstraintItem(record.getMapField("constraint1"));
  record.setMapField("constraint2",new TreeMap<String,String>());
  record.getMapField("constraint2").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint2").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint2").put("INSTANCE",".*");
  record.getMapField("constraint2").put("RESOURCE","TestDB");
  record.getMapField("constraint2").put("CONSTRAINT_VALUE","2");
  ConstraintItem constraint2=new ConstraintItem(record.getMapField("constraint2"));
  record.setMapField("constraint3",new TreeMap<String,String>());
  record.getMapField("constraint3").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint3").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint3").put("INSTANCE","localhost_12919");
  record.getMapField("constraint3").put("RESOURCE",".*");
  record.getMapField("constraint3").put("CONSTRAINT_VALUE","1");
  ConstraintItem constraint3=new ConstraintItem(record.getMapField("constraint3"));
  record.setMapField("constraint4",new TreeMap<String,String>());
  record.getMapField("constraint4").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint4").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint4").put("INSTANCE",".*");
  record.getMapField("constraint4").put("RESOURCE",".*");
  record.getMapField("constraint4").put("CONSTRAINT_VALUE","10");
  ConstraintItem constraint4=new ConstraintItem(record.getMapField("constraint4"));
  record.setMapField("constraint5",new TreeMap<String,String>());
  record.getMapField("constraint5").put("MESSAGE_TYPE","STATE_TRANSITION");
  record.getMapField("constraint5").put("TRANSITION","OFFLINE-SLAVE");
  record.getMapField("constraint5").put("INSTANCE","localhost_12918");
  record.getMapField("constraint5").put("RESOURCE","TestDB");
  record.getMapField("constraint5").put("CONSTRAINT_VALUE","5");
  ConstraintItem constraint5=new ConstraintItem(record.getMapField("constraint5"));
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString()),new ClusterConstraints(record));
  record=accessor.getProperty(keyBuilder.constraint(ConstraintType.MESSAGE_CONSTRAINT.toString())).getRecord();
  ClusterConstraints constraint=new ClusterConstraints(record);
  Message msg1=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-001"),"OFFLINE","SLAVE","TestDB","localhost_12918");
  Map<ConstraintAttribute,String> msgAttr=ClusterConstraints.toConstraintAttributes(msg1);
  Set<ConstraintItem> matches=constraint.match(msgAttr);
  System.out.println(msg1 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Assert.assertTrue(contains(matches,constraint4));
  Assert.assertTrue(contains(matches,constraint5));
  Message msg2=HelixTestUtil.newMessage(MessageType.STATE_TRANSITION,MessageId.from("msgId-002"),"OFFLINE","SLAVE","TestDB","localhost_12919");
  msgAttr=ClusterConstraints.toConstraintAttributes(msg2);
  matches=constraint.match(msgAttr);
  System.out.println(msg2 + " matches(" + matches.size()+ "): "+ matches);
  Assert.assertEquals(matches.size(),5);
  Assert.assertTrue(contains(matches,constraint0));
  Assert.assertTrue(contains(matches,constraint1));
  Assert.assertTrue(contains(matches,constraint2));
  Assert.assertTrue(contains(matches,constraint3));
  Assert.assertTrue(contains(matches,constraint4));
  System.out.println("END testMsgConstraint() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.TestIdealState </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testReplicas(){
  IdealState idealState=new IdealState("test-db");
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  idealState.setNumPartitions(4);
  idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
  idealState.setReplicas("" + 2);
  List<String> preferenceList=new ArrayList<String>();
  preferenceList.add("node_0");
  idealState.getRecord().setListField("test-db_0",preferenceList);
  Assert.assertFalse(idealState.isValid(),"should fail since replicas not equals to preference-list size");
  preferenceList.add("node_1");
  idealState.getRecord().setListField("test-db_0",preferenceList);
  Assert.assertTrue(idealState.isValid(),"should pass since replicas equals to preference-list size");
}

</code></pre>

<br>
<pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetInstanceSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  IdealState idealState=new IdealState("idealState");
  idealState.getRecord().setListField("TestDB_0",Arrays.asList("node_1","node_2"));
  Map<String,String> instanceState=new HashMap<String,String>();
  instanceState.put("node_3","MASTER");
  instanceState.put("node_4","SLAVE");
  idealState.getRecord().setMapField("TestDB_1",instanceState);
  idealState.setRebalanceMode(RebalanceMode.SEMI_AUTO);
  Set<ParticipantId> instances=idealState.getParticipantSet(PartitionId.from("TestDB_0"));
  Assert.assertEquals(instances.size(),2,"Should contain node_1 and node_2");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_1")),"Should contain node_1 and node_2");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_2")),"Should contain node_1 and node_2");
  instances=idealState.getParticipantSet(PartitionId.from("TestDB_nonExist_auto"));
  Assert.assertEquals(instances,Collections.emptySet(),"Should get empty set");
  idealState.setRebalanceMode(RebalanceMode.CUSTOMIZED);
  instances=idealState.getParticipantSet(PartitionId.from("TestDB_1"));
  Assert.assertEquals(instances.size(),2,"Should contain node_3 and node_4");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_3")),"Should contain node_3 and node_4");
  Assert.assertTrue(instances.contains(ParticipantId.from("node_4")),"Should contain node_3 and node_4");
  instances=idealState.getParticipantSet(PartitionId.from("TestDB_nonExist_custom"));
  Assert.assertEquals(instances,Collections.emptySet(),"Should get empty set");
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.TestInstanceConfig </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNotCheckingHostPortExistence(){
  InstanceConfig config=new InstanceConfig("node_0");
  Assert.assertTrue(config.isValid(),"HELIX-65: should not check host/port existence for instance-config");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.model.TestStateModelValidity </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * The initial state should be able to reach all states, should fail validation otherwise
 */
@Test public void testUnreachableState(){
  StateModelDefinition stateModel=new StateModelDefinition.Builder("stateModel").initialState("OFFLINE").addState("OFFLINE").addState("MASTER").addState("SLAVE").addState("DROPPED").addTransition("OFFLINE","SLAVE").addTransition("SLAVE","OFFLINE").addTransition("OFFLINE","DROPPED").addTransition("MASTER","SLAVE").addTransition("MASTER","DROPPED").build();
  Assert.assertFalse(stateModel.isValid());
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * This is the example used on the website, so this must work
 */
@Test public void testBasic(){
  StateModelDefinition stateModel=new StateModelDefinition.Builder("MasterSlave").initialState("OFFLINE").addState("MASTER",1).addState("SLAVE",2).addState("OFFLINE").addState(HelixDefinedState.DROPPED.toString()).upperBound("MASTER",1).dynamicUpperBound("SLAVE","R").addTransition("SLAVE","MASTER",1).addTransition("OFFLINE","SLAVE",2).addTransition("MASTER","SLAVE",3).addTransition("SLAVE","OFFLINE",3).addTransition("OFFLINE",HelixDefinedState.DROPPED.toString()).build();
  Assert.assertTrue(stateModel.isValid());
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * The initial state should be added as a state, otherwise validation check should fail
 */
@Test public void testInitialStateIsNotState(){
  StateModelDefinition stateModel=new StateModelDefinition.Builder("stateModel").initialState("OFFLINE").addState("MASTER").addState("SLAVE").addState("DROPPED").addTransition("OFFLINE","SLAVE").addTransition("SLAVE","MASTER").addTransition("SLAVE","OFFLINE").addTransition("OFFLINE","DROPPED").addTransition("MASTER","SLAVE").build();
  Assert.assertFalse(stateModel.isValid());
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * SRC and DEST in a transition SRC-TEST must be valid states
 */
@Test public void testTransitionsWithInvalidStates(){
  StateModelDefinition stateModel=new StateModelDefinition.Builder("stateModel").initialState("OFFLINE").addState("OFFLINE").addState("MASTER").addState("SLAVE").addState("DROPPED").addTransition("OFFLINE","SLAVE").addTransition("SLAVE","MASTER").addTransition("SLAVE","OFFLINE").addTransition("OFFLINE","DROPPED").addTransition("MASTER","SLAVE").addTransition("OFFLINE","INVALID").build();
  Assert.assertFalse(stateModel.isValid());
  stateModel=new StateModelDefinition.Builder("stateModel").initialState("OFFLINE").addState("OFFLINE").addState("MASTER").addState("SLAVE").addState("DROPPED").addTransition("OFFLINE","SLAVE").addTransition("SLAVE","MASTER").addTransition("SLAVE","OFFLINE").addTransition("OFFLINE","DROPPED").addTransition("MASTER","SLAVE").addTransition("INVALID","MASTER").build();
  Assert.assertFalse(stateModel.isValid());
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * The validator should fail on any detected infinite loops
 */
@Test public void testLoopInStateModel(){
  ZNRecord record=new ZNRecord("MasterSlave");
  record.setSimpleField(StateModelDefinitionProperty.INITIAL_STATE.toString(),"OFFLINE");
  List<String> statePriorityList=Lists.newArrayList("ONE","TWO","THREE","OFFLINE","DROPPED","ERROR");
  record.setListField(StateModelDefinitionProperty.STATE_PRIORITY_LIST.toString(),statePriorityList);
  for (  String state : statePriorityList) {
    String key=state + ".meta";
    Map<String,String> metadata=new HashMap<String,String>();
    metadata.put("count","-1");
    record.setMapField(key,metadata);
  }
  for (  String state : statePriorityList) {
    String key=state + ".next";
    if (state.equals("ONE")) {
      Map<String,String> metadata=new HashMap<String,String>();
      metadata.put("THREE","TWO");
      metadata.put("TWO","TWO");
      metadata.put("OFFLINE","OFFLINE");
      metadata.put("DROPPED","DROPPED");
      record.setMapField(key,metadata);
    }
 else     if (state.equals("TWO")) {
      Map<String,String> metadata=new HashMap<String,String>();
      metadata.put("THREE","ONE");
      metadata.put("OFFLINE","OFFLINE");
      metadata.put("DROPPED","OFFLINE");
      record.setMapField(key,metadata);
    }
 else     if (state.equals("THREE")) {
      Map<String,String> metadata=new HashMap<String,String>();
      metadata.put("OFFLINE","OFFLINE");
      metadata.put("DROPPED","OFFLINE");
      record.setMapField(key,metadata);
    }
 else     if (state.equals("OFFLINE")) {
      Map<String,String> metadata=new HashMap<String,String>();
      metadata.put("ONE","ONE");
      metadata.put("TWO","TWO");
      metadata.put("THREE","THREE");
      metadata.put("DROPPED","DROPPED");
      record.setMapField(key,metadata);
    }
 else     if (state.equals("ERROR")) {
      Map<String,String> metadata=new HashMap<String,String>();
      metadata.put("OFFLINE","OFFLINE");
      record.setMapField(key,metadata);
    }
  }
  List<String> stateTransitionPriorityList=new ArrayList<String>();
  record.setListField(StateModelDefinitionProperty.STATE_TRANSITION_PRIORITYLIST.toString(),stateTransitionPriorityList);
  StateModelDefinition stateModel=new StateModelDefinition(record);
  Assert.assertFalse(stateModel.isValid());
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that Helix can catch when a state doesn't have a path to DROPPED
 */
@Test public void testNoPathToDropped(){
  StateModelDefinition stateModel=new StateModelDefinition.Builder("stateModel").initialState("OFFLINE").addState("OFFLINE").addState("MASTER").addState("SLAVE").addState("DROPPED").addTransition("OFFLINE","SLAVE").addTransition("SLAVE","MASTER").addTransition("SLAVE","OFFLINE").addTransition("OFFLINE","DROPPED").build();
  Assert.assertFalse(stateModel.isValid());
  stateModel=new StateModelDefinition.Builder("stateModel").initialState("OFFLINE").addState("OFFLINE").addState("MASTER").addState("SLAVE").addState("DROPPED").addTransition("OFFLINE","SLAVE").addTransition("SLAVE","MASTER").addTransition("SLAVE","OFFLINE").addTransition("OFFLINE","DROPPED").addTransition("MASTER","DROPPED").build();
  Assert.assertTrue(stateModel.isValid());
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that Helix responds negatively if DROPPED is not specified
 */
@Test public void testNoDroppedState(){
  StateModelDefinition stateModel=new StateModelDefinition.Builder("stateModel").initialState("OFFLINE").addState("OFFLINE").addState("MASTER").addState("SLAVE").addTransition("OFFLINE","SLAVE").addTransition("SLAVE","MASTER").addTransition("MASTER","SLAVE").addTransition("SLAVE","OFFLINE").build();
  Assert.assertFalse(stateModel.isValid());
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that state models that we know to be good pass validation
 */
@Test public void testValidModels(){
  StateModelDefinition masterSlave=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  Assert.assertTrue(masterSlave.isValid());
  StateModelDefinition leaderStandby=new StateModelDefinition(StateModelConfigGenerator.generateConfigForLeaderStandby());
  Assert.assertTrue(leaderStandby.isValid());
  StateModelDefinition onlineOffline=new StateModelDefinition(StateModelConfigGenerator.generateConfigForOnlineOffline());
  Assert.assertTrue(onlineOffline.isValid());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.TestParticipantMonitor </h4><pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testReportData() throws InstanceNotFoundException, MalformedObjectNameException, NullPointerException, IOException, InterruptedException {
  System.out.println("START TestParticipantMonitor");
  ParticipantMonitor monitor=new ParticipantMonitor();
  int monitorNum=0;
  StateTransitionContext cxt=new StateTransitionContext("cluster","instance","db_1","a-b");
  StateTransitionDataPoint data=new StateTransitionDataPoint(1000,1000,true);
  monitor.reportTransitionStat(cxt,data);
  data=new StateTransitionDataPoint(1000,1200,true);
  monitor.reportTransitionStat(cxt,data);
  ParticipantMonitorListener monitorListener=new ParticipantMonitorListener("CLMParticipantReport");
  Thread.sleep(1000);
  AssertJUnit.assertTrue(monitorListener._beanValueMap.size() == monitorNum + 1);
  data=new StateTransitionDataPoint(1000,500,true);
  monitor.reportTransitionStat(cxt,data);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(monitorListener._beanValueMap.size() == monitorNum + 1);
  data=new StateTransitionDataPoint(1000,500,true);
  StateTransitionContext cxt2=new StateTransitionContext("cluster","instance","db_2","a-b");
  monitor.reportTransitionStat(cxt2,data);
  monitor.reportTransitionStat(cxt2,data);
  Thread.sleep(1000);
  AssertJUnit.assertTrue(monitorListener._beanValueMap.size() == monitorNum + 2);
  AssertJUnit.assertFalse(cxt.equals(cxt2));
  AssertJUnit.assertFalse(cxt.equals(new Object()));
  AssertJUnit.assertTrue(cxt.equals(new StateTransitionContext("cluster","instance","db_1","a-b")));
  cxt2.getInstanceName();
  ParticipantMonitorListener monitorListener2=new ParticipantMonitorListener("CLMParticipantReport");
  Thread.sleep(1000);
  AssertJUnit.assertEquals(monitorListener2._beanValueMap.size(),monitorNum + 2);
  monitorListener2.disconnect();
  monitorListener.disconnect();
  System.out.println("END TestParticipantMonitor");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.TestZKPathDataDumpTask </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCapacityReached() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=1;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,1,"MasterSlave",true);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  BaseDataAccessor<ZNRecord> baseAccessor=accessor.getBaseDataAccessor();
  HelixManager manager=mock(HelixManager.class);
  when(manager.getHelixDataAccessor()).thenReturn(accessor);
  when(manager.getClusterName()).thenReturn(clusterName);
  ZKPathDataDumpTask task=new ZKPathDataDumpTask(manager,Long.MAX_VALUE,Long.MAX_VALUE,1);
  task.run();
  PropertyKey controllerStatusUpdateKey=keyBuilder.controllerTaskStatuses();
  Assert.assertTrue(baseAccessor.exists(controllerStatusUpdateKey.getPath(),0));
  PropertyKey controllerErrorKey=keyBuilder.controllerTaskErrors();
  Assert.assertTrue(baseAccessor.exists(controllerErrorKey.getPath(),0));
  PropertyKey statusUpdateKey=keyBuilder.stateTransitionStatus("localhost_12918");
  Assert.assertTrue(baseAccessor.exists(statusUpdateKey.getPath(),0));
  PropertyKey errorKey=keyBuilder.stateTransitionErrors("localhost_12918");
  Assert.assertTrue(baseAccessor.exists(errorKey.getPath(),0));
  statusUpdateKey=keyBuilder.stateTransitionStatus("localhost_12918","session_0","TestDB0","TestDB0_0");
  accessor.setProperty(statusUpdateKey,new StatusUpdate(new ZNRecord("statusUpdate")));
  errorKey=keyBuilder.stateTransitionError("localhost_12918","session_0","TestDB0","TestDB0_0");
  accessor.setProperty(errorKey,new Error(new ZNRecord("error")));
  controllerStatusUpdateKey=keyBuilder.controllerTaskStatus("session_0","TestDB");
  accessor.setProperty(controllerStatusUpdateKey,new StatusUpdate(new ZNRecord("controllerStatusUpdate")));
  controllerErrorKey=keyBuilder.controllerTaskError("TestDB_error");
  accessor.setProperty(controllerErrorKey,new Error(new ZNRecord("controllerError")));
  task.run();
  Assert.assertTrue(baseAccessor.exists(controllerStatusUpdateKey.getPath(),0));
  Assert.assertTrue(baseAccessor.exists(controllerErrorKey.getPath(),0));
  Assert.assertTrue(baseAccessor.exists(statusUpdateKey.getPath(),0));
  Assert.assertTrue(baseAccessor.exists(errorKey.getPath(),0));
  statusUpdateKey=keyBuilder.stateTransitionStatus("localhost_12918","session_0","TestDB0","TestDB0_1");
  accessor.setProperty(statusUpdateKey,new StatusUpdate(new ZNRecord("statusUpdate")));
  errorKey=keyBuilder.stateTransitionError("localhost_12918","session_0","TestDB0","TestDB0_1");
  accessor.setProperty(errorKey,new Error(new ZNRecord("error")));
  controllerStatusUpdateKey=keyBuilder.controllerTaskStatus("session_0","TestDB1");
  accessor.setProperty(controllerStatusUpdateKey,new StatusUpdate(new ZNRecord("controllerStatusUpdate")));
  controllerErrorKey=keyBuilder.controllerTaskError("TestDB1_error");
  accessor.setProperty(controllerErrorKey,new Error(new ZNRecord("controllerError")));
  task.run();
  Assert.assertFalse(baseAccessor.exists(controllerStatusUpdateKey.getPath(),0));
  Assert.assertFalse(baseAccessor.exists(controllerErrorKey.getPath(),0));
  Assert.assertFalse(baseAccessor.exists(statusUpdateKey.getPath(),0));
  Assert.assertFalse(baseAccessor.exists(errorKey.getPath(),0));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=1;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,1,"MasterSlave",true);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  BaseDataAccessor<ZNRecord> baseAccessor=accessor.getBaseDataAccessor();
  HelixManager manager=mock(HelixManager.class);
  when(manager.getHelixDataAccessor()).thenReturn(accessor);
  when(manager.getClusterName()).thenReturn(clusterName);
  ZKPathDataDumpTask task=new ZKPathDataDumpTask(manager,0L,0L,Integer.MAX_VALUE);
  task.run();
  PropertyKey controllerStatusUpdateKey=keyBuilder.controllerTaskStatuses();
  Assert.assertTrue(baseAccessor.exists(controllerStatusUpdateKey.getPath(),0));
  PropertyKey controllerErrorKey=keyBuilder.controllerTaskErrors();
  Assert.assertTrue(baseAccessor.exists(controllerErrorKey.getPath(),0));
  PropertyKey statusUpdateKey=keyBuilder.stateTransitionStatus("localhost_12918");
  Assert.assertTrue(baseAccessor.exists(statusUpdateKey.getPath(),0));
  PropertyKey errorKey=keyBuilder.stateTransitionErrors("localhost_12918");
  statusUpdateKey=keyBuilder.stateTransitionStatus("localhost_12918","session_0","TestDB0","TestDB0_0");
  accessor.setProperty(statusUpdateKey,new StatusUpdate(new ZNRecord("statusUpdate")));
  errorKey=keyBuilder.stateTransitionError("localhost_12918","session_0","TestDB0","TestDB0_0");
  accessor.setProperty(errorKey,new Error(new ZNRecord("error")));
  controllerStatusUpdateKey=keyBuilder.controllerTaskStatus("session_0","TestDB");
  accessor.setProperty(controllerStatusUpdateKey,new StatusUpdate(new ZNRecord("controllerStatusUpdate")));
  controllerErrorKey=keyBuilder.controllerTaskError("TestDB_error");
  accessor.setProperty(controllerErrorKey,new Error(new ZNRecord("controllerError")));
  task.run();
  Assert.assertFalse(baseAccessor.exists(controllerStatusUpdateKey.getPath(),0));
  Assert.assertFalse(baseAccessor.exists(controllerErrorKey.getPath(),0));
  Assert.assertFalse(baseAccessor.exists(statusUpdateKey.getPath(),0));
  Assert.assertFalse(baseAccessor.exists(errorKey.getPath(),0));
  controllerStatusUpdateKey=keyBuilder.controllerTaskStatuses();
  Assert.assertTrue(baseAccessor.exists(controllerStatusUpdateKey.getPath(),0));
  controllerErrorKey=keyBuilder.controllerTaskErrors();
  Assert.assertTrue(baseAccessor.exists(controllerErrorKey.getPath(),0));
  statusUpdateKey=keyBuilder.stateTransitionStatus("localhost_12918");
  Assert.assertTrue(baseAccessor.exists(statusUpdateKey.getPath(),0));
  errorKey=keyBuilder.stateTransitionErrors("localhost_12918");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.mbeans.TestClusterStatusMonitor </h4><pre class="type-7 type-5 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testReportData() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  String testDB="TestDB";
  String testDB_0=testDB + "_0";
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ClusterStatusMonitor monitor=new ClusterStatusMonitor(clusterName);
  ObjectName clusterMonitorObjName=monitor.getObjectName(monitor.clusterBeanName());
  try {
    _server.getMBeanInfo(clusterMonitorObjName);
  }
 catch (  Exception e) {
    Assert.fail("Fail to register ClusterStatusMonitor");
  }
  BestPossibleStateOutput bestPossibleStates=new BestPossibleStateOutput();
  ResourceAssignment assignment=new ResourceAssignment(ResourceId.from(testDB));
  Map<ParticipantId,State> replicaMap=Maps.newHashMap();
  replicaMap.put(ParticipantId.from("localhost_12918"),State.from("MASTER"));
  replicaMap.put(ParticipantId.from("localhost_12919"),State.from("SLAVE"));
  replicaMap.put(ParticipantId.from("localhost_12920"),State.from("SLAVE"));
  replicaMap.put(ParticipantId.from("localhost_12921"),State.from("OFFLINE"));
  replicaMap.put(ParticipantId.from("localhost_12922"),State.from("DROPPED"));
  assignment.addReplicaMap(PartitionId.from(testDB_0),replicaMap);
  bestPossibleStates.setResourceAssignment(ResourceId.from(testDB),assignment);
  Map<String,InstanceConfig> instanceConfigMap=Maps.newHashMap();
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    InstanceConfig config=new InstanceConfig(instanceName);
    instanceConfigMap.put(instanceName,config);
  }
  Map<ResourceId,ResourceConfig> resourceMap=Maps.newHashMap();
  ResourceId resourceId=ResourceId.from(testDB);
  AutoModeISBuilder idealStateBuilder=new AutoModeISBuilder(resourceId).add(testDB_0);
  idealStateBuilder.setStateModel("MasterSlave");
  IdealState idealState=idealStateBuilder.build();
  ResourceConfig resourceConfig=new ResourceConfig.Builder(resourceId).idealState(idealState).build();
  resourceMap.put(resourceId,resourceConfig);
  Map<String,StateModelDefinition> stateModelDefMap=Maps.newHashMap();
  StateModelDefinition msStateModelDef=new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave());
  stateModelDefMap.put("MasterSlave",msStateModelDef);
  monitor.setPerInstanceResourceStatus(bestPossibleStates,instanceConfigMap,resourceMap,stateModelDefMap);
  ObjectName objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12918",testDB));
  Object value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(1));
  value=_server.getAttribute(objName,"SensorName");
  Assert.assertTrue(value instanceof String);
  Assert.assertEquals((String)value,String.format("%s.%s.%s.%s.%s",ClusterStatusMonitor.PARTICIPANT_STATUS_KEY,clusterName,ClusterStatusMonitor.DEFAULT_TAG,"localhost_12918",testDB));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12919",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(1));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12921",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(0));
  objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12922",testDB));
  value=_server.getAttribute(objName,"PartitionGauge");
  Assert.assertTrue(value instanceof Long);
  Assert.assertEquals((Long)value,new Long(0));
  replicaMap.remove(ParticipantId.from("localhost_12918"));
  assignment.addReplicaMap(PartitionId.from(testDB_0),replicaMap);
  bestPossibleStates.setResourceAssignment(ResourceId.from(testDB),assignment);
  monitor.setPerInstanceResourceStatus(bestPossibleStates,instanceConfigMap,resourceMap,stateModelDefMap);
  try {
    objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12918",testDB));
    _server.getMBeanInfo(objName);
    Assert.fail("Fail to unregister PerInstanceResource mbean for localhost_12918");
  }
 catch (  InstanceNotFoundException e) {
  }
  monitor.reset();
  try {
    objName=monitor.getObjectName(monitor.getPerInstanceResourceBeanName("localhost_12920",testDB));
    _server.getMBeanInfo(objName);
    Assert.fail("Fail to unregister PerInstanceResource mbean for localhost_12920");
  }
 catch (  InstanceNotFoundException e) {
  }
  try {
    _server.getMBeanInfo(clusterMonitorObjName);
    Assert.fail("Fail to unregister ClusterStatusMonitor");
  }
 catch (  InstanceNotFoundException e) {
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.mbeans.TestDropResourceMetricsReset </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testBasic() throws Exception {
  final int NUM_PARTICIPANTS=4;
  final int NUM_PARTITIONS=64;
  final int NUM_REPLICAS=1;
  final String RESOURCE_NAME="TestDB0";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ParticipantMonitorListener listener=new ParticipantMonitorListener("ClusterStatus",clusterName,RESOURCE_NAME);
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  ClusterSetup setupTool=new ClusterSetup(_zkclient);
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    participants[i]=new MockParticipant(_zkaddr,clusterName,"localhost_" + (12918 + i));
    participants[i].syncStart();
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  boolean noTimeout=_registerLatch.await(30000,TimeUnit.MILLISECONDS);
  Assert.assertTrue(noTimeout);
  setupTool.dropResourceFromCluster(clusterName,RESOURCE_NAME);
  noTimeout=_unregisterLatch.await(30000,TimeUnit.MILLISECONDS);
  Assert.assertTrue(noTimeout);
  listener.disconnect();
  controller.syncStop();
  for (  MockParticipant participant : participants) {
    participant.syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.monitoring.mbeans.TestResetClusterMetrics </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure cluster status lifecycle is tied to controller leader status
 */
@Test public void testControllerDisconnect() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","Resource",1,1,1,1,"OnlineOffline",RebalanceMode.FULL_AUTO,true);
  MockParticipant participant=new MockParticipant(_zkaddr,clusterName,"localhost_12918");
  participant.syncStart();
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  Assert.assertTrue(metricsExist(clusterName,participant.getInstanceName()));
  controller.syncStop();
  Thread.sleep(1000);
  Assert.assertFalse(metricsExist(clusterName,participant.getInstanceName()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.resolver.TestZKHelixResolver </h4><pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResolution(){
  HelixMessageScope clusterScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).build();
  Set<HelixAddress> destinations=_resolver.getDestinations(clusterScope);
  Assert.assertNotNull(destinations);
  Set<InetSocketAddress> addresses=new HashSet<InetSocketAddress>();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertTrue(addresses.containsAll(_socketMap.values()),"Expected " + _socketMap.values() + ", found "+ addresses);
  HelixMessageScope resourceScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).build();
  destinations=_resolver.getDestinations(resourceScope);
  Assert.assertNotNull(destinations);
  addresses.clear();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertTrue(addresses.containsAll(_socketMap.values()),"Expected " + _socketMap.values() + ", found "+ addresses);
  HelixMessageScope partition0Scope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).partition(RESOURCE_NAME + "_0").build();
  destinations=_resolver.getDestinations(partition0Scope);
  Assert.assertNotNull(destinations);
  ExternalView externalView=_setupTool.getClusterManagementTool().getResourceExternalView(CLUSTER_NAME,RESOURCE_NAME);
  Set<String> instanceSet=externalView.getStateMap(RESOURCE_NAME + "_0").keySet();
  Set<InetSocketAddress> expectedSocketAddrs=Sets.newHashSet();
  for (  String instanceName : instanceSet) {
    expectedSocketAddrs.add(_socketMap.get(instanceName));
  }
  addresses.clear();
  for (  HelixAddress destination : destinations) {
    addresses.add(destination.getSocketAddress());
  }
  Assert.assertEquals(addresses,expectedSocketAddrs,"Expected " + expectedSocketAddrs + ", found "+ addresses);
  HelixMessageScope sourceInstanceScope=new HelixMessageScope.Builder().cluster(CLUSTER_NAME).resource(RESOURCE_NAME).partition(RESOURCE_NAME + "_0").sourceInstance(_participants[0].getInstanceName()).build();
  HelixAddress sourceAddress=_resolver.getSource(sourceInstanceScope);
  Assert.assertNotNull(sourceAddress);
  Assert.assertEquals(sourceAddress.getSocketAddress(),_socketMap.get(_participants[0].getInstanceName()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.TestJsonComparator </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(groups={"unitTest"}) public void testJsonComparator(){
  System.out.println("START TestJsonComparator at " + new Date(System.currentTimeMillis()));
  ZNRecord record=new ZNRecord("id1");
  PropertyJsonComparator<ZNRecord> comparator=new PropertyJsonComparator<ZNRecord>(ZNRecord.class);
  AssertJUnit.assertTrue(comparator.compare(null,null) == 0);
  AssertJUnit.assertTrue(comparator.compare(null,record) == -1);
  AssertJUnit.assertTrue(comparator.compare(record,null) == 1);
  System.out.println("END TestJsonComparator at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestAutoFallbackPropertyStore </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 20; i++) {
    if (i < 10) {
      String path=String.format("%s/%d",fallbackRoot,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
 else {
      String path=String.format("%s/%d",root,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
    }
    paths.add(path);
  }
  List<String> childs=store.getChildNames("/",0);
  Assert.assertNotNull(childs);
  Assert.assertEquals(childs.size(),20);
  for (int i=0; i < 20; i++) {
    String child=childs.get(i);
    Assert.assertTrue(childs.contains(child));
  }
  List<ZNRecord> records=store.getChildren("/",null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    Assert.assertNotNull(record);
    String id=record.getId();
    Assert.assertTrue(childs.contains(id));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test void testMultiGetOnFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertTrue(exists[i]);
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertNotNull(stats[i]);
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),10);
  for (int i=0; i < 10; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNull(record.getSimpleField("key"));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key"));
    Assert.assertEquals(record.getSimpleField("key"),"value");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleUpdateUsingFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean succeed=store.update(path,new MyDataUpdater("new0"),AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNull(record.getSimpleField("key"));
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNotNull(record.getSimpleField("key"));
  Assert.assertEquals(record.getSimpleField("key"),"value");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingNewath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    path=String.format("%s/%d",root,i);
    baseAccessor.create(path,new ZNRecord("new" + i),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    if (i < 10) {
      ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),"" + i);
      Assert.assertNull(record.getSimpleField("key"));
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    ZNRecord record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
    if (i < 10) {
      Assert.assertNotNull(record.getSimpleField("key"));
      Assert.assertEquals(record.getSimpleField("key"),"value");
    }
 else {
      Assert.assertNull(record.getSimpleField("key"));
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    ZNRecord record=new ZNRecord("new" + i);
    records.add(record);
  }
  boolean succeed[]=store.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=String.format("/%d",i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  ZNRecord record=new ZNRecord("new0");
  boolean succeed=store.set(path,record,AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"new0");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailOnMultiGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertTrue(exists[i]);
    }
 else {
      Assert.assertFalse(exists[i]);
    }
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertNotNull(stats[i]);
    }
 else {
      Assert.assertNull(stats[i]);
    }
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    if (i < 10) {
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),Integer.toString(i));
    }
 else {
      Assert.assertNull(record);
    }
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailOnSingleGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
  boolean exist=store.exists(path,0);
  Assert.assertFalse(exist);
  Stat stat=store.getStat(path,0);
  Assert.assertNull(stat);
  ZNRecord record=store.get(path,null,0);
  Assert.assertNull(record);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleUpdateUsingNewPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",root,i);
    baseAccessor.create(path,new ZNRecord("new" + i),AccessOption.PERSISTENT);
    path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean succeed=store.update(path,new MyDataUpdater("0"),AccessOption.PERSISTENT);
  Assert.assertTrue(succeed);
  ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertNull(record.getSimpleField("key"));
  record=baseAccessor.get(String.format("%s%s",root,path),null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"new0");
  Assert.assertNotNull(record.getSimpleField("key"));
  Assert.assertEquals(record.getSimpleField("key"),"value");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSingleGetOnFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 1; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  String path=String.format("/%d",0);
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
  Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
  boolean exist=store.exists(path,0);
  Assert.assertTrue(exist);
  Stat stat=store.getStat(path,0);
  Assert.assertNotNull(stat);
  ZNRecord record=store.get(path,null,0);
  Assert.assertNotNull(record);
  Assert.assertEquals(record.getId(),"0");
  Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestZkHelixPropertyStore </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testLocalTriggeredCallback() throws Exception {
  System.out.println("START testLocalTriggeredCallback() at " + new Date(System.currentTimeMillis()));
  String subRoot=_root + "/" + "localCallback";
  List<String> subscribedPaths=new ArrayList<String>();
  subscribedPaths.add(subRoot);
  ZkHelixPropertyStore<ZNRecord> store=new ZkHelixPropertyStore<ZNRecord>(new ZkBaseDataAccessor<ZNRecord>(_zkclient),subRoot,subscribedPaths);
  TestListener listener=new TestListener();
  store.subscribe("/",listener);
  listener.reset();
  setNodes(store,'a',true);
  Thread.sleep(500);
  int expectCreateNodes=1 + firstLevelNr + firstLevelNr * secondLevelNr;
  System.out.println("createKey#:" + listener._createKeys.size() + ", changeKey#:"+ listener._changeKeys.size()+ ", deleteKey#:"+ listener._deleteKeys.size());
  Assert.assertTrue(listener._createKeys.size() == expectCreateNodes,"Should receive " + expectCreateNodes + " create callbacks");
  listener.reset();
  setNodes(store,'b',true);
  Thread.sleep(500);
  int expectChangeNodes=firstLevelNr * secondLevelNr;
  System.out.println("createKey#:" + listener._createKeys.size() + ", changeKey#:"+ listener._changeKeys.size()+ ", deleteKey#:"+ listener._deleteKeys.size());
  Assert.assertTrue(listener._changeKeys.size() >= expectChangeNodes,"Should receive at least " + expectChangeNodes + " change callbacks");
  listener.reset();
  int expectDeleteNodes=1 + firstLevelNr + firstLevelNr * secondLevelNr;
  store.remove("/",0);
  for (int i=0; i < 10; i++) {
    if (listener._deleteKeys.size() == expectDeleteNodes)     break;
    Thread.sleep(500);
  }
  System.out.println("createKey#:" + listener._createKeys.size() + ", changeKey#:"+ listener._changeKeys.size()+ ", deleteKey#:"+ listener._deleteKeys.size());
  Assert.assertTrue(listener._deleteKeys.size() == expectDeleteNodes,"Should receive " + expectDeleteNodes + " delete callbacks");
  store.stop();
  System.out.println("END testLocalTriggeredCallback() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet(){
  System.out.println("START testSet() at " + new Date(System.currentTimeMillis()));
  String subRoot=_root + "/" + "set";
  List<String> subscribedPaths=new ArrayList<String>();
  subscribedPaths.add(subRoot);
  ZkHelixPropertyStore<ZNRecord> store=new ZkHelixPropertyStore<ZNRecord>(new ZkBaseDataAccessor<ZNRecord>(_zkclient),subRoot,subscribedPaths);
  setNodes(store,'a',false);
  for (int i=0; i < 10; i++) {
    for (int j=0; j < 10; j++) {
      String nodeId=getNodeId(i,j);
      String key=getSecondLevelKey(i,j);
      ZNRecord record=store.get(key,null,0);
      Assert.assertEquals(record.getId(),nodeId);
    }
  }
  long startT=System.currentTimeMillis();
  for (int i=0; i < 1000; i++) {
    ZNRecord record=store.get("/node_0/childNode_0_0",null,0);
    Assert.assertNotNull(record);
  }
  long endT=System.currentTimeMillis();
  System.out.println("1000 Get() time used: " + (endT - startT) + "ms");
  long latency=endT - startT;
  Assert.assertTrue(latency < 200,"1000 Gets should be finished within 200ms, but was " + latency + " ms");
  store.stop();
  System.out.println("END testSet() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testZkTriggeredCallback() throws Exception {
  System.out.println("START testZkTriggeredCallback() at " + new Date(System.currentTimeMillis()));
  String subRoot=_root + "/" + "zkCallback";
  List<String> subscribedPaths=Arrays.asList(subRoot);
  ZkHelixPropertyStore<ZNRecord> store=new ZkHelixPropertyStore<ZNRecord>(new ZkBaseDataAccessor<ZNRecord>(_zkclient),subRoot,subscribedPaths);
  TestListener listener=new TestListener();
  store.subscribe("/",listener);
  listener.reset();
  setNodes(_zkclient,subRoot,'a',true);
  int expectCreateNodes=1 + firstLevelNr + firstLevelNr * secondLevelNr;
  Thread.sleep(500);
  System.out.println("createKey#:" + listener._createKeys.size() + ", changeKey#:"+ listener._changeKeys.size()+ ", deleteKey#:"+ listener._deleteKeys.size());
  Assert.assertTrue(listener._createKeys.size() == expectCreateNodes,"Should receive " + expectCreateNodes + " create callbacks");
  listener.reset();
  setNodes(_zkclient,subRoot,'b',true);
  int expectChangeNodes=firstLevelNr * secondLevelNr;
  for (int i=0; i < 10; i++) {
    if (listener._changeKeys.size() >= expectChangeNodes)     break;
    Thread.sleep(500);
  }
  System.out.println("createKey#:" + listener._createKeys.size() + ", changeKey#:"+ listener._changeKeys.size()+ ", deleteKey#:"+ listener._deleteKeys.size());
  Assert.assertTrue(listener._changeKeys.size() >= expectChangeNodes,"Should receive at least " + expectChangeNodes + " change callbacks");
  listener.reset();
  int expectDeleteNodes=1 + firstLevelNr + firstLevelNr * secondLevelNr;
  _zkclient.deleteRecursive(subRoot);
  Thread.sleep(1000);
  System.out.println("createKey#:" + listener._createKeys.size() + ", changeKey#:"+ listener._changeKeys.size()+ ", deleteKey#:"+ listener._deleteKeys.size());
  Assert.assertTrue(listener._deleteKeys.size() == expectDeleteNodes,"Should receive " + expectDeleteNodes + " delete callbacks");
  store.stop();
  System.out.println("END testZkTriggeredCallback() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.task.TaskStateModelFactoryTest </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCreateAndShutdownTaskStateModels(){
  Map<String,TaskFactory> taskFactoryMap=Maps.newHashMap();
  taskFactoryMap.put("Test",new TestTaskFactory());
  TaskStateModelFactory taskStateModelFactory=new TaskStateModelFactory(new Mocks.MockManager(),taskFactoryMap);
  List<TaskStateModel> taskStateModelList=Lists.newArrayList();
  for (int i=0; i < 3; i++) {
    ResourceId resourceId=ResourceId.from("Task_" + i);
    taskStateModelList.add(taskStateModelFactory.createStateTransitionHandler(resourceId,PartitionId.from(resourceId,"")));
  }
  taskStateModelFactory.shutdown();
  for (  TaskStateModel taskStateModel : taskStateModelList) {
    Assert.assertTrue(taskStateModel.isShutdown());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestClusterSetup </h4><pre class="type-5 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDropInstance() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  Builder keyBuilder=new Builder(clusterName);
  LiveInstance liveInstance=new LiveInstance("localhost_12918");
  liveInstance.setSessionId("session_0");
  liveInstance.setHelixVersion("version_0");
  accessor.setProperty(keyBuilder.liveInstance("localhost_12918"),liveInstance);
  try {
    ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropNode",clusterName,"localhost:12918"});
    Assert.fail("Should throw exception since localhost_12918 is still in LIVEINSTANCES/");
  }
 catch (  Exception e) {
  }
  accessor.removeProperty(keyBuilder.liveInstance("localhost_12918"));
  try {
    ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropNode",clusterName,"localhost:12918"});
    Assert.fail("Should throw exception since localhost_12918 is enabled");
  }
 catch (  Exception e) {
  }
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--enableInstance",clusterName,"localhost_12918","false"});
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropNode",clusterName,"localhost:12918"});
  Assert.assertNull(accessor.getProperty(keyBuilder.instanceConfig("localhost_12918")),"Instance config should be dropped");
  Assert.assertFalse(_zkclient.exists(PropertyPathConfig.getPath(PropertyType.INSTANCES,clusterName,"localhost_12918")),"Instance/host should be dropped");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testDisableDropInstancesFromCluster() throws Exception {
  testAddInstancesToCluster();
  String instanceAddresses[]=new String[3];
  for (int i=0; i < 3; i++) {
    String currInstance=INSTANCE_PREFIX + i;
    instanceAddresses[i]=currInstance;
  }
  String nextInstanceAddress=INSTANCE_PREFIX + 3;
  boolean caughtException=false;
  try {
    _setupTool.dropInstanceFromCluster(CLUSTER_NAME,nextInstanceAddress);
  }
 catch (  HelixException e) {
    caughtException=true;
  }
  AssertJUnit.assertTrue(caughtException);
  _setupTool.getClusterManagementTool().enableInstance(CLUSTER_NAME,nextInstanceAddress,false);
  verifyEnabled(_zkclient,CLUSTER_NAME,nextInstanceAddress,false);
  _setupTool.dropInstanceFromCluster(CLUSTER_NAME,nextInstanceAddress);
  verifyInstance(_zkclient,CLUSTER_NAME,nextInstanceAddress,false);
  caughtException=false;
  try {
    _setupTool.dropInstanceFromCluster(CLUSTER_NAME,nextInstanceAddress);
  }
 catch (  HelixException e) {
    caughtException=true;
  }
  AssertJUnit.assertTrue(caughtException);
  String badFormatInstance="badinstance";
  caughtException=false;
  try {
    _setupTool.getClusterManagementTool().enableInstance(CLUSTER_NAME,badFormatInstance,false);
  }
 catch (  HelixException e) {
    caughtException=true;
  }
  AssertJUnit.assertTrue(caughtException);
  caughtException=false;
  try {
    _setupTool.dropInstanceFromCluster(CLUSTER_NAME,badFormatInstance);
  }
 catch (  HelixException e) {
    caughtException=true;
  }
  AssertJUnit.assertTrue(caughtException);
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testZkAdminTimeout(){
  boolean exceptionThrown=false;
  try {
    new ZKHelixAdmin("localhost:27999");
  }
 catch (  Exception e) {
    exceptionThrown=true;
  }
  Assert.assertTrue(exceptionThrown);
  System.setProperty(ZKHelixAdmin.CONNECTION_TIMEOUT,"3");
  exceptionThrown=false;
  long time=System.currentTimeMillis();
  try {
    new ZKHelixAdmin("localhost:27999");
  }
 catch (  Exception e) {
    exceptionThrown=true;
  }
  Assert.assertTrue(exceptionThrown);
  Assert.assertTrue(System.currentTimeMillis() - time < 5000);
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test() public void testAddInstancesToCluster() throws Exception {
  String instanceAddresses[]=new String[3];
  for (int i=0; i < 3; i++) {
    String currInstance=INSTANCE_PREFIX + i;
    instanceAddresses[i]=currInstance;
  }
  String nextInstanceAddress=INSTANCE_PREFIX + 3;
  _setupTool.addInstancesToCluster(CLUSTER_NAME,instanceAddresses);
  for (  String instance : instanceAddresses) {
    verifyInstance(_zkclient,CLUSTER_NAME,instance,true);
  }
  _setupTool.addInstanceToCluster(CLUSTER_NAME,nextInstanceAddress);
  verifyInstance(_zkclient,CLUSTER_NAME,nextInstanceAddress,true);
  boolean caughtException=false;
  try {
    _setupTool.addInstanceToCluster(CLUSTER_NAME,nextInstanceAddress);
  }
 catch (  HelixException e) {
    caughtException=true;
  }
  AssertJUnit.assertTrue(caughtException);
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testEnableCluster() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--enableCluster",clusterName,"false"});
  Builder keyBuilder=new Builder(clusterName);
  boolean exists=_zkclient.exists(keyBuilder.pause().getPath());
  Assert.assertTrue(exists,"pause node under controller should be created");
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--enableCluster",clusterName,"true"});
  exists=_zkclient.exists(keyBuilder.pause().getPath());
  Assert.assertFalse(exists,"pause node under controller should be removed");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDisableResource() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--enableResource",clusterName,"TestDB0","false"});
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  Assert.assertFalse(idealState.isEnabled());
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--enableResource",clusterName,"TestDB0","true"});
  idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  Assert.assertTrue(idealState.isEnabled());
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestClusterStateVerifier </h4><pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testResourceSubset() throws InterruptedException {
  _admin.enableInstance(_clusterName,"localhost_12918",false);
  Thread.sleep(1000);
  _admin.enableCluster(_clusterName,false);
  Thread.sleep(1000);
  _admin.enableInstance(_clusterName,"localhost_12918",true);
  Thread.sleep(1000);
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,_clusterName,null,Sets.newHashSet(RESOURCES[1])));
  Assert.assertTrue(result);
  String[] args={"--zkSvr",_zkaddr,"--cluster",_clusterName,"--resources",RESOURCES[1]};
  result=ClusterStateVerifier.verifyState(args);
  Assert.assertTrue(result);
  boolean fullResult=new BestPossAndExtViewZkVerifier(_zkaddr,_clusterName).verify();
  Assert.assertFalse(fullResult);
  _admin.enableCluster(_clusterName,true);
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testEntireCluster(){
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,_clusterName));
  Assert.assertTrue(result);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestHelixAdminCli </h4><pre class="type-5 type-1 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeactivateCluster() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  String grandClusterName=clusterName + "_grand";
  final int n=6;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  MockMultiClusterController[] controllers=new MockMultiClusterController[2];
  setupCluster(clusterName,grandClusterName,n,participants,controllers);
  String command="-zkSvr " + _zkaddr + " -activateCluster "+ clusterName+ " "+ grandClusterName+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Thread.sleep(500);
  command="-zkSvr " + _zkaddr + " -activateCluster "+ clusterName+ " "+ grandClusterName+ " false";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  String path=accessor.keyBuilder().controllerLeader().getPath();
  for (int i=0; i < 10; i++) {
    Thread.sleep(1000);
    if (!_zkclient.exists(path)) {
      break;
    }
  }
  Assert.assertFalse(_zkclient.exists(path),"leader should be gone after deactivate the cluster");
  command="-zkSvr " + _zkaddr + " -dropCluster "+ clusterName;
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("dropCluster should fail since there are still instances running");
  }
 catch (  Exception e) {
  }
  for (int i=0; i < participants.length; i++) {
    participants[i].syncStop();
  }
  command="-zkSvr localhost:2183 -dropCluster " + clusterName;
  ClusterSetup.processCommandLineArgs(command.split("\\s"));
  for (int i=0; i < controllers.length; i++) {
    controllers[i].syncStop();
  }
  command="-zkSvr localhost:2183 -dropCluster " + grandClusterName;
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceGroupTags() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String command="-zkSvr " + _zkaddr + " -addCluster "+ clusterName;
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr localhost:2183 -addResource " + clusterName + " db_11 12 MasterSlave";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  for (int i=0; i < 6; i++) {
    command="-zkSvr " + _zkaddr + " -addNode "+ clusterName+ " localhost:123"+ i;
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  for (int i=0; i < 2; i++) {
    command="-zkSvr " + _zkaddr + " -addInstanceTag "+ clusterName+ " localhost_123"+ i+ "  tag1";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  for (int i=2; i < 6; i++) {
    command="-zkSvr " + _zkaddr + " -addInstanceTag "+ clusterName+ " localhost_123"+ i+ "  tag2";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 2 -instanceGroupTag tag1";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  IdealState dbIs=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  Set<ParticipantId> hosts=new HashSet<ParticipantId>();
  for (  PartitionId p : dbIs.getPartitionIdSet()) {
    for (    ParticipantId participantId : dbIs.getParticipantStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(participantId.stringify()));
      Assert.assertTrue(config.containsTag("tag1"));
      hosts.add(participantId);
    }
  }
  Assert.assertEquals(hosts.size(),2);
  command="-zkSvr " + _zkaddr + " -dropResource "+ clusterName+ " db_11 ";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -addResource "+ clusterName+ " db_11 48 MasterSlave";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 3 -instanceGroupTag tag2";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  dbIs=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  hosts=new HashSet<ParticipantId>();
  for (  PartitionId p : dbIs.getPartitionIdSet()) {
    for (    ParticipantId participantId : dbIs.getParticipantStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(participantId.stringify()));
      Assert.assertTrue(config.containsTag("tag2"));
      hosts.add(participantId);
    }
  }
  Assert.assertEquals(hosts.size(),4);
  command="-zkSvr " + _zkaddr + " -dropResource "+ clusterName+ " db_11 ";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  for (int i=3; i <= 3; i++) {
    command="-zkSvr " + _zkaddr + " -removeInstanceTag "+ clusterName+ " localhost_123"+ i+ " tag2";
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  }
  command="-zkSvr " + _zkaddr + " -addResource "+ clusterName+ " db_11 48 MasterSlave";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 3 -instanceGroupTag tag2";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  dbIs=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  hosts=new HashSet<ParticipantId>();
  for (  PartitionId p : dbIs.getPartitionIdSet()) {
    for (    ParticipantId participantId : dbIs.getParticipantStateMap(p).keySet()) {
      InstanceConfig config=accessor.getProperty(accessor.keyBuilder().instanceConfig(participantId.stringify()));
      Assert.assertTrue(config.containsTag("tag2"));
      hosts.add(participantId);
    }
  }
  Assert.assertEquals(hosts.size(),3);
  command="-zkSvr " + _zkaddr + " -rebalance "+ clusterName+ " db_11 2 -key alias";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStartCluster() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  String grandClusterName=clusterName + "_grand";
  final int n=6;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  MockMultiClusterController[] controllers=new MockMultiClusterController[2];
  setupCluster(clusterName,grandClusterName,n,participants,controllers);
  String command="-zkSvr localhost:2183 -activateCluster " + clusterName + " nonExistGrandCluster true";
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("add " + clusterName + " to grandCluster should fail since grandCluster doesn't exists");
  }
 catch (  Exception e) {
  }
  command="-zkSvr localhost:2183 -activateCluster nonExistCluster " + grandClusterName + " true";
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("add nonExistCluster to " + grandClusterName + " should fail since nonExistCluster doesn't exists");
  }
 catch (  Exception e) {
  }
  command="-zkSvr localhost:2183 -activateCluster " + clusterName + " "+ grandClusterName+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Thread.sleep(500);
  command="-zkSvr localhost:2183 -dropCluster " + clusterName;
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("drop " + clusterName + " should fail since it's still running");
  }
 catch (  Exception e) {
  }
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(grandClusterName,baseAccessor);
  LiveInstance controllerLeader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  Assert.assertNotNull(controllerLeader,"controllerLeader should be either controller_9000 or controller_9001");
  Assert.assertTrue(controllerLeader.getInstanceName().startsWith("controller_900"));
  accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  LiveInstance leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  for (int i=0; i < 20; i++) {
    if (leader != null) {
      break;
    }
    Thread.sleep(200);
    leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  }
  Assert.assertTrue(leader.getInstanceName().startsWith("controller_900"));
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  for (  MockMultiClusterController controller : controllers) {
    controller.syncStop();
  }
  for (int i=0; i < participants.length; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-5 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddCluster() throws Exception {
  String command="--zkSvr " + _zkaddr + " -addCluster clusterTest";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="--zkSvr " + _zkaddr + " -addCluster /ClusterTest";
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("ClusterSetup should fail since /ClusterTest is not a valid name");
  }
 catch (  Exception e) {
  }
  command="--zkSvr " + _zkaddr + " -addCluster \"Klazt3rz";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="--zkSvr " + _zkaddr + " -addCluster \\ClusterTest";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="--zkSvr " + _zkaddr + " -addCluster clusterTest";
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("ClusterSetup should fail since clusterTest already exists");
  }
 catch (  Exception e) {
  }
  Assert.assertTrue(ZKUtil.isClusterSetup("Klazt3rz",_zkclient));
  Assert.assertTrue(ZKUtil.isClusterSetup("clusterTest",_zkclient));
  Assert.assertTrue(ZKUtil.isClusterSetup("\\ClusterTest",_zkclient));
  command="-zkSvr localhost:2183 -dropCluster \\ClusterTest";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr localhost:2183 -dropCluster clusterTest1";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr localhost:2183 -dropCluster clusterTest";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Assert.assertFalse(_zkclient.exists("/clusterTest"));
  Assert.assertFalse(_zkclient.exists("/\\ClusterTest"));
  Assert.assertFalse(_zkclient.exists("/clusterTest1"));
}

</code></pre>

<br>
<pre class="type-5 type-1 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstanceOperations() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  String grandClusterName=clusterName + "_grand";
  final int n=6;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  MockMultiClusterController[] controllers=new MockMultiClusterController[2];
  setupCluster(clusterName,grandClusterName,n,participants,controllers);
  String command="-zkSvr " + _zkaddr + " -activateCluster "+ clusterName+ " "+ grandClusterName+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Thread.sleep(500);
  command="-zkSvr " + _zkaddr + " -dropNode "+ clusterName+ " localhost:1232";
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("dropNode should fail since the node is not disabled");
  }
 catch (  Exception e) {
  }
  command="-zkSvr " + _zkaddr + " -enableInstance "+ clusterName+ " localhost:1232 false";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -dropNode "+ clusterName+ " localhost:1232";
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("dropNode should fail since the node is not disconnected");
  }
 catch (  Exception e) {
  }
  command="-zkSvr " + _zkaddr + " -swapInstance "+ clusterName+ " localhost_1232 localhost_12320";
  try {
    ClusterSetup.processCommandLineArgs(command.split("\\s+"));
    Assert.fail("swapInstance should fail since the node is not disconnected");
  }
 catch (  Exception e) {
  }
  participants[2].syncStop();
  command="-zkSvr " + _zkaddr + " -addNode "+ clusterName+ " localhost:12320";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr " + _zkaddr + " -swapInstance "+ clusterName+ " localhost_1232 localhost_12320";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  String path=accessor.keyBuilder().instanceConfig("localhost_1232").getPath();
  Assert.assertFalse(_zkclient.exists(path),path + " should not exist since localhost_1232 has been swapped by localhost_12320");
  for (int i=0; i < controllers.length; i++) {
    controllers[i].syncStop();
  }
  for (int i=0; i < participants.length; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDropAddResource() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  String grandClusterName=clusterName + "_grand";
  final int n=6;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  MockMultiClusterController[] controllers=new MockMultiClusterController[2];
  setupCluster(clusterName,grandClusterName,n,participants,controllers);
  String command="-zkSvr " + _zkaddr + " -activateCluster "+ clusterName+ " "+ grandClusterName+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Thread.sleep(500);
  BaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,baseAccessor);
  IdealState idealState=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  ZNRecordJsonSerializer serializer=new ZNRecordJsonSerializer();
  String tmpDir=System.getProperty("java.io.tmpdir");
  if (tmpDir == null) {
    tmpDir="/tmp";
  }
  final String tmpIdealStateFile=tmpDir + "/" + clusterName+ "_idealState.log";
  FileWriter fos=new FileWriter(tmpIdealStateFile);
  PrintWriter pw=new PrintWriter(fos);
  pw.write(new String(serializer.serialize(idealState.getRecord())));
  pw.close();
  command="-zkSvr " + _zkaddr + " -dropResource "+ clusterName+ " db_11 ";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  command="-zkSvr " + _zkaddr + " -addIdealState "+ clusterName+ " db_11 "+ tmpIdealStateFile;
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  IdealState idealState2=accessor.getProperty(accessor.keyBuilder().idealStates("db_11"));
  Assert.assertTrue(idealState2.getRecord().equals(idealState.getRecord()));
  for (int i=0; i < controllers.length; i++) {
    controllers[i].syncStop();
  }
  for (int i=0; i < participants.length; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testExpandCluster() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  String grandClusterName=clusterName + "_grand";
  final int n=6;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  MockMultiClusterController[] controllers=new MockMultiClusterController[2];
  setupCluster(clusterName,grandClusterName,n,participants,controllers);
  String command="-zkSvr " + _zkaddr + " -activateCluster "+ clusterName+ " "+ grandClusterName+ " true";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  Thread.sleep(500);
  command="-zkSvr " + _zkaddr + " -addNode "+ clusterName+ " localhost:12331;localhost:12341;localhost:12351;localhost:12361";
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  command="-zkSvr localhost:2183 -expandCluster " + clusterName;
  ClusterSetup.processCommandLineArgs(command.split("\\s+"));
  MockParticipant[] newParticipants=new MockParticipant[4];
  for (int i=3; i <= 6; i++) {
    String instanceName="localhost_123" + i + "1";
    newParticipants[i - 3]=new MockParticipant(_zkaddr,clusterName,instanceName);
    newParticipants[i - 3].syncStart();
  }
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  for (int i=0; i < controllers.length; i++) {
    controllers[i].syncStop();
  }
  for (int i=0; i < participants.length; i++) {
    participants[i].syncStop();
  }
  for (int i=0; i < newParticipants.length; i++) {
    newParticipants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestZkCopy </h4><pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testSkipCopyExistZnode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String srcClusterName=testName + "_src";
  String dstClusterName=testName + "_dst";
  int n=5;
  TestHelper.setupCluster(srcClusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  TestHelper.setupEmptyCluster(_zkclient,dstClusterName);
  String fromPath=String.format("/%s/INSTANCES",srcClusterName);
  String toPath=String.format("/%s/INSTANCES",dstClusterName);
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  fromPath=String.format("/%s/CONFIGS/PARTICIPANT",srcClusterName);
  toPath=String.format("/%s/CONFIGS/PARTICIPANT",dstClusterName);
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    boolean ret=ZKUtil.isInstanceSetup(_zkclient,dstClusterName,instanceName,InstanceType.PARTICIPANT);
    Assert.assertTrue(ret);
  }
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String fromPath="/" + clusterName + "/from";
  _zkclient.createPersistent(fromPath,true);
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",fromPath,i,j);
      _zkclient.createPersistent(path,true);
      _zkclient.writeData(path,new ZNRecord(String.format("%d/%d",i,j)));
    }
  }
  String toPath="/" + clusterName + "/to";
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  Assert.assertTrue(_zkclient.exists(toPath));
  Assert.assertNull(_zkclient.readData(toPath));
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",toPath,i,j);
      Assert.assertTrue(_zkclient.exists(path));
      ZNRecord record=_zkclient.readData(path);
      Assert.assertEquals(String.format("%d/%d",i,j),record.getId());
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestDisableResource </h4><pre class="type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  String instanceUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups/"+ "TestDB0";
  Map<String,String> paramMap=new HashMap<String,String>();
  paramMap.put(JsonParameters.MANAGEMENT_COMMAND,ClusterSetup.enableResource);
  paramMap.put(JsonParameters.ENABLED,Boolean.toString(false));
  TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,false);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  Assert.assertFalse(idealState.isEnabled());
  paramMap.put(JsonParameters.ENABLED,Boolean.toString(true));
  TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,false);
  idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  Assert.assertTrue(idealState.isEnabled());
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestHelixAdminScenariosRest </h4><pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testStartCluster() throws Exception {
  final String clusterName="clusterTestStartCluster";
  final String controllerClusterName="controllerClusterTestStartCluster";
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  Map<String,MockMultiClusterController> multiClusterControllers=new HashMap<String,MockMultiClusterController>();
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",8);
  rebalanceResource(clusterName,"db_11");
  addCluster(controllerClusterName);
  addInstancesToCluster(controllerClusterName,"controller_900",2,null);
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  for (int i=0; i < 2; i++) {
    String controllerName="controller_900" + i;
    MockMultiClusterController multiClusterController=new MockMultiClusterController(_zkaddr,controllerClusterName,controllerName);
    multiClusterController.syncStart();
    multiClusterControllers.put(controllerName,multiClusterController);
  }
  Thread.sleep(100);
  String clusterUrl=getClusterUrl(clusterName);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd("nonExistCluster",true),true);
  clusterUrl=getClusterUrl("nonExistCluster");
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,true),true);
  clusterUrl=getClusterUrl(clusterName);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,true),false);
  Thread.sleep(500);
  deleteUrl(clusterUrl,true);
  HelixDataAccessor accessor=multiClusterControllers.get("controller_9001").getHelixDataAccessor();
  LiveInstance controllerLeader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  Assert.assertTrue(controllerLeader.getInstanceName().startsWith("controller_900"));
  accessor=participants.get("localhost_1232").getHelixDataAccessor();
  LiveInstance leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  for (int i=0; i < 5; i++) {
    if (leader != null) {
      break;
    }
    Thread.sleep(1000);
    leader=accessor.getProperty(accessor.keyBuilder().controllerLeader());
  }
  Assert.assertTrue(leader.getInstanceName().startsWith("controller_900"));
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  Thread.sleep(1000);
  for (  MockMultiClusterController controller : multiClusterControllers.values()) {
    controller.syncStop();
  }
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testGetInstances() throws IOException {
  final String clusterName="TestTagAwareness_testGetResources";
  final String[] TAGS={"tag1","tag2"};
  final String URL_BASE="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/instances";
  _setupTool.addCluster(clusterName,true);
  HelixAdmin admin=_setupTool.getClusterManagementTool();
  InstanceConfig instance1=new InstanceConfig("localhost_1");
  instance1.addTag(TAGS[0]);
  admin.addInstance(clusterName,instance1);
  InstanceConfig instance2=new InstanceConfig("localhost_2");
  instance2.addTag(TAGS[1]);
  admin.addInstance(clusterName,instance2);
  InstanceConfig instance3=new InstanceConfig("localhost_3");
  instance3.addTag(TAGS[0]);
  instance3.addTag(TAGS[1]);
  admin.addInstance(clusterName,instance3);
  InstanceConfig instance4=new InstanceConfig("localhost_4");
  admin.addInstance(clusterName,instance4);
  Reference resourceRef=new Reference(URL_BASE);
  Request request=new Request(Method.GET,resourceRef);
  Response response=_gClient.handle(request);
  ListInstancesWrapper responseWrapper=ClusterRepresentationUtil.JsonToObject(ListInstancesWrapper.class,response.getEntityAsText());
  Map<String,List<String>> tagInfo=responseWrapper.tagInfo;
  Assert.assertTrue(tagInfo.containsKey(TAGS[0]));
  Assert.assertTrue(tagInfo.containsKey(TAGS[1]));
  Assert.assertTrue(tagInfo.get(TAGS[0]).contains("localhost_1"));
  Assert.assertFalse(tagInfo.get(TAGS[0]).contains("localhost_2"));
  Assert.assertTrue(tagInfo.get(TAGS[0]).contains("localhost_3"));
  Assert.assertFalse(tagInfo.get(TAGS[0]).contains("localhost_4"));
  Assert.assertFalse(tagInfo.get(TAGS[1]).contains("localhost_1"));
  Assert.assertTrue(tagInfo.get(TAGS[1]).contains("localhost_2"));
  Assert.assertTrue(tagInfo.get(TAGS[1]).contains("localhost_3"));
  Assert.assertFalse(tagInfo.get(TAGS[1]).contains("localhost_4"));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testAddCluster() throws Exception {
  String url="http://localhost:" + ADMIN_PORT + "/clusters";
  String response=assertSuccessPostOperation(url,addClusterCmd("clusterTest"),false);
  Assert.assertTrue(response.contains("clusterTest"));
  response=assertSuccessPostOperation(url,addClusterCmd("/ClusterTest"),true);
  response=assertSuccessPostOperation(url,addClusterCmd("Klazt3rz"),false);
  Assert.assertTrue(response.contains("Klazt3rz"));
  response=assertSuccessPostOperation(url,addClusterCmd("\\ClusterTest"),false);
  Assert.assertTrue(response.contains("\\ClusterTest"));
  response=assertSuccessPostOperation(url,addClusterCmd("clusterTest"),true);
  Assert.assertTrue(ZKUtil.isClusterSetup("Klazt3rz",_zkclient));
  Assert.assertTrue(ZKUtil.isClusterSetup("clusterTest",_zkclient));
  Assert.assertTrue(ZKUtil.isClusterSetup("\\ClusterTest",_zkclient));
  String clusterUrl=getClusterUrl("\\ClusterTest");
  deleteUrl(clusterUrl,false);
  String clustersUrl="http://localhost:" + ADMIN_PORT + "/clusters";
  response=getUrl(clustersUrl);
  clusterUrl=getClusterUrl("clusterTest1");
  deleteUrl(clusterUrl,false);
  response=getUrl(clustersUrl);
  Assert.assertFalse(response.contains("clusterTest1"));
  clusterUrl=getClusterUrl("clusterTest");
  deleteUrl(clusterUrl,false);
  response=getUrl(clustersUrl);
  Assert.assertFalse(response.contains("clusterTest"));
  clusterUrl=getClusterUrl("clusterTestOK");
  deleteUrl(clusterUrl,false);
  Assert.assertFalse(_zkclient.exists("/clusterTest"));
  Assert.assertFalse(_zkclient.exists("/clusterTest1"));
  Assert.assertFalse(_zkclient.exists("/clusterTestOK"));
  response=assertSuccessPostOperation(url,addClusterCmd("clusterTest1"),false);
  response=getUrl(clustersUrl);
  Assert.assertTrue(response.contains("clusterTest1"));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testInstanceOperations() throws Exception {
  final String clusterName="clusterTestInstanceOperations";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",8);
  rebalanceResource(clusterName,"db_11");
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  HelixDataAccessor accessor;
  String instanceUrl=getInstanceUrl(clusterName,"localhost_1232");
  deleteUrl(instanceUrl,true);
  String response=assertSuccessPostOperation(instanceUrl,enableInstanceCmd(false),false);
  Assert.assertTrue(response.contains("false"));
  deleteUrl(instanceUrl,true);
  String instancesUrl=getClusterUrl(clusterName) + "/instances";
  response=assertSuccessPostOperation(instancesUrl,swapInstanceCmd("localhost_1232","localhost_12320"),true);
  participants.get("localhost_1232").syncStop();
  response=assertSuccessPostOperation(instancesUrl,addInstanceCmd("localhost_12320"),false);
  Assert.assertTrue(response.contains("localhost_12320"));
  response=assertSuccessPostOperation(instancesUrl,swapInstanceCmd("localhost_1232","localhost_12320"),false);
  Assert.assertTrue(response.contains("localhost_12320"));
  Assert.assertFalse(response.contains("localhost_1232\""));
  accessor=participants.get("localhost_1231").getHelixDataAccessor();
  String path=accessor.keyBuilder().instanceConfig("localhost_1232").getPath();
  Assert.assertFalse(_zkclient.exists(path));
  MockParticipant newParticipant=new MockParticipant(_zkaddr,clusterName,"localhost_12320");
  newParticipant.syncStart();
  participants.put("localhost_12320",newParticipant);
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEnablePartitions() throws IOException, InterruptedException {
  final String clusterName="clusterTestEnablePartitions";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",22);
  rebalanceResource(clusterName,"db_11");
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  HelixDataAccessor accessor=participants.get("localhost_1231").getHelixDataAccessor();
  String hostName="localhost_1231";
  String instanceUrl=getInstanceUrl(clusterName,hostName);
  ExternalView ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  String response=assertSuccessPostOperation(instanceUrl,enablePartitionCmd("db_11","db_11_0;db_11_11",false),false);
  Assert.assertTrue(response.contains("DISABLED_PARTITION"));
  Assert.assertTrue(response.contains("db_11_0"));
  Assert.assertTrue(response.contains("db_11_11"));
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  Assert.assertEquals(ev.getStateMap("db_11_0").get(hostName),"OFFLINE");
  Assert.assertEquals(ev.getStateMap("db_11_11").get(hostName),"OFFLINE");
  response=assertSuccessPostOperation(instanceUrl,enablePartitionCmd("db_11","db_11_0;db_11_11",true),false);
  Assert.assertFalse(response.contains("db_11_0"));
  Assert.assertFalse(response.contains("db_11_11"));
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ev=accessor.getProperty(accessor.keyBuilder().externalView("db_11"));
  Assert.assertEquals(ev.getStateMap("db_11_0").get(hostName),"MASTER");
  Assert.assertEquals(ev.getStateMap("db_11_11").get(hostName),"SLAVE");
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResources() throws IOException {
  final String clusterName="TestTagAwareness_testGetResources";
  final String TAG="tag";
  final String URL_BASE="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  _setupTool.addCluster(clusterName,true);
  HelixAdmin admin=_setupTool.getClusterManagementTool();
  IdealState taggedResource=new IdealState("taggedResource");
  taggedResource.setInstanceGroupTag(TAG);
  taggedResource.setStateModelDefRef("OnlineOffline");
  admin.addResource(clusterName,taggedResource.getId(),taggedResource);
  IdealState untaggedResource=new IdealState("untaggedResource");
  untaggedResource.setStateModelDefRef("OnlineOffline");
  admin.addResource(clusterName,untaggedResource.getId(),untaggedResource);
  Reference resourceRef=new Reference(URL_BASE);
  Request request=new Request(Method.GET,resourceRef);
  Response response=_gClient.handle(request);
  ZNRecord responseRecord=ClusterRepresentationUtil.JsonToObject(ZNRecord.class,response.getEntityAsText());
  Assert.assertNotNull(responseRecord.getMapField("ResourceTags"));
  Assert.assertEquals(TAG,responseRecord.getMapField("ResourceTags").get(taggedResource.getId()));
  Assert.assertFalse(responseRecord.getMapField("ResourceTags").containsKey(untaggedResource.getId()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testAddInstance() throws Exception {
  final String clusterName="clusterTestAddInstance";
  addCluster(clusterName);
  String clusterUrl=getClusterUrl(clusterName);
  String instancesUrl=clusterUrl + "/instances";
  addInstancesToCluster(clusterName,"localhost:123",3,null);
  String instances="localhost:1233;localhost:1234;localhost:1235;localhost:1236";
  String response=assertSuccessPostOperation(instancesUrl,addInstanceCmd(instances),false);
  for (int i=3; i <= 6; i++) {
    Assert.assertTrue(response.contains("localhost_123" + i));
  }
  String instanceUrl=instancesUrl + "/localhost_1236";
  deleteUrl(instanceUrl,true);
  response=getUrl(instancesUrl);
  Assert.assertTrue(response.contains("localhost_1236"));
  instanceUrl=instancesUrl + "/localhost_12367";
  deleteUrl(instanceUrl,true);
  response=getUrl(instancesUrl);
  Assert.assertFalse(response.contains("localhost_12367"));
  instanceUrl=instancesUrl + "/localhost_1236";
  response=assertSuccessPostOperation(instanceUrl,enableInstanceCmd(false),false);
  Assert.assertTrue(response.contains("false"));
  deleteUrl(instanceUrl,false);
  final String controllerClusterName="controllerClusterTestAddInstance";
  addCluster(controllerClusterName);
  String controllers="controller:9000;controller:9001";
  String controllerUrl=getClusterUrl(controllerClusterName) + "/instances";
  response=assertSuccessPostOperation(controllerUrl,addInstanceCmd(controllers),false);
  Assert.assertTrue(response.contains("controller_9000"));
  Assert.assertTrue(response.contains("controller_9001"));
  response=assertSuccessPostOperation(instancesUrl,addInstanceCmd("localhost:1234"),true);
  for (int i=0; i < 4; i++) {
    instanceUrl=instancesUrl + "/localhost_123" + i;
    response=assertSuccessPostOperation(instanceUrl,addInstanceTagCmd(_tag1),false);
    Assert.assertTrue(response.contains(_tag1));
  }
  instanceUrl=instancesUrl + "/localhost_1233";
  response=assertSuccessPostOperation(instanceUrl,removeInstanceTagCmd(_tag1),false);
  Assert.assertFalse(response.contains(_tag1));
}

</code></pre>

<br>
<pre class="type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDeactivateCluster() throws Exception {
  final String clusterName="clusterTestDeactivateCluster";
  final String controllerClusterName="controllerClusterTestDeactivateCluster";
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  Map<String,MockMultiClusterController> multiClusterControllers=new HashMap<String,MockMultiClusterController>();
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",16);
  rebalanceResource(clusterName,"db_11");
  addCluster(controllerClusterName);
  addInstancesToCluster(controllerClusterName,"controller_900",2,null);
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  for (int i=0; i < 2; i++) {
    String controllerName="controller_900" + i;
    MockMultiClusterController multiClusterController=new MockMultiClusterController(_zkaddr,controllerClusterName,controllerName);
    multiClusterController.syncStart();
    multiClusterControllers.put(controllerName,multiClusterController);
  }
  String clusterUrl=getClusterUrl(clusterName);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,true),false);
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  assertSuccessPostOperation(clusterUrl,activateClusterCmd(controllerClusterName,false),false);
  Thread.sleep(6000);
  Assert.assertFalse(_zkclient.exists("/" + controllerClusterName + "/IDEALSTATES/"+ clusterName));
  HelixDataAccessor accessor=participants.get("localhost_1231").getHelixDataAccessor();
  String path=accessor.keyBuilder().controllerLeader().getPath();
  Assert.assertFalse(_zkclient.exists(path));
  deleteUrl(clusterUrl,true);
  Assert.assertTrue(_zkclient.exists("/" + clusterName));
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
  deleteUrl(clusterUrl,false);
  Assert.assertFalse(_zkclient.exists("/" + clusterName));
  for (  MockMultiClusterController controller : multiClusterControllers.values()) {
    controller.syncStop();
  }
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRebalanceResource() throws Exception {
  final String clusterName="clusterTestRebalanceResource";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",3,_tag1);
  addResource(clusterName,"db_11",44);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  String idealStateUrl=resourceUrl + "/idealState";
  String response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  ZNRecord record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  deleteUrl(resourceUrl,false);
  final String reourcesUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  response=getUrl(reourcesUrl);
  Assert.assertFalse(response.contains("db_11"));
  addResource(clusterName,"db_11",48);
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  addResource(clusterName,"db_22",55);
  resourceUrl=getResourceUrl(clusterName,"db_22");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_22"));
  Assert.assertEquals(record.getListField("alias_0").size(),2);
  Assert.assertEquals(record.getMapField("alias_0").size(),2);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  Assert.assertFalse(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  addResource(clusterName,"db_33",44);
  resourceUrl=getResourceUrl(clusterName,"db_33");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,null,_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
  addResource(clusterName,"db_44",44);
  resourceUrl=getResourceUrl(clusterName,"db_44");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testExpandCluster() throws Exception {
  final String clusterName="clusterTestExpandCluster";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",6,null);
  addResource(clusterName,"db_11",22);
  rebalanceResource(clusterName,"db_11");
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  String clusterUrl=getClusterUrl(clusterName);
  String instancesUrl=clusterUrl + "/instances";
  String instances="localhost:12331;localhost:12341;localhost:12351;localhost:12361";
  String response=assertSuccessPostOperation(instancesUrl,addInstanceCmd(instances),false);
  String[] hosts=instances.split(";");
  for (  String host : hosts) {
    Assert.assertTrue(response.contains(host.replace(':','_')));
  }
  response=assertSuccessPostOperation(clusterUrl,expandClusterCmd(),false);
  for (int i=3; i <= 6; i++) {
    String instanceName="localhost_123" + i + "1";
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new MasterNbInExtViewVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testAddResource() throws Exception {
  final String clusterName="clusterTestAddResource";
  addCluster(clusterName);
  String reourcesUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  String response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_22","MasterSlave",144),false);
  Assert.assertTrue(response.contains("db_22"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_11","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_11"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_22","OnlineOffline",55),true);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  deleteUrl(resourceUrl,false);
  Assert.assertFalse(_zkclient.exists("/" + clusterName + "/IDEALSTATES/db_11"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_11","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_11"));
  Assert.assertTrue(_zkclient.exists("/" + clusterName + "/IDEALSTATES/db_11"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_33","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_33"));
  response=assertSuccessPostOperation(reourcesUrl,addResourceCmd("db_44","MasterSlave",44),false);
  Assert.assertTrue(response.contains("db_44"));
}

</code></pre>

<br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDropAddResource() throws Exception {
  final String clusterName="clusterTestDropAddResource";
  addCluster(clusterName);
  addResource(clusterName,"db_11",22);
  addInstancesToCluster(clusterName,"localhost_123",6,null);
  rebalanceResource(clusterName,"db_11");
  ZNRecord record=_setupTool.getClusterManagementTool().getResourceIdealState(clusterName,"db_11").getRecord();
  String x=ObjectToJson(record);
  FileWriter fos=new FileWriter("/tmp/temp.log");
  PrintWriter pw=new PrintWriter(fos);
  pw.write(x);
  pw.close();
  MockController controller=new MockController(_zkaddr,clusterName,"controller_9900");
  controller.syncStart();
  Map<String,MockParticipant> participants=new HashMap<String,MockParticipant>();
  for (int i=0; i < 6; i++) {
    String instanceName="localhost_123" + i;
    MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
    participant.syncStart();
    participants.put(instanceName,participant);
  }
  boolean verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  deleteUrl(resourceUrl,false);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  addResource(clusterName,"db_11",22);
  String idealStateUrl=getResourceUrl(clusterName,"db_11") + "/idealState";
  Map<String,String> extraform=new HashMap<String,String>();
  extraform.put(JsonParameters.NEW_IDEAL_STATE,x);
  assertSuccessPostOperation(idealStateUrl,addIdealStateCmd(),extraform,false);
  verifyResult=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(verifyResult);
  ZNRecord record2=_setupTool.getClusterManagementTool().getResourceIdealState(clusterName,"db_11").getRecord();
  Assert.assertTrue(record2.equals(record));
  controller.syncStop();
  for (  MockParticipant participant : participants.values()) {
    participant.syncStop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestResetInstance </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testResetInstance() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  participants[0].setTransition(null);
  String hostName="localhost_12918";
  String instanceUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/instances/"+ hostName;
  Map<String,String> paramMap=new HashMap<String,String>();
  paramMap.put(JsonParameters.MANAGEMENT_COMMAND,ClusterSetup.resetInstance);
  TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,false);
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName)));
  Assert.assertTrue(result,"Cluster verification fails");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestResetPartitionState </h4><pre class="type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testResetPartitionState() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  String hostName="localhost_12918";
  String instanceUrl=getInstanceUrl(clusterName,hostName);
  Map<String,String> paramMap=new HashMap<String,String>();
  paramMap.put(JsonParameters.MANAGEMENT_COMMAND,ClusterSetup.resetPartition);
  paramMap.put(JsonParameters.PARTITION,"TestDB0_nonExist");
  paramMap.put(JsonParameters.RESOURCE,"TestDB0");
  LOG.info("IGNORABLE exception: test reset non-exist partition");
  TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,true);
  errPartitions.clear();
  participants[0].setTransition(new ErrTransitionWithResetCnt(errPartitions));
  clearStatusUpdate(clusterName,"localhost_12918","TestDB0","TestDB0_4");
  _errToOfflineInvoked.set(0);
  paramMap.put(JsonParameters.PARTITION,"TestDB0_4 TestDB0_8");
  TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,false);
  for (int i=0; i < 10; i++) {
    Thread.sleep(400);
    LOG.info("IGNORABLE exception: test reset non-error partition");
    TestHelixAdminScenariosRest.assertSuccessPostOperation(instanceUrl,paramMap,true);
    result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
    if (result == true) {
      break;
    }
  }
  Assert.assertTrue(result);
  Assert.assertEquals(_errToOfflineInvoked.get(),2,"reset() should be invoked 2 times");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestResetResource </h4><pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testResetNode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errPartitions=new HashMap<String,Set<String>>();
  errPartitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errPartitions.put("OFFLINE-SLAVE",TestHelper.setOf("TestDB0_8"));
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errPartitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  errStateMap.get("TestDB0").put("TestDB0_8","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap)));
  Assert.assertTrue(result,"Cluster verification fails");
  participants[0].setTransition(null);
  String resourceName="TestDB0";
  String resourceUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups/"+ resourceName;
  Map<String,String> paramMap=new HashMap<String,String>();
  paramMap.put(JsonParameters.MANAGEMENT_COMMAND,ClusterSetup.resetResource);
  TestHelixAdminScenariosRest.assertSuccessPostOperation(resourceUrl,paramMap,false);
  result=ClusterStateVerifier.verifyByZkCallback((new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName)));
  Assert.assertTrue(result,"Cluster verification fails");
  controller.syncStop();
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
