<h3><span class=" glyphicon glyphicon-tag"/>&nbspIterativeVerifier</h3><kbd>Verifies assertions in iterations</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.helix.TestConfigAccessor </h4><pre class="type-4 type-5 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  ConfigAccessor configAccessor=new ConfigAccessor(_zkclient);
  HelixConfigScope clusterScope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(clusterName).build();
  String clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue);
  for (int i=0; i < 2; i++) {
    configAccessor.set(clusterScope,"clusterConfigKey" + i,"clusterConfigValue" + i);
    clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey" + i);
    Assert.assertEquals(clusterConfigValue,"clusterConfigValue" + i);
  }
  HelixConfigScope resourceScope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).forResource("testResource").build();
  configAccessor.set(resourceScope,"resourceConfigKey","resourceConfigValue");
  String resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertEquals(resourceConfigValue,"resourceConfigValue");
  HelixConfigScope partitionScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  configAccessor.set(partitionScope,"partitionConfigKey","partitionConfigValue");
  String partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertEquals(partitionConfigValue,"partitionConfigValue");
  HelixConfigScope participantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).forParticipant("localhost_12918").build();
  configAccessor.set(participantScope,"participantConfigKey","participantConfigValue");
  String participantConfigValue=configAccessor.get(participantScope,"participantConfigKey");
  Assert.assertEquals(participantConfigValue,"participantConfigValue");
  HelixConfigScope partialResourceScope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(clusterName).build();
  List<String> keys=configAccessor.getKeys(partialResourceScope);
  Assert.assertEquals(keys.size(),1,"should be [testResource]");
  Assert.assertEquals(keys.get(0),"testResource");
  keys=configAccessor.getKeys(clusterScope);
  Assert.assertEquals(keys.size(),2,"should be [clusterConfigKey0, clusterConfigKey1]");
  Assert.assertEquals(keys.get(0),"clusterConfigKey0");
  Assert.assertEquals(keys.get(1),"clusterConfigKey1");
  HelixConfigScope partialParticipantScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(clusterName).build();
  keys=configAccessor.getKeys(partialParticipantScope);
  Assert.assertEquals(keys.size(),5,"should be [localhost_12918~22] sorted");
  Assert.assertEquals(keys.get(0),"localhost_12918");
  Assert.assertEquals(keys.get(4),"localhost_12922");
  HelixConfigScope partialPartitionScope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").build();
  keys=configAccessor.getKeys(partialPartitionScope);
  Assert.assertEquals(keys.size(),1,"should be [testPartition]");
  Assert.assertEquals(keys.get(0),"testPartition");
  keys=configAccessor.getKeys(resourceScope);
  Assert.assertEquals(keys.size(),1,"should be [resourceConfigKey]");
  Assert.assertEquals(keys.get(0),"resourceConfigKey");
  keys=configAccessor.getKeys(participantScope);
  System.out.println((keys));
  Assert.assertEquals(keys.size(),4,"should be [HELIX_ENABLED, HELIX_HOST, HELIX_PORT, participantConfigKey]");
  Assert.assertEquals(keys.get(3),"participantConfigKey");
  keys=configAccessor.getKeys(partitionScope);
  Assert.assertEquals(keys.size(),1,"should be [partitionConfigKey]");
  Assert.assertEquals(keys.get(0),"partitionConfigKey");
  configAccessor.remove(clusterScope,"clusterConfigKey");
  clusterConfigValue=configAccessor.get(clusterScope,"clusterConfigKey");
  Assert.assertNull(clusterConfigValue,"Should be null since it's removed");
  configAccessor.remove(resourceScope,"resourceConfigKey");
  resourceConfigValue=configAccessor.get(resourceScope,"resourceConfigKey");
  Assert.assertNull(resourceConfigValue,"Should be null since it's removed");
  configAccessor.remove(partitionScope,"partitionConfigKey");
  partitionConfigValue=configAccessor.get(partitionScope,"partitionConfigKey");
  Assert.assertNull(partitionConfigValue,"Should be null since it's removed");
  configAccessor.remove(participantScope,"participantConfigKey");
  participantConfigValue=configAccessor.get(partitionScope,"participantConfigKey");
  Assert.assertNull(participantConfigValue,"Should be null since it's removed");
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forPartition("testPartition").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster("testCluster").forPartition("testPartition").build();
    Assert.fail("Should fail since resource name is not set");
  }
 catch (  Exception e) {
  }
  try {
    new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forParticipant("testParticipant").build();
    Assert.fail("Should fail since cluster name is not set");
  }
 catch (  Exception e) {
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestRoutingTable </h4><pre class="type-4 type-7 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testMultiThread() throws Exception {
  final RoutingTableProvider routingTable=new RoutingTableProvider();
  List<ExternalView> externalViewList=new ArrayList<ExternalView>();
  ZNRecord record=new ZNRecord("TESTDB");
  for (int i=0; i < 1000; i++) {
    add(record,"TESTDB_" + i,"localhost_8900","MASTER");
  }
  externalViewList.add(new ExternalView(record));
  routingTable.onExternalViewChange(externalViewList,changeContext);
  Callable<Boolean> runnable=new Callable<Boolean>(){
    @Override public Boolean call() throws Exception {
      try {
        int count=0;
        while (count < 100) {
          List<InstanceConfig> instancesList=routingTable.getInstances("TESTDB","TESTDB_0","MASTER");
          AssertJUnit.assertEquals(instancesList.size(),1);
          Thread.sleep(5);
          count++;
        }
      }
 catch (      InterruptedException e) {
      }
      return true;
    }
  }
;
  ScheduledExecutorService executor=Executors.newSingleThreadScheduledExecutor();
  Future<Boolean> submit=executor.submit(runnable);
  int count=0;
  while (count < 10) {
    try {
      Thread.sleep(10);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    routingTable.onExternalViewChange(externalViewList,changeContext);
    count++;
  }
  Boolean result=submit.get(60,TimeUnit.SECONDS);
  AssertJUnit.assertEquals(result,Boolean.TRUE);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.TestZNRecordBucketizer </h4><pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testZNRecordBucketizer(){
  final int bucketSize=3;
  ZNRecordBucketizer bucketizer=new ZNRecordBucketizer(bucketSize);
  String[] partitionNames={"TestDB_0","TestDB_1","TestDB_2","TestDB_3","TestDB_4"};
  for (int i=0; i < partitionNames.length; i++) {
    String partitionName=partitionNames[i];
    String bucketName=bucketizer.getBucketName(partitionName);
    int startBucketNb=i / bucketSize * bucketSize;
    int endBucketNb=startBucketNb + bucketSize - 1;
    String expectBucketName="TestDB_p" + startBucketNb + "-p"+ endBucketNb;
    System.out.println("Expect: " + expectBucketName + ", actual: "+ bucketName);
    Assert.assertEquals(expectBucketName,bucketName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestBestPossibleCalcStageCompatibility </h4><pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCustomModeCompatibility(){
  System.out.println("START TestBestPossibleStateCalcStageCompatibility_testCustomModeCompatibility at " + new Date(System.currentTimeMillis()));
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealStateDeprecated(5,resources,10,1,IdealStateModeProperty.CUSTOMIZED);
  setupLiveInstances(5);
  setupStateModel();
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  ResourceCurrentState currentStateOutput=new ResourceCurrentState();
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  event.addAttribute(AttributeName.CURRENT_STATE.toString(),currentStateOutput);
  ReadClusterDataStage stage1=new ReadClusterDataStage();
  runStage(event,stage1);
  BestPossibleStateCalcStage stage2=new BestPossibleStateCalcStage();
  runStage(event,stage2);
  BestPossibleStateOutput output=event.getAttribute(AttributeName.BEST_POSSIBLE_STATE.toString());
  for (int p=0; p < 5; p++) {
    Map<ParticipantId,State> replicaMap=output.getResourceAssignment(ResourceId.from("testResourceName")).getReplicaMap(PartitionId.from("testResourceName_" + p));
    AssertJUnit.assertEquals(State.from("MASTER"),replicaMap.get(ParticipantId.from("localhost_" + (p + 1) % 5)));
  }
  System.out.println("END TestBestPossibleStateCalcStageCompatibility_testCustomModeCompatibility at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSemiAutoModeCompatibility(){
  System.out.println("START TestBestPossibleStateCalcStageCompatibility_testSemiAutoModeCompatibility at " + new Date(System.currentTimeMillis()));
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealStateDeprecated(5,resources,10,1,IdealStateModeProperty.AUTO);
  setupLiveInstances(5);
  setupStateModel();
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  ResourceCurrentState currentStateOutput=new ResourceCurrentState();
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  event.addAttribute(AttributeName.CURRENT_STATE.toString(),currentStateOutput);
  ReadClusterDataStage stage1=new ReadClusterDataStage();
  runStage(event,stage1);
  BestPossibleStateCalcStage stage2=new BestPossibleStateCalcStage();
  runStage(event,stage2);
  BestPossibleStateOutput output=event.getAttribute(AttributeName.BEST_POSSIBLE_STATE.toString());
  for (int p=0; p < 5; p++) {
    Map<ParticipantId,State> replicaMap=output.getResourceAssignment(ResourceId.from("testResourceName")).getReplicaMap(PartitionId.from("testResourceName_" + p));
    AssertJUnit.assertEquals(State.from("MASTER"),replicaMap.get(ParticipantId.from("localhost_" + (p + 1) % 5)));
  }
  System.out.println("END TestBestPossibleStateCalcStageCompatibility_testSemiAutoModeCompatibility at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestBestPossibleStateCalcStage </h4><pre class="type-4 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSimple(){
  System.out.println("START TestBestPossibleStateCalcStage at " + new Date(System.currentTimeMillis()));
  String[] resources=new String[]{"testResourceName"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  setupLiveInstances(5);
  setupStateModel();
  Map<ResourceId,ResourceConfig> resourceMap=getResourceMap(idealStates);
  ResourceCurrentState currentStateOutput=new ResourceCurrentState();
  event.addAttribute(AttributeName.RESOURCES.toString(),resourceMap);
  event.addAttribute(AttributeName.CURRENT_STATE.toString(),currentStateOutput);
  ReadClusterDataStage stage1=new ReadClusterDataStage();
  runStage(event,stage1);
  BestPossibleStateCalcStage stage2=new BestPossibleStateCalcStage();
  runStage(event,stage2);
  BestPossibleStateOutput output=event.getAttribute(AttributeName.BEST_POSSIBLE_STATE.toString());
  for (int p=0; p < 5; p++) {
    Map<ParticipantId,State> replicaMap=output.getResourceAssignment(ResourceId.from("testResourceName")).getReplicaMap(PartitionId.from("testResourceName_" + p));
    AssertJUnit.assertEquals(State.from("MASTER"),replicaMap.get(ParticipantId.from("localhost_" + (p + 1) % 5)));
  }
  System.out.println("END TestBestPossibleStateCalcStage at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.controller.stages.TestResourceComputationStage </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResources() throws Exception {
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=setupIdealState(5,resources,10,1,RebalanceMode.SEMI_AUTO);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleResourcesWithSomeDropped() throws Exception {
  int nodes=5;
  List<String> instances=new ArrayList<String>();
  for (int i=0; i < nodes; i++) {
    instances.add("localhost_" + i);
  }
  String[] resources=new String[]{"testResource1","testResource2"};
  List<IdealState> idealStates=new ArrayList<IdealState>();
  for (int i=0; i < resources.length; i++) {
    int partitions=10;
    int replicas=1;
    String resourceName=resources[i];
    ZNRecord record=DefaultTwoStateStrategy.calculateIdealState(instances,partitions,replicas,resourceName,"MASTER","SLAVE");
    IdealState idealState=new IdealState(record);
    idealState.setStateModelDefId(StateModelDefId.from("MasterSlave"));
    HelixDataAccessor accessor=manager.getHelixDataAccessor();
    Builder keyBuilder=accessor.keyBuilder();
    accessor.setProperty(keyBuilder.idealStates(resourceName),idealState);
    idealStates.add(idealState);
  }
  String instanceName="localhost_" + 3;
  LiveInstance liveInstance=new LiveInstance(instanceName);
  String sessionId=UUID.randomUUID().toString();
  liveInstance.setSessionId(sessionId);
  InstanceConfig instanceConfig=new InstanceConfig(instanceName);
  instanceConfig.setHostName("localhost");
  instanceConfig.setPort("3");
  HelixDataAccessor accessor=manager.getHelixDataAccessor();
  Builder keyBuilder=accessor.keyBuilder();
  accessor.setProperty(keyBuilder.liveInstance(instanceName),liveInstance);
  accessor.setProperty(keyBuilder.instanceConfig(instanceName),instanceConfig);
  String oldResource="testResourceOld";
  CurrentState currentState=new CurrentState(oldResource);
  currentState.setState(PartitionId.from("testResourceOld_0"),State.from("OFFLINE"));
  currentState.setState(PartitionId.from("testResourceOld_1"),State.from("SLAVE"));
  currentState.setState(PartitionId.from("testResourceOld_2"),State.from("MASTER"));
  currentState.setStateModelDefRef("MasterSlave");
  accessor.setProperty(keyBuilder.currentState(instanceName,sessionId,oldResource),currentState);
  ResourceComputationStage stage=new ResourceComputationStage();
  runStage(event,new ReadClusterDataStage());
  runStage(event,stage);
  Map<ResourceId,ResourceConfig> resourceMap=event.getAttribute(AttributeName.RESOURCES.toString());
  AssertJUnit.assertEquals(resources.length + 1,resourceMap.size());
  for (int i=0; i < resources.length; i++) {
    String resourceName=resources[i];
    ResourceId resourceId=ResourceId.from(resourceName);
    IdealState idealState=idealStates.get(i);
    AssertJUnit.assertTrue(resourceMap.containsKey(resourceId));
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getId(),resourceId);
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getIdealState().getStateModelDefId(),idealState.getStateModelDefId());
    AssertJUnit.assertEquals(resourceMap.get(resourceId).getSubUnitSet().size(),idealState.getNumPartitions());
  }
  ResourceId oldResourceId=ResourceId.from(oldResource);
  AssertJUnit.assertTrue(resourceMap.containsKey(oldResourceId));
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getId(),oldResourceId);
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getIdealState().getStateModelDefId(),currentState.getStateModelDefId());
  AssertJUnit.assertEquals(resourceMap.get(oldResourceId).getSubUnitSet().size(),currentState.getTypedPartitionStateMap().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestBatchMessageWrapper </h4><pre class="type-4 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"MasterSlave",true);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setBatchMessageMode(true);
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  TestMockMSModelFactory[] ftys=new TestMockMSModelFactory[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    ftys[i]=new TestMockMSModelFactory();
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,ftys[i]);
    participants[i].syncStart();
    boolean result=false;
    do {
      Thread.sleep(100);
      result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
    }
 while (result == false);
    Assert.assertTrue(result,"participant: " + instanceName + " fails to complete all transitions");
  }
  MockBatchMsgWrapper wrapper=(MockBatchMsgWrapper)ftys[0].getBatchMessageWrapper(ResourceId.from("TestDB0"));
  Assert.assertEquals(wrapper._startCount,3,"Expect 3 batch.start: O->S, S->M, and M->S for 1st participant");
  Assert.assertEquals(wrapper._endCount,3,"Expect 3 batch.end: O->S, S->M, and M->S for 1st participant");
  wrapper=(MockBatchMsgWrapper)ftys[1].getBatchMessageWrapper(ResourceId.from("TestDB0"));
  Assert.assertEquals(wrapper._startCount,2,"Expect 2 batch.start: O->S and S->M for 2nd participant");
  Assert.assertEquals(wrapper._startCount,2,"Expect 2 batch.end: O->S and S->M for 2nd participant");
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestDrop </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailToDropResourceWithErrorPartitionSemiAuto() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final int n=5;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  MockParticipant[] participants=new MockParticipant[n];
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,8,n,3,"MasterSlave",true);
  MockController controller=new MockController(_zkaddr,clusterName,"controller_0");
  controller.syncStart();
  Map<String,Set<String>> errTransitions=new HashMap<String,Set<String>>();
  errTransitions.put("SLAVE-MASTER",TestHelper.setOf("TestDB0_4"));
  errTransitions.put("ERROR-DROPPED",TestHelper.setOf("TestDB0_4"));
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    if (i == 0) {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
      participants[i].setTransition(new ErrTransition(errTransitions));
    }
 else {
      participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    }
    participants[i].syncStart();
  }
  Map<String,Map<String,String>> errStateMap=new HashMap<String,Map<String,String>>();
  errStateMap.put("TestDB0",new HashMap<String,String>());
  errStateMap.get("TestDB0").put("TestDB0_4","localhost_12918");
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ClusterSetup.processCommandLineArgs(new String[]{"--zkSvr",_zkaddr,"--dropResource",clusterName,"TestDB0"});
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName,errStateMap));
  Assert.assertTrue(result);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  InstanceConfig config=accessor.getProperty(keyBuilder.instanceConfig("localhost_12918"));
  List<String> disabledPartitions=config.getDisabledPartitions();
  Assert.assertEquals(disabledPartitions.size(),1,"TestDB0_4 should be disabled");
  Assert.assertEquals(disabledPartitions.get(0),"TestDB0_4");
  ExternalView ev=accessor.getProperty(keyBuilder.externalView("TestDB0"));
  Set<String> partitions=ev.getPartitionSet();
  Assert.assertEquals(partitions.size(),1,"Should have TestDB0_4->localhost_12918->ERROR");
  String errPartition=partitions.iterator().next();
  Assert.assertEquals(errPartition,"TestDB0_4");
  Map<String,String> stateMap=ev.getStateMap(errPartition);
  Assert.assertEquals(stateMap.size(),1);
  Assert.assertEquals(stateMap.keySet().iterator().next(),"localhost_12918");
  Assert.assertEquals(stateMap.get("localhost_12918"),HelixDefinedState.ERROR.name());
  CurrentState cs=accessor.getProperty(keyBuilder.currentState(participants[0].getInstanceName(),participants[0].getSessionId(),"TestDB0"));
  Map<String,String> partitionStateMap=cs.getPartitionStateMap();
  Assert.assertEquals(partitionStateMap.size(),1);
  Assert.assertEquals(partitionStateMap.keySet().iterator().next(),"TestDB0_4");
  Assert.assertEquals(partitionStateMap.get("TestDB0_4"),HelixDefinedState.ERROR.name());
  for (int i=1; i < n; i++) {
    String instanceName=participants[i].getInstanceName();
    String sessionId=participants[i].getSessionId();
    Assert.assertNull(accessor.getProperty(keyBuilder.currentState(instanceName,sessionId,"TestDB0")));
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestEntropyFreeNodeBounce </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testBounceAll() throws Exception {
  final int NUM_PARTICIPANTS=5;
  final int NUM_PARTITIONS=123;
  final int NUM_REPLICAS=1;
  final String RESOURCE_PREFIX="TestDB";
  final String RESOURCE_NAME=RESOURCE_PREFIX + "0";
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"OnlineOffline",RebalanceMode.FULL_AUTO,true);
  HelixManager[] participants=new HelixManager[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=createParticipant(clusterName,instanceName);
    participants[i].connect();
  }
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  HelixAdmin helixAdmin=new ZKHelixAdmin(_zkclient);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  try {
    Thread.sleep(1000);
    boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
    Assert.assertTrue(result);
    ExternalView stableExternalView=accessor.getProperty(keyBuilder.externalView(RESOURCE_NAME));
    for (int i=0; i < NUM_PARTICIPANTS; i++) {
      helixAdmin.enableCluster(clusterName,false);
      participants[i].disconnect();
      Thread.sleep(1000);
      participants[i]=createParticipant(clusterName,participants[i].getInstanceName());
      participants[i].connect();
      Thread.sleep(1000);
      helixAdmin.enableCluster(clusterName,true);
      Thread.sleep(1000);
      result=ClusterStateVerifier.verifyByZkCallback(new MatchingExternalViewVerifier(stableExternalView,clusterName,1));
      if (!result) {
        ExternalView currentExternalView=accessor.getProperty(keyBuilder.externalView(RESOURCE_NAME));
        for (        String partition : stableExternalView.getPartitionSet()) {
          Map<String,String> expect=stableExternalView.getStateMap(partition);
          Map<String,String> actual=currentExternalView.getStateMap(partition);
          if (!expect.equals(actual)) {
            LOG.error(partition + " is moved. expect: " + expect+ ", actual: "+ actual);
          }
        }
      }
      Assert.assertTrue(result);
      stableExternalView=accessor.getProperty(keyBuilder.externalView(RESOURCE_NAME));
    }
  }
  finally {
    controller.syncStop();
    for (    HelixManager participant : participants) {
      participant.disconnect();
    }
    System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestFullAutoNodeTagging </h4><pre class="type-4 type-7 type-14 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * Basic test for tagging behavior. 10 participants, of which 4 are tagged. Launch all 10,
 * checking external view every time a tagged node is started. Then shut down all 10, checking
 * external view every time a tagged node is killed.
 */
@Test public void testSafeAssignment() throws Exception {
  final int NUM_PARTICIPANTS=10;
  final int NUM_PARTITIONS=4;
  final int NUM_REPLICAS=2;
  final String RESOURCE_NAME="TestDB0";
  final String TAG="ASSIGNABLE";
  final String[] TAGGED_NODES={"localhost_12920","localhost_12922","localhost_12924","localhost_12925"};
  Set<String> taggedNodes=Sets.newHashSet(TAGGED_NODES);
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,NUM_PARTITIONS,NUM_PARTICIPANTS,NUM_REPLICAS,"MasterSlave",RebalanceMode.FULL_AUTO,true);
  HelixAdmin helixAdmin=new ZKHelixAdmin(_zkaddr);
  for (  String taggedNode : TAGGED_NODES) {
    helixAdmin.addInstanceTag(clusterName,taggedNode,TAG);
  }
  IdealState idealState=helixAdmin.getResourceIdealState(clusterName,RESOURCE_NAME);
  idealState.setInstanceGroupTag(TAG);
  helixAdmin.setResourceIdealState(clusterName,RESOURCE_NAME,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[NUM_PARTICIPANTS];
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    final String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
    if (taggedNodes.contains(instanceName)) {
      Thread.sleep(500);
      boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
      Assert.assertTrue(result);
      result=ClusterStateVerifier.verifyByZkCallback(new TaggedZkVerifier(clusterName,RESOURCE_NAME,TAGGED_NODES,false));
      Assert.assertTrue(result,"initial assignment with all tagged nodes live is invalid");
    }
  }
  for (int i=0; i < NUM_PARTICIPANTS; i++) {
    String participantName=participants[i].getInstanceName();
    participants[i].syncStop();
    if (taggedNodes.contains(participantName)) {
      taggedNodes.remove(participantName);
      Thread.sleep(500);
      boolean result=ClusterStateVerifier.verifyByZkCallback(new TaggedZkVerifier(clusterName,RESOURCE_NAME,TAGGED_NODES,taggedNodes.isEmpty()));
      Assert.assertTrue(result,"incorrect state after removing " + participantName + ", "+ taggedNodes+ " remain");
    }
  }
  controller.syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestMultiClusterController </h4><pre class="type-4 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testAddAndStop() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterNamePrefix=className + "_" + methodName;
  final int n=5;
  final int clusterNb=10;
  System.out.println("START " + clusterNamePrefix + " at "+ new Date(System.currentTimeMillis()));
  for (int i=0; i < clusterNb; i++) {
    String clusterName=clusterNamePrefix + "0_" + i;
    String participantName="localhost" + i;
    String resourceName="TestDB" + i;
    TestHelper.setupCluster(clusterName,_zkaddr,12918,participantName,resourceName,1,8,n,3,"MasterSlave",true);
  }
  final String controllerClusterName="CONTROLLER_" + clusterNamePrefix;
  TestHelper.setupCluster("CONTROLLER_" + clusterNamePrefix,_zkaddr,0,"controller",clusterNamePrefix,1,clusterNb,n,3,"LeaderStandby",true);
  MockMultiClusterController[] controllers=new MockMultiClusterController[n + n];
  for (int i=0; i < n; i++) {
    controllers[i]=new MockMultiClusterController(_zkaddr,controllerClusterName,"controller_" + i);
    controllers[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName),30000);
  Assert.assertTrue(result,"Controller cluster NOT in ideal state");
  MockParticipant[] participants=new MockParticipant[n];
  final String firstClusterName=clusterNamePrefix + "0_0";
  for (int i=0; i < n; i++) {
    String instanceName="localhost0_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,firstClusterName,instanceName);
    participants[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,firstClusterName));
  Assert.assertTrue(result,"first cluster NOT in ideal state");
  for (int i=0; i < n; i++) {
    String controller="controller_" + (n + i);
    _setupTool.addInstanceToCluster(controllerClusterName,controller);
  }
  _setupTool.rebalanceStorageCluster(controllerClusterName,clusterNamePrefix + "0",6);
  for (int i=n; i < 2 * n; i++) {
    controllers[i]=new MockMultiClusterController(_zkaddr,controllerClusterName,"controller_" + i);
    controllers[i].syncStart();
  }
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
  Assert.assertTrue(result,"Controller cluster NOT in ideal state");
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,firstClusterName));
  Assert.assertTrue(result,"first cluster NOT in ideal state");
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(controllerClusterName,_baseAccessor);
  Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
    String leaderName=leader.getId();
    int j=Integer.parseInt(leaderName.substring(leaderName.lastIndexOf('_') + 1));
    controllers[j].syncStop();
    result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
    Assert.assertTrue(result,"Controller cluster NOT in ideal state");
    result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,firstClusterName));
    Assert.assertTrue(result,"first cluster NOT in ideal state");
  }
  System.out.println("Cleaning up...");
  for (int i=0; i < 5; i++) {
    result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,controllerClusterName));
    controllers[i].syncStop();
  }
  for (int i=0; i < 5; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterNamePrefix + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestResourceWithSamePartitionKey </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,2,n,2,"OnlineOffline",RebalanceMode.CUSTOMIZED,false);
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,new ZkBaseDataAccessor<ZNRecord>(_zkclient));
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  IdealState idealState=accessor.getProperty(keyBuilder.idealStates("TestDB0"));
  idealState.setReplicas("2");
  idealState.setPartitionState("0","localhost_12918","ONLINE");
  idealState.setPartitionState("0","localhost_12919","ONLINE");
  idealState.setPartitionState("1","localhost_12918","ONLINE");
  idealState.setPartitionState("1","localhost_12919","ONLINE");
  accessor.setProperty(keyBuilder.idealStates("TestDB0"),idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  IdealState newIdealState=new IdealState("TestDB1");
  newIdealState.getRecord().setSimpleFields(idealState.getRecord().getSimpleFields());
  newIdealState.setPartitionState("0","localhost_12918","ONLINE");
  newIdealState.setPartitionState("0","localhost_12919","ONLINE");
  newIdealState.setPartitionState("1","localhost_12918","ONLINE");
  newIdealState.setPartitionState("1","localhost_12919","ONLINE");
  accessor.setProperty(keyBuilder.idealStates("TestDB1"),newIdealState);
  result=ClusterStateVerifier.verifyByZkCallback(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    List<String> errs=accessor.getChildNames(keyBuilder.errors(instanceName));
    Assert.assertTrue(errs.isEmpty());
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSchedulerMessage </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSchedulerMsgContraints() throws JsonGenerationException, JsonMappingException, IOException, InterruptedException {
  TestMessagingHandlerFactoryLatch factory=new TestMessagingHandlerFactoryLatch();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    _participants[i].getMessagingService().registerMessageHandlerFactory(factory.getMessageType(),factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsgContraints");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("SentMessageCount")) {
      Assert.assertEquals(statusUpdate.getMapFields().get("SentMessageCount").get("MessageCount"),"" + (_PARTITIONS * 3));
      break;
    }
  }
  for (int i=0; i < _PARTITIONS * 3 / 5; i++) {
    for (int j=0; j < 10; j++) {
      Thread.sleep(300);
      if (factory._messageCount == 5 * (i + 1))       break;
    }
    Thread.sleep(300);
    Assert.assertEquals(factory._messageCount,5 * (i + 1));
    factory.signal();
  }
  for (int j=0; j < 10; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
  ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
  Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
  int messageResultCount=0;
  for (  String key : statusUpdate.getMapFields().keySet()) {
    if (key.startsWith("MessageResult ")) {
      messageResultCount++;
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  manager.getClusterManagmentTool().removeConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1");
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsgUsingQueue() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg3() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg3");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  for (int i=0; i < 4; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
    Builder keyBuilder=helixDataAccessor.keyBuilder();
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
    boolean success=false;
    for (int j=0; j < 6; j++) {
      int count=0;
      for (      Set<String> val : _factory._results.values()) {
        count+=val.size();
      }
      success=count == _PARTITIONS * 3 / 5 * (i + 1);
      if (success) {
        break;
      }
      Thread.sleep(500);
    }
    Assert.assertTrue(success);
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg() throws Exception {
  Logger.getRootLogger().setLevel(Level.INFO);
  _factory._results.clear();
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msg=new Message(_factory.getMessageType(),"Template");
  msg.setTgtSessionId("*");
  msg.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("%");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msg.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  helixDataAccessor.createProperty(keyBuilder.controllerMessage(schedulerMessage.getMsgId()),schedulerMessage);
  for (int i=0; i < 30; i++) {
    Thread.sleep(2000);
    if (_PARTITIONS == _factory._results.size()) {
      break;
    }
  }
  Assert.assertEquals(_PARTITIONS,_factory._results.size());
  PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),schedulerMessage.getMsgId());
  int messageResultCount=0;
  for (int i=0; i < 10; i++) {
    Thread.sleep(1000);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3)));
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult ")) {
        messageResultCount++;
        Assert.assertTrue(statusUpdate.getMapField(key).size() > 1);
      }
    }
    if (messageResultCount == _PARTITIONS * 3) {
      break;
    }
 else {
      Thread.sleep(2000);
    }
  }
  Assert.assertEquals(messageResultCount,_PARTITIONS * 3);
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3);
  String controllerStatusPath=HelixUtil.getControllerPropertyPath(manager.getClusterName(),PropertyType.STATUSUPDATES_CONTROLLER);
  List<String> subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
  }
  String instanceStatusPath=HelixUtil.getInstancePropertyPath(manager.getClusterName(),"localhost_" + (START_PORT),PropertyType.STATUSUPDATES);
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() > 0);
    }
  }
  Thread.sleep(3000);
  ZKPathDataDumpTask dumpTask=new ZKPathDataDumpTask(manager,0L,0L,Integer.MAX_VALUE);
  dumpTask.run();
  subPaths=_zkclient.getChildren(controllerStatusPath);
  Assert.assertTrue(subPaths.size() > 0);
  for (  String subPath : subPaths) {
    String nextPath=controllerStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() == 0);
  }
  subPaths=_zkclient.getChildren(instanceStatusPath);
  Assert.assertTrue(subPaths.size() == 0);
  for (  String subPath : subPaths) {
    String nextPath=instanceStatusPath + "/" + subPath;
    List<String> subsubPaths=_zkclient.getChildren(nextPath);
    Assert.assertTrue(subsubPaths.size() > 0);
    for (    String subsubPath : subsubPaths) {
      String nextnextPath=nextPath + "/" + subsubPath;
      Assert.assertTrue(_zkclient.getChildren(nextnextPath).size() == 0);
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testSchedulerMsg4() throws Exception {
  _factory._results.clear();
  Thread.sleep(2000);
  HelixManager manager=null;
  for (int i=0; i < NODE_NR; i++) {
    _participants[i].getMessagingService().registerMessageHandlerFactory(_factory.getMessageType(),_factory);
    manager=_participants[i];
  }
  Message schedulerMessage=new Message(MessageType.SCHEDULER_MSG + "",UUID.randomUUID().toString());
  schedulerMessage.setTgtSessionId("*");
  schedulerMessage.setTgtName("CONTROLLER");
  schedulerMessage.setSrcName("CONTROLLER");
  Message msgTemplate=new Message(_factory.getMessageType(),"Template");
  msgTemplate.setTgtSessionId("*");
  msgTemplate.setMsgState(MessageState.NEW);
  Criteria cr=new Criteria();
  cr.setInstanceName("localhost_%");
  cr.setRecipientInstanceType(InstanceType.PARTICIPANT);
  cr.setSessionSpecific(false);
  cr.setResource("TestDB");
  cr.setPartition("%");
  ObjectMapper mapper=new ObjectMapper();
  SerializationConfig serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  StringWriter sw=new StringWriter();
  mapper.writeValue(sw,cr);
  String crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  schedulerMessage.getRecord().setMapField("MessageTemplate",msgTemplate.getRecord().getSimpleFields());
  schedulerMessage.getRecord().setSimpleField("TIMEOUT","-1");
  schedulerMessage.getRecord().setSimpleField("WAIT_ALL","true");
  schedulerMessage.getRecord().setSimpleField(DefaultSchedulerMessageHandlerFactory.SCHEDULER_TASK_QUEUE,"TestSchedulerMsg4");
  Criteria cr2=new Criteria();
  cr2.setRecipientInstanceType(InstanceType.CONTROLLER);
  cr2.setInstanceName("*");
  cr2.setSessionSpecific(false);
  Map<String,String> constraints=new TreeMap<String,String>();
  constraints.put("MESSAGE_TYPE","STATE_TRANSITION");
  constraints.put("TRANSITION","OFFLINE-COMPLETED");
  constraints.put("CONSTRAINT_VALUE","1");
  constraints.put("INSTANCE",".*");
  manager.getClusterManagmentTool().setConstraint(manager.getClusterName(),ConstraintType.MESSAGE_CONSTRAINT,"constraint1",new ConstraintItem(constraints));
  MockAsyncCallback callback=new MockAsyncCallback();
  cr.setInstanceName("localhost_%");
  mapper=new ObjectMapper();
  serializationConfig=mapper.getSerializationConfig();
  serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
  sw=new StringWriter();
  mapper.writeValue(sw,cr);
  crString=sw.toString();
  schedulerMessage.getRecord().setSimpleField("Criteria",crString);
  manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
  String msgIdPrime=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      return count(_factory) == 60;
    }
  }
,10 * 1000);
  Assert.assertTrue(success,"If not specifying participant, controller will send 60 messages");
  HelixDataAccessor helixDataAccessor=manager.getHelixDataAccessor();
  Builder keyBuilder=helixDataAccessor.keyBuilder();
  ArrayList<String> msgIds=new ArrayList<String>();
  for (int i=0; i < NODE_NR; i++) {
    callback=new MockAsyncCallback();
    cr.setInstanceName("localhost_" + (START_PORT + i));
    mapper=new ObjectMapper();
    serializationConfig=mapper.getSerializationConfig();
    serializationConfig.set(SerializationConfig.Feature.INDENT_OUTPUT,true);
    sw=new StringWriter();
    mapper.writeValue(sw,cr);
    schedulerMessage.setMsgId(UUID.randomUUID().toString());
    crString=sw.toString();
    schedulerMessage.getRecord().setSimpleField("Criteria",crString);
    manager.getMessagingService().sendAndWait(cr2,schedulerMessage,callback,-1);
    Thread.sleep(5000);
    System.err.println("count: " + count(_factory));
    String msgId=callback._message.getResultMap().get(DefaultSchedulerMessageHandlerFactory.SCHEDULER_MSG_ID);
    msgIds.add(msgId);
  }
  for (int i=0; i < NODE_NR; i++) {
    String msgId=msgIds.get(i);
    for (int j=0; j < 100; j++) {
      Thread.sleep(200);
      PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
      ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
      if (statusUpdate.getMapFields().containsKey("Summary")) {
        break;
      }
    }
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgId);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    Assert.assertTrue(statusUpdate.getMapField("SentMessageCount").get("MessageCount").equals("" + (_PARTITIONS * 3 / 5)));
    int messageResultCount=0;
    for (    String key : statusUpdate.getMapFields().keySet()) {
      if (key.startsWith("MessageResult")) {
        messageResultCount++;
      }
    }
    if (messageResultCount != _PARTITIONS * 3 / 5) {
      int x=10;
      x=x + messageResultCount;
    }
    Assert.assertEquals(messageResultCount,_PARTITIONS * 3 / 5);
  }
  for (int j=0; j < 100; j++) {
    Thread.sleep(200);
    PropertyKey controllerTaskStatus=keyBuilder.controllerTaskStatus(MessageType.SCHEDULER_MSG.toString(),msgIdPrime);
    ZNRecord statusUpdate=helixDataAccessor.getProperty(controllerTaskStatus).getRecord();
    if (statusUpdate.getMapFields().containsKey("Summary")) {
      break;
    }
  }
  int count=0;
  for (  Set<String> val : _factory._results.values()) {
    count+=val.size();
  }
  Assert.assertEquals(count,_PARTITIONS * 3 * 2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSchemataSM </h4><pre class="type-4 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSchemataSM() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=5;
  MockParticipant[] participants=new MockParticipant[n];
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestSchemata",1,1,n,0,"STORAGE_DEFAULT_SM_SCHEMATA",false);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  PropertyKey key=keyBuilder.idealStates("TestSchemata0");
  IdealState idealState=accessor.getProperty(key);
  idealState.setReplicas(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString());
  idealState.getRecord().setListField("TestSchemata0_0",Arrays.asList(HelixConstants.StateModelToken.ANY_LIVEINSTANCE.toString()));
  accessor.setProperty(key,idealState);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  for (int i=1; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  participants[0]=new MockParticipant(_zkaddr,clusterName,"localhost_12918");
  participants[0].syncStart();
  result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  key=keyBuilder.externalView("TestSchemata0");
  ExternalView externalView=accessor.getProperty(key);
  Map<String,String> stateMap=externalView.getStateMap("TestSchemata0_0");
  Assert.assertNotNull(stateMap);
  Assert.assertEquals(stateMap.size(),n,"all " + n + " participants should be in Master state");
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    Assert.assertNotNull(stateMap.get(instanceName));
    Assert.assertEquals(stateMap.get(instanceName),"MASTER");
  }
  controller.syncStop();
  for (int i=0; i < n; i++) {
    participants[i].syncStop();
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.TestSwapInstance </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestSwap() throws Exception {
  HelixManager manager=_controller;
  HelixDataAccessor helixAccessor=manager.getHelixDataAccessor();
  _setupTool.addResourceToCluster(CLUSTER_NAME,"MyDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"MyDB",_replica);
  ZNRecord idealStateOld1=new ZNRecord("TestDB");
  ZNRecord idealStateOld2=new ZNRecord("MyDB");
  IdealState is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  idealStateOld1.merge(is1.getRecord());
  IdealState is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  idealStateOld2.merge(is2.getRecord());
  String instanceName="localhost_" + (START_PORT + 0);
  _setupTool.getClusterManagementTool().enableInstance(CLUSTER_NAME,instanceName,false);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  String instanceName2="localhost_" + (START_PORT + 444);
  _setupTool.addInstanceToCluster(CLUSTER_NAME,instanceName2);
  boolean exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    exception=true;
  }
  Assert.assertTrue(exception);
  _participants[0].syncStop();
  Thread.sleep(1000);
  exception=false;
  try {
    _setupTool.swapInstance(CLUSTER_NAME,instanceName,instanceName2);
  }
 catch (  Exception e) {
    e.printStackTrace();
    exception=true;
  }
  Assert.assertFalse(exception);
  MockParticipant newParticipant=new MockParticipant(_zkaddr,CLUSTER_NAME,instanceName2);
  newParticipant.syncStart();
  result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  is1=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("TestDB"));
  is2=helixAccessor.getProperty(helixAccessor.keyBuilder().idealStates("MyDB"));
  for (  String key : idealStateOld1.getMapFields().keySet()) {
    for (    String host : idealStateOld1.getMapField(key).keySet()) {
      if (host.equals(instanceName)) {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(instanceName).equals(is1.getRecord().getMapField(key).get(instanceName2)));
      }
 else {
        Assert.assertTrue(idealStateOld1.getMapField(key).get(host).equals(is1.getRecord().getMapField(key).get(host)));
      }
    }
  }
  for (  String key : idealStateOld1.getListFields().keySet()) {
    Assert.assertEquals(idealStateOld1.getListField(key).size(),is1.getRecord().getListField(key).size());
    for (int i=0; i < idealStateOld1.getListField(key).size(); i++) {
      String host=idealStateOld1.getListField(key).get(i);
      String newHost=is1.getRecord().getListField(key).get(i);
      if (host.equals(instanceName)) {
        Assert.assertTrue(newHost.equals(instanceName2));
      }
 else {
        Assert.assertTrue(host.equals(newHost));
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.manager.TestHelixMultiClusterController </h4><pre class="type-4 type-1 type-8 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void simpleSessionExpiryTest() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,4,n,2,"MasterSlave",true);
  MockMultiClusterController[] multiClusterControllers=new MockMultiClusterController[n];
  for (int i=0; i < n; i++) {
    String contrllerName="localhost_" + (12918 + i);
    multiClusterControllers[i]=new MockMultiClusterController(_zkaddr,clusterName,contrllerName);
    multiClusterControllers[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.MasterSlave,new MockMSModelFactory());
    multiClusterControllers[i].connect();
  }
  boolean result=ClusterStateVerifier.verifyByZkCallback(new BestPossAndExtViewZkVerifier(_zkaddr,clusterName));
  Assert.assertTrue(result);
  expireController(multiClusterControllers[0],multiClusterControllers[1]);
  expireController(multiClusterControllers[1],multiClusterControllers[0]);
  ZKHelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    multiClusterControllers[i].disconnect();
    Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(multiClusterControllers[i].getInstanceName())));
  }
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestTaskRebalancer </h4><pre class="type-4 type-7 type-14 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void timeouts() throws Exception {
  final String jobResource="timeouts";
  Workflow flow=WorkflowGenerator.generateDefaultSingleJobWorkflowBuilderWithExtraConfigs(jobResource,WorkflowGenerator.DEFAULT_COMMAND_CONFIG,JobConfig.MAX_ATTEMPTS_PER_TASK,String.valueOf(2),JobConfig.TIMEOUT_PER_TASK,String.valueOf(100)).build();
  _driver.start(flow);
  TestUtil.pollForWorkflowState(_manager,jobResource,TaskState.FAILED);
  JobContext ctx=TaskUtil.getJobContext(_manager,TaskUtil.getNamespacedJobName(jobResource));
  int maxAttempts=0;
  for (int i=0; i < NUM_PARTITIONS; i++) {
    TaskPartitionState state=ctx.getPartitionState(i);
    if (state != null) {
      Assert.assertEquals(state,TaskPartitionState.TIMED_OUT);
      maxAttempts=Math.max(maxAttempts,ctx.getPartitionNumAttempts(i));
    }
  }
  Assert.assertEquals(maxAttempts,2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.integration.task.TestTaskRebalancerStopResume </h4><pre class="type-4 type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void stopDeleteAndResumeNamedQueue() throws Exception {
  String queueName=TestHelper.getTestMethodName();
  LOG.info("Starting job-queue: " + queueName);
  JobQueue queue=new JobQueue.Builder(queueName).build();
  _driver.createQueue(queue);
  List<String> currentJobNames=new ArrayList<String>();
  for (int i=0; i <= 4; i++) {
    String targetPartition=(i == 0) ? "MASTER" : "SLAVE";
    JobConfig.Builder job=new JobConfig.Builder().setCommand("Reindex").setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB).setTargetPartitionStates(Sets.newHashSet(targetPartition));
    String jobName=targetPartition.toLowerCase() + "Job" + i;
    LOG.info("Enqueuing job: " + jobName);
    _driver.enqueueJob(queueName,jobName,job);
    currentJobNames.add(i,jobName);
  }
  String deletedJob1=currentJobNames.get(0);
  String namedSpaceDeletedJob1=String.format("%s_%s",queueName,deletedJob1);
  TestUtil.pollForJobState(_manager,queueName,namedSpaceDeletedJob1,TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,namedSpaceDeletedJob1,TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  _driver.deleteJob(queueName,deletedJob1);
  verifyJobDeleted(queueName,namedSpaceDeletedJob1);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  TestUtil.pollForJobState(_manager,queueName,String.format("%s_%s",queueName,currentJobNames.get(1)),TaskState.IN_PROGRESS);
  LOG.info("Pausing job-queue: " + queueName);
  _driver.stop(queueName);
  TestUtil.pollForJobState(_manager,queueName,String.format("%s_%s",queueName,currentJobNames.get(1)),TaskState.STOPPED);
  TestUtil.pollForWorkflowState(_manager,queueName,TaskState.STOPPED);
  String deletedJob2=currentJobNames.get(2);
  String namedSpaceDeletedJob2=String.format("%s_%s",queueName,deletedJob2);
  TestUtil.pollForEmptyJobState(_manager,queueName,namedSpaceDeletedJob2);
  _driver.deleteJob(queueName,deletedJob2);
  verifyJobDeleted(queueName,namedSpaceDeletedJob2);
  LOG.info("Resuming job-queue: " + queueName);
  _driver.resume(queueName);
  currentJobNames.remove(deletedJob1);
  currentJobNames.remove(deletedJob2);
  long preJobFinish=0;
  for (int i=0; i < currentJobNames.size(); i++) {
    String namedSpaceJobName=String.format("%s_%s",queueName,currentJobNames.get(i));
    TestUtil.pollForJobState(_manager,queueName,namedSpaceJobName,TaskState.COMPLETED);
    JobContext jobContext=TaskUtil.getJobContext(_manager,namedSpaceJobName);
    long jobStart=jobContext.getStartTime();
    Assert.assertTrue(jobStart >= preJobFinish);
    preJobFinish=jobContext.getFinishTime();
  }
  LOG.info("Flusing job-queue: " + queueName);
  _driver.flushQueue(queueName);
  TimeUnit.MILLISECONDS.sleep(200);
  for (int i=0; i < currentJobNames.size(); i++) {
    String namedSpaceJobName=String.format("%s_%s",queueName,currentJobNames.get(i));
    verifyJobDeleted(queueName,namedSpaceJobName);
    verifyJobNotInQueue(queueName,namedSpaceJobName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestHandleNewSession </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testHandleNewSession() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  MockParticipant participant=new MockParticipant(_zkaddr,clusterName,"localhost_12918");
  participant.syncStart();
  String lastSessionId=participant.getSessionId();
  for (int i=0; i < 3; i++) {
    ZkTestHelper.expireSession(participant.getZkClient());
    String sessionId=participant.getSessionId();
    Assert.assertTrue(sessionId.compareTo(lastSessionId) > 0,"Session id should be increased after expiry");
    lastSessionId=sessionId;
    Assert.assertFalse(sessionId.equals("0"),"Hit race condition in zhclient.handleNewSession(). sessionId is not returned yet.");
  }
  System.out.println("Disconnecting ...");
  participant.syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateFailZkCacheBaseAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,Arrays.asList(curStatePath,extViewPath),null);
  Assert.assertEquals(accessor._wtCache._cache.size(),1,"Should contain only:\n" + curStatePath);
  Assert.assertTrue(accessor._wtCache._cache.containsKey(curStatePath));
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertFalse(success[i],"Should fail on create: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: TestDB" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestWtCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCreateFailZkCacheBaseDataAccessor(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,Arrays.asList(curStatePath),null);
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_1","TestDB" + i);
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertFalse(success,"Should fail in create due to NodeExists: " + path);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,cachePaths,null);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    boolean success=accessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    boolean success=accessor.set(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in set: " + path);
  }
  ret=TestHelper.verifyZkCache(cachePaths,accessor._wtCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"wtCache doesn't match data on Zk");
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=accessor.get(path,null,0);
    Assert.assertEquals(record.getId(),"TestDB" + i);
  }
  List<String> childNames=accessor.getChildNames(extViewPath,0);
  Assert.assertEquals(childNames.size(),10,"Should contain only: TestDB0-9");
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(childNames.contains("TestDB" + i));
  }
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    Assert.assertTrue(accessor.exists(path,0));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkBaseDataAccessor </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAsyncZkBaseDataAccessor(){
  System.out.println("START TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
  String root="TestZkBaseDataAccessor_asyn";
  ZkClient zkClient=new ZkClient(_zkaddr);
  zkClient.setZkSerializer(new ZNRecordSerializer());
  zkClient.deleteRecursive("/" + root);
  ZkBaseDataAccessor<ZNRecord> accessor=new ZkBaseDataAccessor<ZNRecord>(zkClient);
  String parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    records.add(new ZNRecord(msgId));
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in create " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getId(),msgId,"Should get what we created");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=new ArrayList<ZNRecord>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key1","value1");
    records.add(newRecord);
  }
  success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in set " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),1,"Should have 1 simple field set");
    Assert.assertEquals(record.getSimpleField("key1"),"value1","Should have value1 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  List<DataUpdater<ZNRecord>> znrecordUpdaters=new ArrayList<DataUpdater<ZNRecord>>();
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
    ZNRecord newRecord=new ZNRecord(msgId);
    newRecord.setSimpleField("key2","value2");
    znrecordUpdaters.add(new ZNRecordUpdater(newRecord));
  }
  success=accessor.updateChildren(paths,znrecordUpdaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in update " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    ZNRecord record=zkClient.readData(path);
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  records=accessor.getChildren(parentPath,null,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    ZNRecord record=records.get(i);
    Assert.assertEquals(record.getId(),msgId,"Should get what we updated");
    Assert.assertEquals(record.getSimpleFields().size(),2,"Should have 2 simple fields set");
    Assert.assertEquals(record.getSimpleField("key2"),"value2","Should have value2 set");
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  boolean[] exists=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(exists[i],"Should exist " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  Stat[] stats=accessor.getStats(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertNotNull(stats[i],"Stat should exist for " + msgId);
    Assert.assertEquals(stats[i].getVersion(),2,"DataVersion should be 2, since we set 1 and update 1 for " + msgId);
  }
  parentPath=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1");
  paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    paths.add(PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId));
  }
  success=accessor.remove(paths,0);
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    Assert.assertTrue(success[i],"Should succeed in remove " + msgId);
  }
  for (int i=0; i < 10; i++) {
    String msgId="msg_" + i;
    String path=PropertyPathConfig.getPath(PropertyType.MESSAGES,root,"host_1",msgId);
    boolean pathExists=zkClient.exists(path);
    Assert.assertFalse(pathExists,"Should be removed " + msgId);
  }
  zkClient.close();
  System.out.println("END TestZkBaseDataAccessor.async at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheAsyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies values related to public fields.
"></span><br>
@Test public void testHappyPathExtOpZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient extZkclient=new ZkClient(_zkaddr);
  extZkclient.setZkSerializer(new ZNRecordSerializer());
  ZkBaseDataAccessor<ZNRecord> extBaseAccessor=new ZkBaseDataAccessor<ZNRecord>(extZkclient);
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  extBaseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> zkCacheInitPaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,zkCacheInitPaths);
  boolean ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=extBaseAccessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  for (int i=0; i < 10; i++) {
    ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
    if (ret == true)     break;
    Thread.sleep(100);
  }
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=extBaseAccessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  success=extBaseAccessor.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
    paths.add(path);
  }
  success=extBaseAccessor.remove(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in remove: " + paths.get(i));
  }
  Thread.sleep(100);
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  extZkclient.close();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHappyPathSelfOpZkCacheBaseDataAccessor() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  baseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> zkCacheInitPaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,zkCacheInitPaths);
  boolean ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901","session_0","TestDB" + i);
    ZNRecord record=new ZNRecord("TestDB" + i);
    paths.add(path);
    records.add(record);
  }
  boolean[] success=accessor.createChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should succeed in create: " + paths.get(i));
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,false);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int j=0; j < 10; j++) {
    paths.clear();
    updaters.clear();
    for (int i=0; i < 10; i++) {
      String path=curStatePath + "/session_0/TestDB" + i;
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      DataUpdater<ZNRecord> updater=new ZNRecordUpdater(newRecord);
      paths.add(path);
      updaters.add(updater);
    }
    success=accessor.updateChildren(paths,updaters,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in update: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int j=0; j < 10; j++) {
    for (int i=0; i < 10; i++) {
      String path=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName,"TestDB" + i);
      ZNRecord record=new ZNRecord("TestDB" + i);
      record.setSimpleField("setKey","" + j);
      paths.add(path);
      records.add(record);
    }
    success=accessor.setChildren(paths,records,AccessOption.PERSISTENT);
    for (int i=0; i < 10; i++) {
      Assert.assertTrue(success[i],"Should succeed in set: " + paths.get(i));
    }
  }
  ret=TestHelper.verifyZkCache(zkCacheInitPaths,accessor._zkCache._cache,_zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  paths.clear();
  records.clear();
  for (int i=0; i < 10; i++) {
    String path=extViewPath + "/TestDB" + i;
    paths.add(path);
  }
  records=accessor.get(paths,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  records.clear();
  records=accessor.getChildren(extViewPath,null,0);
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(records.get(i).getId(),"TestDB" + i);
  }
  paths.clear();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    paths.add(path);
  }
  success=accessor.exists(paths,0);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(success[i],"Should exits: " + paths.get(i));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkCacheSyncOpSingleThread </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZkCacheCallbackExternalOpNoChroot() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  ZkClient zkclient=new ZkClient(_zkaddr);
  zkclient.setZkSerializer(new ZNRecordSerializer());
  ZkBaseDataAccessor<ZNRecord> extBaseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  String curStatePath=PropertyPathConfig.getPath(PropertyType.CURRENTSTATES,clusterName,"localhost_8901");
  String extViewPath=PropertyPathConfig.getPath(PropertyType.EXTERNALVIEW,clusterName);
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(zkclient);
  extBaseAccessor.create(curStatePath,null,AccessOption.PERSISTENT);
  List<String> cachePaths=Arrays.asList(curStatePath,extViewPath);
  ZkCacheBaseDataAccessor<ZNRecord> accessor=new ZkCacheBaseDataAccessor<ZNRecord>(baseAccessor,null,null,cachePaths);
  TestListener listener=new TestListener();
  accessor.subscribe(curStatePath,listener);
  List<String> createPaths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    createPaths.add(path);
    boolean success=extBaseAccessor.create(path,new ZNRecord("TestDB" + i),AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in create: " + path);
  }
  Thread.sleep(500);
  boolean ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("createCnt: " + listener._createPathQueue.size());
  Assert.assertEquals(listener._createPathQueue.size(),11,"Shall get 11 onCreate callbacks.");
  createPaths.add(curStatePath + "/session_0");
  List<String> createCallbackPaths=new ArrayList<String>(listener._createPathQueue);
  Collections.sort(createPaths);
  Collections.sort(createCallbackPaths);
  Assert.assertEquals(createCallbackPaths,createPaths,"Should get create callbacks at " + createPaths + ", but was "+ createCallbackPaths);
  List<String> updatePaths=new ArrayList<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    for (int j=0; j < 10; j++) {
      updatePaths.add(path);
      ZNRecord newRecord=new ZNRecord("TestDB" + i);
      newRecord.setSimpleField("" + j,"" + j);
      boolean success=accessor.update(path,new ZNRecordUpdater(newRecord),AccessOption.PERSISTENT);
      Assert.assertTrue(success,"Should succeed in update: " + path);
    }
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("changeCnt: " + listener._changePathQueue.size());
  Assert.assertEquals(listener._changePathQueue.size(),100,"Shall get 100 onChange callbacks.");
  List<String> updateCallbackPaths=new ArrayList<String>(listener._changePathQueue);
  Collections.sort(updatePaths);
  Collections.sort(updateCallbackPaths);
  Assert.assertEquals(updateCallbackPaths,updatePaths,"Should get change callbacks at " + updatePaths + ", but was "+ updateCallbackPaths);
  TreeSet<String> removePaths=new TreeSet<String>();
  listener.reset();
  for (int i=0; i < 10; i++) {
    String path=curStatePath + "/session_0/TestDB" + i;
    removePaths.add(path);
    boolean success=accessor.remove(path,AccessOption.PERSISTENT);
    Assert.assertTrue(success,"Should succeed in remove: " + path);
  }
  Thread.sleep(500);
  ret=TestHelper.verifyZkCache(cachePaths,accessor._zkCache._cache,zkclient,true);
  Assert.assertTrue(ret,"zkCache doesn't match data on Zk");
  System.out.println("deleteCnt: " + listener._deletePathQueue.size());
  Assert.assertTrue(listener._deletePathQueue.size() >= 10,"Shall get at least 10 onDelete callbacks.");
  Set<String> removeCallbackPaths=new TreeSet<String>(listener._deletePathQueue);
  Assert.assertEquals(removeCallbackPaths,removePaths,"Should get remove callbacks at " + removePaths + ", but was "+ removeCallbackPaths);
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkFlapping </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParticipantFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  final String instanceName="localhost_12918";
  MockParticipant participant=new MockParticipant(_zkaddr,clusterName,instanceName);
  participant.syncStart();
  final ZkClient client=participant.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  client.unsubscribeStateChanges(listener);
  LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
  Assert.assertNotNull(liveInstance,"Live-instance should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance liveInstance=accessor.getProperty(keyBuilder.liveInstance(instanceName));
      return liveInstance == null;
    }
  }
,3 * 1000);
  Assert.assertTrue(success,"Live-instance should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testControllerFlapping() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,1,1,"MasterSlave",false);
  MockController controller=new MockController(_zkaddr,clusterName,"controller");
  controller.syncStart();
  final ZkClient client=controller.getZkClient();
  final ZkStateCountListener listener=new ZkStateCountListener();
  client.subscribeStateChanges(listener);
  final AtomicInteger expectDisconnectCnt=new AtomicInteger(0);
  final int n=ZKHelixManager.MAX_DISCONNECT_THRESHOLD;
  for (int i=0; i < n; i++) {
    String oldSessionId=ZkTestHelper.getSessionId(client);
    ZkTestHelper.simulateZkStateDisconnected(client);
    expectDisconnectCnt.incrementAndGet();
    TestHelper.verify(new Verifier(){
      @Override public boolean verify() throws Exception {
        return listener.count == expectDisconnectCnt.get();
      }
    }
,30 * 1000);
    String newSessionId=ZkTestHelper.getSessionId(client);
    Assert.assertEquals(newSessionId,oldSessionId);
  }
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader,"Leader should exist after " + n + " disconnects");
  ZkTestHelper.simulateZkStateDisconnected(client);
  boolean success=TestHelper.verify(new Verifier(){
    @Override public boolean verify() throws Exception {
      return client.getShutdownTrigger();
    }
  }
,30 * 1000);
  Assert.assertTrue(success,"The " + (n + 1) + "th disconnect event should trigger ZkHelixManager#disonnect");
  success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      return leader == null;
    }
  }
,5 * 1000);
  Assert.assertTrue(success,"Leader should be gone after " + (n + 1) + " disconnects");
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixAdmin </h4><pre class="type-4 type-7 type-5 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testZkHelixAdmin(){
  System.out.println("START testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
  final String clusterName=TestUtil.getTestName();
  String rootPath="/" + clusterName;
  if (_zkclient.exists(rootPath)) {
    _zkclient.deleteRecursive(rootPath);
  }
  HelixAdmin tool=new ZKHelixAdmin(_zkclient);
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  tool.addCluster(clusterName,true);
  Assert.assertTrue(ZKUtil.isClusterSetup(clusterName,_zkclient));
  List<String> list=tool.getClusters();
  AssertJUnit.assertTrue(list.size() > 0);
  try {
    Stat oldstat=_zkclient.getStat(rootPath);
    Assert.assertNotNull(oldstat);
    boolean success=tool.addCluster(clusterName,false);
    Assert.assertTrue(success);
    Stat newstat=_zkclient.getStat(rootPath);
    Assert.assertEquals(oldstat,newstat);
  }
 catch (  HelixException e) {
  }
  InstanceConfig config=new InstanceConfig("host1_9999");
  config.setHostName("host1");
  config.setPort("9999");
  tool.addInstance(clusterName,config);
  tool.enableInstance(clusterName,"host1_9999",true);
  String path=PropertyPathConfig.getPath(PropertyType.INSTANCES,clusterName,"host1_9999");
  AssertJUnit.assertTrue(_zkclient.exists(path));
  try {
    tool.addInstance(clusterName,config);
    Assert.fail("should fail if add an alredy-existing instance");
  }
 catch (  HelixException e) {
  }
  config=tool.getInstanceConfig(clusterName,"host1_9999");
  AssertJUnit.assertEquals(config.getId(),"host1_9999");
  tool.dropInstance(clusterName,config);
  try {
    tool.getInstanceConfig(clusterName,"host1_9999");
    Assert.fail("should fail if get a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.dropInstance(clusterName,config);
    Assert.fail("should fail if drop on a non-existent instance");
  }
 catch (  HelixException e) {
  }
  try {
    tool.enableInstance(clusterName,"host1_9999",false);
    Assert.fail("should fail if enable a non-existent instance");
  }
 catch (  HelixException e) {
  }
  ZNRecord stateModelRecord=new ZNRecord("id1");
  try {
    tool.addStateModelDef(clusterName,"id1",new StateModelDefinition(stateModelRecord));
    path=PropertyPathConfig.getPath(PropertyType.STATEMODELDEFS,clusterName,"id1");
    AssertJUnit.assertTrue(_zkclient.exists(path));
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
catch (  IllegalArgumentException ex) {
  }
  tool.addStateModelDef(clusterName,"MasterSlave",new StateModelDefinition(StateModelConfigGenerator.generateConfigForMasterSlave()));
  stateModelRecord=StateModelConfigGenerator.generateConfigForMasterSlave();
  try {
    tool.addStateModelDef(clusterName,stateModelRecord.getId(),new StateModelDefinition(stateModelRecord));
    Assert.fail("should fail if add an already-existing state model");
  }
 catch (  HelixException e) {
  }
  list=tool.getStateModelDefs(clusterName);
  AssertJUnit.assertEquals(list.size(),1);
  try {
    tool.addResource(clusterName,"resource",10,"nonexistStateModelDef");
    Assert.fail("should fail if add a resource without an existing state model");
  }
 catch (  HelixException e) {
  }
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  try {
    tool.addResource(clusterName,"resource",10,"id1");
    Assert.fail("should fail");
  }
 catch (  HelixException e) {
  }
  list=tool.getResourcesInCluster(clusterName);
  AssertJUnit.assertEquals(list.size(),0);
  ExternalView resourceExternalView=tool.getResourceExternalView(clusterName,"resource");
  AssertJUnit.assertNull(resourceExternalView);
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTITION).forCluster(clusterName).forResource("testResource").forPartition("testPartition").build();
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("pKey1","pValue1");
  properties.put("pKey2","pValue2");
  for (int i=0; i < 100; i++) {
    tool.setConfig(scope,properties);
    Map<String,String> newProperties=tool.getConfig(scope,new ArrayList<String>(properties.keySet()));
    Assert.assertEquals(newProperties.size(),2);
    Assert.assertEquals(newProperties.get("pKey1"),"pValue1");
    Assert.assertEquals(newProperties.get("pKey2"),"pValue2");
  }
  System.out.println("END testZkHelixAdmin at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixMultiClusterController </h4><pre class="type-4 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnConnectedAndDisconnecting() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  final HelixMultiClusterController[] controllers=new HelixMultiClusterController[n];
  for (int i=0; i < n; i++) {
    int port=12918 + i;
    ControllerId controllerId=ControllerId.from("localhost_" + port);
    controllers[i]=connection.createMultiClusterController(clusterId,controllerId);
    controllers[i].start();
  }
  final HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  final PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    String instanceName=controllers[i].getControllerId().stringify();
    Assert.assertNotNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  }
  LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
  Assert.assertNotNull(leader);
  Assert.assertEquals(leader.getInstanceName(),controllers[0].getControllerId().stringify());
  controllers[0].stop();
  String instanceName=controllers[0].getControllerId().stringify();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  boolean success=TestHelper.verify(new TestHelper.Verifier(){
    @Override public boolean verify() throws Exception {
      LiveInstance leader=accessor.getProperty(keyBuilder.controllerLeader());
      if (leader == null) {
        return false;
      }
      return leader.getInstanceName().equals(controllers[1].getControllerId().stringify());
    }
  }
,3 * 1000);
  Assert.assertTrue(success,"fail to re-elect new leader");
  connection.disconnect();
  instanceName=controllers[1].getControllerId().stringify();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(instanceName)));
  Assert.assertNull(accessor.getProperty(keyBuilder.controllerLeader()));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkHelixParticipant </h4><pre class="type-4 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testOnConnectedAndDisconnecting() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  HelixConnection connection=new ZkHelixConnection(_zkaddr);
  connection.connect();
  ClusterId clusterId=ClusterId.from(clusterName);
  HelixParticipant[] participants=new HelixParticipant[n];
  for (int i=0; i < n; i++) {
    int port=12918 + i;
    ParticipantId participantId=ParticipantId.from("localhost_" + port);
    participants[i]=connection.createParticipant(clusterId,participantId);
    participants[i].getStateMachineEngine().registerStateModelFactory(StateModelDefId.from("MasterSlave"),new TestHelixConnection.MockStateModelFactory());
    participants[i].start();
  }
  HelixDataAccessor accessor=new ZKHelixDataAccessor(clusterName,_baseAccessor);
  PropertyKey.Builder keyBuilder=accessor.keyBuilder();
  for (int i=0; i < n; i++) {
    Assert.assertNotNull(accessor.getProperty(keyBuilder.liveInstance(participants[i].getParticipantId().stringify())));
  }
  participants[0].stop();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(participants[0].getParticipantId().stringify())));
  connection.disconnect();
  Assert.assertNull(accessor.getProperty(keyBuilder.liveInstance(participants[1].getParticipantId().stringify())));
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.manager.zk.TestZkManagerFlappingDetection </h4><pre class="type-4 type-14 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDisconnectHistory() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  final String clusterName=className + "_" + methodName;
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,10,5,3,"MasterSlave",true);
  String instanceName="localhost_" + (12918 + 0);
  MockParticipant manager=new MockParticipant(_zkaddr,clusterName,instanceName);
  manager.connect();
  ZkClient zkClient=manager.getZkClient();
  ZkTestHelper.expireSession(zkClient);
  for (int i=0; i < 4; i++) {
    ZkTestHelper.expireSession(zkClient);
    Thread.sleep(1000);
    if (i < 5) {
      Assert.assertTrue(manager.isConnected());
    }
  }
  ZkTestHelper.disconnectSession(zkClient);
  for (int i=0; i < 20; i++) {
    Thread.sleep(500);
    System.out.println(i);
    if (!manager.isConnected())     break;
  }
  Assert.assertFalse(manager.isConnected());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.TestAsyncCallback </h4><pre class="type-4 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test() public void testAsyncCallback() throws Exception {
  System.out.println("START TestAsyncCallback at " + new Date(System.currentTimeMillis()));
  AsyncCallbackSample callback=new AsyncCallbackSample();
  AssertJUnit.assertFalse(callback.isInterrupted());
  AssertJUnit.assertFalse(callback.isTimedOut());
  AssertJUnit.assertTrue(callback.getMessageReplied().size() == 0);
  int nMsgs=5;
  List<Message> messageSent=new ArrayList<Message>();
  for (int i=0; i < nMsgs; i++) {
    messageSent.add(new Message("Test",MessageId.from(UUID.randomUUID().toString())));
  }
  callback.setMessagesSent(messageSent);
  for (int i=0; i < nMsgs; i++) {
    AssertJUnit.assertFalse(callback.isDone());
    callback.onReply(new Message("TestReply",MessageId.from(UUID.randomUUID().toString())));
  }
  AssertJUnit.assertTrue(callback.isDone());
  AssertJUnit.assertTrue(callback._onTimeOutCalled == 0);
  sleep(50);
  callback=new AsyncCallbackSample();
  callback.setMessagesSent(messageSent);
  callback.setTimeout(1000);
  sleep(50);
  callback.startTimer();
  AssertJUnit.assertFalse(callback.isTimedOut());
  for (int i=0; i < nMsgs - 1; i++) {
    sleep(50);
    AssertJUnit.assertFalse(callback.isDone());
    AssertJUnit.assertTrue(callback._onReplyMessageCalled == i);
    callback.onReply(new Message("TestReply",MessageId.from(UUID.randomUUID().toString())));
  }
  sleep(1000);
  AssertJUnit.assertTrue(callback.isTimedOut());
  AssertJUnit.assertTrue(callback._onTimeOutCalled == 1);
  AssertJUnit.assertFalse(callback.isDone());
  callback=new AsyncCallbackSample();
  callback.setMessagesSent(messageSent);
  callback.setTimeout(1000);
  callback.startTimer();
  sleep(50);
  AssertJUnit.assertFalse(callback.isTimedOut());
  for (int i=0; i < nMsgs; i++) {
    AssertJUnit.assertFalse(callback.isDone());
    sleep(50);
    AssertJUnit.assertTrue(callback._onReplyMessageCalled == i);
    callback.onReply(new Message("TestReply",MessageId.from(UUID.randomUUID().toString())));
  }
  AssertJUnit.assertTrue(callback.isDone());
  sleep(1300);
  AssertJUnit.assertFalse(callback.isTimedOut());
  AssertJUnit.assertTrue(callback._onTimeOutCalled == 0);
  System.out.println("END TestAsyncCallback at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestConfigThreadpoolSize </h4><pre class="type-4 type-14 type-1 type-6 type-12 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void TestThreadPoolSizeConfig(){
  String instanceName="localhost_" + (START_PORT + 0);
  HelixManager manager=_participants[0];
  ConfigAccessor accessor=manager.getConfigAccessor();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.PARTICIPANT).forCluster(manager.getClusterName()).forParticipant(instanceName).build();
  accessor.set(scope,"TestMsg." + HelixTaskExecutor.MAX_THREADS,"" + 12);
  scope=new HelixConfigScopeBuilder(ConfigScopeProperty.CLUSTER).forCluster(manager.getClusterName()).build();
  accessor.set(scope,"TestMsg." + HelixTaskExecutor.MAX_THREADS,"" + 8);
  for (int i=0; i < NODE_NR; i++) {
    instanceName="localhost_" + (START_PORT + i);
    _participants[i].getMessagingService().registerMessageHandlerFactory("TestMsg",new TestMessagingHandlerFactory());
    _participants[i].getMessagingService().registerMessageHandlerFactory("TestMsg2",new TestMessagingHandlerFactory2());
  }
  for (int i=0; i < NODE_NR; i++) {
    instanceName="localhost_" + (START_PORT + i);
    DefaultMessagingService svc=(DefaultMessagingService)(_participants[i].getMessagingService());
    HelixTaskExecutor helixExecutor=svc.getExecutor();
    ThreadPoolExecutor executor=(ThreadPoolExecutor)(helixExecutor._executorMap.get("TestMsg"));
    ThreadPoolExecutor executor2=(ThreadPoolExecutor)(helixExecutor._executorMap.get("TestMsg2"));
    if (i != 0) {
      Assert.assertEquals(8,executor.getMaximumPoolSize());
    }
 else {
      Assert.assertEquals(12,executor.getMaximumPoolSize());
    }
    Assert.assertEquals(HelixTaskExecutor.DEFAULT_PARALLEL_TASKS,executor2.getMaximumPoolSize());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestHelixTaskExecutor </h4><pre class="type-4 type-7 type-14 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test() public void testNoRetry() throws InterruptedException {
  HelixTaskExecutor executor=new HelixTaskExecutor();
  HelixManager manager=new MockClusterManager();
  CancellableHandlerFactory factory=new CancellableHandlerFactory();
  executor.registerMessageHandlerFactory(factory.getMessageType(),factory);
  NotificationContext changeContext=new NotificationContext(manager);
  List<Message> msgList=new ArrayList<Message>();
  int nMsgs2=4;
  for (int i=0; i < nMsgs2; i++) {
    Message msg=new Message(factory.getMessageType(),MessageId.from(UUID.randomUUID().toString()));
    msg.setTgtSessionId(SessionId.from("*"));
    msg.setTgtName("Localhost_1123");
    msg.setSrcName("127.101.1.23_2234");
    msg.setExecutionTimeout((i + 1) * 600);
    msgList.add(msg);
  }
  executor.onMessage("someInstance",msgList,changeContext);
  Thread.sleep(4000);
  AssertJUnit.assertTrue(factory._handlersCreated == nMsgs2);
  AssertJUnit.assertEquals(factory._timedOutMsgIds.size(),2);
  for (int i=0; i < nMsgs2 - 2; i++) {
    if (msgList.get(i).getMsgType().equalsIgnoreCase(factory.getMessageType())) {
      AssertJUnit.assertTrue(msgList.get(i).getRecord().getSimpleFields().containsKey("Cancelcount"));
      AssertJUnit.assertTrue(factory._timedOutMsgIds.containsKey(msgList.get(i).getId()));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.messaging.handling.TestResourceThreadpoolSize </h4><pre class="type-4 type-7 type-1 type-8 type-6 type-12 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestThreadPoolSizeConfig(){
  HelixManager manager=_participants[0];
  ConfigAccessor accessor=manager.getConfigAccessor();
  HelixConfigScope scope=new HelixConfigScopeBuilder(ConfigScopeProperty.RESOURCE).forCluster(manager.getClusterName()).forResource("NextDB").build();
  accessor.set(scope,HelixTaskExecutor.MAX_THREADS,"" + 12);
  _setupTool.addResourceToCluster(CLUSTER_NAME,"NextDB",64,STATE_MODEL);
  _setupTool.rebalanceStorageCluster(CLUSTER_NAME,"NextDB",3);
  boolean result=ClusterStateVerifier.verifyByPolling(new ClusterStateVerifier.BestPossAndExtViewZkVerifier(_zkaddr,CLUSTER_NAME));
  Assert.assertTrue(result);
  long taskcount=0;
  for (int i=0; i < NODE_NR; i++) {
    DefaultMessagingService svc=(DefaultMessagingService)(_participants[i].getMessagingService());
    HelixTaskExecutor helixExecutor=svc.getExecutor();
    ThreadPoolExecutor executor=(ThreadPoolExecutor)(helixExecutor._executorMap.get(MessageType.STATE_TRANSITION + "." + "NextDB"));
    Assert.assertEquals(12,executor.getMaximumPoolSize());
    taskcount+=executor.getCompletedTaskCount();
    Assert.assertTrue(executor.getCompletedTaskCount() > 0);
  }
  Assert.assertEquals(taskcount,64 * 4);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestAutoFallbackPropertyStore </h4><pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 20; i++) {
    if (i < 10) {
      String path=String.format("%s/%d",fallbackRoot,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
 else {
      String path=String.format("%s/%d",root,i);
      baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    }
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
    }
    paths.add(path);
  }
  List<String> childs=store.getChildNames("/",0);
  Assert.assertNotNull(childs);
  Assert.assertEquals(childs.size(),20);
  for (int i=0; i < 20; i++) {
    String child=childs.get(i);
    Assert.assertTrue(childs.contains(child));
  }
  List<ZNRecord> records=store.getChildren("/",null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    Assert.assertNotNull(record);
    String id=record.getId();
    Assert.assertTrue(childs.contains(id));
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test void testMultiGetOnFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertTrue(exists[i]);
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    Assert.assertNotNull(stats[i]);
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),10);
  for (int i=0; i < 10; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingFallbackPath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNull(record.getSimpleField("key"));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key"));
    Assert.assertEquals(record.getSimpleField("key"),"value");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiUpdateUsingNewath(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
    path=String.format("%s/%d",root,i);
    baseAccessor.create(path,new ZNRecord("new" + i),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<DataUpdater<ZNRecord>> updaters=new ArrayList<DataUpdater<ZNRecord>>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",root,path),0),"Should exist under new location");
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
    updaters.add(new MyDataUpdater("new" + i));
  }
  boolean succeed[]=store.updateChildren(paths,updaters,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=paths.get(i);
    if (i < 10) {
      ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),"" + i);
      Assert.assertNull(record.getSimpleField("key"));
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    ZNRecord record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
    if (i < 10) {
      Assert.assertNotNull(record.getSimpleField("key"));
      Assert.assertEquals(record.getSimpleField("key"),"value");
    }
 else {
      Assert.assertNull(record.getSimpleField("key"));
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultiSet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  List<ZNRecord> records=new ArrayList<ZNRecord>();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    paths.add(path);
    ZNRecord record=new ZNRecord("new" + i);
    records.add(record);
  }
  boolean succeed[]=store.setChildren(paths,records,AccessOption.PERSISTENT);
  for (int i=0; i < 10; i++) {
    Assert.assertTrue(succeed[i]);
    String path=String.format("/%d",i);
    ZNRecord record=baseAccessor.get(String.format("%s%s",fallbackRoot,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),Integer.toString(i));
    record=baseAccessor.get(String.format("%s%s",root,path),null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"new" + i);
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailOnMultiGet(){
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String root=String.format("/%s/%s",clusterName,PropertyType.PROPERTYSTORE.name());
  String fallbackRoot=String.format("/%s/%s",clusterName,"HELIX_PROPERTYSTORE");
  ZkBaseDataAccessor<ZNRecord> baseAccessor=new ZkBaseDataAccessor<ZNRecord>(_zkclient);
  for (int i=0; i < 10; i++) {
    String path=String.format("%s/%d",fallbackRoot,i);
    baseAccessor.create(path,new ZNRecord(Integer.toString(i)),AccessOption.PERSISTENT);
  }
  AutoFallbackPropertyStore<ZNRecord> store=new AutoFallbackPropertyStore<ZNRecord>(baseAccessor,root,fallbackRoot);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 20; i++) {
    String path=String.format("/%d",i);
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location");
    if (i < 10) {
      Assert.assertTrue(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should exist under fallback location");
    }
 else {
      Assert.assertFalse(baseAccessor.exists(String.format("%s%s",fallbackRoot,path),0),"Should not exist under fallback location");
    }
    paths.add(path);
  }
  boolean exists[]=store.exists(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertTrue(exists[i]);
    }
 else {
      Assert.assertFalse(exists[i]);
    }
  }
  Stat stats[]=store.getStats(paths,0);
  for (int i=0; i < paths.size(); i++) {
    if (i < 10) {
      Assert.assertNotNull(stats[i]);
    }
 else {
      Assert.assertNull(stats[i]);
    }
  }
  List<ZNRecord> records=store.get(paths,null,0);
  Assert.assertNotNull(records);
  Assert.assertEquals(records.size(),20);
  for (int i=0; i < 20; i++) {
    ZNRecord record=records.get(i);
    String path=paths.get(i);
    if (i < 10) {
      Assert.assertNotNull(record);
      Assert.assertEquals(record.getId(),Integer.toString(i));
    }
 else {
      Assert.assertNull(record);
    }
    Assert.assertFalse(baseAccessor.exists(String.format("%s%s",root,path),0),"Should not exist under new location after get");
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestZkHelixPropertyStore </h4><pre class="type-4 type-7 type-1 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet(){
  System.out.println("START testSet() at " + new Date(System.currentTimeMillis()));
  String subRoot=_root + "/" + "set";
  List<String> subscribedPaths=new ArrayList<String>();
  subscribedPaths.add(subRoot);
  ZkHelixPropertyStore<ZNRecord> store=new ZkHelixPropertyStore<ZNRecord>(new ZkBaseDataAccessor<ZNRecord>(_zkclient),subRoot,subscribedPaths);
  setNodes(store,'a',false);
  for (int i=0; i < 10; i++) {
    for (int j=0; j < 10; j++) {
      String nodeId=getNodeId(i,j);
      String key=getSecondLevelKey(i,j);
      ZNRecord record=store.get(key,null,0);
      Assert.assertEquals(record.getId(),nodeId);
    }
  }
  long startT=System.currentTimeMillis();
  for (int i=0; i < 1000; i++) {
    ZNRecord record=store.get("/node_0/childNode_0_0",null,0);
    Assert.assertNotNull(record);
  }
  long endT=System.currentTimeMillis();
  System.out.println("1000 Get() time used: " + (endT - startT) + "ms");
  long latency=endT - startT;
  Assert.assertTrue(latency < 200,"1000 Gets should be finished within 200ms, but was " + latency + " ms");
  store.stop();
  System.out.println("END testSet() at " + new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.store.zk.TestZkManagerWithAutoFallbackStore </h4><pre class="type-4 type-7 type-1 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  int n=2;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  TestHelper.setupCluster(clusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",false);
  MockParticipant[] participants=new MockParticipant[n];
  for (int i=0; i < 1; i++) {
    String instanceName="localhost_" + (12918 + i);
    participants[i]=new MockParticipant(_zkaddr,clusterName,instanceName);
    participants[i].syncStart();
  }
  BaseDataAccessor<ZNRecord> accessor=participants[0].getHelixDataAccessor().getBaseDataAccessor();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%s/HELIX_PROPERTYSTORE/%d",clusterName,i);
    ZNRecord record=new ZNRecord("" + i);
    record.setSimpleField("key1","value1");
    accessor.set(path,record,AccessOption.PERSISTENT);
  }
  ZkHelixPropertyStore<ZNRecord> store=participants[0].getHelixPropertyStore();
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key1"));
    Assert.assertEquals(record.getSimpleField("key1"),"value1");
  }
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    store.update(path,new DataUpdater<ZNRecord>(){
      @Override public ZNRecord update(      ZNRecord currentData){
        if (currentData != null) {
          currentData.setSimpleField("key2","value2");
        }
        return currentData;
      }
    }
,AccessOption.PERSISTENT);
  }
  for (int i=0; i < 10; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key1"));
    Assert.assertEquals(record.getSimpleField("key1"),"value1");
    Assert.assertNotNull(record.getSimpleField("key2"));
    Assert.assertEquals(record.getSimpleField("key2"),"value2");
  }
  for (int i=10; i < 20; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=new ZNRecord("" + i);
    record.setSimpleField("key3","value3");
    store.set(path,record,AccessOption.PERSISTENT);
  }
  for (int i=10; i < 20; i++) {
    String path=String.format("/%d",i);
    ZNRecord record=store.get(path,null,0);
    Assert.assertNotNull(record);
    Assert.assertEquals(record.getId(),"" + i);
    Assert.assertNotNull(record.getSimpleField("key3"));
    Assert.assertEquals(record.getSimpleField("key3"),"value3");
  }
  participants[0].syncStop();
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.tools.TestZkCopy </h4><pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testSkipCopyExistZnode() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String testName=className + "_" + methodName;
  System.out.println("START " + testName + " at "+ new Date(System.currentTimeMillis()));
  String srcClusterName=testName + "_src";
  String dstClusterName=testName + "_dst";
  int n=5;
  TestHelper.setupCluster(srcClusterName,_zkaddr,12918,"localhost","TestDB",1,32,n,2,"MasterSlave",true);
  TestHelper.setupEmptyCluster(_zkclient,dstClusterName);
  String fromPath=String.format("/%s/INSTANCES",srcClusterName);
  String toPath=String.format("/%s/INSTANCES",dstClusterName);
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  fromPath=String.format("/%s/CONFIGS/PARTICIPANT",srcClusterName);
  toPath=String.format("/%s/CONFIGS/PARTICIPANT",dstClusterName);
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  for (int i=0; i < n; i++) {
    String instanceName="localhost_" + (12918 + i);
    boolean ret=ZKUtil.isInstanceSetup(_zkclient,dstClusterName,instanceName,InstanceType.PARTICIPANT);
    Assert.assertTrue(ret);
  }
  System.out.println("END " + testName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-8 type-2 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  String className=TestHelper.getTestClassName();
  String methodName=TestHelper.getTestMethodName();
  String clusterName=className + "_" + methodName;
  System.out.println("START " + clusterName + " at "+ new Date(System.currentTimeMillis()));
  String fromPath="/" + clusterName + "/from";
  _zkclient.createPersistent(fromPath,true);
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",fromPath,i,j);
      _zkclient.createPersistent(path,true);
      _zkclient.writeData(path,new ZNRecord(String.format("%d/%d",i,j)));
    }
  }
  String toPath="/" + clusterName + "/to";
  ZkCopy.main(new String[]{"--src","zk://" + _zkaddr + fromPath,"--dst","zk://" + _zkaddr + toPath});
  Assert.assertTrue(_zkclient.exists(toPath));
  Assert.assertNull(_zkclient.readData(toPath));
  for (int i=0; i < 5; i++) {
    for (int j=0; j < 5; j++) {
      String path=String.format("%s/%d/%d",toPath,i,j);
      Assert.assertTrue(_zkclient.exists(path));
      ZNRecord record=_zkclient.readData(path);
      Assert.assertEquals(String.format("%d/%d",i,j),record.getId());
    }
  }
  System.out.println("END " + clusterName + " at "+ new Date(System.currentTimeMillis()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.helix.webapp.TestHelixAdminScenariosRest </h4><pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testAddInstance() throws Exception {
  final String clusterName="clusterTestAddInstance";
  addCluster(clusterName);
  String clusterUrl=getClusterUrl(clusterName);
  String instancesUrl=clusterUrl + "/instances";
  addInstancesToCluster(clusterName,"localhost:123",3,null);
  String instances="localhost:1233;localhost:1234;localhost:1235;localhost:1236";
  String response=assertSuccessPostOperation(instancesUrl,addInstanceCmd(instances),false);
  for (int i=3; i <= 6; i++) {
    Assert.assertTrue(response.contains("localhost_123" + i));
  }
  String instanceUrl=instancesUrl + "/localhost_1236";
  deleteUrl(instanceUrl,true);
  response=getUrl(instancesUrl);
  Assert.assertTrue(response.contains("localhost_1236"));
  instanceUrl=instancesUrl + "/localhost_12367";
  deleteUrl(instanceUrl,true);
  response=getUrl(instancesUrl);
  Assert.assertFalse(response.contains("localhost_12367"));
  instanceUrl=instancesUrl + "/localhost_1236";
  response=assertSuccessPostOperation(instanceUrl,enableInstanceCmd(false),false);
  Assert.assertTrue(response.contains("false"));
  deleteUrl(instanceUrl,false);
  final String controllerClusterName="controllerClusterTestAddInstance";
  addCluster(controllerClusterName);
  String controllers="controller:9000;controller:9001";
  String controllerUrl=getClusterUrl(controllerClusterName) + "/instances";
  response=assertSuccessPostOperation(controllerUrl,addInstanceCmd(controllers),false);
  Assert.assertTrue(response.contains("controller_9000"));
  Assert.assertTrue(response.contains("controller_9001"));
  response=assertSuccessPostOperation(instancesUrl,addInstanceCmd("localhost:1234"),true);
  for (int i=0; i < 4; i++) {
    instanceUrl=instancesUrl + "/localhost_123" + i;
    response=assertSuccessPostOperation(instanceUrl,addInstanceTagCmd(_tag1),false);
    Assert.assertTrue(response.contains(_tag1));
  }
  instanceUrl=instancesUrl + "/localhost_1233";
  response=assertSuccessPostOperation(instanceUrl,removeInstanceTagCmd(_tag1),false);
  Assert.assertFalse(response.contains(_tag1));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-14 type-1 type-8 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRebalanceResource() throws Exception {
  final String clusterName="clusterTestRebalanceResource";
  addCluster(clusterName);
  addInstancesToCluster(clusterName,"localhost:123",3,_tag1);
  addResource(clusterName,"db_11",44);
  String resourceUrl=getResourceUrl(clusterName,"db_11");
  String idealStateUrl=resourceUrl + "/idealState";
  String response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  ZNRecord record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  deleteUrl(resourceUrl,false);
  final String reourcesUrl="http://localhost:" + ADMIN_PORT + "/clusters/"+ clusterName+ "/resourceGroups";
  response=getUrl(reourcesUrl);
  Assert.assertFalse(response.contains("db_11"));
  addResource(clusterName,"db_11",48);
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(3,null,null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_11"));
  Assert.assertEquals(record.getListField("db_11_0").size(),3);
  Assert.assertEquals(record.getMapField("db_11_0").size(),3);
  addResource(clusterName,"db_22",55);
  resourceUrl=getResourceUrl(clusterName,"db_22");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",null),false);
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue(record.getId().equalsIgnoreCase("db_22"));
  Assert.assertEquals(record.getListField("alias_0").size(),2);
  Assert.assertEquals(record.getMapField("alias_0").size(),2);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  Assert.assertFalse(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  addResource(clusterName,"db_33",44);
  resourceUrl=getResourceUrl(clusterName,"db_33");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,null,_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
  addResource(clusterName,"db_44",44);
  resourceUrl=getResourceUrl(clusterName,"db_44");
  idealStateUrl=resourceUrl + "/idealState";
  response=assertSuccessPostOperation(idealStateUrl,rebalanceCmd(2,"alias",_tag1),false);
  Assert.assertTrue(response.contains(IdealStateProperty.INSTANCE_GROUP_TAG.toString()));
  Assert.assertTrue(response.contains(_tag1));
  record=JsonToObject(ZNRecord.class,response);
  Assert.assertTrue((((String)(record.getMapFields().keySet().toArray()[0]))).startsWith("alias_"));
  for (int i=0; i < 6; i++) {
    String instance="localhost_123" + i;
    if (i < 3) {
      Assert.assertTrue(response.contains(instance));
    }
 else {
      Assert.assertFalse(response.contains(instance));
    }
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
