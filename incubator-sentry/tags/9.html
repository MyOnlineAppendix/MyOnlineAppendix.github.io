<h3><span class=" glyphicon glyphicon-tag"/>&nbspHybridVerifier</h3><kbd>Contains more than 2 JUnit-based stereotypes</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.sentry.binding.hive.TestSentryHiveAuthorizationTaskFactory </h4><pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW GRANT ROLE ... ON TABLE ...
 */
@Test public void testShowGrantRoleOnTable() throws Exception {
  DDLWork work=analyze(parse("SHOW GRANT ROLE " + ROLE + " ON TABLE "+ TABLE));
  ShowGrantDesc grantDesc=work.getShowGrantDesc();
  Assert.assertNotNull("Show grant should not be null",grantDesc);
  Assert.assertEquals(PrincipalType.ROLE,grantDesc.getPrincipalDesc().getType());
  Assert.assertEquals(ROLE,grantDesc.getPrincipalDesc().getName());
  Assert.assertTrue("Expected table",grantDesc.getHiveObj().getTable());
  Assert.assertEquals(TABLE,grantDesc.getHiveObj().getObject());
  Assert.assertTrue("Expected table",grantDesc.getHiveObj().getTable());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ... ON TABLE ... TO ROLE ... WITH GRANT OPTION
 */
@Test public void testGrantRoleTableWithGrantOption() throws Exception {
  DDLWork work=analyze(parse("GRANT " + ALL + " ON TABLE "+ TABLE+ " TO ROLE "+ ROLE+ " WITH GRANT OPTION"));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  Assert.assertTrue("Expected table",grantDesc.getPrivilegeSubjectDesc().getTable());
  Assert.assertTrue("Expected grantOption is true",grantDesc.isGrantOption());
  Assert.assertEquals(TABLE,grantDesc.getPrivilegeSubjectDesc().getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * CREATE ROLE ...
 */
@Test public void testCreateRole() throws Exception {
  DDLWork work=analyze(parse("CREATE ROLE " + ROLE));
  RoleDDLDesc roleDesc=work.getRoleDDLDesc();
  Assert.assertNotNull("Role should not be null",roleDesc);
  Assert.assertEquals(RoleOperation.CREATE_ROLE,roleDesc.getOperation());
  Assert.assertFalse("Did not expect a group",roleDesc.getGroup());
  Assert.assertEquals(ROLE,roleDesc.getName());
}

</code></pre>

<br>
<pre class="type-7 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP ...
 */
@Test public void testShowRoleGrantGroup() throws Exception {
  DDLWork work=analyze(parse("SHOW ROLE GRANT GROUP " + GROUP));
  RoleDDLDesc roleDesc=work.getRoleDDLDesc();
  Assert.assertNotNull("Role should not be null",roleDesc);
  Assert.assertEquals(RoleOperation.SHOW_ROLE_GRANT,roleDesc.getOperation());
  Assert.assertEquals(PrincipalType.GROUP,roleDesc.getPrincipalType());
  Assert.assertEquals(GROUP,roleDesc.getName());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * REVOKE ... ON TABLE ... FROM ROLE ...
 */
@Test public void testRevokeRoleTable() throws Exception {
  DDLWork work=analyze(parse("REVOKE " + ALL + " ON TABLE "+ TABLE+ " FROM ROLE "+ ROLE));
  RevokeDesc grantDesc=work.getRevokeDesc();
  Assert.assertNotNull("Revoke should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  Assert.assertTrue("Expected table",grantDesc.getPrivilegeSubjectDesc().getTable());
  Assert.assertEquals(TABLE,grantDesc.getPrivilegeSubjectDesc().getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantUri() throws Exception {
  String uriPath="/tmp";
  DDLWork work=analyze(parse("GRANT " + ALL + " ON URI '"+ uriPath+ "' TO ROLE "+ ROLE));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  SentryHivePrivilegeObjectDesc privilegeDesc=(SentryHivePrivilegeObjectDesc)grantDesc.getPrivilegeSubjectDesc();
  Assert.assertTrue("Expected uri",privilegeDesc.getUri());
  Assert.assertEquals(uriPath,privilegeDesc.getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ALL ON SERVER
 */
@Test public void testGrantServer() throws Exception {
  DDLWork work=analyze(parse("GRANT " + ALL + " ON SERVER "+ SERVER+ " TO ROLE "+ ROLE));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  SentryHivePrivilegeObjectDesc privilegeDesc=(SentryHivePrivilegeObjectDesc)grantDesc.getPrivilegeSubjectDesc();
  Assert.assertTrue("Expected server",privilegeDesc.getServer());
  Assert.assertEquals(SERVER,privilegeDesc.getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * DROP ROLE ...
 */
@Test public void testDropRole() throws Exception {
  DDLWork work=analyze(parse("DROP ROLE " + ROLE));
  RoleDDLDesc roleDesc=work.getRoleDDLDesc();
  Assert.assertNotNull("Role should not be null",roleDesc);
  Assert.assertEquals(RoleOperation.DROP_ROLE,roleDesc.getOperation());
  Assert.assertFalse("Did not expect a group",roleDesc.getGroup());
  Assert.assertEquals(ROLE,roleDesc.getName());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ROLE ... TO GROUP ...
 */
@Test public void testGrantRoleGroup() throws Exception {
  DDLWork work=analyze(parse("GRANT ROLE " + ROLE + " TO GROUP "+ GROUP));
  GrantRevokeRoleDDL grantDesc=work.getGrantRevokeRoleDDL();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  Assert.assertTrue("Expected grant ",grantDesc.getGrant());
  Assert.assertFalse("Grant option should be false",grantDesc.isGrantOption());
  Assert.assertEquals(currentUser,grantDesc.getGrantor());
  Assert.assertEquals(PrincipalType.USER,grantDesc.getGrantorType());
  for (  String role : assertSize(1,grantDesc.getRoles())) {
    Assert.assertEquals(ROLE,role);
  }
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipalDesc())) {
    Assert.assertEquals(PrincipalType.GROUP,principal.getType());
    Assert.assertEquals(GROUP,principal.getName());
  }
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ... ON TABLE ... TO ROLE ...
 */
@Test public void testGrantRoleTable() throws Exception {
  DDLWork work=analyze(parse("GRANT " + ALL + " ON TABLE "+ TABLE+ " TO ROLE "+ ROLE));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  Assert.assertTrue("Expected table",grantDesc.getPrivilegeSubjectDesc().getTable());
  Assert.assertEquals(TABLE,grantDesc.getPrivilegeSubjectDesc().getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * REVOKE ROLE ... FROM GROUP ...
 */
@Test public void testRevokeRoleGroup() throws Exception {
  DDLWork work=analyze(parse("REVOKE ROLE " + ROLE + " FROM GROUP "+ GROUP));
  GrantRevokeRoleDDL grantDesc=work.getGrantRevokeRoleDDL();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  Assert.assertFalse("Did not expect grant ",grantDesc.getGrant());
  Assert.assertFalse("Grant option is always true ",grantDesc.isGrantOption());
  Assert.assertEquals(currentUser,grantDesc.getGrantor());
  Assert.assertEquals(PrincipalType.USER,grantDesc.getGrantorType());
  for (  String role : assertSize(1,grantDesc.getRoles())) {
    Assert.assertEquals(ROLE,role);
  }
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipalDesc())) {
    Assert.assertEquals(PrincipalType.GROUP,principal.getType());
    Assert.assertEquals(GROUP,principal.getName());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.binding.solr.TestSolrAuthzBinding </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomGroupMapping() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER.getVar(),"org.apache.sentry.provider.common.HadoopGroupResourceAuthorizationProvider");
  solrAuthzConf.set("hadoop.security.group.mapping",FoobarGroupMappingServiceProvider.class.getName());
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  final String user="userTestSolrAuthzBinding";
  assertEquals(1,binding.getGroups(user).size());
  assertTrue(binding.getGroups(user).contains("foobar"));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for group mapping
 */
@Test public void testGroupMapping() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  Set<String> emptyList=Collections.emptySet();
  try {
    binding.getGroups(null);
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("nonExistantUser");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("corporal");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("sergeant");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("general");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("othergeneralgroup");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  assertEquals(binding.getGroups("corporal1"),Sets.newHashSet("corporal"));
  assertEquals(binding.getGroups("sergeant1"),Sets.newHashSet("sergeant"));
  assertEquals(binding.getGroups("general1"),Sets.newHashSet("general","othergeneralgroup"));
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that incorrect specification of the provider resource
 * throws an exception
 */
@Test public void testResourceNotFound() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER_RESOURCE.getVar(),new File(baseDir,"test-authz-bogus-provider.ini").getPath());
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected InvocationTargetException");
  }
 catch (  InvocationTargetException e) {
    assertTrue(e.getTargetException() instanceof FileNotFoundException);
  }
  solrAuthzConf.unset(AuthzConfVars.AUTHZ_PROVIDER_RESOURCE.getVar());
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected InvocationTargetException");
  }
 catch (  InvocationTargetException e) {
    assertTrue(e.getTargetException() instanceof IllegalArgumentException);
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for role mapping
 */
@Test public void testGetRoles() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  Set<String> emptySet=Collections.emptySet();
  assertEquals(binding.getRoles("undefinedGroupUser"),emptySet);
  assertEquals(binding.getRoles("undefinedRoleUser"),emptySet);
  try {
    binding.getRoles("corporal_role");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getRoles("sergeant_role");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getRoles("general_role");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  assertEquals(binding.getRoles("corporal1"),Sets.newHashSet("corporal_role"));
  assertEquals(binding.getRoles("sergeant1"),Sets.newHashSet("corporal_role","sergeant_role"));
  assertEquals(binding.getRoles("general1"),Sets.newHashSet("corporal_role","sergeant_role","general_role"));
  assertEquals(binding.getRoles("overlappingUser"),Sets.newHashSet("corporal_role","sergeant_role","general_role"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.common.utils.TestPathUtils </h4><pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParseDFSURI() throws Exception {
  assertEquals("hdfs://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("hdfs://namenode:8020/user/hive/warehouse","/tmp/hive-user"));
  assertEquals("hdfs://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("hdfs://namenode:8020/user/hive/warehouse","hdfs://namenode:8020/tmp/hive-user"));
  try {
    PathUtils.parseDFSURI("hdfs://namenode:8020/user/hive/warehouse","tmp/hive-user");
    fail("IllegalArgumentException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("swift://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("swift://namenode:8020/user/hive/warehouse","/tmp/hive-user"));
  assertEquals("swift://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("swift://namenode:8020/user/hive/warehouse","swift://namenode:8020/tmp/hive-user"));
  try {
    PathUtils.parseDFSURI("swift://namenode:8020/user/hive/warehouse","tmp/hive-user");
    fail("IllegalArgumentException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:///tmp/hive-warehouse","/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:///tmp/hive-warehouse","file:/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:///tmp/hive-warehouse","file:///tmp/hive-user"));
  try {
    PathUtils.parseDFSURI("file:///hive-warehouse","tmp/hive-user");
    fail("IllegalArgumentException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:/tmp/hive-warehouse","/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:/tmp/hive-warehouse","file:/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:/tmp/hive-warehouse","file:///tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseURI("testLocal:///tmp/hive-warehouse","/tmp/hive-user",true));
  try {
    PathUtils.parseURI("testLocal:///tmp/hive-warehouse","tmp/hive-user",true);
    fail("IllegalStateException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("/tmp/hive-warehouse","/tmp/hive-user"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestHMSPaths </h4><pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRootEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  root.toString();
  Assert.assertNull(root.getParent());
  Assert.assertEquals(HMSPaths.EntryType.DIR,root.getType());
  Assert.assertTrue(root.getAuthzObjs().size() == 0);
  Assert.assertEquals(Path.SEPARATOR,root.getFullPath());
  Assert.assertTrue(root.getChildren().isEmpty());
  root.delete();
  try {
    root.find(null,true);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(new String[0],true);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(null,false);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(new String[0],false);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  Assert.assertNull(root.find(new String[]{"a"},true));
  Assert.assertNull(root.find(new String[]{"a"},false));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("a")));
  root.delete();
}

</code></pre>

<br>
<pre class="type-7 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAuthzEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry e1=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1"),"A");
  HMSPaths.Entry e2=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p2"),"A");
  Assert.assertEquals(e1,root.find(new String[]{"a","b","t","p1"},true));
  Assert.assertEquals(e1,root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertEquals(e1,root.find(new String[]{"a","b","t","p1","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p1","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
  Assert.assertEquals(e2,root.find(new String[]{"a","b","t","p2"},true));
  Assert.assertEquals(e2,root.find(new String[]{"a","b","t","p2"},false));
  Assert.assertEquals(e2,root.find(new String[]{"a","b","t","p2","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p2","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p2")));
  root.find(new String[]{"a","b","t","p1"},true).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},false));
  root.find(new String[]{"a","b","t","p2"},true).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p2"},false));
  Assert.assertNull(root.find(new String[]{"a","b","t"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p3")));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFurtherAuthzEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b"+ Path.SEPARATOR+ "t"+ Path.SEPARATOR+ "p1",entry.getFullPath());
  try {
    root.createPrefix(Lists.newArrayList("a","b","p1","t","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  HMSPaths.Entry ep2=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1","p2"),"A");
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,ep2.getType());
  Assert.assertEquals("p2",ep2.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1"},true));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p1","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2"},true));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2"},false));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p1","p2","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1","p2")));
  root.find(new String[]{"a","b","t","p1"},false).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},true));
  Assert.assertEquals(HMSPaths.EntryType.DIR,entry.getType());
  Assert.assertEquals(entry.getAuthzObjs().size(),0);
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b","t"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
  Assert.assertNotNull(root.find(new String[]{"a","b","t","p1","p2"},false));
  root.find(new String[]{"a","b","t","p1","p2"},false).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b","t"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testImmediateAuthzEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b"+ Path.SEPARATOR+ "p1",entry.getFullPath());
  try {
    root.createPrefix(Lists.newArrayList("a","b","p1","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1"},true));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1"},false));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","p1","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","p1")));
  root.find(new String[]{"a","b","p1"},true).delete();
  Assert.assertNull(root.find(new String[]{"a","b","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","p1")));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testImmediatePrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry entry=root.createPrefix(Lists.newArrayList("a"));
  entry.toString();
  Assert.assertEquals(1,root.getChildren().size());
  Assert.assertEquals(root,entry.getParent());
  Assert.assertEquals(HMSPaths.EntryType.PREFIX,entry.getType());
  Assert.assertEquals("a",entry.getPathElement());
  Assert.assertEquals(0,entry.getAuthzObjs().size());
  Assert.assertEquals(Path.SEPARATOR + "a",entry.getFullPath());
  Assert.assertTrue(entry.getChildren().isEmpty());
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a","b")));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertNull(root.find(new String[]{"b"},false));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("b")));
  try {
    root.createPrefix(Lists.newArrayList("a","b"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.createPrefix(Lists.newArrayList("a","b","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  entry.delete();
  Assert.assertTrue(root.getChildren().isEmpty());
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFurtherPrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry entry=root.createPrefix(Lists.newArrayList("a","b"));
  entry.toString();
  Assert.assertEquals(1,root.getChildren().size());
  Assert.assertEquals(root,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.PREFIX,entry.getType());
  Assert.assertEquals(HMSPaths.EntryType.DIR,entry.getParent().getType());
  Assert.assertEquals("b",entry.getPathElement());
  Assert.assertEquals("a",entry.getParent().getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().size() == 0);
  Assert.assertTrue(entry.getParent().getAuthzObjs().size() == 0);
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b",entry.getFullPath());
  Assert.assertEquals(Path.SEPARATOR + "a",entry.getParent().getFullPath());
  Assert.assertTrue(entry.getChildren().isEmpty());
  Assert.assertEquals(1,entry.getParent().getChildren().size());
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a","b")));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertNull(root.find(new String[]{"a","b","c"},false));
  try {
    root.createPrefix(Lists.newArrayList("a","b"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.createPrefix(Lists.newArrayList("a","b","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  entry.delete();
  Assert.assertTrue(root.getChildren().isEmpty());
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRootPrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(true);
  root.toString();
  Assert.assertNull(root.find(new String[]{"a"},true));
  Assert.assertNull(root.find(new String[]{"a"},false));
  Assert.assertEquals(root,root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertEquals(root,root.findPrefixEntry(Lists.newArrayList("a","b")));
  try {
    root.createPrefix(Lists.newArrayList("a"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAuthzObjCaseInsensitive(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertTrue(entry.getAuthzObjs().contains("a"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestHMSPathsFullDump </h4><pre class="type-12 type-7 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDumpAndInitialize(){
  HMSPaths hmsPaths=new HMSPaths(new String[]{"/user/hive/warehouse","/user/hive/w2"});
  hmsPaths._addAuthzObject("default",Lists.newArrayList("/user/hive/warehouse"));
  hmsPaths._addAuthzObject("db1",Lists.newArrayList("/user/hive/warehouse/db1"));
  hmsPaths._addAuthzObject("db1.tbl11",Lists.newArrayList("/user/hive/warehouse/db1/tbl11"));
  hmsPaths._addPathsToAuthzObject("db1.tbl11",Lists.newArrayList("/user/hive/warehouse/db1/tbl11/part111","/user/hive/warehouse/db1/tbl11/part112","/user/hive/warehouse/db1/tbl11/p1=1/p2=x"));
  hmsPaths._addAuthzObject("db2",Lists.newArrayList("/user/hive/w2/db2"));
  hmsPaths._addAuthzObject("db2.tbl21",Lists.newArrayList("/user/hive/w2/db2/tbl21"));
  hmsPaths._addPathsToAuthzObject("db2.tbl21",Lists.newArrayList("/user/hive/w2/db2/tbl21/p1=1/p2=x"));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("default")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part111"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part112"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","p1=1","p2=x"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","p1=1"},true));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db2.tbl21")),hmsPaths.findAuthzObject(new String[]{"user","hive","w2","db2","tbl21","p1=1"},true));
  HMSPathsDumper serDe=hmsPaths.getPathsDump();
  TPathsDump pathsDump=serDe.createPathsDump();
  HMSPaths hmsPaths2=new HMSPaths(new String[]{"/user/hive/warehouse"}).getPathsDump().initializeFromDump(pathsDump);
  Assert.assertEquals(new HashSet<String>(Arrays.asList("default")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part111"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part112"},false));
  Assert.assertNull(hmsPaths2.findAuthzObject(new String[]{"user","hive","w2","db2","tbl21","p1=1"},true));
}

</code></pre>

<br>
<pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test ThriftSerializer with a larger message than thrift max message size.
 */
@Test public void testThriftSerializerWithInvalidMsgSize() throws TException, IOException {
  HMSPathsDumper serDe=genHMSPathsDumper();
  TPathsDump pathsDump=serDe.createPathsDump();
  byte[] ser=ThriftSerializer.serialize(pathsDump);
  boolean exceptionThrown=false;
  try {
    ThriftSerializer.maxMessageSize=1024;
    ThriftSerializer.deserialize(new TPathsDump(),ser);
  }
 catch (  IOException e) {
    exceptionThrown=true;
    Assert.assertTrue(e.getCause().getMessage().contains("Length exceeded max allowed:"));
    Assert.assertTrue(e.getMessage().contains("Error deserializing thrift object TPathsDump"));
  }
 finally {
    Assert.assertEquals(true,exceptionThrown);
  }
  ThriftSerializer.maxMessageSize=ServiceConstants.ClientConfig.SENTRY_HDFS_THRIFT_MAX_MESSAGE_SIZE_DEFAULT;
  ThriftSerializer.deserialize(new TPathsDump(),ser);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestMetastoreCacheInitializer </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionInTask() throws Exception {
  Database db1=Mockito.mock(Database.class);
  Mockito.when(db1.getName()).thenReturn("db1");
  Mockito.when(db1.getLocationUri()).thenReturn("hdfs:///db1");
  Table tab1=Mockito.mock(Table.class);
  Mockito.when(tab1.getDbName()).thenReturn("db2");
  Mockito.when(tab1.getTableName()).thenReturn("tab1");
  IHMSHandler hmsHandler=Mockito.mock(IHMSHandler.class);
  Mockito.when(hmsHandler.get_all_databases()).thenReturn(Lists.newArrayList("db1"));
  Mockito.when(hmsHandler.get_database("db1")).thenReturn(db1);
  Mockito.when(hmsHandler.get_table_objects_by_name("db1",Lists.newArrayList("tab1"))).thenReturn(Lists.newArrayList(tab1));
  Mockito.when(hmsHandler.get_all_tables("db1")).thenReturn(Lists.newArrayList("tab1"));
  Configuration conf=new Configuration();
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_MAX_PART_PER_RPC,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_MAX_TABLES_PER_RPC,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_INIT_THREADS,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_RETRY_MAX_NUM,2);
  try {
    MetastoreCacheInitializer cacheInitializer=new MetastoreCacheInitializer(hmsHandler,conf);
    UpdateableAuthzPaths update=cacheInitializer.createInitialUpdate();
    Assert.fail("Expected cacheInitializer to fail");
  }
 catch (  Exception e) {
    Assert.assertTrue(e instanceof RuntimeException);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestSentryAuthorizationProvider </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testProvider() throws Exception {
  admin.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      String sysUser=UserGroupInformation.getCurrentUser().getShortUserName();
      FileSystem fs=FileSystem.get(miniDFS.getConfiguration(0));
      List<AclEntry> baseAclList=new ArrayList<AclEntry>();
      AclEntry.Builder builder=new AclEntry.Builder();
      baseAclList.add(builder.setType(AclEntryType.USER).setScope(AclEntryScope.ACCESS).build());
      baseAclList.add(builder.setType(AclEntryType.GROUP).setScope(AclEntryScope.ACCESS).build());
      baseAclList.add(builder.setType(AclEntryType.OTHER).setScope(AclEntryScope.ACCESS).build());
      Path path1=new Path("/user/authz/obj/xxx");
      fs.mkdirs(path1);
      fs.setAcl(path1,baseAclList);
      fs.mkdirs(new Path("/user/authz/xxx"));
      fs.mkdirs(new Path("/user/xxx"));
      Path path=new Path("/");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user/authz");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user/authz/xxx");
      FileStatus status=fs.getFileStatus(path);
      Assert.assertEquals(sysUser,status.getOwner());
      Assert.assertEquals("supergroup",status.getGroup());
      Assert.assertEquals(new FsPermission((short)0755),status.getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user/authz/obj");
      Assert.assertEquals("hive",fs.getFileStatus(path).getOwner());
      Assert.assertEquals("hive",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0771),fs.getFileStatus(path).getPermission());
      Assert.assertFalse(fs.getAclStatus(path).getEntries().isEmpty());
      List<AclEntry> acls=new ArrayList<AclEntry>();
      acls.add(new AclEntry.Builder().setName(sysUser).setType(AclEntryType.USER).setScope(AclEntryScope.ACCESS).setPermission(FsAction.ALL).build());
      acls.add(new AclEntry.Builder().setName("supergroup").setType(AclEntryType.GROUP).setScope(AclEntryScope.ACCESS).setPermission(FsAction.READ_EXECUTE).build());
      acls.add(new AclEntry.Builder().setName("user-authz").setType(AclEntryType.USER).setScope(AclEntryScope.ACCESS).setPermission(FsAction.ALL).build());
      Assert.assertEquals(new LinkedHashSet<AclEntry>(acls),new LinkedHashSet<AclEntry>(fs.getAclStatus(path).getEntries()));
      path=new Path("/user/authz/obj/xxx");
      Assert.assertEquals("hive",fs.getFileStatus(path).getOwner());
      Assert.assertEquals("hive",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0771),fs.getFileStatus(path).getPermission());
      Assert.assertFalse(fs.getAclStatus(path).getEntries().isEmpty());
      Path path2=new Path("/user/authz/obj/path2");
      fs.mkdirs(path2);
      fs.setAcl(path2,baseAclList);
      path=new Path("/user/xxx");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      System.setProperty("test.stale","true");
      path=new Path("/user/authz/xxx");
      status=fs.getFileStatus(path);
      Assert.assertEquals(sysUser,status.getOwner());
      Assert.assertEquals("supergroup",status.getGroup());
      Assert.assertEquals(new FsPermission((short)0755),status.getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      Path pathOutside=new Path("/user/xxx");
      fs.setPermission(pathOutside,new FsPermission((short)0000));
      Assert.assertEquals(new FsPermission((short)0000),fs.getFileStatus(pathOutside).getPermission());
      fs.setOwner(pathOutside,sysUser,"supergroup");
      Assert.assertEquals(sysUser,fs.getFileStatus(pathOutside).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(pathOutside).getGroup());
      List<AclEntry> aclsOutside=new ArrayList<AclEntry>(baseAclList);
      List<AclEntry> acl=new ArrayList<AclEntry>();
      acl.add(new AclEntry.Builder().setName("supergroup").setType(AclEntryType.GROUP).setScope(AclEntryScope.ACCESS).setPermission(FsAction.READ_EXECUTE).build());
      aclsOutside.addAll(acl);
      fs.setAcl(pathOutside,aclsOutside);
      fs.removeAclEntries(pathOutside,acl);
      Assert.assertFalse(fs.getAclStatus(pathOutside).getEntries().containsAll(acl));
      Path pathInside=new Path("/user/authz/xxx");
      fs.setPermission(pathInside,new FsPermission((short)0000));
      Assert.assertEquals(new FsPermission((short)0000),fs.getFileStatus(pathInside).getPermission());
      fs.setOwner(pathInside,sysUser,"supergroup");
      Assert.assertEquals(sysUser,fs.getFileStatus(pathInside).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(pathInside).getGroup());
      Assert.assertTrue(fs.getAclStatus(pathInside).getEntries().isEmpty());
      fs.removeAclEntries(pathInside,acl);
      Assert.assertTrue(fs.getAclStatus(pathInside).getEntries().isEmpty());
      Path pathInsideAndHive=new Path("/user/authz/obj");
      fs.setPermission(pathInsideAndHive,new FsPermission((short)0000));
      Assert.assertEquals(new FsPermission((short)0771),fs.getFileStatus(pathInsideAndHive).getPermission());
      fs.setOwner(pathInsideAndHive,sysUser,"supergroup");
      Assert.assertEquals("hive",fs.getFileStatus(pathInsideAndHive).getOwner());
      Assert.assertEquals("hive",fs.getFileStatus(pathInsideAndHive).getGroup());
      return null;
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestUpdateForwarder </h4><pre class="type-12 type-7 type-14 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateReceiveWithNullImageRetriver() throws Exception {
  Assume.assumeTrue(!testConf.getBoolean(ServerConfig.SENTRY_HA_ENABLED,false));
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),null,5);
  updateForwarder.handleUpdateNotification(new DummyUpdate(-1,true).setState("a"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(1);
  Assert.assertEquals("a",allUpdates.get(0).getState());
  updateForwarder.handleUpdateNotification(new DummyUpdate(6,false).setState("b"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  updateForwarder.handleUpdateNotification(new DummyUpdate(7,false).setState("c"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(7,updateForwarder.getLastUpdatedSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(2,allUpdates.size());
  Assert.assertEquals("b",allUpdates.get(0).getState());
  Assert.assertEquals("c",allUpdates.get(1).getState());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInit() throws Exception {
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,10);
  Assert.assertEquals(-2,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertTrue(allUpdates.size() == 1);
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  allUpdates=updateForwarder.getAllUpdatesFrom(100);
  Assert.assertTrue(allUpdates.size() == 1);
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  Assert.assertEquals(-2,allUpdates.get(0).getSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(-1);
  Assert.assertEquals(0,allUpdates.size());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-14 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetUpdatesAfterExternalEntityReset() throws Exception {
  Assume.assumeTrue(!testConf.getBoolean(ServerConfig.SENTRY_HA_ENABLED,false));
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,5);
  updateForwarder.handleUpdateNotification(new DummyUpdate(5,false).setState("d"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  updateForwarder.handleUpdateNotification(new DummyUpdate(6,false).setState("e"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(7,false).setState("f"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(7,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(4,allUpdates.size());
  Assert.assertEquals("f",allUpdates.get(3).getState());
  Assert.assertEquals(7,allUpdates.get(3).getSeqNum());
  updateForwarder.handleUpdateNotification(new DummyUpdate(8,false).setState("g"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(8,updateForwarder.getLastUpdatedSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(8);
  Assert.assertEquals(1,allUpdates.size());
  Assert.assertEquals("g",allUpdates.get(0).getState());
  imageRetreiver.setState("a,b,c,d,e,f,g,h");
  updateForwarder.handleUpdateNotification(new DummyUpdate(1,false).setState("h"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  allUpdates=updateForwarder.getAllUpdatesFrom(9);
  Assert.assertEquals(1,allUpdates.size());
  Assert.assertEquals("a,b,c,d,e,f,g,h",allUpdates.get(0).getState());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestUpdateableAuthzPaths </h4><pre class="type-7 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFullUpdate(){
  HMSPaths hmsPaths=createBaseHMSPaths(1,1);
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
  UpdateableAuthzPaths authzPaths=new UpdateableAuthzPaths(hmsPaths);
  PathsUpdate update=new PathsUpdate(1,true);
  update.toThrift().setPathsDump(authzPaths.getPathsDump().createPathsDump());
  UpdateableAuthzPaths authzPaths2=new UpdateableAuthzPaths(new String[]{"/"});
  UpdateableAuthzPaths pre=authzPaths2.updateFull(update);
  assertFalse(pre == authzPaths2);
  authzPaths2=pre;
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
  UpdateableAuthzPaths authzPaths3=new UpdateableAuthzPaths(createBaseHMSPaths(2,1));
  update=new PathsUpdate(2,true);
  update.toThrift().setPathsDump(authzPaths3.getPathsDump().createPathsDump());
  pre=authzPaths2.updateFull(update);
  assertFalse(pre == authzPaths2);
  authzPaths2=pre;
  assertNull(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1"}));
  assertNull(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2"}).contains("db2"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2","tbl21"}).contains("db2.tbl21"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2","tbl21","part211"}).contains("db2.tbl21"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2","tbl21","part212"}).contains("db2.tbl21"));
}

</code></pre>

<br>
<pre class="type-7 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartialUpdateAddPath(){
  HMSPaths hmsPaths=createBaseHMSPaths(1,1);
  UpdateableAuthzPaths authzPaths=new UpdateableAuthzPaths(hmsPaths);
  ReentrantReadWriteLock lock=new ReentrantReadWriteLock();
  PathsUpdate update=new PathsUpdate(2,false);
  TPathChanges pathChange=update.newPathChange("db1.tbl12");
  pathChange.addToAddPaths(PathsUpdate.parsePath("hdfs:///db1/tbl12"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  update=new PathsUpdate(3,false);
  pathChange=update.newPathChange("db1.tbl12");
  pathChange.addToAddPaths(PathsUpdate.parsePath("hdfs:///db1/tbl12/part121"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12"}).contains("db1.tbl12"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12","part121"}).contains("db1.tbl12"));
  update=new PathsUpdate(4,false);
  update.newPathChange("db1.xtbl11").addToAddPaths(PathsUpdate.parsePath("hdfs:///db1/xtbl11"));
  update.newPathChange("db1.tbl11").addToDelPaths(PathsUpdate.parsePath("hdfs:///db1/tbl11"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","xtbl11"}).contains("db1.xtbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.xtbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.xtbl11"));
  assertNull(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","xtbl12"}));
  assertNull(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","xtbl12","part121"}));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12"}).contains("db1.tbl12"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12","part121"}).contains("db1.tbl12"));
}

</code></pre>

<br>
<pre class="type-7 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartialUpdateDelPath(){
  HMSPaths hmsPaths=createBaseHMSPaths(1,1);
  UpdateableAuthzPaths authzPaths=new UpdateableAuthzPaths(hmsPaths);
  ReentrantReadWriteLock lock=new ReentrantReadWriteLock();
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  PathsUpdate update=new PathsUpdate(2,false);
  TPathChanges pathChange=update.newPathChange("db1.tbl11");
  pathChange.addToDelPaths(PathsUpdate.parsePath("hdfs:///db1/tbl11/part111"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  assertNull(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestDBWildcardPrivilege </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnexpected() throws Exception {
  Privilege p=new Privilege(){
    @Override public boolean implies(    Privilege p){
      return false;
    }
  }
;
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.implies(null));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.implies(p));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.equals(null));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.equals(p));
  assertEquals(ROLE_SERVER_SERVER1_DB_ALL.hashCode(),create(ROLE_SERVER_SERVER1_DB_ALL.toString()).hashCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestPolicyParsingNegative </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create policy file with multiple per db files.
 * Verify that a file with bad format is the only one that's ignored
 * @throws Exception
 */
@Test public void testMultiDbWithErrors() throws Exception {
  File db1PolicyFile=new File(baseDir,"db1.ini");
  File db2PolicyFile=new File(baseDir,"db2.ini");
  append("[databases]",globalPolicyFile);
  append("db1 = " + db1PolicyFile.getPath(),globalPolicyFile);
  append("db2 = " + db2PolicyFile.getPath(),globalPolicyFile);
  append("[groups]",globalPolicyFile);
  append("db3_group = db3_rule",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("db3_rule = server=server1->db=db3->table=sales->action=select",globalPolicyFile);
  append("[groups]",db1PolicyFile);
  append("db1_group = bad_rule",db1PolicyFile);
  append("[roles]",db1PolicyFile);
  append("bad_rule = server=server1->db=customers->=purchases->action=",db1PolicyFile);
  append("[groups]",db2PolicyFile);
  append("db2_group = db2_rule",db2PolicyFile);
  append("[roles]",db2PolicyFile);
  append("db2_rule = server=server1->db=db2->table=purchases->action=select",db2PolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("db1_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
  permissions=policy.getAllPrivileges(Sets.newHashSet("db2_group"),ActiveRoleSet.ALL);
  Assert.assertEquals(permissions.toString(),1,permissions.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.common.TestNoAuthorizationProvider </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoAuthorizationProvider(){
  NoAuthorizationProvider nap=new NoAuthorizationProvider();
  assertFalse(nap.hasAccess(null,null,null,null));
  GroupMappingService gms=nap.getGroupMapping();
  assertEquals(gms.getGroups(null).size(),0);
  assertEquals(gms.getGroups("").size(),0);
  assertEquals(gms.getGroups("a").size(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestPrivilegeOperatePersistence </h4><pre class="type-12 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokeCheckWithGrantOption() throws Exception {
  addGroupsToUser(GRANT_OPTION_USER,GRANT_OPTION_GROUP);
  addGroupsToUser(NO_GRANT_OPTION_USER,NO_GRANT_OPTION_GROUP);
  writePolicyFile();
  String roleName1="r1";
  String roleName2="r2";
  String grantor="g1";
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.createRole(SEARCH,roleName2,grantor);
  PrivilegeObject queryPrivilege1=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(true).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege1,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege1),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  PrivilegeObject queryPrivilege2=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(false).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege2,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege2),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  sentryStore.alterRoleAddGroups(SEARCH,roleName1,Sets.newHashSet(GRANT_OPTION_GROUP),grantor);
  sentryStore.alterRoleAddGroups(SEARCH,roleName2,Sets.newHashSet(NO_GRANT_OPTION_GROUP),grantor);
  String roleName3="r3";
  sentryStore.createRole(SEARCH,roleName3,grantor);
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege1,GRANT_OPTION_USER);
  }
 catch (  SentryGrantDeniedException e) {
    fail("SentryGrantDeniedException shouldn't have been thrown");
  }
  try {
    sentryStore.alterRoleRevokePrivilege(SEARCH,roleName3,queryPrivilege1,GRANT_OPTION_USER);
  }
 catch (  SentryGrantDeniedException e) {
    fail("SentryGrantDeniedException shouldn't have been thrown");
  }
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege2,NO_GRANT_OPTION_USER);
    fail("SentryGrantDeniedException should have been thrown");
  }
 catch (  SentryGrantDeniedException e) {
  }
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege2,NO_GRANT_OPTION_USER);
    fail("SentryGrantDeniedException should have been thrown");
  }
 catch (  SentryGrantDeniedException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestSentryRole </h4><pre class="type-12 type-16 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWantGrantPrivilegeTwice() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setURI(SentryStore.NULL_COL);
  hivePrivilege.setColumnName(SentryStore.NULL_COL);
  hivePrivilege.setGrantOption(true);
  MSentryPrivilege hivePrivilege2=new MSentryPrivilege(hivePrivilege);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege2=new MSentryGMPrivilege(solrPrivilege);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  solrPrivilege.appendRole(role);
  hivePrivilege.appendRole(role);
  pm.makePersistent(solrPrivilege);
  pm.makePersistent(hivePrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  if (!role.getGmPrivileges().contains(solrPrivilege2)) {
    fail("unexpect happend: the MSentryGMPrivilege:" + solrPrivilege2 + " already be granted");
  }
  if (!role.getPrivileges().contains(hivePrivilege2)) {
    fail("unexpect happend: the MSentryPrivilege:" + hivePrivilege2 + " already be granted");
  }
  commitTransaction(pm);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeletePrivilegeAndRole() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setURI(SentryStore.NULL_COL);
  hivePrivilege.setColumnName(SentryStore.NULL_COL);
  hivePrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  hivePrivilege.appendRole(role);
  solrPrivilege.appendRole(role);
  pm.makePersistent(hivePrivilege);
  pm.makePersistent(solrPrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  role.removeGMPrivileges();
  role.removePrivileges();
  pm.makePersistent(role);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(0,role.getPrivileges().size());
  assertEquals(0,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.deletePersistent(role);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  assertTrue(role == null);
  commitTransaction(pm);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.thrift.TestSentryGenericServiceIntegration </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleToGroup() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String testGroupName="g1";
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(requestorUserName,Sets.newHashSet(testGroupName));
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(testGroupName));
      Set<TSentryRole> roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        String group : role.getGroups()) {
          assertEquals(testGroupName,group);
        }
      }
      client.deleteRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(testGroupName));
      roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",0,roles.size());
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropShowRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(requestorUserGroupNames));
      Set<TSentryRole> roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
      }
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r1";
      String groupName="group1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(requestorUserName,Sets.newHashSet(groupName));
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(groupName));
      Set<TSentryRole> groupRoles=client.listRolesByGroupName(requestorUserName,groupName,SOLR);
      assertTrue(groupRoles.size() == 1);
      for (      TSentryRole role : groupRoles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        String group : role.getGroups()) {
          assertEquals(groupName,group);
        }
      }
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.tools.TestSentryShellSolr </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"--create_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"-lr","-conf",confPath.getAbsolutePath()};
      SentryShellSolr sentryShell=new SentryShellSolr();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"--drop_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      Set<TSentryRole> roles=client.listAllRoles(requestorName,SOLR);
      assertEquals("Incorrect number of roles",0,roles.size());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.appender.TestRollingFileWithoutDeleteAppender </h4><pre class="type-12 type-16 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Generate log enough to cause a single rollover. Verify the file name format
 * @throws Throwable
 */
@Test public void testFileNamePattern() throws Throwable {
  if (dataDir == null) {
    fail("Excepted temp folder for audit log is created.");
  }
  RollingFileWithoutDeleteAppender appender=new RollingFileWithoutDeleteAppender(new PatternLayout("%m%n"),dataDir.getPath() + "/auditLog.log");
  appender.setMaximumFileSize(10);
  sentryLogger.addAppender(appender);
  sentryLogger.debug("123456789012345");
  File[] files=dataDir.listFiles();
  if (files != null) {
    assertEquals(files.length,2);
    assertTrue(files[0].getName().contains("auditLog.log."));
    assertTrue(files[1].getName().contains("auditLog.log."));
  }
 else {
    fail("Excepted 2 log files.");
  }
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRollOver() throws Throwable {
  if (dataDir == null) {
    fail("Excepted temp folder for audit log is created.");
  }
  RollingFileWithoutDeleteAppender appender=new RollingFileWithoutDeleteAppender(new PatternLayout("%m%n"),dataDir.getPath() + "/auditLog.log");
  appender.setMaximumFileSize(100);
  sentryLogger.addAppender(appender);
  for (int i=0; i < 99; i++) {
    if (i < 10) {
      sentryLogger.debug("Hello---" + i);
    }
 else     if (i < 100) {
      sentryLogger.debug("Hello--" + i);
    }
  }
  if (dataDir != null) {
    File[] files=dataDir.listFiles();
    if (files != null) {
      assertEquals(files.length,10);
    }
 else {
      fail("Excepted 10 log files.");
    }
  }
 else {
    fail("Excepted 10 log files.");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStore </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRenameTableWithColumn() throws Exception {
  String roleName1="role1", roleName2="role2";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setAction(AccessConstants.SELECT);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c1=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c1.setPrivilegeScope("COLUMN");
  privilege_tbl1_c1.setColumnName("c1");
  privilege_tbl1_c1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c2=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c2.setPrivilegeScope("COLUMN");
  privilege_tbl1_c2.setColumnName("c2");
  privilege_tbl1_c2.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c3=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c3.setPrivilegeScope("COLUMN");
  privilege_tbl1_c3.setColumnName("c3");
  privilege_tbl1_c3.setCreateTime(System.currentTimeMillis());
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c1);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c2);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_tbl1_c3);
  Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(2,privilegeSet.size());
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(1,privilegeSet.size());
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(2,privilegeSet.size());
  for (  TSentryPrivilege privilege : privilegeSet) {
    assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
  }
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(1,privilegeSet.size());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRevokeCheckWithGrantOption() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1","user2"};
  String[] roles={"role0","role1","role2"};
  String[] groups={"group0","group1","group2"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("DATABASE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setAction(AccessConstants.SELECT);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor="g1";
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("TABLE");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setTableName(table);
  privilege2.setAction(AccessConstants.ALL);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[2];
  grantor="g1";
  TSentryPrivilege privilege3=new TSentryPrivilege();
  privilege3.setPrivilegeScope("TABLE");
  privilege3.setServerName(server);
  privilege3.setDbName(db);
  privilege3.setTableName(table);
  privilege3.setAction(AccessConstants.SELECT);
  privilege3.setCreateTime(System.currentTimeMillis());
  privilege3.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege3);
  roleName=roles[2];
  grantor=users[1];
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege3);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[1];
  grantor=users[0];
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege2);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[2];
  grantor=users[0];
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege3);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilege() throws Exception {
  String roleName="test-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-550
 * Use case:
 * GRANT INSERT on TABLE tbl1 to ROLE role1
 * GRANT SELECT on TABLE tbl1 to ROLE role1
 * GRANT ALTER on TABLE tbl1 to ROLE role1
 * GRANT DROP on TABLE tbl1 to ROLE role1
 * RENAME TABLE tbl1 to tbl2
 * After rename tbl1 to tbl2, table name of all role1's privileges should be "tbl2"
 */
@Test public void testRenameTableWithMultiAction() throws Exception {
  String roleName1="role1";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction(AccessConstants.INSERT);
  TSentryPrivilege privilege_tbl1_select=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_select.setAction(AccessConstants.SELECT);
  TSentryPrivilege privilege_tbl1_alter=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_alter.setAction(AccessConstants.ALTER);
  TSentryPrivilege privilege_tbl1_drop=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_drop.setAction(AccessConstants.DROP);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_select);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_alter);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_drop);
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(4,privilegeSet.size());
  for (  TSentryPrivilege privilege : privilegeSet) {
    assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
  }
}

</code></pre>

<br>
<pre class="type-7 type-6 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Create several privileges in the database, then delete the role that
 * created them.  This makes them all orphans.  Wait a bit to ensure the
 * cleanup thread runs, and expect them all to be gone from the database.
 * @throws Exception
 */
@Ignore("Disabled with SENTRY-545 following SENTRY-140 problems") @Test public void testPrivilegeCleanup() throws Exception {
  final String roleName="test-priv-cleanup";
  final String grantor="g1";
  final String server="server";
  final String dBase="db";
  final String table="table-";
  sentryStore.createSentryRole(roleName);
  for (int i=0; i < NUM_PRIVS; i++) {
    TSentryPrivilege priv=new TSentryPrivilege();
    priv.setPrivilegeScope("TABLE");
    priv.setServerName(server);
    priv.setAction(AccessConstants.ALL);
    priv.setCreateTime(System.currentTimeMillis());
    priv.setTableName(table + i);
    priv.setDbName(dBase);
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,priv);
  }
  assertEquals(sentryStore.countMSentryPrivileges(),NUM_PRIVS);
  sentryStore.dropSentryRole(roleName);
  verifyOrphanCleanup();
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeColumnPrivilegeDowngradeByDb() throws Exception {
  String roleName="test-column-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeCol1=new TSentryPrivilege();
  privilegeCol1.setPrivilegeScope("COLUMN");
  privilegeCol1.setServerName(server);
  privilegeCol1.setDbName(db);
  privilegeCol1.setTableName(table);
  privilegeCol1.setColumnName(column1);
  privilegeCol1.setAction(AccessConstants.ALL);
  privilegeCol1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeCol2=privilegeCol1.deepCopy();
  ;
  privilegeCol2.setColumnName(column2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeCol2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilegeCol2.setAction(AccessConstants.INSERT);
  privilegeCol2.setPrivilegeScope("DATABASE");
  privilegeCol2.unsetTableName();
  privilegeCol2.unsetColumnName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(column1,mPrivilege.getColumnName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeTablePrivilegeDowngradeByDb() throws Exception {
  String roleName="test-table-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table1="tbl1";
  String table2="tbl2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeTable1=new TSentryPrivilege();
  privilegeTable1.setPrivilegeScope("TABLE");
  privilegeTable1.setServerName(server);
  privilegeTable1.setDbName(db);
  privilegeTable1.setTableName(table1);
  privilegeTable1.setAction(AccessConstants.ALL);
  privilegeTable1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeTable2=privilegeTable1.deepCopy();
  ;
  privilegeTable2.setTableName(table2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeTable2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getTableName().equals(table1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getTableName().equals(table2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected table name: " + mPrivilege.getTableName());
    }
  }
  privilegeTable2.setAction(AccessConstants.INSERT);
  privilegeTable2.setPrivilegeScope("DATABASE");
  privilegeTable2.unsetTableName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table1,mPrivilege.getTableName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantCheckWithColumn() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1"};
  String[] roles={"role0","role1"};
  String[] groups={"group0","group1"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("TABLE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setTableName(table);
  privilege1.setAction(AccessConstants.SELECT);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor=users[0];
  String column="c1";
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("COLUMN");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setTableName(table);
  privilege2.setColumnName(column);
  privilege2.setAction(AccessConstants.SELECT);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[0];
  grantor=users[1];
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege1);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[1];
  grantor=users[0];
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege2);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
}

</code></pre>

<br>
<pre class="type-17 type-12 type-7 type-6 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Much like testPrivilegeCleanup, make a lot of privileges and make sure
 * they get cleaned up.  The difference here is that the privileges are
 * created by granting ALL and then removing SELECT - thus leaving INSERT.
 * This test exists because the revocation plays havoc with the orphan
 * cleanup thread.
 * @throws Exception
 */
@Ignore("Disabled with SENTRY-545 following SENTRY-140 problems") @Test public void testPrivilegeCleanup2() throws Exception {
  final String roleName="test-priv-cleanup";
  final String grantor="g1";
  final String server="server";
  final String dBase="db";
  final String table="table-";
  sentryStore.createSentryRole(roleName);
  for (int i=0; i < NUM_PRIVS; i++) {
    TSentryPrivilege priv=new TSentryPrivilege();
    priv.setPrivilegeScope("DATABASE");
    priv.setServerName(server);
    priv.setAction(AccessConstants.ALL);
    priv.setCreateTime(System.currentTimeMillis());
    priv.setTableName(table + i);
    priv.setDbName(dBase);
    priv.setGrantOption(TSentryGrantOption.TRUE);
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,priv);
    priv.setAction(AccessConstants.SELECT);
    priv.setGrantOption(TSentryGrantOption.UNSET);
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,priv);
    MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
    Set<MSentryPrivilege> privileges=role.getPrivileges();
    assertEquals(privileges.toString(),i + 1,privileges.size());
    MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
    assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
  }
  sentryStore.dropSentryRole(roleName);
  verifyOrphanCleanup();
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create roles and assign privileges for same table rename the privileges for
 * the table and verify the new privileges
 * @throws Exception
 */
@Test public void testRenameTable() throws Exception {
  String roleName1="role1", roleName2="role2", roleName3="role3";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  sentryStore.createSentryRole(roleName3);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction(AccessConstants.INSERT);
  TSentryPrivilege privilege_tbl1_select=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_select.setAction(AccessConstants.SELECT);
  TSentryPrivilege privilege_tbl1_all=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_all.setAction(AccessConstants.ALL);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_tbl1_select);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName3,privilege_tbl1_all);
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  for (  String roleName : Sets.newHashSet(roleName1,roleName2,roleName3)) {
    Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName);
    assertEquals(1,privilegeSet.size());
    for (    TSentryPrivilege privilege : privilegeSet) {
      assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
    }
  }
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantCheckWithGrantOption() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1","user2","user3","user4"};
  String[] roles={"role0","role1","role2","role3","role4"};
  String[] groups={"group0","group1","group2","group3","group4"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("DATABASE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setAction(AccessConstants.ALL);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor=users[0];
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("DATABASE");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setAction(AccessConstants.SELECT);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[2];
  grantor=users[0];
  TSentryPrivilege privilege3=new TSentryPrivilege();
  privilege3.setPrivilegeScope("TABLE");
  privilege3.setServerName(server);
  privilege3.setDbName(db);
  privilege3.setTableName(table);
  privilege3.setAction(AccessConstants.ALL);
  privilege3.setCreateTime(System.currentTimeMillis());
  privilege3.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege3);
  roleName=roles[3];
  grantor=users[1];
  TSentryPrivilege privilege4=new TSentryPrivilege();
  privilege4.setPrivilegeScope("DATABASE");
  privilege4.setServerName(server);
  privilege4.setDbName(db);
  privilege4.setAction(AccessConstants.INSERT);
  privilege4.setCreateTime(System.currentTimeMillis());
  privilege4.setGrantOption(TSentryGrantOption.FALSE);
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege4);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[4];
  grantor=users[2];
  TSentryPrivilege privilege5=new TSentryPrivilege();
  privilege5.setPrivilegeScope("TABLE");
  privilege5.setServerName(server);
  privilege5.setDbName(db);
  privilege5.setTableName(table);
  privilege5.setAction(AccessConstants.INSERT);
  privilege5.setCreateTime(System.currentTimeMillis());
  privilege5.setGrantOption(TSentryGrantOption.FALSE);
  isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege5);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
}

</code></pre>

<br>
<pre class="type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-74 and SENTRY-552
 */
@Test public void testGrantRevokePrivilegeWithColumn() throws Exception {
  String roleName="test-col-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("COLUMN");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setColumnName(column1);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  privilege.setColumnName(column2);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.INSERT);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  assertEquals(column1,Iterables.get(privileges,0).getColumnName());
  assertEquals(AccessConstants.SELECT,Iterables.get(privileges,0).getAction());
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 5,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),0,privileges.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceFailureCase </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClientServerConnectionFailure() throws Exception {
  try {
    connectToSentryService();
    Assert.fail("Failed to receive Exception");
  }
 catch (  PrivilegedActionException e) {
    LOGGER.info("Excepted exception",e);
    Exception cause=e.getException();
    if (cause == null) {
      throw e;
    }
    String msg="Exception message: " + cause.getMessage() + " to contain "+ PEER_CALLBACK_FAILURE;
    Assert.assertTrue(msg,Strings.nullToEmpty(cause.getMessage()).contains(PEER_CALLBACK_FAILURE));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceIntegration </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String server="server1";
      String db="testDB";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantDatabasePrivilege(requestorUserName,roleName,server,db,AccessConstants.ALL);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 1);
      client.revokeDatabasePrivilege(requestorUserName,roleName,server,db,AccessConstants.ALL);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGranRevokePrivilegeOnColumnForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table2","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table2","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db2","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db2","table2","col1","ALL");
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table1","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db2","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db2","table2","col1","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertEquals("Privilege not assigned to role1 !!",6,listPrivilegesByRoleName.size());
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertEquals("Privilege not assigned to role2 !!",6,listPrivilegesByRoleName.size());
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 5);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 6);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 4);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 5);
      client.revokeDatabasePrivilege(requestorUserName,roleName1,"server","db1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 2);
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db2","table1","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db2","table2","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col2","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db2","table1","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db2","table2","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGranRevokePrivilegeOnTableForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertEquals("Privilege not assigned to role1 !!",4,listPrivilegesByRoleName.size());
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertEquals("Privilege not assigned to role2 !!",4,listPrivilegesByRoleName.size());
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 4);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUriWithEquals() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String server="server1";
      String uri="file://u/w/h/t/partition=value/";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantURIPrivilege(requestorUserName,roleName,server,uri);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 1);
      client.revokeURIPrivilege(requestorUserName,roleName,server,uri);
      privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 0);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String groupName="group1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantRoleToGroup(requestorUserName,groupName,roleName);
      Set<TSentryRole> groupRoles=client.listRolesByGroupName(requestorUserName,groupName);
      assertTrue(groupRoles.size() == 1);
      for (      TSentryRole role : groupRoles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        TSentryGroup group : role.getGroups()) {
          assertTrue(group.getGroupName(),group.getGroupName().equalsIgnoreCase(groupName));
        }
      }
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropShowRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
      }
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * List privileges by authorizables executed by non-admin user
 * Test various positive and negative cases for non-admin user
 * @throws Exception
 */
@Test public void testListByAuthTabForNonAdmin() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      String user1="user1";
      String group1="group1";
      String group2="group2";
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      Set<String> userGroupNames1=Sets.newHashSet(group1);
      Set<String> userGroupNames2=Sets.newHashSet(group2);
      String roleName1="role1";
      String roleName2="role2";
      String server="server1";
      String db="testDB";
      String db2="testDB2";
      String tab="testTab";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(user1,userGroupNames1);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantDatabasePrivilege(requestorUserName,roleName1,server,db,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db,tab,AccessConstants.ALL);
      TSentryPrivilege role1db2tab=client.grantTablePrivilege(requestorUserName,roleName1,server,db2,tab,AccessConstants.SELECT);
      client.grantRoleToGroup(requestorUserName,group1,roleName1);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db,AccessConstants.ALL);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db2,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName2,server,db2,tab,AccessConstants.ALL);
      client.grantURIPrivilege(requestorUserName,roleName1,server,"hdfs:///fooUri");
      TSentryPrivilegeMap db1RoleToPrivMap=new TSentryPrivilegeMap(new TreeMap<String,Set<TSentryPrivilege>>());
      db1RoleToPrivMap.getPrivilegeMap().put(roleName1,Sets.newHashSet(role1db2tab));
      Map<TSentryAuthorizable,TSentryPrivilegeMap> expectedResults=Maps.newTreeMap();
      List<? extends Authorizable> db2TabAuthorizable=Lists.newArrayList(new Server(server),new Database(db2),new Table(tab));
      expectedResults.put(SentryPolicyServiceClientDefaultImpl.setupSentryAuthorizable(db2TabAuthorizable),db1RoleToPrivMap);
      Set<List<? extends Authorizable>> authorizableSet=Sets.newHashSet();
      authorizableSet.add(db2TabAuthorizable);
      Map<TSentryAuthorizable,TSentryPrivilegeMap> authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,new HashSet<String>(),null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,new ActiveRoleSet(true));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames1,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames1,new ActiveRoleSet(true));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,new ActiveRoleSet(Sets.newHashSet(roleName1.toUpperCase())));
      assertEquals(expectedResults,authPrivMap);
      try {
        client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames2,null);
        fail("listPrivilegsbyAuthorizable() should fail for user1 accessing " + group2);
      }
 catch (      SentryAccessDeniedException e) {
      }
      ActiveRoleSet roleSet2=new ActiveRoleSet(Sets.newHashSet(roleName2));
      try {
        client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,roleSet2);
        fail("listPrivilegsbyAuthorizable() should fail for user1 accessing " + roleName2);
      }
 catch (      SentryAccessDeniedException e) {
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceWithInvalidMsgSize </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the case when the message size is larger than the server's thrift max message size.
 */
@Test public void testServerWithSmallMaxMsgSize() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Configuration confWithSmallMaxMsgSize=new Configuration(conf);
      confWithSmallMaxMsgSize.setLong(ServiceConstants.ServerConfig.SENTRY_POLICY_SERVER_THRIFT_MAX_MESSAGE_SIZE,50);
      stopSentryService();
      server=new SentryServiceFactory().create(confWithSmallMaxMsgSize);
      startSentryService();
      setLocalGroupMapping(ADMIN_USER,REQUESTER_USER_GROUP_NAMES);
      writePolicyFile();
      client.listRoles(ADMIN_USER);
      client.createRole(ADMIN_USER,ROLE_NAME);
      boolean exceptionThrown=false;
      try {
        client.grantServerPrivilege(ADMIN_USER,ROLE_NAME,"server",false);
      }
 catch (      SentryUserException e) {
        exceptionThrown=true;
        Assert.assertTrue(e.getMessage().contains("org.apache.thrift.transport.TTransportException"));
      }
 finally {
        Assert.assertEquals(true,exceptionThrown);
      }
      Set<TSentryRole> roles=client.listRoles(ADMIN_USER);
      Assert.assertTrue(roles.size() == 1);
      Assert.assertEquals(ROLE_NAME,roles.iterator().next().getRoleName());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the case when the message size is larger than the client's thrift max message size.
 */
@Test public void testClientWithSmallMaxMsgSize() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Configuration confWithSmallMaxMsgSize=new Configuration(conf);
      confWithSmallMaxMsgSize.setLong(ServiceConstants.ClientConfig.SENTRY_POLICY_CLIENT_THRIFT_MAX_MESSAGE_SIZE,20);
      SentryPolicyServiceClient clientWithSmallMaxMsgSize=SentryServiceClientFactory.create(confWithSmallMaxMsgSize);
      setLocalGroupMapping(ADMIN_USER,REQUESTER_USER_GROUP_NAMES);
      writePolicyFile();
      boolean exceptionThrown=false;
      try {
        clientWithSmallMaxMsgSize.listRoles(ADMIN_USER);
      }
 catch (      SentryUserException e) {
        exceptionThrown=true;
        Assert.assertTrue(e.getMessage().contains("Thrift exception occurred"));
        Assert.assertTrue(e.getCause().getMessage().contains("Length exceeded max allowed"));
      }
 finally {
        Assert.assertEquals(true,exceptionThrown);
        clientWithSmallMaxMsgSize.close();
      }
      client.dropRoleIfExists(ADMIN_USER,ROLE_NAME);
      client.listRoles(ADMIN_USER);
      client.createRole(ADMIN_USER,ROLE_NAME);
      client.listRoles(ADMIN_USER);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryWebServerWithKerberos </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPingWithoutSubject() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  try {
    new AuthenticatedURL(new KerberosAuthenticator()).openConnection(url,new AuthenticatedURL.Token());
    fail("Here should fail.");
  }
 catch (  Exception e) {
    boolean isExpectError=e.getMessage().contains("No valid credentials provided");
    Assert.assertTrue("Here should fail by 'No valid credentials provided'," + " but the exception is:" + e,isExpectError);
  }
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPingUsingHttpURLConnection() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  HttpURLConnection conn=(HttpURLConnection)url.openConnection();
  Assert.assertEquals(HttpURLConnection.HTTP_UNAUTHORIZED,conn.getResponseCode());
  String errorMessage=IOUtils.toString(conn.getErrorStream());
  Assert.assertTrue(errorMessage.contains("Authentication required"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.tools.TestSentryShellHive </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilegeWithLongOption() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--list_privilege","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> privilegeStrs=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of privileges",6,privilegeStrs.size());
      assertTrue(privilegeStrs.contains("server=server1->action=*"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->action=select"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true"));
      assertTrue(privilegeStrs.contains("server=server1->uri=hdfs://path/testuri->action=*"));
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",5,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",4,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",3,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",2,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",1,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",0,privileges.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilegeWithShortOption() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lp","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> privilegeStrs=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of privileges",6,privilegeStrs.size());
      assertTrue(privilegeStrs.contains("server=server1->action=*"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->action=select"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true"));
      assertTrue(privilegeStrs.contains("server=server1->uri=hdfs://path/testuri->action=*"));
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",5,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",4,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",3,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",2,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",1,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",0,privileges.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleForGroup() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"-arg","-r",TEST_ROLE_NAME_1,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-arg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--add_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lr","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-g","testGroup2","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",1,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-g","testGroup3","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",1,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--delete_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryRole> roles=client.listRolesByGroupName(requestorName,"testGroup1");
      assertEquals("Incorrect number of roles",0,roles.size());
      roles=client.listRolesByGroupName(requestorName,"testGroup2");
      assertEquals("Incorrect number of roles",0,roles.size());
      roles=client.listRolesByGroupName(requestorName,"testGroup3");
      assertEquals("Incorrect number of roles",0,roles.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--create_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lr","-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--drop_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryRole> roles=client.listRoles(requestorName);
      assertEquals("Incorrect number of roles",0,roles.size());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.file.TestLocalGroupMapping </h4><pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGroupMapping(){
  Set<String> fooGroupsFromResource=localGroupMapping.getGroups("foo");
  Assert.assertEquals(fooGroupsFromResource,fooGroups);
  Set<String> barGroupsFromResource=localGroupMapping.getGroups("bar");
  Assert.assertEquals(barGroupsFromResource,barGroups);
  try {
    localGroupMapping.getGroups("unknown");
    Assert.fail("SentryGroupNotFoundException should be thrown.");
  }
 catch (  SentryGroupNotFoundException sgnfe) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestColumnEndToEnd </h4><pre class="type-12 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDescribeTbl() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE IF NOT EXISTS t1 (c1 string, c2 string)");
  statement.execute("CREATE TABLE t2 (c1 string, c2 string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE user_role1");
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  ResultSet rs=statement.executeQuery("DESCRIBE t1");
  assertTrue(rs.next());
  assertEquals("c1",rs.getString(1));
  assertEquals("string",rs.getString(2));
  assertTrue(rs.next());
  assertEquals("c2",rs.getString(1));
  assertEquals("string",rs.getString(2));
  statement.executeQuery("DESCRIBE t1 c1");
  statement.executeQuery("DESCRIBE t1 c2");
  try {
    statement.executeQuery("DESCRIBE t2");
    fail("Expected DESCRIBE to fail on t2");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE FORMATTED t1");
    fail("Expected DESCRIBE FORMATTED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE EXTENDED t1");
    fail("Expected DESCRIBE EXTENDED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP TABLE t1");
  statement.execute("DROP TABLE t2");
  statement.execute("DROP ROLE user_role1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestConcurrentClients </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test when concurrent HS2 clients talking to server,
 * Privileges are correctly created and updated.
 * @throws Exception
 */
@Test public void testConccurentHS2Client() throws Exception {
  ExecutorService executor=Executors.newFixedThreadPool(NUM_OF_THREADS);
  final TestRuntimeState state=new TestRuntimeState();
  for (int i=0; i < NUM_OF_TASKS; i++) {
    executor.execute(new Runnable(){
      @Override public void run(){
        LOGGER.info("Starting tests: create role, show role, create db and tbl, and create partitions");
        if (state.failed)         return;
        try {
          Long startTime=System.currentTimeMillis();
          Long elapsedTime=0L;
          while (Long.compare(elapsedTime,HS2_CLIENT_TEST_DURATION_MS) <= 0) {
            String randStr=randomString(5);
            String test_role="test_role_" + randStr;
            String test_db="test_db_" + randStr;
            String test_tb="test_tb_" + randStr;
            LOGGER.info("Start to test sentry with hs2 client with role " + test_role);
            adminCreateRole(test_role);
            adminShowRole(test_role);
            createDbTb(ADMIN1,test_db,test_tb);
            adminGrant(test_db,test_tb,test_role,USERGROUP1);
            createPartition(USER1_1,test_db,test_tb);
            adminCleanUp(test_db,test_role);
            elapsedTime=System.currentTimeMillis() - startTime;
            LOGGER.info("elapsedTime = " + elapsedTime);
          }
          state.setNumSuccess();
        }
 catch (        Exception e) {
          LOGGER.error("Exception: " + e);
          state.setFirstException(e);
        }
      }
    }
);
  }
  executor.shutdown();
  while (!executor.isTerminated()) {
    Thread.sleep(1000);
  }
  Throwable ex=state.getFirstException();
  assertFalse(ex == null ? "Test failed" : ex.toString(),state.failed);
  assertEquals(NUM_OF_TASKS,state.getNumSuccess());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test when concurrent sentry clients talking to sentry server, threads data are synchronized
 * @throws Exception
 */
@Test public void testConcurrentSentryClient() throws Exception {
  final String HIVE_KEYTAB_PATH=System.getProperty("sentry.e2etest.hive.policyOwnerKeytab");
  final SentryPolicyServiceClient client=getSentryClient("hive",HIVE_KEYTAB_PATH);
  ExecutorService executor=Executors.newFixedThreadPool(NUM_OF_THREADS);
  final TestRuntimeState state=new TestRuntimeState();
  for (int i=0; i < NUM_OF_TASKS; i++) {
    LOGGER.info("Start to test sentry client with task id [" + i + "]");
    executor.execute(new Runnable(){
      @Override public void run(){
        if (state.failed) {
          LOGGER.error("found one failed state, abort test from here.");
          return;
        }
        try {
          String randStr=randomString(5);
          String test_role="test_role_" + randStr;
          LOGGER.info("Start to test role: " + test_role);
          Long startTime=System.currentTimeMillis();
          Long elapsedTime=0L;
          while (Long.compare(elapsedTime,SENTRY_CLIENT_TEST_DURATION_MS) <= 0) {
            LOGGER.info("Test role " + test_role + " runs "+ elapsedTime+ " ms.");
            client.createRole(ADMIN1,test_role);
            client.listRoles(ADMIN1);
            client.grantServerPrivilege(ADMIN1,test_role,"server1",false);
            client.listAllPrivilegesByRoleName(ADMIN1,test_role);
            client.dropRole(ADMIN1,test_role);
            elapsedTime=System.currentTimeMillis() - startTime;
          }
          state.setNumSuccess();
        }
 catch (        Exception e) {
          LOGGER.error("Sentry Client Testing Exception: ",e);
          state.setFirstException(e);
        }
      }
    }
);
  }
  executor.shutdown();
  while (!executor.isTerminated()) {
    Thread.sleep(1000);
  }
  Throwable ex=state.getFirstException();
  assertFalse(ex == null ? "Test failed" : ex.toString(),state.failed);
  assertEquals(NUM_OF_TASKS,state.getNumSuccess());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDatabaseProvider </h4><pre class="type-17 type-12 type-10 type-19 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON URI uriName: Needs Hive patch
 * @throws Exception
 */
@Ignore @Test public void testShowPrivilegesByRoleOnUri() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON URI 'file:///tmp/file.txt'");
  assertTrue("Expecting SQL Exception",false);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. Show role grant works for non-admin users when the user belongs to the requested group
 * 4.2. Show role grant FAILS for non-admin users when the user doesn't belongs to the requested group
 */
@Test public void testShowRolesByGroupNonAdmin() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP2);
  statement.execute("GRANT ROLE role1 to GROUP " + ADMINGROUP);
  statement.execute("GRANT ROLE role2 to GROUP " + ADMINGROUP);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + ADMINGROUP,SentryAccessDeniedException.class.getSimpleName());
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP2);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role2"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-303 and SENTRY-543.
 */
@Test public void testGrantRevokeSELECTonDb() throws Exception {
  File dataFile=doSetupForGrantDbTests();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("GRANT SELECT ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("SELECT * FROM " + DB1 + ".t2");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("only SELECT allowed on t1!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t2");
    assertTrue("only SELECT allowed on t2!!",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("REVOKE SELECT ON DATABASE " + DB1 + " FROM ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    fail("SELECT should have been revoked from t1");
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    fail("SELECT should have been revoked from t2");
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  String testRole0="role1", testRole1="role2";
  statement.execute("CREATE ROLE " + testRole0);
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("GRANT ROLE " + testRole0 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ USERGROUP1);
  statement.execute("SET ROLE " + testRole0);
  try {
    statement.execute("SET ROLE " + testRole1);
    fail("User " + ADMIN1 + " shouldn't be able to set "+ testRole1);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SET ROLE " + testRole1);
  try {
    statement.execute("SET ROLE " + testRole0);
    fail("User " + USER1_1 + " shouldn't be able to set "+ testRole0);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbConnections </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Currently the hive binding opens a new server connection for each
 * statement. This test verifies that the client connection is closed properly
 * at the end. Test Queries, DDLs, Auth DDLs and metadata filtering (eg show
 * tables/databases)
 * @throws Exception
 */
@Test public void testClientConnections() throws Exception {
  String roleName="connectionTest";
  long preConnectionClientId;
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("CREATE DATABASE DB_1");
  statement.execute("USE DB_1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("CREATE TABLE t1 (c1 string)");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("SELECT * FROM t1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.executeQuery("show tables");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("DROP TABLE t1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("CREATE ROLE " + roleName);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  context.assertSentryException(statement,"CREATE ROLE " + roleName,SentryAlreadyExistsException.class.getSimpleName());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  statement.execute("DROP ROLE " + roleName);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.executeQuery("show tables");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  statement.close();
  connection.close();
  assertEquals(0,getSentrySrv().getNumActiveClients());
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  context.assertAuthzException(statement,"USE DB_1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  context.assertSentryException(statement,"CREATE ROLE " + roleName,SentryAccessDeniedException.class.getSimpleName());
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.executeQuery("show databases");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  statement.close();
  connection.close();
  assertEquals(0,getSentrySrv().getNumActiveClients());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbEndToEnd </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUPrivileges() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("CREATE ROLE uri_role");
  statement.execute("GRANT SELECT ON URI 'file://" + dataDir.getPath() + "' TO ROLE uri_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE uri_role TO GROUP " + USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE uri_role");
  assertTrue(resultSet.next());
  assertEquals("file://" + dataDir.getPath(),resultSet.getString(1));
  resultSet.close();
  resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertTrue(resultSet.next());
  assertEquals("default",resultSet.getString(1));
  assertEquals("t1",resultSet.getString(2));
  resultSet.close();
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestConfigTool </h4><pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify errors/warnings from malformed policy file
 * @throws Exception
 */
@Test public void testInvalidPolicy() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=db1->table=tab1->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setupConfig();
  try {
    configTool.getSentryProvider().validateResource(true);
    fail("Policy validation should fail for malformed policy");
  }
 catch (  SentryConfigurationException e) {
    assertTrue(e.getConfigWarnings().get(0).contains("Role select_tab3 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(1).contains("Role insert_tab2 for group " + USERGROUP1 + " does not exist"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * verify missing permissions for query using remote query validation
 * @throws Exception
 */
@Test public void testQueryPermissions() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addRolesToGroup(USERGROUP3,"select_colAB").addRolesToGroup(USERGROUP4,"select_colA").addPermissionsToRole("select_tab1","server=server1->db=default->table=tab1->action=select").addPermissionsToRole("insert_tab2","server=server1->db=default->table=tab2->action=insert").addPermissionsToRole("select_tab3","server=server1->db=default->table=tab3->action=select").addPermissionsToRole("select_colA","server=server1->db=default->table=tab1->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=default->table=tab1->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=default->table=tab1->column=b->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS tab1");
  statement.execute("DROP TABLE IF EXISTS tab2");
  statement.execute("DROP TABLE IF EXISTS tab3");
  statement.execute("CREATE TABLE tab1(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE tab2(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE tab3(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.close();
  connection.close();
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setJdbcURL(context.getConnectionURL());
  configTool.setUser(USER1_1);
  configTool.setupConfig();
  ByteArrayOutputStream errBuffer=new ByteArrayOutputStream();
  configTool.setUser(USER1_1);
  configTool.verifyRemoteQuery("SELECT COUNT(*) FROM tab1");
  try {
    System.setOut(new PrintStream(errBuffer));
    configTool.setUser(USER1_1);
    configTool.verifyRemoteQuery("SELECT COUNT(*) FROM tab3");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab3->action=select"));
    errBuffer.flush();
  }
  try {
    configTool.setUser(USER2_1);
    configTool.verifyRemoteQuery("INSERT OVERWRITE TABLE tab2 SELECT * FROM tab3");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab2->action=insert"));
    errBuffer.flush();
  }
  configTool.setUser(USER3_1);
  configTool.verifyRemoteQuery("SELECT a FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(a) FROM tab1");
  configTool.verifyRemoteQuery("SELECT b FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(b) FROM tab1");
  configTool.verifyRemoteQuery("SELECT a,b FROM tab1");
  configTool.setUser(USER4_1);
  configTool.verifyRemoteQuery("SELECT a FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(a) FROM tab1");
  try {
    configTool.setUser(USER4_1);
    configTool.verifyRemoteQuery("SELECT b FROM tab1");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab1->Column=b->action=select"));
    errBuffer.flush();
  }
  try {
    configTool.setUser(USER4_1);
    configTool.verifyRemoteQuery("SELECT COUNT(b) FROM tab1");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab1->Column=b->action=select"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify errors/warnings from malformed policy file with per-DB policy
 * @throws Exception
 */
@Test public void testInvalidPerDbPolicy() throws Exception {
  PolicyFile db2PolicyFile=new PolicyFile();
  File db2PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB2_POLICY_FILE);
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl2","insert_db2_tab2").addPermissionsToRole("select_tbl2","server=server1->db=db2->table=tbl2->action=select").write(db2PolicyFileHandle);
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl3").addPermissionsToRole("select_tbl1","server=server1->db=db1->table=tbl1->action=select").addDatabase("db2",prefix + db2PolicyFileHandle.getName()).setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setupConfig();
  try {
    configTool.getSentryProvider().validateResource(true);
    fail("Policy validation should fail for malformed policy");
  }
 catch (  SentryConfigurationException e) {
    assertTrue(e.getConfigWarnings().get(0).contains("Role select_tbl3 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(0).contains(context.getPolicyFile().getName()));
    assertTrue(e.getConfigWarnings().get(1).contains("Role insert_db2_tab2 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(1).contains(db2PolicyFileHandle.getName()));
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the mock compilation config setting forces query to abort
 * @throws Exception
 */
@Test public void testMockCompilation() throws Exception {
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS tab1");
  statement.execute("CREATE TABLE tab1(B INT, A STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("SELECT * FROM tab1");
  statement.execute("SET " + HiveAuthzConf.HIVE_SENTRY_MOCK_COMPILATION + "=true");
  try {
    statement.execute("SELECT * FROM tab1");
    fail("Query should fail with mock error config enabled");
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains(HiveAuthzConf.HIVE_SENTRY_MOCK_ERROR));
  }
  statement.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestJDBCInterface </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJDBCGetSchemasAndGetTables() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB2 CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB1(id int)");
  statement.executeQuery("SHOW TABLES");
  statement.execute("USE " + DB2);
  statement.execute("CREATE TABLE TAB2(id int)");
  statement.execute("CREATE TABLE TAB3(id int)");
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=" + DB1 + "->table=tab1->action=select").addPermissionsToRole("select_tab3","server=server1->db=" + DB2 + "->table=tab3->action=select").addPermissionsToRole("insert_tab2","server=server1->db=" + DB2 + "->table=tab2->action=insert");
  writePolicyFile(policyFile);
  Connection conn=context.createConnection(USER1_1);
  List<String> expectedResult=new ArrayList<String>();
  List<String> returnedResult=new ArrayList<String>();
  ResultSet res=conn.getMetaData().getSchemas();
  ResultSetMetaData resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  expectedResult.add(DB1);
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB1,"tab%",null);
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB2,"tab%",null);
  expectedResult.add("tab2");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab2");
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  conn.close();
  conn=context.createConnection(USER2_1);
  res=conn.getMetaData().getSchemas();
  resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab3");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,DB1,"tab%","i%");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  assertTrue("returned result shouldn't contain any value, actually returned result = " + returnedResult.toString(),returnedResult.isEmpty());
  res.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestLockPrivileges </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLockDatabase() throws Exception {
  String partialErrorMsgForNoPrivilege="No valid privileges";
  String assertErrorException="The exception is not the same as the expectation.";
  String assertExceptionThrown="SQLException will be thrown.";
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("lock_db1",privileges.get("lock_db1")).addRolesToGroup(USERGROUP1,"lock_db1").addPermissionsToRole("insert_db1",privileges.get("insert_db1")).addRolesToGroup(USERGROUP2,"insert_db1").addPermissionsToRole("select_db1",privileges.get("select_db1")).addRolesToGroup(USERGROUP2,"select_db1").addPermissionsToRole("alter_db1",privileges.get("alter_db1")).addRolesToGroup(USERGROUP2,"alter_db1").addPermissionsToRole("all_db1",privileges.get("all_db1")).addRolesToGroup(USERGROUP3,"all_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK DATABASE db_1 SHARED");
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  try {
    statement.execute("LOCK DATABASE db_1 SHARED");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK DATABASE db_1 SHARED");
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLockTable() throws Exception {
  String partialErrorMsgForNoPrivilege="No valid privileges";
  String assertErrorException="The exception is not the same as the expectation.";
  String assertExceptionThrown="SQLException will be thrown.";
  adminCreate(DB1,tableName);
  policyFile.addPermissionsToRole("lock_db1_tb1",privileges.get("lock_db1_tb1")).addRolesToGroup(USERGROUP1,"lock_db1_tb1").addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP2,"insert_db1_tb1").addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addRolesToGroup(USERGROUP2,"select_db1_tb1").addPermissionsToRole("alter_db1_tb1",privileges.get("alter_db1_tb1")).addRolesToGroup(USERGROUP2,"alter_db1_tb1").addPermissionsToRole("all_db1_tb1",privileges.get("all_db1_tb1")).addRolesToGroup(USERGROUP3,"all_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK TABLE tb1 SHARED");
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  try {
    statement.execute("LOCK TABLE tb1 SHARED");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK TABLE tb1 SHARED");
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtDatabaseScope </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilegeOnObjectOwnedByAdmin() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  File externalTblDir=new File(dataDir,"exttab");
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE PART_TAB_1(A STRING) partitioned by (B INT) STORED AS TEXTFILE");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=1)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=2)");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data","exttab").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("exttab","server=server1->uri=file://" + dataDir.getPath()).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_2");
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1500);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("DROP TABLE TAB_3");
  assertTrue("Unable to create directory for external table test",externalTblDir.mkdir());
  statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
  context.assertSentrySemanticException(statement,"ALTER TABLE TAB_2 SET LOCATION 'file:///tab2'",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilege() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("CREATE TABLE " + DB1 + ".TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_1");
  statement.execute("CREATE TABLE " + DB1 + ".TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_2");
  statement.execute("USE " + DB1);
  statement.execute("create table table2 as select A, count(A) from TAB_1 GROUP BY A");
  statement.execute("USE " + DB1);
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1000);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("CREATE TABLE TAB_4 AS SELECT * FROM TAB_2");
  statement.execute("ALTER TABLE TAB_3 ADD COLUMNS (B INT)");
  statement.execute("DROP TABLE TAB_3");
  try {
    statement.execute("DROP DATABASE " + DB2 + " CASCADE");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("USE " + DB2);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.execute("DROP DATABASE " + DB1 + " CASCADE");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtFunctionScope </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * admin should be able to create/drop temp functions
 * user with db level access should be able to create/drop temp functions
 * user with table level access should be able to create/drop temp functions
 * user with no privilege should NOT be able to create/drop temp functions
 */
@Test public void testFuncPrivileges1() throws Exception {
  String tableName1="tb_1";
  String udfClassName="org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf";
  CodeSource udfSrc=Class.forName(udfClassName).getProtectionDomain().getCodeSource();
  String udfLocation=System.getProperty(EXTERNAL_HIVE_LIB);
  if (udfLocation == null) {
    udfLocation=udfSrc.getLocation().getPath();
  }
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ "."+ tableName1);
  statement.execute("DROP TEMPORARY FUNCTION IF EXISTS printf_test");
  statement.execute("DROP TEMPORARY FUNCTION IF EXISTS printf_test_2");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all","UDF_JAR","data_read").addRolesToGroup(USERGROUP2,"db1_tab1","UDF_JAR").addRolesToGroup(USERGROUP3,"db1_tab1").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("db1_tab1","server=server1->db=" + DB1 + "->table="+ tableName1).addPermissionsToRole("UDF_JAR","server=server1->uri=file://" + udfLocation).addPermissionsToRole("data_read","server=server1->URI=" + "file:///tmp");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  try {
    statement.execute("CREATE TEMPORARY FUNCTION printf_test AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    LOGGER.info("Testing select from temp func printf_test");
    ResultSet res=statement.executeQuery("SELECT printf_test('%d', under_col) FROM " + tableName1);
    while (res.next()) {
      LOGGER.info(res.getString(1));
    }
    res.close();
    statement.execute("DROP TEMPORARY FUNCTION printf_test");
  }
 catch (  Exception ex) {
    LOGGER.error("test temp func printf_test failed with reason: " + ex.getStackTrace() + " "+ ex.getMessage());
    fail("fail to test temp func printf_test");
  }
  statement.execute("CREATE FUNCTION printf_test_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf' ");
  statement.execute("SELECT printf_test_perm(value) FROM " + tableName1);
  statement.execute("DROP FUNCTION printf_test_perm");
  statement.execute("CREATE FUNCTION printf_test_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf' " + " using file 'file:///tmp'");
  statement.execute("DROP FUNCTION printf_test_perm");
  context.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TEMPORARY FUNCTION printf_test_2 AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  statement.execute("SELECT printf_test_2(value) FROM " + tableName1);
  statement.execute("DROP TEMPORARY FUNCTION printf_test_2");
  statement.execute("CREATE FUNCTION " + DB1 + ".printf_test_2_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  statement.execute("SELECT printf_test_2_perm(value) FROM " + tableName1);
  statement.execute("DROP FUNCTION printf_test_2_perm");
  try {
    statement.execute("CREATE FUNCTION " + DB1 + ".printf_test_2_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'"+ " using file '"+ "file://"+ dataFile.getPath()+ "'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  try {
    statement.execute("CREATE TEMPORARY FUNCTION printf_test_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("CREATE FUNCTION printf_test_perm_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
  connection=context.createConnection(USER4_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("USE default");
    statement.execute("CREATE TEMPORARY FUNCTION printf_test_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user4",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtTableScope </h4><pre class="type-17 type-12 type-5 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInsert() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"insert_tab1","select_tab2").addPermissionsToRole("insert_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=insert").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("INSERT INTO TABLE " + TBL1 + " SELECT A, B FROM "+ TBL2);
  try {
    statement.executeQuery("SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("SELECT A FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  ResultSet resultSet=statement.executeQuery("SHOW TABLES");
  while (resultSet.next()) {
    String tableName=resultSet.getString(1);
    assertNotNull("table name is null in result set",tableName);
    assertFalse("Found VIEW_1 in the result set","VIEW_1".equalsIgnoreCase(tableName));
  }
  try {
    statement.executeQuery("CREATE VIEW VIEW_2(A) AS SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestSandboxOps </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Steps:
 * 1. Admin user creates a new database DB_1
 * 2. Admin user grants ALL on DB_1 to group GROUP_1
 * 3. User from GROUP_1 creates table TAB_1, TAB_2 in DB_1
 * 4. Admin user grants SELECT/INSERT on TAB_1 to group GROUP_2
 * a) verify users from GROUP_2 have only SELECT/INSERT
 * privileges on TAB_1. They shouldn't be able to perform
 * any operation other than those listed as
 * requiring SELECT in the privilege model.
 * b) verify users from GROUP_2 can't perform queries
 * involving join between TAB_1 and TAB_2.
 * c) verify users from GROUP_1 can't perform operations
 * requiring ALL @SERVER scope:
 * *) create database
 * *) drop database
 * *) show databases
 * *) show locks
 * *) execute ALTER TABLE .. SET LOCATION on a table in DB_1
 * *) execute ALTER PARTITION ... SET LOCATION on a table in DB_1
 * *) execute CREATE EXTERNAL TABLE ... in DB_1
 * *) execute ADD JAR
 * *) execute a query with TRANSOFORM
 * @throws Exception
 */
@Test public void testSandboxOpt17() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1,TBL2);
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addRolesToGroup(USERGROUP2,"select_tb1").addPermissionsToRole("select_tb1","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=select").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.toString());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"CREATE DATABASE " + DB3);
  ResultSet rs=statement.executeQuery("SHOW DATABASES");
  assertTrue(rs.next());
  assertEquals(DB1,rs.getString(1));
  context.assertAuthzException(statement,"ALTER TABLE " + TBL1 + " ADD PARTITION (value = 10) LOCATION '"+ dataDir.getPath()+ "'");
  context.assertAuthzException(statement,"ALTER TABLE " + TBL1 + " PARTITION (value = 10) SET LOCATION '"+ dataDir.getPath()+ "'");
  context.assertAuthzException(statement,"CREATE EXTERNAL TABLE " + TBL3 + " (under_col int, value string) LOCATION '"+ dataDir.getPath()+ "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SELECT * FROM TABLE " + TBL2 + " LIMIT 10");
  context.assertAuthzException(statement,"EXPLAIN SELECT * FROM TABLE " + TBL2 + " WHERE under_col > 5 LIMIT 10");
  context.assertAuthzException(statement,"DESCRIBE " + TBL2);
  context.assertAuthzException(statement,"LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL2);
  context.assertAuthzException(statement,"analyze table " + TBL2 + " compute statistics for columns under_col, value");
  context.assertAuthzException(statement,"SELECT " + TBL1 + ".* FROM "+ TBL1+ " JOIN "+ TBL2+ " ON ("+ TBL1+ ".value = "+ TBL2+ ".value)");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestSentryOnFailureHookLoading </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnFailureHookLoading() throws Exception {
  String hiveServer2Type=System.getProperty(HiveServerFactory.HIVESERVER2_TYPE);
  if (hiveServer2Type != null && !HiveServerFactory.isInternalServer(HiveServerFactory.HiveServer2Type.valueOf(hiveServer2Type.trim()))) {
    return;
  }
  context=createContext(testProperties);
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addPermissionsToRole("all_db1","server=server1->db=DB_1").setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("CREATE DATABASE DB_1");
  statement.execute("CREATE DATABASE DB_2");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  assertFalse(DummySentryOnFailureHook.invoked);
  try {
    statement.execute("DROP DATABASE DB_2 CASCADE");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    assertTrue(DummySentryOnFailureHook.invoked);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP DATABASE DB_1 CASCADE");
  statement.execute("DROP DATABASE DB_2 CASCADE");
  statement.close();
  connection.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUserManagement </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that users without group information will cause the configuration exception
 */
@Test public void testGroup9() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP);
  writePolicyFile(policyFile);
  Connection connection=context.createConnection("admin1");
  Statement statement=connection.createStatement();
  statement.execute("DROP DATABASE IF EXISTS db1 CASCADE");
  statement.execute("CREATE DATABASE db1");
  statement.execute("USE db1");
  statement.execute("CREATE TABLE t1 (under_col int)");
  statement.close();
  connection.close();
  connection=context.createConnection("user1");
  statement=context.createStatement(connection);
  try {
    statement.execute("CREATE TABLE db1.t1 (under_col int, value string)");
    fail("User without group configuration, SentryGroupNotFoundException should be thrown ");
  }
 catch (  HiveSQLException hse) {
    assertTrue(hse.getMessage().indexOf("SentryGroupNotFoundException") >= 0);
  }
  try {
    statement.execute("SELECT under_col from db1.t1");
    fail("User without group configuration, SentryGroupNotFoundException should be thrown ");
  }
 catch (  HiveSQLException hse) {
    assertTrue(hse.getMessage().indexOf("SentryGroupNotFoundException") >= 0);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestViewPrivileges </h4><pre class="type-17 type-12 type-5 type-7 type-14 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartitioned() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  String viewName="view1";
  String db="db1";
  String tabName="tab1";
  policyFile.addPermissionsToRole("view","server=server1->db=" + db + "->table="+ viewName).addRolesToGroup(USERGROUP1,"view").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection conn=context.createConnection(ADMIN1);
  Statement stmt=context.createStatement(conn);
  stmt.execute("DROP DATABASE IF EXISTS " + db + " CASCADE");
  stmt.execute("CREATE DATABASE " + db);
  stmt.execute("use " + db);
  stmt.execute("create table " + tabName + " (id int) partitioned by (part string)");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"a\")");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"b\")");
  ResultSet res=stmt.executeQuery("select count(*) from " + tabName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    Assume.assumeTrue(res.getInt(1) == new Integer(1000));
  }
  stmt.execute("create view " + viewName + " as select * from "+ tabName+ " where id<100");
  res=stmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  int rowsInView=0;
  while (res.next()) {
    rowsInView=res.getInt(1);
  }
  stmt.close();
  conn.close();
  Connection userConn=context.createConnection(USER1_1);
  Statement userStmt=context.createStatement(userConn);
  userStmt.execute("use " + db);
  res=userStmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    org.junit.Assert.assertThat(res.getInt(1),is(rowsInView));
  }
  userStmt.close();
  userConn.close();
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  try {
    userStmt.executeQuery("select count(*) from " + viewName);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
  }
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestAuthorizingObjectStore </h4><pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER3_1 is USERGROUP3, and has no access to database and
 * table.
 * @throws Exception
 */
@Test public void testPrivilegesForNoAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER3_1);
  try {
    client.getDatabase(dbName1);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getDatabase(dbName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getAllDatabases().size(),equalTo(1));
  assertThat(client.getDatabases("*").size(),equalTo(1));
  try {
    client.getTable(dbName1,tabName1);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName1,tabName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName3);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName4);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(0));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(0));
  assertThat(client.getAllTables(dbName1).size(),equalTo(0));
  assertThat(client.getAllTables(dbName2).size(),equalTo(0));
  try {
    client.listPartitionNames(dbName1,tabName1,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName2,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * User accessAllMetaUser is configured as the value of
 * "sentry.metastore.service.users" and has all access to databases and
 * tables.
 * @throws Exception
 */
@Test public void testPrivilegesForUserWithoutAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(userWithoutAccess);
  assertThat(client.getDatabase(dbName1),notNullValue());
  assertThat(client.getDatabase(dbName2),notNullValue());
  assertThat(client.getAllDatabases().size(),equalTo(3));
  assertThat(client.getDatabases("*").size(),equalTo(3));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  assertThat(client.getTable(dbName1,tabName2),notNullValue());
  assertThat(client.getTable(dbName2,tabName3),notNullValue());
  assertThat(client.getTable(dbName2,tabName4),notNullValue());
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(2));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(2));
  assertThat(client.getAllTables(dbName1).size(),equalTo(2));
  assertThat(client.getAllTables(dbName2).size(),equalTo(2));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER2_1 is USERGROUP2, and has the access to db1 and t1.
 * @throws Exception
 */
@Test public void testPrivilegesForPartialAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER2_1);
  assertThat(client.getDatabase(dbName1),notNullValue());
  try {
    client.getDatabase(dbName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getAllDatabases().size(),equalTo(2));
  assertThat(client.getDatabases("*").size(),equalTo(2));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  try {
    client.getTable(dbName1,tabName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName3);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName4);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  try {
    client.listPartitions(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  try {
    client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  try {
    client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(1));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(1));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(0));
  assertThat(client.getAllTables(dbName1).size(),equalTo(1));
  assertThat(client.getAllTables(dbName2).size(),equalTo(0));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  try {
    client.listPartitionNames(dbName1,tabName2,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  try {
    client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  try {
    client.listIndexes(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  try {
    client.listIndexNames(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  try {
    client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER1_1 is USERGROUP1, and has all access to databases and
 * tables.
 * @throws Exception
 */
@Test public void testPrivilegesForFullAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  assertThat(client.getDatabase(dbName1),notNullValue());
  assertThat(client.getDatabase(dbName2),notNullValue());
  assertThat(client.getAllDatabases().size(),equalTo(3));
  assertThat(client.getDatabases("*").size(),equalTo(3));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  assertThat(client.getTable(dbName1,tabName2),notNullValue());
  assertThat(client.getTable(dbName2,tabName3),notNullValue());
  assertThat(client.getTable(dbName2,tabName4),notNullValue());
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(2));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(2));
  assertThat(client.getAllTables(dbName1).size(),equalTo(2));
  assertThat(client.getAllTables(dbName2).size(),equalTo(2));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestMetaStoreWithPigHCat </h4><pre class="type-7 type-6 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Verify add partition via Pig+HCatStore
 * *** Disabled due to HCat inputformat compatibility issue in Hive 1.1.0
 */
@Ignore @Test public void testPartionLoad() throws Exception {
  execHiveSQL("CREATE TABLE " + dbName + "."+ tabName1+ " (id int) PARTITIONED BY (part_col STRING)",ADMIN1);
  execHiveSQL("CREATE TABLE " + dbName + "."+ tabName2+ " (id int) PARTITIONED BY (part_col STRING)",ADMIN1);
  PigServer pigServer=context.getPigServer(USER1_1,ExecType.LOCAL);
  execPigLatin(USER1_1,pigServer,"A = load '" + dataFile.getPath() + "' as (id:int);");
  execPigLatin(USER1_1,pigServer,"store A into '" + dbName + "."+ tabName1+ "' using "+ HCatStorer.class.getName()+ " ('part_col=part1');");
  HiveMetaStoreClient client=context.getMetaStoreClient(ADMIN1);
  assertEquals(1,client.listPartitionNames(dbName,tabName1,(short)10).size());
  pigServer=context.getPigServer(USER2_1,ExecType.LOCAL);
  execPigLatin(USER2_1,pigServer,"A = load '" + dataFile.getPath() + "' as (id:int);");
  execPigLatin(USER2_1,pigServer,"store A into '" + dbName + "."+ tabName2+ "' using "+ HCatStorer.class.getName()+ " ('part_col=part2');");
  assertEquals(0,client.listPartitionNames(dbName,tabName2,(short)10).size());
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestMetastoreEndToEnd </h4><pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify alter table privileges
 * @throws Exception
 */
@Test public void testAlterTablePrivileges() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(ADMIN1);
  createMetastoreTable(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")));
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  Table metaTable2=client.getTable(dbName,tabName1);
  metaTable2.getSd().setCols(Lists.newArrayList(new FieldSchema("col2","double","")));
  client.alter_table(dbName,tabName1,metaTable2);
  Table metaTable3=client.getTable(dbName,tabName1);
  assertEquals(metaTable2.getSd().getCols(),metaTable3.getSd().getCols());
  client=context.getMetaStoreClient(USER2_1);
  metaTable2=client.getTable(dbName,tabName1);
  metaTable2.getSd().setCols(Lists.newArrayList(new FieldSchema("col3","string","")));
  client.alter_table(dbName,tabName1,metaTable2);
  metaTable3=client.getTable(dbName,tabName1);
  assertEquals(metaTable2.getSd().getCols(),metaTable3.getSd().getCols());
  client=context.getMetaStoreClient(USER3_1);
  metaTable2=client.getTable(dbName,tabName1);
  metaTable2.getSd().setCols(Lists.newArrayList(new FieldSchema("col3","string","")));
  try {
    client.alter_table(dbName,tabName1,metaTable2);
    fail("alter table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify add partition privileges
 * @throws Exception
 */
@Test public void testAddPartitionPrivileges() throws Exception {
  ArrayList<String> partVals1=Lists.newArrayList("part1");
  ArrayList<String> partVals2=Lists.newArrayList("part2");
  ArrayList<String> partVals3=Lists.newArrayList("part3");
  ArrayList<String> partVals4=Lists.newArrayList("part4");
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  Table tbl1=createMetastoreTableWithPartition(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")),Lists.newArrayList(new FieldSchema("part_col1","string","")));
  assertEquals(1,client.getTables(dbName,tabName1).size());
  addPartition(client,dbName,tabName1,partVals1,tbl1);
  addPartition(client,dbName,tabName1,partVals2,tbl1);
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  tbl1=client.getTable(dbName,tabName1);
  addPartition(client,dbName,tabName1,partVals3,tbl1);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  tbl1=client.getTable(dbName,tabName1);
  try {
    addPartition(client,dbName,tabName1,partVals4,tbl1);
    fail("Add partition should have failed for non-admin user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  tbl1=client.getTable(dbName,tabName1);
  client.dropPartition(dbName,tabName1,partVals1,true);
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  tbl1=client.getTable(dbName,tabName1);
  client.dropPartition(dbName,tabName1,partVals2,true);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  try {
    addPartition(client,dbName,tabName1,partVals3,tbl1);
    fail("Drop partition should have failed for non-admin user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the user with DB permission can create table in that db Verify the
 * user can't create table in DB where he doesn't have ALL permissions
 * @throws Exception
 */
@Test public void testTablePrivileges() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(ADMIN1);
  createMetastoreTable(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")));
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  createMetastoreTable(client,dbName,tabName2,Lists.newArrayList(new FieldSchema("col1","int","")));
  assertEquals(1,client.getTables(dbName,tabName2).size());
  client.dropTable(dbName,tabName1);
  createMetastoreTable(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")));
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  try {
    createMetastoreTable(client,dbName,"barTab",Lists.newArrayList(new FieldSchema("col1","int","")));
    fail("Create table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.dropTable(dbName,tabName2);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  try {
    createMetastoreTable(client,dbName,"barTab",Lists.newArrayList(new FieldSchema("col1","int","")));
    fail("Create table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  try {
    client.dropTable(dbName,tabName1);
    fail("drop table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestGrantPrivilege </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantALLPrivilegeWithOtherPrivilegesExist() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4Princ=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MPrincipal role4Princ=new MPrincipal(ROLE4,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4Princ));
  client.grantPrivilege(Lists.newArrayList(role4Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getPrivilegesByPrincipal(role4Princ,allConnector).size() == 1);
  MPrivilege user4Privilege=client.getPrivilegesByPrincipal(role4Princ,allConnector).get(0);
  assertEquals(user4Privilege.getAction().toLowerCase(),SqoopActionConstant.READ);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrivilege writePrivilege=new MPrivilege(allConnector,SqoopActionConstant.WRITE,false);
  client.grantPrivilege(Lists.newArrayList(role4Princ),Lists.newArrayList(writePrivilege));
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getPrivilegesByPrincipal(role4Princ,allConnector).size() == 2);
  List<String> actions=Lists.newArrayList();
  for (  MPrivilege privilege : client.getPrivilegesByPrincipal(role4Princ,allConnector)) {
    actions.add(privilege.getAction().toLowerCase());
  }
  assertEquals(2,actions.size());
  assertTrue(actions.contains(SqoopActionConstant.READ));
  assertTrue(actions.contains(SqoopActionConstant.WRITE));
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrivilege allPrivilege=new MPrivilege(allConnector,SqoopActionConstant.ALL_NAME,false);
  client.grantPrivilege(Lists.newArrayList(role4Princ),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getPrivilegesByPrincipal(role4Princ,allConnector).size() == 1);
  user4Privilege=client.getPrivilegesByPrincipal(role4Princ,allConnector).get(0);
  assertEquals(user4Privilege.getAction(),SqoopActionConstant.ALL_NAME);
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantPrivilegeWithAllPrivilegeExist() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3Princ=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MPrincipal role3Princ=new MPrincipal(ROLE3,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege allPrivilege=new MPrivilege(allConnector,SqoopActionConstant.ALL_NAME,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3Princ));
  client.grantPrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  MPrivilege user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction(),SqoopActionConstant.ALL_NAME);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.grantPrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction(),SqoopActionConstant.ALL_NAME);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestJobEndToEnd </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateDeleteJob() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  rdbmsLink.setName("rdbm_testUpdateJob");
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  hdfsLink.setName("hdfs_testUpdateJob");
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job2=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job2);
  sqoopServerRunner.fillRdbmsToConfig(job2);
  sqoopServerRunner.saveJob(client,job2);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource job2Resource=new MResource(String.valueOf(job2.getPersistenceId()),MResource.TYPE.JOB);
  MPrivilege writeJob2Privilege=new MPrivilege(job2Resource,SqoopActionConstant.WRITE,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readLinkPriv=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  client.createRole(role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeJob2Privilege,readConnectorPriv,readLinkPriv));
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    assertTrue(client.getJobs().size() == 0);
    client.getJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    job2.setName("job2_update_user4_1");
    client.updateJob(job2);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getJobs().size() == 0);
    job2.setName("job2_update_user3_1");
    client.updateJob(job2);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.deleteJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.deleteJob(job2.getPersistenceId());
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.dropRole(role4);
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowJob() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allJob=new MResource(SqoopActionConstant.ALL,MResource.TYPE.JOB);
  MPrivilege readAllPrivilege=new MPrivilege(allJob,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readAllPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MResource job1Resource=new MResource(String.valueOf(job1.getPersistenceId()),MResource.TYPE.JOB);
  MPrivilege readJob1Privilege=new MPrivilege(job1Resource,SqoopActionConstant.READ,false);
  client.createRole(role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readJob1Privilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getJobs().size() == 1);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    assertTrue(client.getJobs().size() == 1);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getJobs().size() == 0);
    client.getJob(job1.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.deleteJob(job1.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestLinkEndToEnd </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateDtestUpdateDeleteLinkeleteLink() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource hdfsLinkResource=new MResource(String.valueOf(hdfsLink.getPersistenceId()),MResource.TYPE.LINK);
  MPrivilege writeHdfsPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.WRITE,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeHdfsPrivilege,readConnectorPriv));
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    assertTrue(client.getLinks().size() == 0);
    client.getLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    hdfsLink.setName("hdfs_link_update_user4_1");
    client.updateLink(hdfsLink);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getLinks().size() == 0);
    hdfsLink.setName("hdfs_link_update_user3_1");
    client.updateLink(hdfsLink);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.deleteLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.deleteLink(hdfsLink.getPersistenceId());
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.dropRole(role4);
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowLink() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readAllPrivilege=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readAllPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MResource hdfsLinkResource=new MResource(String.valueOf(hdfsLink.getPersistenceId()),MResource.TYPE.LINK);
  MPrivilege readHdfsLinkPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readHdfsLinkPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getLinks().size() == 1);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    assertTrue(client.getLinks().size() == 1);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getLinks().size() == 0);
    client.getLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.deleteLink(hdfsLink.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestOwnerPrivilege </h4><pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJobOwner() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(ROLE3,MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() > 0);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  assertTrue(client.getLinks().size() == 2);
  hdfsLink.setName("HDFS_update2");
  client.updateLink(hdfsLink);
  rdbmsLink.setName("RDBM_update");
  client.updateLink(rdbmsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getJobs().size() == 0);
  try {
    client.deleteJob(job1.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertEquals(client.getJob(job1.getPersistenceId()),job1);
  client.deleteJob(job1.getPersistenceId());
  client.deleteLink(hdfsLink.getPersistenceId());
  client.deleteLink(rdbmsLink.getPersistenceId());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLinkOwner() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getConnectors().size() > 0);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  assertEquals(client.getLink(hdfsLink.getPersistenceId()),hdfsLink);
  hdfsLink.setName("HDFS_update1");
  sqoopServerRunner.updateLink(client,hdfsLink);
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getLinks().size() == 0);
  client=sqoopServerRunner.getSqoopClient(USER1);
  client.deleteLink(hdfsLink.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestRevokePrivilege </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRevokePrivilegeWithAllPrivilegeExist() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3Princ=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MPrincipal role3Princ=new MPrincipal(ROLE3,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege allPrivilege=new MPrivilege(allConnector,SqoopActionConstant.ALL_NAME,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3Princ));
  client.grantPrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  MPrivilege user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction(),SqoopActionConstant.ALL_NAME);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.revokePrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction().toLowerCase(),SqoopActionConstant.WRITE);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestRoleOperation </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleOnGroup() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  client.createRole(role3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  MRole role4=new MRole(ROLE4);
  client.createRole(role4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertEquals(role3.getName(),client.getRolesByPrincipal(group3).get(0).getName());
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertEquals(role4.getName(),client.getRolesByPrincipal(group4).get(0).getName());
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.revokeRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.revokeRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getRolesByPrincipal(group3).isEmpty());
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getRolesByPrincipal(group4).isEmpty());
}

</code></pre>

<br>
<pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleOnGroup() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  client.createRole(role1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  MRole role2=new MRole(ROLE2);
  client.createRole(role2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertEquals(role1.getName(),client.getRolesByPrincipal(group1).get(0).getName());
  try {
    client.getRolesByPrincipal(group2);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertEquals(role2.getName(),client.getRolesByPrincipal(group2).get(0).getName());
  try {
    client.getRolesByPrincipal(group1);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestServerScopeEndToEnd </h4><pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServerScopePrivilege() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  MResource sqoopServer1=new MResource(SQOOP_SERVER_NAME,MResource.TYPE.SERVER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrivilege readPrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MPrivilege writePrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.WRITE,false);
  client.createRole(role2);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readAllConPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  MPrivilege readAllLinkPriv=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writePrivilege,readAllConPriv,readAllLinkPriv));
  MRole role3=new MRole(ROLE3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MPrivilege allPrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.ALL_NAME,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role3.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getConnector("generic-jdbc-connector") != null);
    assertTrue(client.getConnector("hdfs-connector") != null);
    assertTrue(client.getConnectors().size() > 0);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
    assertTrue(client.getLink(rdbmsLink.getPersistenceId()) != null);
    assertTrue(client.getLinks().size() == 2);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
    assertTrue(client.getJobs().size() == 1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  try {
    hdfsLink.setName("hdfs1_update_user1");
    client.updateLink(hdfsLink);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    job1.setName("job1_update_user1");
    client.updateJob(job1);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    hdfsLink.setName("hdfs1_update_user2");
    client.updateLink(hdfsLink);
    job1.setName("job1_update_user2");
    client.updateJob(job1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  assertTrue(client.getJobs().size() == 0);
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getConnector("generic-jdbc-connector") != null);
    assertTrue(client.getConnector("hdfs-connector") != null);
    assertTrue(client.getConnectors().size() > 0);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
    assertTrue(client.getLink(rdbmsLink.getPersistenceId()) != null);
    assertTrue(client.getLinks().size() == 2);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
    assertTrue(client.getJobs().size() == 1);
    hdfsLink.setName("hdfs1_update_user3");
    client.updateLink(hdfsLink);
    job1.setName("job1_update_user3");
    client.updateJob(job1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestShowPrivilege </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowPrivileges() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1Princ=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrincipal role1Princ=new MPrincipal(ROLE1,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1Princ));
  client.grantPrivilege(Lists.newArrayList(role1Princ),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getPrivilegesByPrincipal(role1Princ,allConnector).size() == 1);
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    client.getPrivilegesByPrincipal(role1Princ,allConnector);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.component.QueryDocAuthorizationComponentTest </h4><pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a request from a user coming from an empty group.
 * This request should be rejected because otherwise document-level
 * filtering will be skipped.
 */
@Test public void testEmptyGroup() throws Exception {
  String user="bogusUser";
  try {
    NamedList args=new NamedList();
    args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
    ResponseBuilder builder=runComponent(user,args,null);
    checkParams(null,builder);
    Assert.fail("Expected SolrException");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    assertTrue(ex.getMessage().contains(user + " rejected because user is not associated with any roles"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a request from a user coming from an empty role.
 * This request should be rejected because otherwise document-level
 * filtering will be skipped.
 */
@Test public void testEmptyRole() throws Exception {
  String user="undefinedRoleUser";
  try {
    NamedList args=new NamedList();
    args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
    ResponseBuilder builder=runComponent(user,args,null);
    checkParams(null,builder);
    Assert.fail("Expected SolrException");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    assertTrue(ex.getMessage().contains(user + " rejected because user is not associated with any roles"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.sentry.SentryIndexAuthorizationSingletonTest </h4><pre class="type-12 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoBinding() throws Exception {
  Constructor ctor=SentryIndexAuthorizationSingleton.class.getDeclaredConstructor(String.class);
  ctor.setAccessible(true);
  SentryIndexAuthorizationSingleton nonSingleton=(SentryIndexAuthorizationSingleton)ctor.newInstance("");
  doExpectUnauthorized(nonSingleton,null,null,"binding");
  try {
    nonSingleton.getUserName(null);
    Assert.fail("Expected Solr exception");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
  }
  Collection<String> groups=nonSingleton.getRoles("junit");
  assertEquals(null,groups);
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting the roles from user name
 */
@Test public void testGetRoles() throws Exception {
  Collection<String> emptyCollection=ImmutableSet.<String>of();
  try {
    sentryInstance.getRoles(null);
    Assert.fail("Excepted SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    sentryInstance.getRoles("withoutGroupUser");
    Assert.fail("Excepted SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  Collection<String> roles=sentryInstance.getRoles("undefinedRoleUser");
  assertTrue(CollectionUtils.isEqualCollection(emptyCollection,roles));
  Collection<String> singleRole=ImmutableSet.<String>of("junit_role");
  roles=sentryInstance.getRoles("junit");
  assertTrue(CollectionUtils.isEqualCollection(singleRole,roles));
  Collection<String> multipleRoles=ImmutableSet.<String>of("junit_role","queryOnlyAdmin_role","updateOnlyAdmin_role");
  roles=sentryInstance.getRoles("multiGroupUser");
  assertTrue(CollectionUtils.isEqualCollection(multipleRoles,roles));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting the user name.
 */
@Test public void testUserName() throws Exception {
  SolrQueryRequest request=null;
  try {
    request=new SolrQueryRequestBase(core,new ModifiableSolrParams()){
    }
;
    try {
      sentryInstance.getUserName(request);
      Assert.fail("Expected SolrException");
    }
 catch (    SolrException ex) {
      assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    }
    LocalSolrQueryRequest localRequest=null;
    try {
      localRequest=new LocalSolrQueryRequest(null,new ModifiableSolrParams());
      String superUser=(System.getProperty("solr.authorization.superuser","solr"));
      String localName=sentryInstance.getUserName(localRequest);
      assertEquals(superUser,localName);
    }
  finally {
      if (localRequest != null)       localRequest.close();
    }
    SolrQueryRequest sqr=getRequest();
    prepareCollAndUser(core,sqr,"collection",null,true);
    String nullName=sentryInstance.getUserName(sqr);
    assertEquals(null,nullName);
    String userName="foobar";
    prepareCollAndUser(core,sqr,"collection",userName,true);
    String returnedName=sentryInstance.getUserName(sqr);
    assertEquals(userName,returnedName);
  }
  finally {
    if (request != null)     request.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.update.processor.UpdateIndexAuthorizationProcessorTest </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure no new methods have been added to base class that are not invoking
 * Sentry
 */
@Test public void testAllMethodsChecked() throws Exception {
  Method[] methods=UpdateRequestProcessor.class.getDeclaredMethods();
  TreeSet<String> foundNames=new TreeSet<String>();
  for (  Method method : methods) {
    if (Modifier.isPublic(method.getModifiers())) {
      foundNames.add(method.getName());
    }
  }
  assertEquals(methodNames.size(),foundNames.size());
  assertTrue(foundNames.containsAll(methodNames));
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
