<h3><span class=" glyphicon glyphicon-tag"/>&nbspConditionMatcher</h3><kbd>Verifies logic rules using matcher-style statements</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDatabaseProvider </h4><pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON SERVER serverName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleObObjectGivenServer() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE default");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-10 type-19 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON URI uriName: Needs Hive patch
 * @throws Exception
 */
@Ignore @Test public void testShowPrivilegesByRoleOnUri() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON URI 'file:///tmp/file.txt'");
  assertTrue("Expecting SQL Exception",false);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW ROLES
 * @throws Exception3.1. When there are no roles, returns empty list
 * 3.2. When there are roles, returns correct list with correct schema.
 */
@Test public void testShowRoles() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW ROLES");
  List<String> expected=new ArrayList<>();
  expected.add("admin_role");
  assertTestRoles(resultSet,expected,true);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  resultSet=statement.executeQuery("SHOW ROLES");
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(1));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  expected.add("role1");
  expected.add("role2");
  assertTestRoles(resultSet,expected,true);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void testUriWithEquals() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/partition=value/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/partition=value/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON TABLE tableName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenTable() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string)");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON COLUMN colName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenColumn() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t2(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t3(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t4(c1 string, c2 int)");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE role1");
  statement.execute("GRANT SELECT (c2) ON TABLE t2 TO ROLE role1");
  statement.execute("GRANT SELECT (c1,c2) ON TABLE t3 TO ROLE role1");
  statement.execute("GRANT SELECT (c1,c2) ON TABLE t4 TO ROLE role1 with grant option");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1 (c1)");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t2 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t2"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t3 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t3"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t3 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t3"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t4 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t4"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("True")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t4 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t4"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("True")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t2 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON DATABASE databaseName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenDatabase() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON DATABASE default TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE default");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE " + DB1);
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. When there are no roles and group, throws SentryNoSuchObjectException
 * 4.2. When there are roles, returns correct list with correct schema.
 */
@Test public void testShowRolesByGroup() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("CREATE ROLE role3");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(4));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  assertThat(resultSetMetaData.getColumnName(2),equalToIgnoringCase("grant_option"));
  assertThat(resultSetMetaData.getColumnName(3),equalToIgnoringCase("grant_time"));
  assertThat(resultSetMetaData.getColumnName(4),equalToIgnoringCase("grantor"));
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
    assertThat(resultSet.getBoolean(2),is(new Boolean("False")));
    assertThat(resultSet.getString(4),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Grant/Revoke privilege - Positive cases
 * @throws Exception1.1. All on server
 * 1.2. All on database
 * 1.3. All on URI
 * 1.4. All on table
 * 1.5. Insert on table
 * 1.6. Select on table
 * 1.7. Partial privileges on table
 * 1.7.1. Grant all, revoke insert leads to select on table
 * 1.7.2. Grant all, revoke select leads to select on table
 */
@Test public void testGrantRevokePrivileges() throws Exception {
  Connection connection;
  Statement statement;
  ResultSet resultSet;
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 to role role1");
  statement.execute("GRANT Role role1 to group " + ADMINGROUP);
  statement.execute("Create table tab1(col1 int)");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON SERVER server1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON DATABASE default to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON DATABASE default from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON URI 'file:///path' to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file://path"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON URI 'file:///path' from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT INSERT ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("insert"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE INSERT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT SELECT ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE SELECT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT SELECT(col1) ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("col1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE SELECT(col1) ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("REVOKE INSERT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("REVOKE SELECT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("insert"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. Show role grant works for non-admin users when the user belongs to the requested group
 * 4.2. Show role grant FAILS for non-admin users when the user doesn't belongs to the requested group
 */
@Test public void testShowRolesByGroupNonAdmin() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP2);
  statement.execute("GRANT ROLE role1 to GROUP " + ADMINGROUP);
  statement.execute("GRANT ROLE role2 to GROUP " + ADMINGROUP);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + ADMINGROUP,SentryAccessDeniedException.class.getSimpleName());
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP2);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role2"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName
 * @throws Exception5.1. When there are no privileges granted to a role, returns an empty list
 * 5.2. When there are privileges, returns correct list with correct schema.
 * 5.3. Given privileges on table, show grant on table should return table privilege.
 * 5.4. Privileges on database
 * 5.4.1. Show grant on database should return correct priv
 * 5.4.2. Show grant on table should return correct priv
 * 5.5. Privileges on server
 * 5.5.1. Show grant on database should return correct priv
 * 5.5.2. Show grant on table should return correct priv
 * 5.5.3. Show grant on server should return correct priv (sql not supported yet in hive)
 * 5.6. Show grant on uri (sql not supported yet in hive)
 */
@Test public void testShowPrivilegesByRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("CREATE ROLE role2");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string, c2 int)");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE role1");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  String[] users={ADMIN1,USER1_1};
  for (  String user : users) {
    connection=context.createConnection(user);
    statement=context.createStatement(connection);
    resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
    ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
    assertThat(resultSetMetaData.getColumnCount(),is(10));
    assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("database"));
    assertThat(resultSetMetaData.getColumnName(2),equalToIgnoringCase("table"));
    assertThat(resultSetMetaData.getColumnName(3),equalToIgnoringCase("partition"));
    assertThat(resultSetMetaData.getColumnName(4),equalToIgnoringCase("column"));
    assertThat(resultSetMetaData.getColumnName(5),equalToIgnoringCase("principal_name"));
    assertThat(resultSetMetaData.getColumnName(6),equalToIgnoringCase("principal_type"));
    assertThat(resultSetMetaData.getColumnName(7),equalToIgnoringCase("privilege"));
    assertThat(resultSetMetaData.getColumnName(8),equalToIgnoringCase("grant_option"));
    assertThat(resultSetMetaData.getColumnName(9),equalToIgnoringCase("grant_time"));
    assertThat(resultSetMetaData.getColumnName(10),equalToIgnoringCase("grantor"));
    while (resultSet.next()) {
      assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
      assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
      assertThat(resultSet.getString(3),equalToIgnoringCase(""));
      assertThat(resultSet.getString(4),equalToIgnoringCase(""));
      assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
      assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
      assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
      assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
      assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
    }
    statement.close();
    connection.close();
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW GRANT ROLE role1",SentryAccessDeniedException.class.getSimpleName());
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW CURRENT ROLE
 * @throws Exception
 */
@Test public void testShowCurrentRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ROLE role1 TO GROUP " + ADMINGROUP);
  statement.execute("SET ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(1));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Corner cases
 * @throws Exception7.1. Drop role which doesn't exist, throws SentryNoSuchObjectException
 * 7.2. Create role which already exists, throws SentryAlreadyExitsException
 * 7.3. Drop role when privileges mapping exists and create role with same name, old
 * mappings should not exist
 * 7.4. Grant role, when role doesn't exist, throws SentryNoSuchObjectException
 * 7.5. Grant role when mapping exists, silently allows
 * 7.6. Grant multiple roles to a group
 * 7.7. Revoke role after role has been dropped, SentryNoSuchObjectException
 * 7.8. Revoke role from a group when mapping doesn't exist, silently allows
 * 7.9. Grant privilege to a role, privilege already exists, silently allows
 * 7.10. Grant privilege to a role, mapping already exists, silently allows
 * 7.11. Multiple privileges to a role
 * 7.12. Revoke privilege when privilege doesn't exist, silently allows
 * 7.13. Revoke privilege, when role doesn't exist, SentryNoSuchObjectException
 * 7.14. Revoke privilege when mapping doesn't exist, silently allows
 * 7.15. Drop role should remove role-group mapping
 */
@Test public void testCornerCases() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE IF NOT EXISTS tab1(c1 string)");
  context.assertSentryException(statement,"DROP ROLE role1",SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role1");
  context.assertSentryException(statement,"CREATE ROLE role1",SentryAlreadyExistsException.class.getSimpleName());
  statement.execute("GRANT ROLE role1 TO GROUP " + USERGROUP1);
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("DROP ROLE role1");
  statement.execute("CREATE ROLE role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  context.assertSentryException(statement,"GRANT role role2 TO GROUP " + USERGROUP1,SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertResultSize(resultSet,2);
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("DROP ROLE role2");
  context.assertSentryException(statement,"REVOKE role role2 from group " + USERGROUP1,SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("REVOKE ROLE role1 from GROUP " + USERGROUP1);
  statement.execute("REVOKE ROLE role1 from GROUP " + USERGROUP1);
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role2");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  resultSet=statement.executeQuery("SHOW GRANT ROLE role2");
  assertResultSize(resultSet,1);
  statement.execute("GRANT ALL ON TABLE tab1 to ROLE role2");
  statement.execute("GRANT ALL,INSERT ON TABLE tab1 to ROLE role2");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role2");
  assertResultSize(resultSet,2);
  statement.execute("DROP role role2");
  statement.execute("REVOKE ALL ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  int count=0;
  while (resultSet.next()) {
    count++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
  }
  assertThat(count,is(1));
  context.assertSentryException(statement,"REVOKE ALL ON SERVER server1 from role role2",SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ALL on TABLE tab1 to ROLE role2");
  statement.execute("REVOKE ALL on TABLE tab1 from Role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("DROP role role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("DROP ROLE role1");
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertResultSize(resultSet,0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestViewPrivileges </h4><pre class="type-17 type-12 type-5 type-7 type-14 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartitioned() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  String viewName="view1";
  String db="db1";
  String tabName="tab1";
  policyFile.addPermissionsToRole("view","server=server1->db=" + db + "->table="+ viewName).addRolesToGroup(USERGROUP1,"view").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection conn=context.createConnection(ADMIN1);
  Statement stmt=context.createStatement(conn);
  stmt.execute("DROP DATABASE IF EXISTS " + db + " CASCADE");
  stmt.execute("CREATE DATABASE " + db);
  stmt.execute("use " + db);
  stmt.execute("create table " + tabName + " (id int) partitioned by (part string)");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"a\")");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"b\")");
  ResultSet res=stmt.executeQuery("select count(*) from " + tabName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    Assume.assumeTrue(res.getInt(1) == new Integer(1000));
  }
  stmt.execute("create view " + viewName + " as select * from "+ tabName+ " where id<100");
  res=stmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  int rowsInView=0;
  while (res.next()) {
    rowsInView=res.getInt(1);
  }
  stmt.close();
  conn.close();
  Connection userConn=context.createConnection(USER1_1);
  Statement userStmt=context.createStatement(userConn);
  userStmt.execute("use " + db);
  res=userStmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    org.junit.Assert.assertThat(res.getInt(1),is(rowsInView));
  }
  userStmt.close();
  userConn.close();
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  try {
    userStmt.executeQuery("select count(*) from " + viewName);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
  }
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestAuthorizingObjectStore </h4><pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER3_1 is USERGROUP3, and has no access to database and
 * table.
 * @throws Exception
 */
@Test public void testPrivilegesForNoAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER3_1);
  try {
    client.getDatabase(dbName1);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getDatabase(dbName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getAllDatabases().size(),equalTo(1));
  assertThat(client.getDatabases("*").size(),equalTo(1));
  try {
    client.getTable(dbName1,tabName1);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName1,tabName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName3);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName4);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(0));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(0));
  assertThat(client.getAllTables(dbName1).size(),equalTo(0));
  assertThat(client.getAllTables(dbName2).size(),equalTo(0));
  try {
    client.listPartitionNames(dbName1,tabName1,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName2,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * User accessAllMetaUser is configured as the value of
 * "sentry.metastore.service.users" and has all access to databases and
 * tables.
 * @throws Exception
 */
@Test public void testPrivilegesForUserWithoutAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(userWithoutAccess);
  assertThat(client.getDatabase(dbName1),notNullValue());
  assertThat(client.getDatabase(dbName2),notNullValue());
  assertThat(client.getAllDatabases().size(),equalTo(3));
  assertThat(client.getDatabases("*").size(),equalTo(3));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  assertThat(client.getTable(dbName1,tabName2),notNullValue());
  assertThat(client.getTable(dbName2,tabName3),notNullValue());
  assertThat(client.getTable(dbName2,tabName4),notNullValue());
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(2));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(2));
  assertThat(client.getAllTables(dbName1).size(),equalTo(2));
  assertThat(client.getAllTables(dbName2).size(),equalTo(2));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER2_1 is USERGROUP2, and has the access to db1 and t1.
 * @throws Exception
 */
@Test public void testPrivilegesForPartialAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER2_1);
  assertThat(client.getDatabase(dbName1),notNullValue());
  try {
    client.getDatabase(dbName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getAllDatabases().size(),equalTo(2));
  assertThat(client.getDatabases("*").size(),equalTo(2));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  try {
    client.getTable(dbName1,tabName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName3);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName4);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  try {
    client.listPartitions(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  try {
    client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  try {
    client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(1));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(1));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(0));
  assertThat(client.getAllTables(dbName1).size(),equalTo(1));
  assertThat(client.getAllTables(dbName2).size(),equalTo(0));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  try {
    client.listPartitionNames(dbName1,tabName2,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  try {
    client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  try {
    client.listIndexes(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  try {
    client.listIndexNames(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  try {
    client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER1_1 is USERGROUP1, and has all access to databases and
 * tables.
 * @throws Exception
 */
@Test public void testPrivilegesForFullAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  assertThat(client.getDatabase(dbName1),notNullValue());
  assertThat(client.getDatabase(dbName2),notNullValue());
  assertThat(client.getAllDatabases().size(),equalTo(3));
  assertThat(client.getDatabases("*").size(),equalTo(3));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  assertThat(client.getTable(dbName1,tabName2),notNullValue());
  assertThat(client.getTable(dbName2,tabName3),notNullValue());
  assertThat(client.getTable(dbName2,tabName4),notNullValue());
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(2));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(2));
  assertThat(client.getAllTables(dbName1).size(),equalTo(2));
  assertThat(client.getAllTables(dbName2).size(),equalTo(2));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  client.close();
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
