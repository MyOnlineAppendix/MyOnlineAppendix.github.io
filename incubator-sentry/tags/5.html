<h3><span class=" glyphicon glyphicon-tag"/>&nbspUtilityVerifier</h3><kbd>Verifies (un)successful execution of the test case by reporting explicitly a failure</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.sentry.binding.hive.TestHiveAuthzBindings </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Verify that an existing definition of only the AuthorizationProvider
 * (not ProviderBackend or PolicyEngine) still works.
 */
@Test public void testDeprecatedHiveAuthzConfs() throws Exception {
  authzConf.set(AuthzConfVars.AUTHZ_PROVIDER.getVar(),"org.apache.sentry.provider.BogusProvider");
  try {
    new HiveAuthzBinding(hiveConf,authzConf);
    Assert.fail("Expected exception");
  }
 catch (  ClassNotFoundException e) {
  }
  authzConf.set(AuthzConfVars.AUTHZ_PROVIDER.getVar(),"org.apache.sentry.provider.file.HadoopGroupResourceAuthorizationProvider");
  new HiveAuthzBinding(hiveConf,authzConf);
  authzConf.set(AuthzConfVars.AUTHZ_PROVIDER.getVar(),"org.apache.sentry.provider.file.LocalGroupResourceAuthorizationProvider");
  new HiveAuthzBinding(hiveConf,authzConf);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.binding.solr.TestSolrAuthzBinding </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that incorrect specification of classes for
 * AUTHZ_PROVIDER, AUTHZ_PROVIDER_BACKEND, and AUTHZ_POLICY_ENGINE
 * correctly throw ClassNotFoundExceptions
 */
@Test public void testClassNotFound() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  new SolrAuthzBinding(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER.getVar(),"org.apache.sentry.provider.BogusProvider");
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected ClassNotFoundException");
  }
 catch (  ClassNotFoundException e) {
  }
  setUsableAuthzConf(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER_BACKEND.getVar(),"org.apache.sentry.provider.file.BogusProviderBackend");
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected ClassNotFoundException");
  }
 catch (  ClassNotFoundException e) {
  }
  setUsableAuthzConf(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_POLICY_ENGINE.getVar(),"org.apache.sentry.provider.solr.BogusPolicyEngine");
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected ClassNotFoundException");
  }
 catch (  ClassNotFoundException e) {
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that a user that doesn't exist throws an exception
 * when trying to authorize
 */
@Test public void testNoUser() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  try {
    binding.authorizeCollection(new Subject("bogus"),infoCollection,querySet);
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test if no action is attempted an exception is thrown
 */
@Test public void testNoAction() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  try {
    binding.authorizeCollection(corporal1,infoCollection,emptySet);
    Assert.fail("Expected IllegalArgumentException");
  }
 catch (  IllegalArgumentException e) {
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for group mapping
 */
@Test public void testGroupMapping() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  Set<String> emptyList=Collections.emptySet();
  try {
    binding.getGroups(null);
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("nonExistantUser");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("corporal");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("sergeant");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("general");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getGroups("othergeneralgroup");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  assertEquals(binding.getGroups("corporal1"),Sets.newHashSet("corporal"));
  assertEquals(binding.getGroups("sergeant1"),Sets.newHashSet("sergeant"));
  assertEquals(binding.getGroups("general1"),Sets.newHashSet("general","othergeneralgroup"));
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that incorrect specification of the provider resource
 * throws an exception
 */
@Test public void testResourceNotFound() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER_RESOURCE.getVar(),new File(baseDir,"test-authz-bogus-provider.ini").getPath());
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected InvocationTargetException");
  }
 catch (  InvocationTargetException e) {
    assertTrue(e.getTargetException() instanceof FileNotFoundException);
  }
  solrAuthzConf.unset(AuthzConfVars.AUTHZ_PROVIDER_RESOURCE.getVar());
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected InvocationTargetException");
  }
 catch (  InvocationTargetException e) {
    assertTrue(e.getTargetException() instanceof IllegalArgumentException);
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for role mapping
 */
@Test public void testGetRoles() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  Set<String> emptySet=Collections.emptySet();
  assertEquals(binding.getRoles("undefinedGroupUser"),emptySet);
  assertEquals(binding.getRoles("undefinedRoleUser"),emptySet);
  try {
    binding.getRoles("corporal_role");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getRoles("sergeant_role");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    binding.getRoles("general_role");
    Assert.fail("Expected SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  assertEquals(binding.getRoles("corporal1"),Sets.newHashSet("corporal_role"));
  assertEquals(binding.getRoles("sergeant1"),Sets.newHashSet("corporal_role","sergeant_role"));
  assertEquals(binding.getRoles("general1"),Sets.newHashSet("corporal_role","sergeant_role","general_role"));
  assertEquals(binding.getRoles("overlappingUser"),Sets.newHashSet("corporal_role","sergeant_role","general_role"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.common.utils.TestPathUtils </h4><pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParseDFSURI() throws Exception {
  assertEquals("hdfs://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("hdfs://namenode:8020/user/hive/warehouse","/tmp/hive-user"));
  assertEquals("hdfs://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("hdfs://namenode:8020/user/hive/warehouse","hdfs://namenode:8020/tmp/hive-user"));
  try {
    PathUtils.parseDFSURI("hdfs://namenode:8020/user/hive/warehouse","tmp/hive-user");
    fail("IllegalArgumentException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("swift://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("swift://namenode:8020/user/hive/warehouse","/tmp/hive-user"));
  assertEquals("swift://namenode:8020/tmp/hive-user",PathUtils.parseDFSURI("swift://namenode:8020/user/hive/warehouse","swift://namenode:8020/tmp/hive-user"));
  try {
    PathUtils.parseDFSURI("swift://namenode:8020/user/hive/warehouse","tmp/hive-user");
    fail("IllegalArgumentException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:///tmp/hive-warehouse","/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:///tmp/hive-warehouse","file:/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:///tmp/hive-warehouse","file:///tmp/hive-user"));
  try {
    PathUtils.parseDFSURI("file:///hive-warehouse","tmp/hive-user");
    fail("IllegalArgumentException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:/tmp/hive-warehouse","/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:/tmp/hive-warehouse","file:/tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("file:/tmp/hive-warehouse","file:///tmp/hive-user"));
  assertEquals("file:///tmp/hive-user",PathUtils.parseURI("testLocal:///tmp/hive-warehouse","/tmp/hive-user",true));
  try {
    PathUtils.parseURI("testLocal:///tmp/hive-warehouse","tmp/hive-user",true);
    fail("IllegalStateException should be thrown");
  }
 catch (  IllegalArgumentException ue) {
  }
  assertEquals("file:///tmp/hive-user",PathUtils.parseDFSURI("/tmp/hive-warehouse","/tmp/hive-user"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestHMSPaths </h4><pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRootEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  root.toString();
  Assert.assertNull(root.getParent());
  Assert.assertEquals(HMSPaths.EntryType.DIR,root.getType());
  Assert.assertTrue(root.getAuthzObjs().size() == 0);
  Assert.assertEquals(Path.SEPARATOR,root.getFullPath());
  Assert.assertTrue(root.getChildren().isEmpty());
  root.delete();
  try {
    root.find(null,true);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(new String[0],true);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(null,false);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(new String[0],false);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  Assert.assertNull(root.find(new String[]{"a"},true));
  Assert.assertNull(root.find(new String[]{"a"},false));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("a")));
  root.delete();
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFurtherAuthzEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b"+ Path.SEPARATOR+ "t"+ Path.SEPARATOR+ "p1",entry.getFullPath());
  try {
    root.createPrefix(Lists.newArrayList("a","b","p1","t","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  HMSPaths.Entry ep2=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1","p2"),"A");
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,ep2.getType());
  Assert.assertEquals("p2",ep2.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1"},true));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p1","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2"},true));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2"},false));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p1","p2","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1","p2")));
  root.find(new String[]{"a","b","t","p1"},false).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},true));
  Assert.assertEquals(HMSPaths.EntryType.DIR,entry.getType());
  Assert.assertEquals(entry.getAuthzObjs().size(),0);
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b","t"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
  Assert.assertNotNull(root.find(new String[]{"a","b","t","p1","p2"},false));
  root.find(new String[]{"a","b","t","p1","p2"},false).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b","t"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testImmediateAuthzEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b"+ Path.SEPARATOR+ "p1",entry.getFullPath());
  try {
    root.createPrefix(Lists.newArrayList("a","b","p1","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1"},true));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1"},false));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","p1","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","p1")));
  root.find(new String[]{"a","b","p1"},true).delete();
  Assert.assertNull(root.find(new String[]{"a","b","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","p1")));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testImmediatePrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry entry=root.createPrefix(Lists.newArrayList("a"));
  entry.toString();
  Assert.assertEquals(1,root.getChildren().size());
  Assert.assertEquals(root,entry.getParent());
  Assert.assertEquals(HMSPaths.EntryType.PREFIX,entry.getType());
  Assert.assertEquals("a",entry.getPathElement());
  Assert.assertEquals(0,entry.getAuthzObjs().size());
  Assert.assertEquals(Path.SEPARATOR + "a",entry.getFullPath());
  Assert.assertTrue(entry.getChildren().isEmpty());
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a","b")));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertNull(root.find(new String[]{"b"},false));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("b")));
  try {
    root.createPrefix(Lists.newArrayList("a","b"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.createPrefix(Lists.newArrayList("a","b","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  entry.delete();
  Assert.assertTrue(root.getChildren().isEmpty());
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFurtherPrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry entry=root.createPrefix(Lists.newArrayList("a","b"));
  entry.toString();
  Assert.assertEquals(1,root.getChildren().size());
  Assert.assertEquals(root,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.PREFIX,entry.getType());
  Assert.assertEquals(HMSPaths.EntryType.DIR,entry.getParent().getType());
  Assert.assertEquals("b",entry.getPathElement());
  Assert.assertEquals("a",entry.getParent().getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().size() == 0);
  Assert.assertTrue(entry.getParent().getAuthzObjs().size() == 0);
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b",entry.getFullPath());
  Assert.assertEquals(Path.SEPARATOR + "a",entry.getParent().getFullPath());
  Assert.assertTrue(entry.getChildren().isEmpty());
  Assert.assertEquals(1,entry.getParent().getChildren().size());
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a","b")));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertNull(root.find(new String[]{"a","b","c"},false));
  try {
    root.createPrefix(Lists.newArrayList("a","b"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.createPrefix(Lists.newArrayList("a","b","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  entry.delete();
  Assert.assertTrue(root.getChildren().isEmpty());
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRootPrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(true);
  root.toString();
  Assert.assertNull(root.find(new String[]{"a"},true));
  Assert.assertNull(root.find(new String[]{"a"},false));
  Assert.assertEquals(root,root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertEquals(root,root.findPrefixEntry(Lists.newArrayList("a","b")));
  try {
    root.createPrefix(Lists.newArrayList("a"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestMetastoreCacheInitializer </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionInTask() throws Exception {
  Database db1=Mockito.mock(Database.class);
  Mockito.when(db1.getName()).thenReturn("db1");
  Mockito.when(db1.getLocationUri()).thenReturn("hdfs:///db1");
  Table tab1=Mockito.mock(Table.class);
  Mockito.when(tab1.getDbName()).thenReturn("db2");
  Mockito.when(tab1.getTableName()).thenReturn("tab1");
  IHMSHandler hmsHandler=Mockito.mock(IHMSHandler.class);
  Mockito.when(hmsHandler.get_all_databases()).thenReturn(Lists.newArrayList("db1"));
  Mockito.when(hmsHandler.get_database("db1")).thenReturn(db1);
  Mockito.when(hmsHandler.get_table_objects_by_name("db1",Lists.newArrayList("tab1"))).thenReturn(Lists.newArrayList(tab1));
  Mockito.when(hmsHandler.get_all_tables("db1")).thenReturn(Lists.newArrayList("tab1"));
  Configuration conf=new Configuration();
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_MAX_PART_PER_RPC,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_MAX_TABLES_PER_RPC,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_INIT_THREADS,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_RETRY_MAX_NUM,2);
  try {
    MetastoreCacheInitializer cacheInitializer=new MetastoreCacheInitializer(hmsHandler,conf);
    UpdateableAuthzPaths update=cacheInitializer.createInitialUpdate();
    Assert.fail("Expected cacheInitializer to fail");
  }
 catch (  Exception e) {
    Assert.assertTrue(e instanceof RuntimeException);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestDatabaseRequiredInRole </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testURIWithDBInPerDbPolicyFile() throws Exception {
  DatabaseRequiredInPrivilege dbRequiredInRole=new DatabaseRequiredInPrivilege();
  try {
    dbRequiredInRole.validate(new PrivilegeValidatorContext("db1","server=server1->db=db1->URI=file:///user/db/warehouse/tab1"));
    Assert.fail("Expected ConfigurationException");
  }
 catch (  ConfigurationException e) {
    ;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerRequiredInRole </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testEmptyRole() throws Exception {
  IndexerRequiredInPrivilege indexerRequiredInRole=new IndexerRequiredInPrivilege();
  try {
    indexerRequiredInRole.validate(new PrivilegeValidatorContext("index=index1"));
    Assert.fail("Expected ConfigurationException");
  }
 catch (  ConfigurationException e) {
    ;
  }
  try {
    indexerRequiredInRole.validate(new PrivilegeValidatorContext("db1","index=index2"));
    Assert.fail("Expected ConfigurationException");
  }
 catch (  ConfigurationException e) {
    ;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestCollectionRequiredInRole </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testEmptyRole() throws Exception {
  CollectionRequiredInPrivilege collRequiredInRole=new CollectionRequiredInPrivilege();
  try {
    collRequiredInRole.validate(new PrivilegeValidatorContext("index=index1"));
    Assert.fail("Expected ConfigurationException");
  }
 catch (  ConfigurationException e) {
    ;
  }
  try {
    collRequiredInRole.validate(new PrivilegeValidatorContext("db1","index=index2"));
    Assert.fail("Expected ConfigurationException");
  }
 catch (  ConfigurationException e) {
    ;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestServerNameRequiredMatch </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testServerNameMatch() throws Exception {
  ServerNameRequiredMatch serverNameMatch=new ServerNameRequiredMatch("server1");
  try {
    serverNameMatch.validate(new PrivilegeValidatorContext("server=server1->connector=c1->action=read"));
  }
 catch (  ConfigurationException ex) {
    Assert.fail("Not expected ConfigurationException");
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testServerNameNotMatch() throws Exception {
  ServerNameRequiredMatch serverNameMatch=new ServerNameRequiredMatch("server1");
  try {
    serverNameMatch.validate(new PrivilegeValidatorContext("server=server2->connector=c1->action=read"));
    Assert.fail("Expected ConfigurationException");
  }
 catch (  ConfigurationException ex) {
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testWithoutServerName(){
  ServerNameRequiredMatch serverNameMatch=new ServerNameRequiredMatch("server1");
  try {
    serverNameMatch.validate(new PrivilegeValidatorContext("connector=c1->action=read"));
    Assert.fail("Expected ConfigurationException");
  }
 catch (  ConfigurationException ex) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestDelegateSentryStore </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCaseInsensitiveCreateDropRole() throws Exception {
  String roleName1="test";
  String roleName2="TeSt";
  String grantor="grantor";
  sentryStore.createRole(SEARCH,roleName1,grantor);
  try {
    sentryStore.createRole(SEARCH,roleName2,grantor);
    fail("SentryAlreadyExistsException should have been thrown");
  }
 catch (  SentryAlreadyExistsException e) {
  }
  try {
    sentryStore.dropRole(SEARCH,roleName2,grantor);
  }
 catch (  SentryNoSuchObjectException e) {
    fail("SentryNoSuchObjectException shouldn't have been thrown");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestPrivilegeOperatePersistence </h4><pre class="type-12 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokeCheckWithGrantOption() throws Exception {
  addGroupsToUser(GRANT_OPTION_USER,GRANT_OPTION_GROUP);
  addGroupsToUser(NO_GRANT_OPTION_USER,NO_GRANT_OPTION_GROUP);
  writePolicyFile();
  String roleName1="r1";
  String roleName2="r2";
  String grantor="g1";
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.createRole(SEARCH,roleName2,grantor);
  PrivilegeObject queryPrivilege1=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(true).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege1,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege1),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  PrivilegeObject queryPrivilege2=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(false).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege2,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege2),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  sentryStore.alterRoleAddGroups(SEARCH,roleName1,Sets.newHashSet(GRANT_OPTION_GROUP),grantor);
  sentryStore.alterRoleAddGroups(SEARCH,roleName2,Sets.newHashSet(NO_GRANT_OPTION_GROUP),grantor);
  String roleName3="r3";
  sentryStore.createRole(SEARCH,roleName3,grantor);
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege1,GRANT_OPTION_USER);
  }
 catch (  SentryGrantDeniedException e) {
    fail("SentryGrantDeniedException shouldn't have been thrown");
  }
  try {
    sentryStore.alterRoleRevokePrivilege(SEARCH,roleName3,queryPrivilege1,GRANT_OPTION_USER);
  }
 catch (  SentryGrantDeniedException e) {
    fail("SentryGrantDeniedException shouldn't have been thrown");
  }
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege2,NO_GRANT_OPTION_USER);
    fail("SentryGrantDeniedException should have been thrown");
  }
 catch (  SentryGrantDeniedException e) {
  }
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege2,NO_GRANT_OPTION_USER);
    fail("SentryGrantDeniedException should have been thrown");
  }
 catch (  SentryGrantDeniedException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestSentryGMPrivilege </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testValidateAuthorizables() throws Exception {
  try {
    MSentryGMPrivilege fieldPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f1")),SearchConstants.QUERY,false);
  }
 catch (  IllegalStateException e) {
    fail("unexpect happend: it is a validated privilege");
  }
  try {
    MSentryGMPrivilege collectionPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection(""),new Field("f1")),SearchConstants.QUERY,false);
    fail("unexpect happend: it is not a validated privilege, The empty name of authorizable can't be empty");
  }
 catch (  IllegalStateException e) {
  }
  try {
    MSentryGMPrivilege fieldPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(null,new Field("f1")),SearchConstants.QUERY,false);
    fail("unexpect happend: it is not a validated privilege, The authorizable can't be null");
  }
 catch (  IllegalStateException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestSentryRole </h4><pre class="type-12 type-16 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWantGrantPrivilegeTwice() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setURI(SentryStore.NULL_COL);
  hivePrivilege.setColumnName(SentryStore.NULL_COL);
  hivePrivilege.setGrantOption(true);
  MSentryPrivilege hivePrivilege2=new MSentryPrivilege(hivePrivilege);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege2=new MSentryGMPrivilege(solrPrivilege);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  solrPrivilege.appendRole(role);
  hivePrivilege.appendRole(role);
  pm.makePersistent(solrPrivilege);
  pm.makePersistent(hivePrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  if (!role.getGmPrivileges().contains(solrPrivilege2)) {
    fail("unexpect happend: the MSentryGMPrivilege:" + solrPrivilege2 + " already be granted");
  }
  if (!role.getPrivileges().contains(hivePrivilege2)) {
    fail("unexpect happend: the MSentryPrivilege:" + hivePrivilege2 + " already be granted");
  }
  commitTransaction(pm);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.thrift.TestAuditLogForSentryGenericService </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAuditLogForGenericModel() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      String testGroupName="g1";
      String action="all";
      String service="sentryService";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.createRole(requestorUserName,roleName,COMPONENT);
      Map<String,String> fieldValueMap=new HashMap<String,String>();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_CREATE_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"CREATE ROLE " + roleName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      try {
        client.createRole(requestorUserName,roleName,COMPONENT);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_CREATE_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"CREATE ROLE " + roleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      client.addRoleToGroups(requestorUserName,roleName,COMPONENT,Sets.newHashSet(testGroupName));
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_ADD_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ROLE " + roleName + " TO GROUP "+ testGroupName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      try {
        client.addRoleToGroups(requestorUserName,"invalidRole",COMPONENT,Sets.newHashSet(testGroupName));
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_ADD_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ROLE invalidRole TO GROUP " + testGroupName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      TSentryPrivilege privilege=new TSentryPrivilege(COMPONENT,service,Lists.newArrayList(new TAuthorizable("resourceType1","resourceName1"),new TAuthorizable("resourceType2","resourceName2")),action);
      client.grantPrivilege(requestorUserName,roleName,COMPONENT,privilege);
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
      fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ALL ON resourceType1 resourceName1 resourceType2 resourceName2 TO ROLE " + roleName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      TSentryPrivilege invalidPrivilege=new TSentryPrivilege(COMPONENT,service,Lists.newArrayList(new TAuthorizable("resourceType1","resourceName1")),"invalidAction");
      try {
        client.grantPrivilege(requestorUserName,roleName,COMPONENT,invalidPrivilege);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT INVALIDACTION ON resourceType1 resourceName1 TO ROLE " + roleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      client.revokePrivilege(requestorUserName,roleName,COMPONENT,privilege);
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
      fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ALL ON resourceType1 resourceName1 resourceType2 resourceName2 FROM ROLE " + roleName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      try {
        client.revokePrivilege(requestorUserName,"invalidRole",COMPONENT,invalidPrivilege);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE INVALIDACTION ON resourceType1 resourceName1 FROM ROLE invalidRole");
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      client.deleteRoleToGroups(requestorUserName,roleName,COMPONENT,Sets.newHashSet(testGroupName));
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DELETE_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ROLE " + roleName + " FROM GROUP "+ testGroupName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      try {
        client.deleteRoleToGroups(requestorUserName,"invalidRole",COMPONENT,Sets.newHashSet(testGroupName));
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DELETE_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ROLE invalidRole FROM GROUP " + testGroupName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      client.dropRole(requestorUserName,roleName,COMPONENT);
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DROP_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"DROP ROLE " + roleName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      try {
        client.dropRole(requestorUserName,roleName,COMPONENT);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DROP_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_COMPONENT,COMPONENT);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"DROP ROLE " + roleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.thrift.TestSentryGenericServiceIntegration </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testGrantRevokeWithGrantOption() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String adminUser=ADMIN_USER;
      Set<String> adminGroup=Sets.newHashSet(ADMIN_GROUP);
      String grantOptionUser="user1";
      Set<String> grantOptionGroup=Sets.newHashSet("group1");
      String noGrantOptionUser="user2";
      Set<String> noGrantOptionGroup=Sets.newHashSet("group2");
      setLocalGroupMapping(adminUser,adminGroup);
      setLocalGroupMapping(grantOptionUser,grantOptionGroup);
      setLocalGroupMapping(noGrantOptionUser,noGrantOptionGroup);
      writePolicyFile();
      String grantRole="grant_r";
      String noGrantRole="no_grant_r";
      String testRole="test_role";
      client.createRole(adminUser,grantRole,SOLR);
      client.createRole(adminUser,noGrantRole,SOLR);
      client.createRole(adminUser,testRole,SOLR);
      TSentryPrivilege grantPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"))),SearchConstants.QUERY);
      grantPrivilege.setGrantOption(TSentryGrantOption.TRUE);
      TSentryPrivilege noGrantPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"))),SearchConstants.QUERY);
      noGrantPrivilege.setGrantOption(TSentryGrantOption.FALSE);
      TSentryPrivilege testPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.QUERY);
      testPrivilege.setGrantOption(TSentryGrantOption.FALSE);
      client.grantPrivilege(adminUser,grantRole,SOLR,grantPrivilege);
      client.grantPrivilege(adminUser,noGrantRole,SOLR,noGrantPrivilege);
      client.addRoleToGroups(adminUser,grantRole,SOLR,grantOptionGroup);
      client.addRoleToGroups(adminUser,noGrantRole,SOLR,noGrantOptionGroup);
      try {
        client.grantPrivilege(grantOptionUser,testRole,SOLR,testPrivilege);
      }
 catch (      SentryUserException e) {
        fail("grantOptionUser failed grant privilege to user");
      }
      try {
        client.grantPrivilege(noGrantOptionUser,testRole,SOLR,testPrivilege);
        fail("noGrantOptionUser can't grant privilege to user");
      }
 catch (      SentryUserException e) {
      }
      try {
        client.revokePrivilege(grantOptionUser,testRole,SOLR,testPrivilege);
      }
 catch (      SentryUserException e) {
        fail("grantOptionUser failed revoke privilege to user");
      }
      try {
        client.revokePrivilege(noGrantOptionUser,testRole,SOLR,testPrivilege);
        fail("noGrantOptionUser can't revoke privilege to user");
      }
 catch (      SentryUserException e) {
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.tools.TestSentryShellSolr </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAddDeleteRoleForGroup() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String[] args=new String[]{"-arg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      SentryShellSolr sentryShell=new SentryShellSolr();
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected UnsupportedOperationException");
      }
 catch (      UnsupportedOperationException e) {
      }
      args=new String[]{"--add_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected UnsupportedOperationException");
      }
 catch (      UnsupportedOperationException e) {
      }
      args=new String[]{"-lr","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected UnsupportedOperationException");
      }
 catch (      UnsupportedOperationException e) {
      }
      args=new String[]{"--list_role","-g","testGroup2","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected UnsupportedOperationException");
      }
 catch (      UnsupportedOperationException e) {
      }
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected UnsupportedOperationException");
      }
 catch (      UnsupportedOperationException e) {
      }
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected UnsupportedOperationException");
      }
 catch (      UnsupportedOperationException e) {
      }
      args=new String[]{"--delete_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected UnsupportedOperationException");
      }
 catch (      UnsupportedOperationException e) {
      }
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNegativeCaseWithoutRequiredArgument() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String strOptionConf="conf";
      client.createRole(requestorName,TEST_ROLE_NAME_1,SOLR);
      String[] args={"-cr","-r",TEST_ROLE_NAME_1};
      SentryShellSolr sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + strOptionConf);
      args=new String[]{"-cr","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-dr","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-arg","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-arg","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_GROUP_NAME);
      args=new String[]{"-drg","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_GROUP_NAME);
      args=new String[]{"-gpr","-p","server=server1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_PRIVILEGE);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath(),"-p","collection=collection1"};
      sentryShell=new SentryShellSolr();
      try {
        getShellResultWithOSRedirect(sentryShell,args,false);
        fail("Expected IllegalArgumentException");
      }
 catch (      IllegalArgumentException e) {
        assert ("Privilege is invalid: action required but not specified.".equals(e.getMessage()));
      }
      args=new String[]{"-rpr","-p","server=server1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_PRIVILEGE);
      args=new String[]{"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      validateMissingParameterMsgsContains(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + "[","-arg Add group to role","-cr Create role","-rpr Revoke privilege from role","-drg Delete group from role","-lr List role","-lp List privilege","-gpr Grant privilege to role","-dr Drop role");
      client.dropRole(requestorName,TEST_ROLE_NAME_1,SOLR);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNegativeCaseWithInvalidArgument() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1,SOLR);
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr sentryShell=new SentryShellSolr();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for creating duplicate role");
      }
 catch (      SentryUserException e) {
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for dropping non-exist role");
      }
 catch (      SentryUserException e) {
      }
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","serverserver1->action=*","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for the error privilege format, invalid key value.");
      }
 catch (      IllegalArgumentException e) {
      }
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->table=tbl1->column=col2->action=insert","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for the error privilege format, invalid key value.");
      }
 catch (      IllegalArgumentException e) {
      }
      client.dropRole(requestorName,TEST_ROLE_NAME_1,SOLR);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.appender.TestRollingFileWithoutDeleteAppender </h4><pre class="type-12 type-16 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Generate log enough to cause a single rollover. Verify the file name format
 * @throws Throwable
 */
@Test public void testFileNamePattern() throws Throwable {
  if (dataDir == null) {
    fail("Excepted temp folder for audit log is created.");
  }
  RollingFileWithoutDeleteAppender appender=new RollingFileWithoutDeleteAppender(new PatternLayout("%m%n"),dataDir.getPath() + "/auditLog.log");
  appender.setMaximumFileSize(10);
  sentryLogger.addAppender(appender);
  sentryLogger.debug("123456789012345");
  File[] files=dataDir.listFiles();
  if (files != null) {
    assertEquals(files.length,2);
    assertTrue(files[0].getName().contains("auditLog.log."));
    assertTrue(files[1].getName().contains("auditLog.log."));
  }
 else {
    fail("Excepted 2 log files.");
  }
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRollOver() throws Throwable {
  if (dataDir == null) {
    fail("Excepted temp folder for audit log is created.");
  }
  RollingFileWithoutDeleteAppender appender=new RollingFileWithoutDeleteAppender(new PatternLayout("%m%n"),dataDir.getPath() + "/auditLog.log");
  appender.setMaximumFileSize(100);
  sentryLogger.addAppender(appender);
  for (int i=0; i < 99; i++) {
    if (i < 10) {
      sentryLogger.debug("Hello---" + i);
    }
 else     if (i < 100) {
      sentryLogger.debug("Hello--" + i);
    }
  }
  if (dataDir != null) {
    File[] files=dataDir.listFiles();
    if (files != null) {
      assertEquals(files.length,10);
    }
 else {
      fail("Excepted 10 log files.");
    }
  }
 else {
    fail("Excepted 10 log files.");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStore </h4><pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeColumnPrivilegeDowngradeByDb() throws Exception {
  String roleName="test-column-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeCol1=new TSentryPrivilege();
  privilegeCol1.setPrivilegeScope("COLUMN");
  privilegeCol1.setServerName(server);
  privilegeCol1.setDbName(db);
  privilegeCol1.setTableName(table);
  privilegeCol1.setColumnName(column1);
  privilegeCol1.setAction(AccessConstants.ALL);
  privilegeCol1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeCol2=privilegeCol1.deepCopy();
  ;
  privilegeCol2.setColumnName(column2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeCol2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilegeCol2.setAction(AccessConstants.INSERT);
  privilegeCol2.setPrivilegeScope("DATABASE");
  privilegeCol2.unsetTableName();
  privilegeCol2.unsetColumnName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(column1,mPrivilege.getColumnName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeTablePrivilegeDowngradeByDb() throws Exception {
  String roleName="test-table-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table1="tbl1";
  String table2="tbl2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeTable1=new TSentryPrivilege();
  privilegeTable1.setPrivilegeScope("TABLE");
  privilegeTable1.setServerName(server);
  privilegeTable1.setDbName(db);
  privilegeTable1.setTableName(table1);
  privilegeTable1.setAction(AccessConstants.ALL);
  privilegeTable1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeTable2=privilegeTable1.deepCopy();
  ;
  privilegeTable2.setTableName(table2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeTable2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getTableName().equals(table1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getTableName().equals(table2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected table name: " + mPrivilege.getTableName());
    }
  }
  privilegeTable2.setAction(AccessConstants.INSERT);
  privilegeTable2.setPrivilegeScope("DATABASE");
  privilegeTable2.unsetTableName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table1,mPrivilege.getTableName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCreateDuplicateRole() throws Exception {
  String roleName="test-dup-role";
  sentryStore.createSentryRole(roleName);
  try {
    sentryStore.createSentryRole(roleName);
    fail("Expected SentryAlreadyExistsException");
  }
 catch (  SentryAlreadyExistsException e) {
  }
}

</code></pre>

<br>
<pre class="type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-74 and SENTRY-552
 */
@Test public void testGrantRevokePrivilegeWithColumn() throws Exception {
  String roleName="test-col-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("COLUMN");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setColumnName(column1);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  privilege.setColumnName(column2);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.INSERT);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  assertEquals(column1,Iterables.get(privileges,0).getColumnName());
  assertEquals(AccessConstants.SELECT,Iterables.get(privileges,0).getAction());
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 5,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),0,privileges.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestAuthorizingDDLAuditLogWithKerberos </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testBasic() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName="testRole";
      String errorRoleName="errorRole";
      String serverName="server1";
      String groupName="testGroup";
      String dbName="dbTest";
      String tableName="tableTest";
      Map<String,String> fieldValueMap=new HashMap<String,String>();
      client.createRole(requestorUserName,roleName);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_CREATE_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"CREATE ROLE " + roleName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      client.grantRoleToGroup(requestorUserName,groupName,roleName);
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_ADD_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ROLE " + roleName + " TO GROUP "+ groupName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      client.grantDatabasePrivilege(requestorUserName,roleName,serverName,dbName,"ALL");
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ALL ON DATABASE " + dbName + " TO ROLE "+ roleName);
      fieldValueMap.put(Constants.LOG_FIELD_DATABASE_NAME,dbName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      client.grantTablePrivilege(requestorUserName,roleName,serverName,dbName,tableName,"SELECT",true);
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT SELECT ON TABLE " + tableName + " TO ROLE "+ roleName+ " WITH GRANT OPTION");
      fieldValueMap.put(Constants.LOG_FIELD_TABLE_NAME,tableName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      try {
        client.createRole(requestorUserName,roleName);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_CREATE_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"CREATE ROLE " + roleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.grantRoleToGroup(requestorUserName,groupName,errorRoleName);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_ADD_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ROLE " + errorRoleName + " TO GROUP "+ groupName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.grantDatabasePrivilege(requestorUserName,errorRoleName,serverName,dbName,"ALL");
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ALL ON DATABASE " + dbName + " TO ROLE "+ errorRoleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.grantDatabasePrivilege(requestorUserName,errorRoleName,serverName,dbName,"INSERT");
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT INSERT ON DATABASE " + dbName + " TO ROLE "+ errorRoleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.grantDatabasePrivilege(requestorUserName,errorRoleName,serverName,dbName,"SELECT");
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT SELECT ON DATABASE " + dbName + " TO ROLE "+ errorRoleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.grantTablePrivilege(requestorUserName,errorRoleName,serverName,dbName,tableName,"SELECT");
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT SELECT ON TABLE " + tableName + " TO ROLE "+ errorRoleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      client.revokeTablePrivilege(requestorUserName,roleName,serverName,dbName,tableName,"SELECT");
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE SELECT ON TABLE " + tableName + " FROM ROLE "+ roleName);
      fieldValueMap.put(Constants.LOG_FIELD_TABLE_NAME,tableName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      client.revokeDatabasePrivilege(requestorUserName,roleName,serverName,dbName,"ALL");
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ALL ON DATABASE " + dbName + " FROM ROLE "+ roleName);
      fieldValueMap.put(Constants.LOG_FIELD_DATABASE_NAME,dbName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      client.revokeRoleFromGroup(requestorUserName,groupName,roleName);
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DELETE_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ROLE " + roleName + " FROM GROUP "+ groupName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      client.dropRole(requestorUserName,roleName);
      fieldValueMap.clear();
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DROP_ROLE);
      fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"DROP ROLE " + roleName);
      fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
      fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
      assertAuditLog(fieldValueMap);
      try {
        client.revokeTablePrivilege(requestorUserName,errorRoleName,serverName,dbName,tableName,"SELECT");
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE SELECT ON TABLE " + tableName + " FROM ROLE "+ errorRoleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.revokeDatabasePrivilege(requestorUserName,errorRoleName,serverName,dbName,"ALL");
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ALL ON DATABASE " + dbName + " FROM ROLE "+ errorRoleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.revokeRoleFromGroup(requestorUserName,groupName,errorRoleName);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DELETE_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ROLE " + errorRoleName + " FROM GROUP "+ groupName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
      try {
        client.dropRole(requestorUserName,errorRoleName);
        fail("Exception should have been thrown");
      }
 catch (      Exception e) {
        fieldValueMap.clear();
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DROP_ROLE);
        fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"DROP ROLE " + errorRoleName);
        fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
        fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
        assertAuditLog(fieldValueMap);
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceFailureCase </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClientServerConnectionFailure() throws Exception {
  try {
    connectToSentryService();
    Assert.fail("Failed to receive Exception");
  }
 catch (  PrivilegedActionException e) {
    LOGGER.info("Excepted exception",e);
    Exception cause=e.getException();
    if (cause == null) {
      throw e;
    }
    String msg="Exception message: " + cause.getMessage() + " to contain "+ PEER_CALLBACK_FAILURE;
    Assert.assertTrue(msg,Strings.nullToEmpty(cause.getMessage()).contains(PEER_CALLBACK_FAILURE));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceImportExport </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testImportExportPolicy9() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Map<String,Map<String,Set<String>>> policyFileMappingData1=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap1=Maps.newHashMap();
      Map<String,Set<String>> rolePrivilegesMap1=Maps.newHashMap();
      policyFileMappingData1.put(PolicyFileConstants.GROUPS,groupRolesMap1);
      policyFileMappingData1.put(PolicyFileConstants.ROLES,rolePrivilegesMap1);
      try {
        client.importPolicy(policyFileMappingData1,"no-admin-user",false);
        fail("non-admin can't do the import.");
      }
 catch (      Exception e) {
      }
      try {
        client.exportPolicy("no-admin-user");
        fail("non-admin can't do the export.");
      }
 catch (      Exception e) {
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceIntegration </h4><pre class="type-12 type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * List privileges by authorizables executed by non-admin user
 * Test various positive and negative cases for non-admin user
 * @throws Exception
 */
@Test public void testListByAuthTabForNonAdmin() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      String user1="user1";
      String group1="group1";
      String group2="group2";
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      Set<String> userGroupNames1=Sets.newHashSet(group1);
      Set<String> userGroupNames2=Sets.newHashSet(group2);
      String roleName1="role1";
      String roleName2="role2";
      String server="server1";
      String db="testDB";
      String db2="testDB2";
      String tab="testTab";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(user1,userGroupNames1);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantDatabasePrivilege(requestorUserName,roleName1,server,db,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db,tab,AccessConstants.ALL);
      TSentryPrivilege role1db2tab=client.grantTablePrivilege(requestorUserName,roleName1,server,db2,tab,AccessConstants.SELECT);
      client.grantRoleToGroup(requestorUserName,group1,roleName1);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db,AccessConstants.ALL);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db2,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName2,server,db2,tab,AccessConstants.ALL);
      client.grantURIPrivilege(requestorUserName,roleName1,server,"hdfs:///fooUri");
      TSentryPrivilegeMap db1RoleToPrivMap=new TSentryPrivilegeMap(new TreeMap<String,Set<TSentryPrivilege>>());
      db1RoleToPrivMap.getPrivilegeMap().put(roleName1,Sets.newHashSet(role1db2tab));
      Map<TSentryAuthorizable,TSentryPrivilegeMap> expectedResults=Maps.newTreeMap();
      List<? extends Authorizable> db2TabAuthorizable=Lists.newArrayList(new Server(server),new Database(db2),new Table(tab));
      expectedResults.put(SentryPolicyServiceClientDefaultImpl.setupSentryAuthorizable(db2TabAuthorizable),db1RoleToPrivMap);
      Set<List<? extends Authorizable>> authorizableSet=Sets.newHashSet();
      authorizableSet.add(db2TabAuthorizable);
      Map<TSentryAuthorizable,TSentryPrivilegeMap> authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,new HashSet<String>(),null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,new ActiveRoleSet(true));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames1,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames1,new ActiveRoleSet(true));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,new ActiveRoleSet(Sets.newHashSet(roleName1.toUpperCase())));
      assertEquals(expectedResults,authPrivMap);
      try {
        client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames2,null);
        fail("listPrivilegsbyAuthorizable() should fail for user1 accessing " + group2);
      }
 catch (      SentryAccessDeniedException e) {
      }
      ActiveRoleSet roleSet2=new ActiveRoleSet(Sets.newHashSet(roleName2));
      try {
        client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,roleSet2);
        fail("listPrivilegsbyAuthorizable() should fail for user1 accessing " + roleName2);
      }
 catch (      SentryAccessDeniedException e) {
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryWebServerWithKerberos </h4><pre class="type-16 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testPingWithUnauthorizedUser() throws Exception {
  String userPrinciple="user/" + SERVER_HOST;
  String userKerberosName=userPrinciple + "@" + REALM;
  Subject userSubject=new Subject(false,Sets.newHashSet(new KerberosPrincipal(userKerberosName)),new HashSet(),new HashSet());
  File userKeytab=new File(kdcWorkDir,"user.keytab");
  kdc.createPrincipal(userKeytab,userPrinciple);
  LoginContext userLoginContext=new LoginContext("",userSubject,null,KerberosConfiguration.createClientConfig(userKerberosName,userKeytab));
  userLoginContext.login();
  Subject.doAs(userLoginContext.getSubject(),new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
      try {
        new AuthenticatedURL(new KerberosAuthenticator()).openConnection(url,new AuthenticatedURL.Token());
        fail("Here should fail.");
      }
 catch (      AuthenticationException e) {
        String expectedError="status code: 403";
        if (!e.getMessage().contains(expectedError)) {
          LOG.error("UnexpectedError: " + e.getMessage(),e);
          fail("UnexpectedError: " + e.getMessage());
        }
      }
      return null;
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPingWithoutSubject() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  try {
    new AuthenticatedURL(new KerberosAuthenticator()).openConnection(url,new AuthenticatedURL.Token());
    fail("Here should fail.");
  }
 catch (  Exception e) {
    boolean isExpectError=e.getMessage().contains("No valid credentials provided");
    Assert.assertTrue("Here should fail by 'No valid credentials provided'," + " but the exception is:" + e,isExpectError);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.tools.TestSentryShellHive </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNegativeCaseWithInvalidArgument() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for creating duplicate role");
      }
 catch (      SentryUserException e) {
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for dropping non-exist role");
      }
 catch (      SentryUserException e) {
      }
      args=new String[]{"-arg","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for granting non-exist role to group");
      }
 catch (      SentryUserException e) {
      }
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for drop group from non-exist role");
      }
 catch (      SentryUserException e) {
      }
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","serverserver1->action=*","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for the error privilege format, invalid key value.");
      }
 catch (      IllegalArgumentException e) {
      }
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->table=tbl1->column=col2->action=insert","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      try {
        sentryShell.executeShell(args);
        fail("Exception should be thrown for the error privilege format, invalid key value.");
      }
 catch (      IllegalArgumentException e) {
      }
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.file.TestLocalGroupMapping </h4><pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGroupMapping(){
  Set<String> fooGroupsFromResource=localGroupMapping.getGroups("foo");
  Assert.assertEquals(fooGroupsFromResource,fooGroups);
  Set<String> barGroupsFromResource=localGroupMapping.getGroups("bar");
  Assert.assertEquals(barGroupsFromResource,barGroups);
  try {
    localGroupMapping.getGroups("unknown");
    Assert.fail("SentryGroupNotFoundException should be thrown.");
  }
 catch (  SentryGroupNotFoundException sgnfe) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.file.TestSimpleFileProvderBackend </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInitializeTwice(){
  backend.initialize(context);
  try {
    backend.initialize(context);
    fail("Expected IllegalStateException on second initialze");
  }
 catch (  IllegalStateException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.sqoop.TestSentryAuthorizationHander </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that incorrect specification of classes for
 * AUTHZ_ACCESS_CONTROLLER and AUTHZ_ACCESS_VALIDATOR
 * correctly throw ClassNotFoundExceptions
 */
@Test public void testClassNotFound() throws Exception {
  try {
    SecurityFactory.getAuthorizationAccessController("org.apache.sentry.sqoop.authz.BogusSentryAccessController");
    fail("Exception should have been thrown");
  }
 catch (  Exception ex) {
  }
  try {
    SecurityFactory.getAuthorizationValidator("org.apache.sentry.sqoop.authz.BogusSentryAuthorizationValidator");
    fail("Exception should have been thrown");
  }
 catch (  Exception ex) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestColumnEndToEnd </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testShowColumns() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE database " + DB1);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE test_tb (s string, i string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("GRANT SELECT (s) ON TABLE test_tb TO ROLE user_role1");
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  ResultSet res=statement.executeQuery("show columns in test_tb");
  List<String> expectedResult=new ArrayList<String>();
  List<String> returnedResult=new ArrayList<String>();
  expectedResult.add("s");
  while (res.next()) {
    returnedResult.add(res.getString(1).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("CREATE ROLE user_role2");
  statement.execute("GRANT SELECT(s, i) ON TABLE test_tb TO ROLE user_role2");
  statement.execute("GRANT ROLE user_role2 TO GROUP " + USERGROUP2);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  res=statement.executeQuery("show columns in test_tb");
  expectedResult.add("s");
  expectedResult.add("i");
  while (res.next()) {
    returnedResult.add(res.getString(1).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("show columns in db_1.test_tb");
    fail("No valid privileges exception should have been thrown");
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDescribeTbl() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE IF NOT EXISTS t1 (c1 string, c2 string)");
  statement.execute("CREATE TABLE t2 (c1 string, c2 string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE user_role1");
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  ResultSet rs=statement.executeQuery("DESCRIBE t1");
  assertTrue(rs.next());
  assertEquals("c1",rs.getString(1));
  assertEquals("string",rs.getString(2));
  assertTrue(rs.next());
  assertEquals("c2",rs.getString(1));
  assertEquals("string",rs.getString(2));
  statement.executeQuery("DESCRIBE t1 c1");
  statement.executeQuery("DESCRIBE t1 c2");
  try {
    statement.executeQuery("DESCRIBE t2");
    fail("Expected DESCRIBE to fail on t2");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE FORMATTED t1");
    fail("Expected DESCRIBE FORMATTED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE EXTENDED t1");
    fail("Expected DESCRIBE EXTENDED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP TABLE t1");
  statement.execute("DROP TABLE t2");
  statement.execute("DROP ROLE user_role1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDatabaseProvider </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-303 and SENTRY-543.
 */
@Test public void testGrantRevokeSELECTonDb() throws Exception {
  File dataFile=doSetupForGrantDbTests();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("GRANT SELECT ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("SELECT * FROM " + DB1 + ".t2");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("only SELECT allowed on t1!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t2");
    assertTrue("only SELECT allowed on t2!!",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("REVOKE SELECT ON DATABASE " + DB1 + " FROM ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    fail("SELECT should have been revoked from t1");
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    fail("SELECT should have been revoked from t2");
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  String testRole0="role1", testRole1="role2";
  statement.execute("CREATE ROLE " + testRole0);
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("GRANT ROLE " + testRole0 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ USERGROUP1);
  statement.execute("SET ROLE " + testRole0);
  try {
    statement.execute("SET ROLE " + testRole1);
    fail("User " + ADMIN1 + " shouldn't be able to set "+ testRole1);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SET ROLE " + testRole1);
  try {
    statement.execute("SET ROLE " + testRole0);
    fail("User " + USER1_1 + " shouldn't be able to set "+ testRole0);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbDDLAuditLog </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testBasic() throws Exception {
  String roleName="testRole";
  String groupName="testGroup";
  String dbName="dbTest";
  String tableName="tableTest";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  Map<String,String> fieldValueMap=new HashMap<String,String>();
  statement.execute("CREATE ROLE " + roleName);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_CREATE_ROLE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"CREATE ROLE " + roleName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  statement.execute("GRANT ROLE " + roleName + " TO GROUP "+ groupName);
  fieldValueMap.clear();
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_ADD_ROLE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ROLE " + roleName + " TO GROUP "+ groupName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  statement.execute("create database " + dbName);
  statement.execute("use " + dbName);
  statement.execute("CREATE TABLE " + tableName + " (c1 string)");
  statement.execute("GRANT ALL ON DATABASE " + dbName + " TO ROLE "+ roleName);
  fieldValueMap.clear();
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ALL ON DATABASE " + dbName + " TO ROLE "+ roleName);
  fieldValueMap.put(Constants.LOG_FIELD_DATABASE_NAME,dbName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  statement.execute("GRANT SELECT ON TABLE " + tableName + " TO ROLE "+ roleName+ " WITH GRANT OPTION");
  fieldValueMap.clear();
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT SELECT ON TABLE " + tableName + " TO ROLE "+ roleName+ " WITH GRANT OPTION");
  fieldValueMap.put(Constants.LOG_FIELD_TABLE_NAME,tableName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  try {
    statement.execute("CREATE ROLE " + roleName);
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_CREATE_ROLE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"CREATE ROLE " + roleName);
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("GRANT ROLE errorROLE TO GROUP " + groupName);
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_ADD_ROLE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ROLE errorROLE TO GROUP " + groupName);
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("GRANT ALL ON DATABASE " + dbName + " TO ROLE errorRole");
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT ALL ON DATABASE " + dbName + " TO ROLE errorRole");
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("GRANT INSERT ON DATABASE " + dbName + " TO ROLE errorRole");
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT INSERT ON DATABASE " + dbName + " TO ROLE errorRole");
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("GRANT SELECT ON DATABASE " + dbName + " TO ROLE errorRole");
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT SELECT ON DATABASE " + dbName + " TO ROLE errorRole");
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("GRANT SELECT ON TABLE " + tableName + " TO ROLE errorRole");
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_GRANT_PRIVILEGE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"GRANT SELECT ON TABLE " + tableName + " TO ROLE errorRole");
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  statement.execute("REVOKE SELECT ON TABLE " + tableName + " FROM ROLE "+ roleName);
  fieldValueMap.clear();
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE SELECT ON TABLE " + tableName + " FROM ROLE "+ roleName);
  fieldValueMap.put(Constants.LOG_FIELD_TABLE_NAME,tableName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  statement.execute("REVOKE ALL ON DATABASE " + dbName + " FROM ROLE "+ roleName);
  fieldValueMap.clear();
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ALL ON DATABASE " + dbName + " FROM ROLE "+ roleName);
  fieldValueMap.put(Constants.LOG_FIELD_DATABASE_NAME,dbName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  statement.execute("REVOKE ROLE " + roleName + " FROM GROUP "+ groupName);
  fieldValueMap.clear();
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DELETE_ROLE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ROLE " + roleName + " FROM GROUP "+ groupName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  statement.execute("DROP ROLE " + roleName);
  fieldValueMap.clear();
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DROP_ROLE);
  fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"DROP ROLE " + roleName);
  fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.TRUE);
  fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
  assertAuditLog(fieldValueMap);
  try {
    statement.execute("REVOKE SELECT ON TABLE " + tableName + " FROM ROLE errorRole");
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE SELECT ON TABLE " + tableName + " FROM ROLE errorRole");
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("REVOKE ALL ON DATABASE " + dbName + " FROM ROLE errorRole");
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_REVOKE_PRIVILEGE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ALL ON DATABASE " + dbName + " FROM ROLE errorRole");
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("REVOKE ROLE errorRole FROM GROUP " + groupName);
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DELETE_ROLE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"REVOKE ROLE errorRole FROM GROUP " + groupName);
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  try {
    statement.execute("DROP ROLE errorRole");
    fail("Exception should have been thrown");
  }
 catch (  Exception e) {
    fieldValueMap.clear();
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION,Constants.OPERATION_DROP_ROLE);
    fieldValueMap.put(Constants.LOG_FIELD_OPERATION_TEXT,"DROP ROLE errorRole");
    fieldValueMap.put(Constants.LOG_FIELD_ALLOWED,Constants.FALSE);
    fieldValueMap.put(Constants.LOG_FIELD_IP_ADDRESS,null);
    assertAuditLog(fieldValueMap);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegration </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Make sure when events such as table creation fail, the path should not be sync to NameNode plugin.
 */
@Test public void testTableCreationFailure() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external");
  if (!miniDFS.getFileSystem().exists(tmpHDFSDir)) {
    miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  }
  miniDFS.getFileSystem().setPermission(tmpHDFSDir,FsPermission.valueOf("drwxrwx---"));
  Path partitionDir=new Path("/tmp/external/p1");
  if (!miniDFS.getFileSystem().exists(partitionDir)) {
    miniDFS.getFileSystem().mkdirs(partitionDir);
  }
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant all on uri 'hdfs:///tmp/external' to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  stmt.execute("grant role admin_role to group " + StaticUserGroup.HIVE);
  stmt.close();
  conn.close();
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  try {
    stmt.execute("create external table tab1(a int) location 'hdfs:///tmp/external/p1'");
    Assert.fail("Expect table creation to fail");
  }
 catch (  Exception ex) {
    LOGGER.error("Exception when creating table: " + ex.getMessage());
  }
  verifyOnAllSubDirs("/tmp/external/p1",null,StaticUserGroup.HIVE,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Make sure when events such as drop table fail, the path should not be sync to NameNode plugin.
 */
@Test public void testDropPartitionFailure() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external");
  if (!miniDFS.getFileSystem().exists(tmpHDFSDir)) {
    miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  }
  miniDFS.getFileSystem().setPermission(tmpHDFSDir,FsPermission.valueOf("drwxrwxrwx"));
  Path partitionDir=new Path("/tmp/external/p1");
  if (!miniDFS.getFileSystem().exists(partitionDir)) {
    miniDFS.getFileSystem().mkdirs(partitionDir);
  }
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  stmt.close();
  conn.close();
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("create table tab3 (s string) partitioned by (month int)");
  stmt.execute("alter table tab3 add partition (month = 1) location '/tmp/external/p1'");
  miniDFS.getFileSystem().setPermission(tmpHDFSDir,FsPermission.valueOf("drwxrwx---"));
  try {
    stmt.execute("ALTER TABLE tab3 DROP PARTITION (month = 1)");
    Assert.fail("Expect dropping partition to fail");
  }
 catch (  Exception ex) {
    LOGGER.error("Exception when dropping partition: " + ex.getMessage());
  }
  verifyOnAllSubDirs("/tmp/external/p1",FsAction.ALL,StaticUserGroup.HIVE,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Make sure when events such as add partition fail, the path should not be sync to NameNode plugin.
 */
@Test public void testAddPartitionFailure() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external");
  if (!miniDFS.getFileSystem().exists(tmpHDFSDir)) {
    miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  }
  miniDFS.getFileSystem().setPermission(tmpHDFSDir,FsPermission.valueOf("drwxrwx---"));
  Path partitionDir=new Path("/tmp/external/p1");
  if (!miniDFS.getFileSystem().exists(partitionDir)) {
    miniDFS.getFileSystem().mkdirs(partitionDir);
  }
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  stmt.close();
  conn.close();
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("create external table tab2 (s string) partitioned by (month int)");
  try {
    stmt.execute("alter table tab2 add partition (month = 1) location '/tmp/external/p1'");
    Assert.fail("Expect adding partition to fail");
  }
 catch (  Exception ex) {
    LOGGER.error("Exception when adding partition: " + ex.getMessage());
  }
  verifyOnAllSubDirs("/tmp/external/p1",null,StaticUserGroup.HIVE,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Make sure when events such as drop table fail, the path should not be sync to NameNode plugin.
 */
@Test public void testDropTableFailure() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external");
  if (!miniDFS.getFileSystem().exists(tmpHDFSDir)) {
    miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  }
  miniDFS.getFileSystem().setPermission(tmpHDFSDir,FsPermission.valueOf("drwxrwxrwx"));
  Path partitionDir=new Path("/tmp/external/p1");
  if (!miniDFS.getFileSystem().exists(partitionDir)) {
    miniDFS.getFileSystem().mkdirs(partitionDir);
  }
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  stmt.close();
  conn.close();
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("create external table tab1(a int) location 'hdfs:///tmp/external/p1'");
  miniDFS.getFileSystem().setPermission(tmpHDFSDir,FsPermission.valueOf("drwxrwx---"));
  try {
    stmt.execute("drop table tab1");
    Assert.fail("Expect dropping table to fail");
  }
 catch (  Exception ex) {
    LOGGER.error("Exception when creating table: " + ex.getMessage());
  }
  verifyOnAllSubDirs("/tmp/external/p1",FsAction.ALL,StaticUserGroup.HIVE,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestConfigTool </h4><pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify errors/warnings from malformed policy file
 * @throws Exception
 */
@Test public void testInvalidPolicy() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=db1->table=tab1->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setupConfig();
  try {
    configTool.getSentryProvider().validateResource(true);
    fail("Policy validation should fail for malformed policy");
  }
 catch (  SentryConfigurationException e) {
    assertTrue(e.getConfigWarnings().get(0).contains("Role select_tab3 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(1).contains("Role insert_tab2 for group " + USERGROUP1 + " does not exist"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * verify missing permissions for query using remote query validation
 * @throws Exception
 */
@Test public void testQueryPermissions() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addRolesToGroup(USERGROUP3,"select_colAB").addRolesToGroup(USERGROUP4,"select_colA").addPermissionsToRole("select_tab1","server=server1->db=default->table=tab1->action=select").addPermissionsToRole("insert_tab2","server=server1->db=default->table=tab2->action=insert").addPermissionsToRole("select_tab3","server=server1->db=default->table=tab3->action=select").addPermissionsToRole("select_colA","server=server1->db=default->table=tab1->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=default->table=tab1->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=default->table=tab1->column=b->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS tab1");
  statement.execute("DROP TABLE IF EXISTS tab2");
  statement.execute("DROP TABLE IF EXISTS tab3");
  statement.execute("CREATE TABLE tab1(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE tab2(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE tab3(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.close();
  connection.close();
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setJdbcURL(context.getConnectionURL());
  configTool.setUser(USER1_1);
  configTool.setupConfig();
  ByteArrayOutputStream errBuffer=new ByteArrayOutputStream();
  configTool.setUser(USER1_1);
  configTool.verifyRemoteQuery("SELECT COUNT(*) FROM tab1");
  try {
    System.setOut(new PrintStream(errBuffer));
    configTool.setUser(USER1_1);
    configTool.verifyRemoteQuery("SELECT COUNT(*) FROM tab3");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab3->action=select"));
    errBuffer.flush();
  }
  try {
    configTool.setUser(USER2_1);
    configTool.verifyRemoteQuery("INSERT OVERWRITE TABLE tab2 SELECT * FROM tab3");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab2->action=insert"));
    errBuffer.flush();
  }
  configTool.setUser(USER3_1);
  configTool.verifyRemoteQuery("SELECT a FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(a) FROM tab1");
  configTool.verifyRemoteQuery("SELECT b FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(b) FROM tab1");
  configTool.verifyRemoteQuery("SELECT a,b FROM tab1");
  configTool.setUser(USER4_1);
  configTool.verifyRemoteQuery("SELECT a FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(a) FROM tab1");
  try {
    configTool.setUser(USER4_1);
    configTool.verifyRemoteQuery("SELECT b FROM tab1");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab1->Column=b->action=select"));
    errBuffer.flush();
  }
  try {
    configTool.setUser(USER4_1);
    configTool.verifyRemoteQuery("SELECT COUNT(b) FROM tab1");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab1->Column=b->action=select"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify errors/warnings from malformed policy file with per-DB policy
 * @throws Exception
 */
@Test public void testInvalidPerDbPolicy() throws Exception {
  PolicyFile db2PolicyFile=new PolicyFile();
  File db2PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB2_POLICY_FILE);
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl2","insert_db2_tab2").addPermissionsToRole("select_tbl2","server=server1->db=db2->table=tbl2->action=select").write(db2PolicyFileHandle);
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl3").addPermissionsToRole("select_tbl1","server=server1->db=db1->table=tbl1->action=select").addDatabase("db2",prefix + db2PolicyFileHandle.getName()).setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setupConfig();
  try {
    configTool.getSentryProvider().validateResource(true);
    fail("Policy validation should fail for malformed policy");
  }
 catch (  SentryConfigurationException e) {
    assertTrue(e.getConfigWarnings().get(0).contains("Role select_tbl3 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(0).contains(context.getPolicyFile().getName()));
    assertTrue(e.getConfigWarnings().get(1).contains("Role insert_db2_tab2 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(1).contains(db2PolicyFileHandle.getName()));
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the mock compilation config setting forces query to abort
 * @throws Exception
 */
@Test public void testMockCompilation() throws Exception {
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS tab1");
  statement.execute("CREATE TABLE tab1(B INT, A STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("SELECT * FROM tab1");
  statement.execute("SET " + HiveAuthzConf.HIVE_SENTRY_MOCK_COMPILATION + "=true");
  try {
    statement.execute("SELECT * FROM tab1");
    fail("Query should fail with mock error config enabled");
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains(HiveAuthzConf.HIVE_SENTRY_MOCK_ERROR));
  }
  statement.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestCrossDbOps </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testShowDatabasesAndShowTables() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB1(id int)");
  statement.executeQuery("SHOW TABLES");
  statement.execute("USE " + DB2);
  statement.execute("CREATE TABLE TAB2(id int)");
  statement.execute("CREATE TABLE TAB3(id int)");
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=" + DB1 + "->table=tab1->action=select").addPermissionsToRole("select_tab3","server=server1->db=" + DB2 + "->table=tab3->action=select").addPermissionsToRole("insert_tab2","server=server1->db=" + DB2 + "->table=tab2->action=insert").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  if (useSentryService) {
    PrivilegeResultSet pRset=new PrivilegeResultSet(statement,"SHOW GRANT ROLE select_tab1 ON DATABASE " + DB1);
    LOGGER.info("SHOW GRANT ROLE select_tab1 ON DATABASE " + DB1 + " : "+ pRset.toString());
    pRset.verifyResultSetColumn("database",DB1);
    pRset.verifyResultSetColumn("table","tab1");
    pRset=new PrivilegeResultSet(statement,"SHOW GRANT ROLE insert_tab2 ON DATABASE " + DB2);
    LOGGER.info("SHOW GRANT ROLE insert_tab2 ON DATABASE " + DB2 + " : "+ pRset.toString());
    pRset.verifyResultSetColumn("database",DB2);
    pRset.verifyResultSetColumn("table","tab2");
    pRset=new PrivilegeResultSet(statement,"SHOW GRANT ROLE select_tab3 ON DATABASE " + DB2);
    LOGGER.info("SHOW GRANT ROLE select_tab3 ON DATABASE " + DB2 + " : "+ pRset.toString());
    pRset.verifyResultSetColumn("database",DB2);
    pRset.verifyResultSetColumn("table","tab3");
  }
  Connection conn=context.createConnection(USER1_1);
  Statement stmt=context.createStatement(conn);
  PrivilegeResultSet pRset=new PrivilegeResultSet(stmt,"SHOW DATABASES");
  LOGGER.info("found databases :" + pRset.toString());
  pRset.verifyResultSetColumn("database_name",DB1);
  pRset.verifyResultSetColumn("database_name",DB2);
  stmt.execute("USE " + DB1);
  pRset=new PrivilegeResultSet(stmt,"SHOW TABLES");
  LOGGER.info("found tables :" + pRset.toString());
  pRset.verifyResultSetColumn("tab_name","tab1");
  stmt.execute("USE " + DB2);
  pRset=new PrivilegeResultSet(stmt,"SHOW TABLES");
  LOGGER.info("found tables :" + pRset.toString());
  pRset.verifyResultSetColumn("tab_name","tab2");
  try {
    stmt.close();
    conn.close();
  }
 catch (  Exception ex) {
  }
  conn=context.createConnection(USER2_1);
  stmt=context.createStatement(conn);
  pRset=new PrivilegeResultSet(stmt,"SHOW DATABASES");
  pRset.verifyResultSetColumn("database_name",DB2);
  stmt.execute("USE " + DB2);
  pRset=new PrivilegeResultSet(stmt,"SHOW TABLES");
  pRset.verifyResultSetColumn("tab_name","tab3");
  try {
    stmt.execute("USE " + DB1);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestLockPrivileges </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLockDatabase() throws Exception {
  String partialErrorMsgForNoPrivilege="No valid privileges";
  String assertErrorException="The exception is not the same as the expectation.";
  String assertExceptionThrown="SQLException will be thrown.";
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("lock_db1",privileges.get("lock_db1")).addRolesToGroup(USERGROUP1,"lock_db1").addPermissionsToRole("insert_db1",privileges.get("insert_db1")).addRolesToGroup(USERGROUP2,"insert_db1").addPermissionsToRole("select_db1",privileges.get("select_db1")).addRolesToGroup(USERGROUP2,"select_db1").addPermissionsToRole("alter_db1",privileges.get("alter_db1")).addRolesToGroup(USERGROUP2,"alter_db1").addPermissionsToRole("all_db1",privileges.get("all_db1")).addRolesToGroup(USERGROUP3,"all_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK DATABASE db_1 SHARED");
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  try {
    statement.execute("LOCK DATABASE db_1 SHARED");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK DATABASE db_1 SHARED");
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLockTable() throws Exception {
  String partialErrorMsgForNoPrivilege="No valid privileges";
  String assertErrorException="The exception is not the same as the expectation.";
  String assertExceptionThrown="SQLException will be thrown.";
  adminCreate(DB1,tableName);
  policyFile.addPermissionsToRole("lock_db1_tb1",privileges.get("lock_db1_tb1")).addRolesToGroup(USERGROUP1,"lock_db1_tb1").addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP2,"insert_db1_tb1").addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addRolesToGroup(USERGROUP2,"select_db1_tb1").addPermissionsToRole("alter_db1_tb1",privileges.get("alter_db1_tb1")).addRolesToGroup(USERGROUP2,"alter_db1_tb1").addPermissionsToRole("all_db1_tb1",privileges.get("all_db1_tb1")).addRolesToGroup(USERGROUP3,"all_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK TABLE tb1 SHARED");
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  try {
    statement.execute("LOCK TABLE tb1 SHARED");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK TABLE tb1 SHARED");
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPolicyImportExport </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testImportExportPolicyForError() throws Exception {
  prepareForImport("testPolicyImportError.ini");
  try {
    configTool.importPolicy();
    fail("IllegalArgumentException should be thrown for: Invalid key value: server [server]");
  }
 catch (  IllegalArgumentException ex) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtColumnScope </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSelectColumnOnViewJoin() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_view1_A","select_view1_B","select_view2_B").addRolesToGroup(USERGROUP2,"select_view1_B","select_view2_B").addRolesToGroup(USERGROUP3,"select_view1_B","select_view2_A").addPermissionsToRole("select_view1_A","server=server1->db=DB_1->table=VIEW_1->column=A->action=select").addPermissionsToRole("select_view1_B","server=server1->db=DB_1->table=VIEW_1->column=B->action=select").addPermissionsToRole("select_view2_A","server=server1->db=DB_1->table=VIEW_2->column=A->action=select").addPermissionsToRole("select_view2_B","server=server1->db=DB_1->table=VIEW_2->column=B->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  try {
    statement.execute("SELECT COUNT(*) FROM VIEW_1 V1 JOIN VIEW_2 V2 ON (V1.B = V2.B)");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(*) FROM VIEW_1 V1 JOIN TAB_2 T2 ON (V1.B = T2.B)");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(*) FROM TAB_1 T1 JOIN TAB_2 T2 ON (T1.B = T2.B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSelectColumnOnTable() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1_A","select_tab2_A").addRolesToGroup(USERGROUP2,"select_tab1_A","select_tab1_B","select_tab2_A","select_tab2_B").addPermissionsToRole("select_tab1_A","server=server1->db=DB_1->table=TAB_1->column=A->action=select").addPermissionsToRole("select_tab1_B","server=server1->db=DB_1->table=TAB_1->column=B->action=select").addPermissionsToRole("select_tab2_A","server=server1->db=DB_1->table=TAB_2->column=A->action=select").addPermissionsToRole("select_tab2_B","server=server1->db=DB_1->table=TAB_2->column=B->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  statement.executeQuery("SELECT A FROM TAB_1");
  try {
    statement.execute("SELECT COUNT(B) FROM TAB_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT B FROM TAB_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(A) FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  statement.executeQuery("SELECT COUNT(B) FROM TAB_1");
  try {
    statement.execute("SELECT COUNT(*) FROM TAB_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.executeQuery("SELECT * FROM TAB_1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSelectColumnOnTableViewJoin() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1_A","select_tab1_B","select_view2_B").addPermissionsToRole("select_tab1_A","server=server1->db=DB_1->table=VIEW_1->column=A->action=select").addPermissionsToRole("select_tab1_B","server=server1->db=DB_1->table=VIEW_1->column=B->action=select").addPermissionsToRole("select_view2_B","server=server1->db=DB_1->table=VIEW_2->column=B->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  try {
    statement.execute("SELECT COUNT(*) FROM VIEW_1 V1 JOIN TAB_2 T2 ON (V1.B = T2.B)");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(*) FROM VIEW_1 V1 JOIN VIEW_2 V2 ON (V1.B = V2.B)");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(*) FROM TAB_1 T1 JOIN TAB_2 T2 ON (T1.B = T2.B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSelectColumnOnTableJoin() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1_A","select_tab1_B","select_tab2_B").addPermissionsToRole("select_tab1_A","server=server1->db=DB_1->table=TAB_1->column=A->action=select").addPermissionsToRole("select_tab1_B","server=server1->db=DB_1->table=TAB_1->column=B->action=select").addPermissionsToRole("select_tab2_B","server=server1->db=DB_1->table=TAB_2->column=B->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  statement.executeQuery("SELECT COUNT(T1.B) FROM TAB_1 T1 JOIN TAB_2 T2 ON T1.B = T2.B AND T1.A = '21' ");
  try {
    statement.execute("SELECT COUNT(T1.B) FROM TAB_1 T1 JOIN TAB_2 T2 ON T1.B = T2.B AND T1.A = '21' AND T2.A = '21'");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.executeQuery("SELECT T1.* FROM TAB_1 T1, TAB_2 T2 WHERE T1.B = T2.B AND T1.A = '21'");
  try {
    statement.execute("SELECT T1.* FROM TAB_1 T1, TAB_2 T2 WHERE T1.B = T2.B AND T1.A = '21' AND T2.A = '21'");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT T1.* FROM TAB_1 T1, TAB_2 T2 WHERE T1.B = T2.B AND T1.A = '21' AND T2.A = '21'");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("SELECT COUNT(*) FROM VIEW_1 V1 JOIN TAB_2 T2 ON (V1.B = T2.B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSelectColumnOnView() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_view1_A","select_view2_A").addRolesToGroup(USERGROUP2,"select_view1_A","select_view1_B","select_view2_A","select_view2_B").addPermissionsToRole("select_view1_A","server=server1->db=DB_1->table=VIEW_1->column=A->action=select").addPermissionsToRole("select_view1_B","server=server1->db=DB_1->table=VIEW_1->column=B->action=select").addPermissionsToRole("select_view2_A","server=server1->db=DB_1->table=VIEW_2->column=A->action=select").addPermissionsToRole("select_view2_B","server=server1->db=DB_1->table=VIEW_2->column=B->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  try {
    statement.execute("SELECT COUNT(B) FROM TAB_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(A) FROM TAB_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(A) FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(B) FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  try {
    statement.execute("SELECT COUNT(A) FROM TAB_1");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(B) FROM TAB_1");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(*) FROM TAB_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT * FROM TAB_1");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(A) FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT COUNT(B) FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("CREATE VIEW VIEW_2(A) AS SELECT A FROM TAB_1");
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtDatabaseScope </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilegeOnObjectOwnedByAdmin() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  File externalTblDir=new File(dataDir,"exttab");
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE PART_TAB_1(A STRING) partitioned by (B INT) STORED AS TEXTFILE");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=1)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=2)");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data","exttab").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("exttab","server=server1->uri=file://" + dataDir.getPath()).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_2");
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1500);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("DROP TABLE TAB_3");
  assertTrue("Unable to create directory for external table test",externalTblDir.mkdir());
  statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
  context.assertSentrySemanticException(statement,"ALTER TABLE TAB_2 SET LOCATION 'file:///tab2'",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilege() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("CREATE TABLE " + DB1 + ".TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_1");
  statement.execute("CREATE TABLE " + DB1 + ".TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_2");
  statement.execute("USE " + DB1);
  statement.execute("create table table2 as select A, count(A) from TAB_1 GROUP BY A");
  statement.execute("USE " + DB1);
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1000);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("CREATE TABLE TAB_4 AS SELECT * FROM TAB_2");
  statement.execute("ALTER TABLE TAB_3 ADD COLUMNS (B INT)");
  statement.execute("DROP TABLE TAB_3");
  try {
    statement.execute("DROP DATABASE " + DB2 + " CASCADE");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("USE " + DB2);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.execute("DROP DATABASE " + DB1 + " CASCADE");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtFunctionScope </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * admin should be able to create/drop temp functions
 * user with db level access should be able to create/drop temp functions
 * user with table level access should be able to create/drop temp functions
 * user with no privilege should NOT be able to create/drop temp functions
 */
@Test public void testFuncPrivileges1() throws Exception {
  String tableName1="tb_1";
  String udfClassName="org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf";
  CodeSource udfSrc=Class.forName(udfClassName).getProtectionDomain().getCodeSource();
  String udfLocation=System.getProperty(EXTERNAL_HIVE_LIB);
  if (udfLocation == null) {
    udfLocation=udfSrc.getLocation().getPath();
  }
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ "."+ tableName1);
  statement.execute("DROP TEMPORARY FUNCTION IF EXISTS printf_test");
  statement.execute("DROP TEMPORARY FUNCTION IF EXISTS printf_test_2");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all","UDF_JAR","data_read").addRolesToGroup(USERGROUP2,"db1_tab1","UDF_JAR").addRolesToGroup(USERGROUP3,"db1_tab1").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("db1_tab1","server=server1->db=" + DB1 + "->table="+ tableName1).addPermissionsToRole("UDF_JAR","server=server1->uri=file://" + udfLocation).addPermissionsToRole("data_read","server=server1->URI=" + "file:///tmp");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  try {
    statement.execute("CREATE TEMPORARY FUNCTION printf_test AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    LOGGER.info("Testing select from temp func printf_test");
    ResultSet res=statement.executeQuery("SELECT printf_test('%d', under_col) FROM " + tableName1);
    while (res.next()) {
      LOGGER.info(res.getString(1));
    }
    res.close();
    statement.execute("DROP TEMPORARY FUNCTION printf_test");
  }
 catch (  Exception ex) {
    LOGGER.error("test temp func printf_test failed with reason: " + ex.getStackTrace() + " "+ ex.getMessage());
    fail("fail to test temp func printf_test");
  }
  statement.execute("CREATE FUNCTION printf_test_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf' ");
  statement.execute("SELECT printf_test_perm(value) FROM " + tableName1);
  statement.execute("DROP FUNCTION printf_test_perm");
  statement.execute("CREATE FUNCTION printf_test_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf' " + " using file 'file:///tmp'");
  statement.execute("DROP FUNCTION printf_test_perm");
  context.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TEMPORARY FUNCTION printf_test_2 AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  statement.execute("SELECT printf_test_2(value) FROM " + tableName1);
  statement.execute("DROP TEMPORARY FUNCTION printf_test_2");
  statement.execute("CREATE FUNCTION " + DB1 + ".printf_test_2_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  statement.execute("SELECT printf_test_2_perm(value) FROM " + tableName1);
  statement.execute("DROP FUNCTION printf_test_2_perm");
  try {
    statement.execute("CREATE FUNCTION " + DB1 + ".printf_test_2_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'"+ " using file '"+ "file://"+ dataFile.getPath()+ "'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  try {
    statement.execute("CREATE TEMPORARY FUNCTION printf_test_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("CREATE FUNCTION printf_test_perm_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
  connection=context.createConnection(USER4_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("USE default");
    statement.execute("CREATE TEMPORARY FUNCTION printf_test_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user4",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtTableScope </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTableViewJoin2() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab2").addPermissionsToRole("select_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=select").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.executeQuery("SELECT A FROM " + TBL2);
  try {
    statement.executeQuery("SELECT VIEW_1.B FROM VIEW_1 JOIN " + TBL2 + " ON (VIEW_1.B = "+ TBL2+ ".B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("SELECT " + TBL1 + ".B FROM "+ TBL1+ " JOIN "+ TBL2+ " ON ("+ TBL1+ ".B = "+ TBL2+ ".B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTableViewJoin4() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","select_view1").addPermissionsToRole("select_view1","server=server1->db=DB_1->table=VIEW_1->action=select").addPermissionsToRole("select_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.executeQuery("SELECT VIEW_1.B FROM VIEW_1 JOIN " + TBL1 + " ON (VIEW_1.B = "+ TBL1+ ".B)");
  try {
    statement.executeQuery("SELECT " + TBL1 + ".B FROM "+ TBL1+ " JOIN "+ TBL2+ " ON ("+ TBL1+ ".B = "+ TBL2+ ".B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-5 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInsert() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"insert_tab1","select_tab2").addPermissionsToRole("insert_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=insert").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("INSERT INTO TABLE " + TBL1 + " SELECT A, B FROM "+ TBL2);
  try {
    statement.executeQuery("SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("SELECT A FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  ResultSet resultSet=statement.executeQuery("SHOW TABLES");
  while (resultSet.next()) {
    String tableName=resultSet.getString(1);
    assertNotNull("table name is null in result set",tableName);
    assertFalse("Found VIEW_1 in the result set","VIEW_1".equalsIgnoreCase(tableName));
  }
  try {
    statement.executeQuery("CREATE VIEW VIEW_2(A) AS SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInsertAndSelect() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab1","select_tab2").addPermissionsToRole("select_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=select").addPermissionsToRole("insert_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=insert").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  statement.execute("INSERT INTO TABLE " + TBL1 + " SELECT A, B FROM "+ TBL2);
  statement.executeQuery("SELECT A FROM " + TBL2);
  try {
    statement.execute("DROP TABLE " + TBL1);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  statement.execute("DROP TABLE " + TBL1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  try {
    statement.execute("CREATE TABLE " + TBL1 + "(A STRING)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  statement.execute("CREATE TABLE " + TBL1 + "(B INT, A STRING) "+ " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("INSERT INTO TABLE " + TBL1 + " SELECT A, B FROM "+ TBL2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTableViewJoin() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","select_tab2").addPermissionsToRole("select_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=select").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.executeQuery("SELECT T1.B FROM " + TBL1 + " T1 JOIN "+ TBL2+ " T2 ON (T1.B = T2.B)");
  try {
    statement.executeQuery("SELECT V1.B FROM VIEW_1 V1 JOIN " + TBL2 + " T2 ON (V1.B = T2.B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSelect() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","select_tab2").addPermissionsToRole("select_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=select").addPermissionsToRole("insert_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=insert").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.executeQuery("SELECT A FROM " + TBL1);
  try {
    statement.executeQuery("INSERT INTO TABLE " + TBL1 + " SELECT A, B FROM "+ TBL2);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("SELECT A FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("CREATE VIEW VIEW_2(A) AS SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTableViewJoin3() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab2","select_view1").addPermissionsToRole("select_view1","server=server1->db=DB_1->table=VIEW_1->action=select").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.executeQuery("SELECT A FROM " + TBL2);
  statement.executeQuery("SELECT V1.B FROM VIEW_1 V1 JOIN " + TBL2 + " T2 ON (V1.B = T2.B)");
  statement.executeQuery("SELECT A FROM VIEW_1");
  try {
    statement.executeQuery("SELECT T1.B FROM " + TBL1 + " T1 JOIN "+ TBL2+ " T2 ON (T1.B = T2.B)");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestSentryOnFailureHookLoading </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnFailureHookLoading() throws Exception {
  String hiveServer2Type=System.getProperty(HiveServerFactory.HIVESERVER2_TYPE);
  if (hiveServer2Type != null && !HiveServerFactory.isInternalServer(HiveServerFactory.HiveServer2Type.valueOf(hiveServer2Type.trim()))) {
    return;
  }
  context=createContext(testProperties);
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addPermissionsToRole("all_db1","server=server1->db=DB_1").setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("CREATE DATABASE DB_1");
  statement.execute("CREATE DATABASE DB_2");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  assertFalse(DummySentryOnFailureHook.invoked);
  try {
    statement.execute("DROP DATABASE DB_2 CASCADE");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    assertTrue(DummySentryOnFailureHook.invoked);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP DATABASE DB_1 CASCADE");
  statement.execute("DROP DATABASE DB_2 CASCADE");
  statement.close();
  connection.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestServerConfiguration </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test removal of policy file
 */
@Test public void testRemovalOfPolicyFile() throws Exception {
  context=createContext(properties);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  try {
    statement.execute("DROP TABLE IF EXISTS test CASCADE");
    statement.execute("create table test (a string)");
    Assert.fail("Expected SQLException");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test corruption of policy file
 */
@Test public void testCorruptionOfPolicyFile() throws Exception {
  context=createContext(properties);
  File policyFile=context.getPolicyFile();
  FileOutputStream out=new FileOutputStream(policyFile);
  out.write("this is not valid".getBytes(Charsets.UTF_8));
  out.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  try {
    statement.execute("DROP TABLE IF EXISTS test CASCADE");
    statement.execute("create table test (a string)");
    Assert.fail("Expected SQLException");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUserManagement </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that users without group information will cause the configuration exception
 */
@Test public void testGroup9() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP);
  writePolicyFile(policyFile);
  Connection connection=context.createConnection("admin1");
  Statement statement=connection.createStatement();
  statement.execute("DROP DATABASE IF EXISTS db1 CASCADE");
  statement.execute("CREATE DATABASE db1");
  statement.execute("USE db1");
  statement.execute("CREATE TABLE t1 (under_col int)");
  statement.close();
  connection.close();
  connection=context.createConnection("user1");
  statement=context.createStatement(connection);
  try {
    statement.execute("CREATE TABLE db1.t1 (under_col int, value string)");
    fail("User without group configuration, SentryGroupNotFoundException should be thrown ");
  }
 catch (  HiveSQLException hse) {
    assertTrue(hse.getMessage().indexOf("SentryGroupNotFoundException") >= 0);
  }
  try {
    statement.execute("SELECT under_col from db1.t1");
    fail("User without group configuration, SentryGroupNotFoundException should be thrown ");
  }
 catch (  HiveSQLException hse) {
    assertTrue(hse.getMessage().indexOf("SentryGroupNotFoundException") >= 0);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestViewPrivileges </h4><pre class="type-17 type-12 type-5 type-7 type-14 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartitioned() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  String viewName="view1";
  String db="db1";
  String tabName="tab1";
  policyFile.addPermissionsToRole("view","server=server1->db=" + db + "->table="+ viewName).addRolesToGroup(USERGROUP1,"view").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection conn=context.createConnection(ADMIN1);
  Statement stmt=context.createStatement(conn);
  stmt.execute("DROP DATABASE IF EXISTS " + db + " CASCADE");
  stmt.execute("CREATE DATABASE " + db);
  stmt.execute("use " + db);
  stmt.execute("create table " + tabName + " (id int) partitioned by (part string)");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"a\")");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"b\")");
  ResultSet res=stmt.executeQuery("select count(*) from " + tabName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    Assume.assumeTrue(res.getInt(1) == new Integer(1000));
  }
  stmt.execute("create view " + viewName + " as select * from "+ tabName+ " where id<100");
  res=stmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  int rowsInView=0;
  while (res.next()) {
    rowsInView=res.getInt(1);
  }
  stmt.close();
  conn.close();
  Connection userConn=context.createConnection(USER1_1);
  Statement userStmt=context.createStatement(userConn);
  userStmt.execute("use " + db);
  res=userStmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    org.junit.Assert.assertThat(res.getInt(1),is(rowsInView));
  }
  userStmt.close();
  userConn.close();
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  try {
    userStmt.executeQuery("select count(*) from " + viewName);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
  }
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestAuthorizingObjectStore </h4><pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER3_1 is USERGROUP3, and has no access to database and
 * table.
 * @throws Exception
 */
@Test public void testPrivilegesForNoAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER3_1);
  try {
    client.getDatabase(dbName1);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getDatabase(dbName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getAllDatabases().size(),equalTo(1));
  assertThat(client.getDatabases("*").size(),equalTo(1));
  try {
    client.getTable(dbName1,tabName1);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName1,tabName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName3);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName4);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(0));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(0));
  assertThat(client.getAllTables(dbName1).size(),equalTo(0));
  assertThat(client.getAllTables(dbName2).size(),equalTo(0));
  try {
    client.listPartitionNames(dbName1,tabName1,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName2,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  TException noe) {
  }
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName1,tabName1,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * User accessAllMetaUser is configured as the value of
 * "sentry.metastore.service.users" and has all access to databases and
 * tables.
 * @throws Exception
 */
@Test public void testPrivilegesForUserWithoutAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(userWithoutAccess);
  assertThat(client.getDatabase(dbName1),notNullValue());
  assertThat(client.getDatabase(dbName2),notNullValue());
  assertThat(client.getAllDatabases().size(),equalTo(3));
  assertThat(client.getDatabases("*").size(),equalTo(3));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  assertThat(client.getTable(dbName1,tabName2),notNullValue());
  assertThat(client.getTable(dbName2,tabName3),notNullValue());
  assertThat(client.getTable(dbName2,tabName4),notNullValue());
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(2));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(2));
  assertThat(client.getAllTables(dbName1).size(),equalTo(2));
  assertThat(client.getAllTables(dbName2).size(),equalTo(2));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER2_1 is USERGROUP2, and has the access to db1 and t1.
 * @throws Exception
 */
@Test public void testPrivilegesForPartialAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER2_1);
  assertThat(client.getDatabase(dbName1),notNullValue());
  try {
    client.getDatabase(dbName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getAllDatabases().size(),equalTo(2));
  assertThat(client.getDatabases("*").size(),equalTo(2));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  try {
    client.getTable(dbName1,tabName2);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName3);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getTable(dbName2,tabName4);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  try {
    client.listPartitions(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  try {
    client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  try {
    client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)));
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(1));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(0));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(1));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(0));
  assertThat(client.getAllTables(dbName1).size(),equalTo(1));
  assertThat(client.getAllTables(dbName2).size(),equalTo(0));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  try {
    client.listPartitionNames(dbName1,tabName2,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  TException te) {
  }
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  try {
    client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2);
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList("")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  try {
    client.listIndexes(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexes(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  try {
    client.listIndexNames(dbName1,tabName2,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName3,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.listIndexNames(dbName2,tabName4,(short)1);
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  try {
    client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup")));
    fail("MetaException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  try {
    client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  try {
    client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1)));
    fail("MetaException should have been thrown");
  }
 catch (  MetaException noe) {
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * The configuration "sentry.metastore.service.users" is for user who has all
 * access to metadata, and the value should be case-sensitive.
 * @throws Exception
 */
@Test public void testPrivilegesForUserNameCaseSensitive() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(userWithoutAccess.toUpperCase());
  try {
    client.getDatabase(dbName1);
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The group of USER1_1 is USERGROUP1, and has all access to databases and
 * tables.
 * @throws Exception
 */
@Test public void testPrivilegesForFullAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  assertThat(client.getDatabase(dbName1),notNullValue());
  assertThat(client.getDatabase(dbName2),notNullValue());
  assertThat(client.getAllDatabases().size(),equalTo(3));
  assertThat(client.getDatabases("*").size(),equalTo(3));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  assertThat(client.getTable(dbName1,tabName2),notNullValue());
  assertThat(client.getTable(dbName2,tabName3),notNullValue());
  assertThat(client.getTable(dbName2,tabName4),notNullValue());
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(2));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(2));
  assertThat(client.getAllTables(dbName1).size(),equalTo(2));
  assertThat(client.getAllTables(dbName2).size(),equalTo(2));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestMetastoreEndToEnd </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * verify non-admin user can not create or drop DB
 * @throws Exception
 */
@Test public void testNegativeServerPrivileges() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  try {
    createMetastoreDB(client,"fooDb");
    fail("Creat db should have failed for non-admin user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  try {
    createMetastoreDB(client,"barDb");
    fail("create db should have failed for non-admin user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Verify URI privileges for alter table table
 * @throws Exception
 */
@Test public void testUriTablePrivileges() throws Exception {
  String newPath1="fooTab1";
  String newPath2="fooTab2";
  String tabDir1=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + File.separator + newPath1;
  String tabDir2=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + File.separator + newPath2;
  policyFile.addRolesToGroup(USERGROUP1,uri_role).addRolesToGroup(USERGROUP2,uri_role).addRolesToGroup(USERGROUP3,db_all_role).addPermissionsToRole(uri_role,"server=server1->URI=" + tabDir1).addPermissionsToRole(uri_role,"server=server1->URI=" + tabDir2);
  writePolicyFile(policyFile);
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  createMetastoreTableWithLocation(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")),tabDir1);
  createMetastoreTableWithLocation(client,dbName,tabName2,Lists.newArrayList(new FieldSchema("col1","int","")),tabDir2);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  try {
    createMetastoreTableWithLocation(client,dbName,"fooTab",Lists.newArrayList(new FieldSchema("col1","int","")),tabDir2);
    fail("Create table with location should fail without URI privilege");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  Table metaTable1=client.getTable(dbName,tabName1);
  metaTable1.getSd().setLocation(tabDir2);
  client.alter_table(dbName,tabName1,metaTable1);
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  metaTable1=client.getTable(dbName,tabName2);
  metaTable1.getSd().setLocation(tabDir1);
  client.alter_table(dbName,tabName2,metaTable1);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  Table metaTable2=client.getTable(dbName,tabName2);
  metaTable2.getSd().setLocation(tabDir2);
  try {
    client.alter_table(dbName,tabName2,metaTable2);
    fail("Alter table with location should fail without URI privilege");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Verify alter partion privileges
 * TODO: We seem to have a bit inconsistency with Alter partition. It's only
 * allowed with SERVER privilege. If we allow add/drop partition with DB
 * level privilege, then this should also be at the same level.
 * @throws Exception
 */
@Test public void testAlterSetLocationPrivileges() throws Exception {
  String newPath1="fooTab1";
  ArrayList<String> partVals1=Lists.newArrayList("part1");
  ArrayList<String> partVals2=Lists.newArrayList("part2");
  String tabDir1=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + File.separator + newPath1;
  policyFile.addRolesToGroup(USERGROUP1,uri_role).addRolesToGroup(USERGROUP2,uri_role).addPermissionsToRole(uri_role,"server=server1->URI=" + tabDir1);
  writePolicyFile(policyFile);
  HiveMetaStoreClient client=context.getMetaStoreClient(ADMIN1);
  Table tbl1=createMetastoreTableWithPartition(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")),Lists.newArrayList(new FieldSchema("part_col1","string","")));
  addPartition(client,dbName,tabName1,partVals1,tbl1);
  tbl1=client.getTable(dbName,tabName1);
  addPartition(client,dbName,tabName1,partVals2,tbl1);
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  Partition newPartition=client.getPartition(dbName,tabName1,partVals1);
  newPartition.getSd().setLocation(tabDir1);
  client.alter_partition(dbName,tabName1,newPartition);
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  newPartition=client.getPartition(dbName,tabName1,partVals2);
  newPartition.getSd().setLocation(tabDir1);
  client.alter_partition(dbName,tabName1,newPartition);
  client.close();
  policyFile.addRolesToGroup(USERGROUP3,db_all_role);
  writePolicyFile(policyFile);
  client=context.getMetaStoreClient(USER3_1);
  newPartition=client.getPartition(dbName,tabName1,partVals2);
  newPartition.getSd().setLocation(tabDir1);
  try {
    client.alter_partition(dbName,tabName1,newPartition);
    fail("alter partition with location should have failed");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify alter table privileges
 * @throws Exception
 */
@Test public void testAlterTablePrivileges() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(ADMIN1);
  createMetastoreTable(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")));
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  Table metaTable2=client.getTable(dbName,tabName1);
  metaTable2.getSd().setCols(Lists.newArrayList(new FieldSchema("col2","double","")));
  client.alter_table(dbName,tabName1,metaTable2);
  Table metaTable3=client.getTable(dbName,tabName1);
  assertEquals(metaTable2.getSd().getCols(),metaTable3.getSd().getCols());
  client=context.getMetaStoreClient(USER2_1);
  metaTable2=client.getTable(dbName,tabName1);
  metaTable2.getSd().setCols(Lists.newArrayList(new FieldSchema("col3","string","")));
  client.alter_table(dbName,tabName1,metaTable2);
  metaTable3=client.getTable(dbName,tabName1);
  assertEquals(metaTable2.getSd().getCols(),metaTable3.getSd().getCols());
  client=context.getMetaStoreClient(USER3_1);
  metaTable2=client.getTable(dbName,tabName1);
  metaTable2.getSd().setCols(Lists.newArrayList(new FieldSchema("col3","string","")));
  try {
    client.alter_table(dbName,tabName1,metaTable2);
    fail("alter table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify add partition privileges
 * @throws Exception
 */
@Test public void testAddPartitionPrivileges() throws Exception {
  ArrayList<String> partVals1=Lists.newArrayList("part1");
  ArrayList<String> partVals2=Lists.newArrayList("part2");
  ArrayList<String> partVals3=Lists.newArrayList("part3");
  ArrayList<String> partVals4=Lists.newArrayList("part4");
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  Table tbl1=createMetastoreTableWithPartition(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")),Lists.newArrayList(new FieldSchema("part_col1","string","")));
  assertEquals(1,client.getTables(dbName,tabName1).size());
  addPartition(client,dbName,tabName1,partVals1,tbl1);
  addPartition(client,dbName,tabName1,partVals2,tbl1);
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  tbl1=client.getTable(dbName,tabName1);
  addPartition(client,dbName,tabName1,partVals3,tbl1);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  tbl1=client.getTable(dbName,tabName1);
  try {
    addPartition(client,dbName,tabName1,partVals4,tbl1);
    fail("Add partition should have failed for non-admin user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  tbl1=client.getTable(dbName,tabName1);
  client.dropPartition(dbName,tabName1,partVals1,true);
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  tbl1=client.getTable(dbName,tabName1);
  client.dropPartition(dbName,tabName1,partVals2,true);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  try {
    addPartition(client,dbName,tabName1,partVals3,tbl1);
    fail("Drop partition should have failed for non-admin user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Verify URI privileges for alter table table
 * @throws Exception
 */
@Test public void testUriPartitionPrivileges() throws Exception {
  String tabName1="tab1";
  String newPath1="fooTab1";
  String newPath2="fooTab2";
  ArrayList<String> partVals1=Lists.newArrayList("part1");
  ArrayList<String> partVals2=Lists.newArrayList("part2");
  ArrayList<String> partVals3=Lists.newArrayList("part2");
  String tabDir1=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + File.separator + newPath1;
  String tabDir2=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + File.separator + newPath2;
  policyFile.addRolesToGroup(USERGROUP1,uri_role).addRolesToGroup(USERGROUP2,db_all_role).addPermissionsToRole(uri_role,"server=server1->URI=" + tabDir1).addPermissionsToRole(uri_role,"server=server1->URI=" + tabDir2);
  writePolicyFile(policyFile);
  HiveMetaStoreClient client=context.getMetaStoreClient(USER1_1);
  Table tbl1=createMetastoreTableWithPartition(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")),Lists.newArrayList(new FieldSchema("part_col1","string","")));
  addPartition(client,dbName,tabName1,partVals1,tbl1);
  addPartitionWithLocation(client,dbName,tabName1,partVals2,tbl1,tabDir1);
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  try {
    tbl1=client.getTable(dbName,tabName1);
    addPartitionWithLocation(client,dbName,tabName1,partVals3,tbl1,tabDir2);
    fail("Add partition with location should have failed");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAddPartion() throws Exception {
  String partVal1="part1", partVal2="part2", partVal3="part5";
  String newPath1="fooTab1";
  String tabDir1=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + File.separator + newPath1;
  policyFile.addRolesToGroup(USERGROUP1,uri_role).addPermissionsToRole(uri_role,"server=server1->URI=" + tabDir1);
  writePolicyFile(policyFile);
  execHiveSQL("DROP TABLE IF EXISTS " + dbName + "."+ tabName1,USER1_1);
  execHiveSQL("CREATE TABLE " + dbName + "."+ tabName1+ " (id int) PARTITIONED BY (part_col string)",USER1_1);
  execHiveSQL("ALTER TABLE " + dbName + "."+ tabName1+ " ADD PARTITION (part_col ='"+ partVal1+ "')",USER1_1);
  verifyPartitionExists(dbName,tabName1,partVal1);
  execHiveSQL("ALTER TABLE " + dbName + "."+ tabName1+ " ADD PARTITION (part_col ='"+ partVal2+ "') location '"+ tabDir1+ "'",USER1_1);
  verifyPartitionExists(dbName,tabName1,partVal2);
  try {
    execHiveSQL("ALTER TABLE " + dbName + "."+ tabName1+ " ADD PARTITION (part_col ='"+ partVal2+ "') location '"+ tabDir1+ "'",USER2_1);
    fail("alter table should have failed due to missing URI privilege");
  }
 catch (  IOException e) {
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the user with DB permission can create table in that db Verify the
 * user can't create table in DB where he doesn't have ALL permissions
 * @throws Exception
 */
@Test public void testTablePrivileges() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(ADMIN1);
  createMetastoreTable(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")));
  client.close();
  client=context.getMetaStoreClient(USER1_1);
  createMetastoreTable(client,dbName,tabName2,Lists.newArrayList(new FieldSchema("col1","int","")));
  assertEquals(1,client.getTables(dbName,tabName2).size());
  client.dropTable(dbName,tabName1);
  createMetastoreTable(client,dbName,tabName1,Lists.newArrayList(new FieldSchema("col1","int","")));
  client.close();
  client=context.getMetaStoreClient(USER2_1);
  try {
    createMetastoreTable(client,dbName,"barTab",Lists.newArrayList(new FieldSchema("col1","int","")));
    fail("Create table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.dropTable(dbName,tabName2);
  client.close();
  client=context.getMetaStoreClient(USER3_1);
  try {
    createMetastoreTable(client,dbName,"barTab",Lists.newArrayList(new FieldSchema("col1","int","")));
    fail("Create table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  try {
    client.dropTable(dbName,tabName1);
    fail("drop table should have failed for non-privilege user");
  }
 catch (  MetaException e) {
    Context.verifyMetastoreAuthException(e);
  }
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestGrantPrivilege </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportGrantPrivilegeToUser() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrincipal user1=new MPrincipal("not_support_grant_user_1",MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  try {
    client.grantPrivilege(Lists.newArrayList(user1),Lists.newArrayList(readPriv));
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.GRANT_REVOKE_PRIVILEGE_NOT_SUPPORT_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportGrantPrivilegeToGroup() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrincipal group1=new MPrincipal("not_support_grant_group_1",MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  try {
    client.grantPrivilege(Lists.newArrayList(group1),Lists.newArrayList(readPriv));
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.GRANT_REVOKE_PRIVILEGE_NOT_SUPPORT_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestJobEndToEnd </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateDeleteJob() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  rdbmsLink.setName("rdbm_testUpdateJob");
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  hdfsLink.setName("hdfs_testUpdateJob");
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job2=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job2);
  sqoopServerRunner.fillRdbmsToConfig(job2);
  sqoopServerRunner.saveJob(client,job2);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource job2Resource=new MResource(String.valueOf(job2.getPersistenceId()),MResource.TYPE.JOB);
  MPrivilege writeJob2Privilege=new MPrivilege(job2Resource,SqoopActionConstant.WRITE,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readLinkPriv=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  client.createRole(role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeJob2Privilege,readConnectorPriv,readLinkPriv));
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    assertTrue(client.getJobs().size() == 0);
    client.getJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    job2.setName("job2_update_user4_1");
    client.updateJob(job2);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getJobs().size() == 0);
    job2.setName("job2_update_user3_1");
    client.updateJob(job2);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.deleteJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.deleteJob(job2.getPersistenceId());
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.dropRole(role4);
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowJob() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allJob=new MResource(SqoopActionConstant.ALL,MResource.TYPE.JOB);
  MPrivilege readAllPrivilege=new MPrivilege(allJob,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readAllPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MResource job1Resource=new MResource(String.valueOf(job1.getPersistenceId()),MResource.TYPE.JOB);
  MPrivilege readJob1Privilege=new MPrivilege(job1Resource,SqoopActionConstant.READ,false);
  client.createRole(role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readJob1Privilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getJobs().size() == 1);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    assertTrue(client.getJobs().size() == 1);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getJobs().size() == 0);
    client.getJob(job1.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.deleteJob(job1.getPersistenceId());
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testEnableAndStartJob() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  rdbmsLink.setName("rdbm_testEnableAndStartJob");
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  hdfsLink.setName("hdfs_testEnableAndStartJob");
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job2=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job2);
  sqoopServerRunner.fillRdbmsToConfig(job2);
  sqoopServerRunner.saveJob(client,job2);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource job2Resource=new MResource(String.valueOf(job2.getPersistenceId()),MResource.TYPE.JOB);
  MPrivilege writeJob2Privilege=new MPrivilege(job2Resource,SqoopActionConstant.WRITE,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readLinkPriv=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  client.createRole(role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeJob2Privilege,readConnectorPriv,readLinkPriv));
  MRole role5=new MRole(ROLE5);
  MPrincipal group5=new MPrincipal(GROUP5,MPrincipal.TYPE.GROUP);
  MPrivilege readJob2Privilege=new MPrivilege(job2Resource,SqoopActionConstant.READ,false);
  client.createRole(role5);
  client.grantRole(Lists.newArrayList(role5),Lists.newArrayList(group5));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role5.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readJob2Privilege,readConnectorPriv,readLinkPriv));
  client=sqoopServerRunner.getSqoopClient(USER5);
  try {
    client.enableJob(job2.getPersistenceId(),true);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.startJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    client.enableJob(job2.getPersistenceId(),true);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.startJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.enableJob(job2.getPersistenceId(),false);
    client.enableJob(job2.getPersistenceId(),true);
    client.deleteJob(job2.getPersistenceId());
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.dropRole(role4);
  client.dropRole(role5);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestLinkEndToEnd </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateDtestUpdateDeleteLinkeleteLink() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource hdfsLinkResource=new MResource(String.valueOf(hdfsLink.getPersistenceId()),MResource.TYPE.LINK);
  MPrivilege writeHdfsPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.WRITE,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeHdfsPrivilege,readConnectorPriv));
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    assertTrue(client.getLinks().size() == 0);
    client.getLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    hdfsLink.setName("hdfs_link_update_user4_1");
    client.updateLink(hdfsLink);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getLinks().size() == 0);
    hdfsLink.setName("hdfs_link_update_user3_1");
    client.updateLink(hdfsLink);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.deleteLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.deleteLink(hdfsLink.getPersistenceId());
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.dropRole(role4);
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testEnableLink() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource hdfsLinkResource=new MResource(String.valueOf(hdfsLink.getPersistenceId()),MResource.TYPE.LINK);
  MPrivilege readHdfsPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.READ,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readHdfsPrivilege,readConnectorPriv));
  MRole role5=new MRole(ROLE5);
  MPrincipal group5=new MPrincipal(GROUP5,MPrincipal.TYPE.GROUP);
  MPrivilege writeHdfsPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.WRITE,false);
  dropAndCreateRole(client,role5);
  client.grantRole(Lists.newArrayList(role5),Lists.newArrayList(group5));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role5.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeHdfsPrivilege,readConnectorPriv));
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.enableLink(hdfsLink.getPersistenceId(),true);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER5);
  try {
    client.enableLink(hdfsLink.getPersistenceId(),true);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    client.enableLink(hdfsLink.getPersistenceId(),true);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  try {
    client.dropRole(role4);
    client.dropRole(role5);
  }
 catch (  Exception e) {
  }
  client.deleteLink(hdfsLink.getPersistenceId());
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowLink() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readAllPrivilege=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readAllPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MResource hdfsLinkResource=new MResource(String.valueOf(hdfsLink.getPersistenceId()),MResource.TYPE.LINK);
  MPrivilege readHdfsLinkPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readHdfsLinkPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getLinks().size() == 1);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    assertTrue(client.getLinks().size() == 1);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getLinks().size() == 0);
    client.getLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.deleteLink(hdfsLink.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestOwnerPrivilege </h4><pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJobOwner() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(ROLE3,MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() > 0);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  assertTrue(client.getLinks().size() == 2);
  hdfsLink.setName("HDFS_update2");
  client.updateLink(hdfsLink);
  rdbmsLink.setName("RDBM_update");
  client.updateLink(rdbmsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getJobs().size() == 0);
  try {
    client.deleteJob(job1.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertEquals(client.getJob(job1.getPersistenceId()),job1);
  client.deleteJob(job1.getPersistenceId());
  client.deleteLink(hdfsLink.getPersistenceId());
  client.deleteLink(rdbmsLink.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestRevokePrivilege </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportRevokePrivilegeFromUser() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrincipal user1=new MPrincipal("not_support_revoke_user_1",MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  try {
    client.revokePrivilege(Lists.newArrayList(user1),Lists.newArrayList(readPriv));
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.GRANT_REVOKE_PRIVILEGE_NOT_SUPPORT_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportRevokePrivilegeFromGroup() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrincipal group1=new MPrincipal("not_support_revoke_group_1",MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  try {
    client.revokePrivilege(Lists.newArrayList(group1),Lists.newArrayList(readPriv));
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.GRANT_REVOKE_PRIVILEGE_NOT_SUPPORT_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestRoleOperation </h4><pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotAdminToCreateDeleteRole() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole("not_admin_create_delete_role_1");
  MRole role2=new MRole("not_admin_create_delete_role_2");
  client.createRole(role1);
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    client.createRole(role2);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
  try {
    client.dropRole(role1);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleOnGroup() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  client.createRole(role1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  MRole role2=new MRole(ROLE2);
  client.createRole(role2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertEquals(role1.getName(),client.getRolesByPrincipal(group1).get(0).getName());
  try {
    client.getRolesByPrincipal(group2);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertEquals(role2.getName(),client.getRolesByPrincipal(group2).get(0).getName());
  try {
    client.getRolesByPrincipal(group1);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportAddRoleToUser() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole("add_to_user_role");
  MPrincipal user1=new MPrincipal("add_to_user",MPrincipal.TYPE.USER);
  try {
    client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(user1));
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.GRANT_REVOKE_ROLE_NOT_SUPPORT_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCreateExistedRole() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole("create_exist_role_1");
  client.createRole(role1);
  try {
    client.createRole(role1);
    fail("expected SentryAlreadyExistsException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAlreadyExistsException");
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotAdminShowAllRole() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    client.getRoles();
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportShowRoleonUser() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrincipal user1=new MPrincipal("showRoleOnUser",MPrincipal.TYPE.USER);
  try {
    client.getRolesByPrincipal(user1);
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.SHOW_GRANT_NOT_SUPPORTED_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDropNotExistedRole() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  try {
    client.dropRole(new MRole("drop_noexisted_role_1"));
    fail("expected SentryNoSuchObjectException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryNoSuchObjectException");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestServerScopeEndToEnd </h4><pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServerScopePrivilege() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  MResource sqoopServer1=new MResource(SQOOP_SERVER_NAME,MResource.TYPE.SERVER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrivilege readPrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MPrivilege writePrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.WRITE,false);
  client.createRole(role2);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readAllConPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  MPrivilege readAllLinkPriv=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writePrivilege,readAllConPriv,readAllLinkPriv));
  MRole role3=new MRole(ROLE3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MPrivilege allPrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.ALL_NAME,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role3.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getConnector("generic-jdbc-connector") != null);
    assertTrue(client.getConnector("hdfs-connector") != null);
    assertTrue(client.getConnectors().size() > 0);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
    assertTrue(client.getLink(rdbmsLink.getPersistenceId()) != null);
    assertTrue(client.getLinks().size() == 2);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
    assertTrue(client.getJobs().size() == 1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  try {
    hdfsLink.setName("hdfs1_update_user1");
    client.updateLink(hdfsLink);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    job1.setName("job1_update_user1");
    client.updateJob(job1);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    hdfsLink.setName("hdfs1_update_user2");
    client.updateLink(hdfsLink);
    job1.setName("job1_update_user2");
    client.updateJob(job1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  assertTrue(client.getJobs().size() == 0);
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getConnector("generic-jdbc-connector") != null);
    assertTrue(client.getConnector("hdfs-connector") != null);
    assertTrue(client.getConnectors().size() > 0);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
    assertTrue(client.getLink(rdbmsLink.getPersistenceId()) != null);
    assertTrue(client.getLinks().size() == 2);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
    assertTrue(client.getJobs().size() == 1);
    hdfsLink.setName("hdfs1_update_user3");
    client.updateLink(hdfsLink);
    job1.setName("job1_update_user3");
    client.updateJob(job1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestShowPrivilege </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowPrivileges() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1Princ=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrincipal role1Princ=new MPrincipal(ROLE1,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1Princ));
  client.grantPrivilege(Lists.newArrayList(role1Princ),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getPrivilegesByPrincipal(role1Princ,allConnector).size() == 1);
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    client.getPrivilegesByPrincipal(role1Princ,allConnector);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportShowOnGroup() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrincipal group1=new MPrincipal("not_support_group1",MPrincipal.TYPE.GROUP);
  MResource resource1=new MResource("all",MResource.TYPE.CONNECTOR);
  try {
    client.getPrivilegesByPrincipal(group1,resource1);
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.SHOW_PRIVILEGE_NOT_SUPPORTED_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNotSupportShowOnUser() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrincipal user1=new MPrincipal("not_support_user1",MPrincipal.TYPE.USER);
  MResource resource1=new MResource("all",MResource.TYPE.CONNECTOR);
  try {
    client.getPrivilegesByPrincipal(user1,resource1);
    fail("expected not support exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SentrySqoopError.SHOW_PRIVILEGE_NOT_SUPPORTED_FOR_PRINCIPAL);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.component.QueryDocAuthorizationComponentTest </h4><pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a request from a user coming from an empty group.
 * This request should be rejected because otherwise document-level
 * filtering will be skipped.
 */
@Test public void testEmptyGroup() throws Exception {
  String user="bogusUser";
  try {
    NamedList args=new NamedList();
    args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
    ResponseBuilder builder=runComponent(user,args,null);
    checkParams(null,builder);
    Assert.fail("Expected SolrException");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    assertTrue(ex.getMessage().contains(user + " rejected because user is not associated with any roles"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a request from a user coming from an empty role.
 * This request should be rejected because otherwise document-level
 * filtering will be skipped.
 */
@Test public void testEmptyRole() throws Exception {
  String user="undefinedRoleUser";
  try {
    NamedList args=new NamedList();
    args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
    ResponseBuilder builder=runComponent(user,args,null);
    checkParams(null,builder);
    Assert.fail("Expected SolrException");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    assertTrue(ex.getMessage().contains(user + " rejected because user is not associated with any roles"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.sentry.SentryIndexAuthorizationSingletonTest </h4><pre class="type-12 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoBinding() throws Exception {
  Constructor ctor=SentryIndexAuthorizationSingleton.class.getDeclaredConstructor(String.class);
  ctor.setAccessible(true);
  SentryIndexAuthorizationSingleton nonSingleton=(SentryIndexAuthorizationSingleton)ctor.newInstance("");
  doExpectUnauthorized(nonSingleton,null,null,"binding");
  try {
    nonSingleton.getUserName(null);
    Assert.fail("Expected Solr exception");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
  }
  Collection<String> groups=nonSingleton.getRoles("junit");
  assertEquals(null,groups);
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting the roles from user name
 */
@Test public void testGetRoles() throws Exception {
  Collection<String> emptyCollection=ImmutableSet.<String>of();
  try {
    sentryInstance.getRoles(null);
    Assert.fail("Excepted SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    sentryInstance.getRoles("withoutGroupUser");
    Assert.fail("Excepted SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  Collection<String> roles=sentryInstance.getRoles("undefinedRoleUser");
  assertTrue(CollectionUtils.isEqualCollection(emptyCollection,roles));
  Collection<String> singleRole=ImmutableSet.<String>of("junit_role");
  roles=sentryInstance.getRoles("junit");
  assertTrue(CollectionUtils.isEqualCollection(singleRole,roles));
  Collection<String> multipleRoles=ImmutableSet.<String>of("junit_role","queryOnlyAdmin_role","updateOnlyAdmin_role");
  roles=sentryInstance.getRoles("multiGroupUser");
  assertTrue(CollectionUtils.isEqualCollection(multipleRoles,roles));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting the user name.
 */
@Test public void testUserName() throws Exception {
  SolrQueryRequest request=null;
  try {
    request=new SolrQueryRequestBase(core,new ModifiableSolrParams()){
    }
;
    try {
      sentryInstance.getUserName(request);
      Assert.fail("Expected SolrException");
    }
 catch (    SolrException ex) {
      assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    }
    LocalSolrQueryRequest localRequest=null;
    try {
      localRequest=new LocalSolrQueryRequest(null,new ModifiableSolrParams());
      String superUser=(System.getProperty("solr.authorization.superuser","solr"));
      String localName=sentryInstance.getUserName(localRequest);
      assertEquals(superUser,localName);
    }
  finally {
      if (localRequest != null)       localRequest.close();
    }
    SolrQueryRequest sqr=getRequest();
    prepareCollAndUser(core,sqr,"collection",null,true);
    String nullName=sentryInstance.getUserName(sqr);
    assertEquals(null,nullName);
    String userName="foobar";
    prepareCollAndUser(core,sqr,"collection",userName,true);
    String returnedName=sentryInstance.getUserName(sqr);
    assertEquals(userName,returnedName);
  }
  finally {
    if (request != null)     request.close();
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
