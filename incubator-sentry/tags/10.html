<h3><span class=" glyphicon glyphicon-tag"/>&nbspBooleanVerifier</h3><kbd>Verifies boolean conditions</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.sentry.binding.hive.TestSentryHiveAuthorizationTaskFactory </h4><pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW GRANT ROLE ... ON TABLE ...
 */
@Test public void testShowGrantRoleOnTable() throws Exception {
  DDLWork work=analyze(parse("SHOW GRANT ROLE " + ROLE + " ON TABLE "+ TABLE));
  ShowGrantDesc grantDesc=work.getShowGrantDesc();
  Assert.assertNotNull("Show grant should not be null",grantDesc);
  Assert.assertEquals(PrincipalType.ROLE,grantDesc.getPrincipalDesc().getType());
  Assert.assertEquals(ROLE,grantDesc.getPrincipalDesc().getName());
  Assert.assertTrue("Expected table",grantDesc.getHiveObj().getTable());
  Assert.assertEquals(TABLE,grantDesc.getHiveObj().getObject());
  Assert.assertTrue("Expected table",grantDesc.getHiveObj().getTable());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ... ON TABLE ... TO ROLE ... WITH GRANT OPTION
 */
@Test public void testGrantRoleTableWithGrantOption() throws Exception {
  DDLWork work=analyze(parse("GRANT " + ALL + " ON TABLE "+ TABLE+ " TO ROLE "+ ROLE+ " WITH GRANT OPTION"));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  Assert.assertTrue("Expected table",grantDesc.getPrivilegeSubjectDesc().getTable());
  Assert.assertTrue("Expected grantOption is true",grantDesc.isGrantOption());
  Assert.assertEquals(TABLE,grantDesc.getPrivilegeSubjectDesc().getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * CREATE ROLE ...
 */
@Test public void testCreateRole() throws Exception {
  DDLWork work=analyze(parse("CREATE ROLE " + ROLE));
  RoleDDLDesc roleDesc=work.getRoleDDLDesc();
  Assert.assertNotNull("Role should not be null",roleDesc);
  Assert.assertEquals(RoleOperation.CREATE_ROLE,roleDesc.getOperation());
  Assert.assertFalse("Did not expect a group",roleDesc.getGroup());
  Assert.assertEquals(ROLE,roleDesc.getName());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * REVOKE ... ON TABLE ... FROM ROLE ...
 */
@Test public void testRevokeRoleTable() throws Exception {
  DDLWork work=analyze(parse("REVOKE " + ALL + " ON TABLE "+ TABLE+ " FROM ROLE "+ ROLE));
  RevokeDesc grantDesc=work.getRevokeDesc();
  Assert.assertNotNull("Revoke should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  Assert.assertTrue("Expected table",grantDesc.getPrivilegeSubjectDesc().getTable());
  Assert.assertEquals(TABLE,grantDesc.getPrivilegeSubjectDesc().getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantUri() throws Exception {
  String uriPath="/tmp";
  DDLWork work=analyze(parse("GRANT " + ALL + " ON URI '"+ uriPath+ "' TO ROLE "+ ROLE));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  SentryHivePrivilegeObjectDesc privilegeDesc=(SentryHivePrivilegeObjectDesc)grantDesc.getPrivilegeSubjectDesc();
  Assert.assertTrue("Expected uri",privilegeDesc.getUri());
  Assert.assertEquals(uriPath,privilegeDesc.getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ALL ON SERVER
 */
@Test public void testGrantServer() throws Exception {
  DDLWork work=analyze(parse("GRANT " + ALL + " ON SERVER "+ SERVER+ " TO ROLE "+ ROLE));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  SentryHivePrivilegeObjectDesc privilegeDesc=(SentryHivePrivilegeObjectDesc)grantDesc.getPrivilegeSubjectDesc();
  Assert.assertTrue("Expected server",privilegeDesc.getServer());
  Assert.assertEquals(SERVER,privilegeDesc.getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * DROP ROLE ...
 */
@Test public void testDropRole() throws Exception {
  DDLWork work=analyze(parse("DROP ROLE " + ROLE));
  RoleDDLDesc roleDesc=work.getRoleDDLDesc();
  Assert.assertNotNull("Role should not be null",roleDesc);
  Assert.assertEquals(RoleOperation.DROP_ROLE,roleDesc.getOperation());
  Assert.assertFalse("Did not expect a group",roleDesc.getGroup());
  Assert.assertEquals(ROLE,roleDesc.getName());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ROLE ... TO GROUP ...
 */
@Test public void testGrantRoleGroup() throws Exception {
  DDLWork work=analyze(parse("GRANT ROLE " + ROLE + " TO GROUP "+ GROUP));
  GrantRevokeRoleDDL grantDesc=work.getGrantRevokeRoleDDL();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  Assert.assertTrue("Expected grant ",grantDesc.getGrant());
  Assert.assertFalse("Grant option should be false",grantDesc.isGrantOption());
  Assert.assertEquals(currentUser,grantDesc.getGrantor());
  Assert.assertEquals(PrincipalType.USER,grantDesc.getGrantorType());
  for (  String role : assertSize(1,grantDesc.getRoles())) {
    Assert.assertEquals(ROLE,role);
  }
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipalDesc())) {
    Assert.assertEquals(PrincipalType.GROUP,principal.getType());
    Assert.assertEquals(GROUP,principal.getName());
  }
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * GRANT ... ON TABLE ... TO ROLE ...
 */
@Test public void testGrantRoleTable() throws Exception {
  DDLWork work=analyze(parse("GRANT " + ALL + " ON TABLE "+ TABLE+ " TO ROLE "+ ROLE));
  GrantDesc grantDesc=work.getGrantDesc();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipals())) {
    Assert.assertEquals(PrincipalType.ROLE,principal.getType());
    Assert.assertEquals(ROLE,principal.getName());
  }
  for (  PrivilegeDesc privilege : assertSize(1,grantDesc.getPrivileges())) {
    Assert.assertEquals(Privilege.ALL,privilege.getPrivilege());
  }
  Assert.assertTrue("Expected table",grantDesc.getPrivilegeSubjectDesc().getTable());
  Assert.assertEquals(TABLE,grantDesc.getPrivilegeSubjectDesc().getObject());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * REVOKE ROLE ... FROM GROUP ...
 */
@Test public void testRevokeRoleGroup() throws Exception {
  DDLWork work=analyze(parse("REVOKE ROLE " + ROLE + " FROM GROUP "+ GROUP));
  GrantRevokeRoleDDL grantDesc=work.getGrantRevokeRoleDDL();
  Assert.assertNotNull("Grant should not be null",grantDesc);
  Assert.assertFalse("Did not expect grant ",grantDesc.getGrant());
  Assert.assertFalse("Grant option is always true ",grantDesc.isGrantOption());
  Assert.assertEquals(currentUser,grantDesc.getGrantor());
  Assert.assertEquals(PrincipalType.USER,grantDesc.getGrantorType());
  for (  String role : assertSize(1,grantDesc.getRoles())) {
    Assert.assertEquals(ROLE,role);
  }
  for (  PrincipalDesc principal : assertSize(1,grantDesc.getPrincipalDesc())) {
    Assert.assertEquals(PrincipalType.GROUP,principal.getType());
    Assert.assertEquals(GROUP,principal.getName());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.binding.hive.TestSentryIniPolicyFileFormatter </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImportExport() throws Exception {
  prepareTestData();
  File baseDir=Files.createTempDir();
  String resourcePath=(new File(baseDir,RESOURCE_PATH)).getAbsolutePath();
  HiveAuthzConf authzConf=new HiveAuthzConf(Resources.getResource("sentry-site.xml"));
  SentryIniPolicyFileFormatter iniFormatter=new SentryIniPolicyFileFormatter();
  iniFormatter.write(resourcePath,policyFileMappingData1);
  Map<String,Map<String,Set<String>>> parsedMappingData=iniFormatter.parse(resourcePath,authzConf);
  validateSentryMappingData(parsedMappingData,policyFileMappingData1);
  iniFormatter.write(resourcePath,policyFileMappingData2);
  parsedMappingData=iniFormatter.parse(resourcePath,authzConf);
  validateSentryMappingData(parsedMappingData,policyFileMappingData2);
  iniFormatter.write(resourcePath,policyFileMappingData3);
  parsedMappingData=iniFormatter.parse(resourcePath,authzConf);
  validateSentryMappingData(parsedMappingData,policyFileMappingData3);
  iniFormatter.write(resourcePath,policyFileMappingData4);
  parsedMappingData=iniFormatter.parse(resourcePath,authzConf);
  assertTrue(parsedMappingData.get(PolicyFileConstants.GROUPS).isEmpty());
  assertTrue(parsedMappingData.get(PolicyFileConstants.ROLES).isEmpty());
  iniFormatter.write(resourcePath,policyFileMappingData5);
  parsedMappingData=iniFormatter.parse(resourcePath,authzConf);
  assertTrue(parsedMappingData.get(PolicyFileConstants.GROUPS).isEmpty());
  assertTrue(parsedMappingData.get(PolicyFileConstants.ROLES).isEmpty());
  (new File(baseDir,RESOURCE_PATH)).delete();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.binding.solr.TestSolrAuthzBinding </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomGroupMapping() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER.getVar(),"org.apache.sentry.provider.common.HadoopGroupResourceAuthorizationProvider");
  solrAuthzConf.set("hadoop.security.group.mapping",FoobarGroupMappingServiceProvider.class.getName());
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  final String user="userTestSolrAuthzBinding";
  assertEquals(1,binding.getGroups(user).size());
  assertTrue(binding.getGroups(user).contains("foobar"));
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that incorrect specification of the provider resource
 * throws an exception
 */
@Test public void testResourceNotFound() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER_RESOURCE.getVar(),new File(baseDir,"test-authz-bogus-provider.ini").getPath());
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected InvocationTargetException");
  }
 catch (  InvocationTargetException e) {
    assertTrue(e.getTargetException() instanceof FileNotFoundException);
  }
  solrAuthzConf.unset(AuthzConfVars.AUTHZ_PROVIDER_RESOURCE.getVar());
  try {
    new SolrAuthzBinding(solrAuthzConf);
    Assert.fail("Expected InvocationTargetException");
  }
 catch (  InvocationTargetException e) {
    assertTrue(e.getTargetException() instanceof IllegalArgumentException);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.common.utils.TestPathUtils </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNullScheme() throws Exception {
  assertTrue(PathUtils.impliesURI(new URI("/tmp"),new URI("/tmp/a")));
  assertFalse(PathUtils.impliesURI(new URI("file:/tmp"),new URI("/tmp/a")));
  assertFalse(PathUtils.impliesURI(new URI("/tmp"),new URI("file:/tmp/a")));
  assertFalse(PathUtils.impliesURI(new URI("/tmp"),new URI("/tmpdata")));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.indexer.TestIndexerBitFieldAction </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetActionByName() throws Exception {
  IndexerBitFieldAction writeAction=(IndexerBitFieldAction)actionFactory.getActionByName(IndexerConstants.WRITE);
  IndexerBitFieldAction readAction=(IndexerBitFieldAction)actionFactory.getActionByName(IndexerConstants.READ);
  IndexerBitFieldAction allAction=(IndexerBitFieldAction)actionFactory.getActionByName(IndexerConstants.ALL);
  assertTrue(writeAction.equals(new IndexerBitFieldAction(IndexerAction.WRITE)));
  assertTrue(readAction.equals(new IndexerBitFieldAction(IndexerAction.READ)));
  assertTrue(allAction.equals(new IndexerBitFieldAction(IndexerAction.ALL)));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesAction(){
  IndexerBitFieldAction writeAction=new IndexerBitFieldAction(IndexerAction.WRITE);
  IndexerBitFieldAction readAction=new IndexerBitFieldAction(IndexerAction.READ);
  IndexerBitFieldAction allAction=new IndexerBitFieldAction(IndexerAction.ALL);
  assertTrue(allAction.implies(readAction));
  assertTrue(allAction.implies(writeAction));
  assertTrue(allAction.implies(allAction));
  assertTrue(writeAction.implies(writeAction));
  assertTrue(readAction.implies(readAction));
  assertFalse(readAction.implies(writeAction));
  assertFalse(readAction.implies(allAction));
  assertFalse(writeAction.implies(readAction));
  assertFalse(writeAction.implies(allAction));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.model.sqoop.TestSqoopAction </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesAction(){
  SqoopAction readAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.READ);
  SqoopAction writeAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.WRITE);
  SqoopAction allAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.ALL);
  SqoopAction allNameAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.ALL_NAME);
  assertTrue(allAction.implies(readAction));
  assertTrue(allAction.implies(writeAction));
  assertTrue(allAction.implies(allAction));
  assertTrue(readAction.implies(readAction));
  assertFalse(readAction.implies(writeAction));
  assertFalse(readAction.implies(allAction));
  assertTrue(writeAction.implies(writeAction));
  assertFalse(writeAction.implies(readAction));
  assertFalse(writeAction.implies(allAction));
  assertTrue(allNameAction.implies(readAction));
  assertTrue(allNameAction.implies(writeAction));
  assertTrue(allNameAction.implies(allAction));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetActionByName() throws Exception {
  SqoopAction readAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.READ);
  SqoopAction writeAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.WRITE);
  SqoopAction allAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.ALL);
  SqoopAction allNameAction=(SqoopAction)factory.getActionByName(SqoopActionConstant.ALL_NAME);
  assertTrue(readAction.equals(new SqoopAction(SqoopActionConstant.READ)));
  assertTrue(writeAction.equals(new SqoopAction(SqoopActionConstant.WRITE)));
  assertTrue(allAction.equals(new SqoopAction(SqoopActionConstant.ALL)));
  assertTrue(allNameAction.equals(new SqoopAction(SqoopActionConstant.ALL)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.search.TestSearchBitFieldAction </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesAction(){
  SearchBitFieldAction updateAction=new SearchBitFieldAction(SearchAction.UPDATE);
  SearchBitFieldAction queryAction=new SearchBitFieldAction(SearchAction.QUERY);
  SearchBitFieldAction allAction=new SearchBitFieldAction(SearchAction.ALL);
  assertTrue(allAction.implies(queryAction));
  assertTrue(allAction.implies(updateAction));
  assertTrue(allAction.implies(allAction));
  assertTrue(updateAction.implies(updateAction));
  assertTrue(queryAction.implies(queryAction));
  assertFalse(queryAction.implies(updateAction));
  assertFalse(queryAction.implies(allAction));
  assertFalse(updateAction.implies(queryAction));
  assertFalse(updateAction.implies(allAction));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetActionByName() throws Exception {
  SearchBitFieldAction updateAction=(SearchBitFieldAction)actionFactory.getActionByName(SearchConstants.UPDATE);
  SearchBitFieldAction queryAction=(SearchBitFieldAction)actionFactory.getActionByName(SearchConstants.QUERY);
  SearchBitFieldAction allAction=(SearchBitFieldAction)actionFactory.getActionByName(SearchConstants.ALL);
  assertTrue(updateAction.equals(new SearchBitFieldAction(SearchAction.UPDATE)));
  assertTrue(queryAction.equals(new SearchBitFieldAction(SearchAction.QUERY)));
  assertTrue(allAction.equals(new SearchBitFieldAction(SearchAction.ALL)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestHMSPaths </h4><pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRootEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  root.toString();
  Assert.assertNull(root.getParent());
  Assert.assertEquals(HMSPaths.EntryType.DIR,root.getType());
  Assert.assertTrue(root.getAuthzObjs().size() == 0);
  Assert.assertEquals(Path.SEPARATOR,root.getFullPath());
  Assert.assertTrue(root.getChildren().isEmpty());
  root.delete();
  try {
    root.find(null,true);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(new String[0],true);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(null,false);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.find(new String[0],false);
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  Assert.assertNull(root.find(new String[]{"a"},true));
  Assert.assertNull(root.find(new String[]{"a"},false));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("a")));
  root.delete();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testEntryType(){
  Assert.assertTrue(HMSPaths.EntryType.DIR.isRemoveIfDangling());
  Assert.assertFalse(HMSPaths.EntryType.PREFIX.isRemoveIfDangling());
  Assert.assertFalse(HMSPaths.EntryType.AUTHZ_OBJECT.isRemoveIfDangling());
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFurtherAuthzEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b"+ Path.SEPARATOR+ "t"+ Path.SEPARATOR+ "p1",entry.getFullPath());
  try {
    root.createPrefix(Lists.newArrayList("a","b","p1","t","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  HMSPaths.Entry ep2=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1","p2"),"A");
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,ep2.getType());
  Assert.assertEquals("p2",ep2.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1"},true));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","t","p1","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p1","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2"},true));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2"},false));
  Assert.assertEquals(ep2,root.find(new String[]{"a","b","t","p1","p2","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","t","p1","p2","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1","p2")));
  root.find(new String[]{"a","b","t","p1"},false).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},true));
  Assert.assertEquals(HMSPaths.EntryType.DIR,entry.getType());
  Assert.assertEquals(entry.getAuthzObjs().size(),0);
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b","t"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
  Assert.assertNotNull(root.find(new String[]{"a","b","t","p1","p2"},false));
  root.find(new String[]{"a","b","t","p1","p2"},false).delete();
  Assert.assertNull(root.find(new String[]{"a","b","t","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b","t"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","t","p1")));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testImmediateAuthzEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertEquals("p1",entry.getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().contains("A"));
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b"+ Path.SEPARATOR+ "p1",entry.getFullPath());
  try {
    root.createPrefix(Lists.newArrayList("a","b","p1","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1"},true));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1"},false));
  Assert.assertEquals(entry,root.find(new String[]{"a","b","p1","c"},true));
  Assert.assertNull(root.find(new String[]{"a","b","p1","c"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","p1")));
  root.find(new String[]{"a","b","p1"},true).delete();
  Assert.assertNull(root.find(new String[]{"a","b","p1"},false));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertEquals(prefix,root.findPrefixEntry(Lists.newArrayList("a","b","p1")));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testImmediatePrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry entry=root.createPrefix(Lists.newArrayList("a"));
  entry.toString();
  Assert.assertEquals(1,root.getChildren().size());
  Assert.assertEquals(root,entry.getParent());
  Assert.assertEquals(HMSPaths.EntryType.PREFIX,entry.getType());
  Assert.assertEquals("a",entry.getPathElement());
  Assert.assertEquals(0,entry.getAuthzObjs().size());
  Assert.assertEquals(Path.SEPARATOR + "a",entry.getFullPath());
  Assert.assertTrue(entry.getChildren().isEmpty());
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a","b")));
  Assert.assertNull(root.find(new String[]{"a","b"},false));
  Assert.assertNull(root.find(new String[]{"b"},false));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("b")));
  try {
    root.createPrefix(Lists.newArrayList("a","b"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.createPrefix(Lists.newArrayList("a","b","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  entry.delete();
  Assert.assertTrue(root.getChildren().isEmpty());
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFurtherPrefixEntry(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry entry=root.createPrefix(Lists.newArrayList("a","b"));
  entry.toString();
  Assert.assertEquals(1,root.getChildren().size());
  Assert.assertEquals(root,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.PREFIX,entry.getType());
  Assert.assertEquals(HMSPaths.EntryType.DIR,entry.getParent().getType());
  Assert.assertEquals("b",entry.getPathElement());
  Assert.assertEquals("a",entry.getParent().getPathElement());
  Assert.assertTrue(entry.getAuthzObjs().size() == 0);
  Assert.assertTrue(entry.getParent().getAuthzObjs().size() == 0);
  Assert.assertEquals(Path.SEPARATOR + "a" + Path.SEPARATOR+ "b",entry.getFullPath());
  Assert.assertEquals(Path.SEPARATOR + "a",entry.getParent().getFullPath());
  Assert.assertTrue(entry.getChildren().isEmpty());
  Assert.assertEquals(1,entry.getParent().getChildren().size());
  Assert.assertEquals(entry,root.findPrefixEntry(Lists.newArrayList("a","b")));
  Assert.assertNull(root.findPrefixEntry(Lists.newArrayList("a")));
  Assert.assertNull(root.find(new String[]{"a","b","c"},false));
  try {
    root.createPrefix(Lists.newArrayList("a","b"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    root.createPrefix(Lists.newArrayList("a","b","c"));
    Assert.fail();
  }
 catch (  IllegalArgumentException ex) {
  }
  entry.delete();
  Assert.assertTrue(root.getChildren().isEmpty());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAuthzObjCaseInsensitive(){
  HMSPaths.Entry root=HMSPaths.Entry.createRoot(false);
  HMSPaths.Entry prefix=root.createPrefix(Lists.newArrayList("a","b"));
  HMSPaths.Entry entry=root.createAuthzObjPath(Lists.newArrayList("a","b","t","p1"),"A");
  Assert.assertEquals(prefix,entry.getParent().getParent());
  Assert.assertEquals(HMSPaths.EntryType.AUTHZ_OBJECT,entry.getType());
  Assert.assertTrue(entry.getAuthzObjs().contains("a"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestHMSPathsFullDump </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test ThriftSerializer with a larger message than thrift max message size.
 */
@Test public void testThriftSerializerWithInvalidMsgSize() throws TException, IOException {
  HMSPathsDumper serDe=genHMSPathsDumper();
  TPathsDump pathsDump=serDe.createPathsDump();
  byte[] ser=ThriftSerializer.serialize(pathsDump);
  boolean exceptionThrown=false;
  try {
    ThriftSerializer.maxMessageSize=1024;
    ThriftSerializer.deserialize(new TPathsDump(),ser);
  }
 catch (  IOException e) {
    exceptionThrown=true;
    Assert.assertTrue(e.getCause().getMessage().contains("Length exceeded max allowed:"));
    Assert.assertTrue(e.getMessage().contains("Error deserializing thrift object TPathsDump"));
  }
 finally {
    Assert.assertEquals(true,exceptionThrown);
  }
  ThriftSerializer.maxMessageSize=ServiceConstants.ClientConfig.SENTRY_HDFS_THRIFT_MAX_MESSAGE_SIZE_DEFAULT;
  ThriftSerializer.deserialize(new TPathsDump(),ser);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestMetastoreCacheInitializer </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionInTask() throws Exception {
  Database db1=Mockito.mock(Database.class);
  Mockito.when(db1.getName()).thenReturn("db1");
  Mockito.when(db1.getLocationUri()).thenReturn("hdfs:///db1");
  Table tab1=Mockito.mock(Table.class);
  Mockito.when(tab1.getDbName()).thenReturn("db2");
  Mockito.when(tab1.getTableName()).thenReturn("tab1");
  IHMSHandler hmsHandler=Mockito.mock(IHMSHandler.class);
  Mockito.when(hmsHandler.get_all_databases()).thenReturn(Lists.newArrayList("db1"));
  Mockito.when(hmsHandler.get_database("db1")).thenReturn(db1);
  Mockito.when(hmsHandler.get_table_objects_by_name("db1",Lists.newArrayList("tab1"))).thenReturn(Lists.newArrayList(tab1));
  Mockito.when(hmsHandler.get_all_tables("db1")).thenReturn(Lists.newArrayList("tab1"));
  Configuration conf=new Configuration();
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_MAX_PART_PER_RPC,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_MAX_TABLES_PER_RPC,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_INIT_THREADS,1);
  conf.setInt(ServiceConstants.ServerConfig.SENTRY_HDFS_SYNC_METASTORE_CACHE_RETRY_MAX_NUM,2);
  try {
    MetastoreCacheInitializer cacheInitializer=new MetastoreCacheInitializer(hmsHandler,conf);
    UpdateableAuthzPaths update=cacheInitializer.createInitialUpdate();
    Assert.fail("Expected cacheInitializer to fail");
  }
 catch (  Exception e) {
    Assert.assertTrue(e instanceof RuntimeException);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestPluginCacheSync </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void pluginCacheGC() throws Exception {
  pluginCache=new PluginCacheSyncUtil(TEST_ZPATH,conf,new TestCacheListener());
  for (int updCount=1; updCount <= PluginCacheSyncUtil.CACHE_GC_SIZE_THRESHOLD_HWM + 2; updCount++) {
    DummyUpdate dummyUpdate=new DummyUpdate();
    dummyUpdate.setSeqNum(updCount);
    dummyUpdate.setState("foo");
    pluginCache.handleCacheUpdate(dummyUpdate);
  }
  pluginCache.gcPluginCache(conf);
  HAContext haContext=HAContext.getHAContext(conf);
  List<String> znodeList=haContext.getCuratorFramework().getChildren().forPath(TEST_ZPATH + "/cache");
  assertFalse(znodeList.isEmpty());
  assertFalse(znodeList.contains(String.valueOf(PluginCacheSyncUtil.GC_COUNTER_INIT_VALUE)));
  assertFalse(znodeList.contains(String.valueOf(PluginCacheSyncUtil.GC_COUNTER_INIT_VALUE + 1)));
  assertTrue(znodeList.contains(String.valueOf(PluginCacheSyncUtil.CACHE_GC_SIZE_THRESHOLD_HWM)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestSentryAuthorizationProvider </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testProvider() throws Exception {
  admin.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      String sysUser=UserGroupInformation.getCurrentUser().getShortUserName();
      FileSystem fs=FileSystem.get(miniDFS.getConfiguration(0));
      List<AclEntry> baseAclList=new ArrayList<AclEntry>();
      AclEntry.Builder builder=new AclEntry.Builder();
      baseAclList.add(builder.setType(AclEntryType.USER).setScope(AclEntryScope.ACCESS).build());
      baseAclList.add(builder.setType(AclEntryType.GROUP).setScope(AclEntryScope.ACCESS).build());
      baseAclList.add(builder.setType(AclEntryType.OTHER).setScope(AclEntryScope.ACCESS).build());
      Path path1=new Path("/user/authz/obj/xxx");
      fs.mkdirs(path1);
      fs.setAcl(path1,baseAclList);
      fs.mkdirs(new Path("/user/authz/xxx"));
      fs.mkdirs(new Path("/user/xxx"));
      Path path=new Path("/");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user/authz");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user/authz/xxx");
      FileStatus status=fs.getFileStatus(path);
      Assert.assertEquals(sysUser,status.getOwner());
      Assert.assertEquals("supergroup",status.getGroup());
      Assert.assertEquals(new FsPermission((short)0755),status.getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      path=new Path("/user/authz/obj");
      Assert.assertEquals("hive",fs.getFileStatus(path).getOwner());
      Assert.assertEquals("hive",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0771),fs.getFileStatus(path).getPermission());
      Assert.assertFalse(fs.getAclStatus(path).getEntries().isEmpty());
      List<AclEntry> acls=new ArrayList<AclEntry>();
      acls.add(new AclEntry.Builder().setName(sysUser).setType(AclEntryType.USER).setScope(AclEntryScope.ACCESS).setPermission(FsAction.ALL).build());
      acls.add(new AclEntry.Builder().setName("supergroup").setType(AclEntryType.GROUP).setScope(AclEntryScope.ACCESS).setPermission(FsAction.READ_EXECUTE).build());
      acls.add(new AclEntry.Builder().setName("user-authz").setType(AclEntryType.USER).setScope(AclEntryScope.ACCESS).setPermission(FsAction.ALL).build());
      Assert.assertEquals(new LinkedHashSet<AclEntry>(acls),new LinkedHashSet<AclEntry>(fs.getAclStatus(path).getEntries()));
      path=new Path("/user/authz/obj/xxx");
      Assert.assertEquals("hive",fs.getFileStatus(path).getOwner());
      Assert.assertEquals("hive",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0771),fs.getFileStatus(path).getPermission());
      Assert.assertFalse(fs.getAclStatus(path).getEntries().isEmpty());
      Path path2=new Path("/user/authz/obj/path2");
      fs.mkdirs(path2);
      fs.setAcl(path2,baseAclList);
      path=new Path("/user/xxx");
      Assert.assertEquals(sysUser,fs.getFileStatus(path).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(path).getGroup());
      Assert.assertEquals(new FsPermission((short)0755),fs.getFileStatus(path).getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      System.setProperty("test.stale","true");
      path=new Path("/user/authz/xxx");
      status=fs.getFileStatus(path);
      Assert.assertEquals(sysUser,status.getOwner());
      Assert.assertEquals("supergroup",status.getGroup());
      Assert.assertEquals(new FsPermission((short)0755),status.getPermission());
      Assert.assertTrue(fs.getAclStatus(path).getEntries().isEmpty());
      Path pathOutside=new Path("/user/xxx");
      fs.setPermission(pathOutside,new FsPermission((short)0000));
      Assert.assertEquals(new FsPermission((short)0000),fs.getFileStatus(pathOutside).getPermission());
      fs.setOwner(pathOutside,sysUser,"supergroup");
      Assert.assertEquals(sysUser,fs.getFileStatus(pathOutside).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(pathOutside).getGroup());
      List<AclEntry> aclsOutside=new ArrayList<AclEntry>(baseAclList);
      List<AclEntry> acl=new ArrayList<AclEntry>();
      acl.add(new AclEntry.Builder().setName("supergroup").setType(AclEntryType.GROUP).setScope(AclEntryScope.ACCESS).setPermission(FsAction.READ_EXECUTE).build());
      aclsOutside.addAll(acl);
      fs.setAcl(pathOutside,aclsOutside);
      fs.removeAclEntries(pathOutside,acl);
      Assert.assertFalse(fs.getAclStatus(pathOutside).getEntries().containsAll(acl));
      Path pathInside=new Path("/user/authz/xxx");
      fs.setPermission(pathInside,new FsPermission((short)0000));
      Assert.assertEquals(new FsPermission((short)0000),fs.getFileStatus(pathInside).getPermission());
      fs.setOwner(pathInside,sysUser,"supergroup");
      Assert.assertEquals(sysUser,fs.getFileStatus(pathInside).getOwner());
      Assert.assertEquals("supergroup",fs.getFileStatus(pathInside).getGroup());
      Assert.assertTrue(fs.getAclStatus(pathInside).getEntries().isEmpty());
      fs.removeAclEntries(pathInside,acl);
      Assert.assertTrue(fs.getAclStatus(pathInside).getEntries().isEmpty());
      Path pathInsideAndHive=new Path("/user/authz/obj");
      fs.setPermission(pathInsideAndHive,new FsPermission((short)0000));
      Assert.assertEquals(new FsPermission((short)0771),fs.getFileStatus(pathInsideAndHive).getPermission());
      fs.setOwner(pathInsideAndHive,sysUser,"supergroup");
      Assert.assertEquals("hive",fs.getFileStatus(pathInsideAndHive).getOwner());
      Assert.assertEquals("hive",fs.getFileStatus(pathInsideAndHive).getGroup());
      return null;
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestUpdateForwarder </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInit() throws Exception {
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,10);
  Assert.assertEquals(-2,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertTrue(allUpdates.size() == 1);
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  allUpdates=updateForwarder.getAllUpdatesFrom(100);
  Assert.assertTrue(allUpdates.size() == 1);
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  Assert.assertEquals(-2,allUpdates.get(0).getSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(-1);
  Assert.assertEquals(0,allUpdates.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestUpdateableAuthzPaths </h4><pre class="type-7 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFullUpdate(){
  HMSPaths hmsPaths=createBaseHMSPaths(1,1);
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  assertTrue(hmsPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
  UpdateableAuthzPaths authzPaths=new UpdateableAuthzPaths(hmsPaths);
  PathsUpdate update=new PathsUpdate(1,true);
  update.toThrift().setPathsDump(authzPaths.getPathsDump().createPathsDump());
  UpdateableAuthzPaths authzPaths2=new UpdateableAuthzPaths(new String[]{"/"});
  UpdateableAuthzPaths pre=authzPaths2.updateFull(update);
  assertFalse(pre == authzPaths2);
  authzPaths2=pre;
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
  UpdateableAuthzPaths authzPaths3=new UpdateableAuthzPaths(createBaseHMSPaths(2,1));
  update=new PathsUpdate(2,true);
  update.toThrift().setPathsDump(authzPaths3.getPathsDump().createPathsDump());
  pre=authzPaths2.updateFull(update);
  assertFalse(pre == authzPaths2);
  authzPaths2=pre;
  assertNull(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1"}));
  assertNull(authzPaths2.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2"}).contains("db2"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2","tbl21"}).contains("db2.tbl21"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2","tbl21","part211"}).contains("db2.tbl21"));
  assertTrue(authzPaths2.findAuthzObjectExactMatches(new String[]{"db2","tbl21","part212"}).contains("db2.tbl21"));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDefaultDbPath(){
  HMSPaths hmsPaths=new HMSPaths(new String[]{"/user/hive/warehouse"});
  hmsPaths._addAuthzObject("default",Lists.newArrayList("/user/hive/warehouse"));
  assertTrue(hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse"}).contains("default"));
}

</code></pre>

<br>
<pre class="type-7 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartialUpdateAddPath(){
  HMSPaths hmsPaths=createBaseHMSPaths(1,1);
  UpdateableAuthzPaths authzPaths=new UpdateableAuthzPaths(hmsPaths);
  ReentrantReadWriteLock lock=new ReentrantReadWriteLock();
  PathsUpdate update=new PathsUpdate(2,false);
  TPathChanges pathChange=update.newPathChange("db1.tbl12");
  pathChange.addToAddPaths(PathsUpdate.parsePath("hdfs:///db1/tbl12"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  update=new PathsUpdate(3,false);
  pathChange=update.newPathChange("db1.tbl12");
  pathChange.addToAddPaths(PathsUpdate.parsePath("hdfs:///db1/tbl12/part121"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12"}).contains("db1.tbl12"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12","part121"}).contains("db1.tbl12"));
  update=new PathsUpdate(4,false);
  update.newPathChange("db1.xtbl11").addToAddPaths(PathsUpdate.parsePath("hdfs:///db1/xtbl11"));
  update.newPathChange("db1.tbl11").addToDelPaths(PathsUpdate.parsePath("hdfs:///db1/tbl11"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1"}).contains("db1"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","xtbl11"}).contains("db1.xtbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.xtbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.xtbl11"));
  assertNull(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","xtbl12"}));
  assertNull(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","xtbl12","part121"}));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12"}).contains("db1.tbl12"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl12","part121"}).contains("db1.tbl12"));
}

</code></pre>

<br>
<pre class="type-7 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartialUpdateDelPath(){
  HMSPaths hmsPaths=createBaseHMSPaths(1,1);
  UpdateableAuthzPaths authzPaths=new UpdateableAuthzPaths(hmsPaths);
  ReentrantReadWriteLock lock=new ReentrantReadWriteLock();
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11"}).contains("db1.tbl11"));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}).contains("db1.tbl11"));
  PathsUpdate update=new PathsUpdate(2,false);
  TPathChanges pathChange=update.newPathChange("db1.tbl11");
  pathChange.addToDelPaths(PathsUpdate.parsePath("hdfs:///db1/tbl11/part111"));
  authzPaths.updatePartial(Lists.newArrayList(update),lock);
  assertNull(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part111"}));
  assertTrue(authzPaths.findAuthzObjectExactMatches(new String[]{"db1","tbl11","part112"}).contains("db1.tbl11"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestDBWildcardPrivilege </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testOther() throws Exception {
  assertFalse(ROLE_SERVER_ALL_DB_ALL.implies(REQUEST_SERVER1_OTHER));
  assertFalse(REQUEST_SERVER1_OTHER.implies(ROLE_SERVER_ALL_DB_ALL));
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesURINegative() throws Exception {
  assertFalse(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","hdfs://namenode:8020/path/to/../../other"));
  assertFalse(DBWildcardPrivilege.impliesURI("file:///path","file:///path/to/../../other"));
  assertFalse(DBWildcardPrivilege.impliesURI("blah","hdfs://namenode:8020/path/to/some/dir"));
  assertFalse(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","blah"));
  assertFalse(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","file:///path/to/some/dir"));
  assertFalse(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","file://namenode:8020/path/to/some/dir"));
  assertFalse(DBWildcardPrivilege.impliesURI("hdfs://namenode1:8020/path","hdfs://namenode2:8020/path/to/some/dir"));
  assertFalse(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","hdfs://namenode:8021/path/to/some/dir"));
  assertFalse(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","hdfs://namenode:8020/pathFooBar"));
  assertTrue(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path/","hdfs://namenode:8020/path/FooBar"));
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnexpected() throws Exception {
  Privilege p=new Privilege(){
    @Override public boolean implies(    Privilege p){
      return false;
    }
  }
;
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.implies(null));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.implies(p));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.equals(null));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.equals(p));
  assertEquals(ROLE_SERVER_SERVER1_DB_ALL.hashCode(),create(ROLE_SERVER_SERVER1_DB_ALL.toString()).hashCode());
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRoleShorterThanRequest() throws Exception {
  assertTrue(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER1_DB1));
  assertTrue(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER1_DB2));
  assertFalse(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER2_DB1));
  assertFalse(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER2_DB2));
  assertTrue(ROLE_SERVER_ALL_DB_ALL.implies(REQUEST_SERVER1));
  assertFalse(ROLE_SERVER_ALL_DB_DB1.implies(REQUEST_SERVER1));
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesURIPositive() throws Exception {
  assertTrue(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","hdfs://namenode:8020/path/to/some/dir"));
  assertTrue(DBWildcardPrivilege.impliesURI("hdfs://namenode:8020/path","hdfs://namenode:8020/path"));
  assertTrue(DBWildcardPrivilege.impliesURI("file:///path","file:///path/to/some/dir"));
  assertTrue(DBWildcardPrivilege.impliesURI("file:///path","file:///path"));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRolesAndRequests() throws Exception {
  assertTrue(ROLE_SERVER_SERVER1_DB_ALL.implies(REQUEST_SERVER1_DB1));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.implies(REQUEST_SERVER2_DB1));
  assertTrue(ROLE_SERVER_SERVER1_DB_ALL.implies(REQUEST_SERVER1_DB2));
  assertFalse(ROLE_SERVER_SERVER1_DB_ALL.implies(REQUEST_SERVER2_DB2));
  assertTrue(REQUEST_SERVER1_DB1.implies(ROLE_SERVER_SERVER1_DB_ALL));
  assertFalse(REQUEST_SERVER2_DB1.implies(ROLE_SERVER_SERVER1_DB_ALL));
  assertTrue(REQUEST_SERVER1_DB2.implies(ROLE_SERVER_SERVER1_DB_ALL));
  assertFalse(REQUEST_SERVER2_DB2.implies(ROLE_SERVER_SERVER1_DB_ALL));
  assertTrue(ROLE_SERVER_SERVER1_DB_DB1.implies(REQUEST_SERVER1_DB1));
  assertFalse(ROLE_SERVER_SERVER1_DB_DB1.implies(REQUEST_SERVER2_DB1));
  assertFalse(ROLE_SERVER_SERVER1_DB_DB1.implies(REQUEST_SERVER1_DB2));
  assertFalse(ROLE_SERVER_SERVER1_DB_DB1.implies(REQUEST_SERVER2_DB2));
  assertTrue(REQUEST_SERVER1_DB1.implies(ROLE_SERVER_SERVER1_DB_DB1));
  assertFalse(REQUEST_SERVER2_DB1.implies(ROLE_SERVER_SERVER1_DB_DB1));
  assertFalse(REQUEST_SERVER1_DB2.implies(ROLE_SERVER_SERVER1_DB_DB1));
  assertFalse(REQUEST_SERVER2_DB2.implies(ROLE_SERVER_SERVER1_DB_DB1));
  assertFalse(ROLE_SERVER_SERVER2_DB_ALL.implies(REQUEST_SERVER1_DB1));
  assertTrue(ROLE_SERVER_SERVER2_DB_ALL.implies(REQUEST_SERVER2_DB1));
  assertFalse(ROLE_SERVER_SERVER2_DB_ALL.implies(REQUEST_SERVER1_DB2));
  assertTrue(ROLE_SERVER_SERVER2_DB_ALL.implies(REQUEST_SERVER2_DB2));
  assertFalse(REQUEST_SERVER1_DB1.implies(ROLE_SERVER_SERVER2_DB_ALL));
  assertTrue(REQUEST_SERVER2_DB1.implies(ROLE_SERVER_SERVER2_DB_ALL));
  assertFalse(REQUEST_SERVER1_DB2.implies(ROLE_SERVER_SERVER2_DB_ALL));
  assertTrue(REQUEST_SERVER2_DB2.implies(ROLE_SERVER_SERVER2_DB_ALL));
  assertFalse(ROLE_SERVER_SERVER2_DB_DB1.implies(REQUEST_SERVER1_DB1));
  assertTrue(ROLE_SERVER_SERVER2_DB_DB1.implies(REQUEST_SERVER2_DB1));
  assertFalse(ROLE_SERVER_SERVER2_DB_DB1.implies(REQUEST_SERVER1_DB2));
  assertFalse(ROLE_SERVER_SERVER2_DB_DB1.implies(REQUEST_SERVER2_DB2));
  assertFalse(REQUEST_SERVER1_DB1.implies(ROLE_SERVER_SERVER2_DB_DB1));
  assertTrue(REQUEST_SERVER2_DB1.implies(ROLE_SERVER_SERVER2_DB_DB1));
  assertFalse(REQUEST_SERVER1_DB2.implies(ROLE_SERVER_SERVER2_DB_DB1));
  assertFalse(REQUEST_SERVER2_DB2.implies(ROLE_SERVER_SERVER2_DB_DB1));
  assertTrue(ROLE_SERVER_ALL_DB_ALL.implies(REQUEST_SERVER1_DB1));
  assertTrue(ROLE_SERVER_ALL_DB_ALL.implies(REQUEST_SERVER2_DB1));
  assertTrue(ROLE_SERVER_ALL_DB_ALL.implies(REQUEST_SERVER1_DB2));
  assertTrue(ROLE_SERVER_ALL_DB_ALL.implies(REQUEST_SERVER2_DB2));
  assertTrue(REQUEST_SERVER1_DB1.implies(ROLE_SERVER_ALL_DB_ALL));
  assertTrue(REQUEST_SERVER2_DB1.implies(ROLE_SERVER_ALL_DB_ALL));
  assertTrue(REQUEST_SERVER1_DB2.implies(ROLE_SERVER_ALL_DB_ALL));
  assertTrue(REQUEST_SERVER2_DB2.implies(ROLE_SERVER_ALL_DB_ALL));
  assertTrue(ROLE_SERVER_ALL_DB_DB1.implies(REQUEST_SERVER1_DB1));
  assertTrue(ROLE_SERVER_ALL_DB_DB1.implies(REQUEST_SERVER2_DB1));
  assertFalse(ROLE_SERVER_ALL_DB_DB1.implies(REQUEST_SERVER1_DB2));
  assertFalse(ROLE_SERVER_ALL_DB_DB1.implies(REQUEST_SERVER2_DB2));
  assertTrue(REQUEST_SERVER1_DB1.implies(ROLE_SERVER_ALL_DB_DB1));
  assertTrue(REQUEST_SERVER2_DB1.implies(ROLE_SERVER_ALL_DB_DB1));
  assertFalse(REQUEST_SERVER1_DB2.implies(ROLE_SERVER_ALL_DB_DB1));
  assertFalse(REQUEST_SERVER2_DB2.implies(ROLE_SERVER_ALL_DB_DB1));
  assertTrue(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER1_URI1));
  assertTrue(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER1_URI2));
  assertTrue(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER1_URI2));
  assertTrue(ROLE_SERVER_SERVER1_URI_ALL.implies(REQUEST_SERVER1_URI1));
  assertTrue(ROLE_SERVER_SERVER1_URI_ALL.implies(REQUEST_SERVER1_URI2));
  assertTrue(ROLE_SERVER_SERVER1.implies(REQUEST_SERVER1_URI2));
  assertTrue(ROLE_SERVER_SERVER1_URI_URI1.implies(REQUEST_SERVER1_URI1));
  assertFalse(ROLE_SERVER_SERVER1_URI_URI1.implies(REQUEST_SERVER1_URI2));
  assertTrue(ROLE_SERVER_SERVER1_URI_URI2.implies(REQUEST_SERVER1_URI2));
  assertFalse(ROLE_SERVER_SERVER1_URI_URI2.implies(REQUEST_SERVER1_URI1));
  assertFalse(REQUEST_SERVER2_DB2.implies(REQUEST_SERVER1_URI1));
  assertFalse(ROLE_SERVER_ALL_DB_DB1.implies(REQUEST_SERVER1_URI1));
  assertTrue(REQUEST_SERVER1_URI1.implies(ROLE_SERVER_SERVER1_URI_ALL));
  assertTrue(REQUEST_SERVER1_URI2.implies(ROLE_SERVER_SERVER1_URI_ALL));
  assertFalse(REQUEST_SERVER1_URI1.implies(ROLE_SERVER_SERVER1));
  assertFalse(REQUEST_SERVER1_URI1.implies(ROLE_SERVER_SERVER1_URI_URI1));
  assertFalse(REQUEST_SERVER1_URI2.implies(ROLE_SERVER_SERVER1_URI_URI1));
  assertFalse(REQUEST_SERVER1_URI2.implies(ROLE_SERVER_SERVER1_URI_URI2));
  assertFalse(REQUEST_SERVER1_URI1.implies(ROLE_SERVER_SERVER1_URI_URI2));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testActionHierarchy() throws Exception {
  String dbName="db1";
  DBWildcardPrivilege dbAll=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","ALL"));
  DBWildcardPrivilege dbSelect=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","SELECT"));
  DBWildcardPrivilege dbInsert=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","INSERT"));
  DBWildcardPrivilege dbAlter=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","ALTER"));
  DBWildcardPrivilege dbCreate=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","CREATE"));
  DBWildcardPrivilege dbDrop=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","DROP"));
  DBWildcardPrivilege dbIndex=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","INDEX"));
  DBWildcardPrivilege dbLock=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","LOCK"));
  assertTrue(dbAll.implies(dbSelect));
  assertTrue(dbAll.implies(dbInsert));
  assertTrue(dbAll.implies(dbAlter));
  assertTrue(dbAll.implies(dbCreate));
  assertTrue(dbAll.implies(dbDrop));
  assertTrue(dbAll.implies(dbIndex));
  assertTrue(dbAll.implies(dbLock));
  dbAll=create(new KeyValue("server","server1"),new KeyValue("db",dbName),new KeyValue("action","*"));
  assertTrue(dbAll.implies(dbSelect));
  assertTrue(dbAll.implies(dbInsert));
  assertTrue(dbAll.implies(dbAlter));
  assertTrue(dbAll.implies(dbCreate));
  assertTrue(dbAll.implies(dbDrop));
  assertTrue(dbAll.implies(dbIndex));
  assertTrue(dbAll.implies(dbLock));
  dbAll=create(new KeyValue("server","server1"),new KeyValue("db",dbName));
  assertTrue(dbAll.implies(dbSelect));
  assertTrue(dbAll.implies(dbInsert));
  assertTrue(dbAll.implies(dbAlter));
  assertTrue(dbAll.implies(dbCreate));
  assertTrue(dbAll.implies(dbDrop));
  assertTrue(dbAll.implies(dbIndex));
  assertTrue(dbAll.implies(dbLock));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestPolicyParsingNegative </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testAll() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = *",globalPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerAll() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=*",globalPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDatabaseRequiredInRole() throws Exception {
  append("[databases]",globalPolicyFile);
  append("other_group_db = " + otherPolicyFile.getPath(),globalPolicyFile);
  append("[groups]",otherPolicyFile);
  append("other_group = malicious_role",otherPolicyFile);
  append("[roles]",otherPolicyFile);
  append("malicious_role = server=server1",otherPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create policy file with multiple per db files.
 * Verify that a file with bad format is the only one that's ignored
 * @throws Exception
 */
@Test public void testMultiDbWithErrors() throws Exception {
  File db1PolicyFile=new File(baseDir,"db1.ini");
  File db2PolicyFile=new File(baseDir,"db2.ini");
  append("[databases]",globalPolicyFile);
  append("db1 = " + db1PolicyFile.getPath(),globalPolicyFile);
  append("db2 = " + db2PolicyFile.getPath(),globalPolicyFile);
  append("[groups]",globalPolicyFile);
  append("db3_group = db3_rule",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("db3_rule = server=server1->db=db3->table=sales->action=select",globalPolicyFile);
  append("[groups]",db1PolicyFile);
  append("db1_group = bad_rule",db1PolicyFile);
  append("[roles]",db1PolicyFile);
  append("bad_rule = server=server1->db=customers->=purchases->action=",db1PolicyFile);
  append("[groups]",db2PolicyFile);
  append("db2_group = db2_rule",db2PolicyFile);
  append("[roles]",db2PolicyFile);
  append("db2_rule = server=server1->db=db2->table=purchases->action=select",db2PolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("db1_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
  permissions=policy.getAllPrivileges(Sets.newHashSet("db2_group"),ActiveRoleSet.ALL);
  Assert.assertEquals(permissions.toString(),1,permissions.size());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=server2",globalPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUnauthorizedDbSpecifiedInDBPolicyFile() throws Exception {
  append("[databases]",globalPolicyFile);
  append("other_group_db = " + otherPolicyFile.getPath(),globalPolicyFile);
  append("[groups]",otherPolicyFile);
  append("other_group = malicious_role",otherPolicyFile);
  append("[roles]",otherPolicyFile);
  append("malicious_role = server=server1->db=customers->table=purchases->action=select",otherPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestResourceAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Server server1=new Server("server1");
  AccessURI uri=new AccessURI("file:///path/to/");
  Set<? extends Action> actions=EnumSet.of(DBModelAction.ALL,DBModelAction.SELECT,DBModelAction.INSERT);
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"server=" + server1.getName() + "->uri="+ uri.getName(),"server=" + server1.getName() + "->uri="+ uri.getName());
  policyFile.write(iniFile);
  DBPolicyFileBackend policy=new DBPolicyFileBackend(server1.getName(),initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNonAbolutePath() throws Exception {
  Subject user1=new Subject("user1");
  Server server1=new Server("server1");
  AccessURI uri=new AccessURI("file:///path/to/");
  Set<? extends Action> actions=EnumSet.of(DBModelAction.ALL,DBModelAction.SELECT,DBModelAction.INSERT);
  policyFile.addGroupsToUser(user1.getName(),"group1").addRolesToGroup("group1","role1").addPermissionsToRole("role1","server=" + server1.getName() + "->uri="+ uri.getName());
  policyFile.write(iniFile);
  DBPolicyFileBackend policy=new DBPolicyFileBackend(server1.getName(),initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/./");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/../");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/../../");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/dir/../../");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Indexer indexer1=new Indexer("indexer1");
  Set<? extends Action> actions=EnumSet.allOf(IndexerModelAction.class);
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"indexer=" + indexer1.getName(),"indexer=" + indexer1.getName());
  policyFile.write(iniFile);
  IndexerPolicyFileBackend policy=new IndexerPolicyFileBackend(initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(indexer1);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerPolicyNegative </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIndexerRequiredInRole() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = some_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("some_role = action=read",globalPolicyFile);
  PolicyEngine policy=new IndexerPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGroupIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = indexer=*",globalPolicyFile);
  PolicyEngine policy=new IndexerPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("incorrectGroup"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerWildcardPrivilege </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUnexpected() throws Exception {
  Privilege p=new Privilege(){
    @Override public boolean implies(    Privilege p){
      return false;
    }
  }
;
  Privilege indexer1=create(new KeyValue("indexer","index1"));
  assertFalse(indexer1.implies(null));
  assertFalse(indexer1.implies(p));
  assertFalse(indexer1.equals(null));
  assertFalse(indexer1.equals(p));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testActionAll() throws Exception {
  Privilege ind1All=create(new KeyValue("indexer","index1"),new KeyValue("action",ALL));
  Privilege ind1Write=create(new KeyValue("indexer","index1"),new KeyValue("action","write"));
  Privilege ind1Read=create(new KeyValue("indexer","index1"),new KeyValue("action","read"));
  assertTrue(ind1All.implies(ind1All));
  assertTrue(ind1All.implies(ind1Write));
  assertTrue(ind1All.implies(ind1Read));
  assertFalse(ind1Write.implies(ind1All));
  assertFalse(ind1Read.implies(ind1All));
  Privilege ind1=create(new KeyValue("indexer","index1"));
  assertTrue(ind1All.implies(ind1));
  assertTrue(ind1.implies(ind1All));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSimpleAction() throws Exception {
  Privilege read=create(new KeyValue("indexer","ind1"),new KeyValue("action","read"));
  Privilege write=create(new KeyValue("indexer","ind1"),new KeyValue("action","write"));
  Privilege readCase=create(new KeyValue("indeXeR","iNd1"),new KeyValue("AcTiOn","ReAd"));
  assertTrue(read.implies(read));
  assertTrue(write.implies(write));
  assertTrue(read.implies(readCase));
  assertTrue(readCase.implies(read));
  assertFalse(read.implies(write));
  assertFalse(readCase.implies(write));
  assertFalse(write.implies(read));
  assertFalse(write.implies(readCase));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRoleShorterThanRequest() throws Exception {
  Privilege indexer1=create(new KeyValue("indexer","ind1"));
  Privilege read=create(new KeyValue("indexer","ind1"),new KeyValue("action","read"));
  Privilege write=create(new KeyValue("indexer","ind1"),new KeyValue("action","write"));
  Privilege all=create(new KeyValue("indexer","ind1"),new KeyValue("action",ALL));
  assertTrue(indexer1.implies(read));
  assertTrue(indexer1.implies(write));
  assertTrue(indexer1.implies(all));
  assertFalse(read.implies(indexer1));
  assertFalse(write.implies(indexer1));
  assertTrue(all.implies(indexer1));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIndexerAll() throws Exception {
  Privilege indexerAll=create(new KeyValue("indexer",ALL));
  Privilege indexer1=create(new KeyValue("indexer","ind1"));
  assertTrue(indexerAll.implies(indexer1));
  assertTrue(indexer1.implies(indexerAll));
  Privilege allWrite=create(new KeyValue("indexer",ALL),new KeyValue("action","write"));
  Privilege allRead=create(new KeyValue("indexer",ALL),new KeyValue("action","read"));
  Privilege ind1Write=create(new KeyValue("indexer","ind1"),new KeyValue("action","write"));
  Privilege ind1Read=create(new KeyValue("indexer","ind1"),new KeyValue("action","read"));
  assertTrue(allWrite.implies(ind1Write));
  assertTrue(allRead.implies(ind1Read));
  assertTrue(ind1Write.implies(allWrite));
  assertTrue(ind1Read.implies(allRead));
  assertFalse(allWrite.implies(ind1Read));
  assertFalse(ind1Write.implies(ind1Read));
  assertFalse(allRead.implies(ind1Write));
  assertFalse(ind1Read.implies(allWrite));
  assertFalse(allWrite.implies(allRead));
  assertFalse(allRead.implies(allWrite));
  assertFalse(ind1Write.implies(ind1Read));
  assertFalse(ind1Read.implies(ind1Write));
  assertTrue(indexerAll.implies(allWrite));
  assertTrue(indexerAll.implies(allRead));
  assertTrue(indexerAll.implies(ind1Write));
  assertTrue(indexerAll.implies(ind1Read));
  assertFalse(allWrite.implies(indexerAll));
  assertFalse(allRead.implies(indexerAll));
  assertFalse(ind1Write.implies(indexerAll));
  assertFalse(ind1Read.implies(indexerAll));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSimpleNoAction() throws Exception {
  Privilege indexer1=create(new KeyValue("indexer","ind1"));
  Privilege indexer2=create(new KeyValue("indexer","ind2"));
  Privilege indexer1Case=create(new KeyValue("indeXeR","inD1"));
  assertTrue(indexer1.implies(indexer1));
  assertTrue(indexer2.implies(indexer2));
  assertTrue(indexer1.implies(indexer1Case));
  assertTrue(indexer1Case.implies(indexer1));
  assertFalse(indexer1.implies(indexer2));
  assertFalse(indexer1Case.implies(indexer2));
  assertFalse(indexer2.implies(indexer1));
  assertFalse(indexer2.implies(indexer1Case));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Collection collection1=new Collection("collection1");
  Set<? extends Action> actions=EnumSet.allOf(SearchModelAction.class);
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"collection=" + collection1.getName(),"collection=" + collection1.getName());
  policyFile.write(iniFile);
  SearchPolicyFileBackend policy=new SearchPolicyFileBackend(initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(collection1);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchPolicyNegative </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCollectionRequiredInRole() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = some_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("some_role = action=query",globalPolicyFile);
  PolicyEngine policy=new SearchPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGroupIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = collection=*",globalPolicyFile);
  PolicyEngine policy=new SearchPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("incorrectGroup"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchWildcardPrivilege </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSimpleNoAction() throws Exception {
  Privilege collection1=create(new KeyValue("collection","coll1"));
  Privilege collection2=create(new KeyValue("collection","coll2"));
  Privilege collection1Case=create(new KeyValue("colleCtIon","coLl1"));
  assertTrue(collection1.implies(collection1));
  assertTrue(collection2.implies(collection2));
  assertTrue(collection1.implies(collection1Case));
  assertTrue(collection1Case.implies(collection1));
  assertFalse(collection1.implies(collection2));
  assertFalse(collection1Case.implies(collection2));
  assertFalse(collection2.implies(collection1));
  assertFalse(collection2.implies(collection1Case));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSimpleAction() throws Exception {
  Privilege query=create(new KeyValue("collection","coll1"),new KeyValue("action","query"));
  Privilege update=create(new KeyValue("collection","coll1"),new KeyValue("action","update"));
  Privilege queryCase=create(new KeyValue("colleCtIon","coLl1"),new KeyValue("AcTiOn","QuERy"));
  assertTrue(query.implies(query));
  assertTrue(update.implies(update));
  assertTrue(query.implies(queryCase));
  assertTrue(queryCase.implies(query));
  assertFalse(query.implies(update));
  assertFalse(queryCase.implies(update));
  assertFalse(update.implies(query));
  assertFalse(update.implies(queryCase));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCollectionAll() throws Exception {
  Privilege collectionAll=create(new KeyValue("collection",ALL));
  Privilege collection1=create(new KeyValue("collection","coll1"));
  assertTrue(collectionAll.implies(collection1));
  assertTrue(collection1.implies(collectionAll));
  Privilege allUpdate=create(new KeyValue("collection",ALL),new KeyValue("action","update"));
  Privilege allQuery=create(new KeyValue("collection",ALL),new KeyValue("action","query"));
  Privilege coll1Update=create(new KeyValue("collection","coll1"),new KeyValue("action","update"));
  Privilege coll1Query=create(new KeyValue("collection","coll1"),new KeyValue("action","query"));
  assertTrue(allUpdate.implies(coll1Update));
  assertTrue(allQuery.implies(coll1Query));
  assertTrue(coll1Update.implies(allUpdate));
  assertTrue(coll1Query.implies(allQuery));
  assertFalse(allUpdate.implies(coll1Query));
  assertFalse(coll1Update.implies(coll1Query));
  assertFalse(allQuery.implies(coll1Update));
  assertFalse(coll1Query.implies(allUpdate));
  assertFalse(allUpdate.implies(allQuery));
  assertFalse(allQuery.implies(allUpdate));
  assertFalse(coll1Update.implies(coll1Query));
  assertFalse(coll1Query.implies(coll1Update));
  assertTrue(collectionAll.implies(allUpdate));
  assertTrue(collectionAll.implies(allQuery));
  assertTrue(collectionAll.implies(coll1Update));
  assertTrue(collectionAll.implies(coll1Query));
  assertFalse(allUpdate.implies(collectionAll));
  assertFalse(allQuery.implies(collectionAll));
  assertFalse(coll1Update.implies(collectionAll));
  assertFalse(coll1Query.implies(collectionAll));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRoleShorterThanRequest() throws Exception {
  Privilege collection1=create(new KeyValue("collection","coll1"));
  Privilege query=create(new KeyValue("collection","coll1"),new KeyValue("action","query"));
  Privilege update=create(new KeyValue("collection","coll1"),new KeyValue("action","update"));
  Privilege all=create(new KeyValue("collection","coll1"),new KeyValue("action",ALL));
  assertTrue(collection1.implies(query));
  assertTrue(collection1.implies(update));
  assertTrue(collection1.implies(all));
  assertFalse(query.implies(collection1));
  assertFalse(update.implies(collection1));
  assertTrue(all.implies(collection1));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUnexpected() throws Exception {
  Privilege p=new Privilege(){
    @Override public boolean implies(    Privilege p){
      return false;
    }
  }
;
  Privilege collection1=create(new KeyValue("collection","coll1"));
  assertFalse(collection1.implies(null));
  assertFalse(collection1.implies(p));
  assertFalse(collection1.equals(null));
  assertFalse(collection1.equals(p));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testActionAll() throws Exception {
  Privilege coll1All=create(new KeyValue("collection","coll1"),new KeyValue("action",ALL));
  Privilege coll1Update=create(new KeyValue("collection","coll1"),new KeyValue("action","update"));
  Privilege coll1Query=create(new KeyValue("collection","coll1"),new KeyValue("action","query"));
  assertTrue(coll1All.implies(coll1All));
  assertTrue(coll1All.implies(coll1Update));
  assertTrue(coll1All.implies(coll1Query));
  assertFalse(coll1Update.implies(coll1All));
  assertFalse(coll1Query.implies(coll1All));
  Privilege coll1=create(new KeyValue("collection","coll1"));
  assertTrue(coll1All.implies(coll1));
  assertTrue(coll1.implies(coll1All));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Server server1=new Server("server1");
  Connector connector1=new Connector("c1");
  Set<? extends Action> actions=Sets.newHashSet(new SqoopAction(SqoopActionConstant.READ));
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"server=server1->connector=c1->action=read","server=server1->connector=c1->action=read");
  policyFile.write(iniFile);
  SqoopPolicyFileProviderBackend policy=new SqoopPolicyFileProviderBackend(server1.getName(),initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(server1,connector1);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopPolicyNegative </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNoServerNameConfig() throws Exception {
  append("[groups]",globalPolicyFile);
  append("other_group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = connector=c1->action=read,link=l1->action=read",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testAll() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = *",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=server2",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testauthorizedSqoopInPolicyFile() throws Exception {
  append("[groups]",globalPolicyFile);
  append("other_group = other_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("other_role = server=server1->connector=c1->action=read, server=server1->link=l1->action=read",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("malicious_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
  permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.size() == 2);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerAllName() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=*",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopWildcardPrivilege </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testActionAll() throws Exception {
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_READ));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_WRITE));
  assertTrue(SQOOP_SERVER1_JOB1_ALL.implies(SQOOP_SERVER1_JOB1_READ));
  assertTrue(SQOOP_SERVER1_JOB1_ALL.implies(SQOOP_SERVER1_JOB1_WRITE));
  assertTrue(SQOOP_SERVER1_LINK1_ALL.implies(SQOOP_SERVER1_LINK1_READ));
  assertTrue(SQOOP_SERVER1_LINK1_ALL.implies(SQOOP_SERVER1_LINK1_WRITE));
  assertTrue(SQOOP_SERVER1_CONNECTOR1_ALL.implies(SQOOP_SERVER1_CONNECTOR1_READ));
  assertTrue(SQOOP_SERVER1_CONNECTOR1_ALL.implies(SQOOP_SERVER1_CONNECTOR1_WRITE));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUnexpected() throws Exception {
  Privilege p=new Privilege(){
    @Override public boolean implies(    Privilege p){
      return false;
    }
  }
;
  Privilege job1=create(new KeyValue("SERVER","server"),new KeyValue("JOB","job1"));
  assertFalse(job1.implies(null));
  assertFalse(job1.implies(p));
  assertFalse(job1.equals(null));
  assertFalse(job1.equals(p));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testShorterThanRequest() throws Exception {
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_JOB1_ALL));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_JOB1_READ));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_JOB1_WRITE));
  assertFalse(SQOOP_SERVER1_WRITE.implies(SQOOP_SERVER1_READ));
  assertTrue(SQOOP_SERVER1_READ.implies(SQOOP_SERVER1_JOB1_READ));
  assertTrue(SQOOP_SERVER1_WRITE.implies(SQOOP_SERVER1_JOB1_WRITE));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_LINK1_ALL));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_LINK1_READ));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_LINK1_WRITE));
  assertTrue(SQOOP_SERVER1_READ.implies(SQOOP_SERVER1_LINK1_READ));
  assertTrue(SQOOP_SERVER1_WRITE.implies(SQOOP_SERVER1_LINK1_WRITE));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_CONNECTOR1_ALL));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_CONNECTOR1_READ));
  assertTrue(SQOOP_SERVER1_ALL.implies(SQOOP_SERVER1_CONNECTOR1_WRITE));
  assertTrue(SQOOP_SERVER1_READ.implies(SQOOP_SERVER1_CONNECTOR1_READ));
  assertTrue(SQOOP_SERVER1_WRITE.implies(SQOOP_SERVER1_CONNECTOR1_WRITE));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSimpleAction() throws Exception {
  assertFalse(SQOOP_SERVER1_WRITE.implies(SQOOP_SERVER1_READ));
  assertFalse(SQOOP_SERVER1_READ.implies(SQOOP_SERVER1_WRITE));
  assertFalse(SQOOP_SERVER1_CONNECTOR1_WRITE.implies(SQOOP_SERVER1_CONNECTOR1_READ));
  assertFalse(SQOOP_SERVER1_CONNECTOR1_READ.implies(SQOOP_SERVER1_CONNECTOR1_WRITE));
  assertFalse(SQOOP_SERVER1_JOB1_READ.implies(SQOOP_SERVER1_JOB1_WRITE));
  assertFalse(SQOOP_SERVER1_JOB1_WRITE.implies(SQOOP_SERVER1_JOB1_READ));
  assertFalse(SQOOP_SERVER1_LINK1_READ.implies(SQOOP_SERVER1_LINK1_WRITE));
  assertFalse(SQOOP_SERVER1_LINK1_WRITE.implies(SQOOP_SERVER1_LINK1_READ));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.common.TestNoAuthorizationProvider </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoAuthorizationProvider(){
  NoAuthorizationProvider nap=new NoAuthorizationProvider();
  assertFalse(nap.hasAccess(null,null,null,null));
  GroupMappingService gms=nap.getGroupMapping();
  assertEquals(gms.getGroups(null).size(),0);
  assertEquals(gms.getGroups("").size(),0);
  assertEquals(gms.getGroups("a").size(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestSentryGMPrivilege </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSearchImpliesAction() throws Exception {
  MSentryGMPrivilege fieldPrivilege1=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f2")),SearchConstants.QUERY,false);
  MSentryGMPrivilege fieldPrivilege2=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f2")),SearchConstants.QUERY,false);
  assertTrue(fieldPrivilege1.implies(fieldPrivilege2));
  fieldPrivilege2.setAction(SearchConstants.UPDATE);
  assertFalse(fieldPrivilege1.implies(fieldPrivilege2));
  fieldPrivilege1.setAction(SearchConstants.ALL);
  assertTrue(fieldPrivilege1.implies(fieldPrivilege2));
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * The requested privilege has the same authorizable size as with the persistent privilege
 * @throws Exception
 */
@Test public void testSearchImpliesEqualAuthorizable() throws Exception {
  MSentryGMPrivilege serverPrivilege1=new MSentryGMPrivilege("solr","service1",null,SearchConstants.QUERY,false);
  MSentryGMPrivilege serverPrivilege2=new MSentryGMPrivilege("solr","service2",null,SearchConstants.QUERY,false);
  assertFalse(serverPrivilege1.implies(serverPrivilege2));
  MSentryGMPrivilege collectionPrivilege1=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1")),SearchConstants.QUERY,false);
  MSentryGMPrivilege collectionPrivilege2=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c2")),SearchConstants.QUERY,false);
  assertFalse(collectionPrivilege1.implies(collectionPrivilege2));
  MSentryGMPrivilege fieldPrivilege1=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f1")),SearchConstants.QUERY,false);
  MSentryGMPrivilege fieldPrivilege2=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f2")),SearchConstants.QUERY,false);
  assertFalse(fieldPrivilege1.implies(fieldPrivilege2));
  collectionPrivilege2.setAuthorizables(Arrays.asList(new Collection(AccessConstants.ALL)));
  collectionPrivilege2.implies(collectionPrivilege1);
  fieldPrivilege2.setAuthorizables(Arrays.asList(new Collection("c1"),new Field(AccessConstants.ALL)));
  fieldPrivilege2.implies(fieldPrivilege1);
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesWithServerScope() throws Exception {
  MSentryGMPrivilege serverPrivilege=new MSentryGMPrivilege("solr","service1",null,SearchConstants.QUERY,false);
  MSentryGMPrivilege collectionPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1")),SearchConstants.QUERY,false);
  assertTrue(serverPrivilege.implies(collectionPrivilege));
  MSentryGMPrivilege fieldPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f1")),SearchConstants.QUERY,false);
  assertTrue(serverPrivilege.implies(fieldPrivilege));
  assertTrue(collectionPrivilege.implies(fieldPrivilege));
  serverPrivilege.setAction(SearchConstants.UPDATE);
  assertFalse(serverPrivilege.implies(collectionPrivilege));
  assertFalse(serverPrivilege.implies(fieldPrivilege));
  serverPrivilege.setAction(SearchConstants.ALL);
  assertTrue(serverPrivilege.implies(collectionPrivilege));
  assertTrue(serverPrivilege.implies(fieldPrivilege));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * The requested privilege has the different authorizable size with the persistent privilege
 * @throws Exception
 */
@Test public void testImpliesDifferentAuthorizable() throws Exception {
  MSentryGMPrivilege serverPrivilege=new MSentryGMPrivilege("solr","service1",null,SearchConstants.QUERY,false);
  MSentryGMPrivilege collectionPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1")),SearchConstants.QUERY,false);
  MSentryGMPrivilege fieldPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f1")),SearchConstants.QUERY,false);
  assertTrue(serverPrivilege.implies(collectionPrivilege));
  assertTrue(serverPrivilege.implies(fieldPrivilege));
  assertTrue(collectionPrivilege.implies(fieldPrivilege));
  assertFalse(fieldPrivilege.implies(collectionPrivilege));
  assertFalse(fieldPrivilege.implies(serverPrivilege));
  assertFalse(collectionPrivilege.implies(serverPrivilege));
  MSentryGMPrivilege fieldAllPrivilege=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field(AccessConstants.ALL)),SearchConstants.QUERY,false);
  assertTrue(fieldAllPrivilege.implies(collectionPrivilege));
  MSentryGMPrivilege fieldPrivilege1=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c1"),new Field("f1")),SearchConstants.QUERY,false);
  MSentryGMPrivilege fieldPrivilege2=new MSentryGMPrivilege("solr","service1",Arrays.asList(new Collection("c2"),new Field("f2")),SearchConstants.QUERY,false);
  assertFalse(fieldPrivilege1.implies(fieldPrivilege2));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestSentryRole </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeletePrivilegeAndRole() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setURI(SentryStore.NULL_COL);
  hivePrivilege.setColumnName(SentryStore.NULL_COL);
  hivePrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  hivePrivilege.appendRole(role);
  solrPrivilege.appendRole(role);
  pm.makePersistent(hivePrivilege);
  pm.makePersistent(solrPrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  role.removeGMPrivileges();
  role.removePrivileges();
  pm.makePersistent(role);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(0,role.getPrivileges().size());
  assertEquals(0,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.deletePersistent(role);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  assertTrue(role == null);
  commitTransaction(pm);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.thrift.TestSentryGenericServiceIntegration </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testMultipleRolesSamePrivilege() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1,SOLR);
      client.createRole(requestorUserName,roleName1,SOLR);
      client.dropRoleIfExists(requestorUserName,roleName2,SOLR);
      client.createRole(requestorUserName,roleName2,SOLR);
      TSentryPrivilege queryPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.QUERY);
      client.grantPrivilege(requestorUserName,roleName1,SOLR,queryPrivilege);
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName1,SOLR,"service1");
      assertTrue("Privilege not assigned to role1 !!",listPrivilegesByRoleName.size() == 1);
      client.grantPrivilege(requestorUserName,roleName2,SOLR,queryPrivilege);
      listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,SOLR,"service1");
      assertTrue("Privilege not assigned to role2 !!",listPrivilegesByRoleName.size() == 1);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleToGroup() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String testGroupName="g1";
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(requestorUserName,Sets.newHashSet(testGroupName));
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(testGroupName));
      Set<TSentryRole> roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        String group : role.getGroups()) {
          assertEquals(testGroupName,group);
        }
      }
      client.deleteRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(testGroupName));
      roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",0,roles.size());
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropShowRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(requestorUserGroupNames));
      Set<TSentryRole> roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
      }
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testShowGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      TSentryPrivilege queryPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.QUERY);
      TSentryPrivilege updatePrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.UPDATE);
      client.grantPrivilege(requestorUserName,roleName,SOLR,updatePrivilege);
      client.grantPrivilege(requestorUserName,roleName,SOLR,queryPrivilege);
      Set<TSentryPrivilege> privileges=client.listPrivilegesByRoleName(requestorUserName,roleName,SOLR,"service1");
      assertTrue(privileges.size() == 2);
      client.revokePrivilege(requestorUserName,roleName,SOLR,updatePrivilege);
      privileges=client.listPrivilegesByRoleName(requestorUserName,roleName,SOLR,"service1");
      assertTrue(privileges.size() == 1);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r1";
      String groupName="group1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(requestorUserName,Sets.newHashSet(groupName));
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(groupName));
      Set<TSentryRole> groupRoles=client.listRolesByGroupName(requestorUserName,groupName,SOLR);
      assertTrue(groupRoles.size() == 1);
      for (      TSentryRole role : groupRoles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        String group : role.getGroups()) {
          assertEquals(groupName,group);
        }
      }
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.tools.TestSentryShellSolr </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"--create_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"-lr","-conf",confPath.getAbsolutePath()};
      SentryShellSolr sentryShell=new SentryShellSolr();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"--drop_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      Set<TSentryRole> roles=client.listAllRoles(requestorName,SOLR);
      assertEquals("Incorrect number of roles",0,roles.size());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.appender.TestRollingFileWithoutDeleteAppender </h4><pre class="type-12 type-16 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Generate log enough to cause a single rollover. Verify the file name format
 * @throws Throwable
 */
@Test public void testFileNamePattern() throws Throwable {
  if (dataDir == null) {
    fail("Excepted temp folder for audit log is created.");
  }
  RollingFileWithoutDeleteAppender appender=new RollingFileWithoutDeleteAppender(new PatternLayout("%m%n"),dataDir.getPath() + "/auditLog.log");
  appender.setMaximumFileSize(10);
  sentryLogger.addAppender(appender);
  sentryLogger.debug("123456789012345");
  File[] files=dataDir.listFiles();
  if (files != null) {
    assertEquals(files.length,2);
    assertTrue(files[0].getName().contains("auditLog.log."));
    assertTrue(files[1].getName().contains("auditLog.log."));
  }
 else {
    fail("Excepted 2 log files.");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryPrivilege </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesPrivilegePositiveWithColumn() throws Exception {
  MSentryPrivilege my=new MSentryPrivilege();
  MSentryPrivilege your=new MSentryPrivilege();
  my.setServerName("server1");
  my.setAction(AccessConstants.SELECT);
  your.setServerName("server1");
  your.setDbName("db1");
  your.setTableName("tb1");
  your.setColumnName("c1");
  your.setAction(AccessConstants.SELECT);
  assertTrue(my.implies(your));
  my.setDbName("db1");
  assertTrue(my.implies(your));
  my.setTableName("tb1");
  assertTrue(my.implies(your));
  my.setColumnName("c1");
  assertTrue(my.implies(your));
}

</code></pre>

<br>
<pre class="type-17 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesPrivilegePositive() throws Exception {
  MSentryPrivilege my=new MSentryPrivilege();
  MSentryPrivilege your=new MSentryPrivilege();
  my.setServerName("server1");
  my.setDbName("db1");
  my.setTableName("tb1");
  my.setAction(AccessConstants.SELECT);
  your.setServerName("server1");
  your.setDbName("db1");
  your.setTableName("tb1");
  your.setAction(AccessConstants.SELECT);
  assertTrue(my.implies(your));
  my.setAction(AccessConstants.ALL);
  assertTrue(my.implies(your));
  my.setTableName("");
  assertTrue(my.implies(your));
  my.setDbName("");
  assertTrue(my.implies(your));
  my.setAction(AccessConstants.ACTION_ALL);
  assertTrue(my.implies(your));
  my.setTableName("");
  assertTrue(my.implies(your));
  my.setDbName("");
  assertTrue(my.implies(your));
  String[][] actionMap=new String[][]{{AccessConstants.ALL,AccessConstants.ALL},{AccessConstants.ALL,AccessConstants.ACTION_ALL},{AccessConstants.ACTION_ALL,AccessConstants.ALL},{AccessConstants.ACTION_ALL,AccessConstants.ACTION_ALL}};
  for (int actions=0; actions < actionMap.length; actions++) {
    my=new MSentryPrivilege();
    your=new MSentryPrivilege();
    my.setServerName("server1");
    my.setAction(actionMap[actions][0]);
    your.setServerName("server1");
    your.setAction(actionMap[actions][1]);
    my.setURI("hdfs://namenode:9000/path");
    your.setURI("hdfs://namenode:9000/path");
    assertTrue(my.implies(your));
    my.setURI("hdfs://namenode:9000/path");
    your.setURI("hdfs://namenode:9000/path/to/some/dir");
    assertTrue(my.implies(your));
    my.setURI("file:///path");
    your.setURI("file:///path");
    assertTrue(my.implies(your));
    my.setURI("file:///path");
    your.setURI("file:///path/to/some/dir");
    assertTrue(my.implies(your));
    my.setURI("");
    your.setURI("file:///path");
    assertTrue(my.implies(your));
  }
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesPrivilegeNegativeWithColumn() throws Exception {
  MSentryPrivilege my=new MSentryPrivilege();
  MSentryPrivilege your=new MSentryPrivilege();
  my.setServerName("server1");
  my.setDbName("db1");
  my.setTableName("tb1");
  my.setColumnName("c1");
  my.setAction(AccessConstants.SELECT);
  your.setServerName("server1");
  your.setDbName("db1");
  your.setTableName("tb1");
  your.setColumnName("c2");
  your.setAction(AccessConstants.SELECT);
  assertFalse(my.implies(your));
  your.setColumnName("");
  assertFalse(my.implies(your));
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImpliesPrivilegeNegative() throws Exception {
  MSentryPrivilege my=new MSentryPrivilege();
  MSentryPrivilege your=new MSentryPrivilege();
  my.setServerName("server1");
  my.setDbName("db1");
  my.setTableName("tb1");
  my.setAction(AccessConstants.SELECT);
  your.setServerName("server1");
  your.setDbName("db1");
  your.setTableName("tb1");
  your.setAction(AccessConstants.INSERT);
  assertFalse(my.implies(your));
  your.setAction(AccessConstants.ALL);
  assertFalse(my.implies(your));
  your.setTableName("tb2");
  assertFalse(my.implies(your));
  your.setTableName("tb1");
  your.setDbName("db2");
  assertFalse(my.implies(your));
  your.setTableName("tb1");
  your.setDbName("db1");
  your.setServerName("server2");
  assertFalse(my.implies(your));
  my=new MSentryPrivilege();
  your=new MSentryPrivilege();
  my.setServerName("server1");
  my.setAction(AccessConstants.ALL);
  your.setServerName("server2");
  your.setAction(AccessConstants.ALL);
  my.setURI("hdfs://namenode:9000/path");
  your.setURI("hdfs://namenode:9000/path/to/../../other");
  assertFalse(my.implies(your));
  my.setURI("file:///path");
  your.setURI("file:///path/to/../../other");
  assertFalse(my.implies(your));
  my.setURI("blah");
  your.setURI("hdfs://namenode:9000/path/to/some/dir");
  assertFalse(my.implies(your));
  my.setURI("hdfs://namenode:9000/path/to/some/dir");
  your.setURI("blah");
  assertFalse(my.implies(your));
  my.setURI("hdfs://namenode:9000/path");
  your.setURI("file:///path/to/some/dir");
  assertFalse(my.implies(your));
  my.setURI("hdfs://namenode:9000/path");
  your.setURI("file://namenode:9000/path/to/some/dir");
  assertFalse(my.implies(your));
  my.setURI("hdfs://namenode1:9000/path");
  your.setURI("hdfs://namenode2:9000/path");
  assertFalse(my.implies(your));
  my.setURI("hdfs://namenode:9000/path");
  your.setURI("hdfs://namenode:9001/path");
  assertFalse(my.implies(your));
  my.setURI("hdfs://namenode:9000/path1");
  your.setURI("hdfs://namenode:9000/path2");
  assertFalse(my.implies(your));
  my.setURI("file:///path1");
  your.setURI("file:///path2");
  assertFalse(my.implies(your));
  your.setServerName("server2");
  my.setURI("hdfs://namenode:9000/path1");
  your.setURI("hdfs://namenode:9000/path1");
  assertFalse(my.implies(your));
  my.setServerName("server1");
  my.setURI("hdfs://namenode:9000/path1");
  your.setServerName("server1");
  your.setURI("");
  assertFalse(my.implies(your));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStore </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRenameTableWithColumn() throws Exception {
  String roleName1="role1", roleName2="role2";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setAction(AccessConstants.SELECT);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c1=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c1.setPrivilegeScope("COLUMN");
  privilege_tbl1_c1.setColumnName("c1");
  privilege_tbl1_c1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c2=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c2.setPrivilegeScope("COLUMN");
  privilege_tbl1_c2.setColumnName("c2");
  privilege_tbl1_c2.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c3=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c3.setPrivilegeScope("COLUMN");
  privilege_tbl1_c3.setColumnName("c3");
  privilege_tbl1_c3.setCreateTime(System.currentTimeMillis());
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c1);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c2);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_tbl1_c3);
  Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(2,privilegeSet.size());
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(1,privilegeSet.size());
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(2,privilegeSet.size());
  for (  TSentryPrivilege privilege : privilegeSet) {
    assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
  }
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(1,privilegeSet.size());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRevokeCheckWithGrantOption() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1","user2"};
  String[] roles={"role0","role1","role2"};
  String[] groups={"group0","group1","group2"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("DATABASE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setAction(AccessConstants.SELECT);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor="g1";
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("TABLE");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setTableName(table);
  privilege2.setAction(AccessConstants.ALL);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[2];
  grantor="g1";
  TSentryPrivilege privilege3=new TSentryPrivilege();
  privilege3.setPrivilegeScope("TABLE");
  privilege3.setServerName(server);
  privilege3.setDbName(db);
  privilege3.setTableName(table);
  privilege3.setAction(AccessConstants.SELECT);
  privilege3.setCreateTime(System.currentTimeMillis());
  privilege3.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege3);
  roleName=roles[2];
  grantor=users[1];
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege3);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[1];
  grantor=users[0];
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege2);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[2];
  grantor=users[0];
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege3);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilege() throws Exception {
  String roleName="test-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-550
 * Use case:
 * GRANT INSERT on TABLE tbl1 to ROLE role1
 * GRANT SELECT on TABLE tbl1 to ROLE role1
 * GRANT ALTER on TABLE tbl1 to ROLE role1
 * GRANT DROP on TABLE tbl1 to ROLE role1
 * RENAME TABLE tbl1 to tbl2
 * After rename tbl1 to tbl2, table name of all role1's privileges should be "tbl2"
 */
@Test public void testRenameTableWithMultiAction() throws Exception {
  String roleName1="role1";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction(AccessConstants.INSERT);
  TSentryPrivilege privilege_tbl1_select=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_select.setAction(AccessConstants.SELECT);
  TSentryPrivilege privilege_tbl1_alter=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_alter.setAction(AccessConstants.ALTER);
  TSentryPrivilege privilege_tbl1_drop=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_drop.setAction(AccessConstants.DROP);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_select);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_alter);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_drop);
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(4,privilegeSet.size());
  for (  TSentryPrivilege privilege : privilegeSet) {
    assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
  }
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSentryTablePrivilegeSome() throws Exception {
  String roleName="test-table-privilege-some";
  String grantor="g1";
  String dbName="db1";
  String table="tb1";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("TABLE","server1","ALL");
  tSentryPrivilege.setDbName(dbName);
  tSentryPrivilege.setTableName(table);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setDb(dbName);
  tSentryAuthorizable.setTable(AccessConstants.SOME);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->db=" + dbName + "->table="+ table+ "->action=all"));
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeColumnPrivilegeDowngradeByDb() throws Exception {
  String roleName="test-column-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeCol1=new TSentryPrivilege();
  privilegeCol1.setPrivilegeScope("COLUMN");
  privilegeCol1.setServerName(server);
  privilegeCol1.setDbName(db);
  privilegeCol1.setTableName(table);
  privilegeCol1.setColumnName(column1);
  privilegeCol1.setAction(AccessConstants.ALL);
  privilegeCol1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeCol2=privilegeCol1.deepCopy();
  ;
  privilegeCol2.setColumnName(column2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeCol2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilegeCol2.setAction(AccessConstants.INSERT);
  privilegeCol2.setPrivilegeScope("DATABASE");
  privilegeCol2.unsetTableName();
  privilegeCol2.unsetColumnName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(column1,mPrivilege.getColumnName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeTablePrivilegeDowngradeByDb() throws Exception {
  String roleName="test-table-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table1="tbl1";
  String table2="tbl2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeTable1=new TSentryPrivilege();
  privilegeTable1.setPrivilegeScope("TABLE");
  privilegeTable1.setServerName(server);
  privilegeTable1.setDbName(db);
  privilegeTable1.setTableName(table1);
  privilegeTable1.setAction(AccessConstants.ALL);
  privilegeTable1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeTable2=privilegeTable1.deepCopy();
  ;
  privilegeTable2.setTableName(table2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeTable2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getTableName().equals(table1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getTableName().equals(table2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected table name: " + mPrivilege.getTableName());
    }
  }
  privilegeTable2.setAction(AccessConstants.INSERT);
  privilegeTable2.setPrivilegeScope("DATABASE");
  privilegeTable2.unsetTableName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table1,mPrivilege.getTableName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantCheckWithColumn() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1"};
  String[] roles={"role0","role1"};
  String[] groups={"group0","group1"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("TABLE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setTableName(table);
  privilege1.setAction(AccessConstants.SELECT);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor=users[0];
  String column="c1";
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("COLUMN");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setTableName(table);
  privilege2.setColumnName(column);
  privilege2.setAction(AccessConstants.SELECT);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[0];
  grantor=users[1];
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege1);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[1];
  grantor=users[0];
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege2);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create roles and assign privileges for same table rename the privileges for
 * the table and verify the new privileges
 * @throws Exception
 */
@Test public void testRenameTable() throws Exception {
  String roleName1="role1", roleName2="role2", roleName3="role3";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  sentryStore.createSentryRole(roleName3);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction(AccessConstants.INSERT);
  TSentryPrivilege privilege_tbl1_select=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_select.setAction(AccessConstants.SELECT);
  TSentryPrivilege privilege_tbl1_all=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_all.setAction(AccessConstants.ALL);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_tbl1_select);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName3,privilege_tbl1_all);
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  for (  String roleName : Sets.newHashSet(roleName1,roleName2,roleName3)) {
    Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName);
    assertEquals(1,privilegeSet.size());
    for (    TSentryPrivilege privilege : privilegeSet) {
      assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
    }
  }
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSentryColumnPrivilegeSome() throws Exception {
  String roleName="test-column-privilege-some";
  String grantor="g1";
  String dbName="db1";
  String table="tb1";
  String column="col1";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("TABLE","server1","ALL");
  tSentryPrivilege.setDbName(dbName);
  tSentryPrivilege.setTableName(table);
  tSentryPrivilege.setColumnName(column);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setDb(dbName);
  tSentryAuthorizable.setTable(table);
  tSentryAuthorizable.setColumn(AccessConstants.SOME);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->db=" + dbName + "->table="+ table+ "->column="+ column+ "->action=all"));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testURI() throws Exception {
  String roleName="test-dup-role";
  String grantor="g1";
  String uri="file:///var/folders/dt/9zm44z9s6bjfxbrm4v36lzdc0000gp/T/1401860678102-0/data/kv1.dat";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("URI","server1","ALL");
  tSentryPrivilege.setURI(uri);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setUri(uri);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->uri=" + uri + "->action=all"));
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantCheckWithGrantOption() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1","user2","user3","user4"};
  String[] roles={"role0","role1","role2","role3","role4"};
  String[] groups={"group0","group1","group2","group3","group4"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("DATABASE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setAction(AccessConstants.ALL);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor=users[0];
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("DATABASE");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setAction(AccessConstants.SELECT);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[2];
  grantor=users[0];
  TSentryPrivilege privilege3=new TSentryPrivilege();
  privilege3.setPrivilegeScope("TABLE");
  privilege3.setServerName(server);
  privilege3.setDbName(db);
  privilege3.setTableName(table);
  privilege3.setAction(AccessConstants.ALL);
  privilege3.setCreateTime(System.currentTimeMillis());
  privilege3.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege3);
  roleName=roles[3];
  grantor=users[1];
  TSentryPrivilege privilege4=new TSentryPrivilege();
  privilege4.setPrivilegeScope("DATABASE");
  privilege4.setServerName(server);
  privilege4.setDbName(db);
  privilege4.setAction(AccessConstants.INSERT);
  privilege4.setCreateTime(System.currentTimeMillis());
  privilege4.setGrantOption(TSentryGrantOption.FALSE);
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege4);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[4];
  grantor=users[2];
  TSentryPrivilege privilege5=new TSentryPrivilege();
  privilege5.setPrivilegeScope("TABLE");
  privilege5.setServerName(server);
  privilege5.setDbName(db);
  privilege5.setTableName(table);
  privilege5.setAction(AccessConstants.INSERT);
  privilege5.setCreateTime(System.currentTimeMillis());
  privilege5.setGrantOption(TSentryGrantOption.FALSE);
  isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege5);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
}

</code></pre>

<br>
<pre class="type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-74 and SENTRY-552
 */
@Test public void testGrantRevokePrivilegeWithColumn() throws Exception {
  String roleName="test-col-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("COLUMN");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setColumnName(column1);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  privilege.setColumnName(column2);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.INSERT);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  assertEquals(column1,Iterables.get(privileges,0).getColumnName());
  assertEquals(AccessConstants.SELECT,Iterables.get(privileges,0).getAction());
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 5,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),0,privileges.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStoreImportExport </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImportExportPolicy6() throws Exception {
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
  sentryGroupRolesMap1.put("group2",Sets.newHashSet("role2"));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,false);
  sentryStore.dropSentryRole("role2");
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1"));
  verifyGroups(groupsMap,Sets.newHashSet("group1","group2"));
  assertTrue(privilegesList.isEmpty());
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  assertTrue(actualRolePrivilegesMap.isEmpty());
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testImportExportPolicy5() throws Exception {
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,false);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2"));
  verifyGroups(groupsMap,Sets.newHashSet("group1"));
  assertTrue(privilegesList.isEmpty());
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1","role2"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  assertTrue(actualRolePrivilegesMap.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceClientPool </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testConnectionWithMultipleRetries() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      List<Future<Boolean>> tasks=new ArrayList<Future<Boolean>>();
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      ExecutorService executorService=Executors.newFixedThreadPool(20);
      Callable<Boolean> func=new Callable<Boolean>(){
        public Boolean call() throws Exception {
          return Subject.doAs(clientSubject,new PrivilegedExceptionAction<Boolean>(){
            @Override public Boolean run() throws Exception {
              try {
                client.listRoles(ADMIN_USER);
                return true;
              }
 catch (              SentryUserException sue) {
                return false;
              }
            }
          }
);
        }
      }
;
      for (int i=0; i < 30; i++) {
        FutureTask<Boolean> task=new FutureTask<Boolean>(func);
        tasks.add(task);
        executorService.submit(task);
      }
      for (      Future<Boolean> task : tasks) {
        Boolean result=task.get();
        assertTrue("Some tasks are failed.",result);
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceFailureCase </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClientServerConnectionFailure() throws Exception {
  try {
    connectToSentryService();
    Assert.fail("Failed to receive Exception");
  }
 catch (  PrivilegedActionException e) {
    LOGGER.info("Excepted exception",e);
    Exception cause=e.getException();
    if (cause == null) {
      throw e;
    }
    String msg="Exception message: " + cause.getMessage() + " to contain "+ PEER_CALLBACK_FAILURE;
    Assert.assertTrue(msg,Strings.nullToEmpty(cause.getMessage()).contains(PEER_CALLBACK_FAILURE));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceIntegration </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String server="server1";
      String db="testDB";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantDatabasePrivilege(requestorUserName,roleName,server,db,AccessConstants.ALL);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 1);
      client.revokeDatabasePrivilege(requestorUserName,roleName,server,db,AccessConstants.ALL);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGranRevokePrivilegeOnColumnForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table2","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table2","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db2","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db2","table2","col1","ALL");
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table1","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db2","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db2","table2","col1","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertEquals("Privilege not assigned to role1 !!",6,listPrivilegesByRoleName.size());
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertEquals("Privilege not assigned to role2 !!",6,listPrivilegesByRoleName.size());
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 5);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 6);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 4);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 5);
      client.revokeDatabasePrivilege(requestorUserName,roleName1,"server","db1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 2);
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db2","table1","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db2","table2","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col2","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db2","table1","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db2","table2","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGranRevokePrivilegeOnTableForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertEquals("Privilege not assigned to role1 !!",4,listPrivilegesByRoleName.size());
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertEquals("Privilege not assigned to role2 !!",4,listPrivilegesByRoleName.size());
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 4);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUriWithEquals() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String server="server1";
      String uri="file://u/w/h/t/partition=value/";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantURIPrivilege(requestorUserName,roleName,server,uri);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 1);
      client.revokeURIPrivilege(requestorUserName,roleName,server,uri);
      privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 0);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String groupName="group1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantRoleToGroup(requestorUserName,groupName,roleName);
      Set<TSentryRole> groupRoles=client.listRolesByGroupName(requestorUserName,groupName);
      assertTrue(groupRoles.size() == 1);
      for (      TSentryRole role : groupRoles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        TSentryGroup group : role.getGroups()) {
          assertTrue(group.getGroupName(),group.getGroupName().equalsIgnoreCase(groupName));
        }
      }
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testMultipleRolesSamePrivilege() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db","table","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not assigned to role1 !!",listPrivilegesByRoleName.size() == 1);
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db","table","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not assigned to role2 !!",listPrivilegesByRoleName.size() == 1);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropShowRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
      }
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testGranRevokePrivilegeOnServerForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantServerPrivilege(requestorUserName,roleName1,"server",false);
      Set<TSentryPrivilege> listPrivs=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege should be all:",listPrivs.iterator().next().getAction().equals("*"));
      client.revokeServerPrivilege(requestorUserName,roleName1,"server",false);
      listPrivs=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivs.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceWithInvalidMsgSize </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the case when the message size is larger than the server's thrift max message size.
 */
@Test public void testServerWithSmallMaxMsgSize() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Configuration confWithSmallMaxMsgSize=new Configuration(conf);
      confWithSmallMaxMsgSize.setLong(ServiceConstants.ServerConfig.SENTRY_POLICY_SERVER_THRIFT_MAX_MESSAGE_SIZE,50);
      stopSentryService();
      server=new SentryServiceFactory().create(confWithSmallMaxMsgSize);
      startSentryService();
      setLocalGroupMapping(ADMIN_USER,REQUESTER_USER_GROUP_NAMES);
      writePolicyFile();
      client.listRoles(ADMIN_USER);
      client.createRole(ADMIN_USER,ROLE_NAME);
      boolean exceptionThrown=false;
      try {
        client.grantServerPrivilege(ADMIN_USER,ROLE_NAME,"server",false);
      }
 catch (      SentryUserException e) {
        exceptionThrown=true;
        Assert.assertTrue(e.getMessage().contains("org.apache.thrift.transport.TTransportException"));
      }
 finally {
        Assert.assertEquals(true,exceptionThrown);
      }
      Set<TSentryRole> roles=client.listRoles(ADMIN_USER);
      Assert.assertTrue(roles.size() == 1);
      Assert.assertEquals(ROLE_NAME,roles.iterator().next().getRoleName());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the case when the message size is larger than the client's thrift max message size.
 */
@Test public void testClientWithSmallMaxMsgSize() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Configuration confWithSmallMaxMsgSize=new Configuration(conf);
      confWithSmallMaxMsgSize.setLong(ServiceConstants.ClientConfig.SENTRY_POLICY_CLIENT_THRIFT_MAX_MESSAGE_SIZE,20);
      SentryPolicyServiceClient clientWithSmallMaxMsgSize=SentryServiceClientFactory.create(confWithSmallMaxMsgSize);
      setLocalGroupMapping(ADMIN_USER,REQUESTER_USER_GROUP_NAMES);
      writePolicyFile();
      boolean exceptionThrown=false;
      try {
        clientWithSmallMaxMsgSize.listRoles(ADMIN_USER);
      }
 catch (      SentryUserException e) {
        exceptionThrown=true;
        Assert.assertTrue(e.getMessage().contains("Thrift exception occurred"));
        Assert.assertTrue(e.getCause().getMessage().contains("Length exceeded max allowed"));
      }
 finally {
        Assert.assertEquals(true,exceptionThrown);
        clientWithSmallMaxMsgSize.close();
      }
      client.dropRoleIfExists(ADMIN_USER,ROLE_NAME);
      client.listRoles(ADMIN_USER);
      client.createRole(ADMIN_USER,ROLE_NAME);
      client.listRoles(ADMIN_USER);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryWebServerWithKerberos </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPingWithoutSubject() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  try {
    new AuthenticatedURL(new KerberosAuthenticator()).openConnection(url,new AuthenticatedURL.Token());
    fail("Here should fail.");
  }
 catch (  Exception e) {
    boolean isExpectError=e.getMessage().contains("No valid credentials provided");
    Assert.assertTrue("Here should fail by 'No valid credentials provided'," + " but the exception is:" + e,isExpectError);
  }
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPingUsingHttpURLConnection() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  HttpURLConnection conn=(HttpURLConnection)url.openConnection();
  Assert.assertEquals(HttpURLConnection.HTTP_UNAUTHORIZED,conn.getResponseCode());
  String errorMessage=IOUtils.toString(conn.getErrorStream());
  Assert.assertTrue(errorMessage.contains("Authentication required"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.tools.TestSentryShellHive </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilegeWithLongOption() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--list_privilege","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> privilegeStrs=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of privileges",6,privilegeStrs.size());
      assertTrue(privilegeStrs.contains("server=server1->action=*"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->action=select"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true"));
      assertTrue(privilegeStrs.contains("server=server1->uri=hdfs://path/testuri->action=*"));
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",5,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",4,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",3,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",2,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",1,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",0,privileges.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilegeWithShortOption() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lp","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> privilegeStrs=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of privileges",6,privilegeStrs.size());
      assertTrue(privilegeStrs.contains("server=server1->action=*"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->action=select"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true"));
      assertTrue(privilegeStrs.contains("server=server1->uri=hdfs://path/testuri->action=*"));
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",5,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",4,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",3,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",2,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",1,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",0,privileges.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleForGroup() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"-arg","-r",TEST_ROLE_NAME_1,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-arg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--add_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lr","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-g","testGroup2","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",1,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-g","testGroup3","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",1,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--delete_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryRole> roles=client.listRolesByGroupName(requestorName,"testGroup1");
      assertEquals("Incorrect number of roles",0,roles.size());
      roles=client.listRolesByGroupName(requestorName,"testGroup2");
      assertEquals("Incorrect number of roles",0,roles.size());
      roles=client.listRolesByGroupName(requestorName,"testGroup3");
      assertEquals("Incorrect number of roles",0,roles.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--create_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lr","-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--drop_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryRole> roles=client.listRoles(requestorName);
      assertEquals("Incorrect number of roles",0,roles.size());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestColumnEndToEnd </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCreateTableAsSelect() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE database " + DB1);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE t1 (c1 string, c2 string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("CREATE ROLE user_role2");
  statement.execute("CREATE ROLE user_role3");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE user_role1");
  statement.execute("GRANT SELECT (c1, c2) ON TABLE t1 TO ROLE user_role2");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role3");
  statement.execute("GRANT CREATE ON DATABASE " + DB1 + " TO ROLE user_role1");
  statement.execute("GRANT CREATE ON DATABASE " + DB1 + " TO ROLE user_role2");
  statement.execute("GRANT CREATE ON DATABASE " + DB1 + " TO ROLE user_role3");
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE user_role2 TO GROUP " + USERGROUP2);
  statement.execute("GRANT ROLE user_role3 TO GROUP " + USERGROUP3);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE t1_1 AS SELECT c1 FROM t1");
  try {
    statement.execute("CREATE TABLE t1_2 AS SELECT * FROM t1");
    assertTrue("no permission on table t1!!",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE t2_1 AS SELECT c1 FROM t1");
  statement.execute("CREATE TABLE t2_2 AS SELECT * FROM t1");
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE t3_1 AS SELECT c1 FROM t1");
  statement.execute("CREATE TABLE t3_2 AS SELECT * FROM t1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNegative() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE t1 (c1 string, c2 string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("CREATE ROLE user_role2");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE user_role1");
  statement.execute("GRANT SELECT (c1,c2) ON TABLE t1 TO ROLE user_role2");
  try {
    statement.execute("GRANT INSERT (c2) ON TABLE t1 TO ROLE user_role2");
    assertTrue("Sentry should not support privilege: Insert on Column",false);
  }
 catch (  Exception e) {
    assertTrue("The error should be 'Sentry does not support privilege: Insert on Column'",e.getMessage().toUpperCase().contains("SENTRY DOES NOT SUPPORT PRIVILEGE: INSERT ON COLUMN"));
  }
  try {
    statement.execute("GRANT ALL (c2) ON TABLE t1 TO ROLE user_role2");
    assertTrue("Sentry should not support privilege: ALL on Column",false);
  }
 catch (  Exception e) {
    assertTrue("The error should be 'Sentry does not support privilege: All on Column'",e.getMessage().toUpperCase().contains("SENTRY DOES NOT SUPPORT PRIVILEGE: ALL ON COLUMN"));
  }
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE user_role2 TO GROUP " + USERGROUP2);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT c1,c2 FROM t1");
    assertTrue("User with privilege on one column is able to access other column!!",false);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.execute("SELECT count(c1) FROM t1");
  try {
    statement.execute("SELECT * FROM t1");
    assertTrue("Select * should fail - only SELECT allowed on t1.c1!!",false);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT count(*) FROM t1");
    assertTrue("Select count(*) should fail - only SELECT allowed on t1.c1!!",false);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("SELECT count(1) FROM t1");
    assertTrue("Select count(1) should fail - only SELECT allowed on t1.c1!!",false);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT count(c1) FROM t1");
  statement.execute("SELECT * FROM t1");
  try {
    statement.execute("SELECT count(*) FROM t1");
    assertTrue("Select count(*) works only with table level privileges - User has select on all columns!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT count(1) FROM t1");
    assertTrue("Select count(1) works only with table level privileges - User has select on all columns!!",false);
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDescribeTbl() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE IF NOT EXISTS t1 (c1 string, c2 string)");
  statement.execute("CREATE TABLE t2 (c1 string, c2 string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE user_role1");
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  ResultSet rs=statement.executeQuery("DESCRIBE t1");
  assertTrue(rs.next());
  assertEquals("c1",rs.getString(1));
  assertEquals("string",rs.getString(2));
  assertTrue(rs.next());
  assertEquals("c2",rs.getString(1));
  assertEquals("string",rs.getString(2));
  statement.executeQuery("DESCRIBE t1 c1");
  statement.executeQuery("DESCRIBE t1 c2");
  try {
    statement.executeQuery("DESCRIBE t2");
    fail("Expected DESCRIBE to fail on t2");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE FORMATTED t1");
    fail("Expected DESCRIBE FORMATTED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE EXTENDED t1");
    fail("Expected DESCRIBE EXTENDED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP TABLE t1");
  statement.execute("DROP TABLE t2");
  statement.execute("DROP ROLE user_role1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestConcurrentClients </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test when concurrent HS2 clients talking to server,
 * Privileges are correctly created and updated.
 * @throws Exception
 */
@Test public void testConccurentHS2Client() throws Exception {
  ExecutorService executor=Executors.newFixedThreadPool(NUM_OF_THREADS);
  final TestRuntimeState state=new TestRuntimeState();
  for (int i=0; i < NUM_OF_TASKS; i++) {
    executor.execute(new Runnable(){
      @Override public void run(){
        LOGGER.info("Starting tests: create role, show role, create db and tbl, and create partitions");
        if (state.failed)         return;
        try {
          Long startTime=System.currentTimeMillis();
          Long elapsedTime=0L;
          while (Long.compare(elapsedTime,HS2_CLIENT_TEST_DURATION_MS) <= 0) {
            String randStr=randomString(5);
            String test_role="test_role_" + randStr;
            String test_db="test_db_" + randStr;
            String test_tb="test_tb_" + randStr;
            LOGGER.info("Start to test sentry with hs2 client with role " + test_role);
            adminCreateRole(test_role);
            adminShowRole(test_role);
            createDbTb(ADMIN1,test_db,test_tb);
            adminGrant(test_db,test_tb,test_role,USERGROUP1);
            createPartition(USER1_1,test_db,test_tb);
            adminCleanUp(test_db,test_role);
            elapsedTime=System.currentTimeMillis() - startTime;
            LOGGER.info("elapsedTime = " + elapsedTime);
          }
          state.setNumSuccess();
        }
 catch (        Exception e) {
          LOGGER.error("Exception: " + e);
          state.setFirstException(e);
        }
      }
    }
);
  }
  executor.shutdown();
  while (!executor.isTerminated()) {
    Thread.sleep(1000);
  }
  Throwable ex=state.getFirstException();
  assertFalse(ex == null ? "Test failed" : ex.toString(),state.failed);
  assertEquals(NUM_OF_TASKS,state.getNumSuccess());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test when concurrent sentry clients talking to sentry server, threads data are synchronized
 * @throws Exception
 */
@Test public void testConcurrentSentryClient() throws Exception {
  final String HIVE_KEYTAB_PATH=System.getProperty("sentry.e2etest.hive.policyOwnerKeytab");
  final SentryPolicyServiceClient client=getSentryClient("hive",HIVE_KEYTAB_PATH);
  ExecutorService executor=Executors.newFixedThreadPool(NUM_OF_THREADS);
  final TestRuntimeState state=new TestRuntimeState();
  for (int i=0; i < NUM_OF_TASKS; i++) {
    LOGGER.info("Start to test sentry client with task id [" + i + "]");
    executor.execute(new Runnable(){
      @Override public void run(){
        if (state.failed) {
          LOGGER.error("found one failed state, abort test from here.");
          return;
        }
        try {
          String randStr=randomString(5);
          String test_role="test_role_" + randStr;
          LOGGER.info("Start to test role: " + test_role);
          Long startTime=System.currentTimeMillis();
          Long elapsedTime=0L;
          while (Long.compare(elapsedTime,SENTRY_CLIENT_TEST_DURATION_MS) <= 0) {
            LOGGER.info("Test role " + test_role + " runs "+ elapsedTime+ " ms.");
            client.createRole(ADMIN1,test_role);
            client.listRoles(ADMIN1);
            client.grantServerPrivilege(ADMIN1,test_role,"server1",false);
            client.listAllPrivilegesByRoleName(ADMIN1,test_role);
            client.dropRole(ADMIN1,test_role);
            elapsedTime=System.currentTimeMillis() - startTime;
          }
          state.setNumSuccess();
        }
 catch (        Exception e) {
          LOGGER.error("Sentry Client Testing Exception: ",e);
          state.setFirstException(e);
        }
      }
    }
);
  }
  executor.shutdown();
  while (!executor.isTerminated()) {
    Thread.sleep(1000);
  }
  Throwable ex=state.getFirstException();
  assertFalse(ex == null ? "Test failed" : ex.toString(),state.failed);
  assertEquals(NUM_OF_TASKS,state.getNumSuccess());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDatabaseProvider </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void serverActions() throws Exception {
  String[] dbs={DB1,DB2};
  String tbl=TBL1;
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE server_all");
  statement.execute("CREATE ROLE server_select");
  statement.execute("CREATE ROLE server_insert");
  statement.execute("GRANT ALL ON SERVER server1 to ROLE server_all");
  statement.execute("GRANT SELECT ON SERVER server1 to ROLE server_select");
  statement.execute("GRANT INSERT ON SERVER server1 to ROLE server_insert");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE server_select");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE server_insert");
  statement.execute("GRANT ROLE server_all to GROUP " + ADMINGROUP);
  statement.execute("GRANT ROLE server_select to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE server_insert to GROUP " + USERGROUP2);
  for (  String db : dbs) {
    statement.execute("CREATE DATABASE IF NOT EXISTS " + db);
    statement.execute("CREATE TABLE IF NOT EXISTS " + db + "."+ tbl+ "(a String)");
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  for (  String db : dbs) {
    statement.execute("SELECT * FROM " + db + "."+ tbl);
    try {
      statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ db+ "."+ tbl);
      assertTrue("INSERT should not be capable here:",true);
    }
 catch (    SQLException e) {
    }
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  for (  String db : dbs) {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ db+ "."+ tbl);
    try {
      statement.execute("SELECT * FROM " + db + "."+ tbl);
    }
 catch (    SQLException e) {
    }
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE SELECT ON SERVER server1 from ROLE server_select");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + dbs[0] + "."+ tbl);
    assertTrue("Revoke Select on server Failed",false);
  }
 catch (  SQLException e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke insert on table after:
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeINSERTOnTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE INSERT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testGrantINSERTonDb() throws Exception {
  File dataFile=doSetupForGrantDbTests();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("GRANT INSERT ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t2");
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("only SELECT allowed on t1!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    assertTrue("only INSERT allowed on t2!!",false);
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-10 type-19 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON URI uriName: Needs Hive patch
 * @throws Exception
 */
@Ignore @Test public void testShowPrivilegesByRoleOnUri() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON URI 'file:///tmp/file.txt'");
  assertTrue("Expecting SQL Exception",false);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke select on table after:
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeSELECTOnTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE SELECT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke all on table after:
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeAllOnTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE ALL ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * SENTRY-299
 * 1. Create 2 Roles (user_role & user_role2)
 * 2. Create a Table t1
 * 3. grant ALL on t1 to user_role
 * 4. grant INSERT on t1 to user_role2
 * 5. Revoke INSERT on t1 from user_role
 * - This would imply user_role can still SELECT
 * - But user_role should NOT be allowed to LOAD
 * 6. Ensure Presense of another role will still enforce the revoke
 * @throws Exception
 */
@Test public void testRevokeFailAnotherRoleExist() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("CREATE ROLE user_role2");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role2");
  statement.execute("GRANT ALL ON URI \"file://" + dataFile.getPath() + "\" TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role2");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role2");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE user_role2 TO GROUP " + USERGROUP2);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE INSERT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT Should Not be allowed since we Revoked INSERT privileges on the table !!",false);
  }
 catch (  Exception e) {
  }
 finally {
    statement.close();
    connection.close();
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * SENTRY-302
 * 1. Create Role user_role
 * 2. Create a Table t1
 * 3. grant ALL on t1 to user_role
 * 4. grant INSERT on t1 to user_role
 * 5. Revoke INSERT on t1 from user_role
 * - This would imply user_role can still SELECT
 * - But user_role should NOT be allowed to LOAD
 * 6. Ensure INSERT is revoked on table
 * @throws Exception
 */
@Test public void testRevokeFailMultipleGrantsExist() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE INSERT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT Should Not be allowed since we Revoked INSERT privileges on the table !!",false);
  }
 catch (  Exception e) {
  }
 finally {
    statement.close();
    connection.close();
  }
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRevokeDbALLAfterGrantTable() throws Exception {
  doSetup();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("REVOKE ALL ON DATABASE " + DB1 + " from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM t1");
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    assertTrue("SELECT should not be allowed after revoke on parent!!",false);
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke all on database after:
 * - grant all on db
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeAllOnDb() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),3);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE ALL ON DATABASE " + DB1 + " from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. Show role grant works for non-admin users when the user belongs to the requested group
 * 4.2. Show role grant FAILS for non-admin users when the user doesn't belongs to the requested group
 */
@Test public void testShowRolesByGroupNonAdmin() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP2);
  statement.execute("GRANT ROLE role1 to GROUP " + ADMINGROUP);
  statement.execute("GRANT ROLE role2 to GROUP " + ADMINGROUP);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + ADMINGROUP,SentryAccessDeniedException.class.getSimpleName());
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP2);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role2"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-303 and SENTRY-543.
 */
@Test public void testGrantRevokeSELECTonDb() throws Exception {
  File dataFile=doSetupForGrantDbTests();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("GRANT SELECT ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("SELECT * FROM " + DB1 + ".t2");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("only SELECT allowed on t1!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t2");
    assertTrue("only SELECT allowed on t2!!",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("REVOKE SELECT ON DATABASE " + DB1 + " FROM ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    fail("SELECT should have been revoked from t1");
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    fail("SELECT should have been revoked from t2");
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  String testRole0="role1", testRole1="role2";
  statement.execute("CREATE ROLE " + testRole0);
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("GRANT ROLE " + testRole0 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ USERGROUP1);
  statement.execute("SET ROLE " + testRole0);
  try {
    statement.execute("SET ROLE " + testRole1);
    fail("User " + ADMIN1 + " shouldn't be able to set "+ testRole1);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SET ROLE " + testRole1);
  try {
    statement.execute("SET ROLE " + testRole0);
    fail("User " + USER1_1 + " shouldn't be able to set "+ testRole0);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Regression test for SENTRY-617.
 */
@Test public void testGrantRevokeRoleToGroups() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string,c2 string,c3 string,c4 string,c5 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1 + ", GROUP "+ USERGROUP2+ ", GROUP "+ USERGROUP3);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE ROLE user_role FROM GROUP " + USERGROUP1 + ", GROUP "+ USERGROUP2);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("after revoking, user1 has no permission to access table t1",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("after revoking, user1 has no permission to access table t1",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRevokeServerAfterGrantTable() throws Exception {
  doSetup();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE ALL ON SERVER server1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM t1");
    assertTrue("SELECT should not be allowed after revoke on parent!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    assertTrue("SELECT should not be allowed after revoke on parent!!",false);
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,0);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke all on server after:
 * - grant all on db
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 * - grant all on URI
 * - grant select on URI
 * - grant insert on URI
 */
@Test public void testRevokeAllOnServer() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT SELECT ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT INSERT ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),3);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE ALL ON SERVER server1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),0);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbColumnLevelMetaDataOps </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test if add a new column and grant privilege,
 * user1 needs explicit grant on new column to access this column
 */
@Test public void testShowNewColumn() throws Exception {
  String colName="newcol";
  establishSession(ADMIN1);
  statement.execute("USE " + TEST_COL_METADATA_OPS_DB);
  statement.execute("ALTER TABLE " + TEST_COL_METADATA_OPS_TB + " ADD COLUMNS ("+ colName+ " STRING)");
  String query="SHOW COLUMNS IN " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  establishSession(USER1_1);
  ResultSet rs=executeQueryWithLog(query);
  boolean found=false;
  while (rs.next() && !found) {
    String val=rs.getString("field");
    LOGGER.info("found " + val);
    if (val.equalsIgnoreCase(colName)) {
      found=true;
    }
  }
  assertTrue("Should not have implicit access to new column " + colName,!found);
  rs.close();
  establishSession(ADMIN1);
  statement.execute("GRANT SELECT(" + colName + ") ON TABLE "+ TEST_COL_METADATA_OPS_TB+ " TO ROLE "+ TEST_COL_METADATA_OPS_ROLE);
  establishSession(USER1_1);
  rs=executeQueryWithLog(query);
  found=false;
  while (rs.next() && !found) {
    String val=rs.getString("field");
    LOGGER.info("found " + val);
    if (val.equalsIgnoreCase(colName)) {
      found=true;
    }
  }
  assertTrue("Should not have implicit access to new column " + colName,!found);
  rs.close();
  validateSemanticException(query,USER2_1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbConnections </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Currently the hive binding opens a new server connection for each
 * statement. This test verifies that the client connection is closed properly
 * at the end. Test Queries, DDLs, Auth DDLs and metadata filtering (eg show
 * tables/databases)
 * @throws Exception
 */
@Test public void testClientConnections() throws Exception {
  String roleName="connectionTest";
  long preConnectionClientId;
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("CREATE DATABASE DB_1");
  statement.execute("USE DB_1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("CREATE TABLE t1 (c1 string)");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("SELECT * FROM t1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.executeQuery("show tables");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("DROP TABLE t1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.execute("CREATE ROLE " + roleName);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  context.assertSentryException(statement,"CREATE ROLE " + roleName,SentryAlreadyExistsException.class.getSimpleName());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  statement.execute("DROP ROLE " + roleName);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.executeQuery("show tables");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  statement.close();
  connection.close();
  assertEquals(0,getSentrySrv().getNumActiveClients());
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  context.assertAuthzException(statement,"USE DB_1");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  context.assertSentryException(statement,"CREATE ROLE " + roleName,SentryAccessDeniedException.class.getSimpleName());
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  preConnectionClientId=getSentrySrv().getTotalClients();
  statement.executeQuery("show databases");
  assertTrue(preConnectionClientId < getSentrySrv().getTotalClients());
  assertEquals(0,getSentrySrv().getNumActiveClients());
  statement.close();
  connection.close();
  assertEquals(0,getSentrySrv().getNumActiveClients());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbEndToEnd </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUPrivileges() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("CREATE ROLE uri_role");
  statement.execute("GRANT SELECT ON URI 'file://" + dataDir.getPath() + "' TO ROLE uri_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE uri_role TO GROUP " + USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE uri_role");
  assertTrue(resultSet.next());
  assertEquals("file://" + dataDir.getPath(),resultSet.getString(1));
  resultSet.close();
  resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertTrue(resultSet.next());
  assertEquals("default",resultSet.getString(1));
  assertEquals("t1",resultSet.getString(2));
  resultSet.close();
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegration </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testEnd2End() throws Throwable {
  tmpHDFSDir=new Path("/tmp/external");
  dbNames=new String[]{"db1"};
  roles=new String[]{"admin_role","db_role","tab_role","p1_admin"};
  admin="hive";
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant role admin_role to group hive");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("create table p1 (s string) partitioned by (month int, day int)");
  stmt.execute("alter table p1 add partition (month=1, day=1)");
  stmt.execute("alter table p1 add partition (month=1, day=2)");
  stmt.execute("alter table p1 add partition (month=2, day=1)");
  stmt.execute("alter table p1 add partition (month=2, day=2)");
  stmt.execute("create database db5");
  stmt.execute("create role db_role");
  stmt.execute("create role tab_role");
  stmt.execute("grant role db_role to group hbase");
  stmt.execute("grant role tab_role to group flume");
  stmt.execute("create table db5.p2(id int)");
  stmt.execute("create role p1_admin");
  stmt.execute("grant role p1_admin to group hbase");
  verifyOnAllSubDirs("/user/hive/warehouse",null,"hbase",false);
  verifyOnAllSubDirs("/user/hive/warehouse/p1",null,"hbase",false);
  stmt.execute("grant all on database db5 to role db_role");
  stmt.execute("use db5");
  stmt.execute("grant all on table p2 to role tab_role");
  stmt.execute("use default");
  verifyOnAllSubDirs("/user/hive/warehouse/db5.db",FsAction.ALL,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/db5.db/p2",FsAction.ALL,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/db5.db/p2",FsAction.ALL,"flume",true);
  verifyOnPath("/user/hive/warehouse/db5.db",FsAction.ALL,"flume",false);
  loadData(stmt);
  verifyHDFSandMR(stmt);
  verifyOnPath("/user/hive/warehouse",null,"hbase",false);
  verifyOnAllSubDirs("/user/hive/warehouse/p1",FsAction.READ_EXECUTE,"hbase",true);
  adminUgi.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      AclStatus existing=miniDFS.getFileSystem().getAclStatus(new Path("/user/hive/warehouse/p1"));
      ArrayList<AclEntry> newEntries=new ArrayList<AclEntry>(existing.getEntries());
      newEntries.add(AclEntry.parseAclEntry("user::---",true));
      newEntries.add(AclEntry.parseAclEntry("group:bla:rwx",true));
      newEntries.add(AclEntry.parseAclEntry("other::---",true));
      miniDFS.getFileSystem().setAcl(new Path("/user/hive/warehouse/p1"),newEntries);
      return null;
    }
  }
);
  stmt.execute("revoke select on table p1 from role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/p1",null,"hbase",false);
  stmt.execute("grant select on database default to role p1_admin");
  verifyOnPath("/user/hive/warehouse",FsAction.READ_EXECUTE,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/p1",FsAction.READ_EXECUTE,"hbase",true);
  stmt.execute("revoke select on database default from role p1_admin");
  verifyOnPath("/user/hive/warehouse",null,"hbase",false);
  verifyOnAllSubDirs("/user/hive/warehouse/p1",null,"hbase",false);
  stmt.execute("grant all on table p1 to role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/p1",FsAction.ALL,"hbase",true);
  stmt.execute("revoke select on table p1 from role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/p1",FsAction.WRITE_EXECUTE,"hbase",true);
  stmt.execute("alter table p1 rename to p3");
  verifyOnAllSubDirs("/user/hive/warehouse/p3",FsAction.WRITE_EXECUTE,"hbase",true);
  stmt.execute("alter table p3 partition (month=1, day=1) rename to partition (month=1, day=3)");
  verifyOnAllSubDirs("/user/hive/warehouse/p3",FsAction.WRITE_EXECUTE,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/p3/month=1/day=3",FsAction.WRITE_EXECUTE,"hbase",true);
  stmt.execute("create database extdb");
  stmt.execute("grant all on database ExtDb to role p1_admin");
  writeToPath("/tmp/external/ext100",5,"foo","bar");
  writeToPath("/tmp/external/ext101",5,"foo","bar");
  stmt.execute("use extdb");
  stmt.execute("create table ext100 (s string) location \'/tmp/external/ext100\'");
  verifyQuery(stmt,"ext100",5);
  verifyOnAllSubDirs("/tmp/external/ext100",FsAction.ALL,"hbase",true);
  stmt.execute("use default");
  stmt.execute("use EXTDB");
  stmt.execute("create table ext101 (s string) location \'/tmp/external/ext101\'");
  verifyQuery(stmt,"ext101",5);
  verifyOnAllSubDirs("/tmp/external/ext101",FsAction.ALL,"hbase",true);
  stmt.execute("grant all on table exT100 to role tab_role");
  verifyOnAllSubDirs("/tmp/external/ext100",FsAction.ALL,"flume",true);
  stmt.execute("use default");
  if (!testSentryHA) {
    long beforeStop=System.currentTimeMillis();
    sentryServer.stopAll();
    long timeTakenForStopMs=System.currentTimeMillis() - beforeStop;
    LOGGER.info("Time taken for Sentry server stop: " + timeTakenForStopMs);
    if (timeTakenForStopMs < STALE_THRESHOLD) {
      verifyOnAllSubDirs("/user/hive/warehouse/p3",FsAction.WRITE_EXECUTE,"hbase",true);
      Thread.sleep((STALE_THRESHOLD - timeTakenForStopMs));
    }
 else {
      LOGGER.warn("Sentry server stop took too long");
    }
    verifyOnAllSubDirs("/user/hive/warehouse/p3",null,"hbase",false);
    sentryServer.startAll();
  }
  verifyOnAllSubDirs("/user/hive/warehouse/p3",FsAction.WRITE_EXECUTE,"hbase",true);
  stmt.execute("create table p2 (s string) partitioned by (month int, day int)");
  stmt.execute("alter table p2 add partition (month=1, day=1)");
  stmt.execute("alter table p2 add partition (month=1, day=2)");
  stmt.execute("alter table p2 add partition (month=2, day=1)");
  stmt.execute("alter table p2 add partition (month=2, day=2)");
  verifyOnAllSubDirs("/user/hive/warehouse/p2",null,"hbase",false);
  stmt.execute("grant select on table p2 to role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/p2",FsAction.READ_EXECUTE,"hbase",true);
  stmt.execute("grant select on table p2 to role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/p2",FsAction.READ_EXECUTE,"hbase",true);
  writeToPath("/tmp/external/ext1",5,"foo","bar");
  stmt.execute("create table ext1 (s string) location \'/tmp/external/ext1\'");
  verifyQuery(stmt,"ext1",5);
  verifyOnAllSubDirs("/tmp/external/ext1",null,"bar",false);
  verifyOnAllSubDirs("/tmp/external/ext1",null,"hbase",false);
  stmt.execute("grant all on table ext1 to role p1_admin");
  verifyOnAllSubDirs("/tmp/external/ext1",FsAction.ALL,"hbase",true);
  stmt.execute("revoke select on table ext1 from role p1_admin");
  verifyOnAllSubDirs("/tmp/external/ext1",FsAction.WRITE_EXECUTE,"hbase",true);
  stmt.execute("create database db1");
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db",null,"hbase",false);
  stmt.execute("create table db1.tbl1 (s string)");
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl1",null,"hbase",false);
  stmt.execute("create table db1.tbl2 (s string)");
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl2",null,"hbase",false);
  stmt.execute("grant all on database default to role p1_admin");
  verifyOnPath("/user/hive/warehouse",FsAction.ALL,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db",null,"hbase",false);
  stmt.execute("create table q1 (s string)");
  verifyOnAllSubDirs("/user/hive/warehouse/q1",FsAction.ALL,"hbase",true);
  stmt.execute("alter table q1 rename to q2");
  verifyOnAllSubDirs("/user/hive/warehouse/q2",FsAction.ALL,"hbase",true);
  stmt.execute("grant select on table q2 to role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/q2",FsAction.ALL,"hbase",true);
  stmt.execute("create table q3 (s string)");
  verifyOnAllSubDirs("/user/hive/warehouse/q3",FsAction.ALL,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/q2",FsAction.ALL,"hbase",true);
  stmt.execute("grant select on database db1 to role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl1",FsAction.READ_EXECUTE,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl2",FsAction.READ_EXECUTE,"hbase",true);
  stmt.execute("revoke all on database default from role p1_admin");
  verifyOnPath("/user/hive/warehouse",null,"hbase",false);
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl1",FsAction.READ_EXECUTE,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl2",FsAction.READ_EXECUTE,"hbase",true);
  stmt.execute("use db1");
  stmt.execute("grant all on table tbl1 to role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl1",FsAction.ALL,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl2",FsAction.READ_EXECUTE,"hbase",true);
  stmt.execute("revoke select on database db1 from role p1_admin");
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl1",FsAction.WRITE_EXECUTE,"hbase",true);
  verifyOnAllSubDirs("/user/hive/warehouse/db1.db/tbl2",null,"hbase",false);
  stmt.execute("drop table tbl1");
  Assert.assertFalse(miniDFS.getFileSystem().exists(new Path("/user/hive/warehouse/db1.db/tbl1")));
  stmt.execute("drop table tbl2");
  Assert.assertFalse(miniDFS.getFileSystem().exists(new Path("/user/hive/warehouse/db1.db/tbl2")));
  stmt.execute("use default");
  stmt.execute("drop database db1");
  Assert.assertFalse(miniDFS.getFileSystem().exists(new Path("/user/hive/warehouse/db1.db")));
  writeToPath("/tmp/external/tables/ext2_before/i=1",5,"foo","bar");
  writeToPath("/tmp/external/tables/ext2_before/i=2",5,"foo","bar");
  stmt.execute("create external table ext2 (s string) partitioned by (i int) location \'/tmp/external/tables/ext2_before\'");
  stmt.execute("alter table ext2 add partition (i=1)");
  stmt.execute("alter table ext2 add partition (i=2)");
  verifyQuery(stmt,"ext2",10);
  verifyOnAllSubDirs("/tmp/external/tables/ext2_before",null,"hbase",false);
  stmt.execute("grant all on table ext2 to role p1_admin");
  verifyOnPath("/tmp/external/tables/ext2_before",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_before/i=1",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_before/i=2",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_before/i=1/stuff.txt",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_before/i=2/stuff.txt",FsAction.ALL,"hbase",true);
  writeToPath("/tmp/external/tables/ext2_after/i=1",6,"foo","bar");
  writeToPath("/tmp/external/tables/ext2_after/i=2",6,"foo","bar");
  stmt.execute("alter table ext2 set location \'hdfs:///tmp/external/tables/ext2_after\'");
  verifyQuery(stmt,"ext2",10);
  verifyOnPath("/tmp/external/tables/ext2_before",null,"hbase",false);
  verifyOnPath("/tmp/external/tables/ext2_before/i=1",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_before/i=2",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_before/i=1/stuff.txt",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_before/i=2/stuff.txt",FsAction.ALL,"hbase",true);
  stmt.execute("alter table ext2 partition (i=1) set location \'hdfs:///tmp/external/tables/ext2_after/i=1\'");
  stmt.execute("alter table ext2 partition (i=2) set location \'hdfs:///tmp/external/tables/ext2_after/i=2\'");
  verifyQuery(stmt,"ext2",12);
  verifyOnPath("/tmp/external/tables/ext2_before",null,"hbase",false);
  verifyOnPath("/tmp/external/tables/ext2_before/i=1",null,"hbase",false);
  verifyOnPath("/tmp/external/tables/ext2_before/i=2",null,"hbase",false);
  verifyOnPath("/tmp/external/tables/ext2_before/i=1/stuff.txt",null,"hbase",false);
  verifyOnPath("/tmp/external/tables/ext2_before/i=2/stuff.txt",null,"hbase",false);
  verifyOnPath("/tmp/external/tables/ext2_after",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_after/i=1",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_after/i=2",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_after/i=1/stuff.txt",FsAction.ALL,"hbase",true);
  verifyOnPath("/tmp/external/tables/ext2_after/i=2/stuff.txt",FsAction.ALL,"hbase",true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestConfigTool </h4><pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Validate user permissions listing
 * @throws Exception
 */
@Test public void testUserPermissions() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addRolesToGroup(USERGROUP3,"select_colA").addRolesToGroup(USERGROUP4,"select_colAB").addPermissionsToRole("select_tab1","server=server1->db=db1->table=tab1->action=select").addPermissionsToRole("insert_tab2","server=server1->db=db1->table=tab2->action=insert").addPermissionsToRole("select_tab3","server=server1->db=db1->table=tab3->action=select").addPermissionsToRole("select_colA","server=server1->db=db1->table=tab3->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=db1->table=tab3->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=db1->table=tab3->column=b->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setupConfig();
  configTool.validatePolicy();
  Set<String> permList=configTool.getSentryProvider().listPrivilegesForSubject(new Subject(USER1_1));
  assertTrue(permList.contains("server=server1->db=db1->table=tab1->action=select"));
  assertTrue(permList.contains("server=server1->db=db1->table=tab2->action=insert"));
  permList=configTool.getSentryProvider().listPrivilegesForSubject(new Subject(USER2_1));
  assertTrue(permList.contains("server=server1->db=db1->table=tab3->action=select"));
  permList=configTool.getSentryProvider().listPrivilegesForSubject(new Subject(USER3_1));
  assertTrue(permList.contains("server=server1->db=db1->table=tab3->column=a->action=select"));
  permList=configTool.getSentryProvider().listPrivilegesForSubject(new Subject(USER4_1));
  assertTrue(permList.contains("server=server1->db=db1->table=tab3->column=a->action=select"));
  assertTrue(permList.contains("server=server1->db=db1->table=tab3->column=b->action=select"));
  permList=configTool.getSentryProvider().listPrivilegesForSubject(new Subject(ADMIN1));
  assertTrue(permList.contains("server=server1"));
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify errors/warnings from malformed policy file
 * @throws Exception
 */
@Test public void testInvalidPolicy() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=db1->table=tab1->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setupConfig();
  try {
    configTool.getSentryProvider().validateResource(true);
    fail("Policy validation should fail for malformed policy");
  }
 catch (  SentryConfigurationException e) {
    assertTrue(e.getConfigWarnings().get(0).contains("Role select_tab3 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(1).contains("Role insert_tab2 for group " + USERGROUP1 + " does not exist"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * verify missing permissions for query using remote query validation
 * @throws Exception
 */
@Test public void testQueryPermissions() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addRolesToGroup(USERGROUP3,"select_colAB").addRolesToGroup(USERGROUP4,"select_colA").addPermissionsToRole("select_tab1","server=server1->db=default->table=tab1->action=select").addPermissionsToRole("insert_tab2","server=server1->db=default->table=tab2->action=insert").addPermissionsToRole("select_tab3","server=server1->db=default->table=tab3->action=select").addPermissionsToRole("select_colA","server=server1->db=default->table=tab1->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=default->table=tab1->column=a->action=select").addPermissionsToRole("select_colAB","server=server1->db=default->table=tab1->column=b->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS tab1");
  statement.execute("DROP TABLE IF EXISTS tab2");
  statement.execute("DROP TABLE IF EXISTS tab3");
  statement.execute("CREATE TABLE tab1(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE tab2(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE tab3(b INT, a STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.close();
  connection.close();
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setJdbcURL(context.getConnectionURL());
  configTool.setUser(USER1_1);
  configTool.setupConfig();
  ByteArrayOutputStream errBuffer=new ByteArrayOutputStream();
  configTool.setUser(USER1_1);
  configTool.verifyRemoteQuery("SELECT COUNT(*) FROM tab1");
  try {
    System.setOut(new PrintStream(errBuffer));
    configTool.setUser(USER1_1);
    configTool.verifyRemoteQuery("SELECT COUNT(*) FROM tab3");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab3->action=select"));
    errBuffer.flush();
  }
  try {
    configTool.setUser(USER2_1);
    configTool.verifyRemoteQuery("INSERT OVERWRITE TABLE tab2 SELECT * FROM tab3");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab2->action=insert"));
    errBuffer.flush();
  }
  configTool.setUser(USER3_1);
  configTool.verifyRemoteQuery("SELECT a FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(a) FROM tab1");
  configTool.verifyRemoteQuery("SELECT b FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(b) FROM tab1");
  configTool.verifyRemoteQuery("SELECT a,b FROM tab1");
  configTool.setUser(USER4_1);
  configTool.verifyRemoteQuery("SELECT a FROM tab1");
  configTool.verifyRemoteQuery("SELECT COUNT(a) FROM tab1");
  try {
    configTool.setUser(USER4_1);
    configTool.verifyRemoteQuery("SELECT b FROM tab1");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab1->Column=b->action=select"));
    errBuffer.flush();
  }
  try {
    configTool.setUser(USER4_1);
    configTool.verifyRemoteQuery("SELECT COUNT(b) FROM tab1");
    fail("Query should have failed with insufficient perms");
  }
 catch (  SQLException e) {
    assertTrue(errBuffer.toString().contains("Server=server1->Db=default->Table=tab1->Column=b->action=select"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify errors/warnings from malformed policy file with per-DB policy
 * @throws Exception
 */
@Test public void testInvalidPerDbPolicy() throws Exception {
  PolicyFile db2PolicyFile=new PolicyFile();
  File db2PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB2_POLICY_FILE);
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl2","insert_db2_tab2").addPermissionsToRole("select_tbl2","server=server1->db=db2->table=tbl2->action=select").write(db2PolicyFileHandle);
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl3").addPermissionsToRole("select_tbl1","server=server1->db=db1->table=tbl1->action=select").addDatabase("db2",prefix + db2PolicyFileHandle.getName()).setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  configTool.setPolicyFile(context.getPolicyFile().getPath());
  configTool.setupConfig();
  try {
    configTool.getSentryProvider().validateResource(true);
    fail("Policy validation should fail for malformed policy");
  }
 catch (  SentryConfigurationException e) {
    assertTrue(e.getConfigWarnings().get(0).contains("Role select_tbl3 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(0).contains(context.getPolicyFile().getName()));
    assertTrue(e.getConfigWarnings().get(1).contains("Role insert_db2_tab2 for group " + USERGROUP2 + " does not exist"));
    assertTrue(e.getConfigWarnings().get(1).contains(db2PolicyFileHandle.getName()));
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the mock compilation config setting forces query to abort
 * @throws Exception
 */
@Test public void testMockCompilation() throws Exception {
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS tab1");
  statement.execute("CREATE TABLE tab1(B INT, A STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("SELECT * FROM tab1");
  statement.execute("SET " + HiveAuthzConf.HIVE_SENTRY_MOCK_COMPILATION + "=true");
  try {
    statement.execute("SELECT * FROM tab1");
    fail("Query should fail with mock error config enabled");
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains(HiveAuthzConf.HIVE_SENTRY_MOCK_ERROR));
  }
  statement.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestCrossDbOps </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Test Case 2.11 admin user create a new database DB_1 and grant ALL to
 * himself on DB_1 should work
 */
@Test public void testAdminDbPrivileges() throws Exception {
  createDb(ADMIN1,DB1);
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  String tabName=DB1 + "." + "admin_tab1";
  adminStmt.execute("create table " + tabName + "(c1 string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ tabName);
  assertTrue(adminStmt.executeQuery("select * from " + tabName).next());
  adminStmt.close();
  adminCon.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestExportImportPrivileges </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testInsertToDirPrivileges() throws Exception {
  Connection connection=null;
  Statement statement=null;
  String dumpDir=dfs.getBaseDir() + "/hive_data_dump";
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  policyFile.addRolesToGroup(USERGROUP1,"db1_read","db1_write","data_dump").addRolesToGroup(USERGROUP2,"db1_read","db1_write").addPermissionsToRole("db1_write","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=INSERT").addPermissionsToRole("db1_read","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=SELECT").addPermissionsToRole("data_dump","server=server1->URI=" + dumpDir);
  writePolicyFile(policyFile);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  context.assertAuthzException(statement,"INSERT OVERWRITE DIRECTORY '" + dumpDir + "' SELECT * FROM "+ TBL1);
  statement.close();
  connection.close();
  String scratchLikeDir=context.getProperty(HiveConf.ConfVars.SCRATCHDIR.varname) + "_foo";
  dfs.assertCreateDir(scratchLikeDir);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  context.assertAuthzException(statement,"INSERT OVERWRITE DIRECTORY '" + scratchLikeDir + "/bar' SELECT * FROM "+ TBL1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  assertTrue(statement.executeQuery("SELECT * FROM " + TBL1).next());
  statement.execute("INSERT OVERWRITE DIRECTORY '" + dumpDir + "' SELECT * FROM "+ TBL1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestJDBCInterface </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJDBCGetSchemasAndGetTables() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB2 CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB1(id int)");
  statement.executeQuery("SHOW TABLES");
  statement.execute("USE " + DB2);
  statement.execute("CREATE TABLE TAB2(id int)");
  statement.execute("CREATE TABLE TAB3(id int)");
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=" + DB1 + "->table=tab1->action=select").addPermissionsToRole("select_tab3","server=server1->db=" + DB2 + "->table=tab3->action=select").addPermissionsToRole("insert_tab2","server=server1->db=" + DB2 + "->table=tab2->action=insert");
  writePolicyFile(policyFile);
  Connection conn=context.createConnection(USER1_1);
  List<String> expectedResult=new ArrayList<String>();
  List<String> returnedResult=new ArrayList<String>();
  ResultSet res=conn.getMetaData().getSchemas();
  ResultSetMetaData resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  expectedResult.add(DB1);
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB1,"tab%",null);
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB2,"tab%",null);
  expectedResult.add("tab2");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab2");
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  conn.close();
  conn=context.createConnection(USER2_1);
  res=conn.getMetaData().getSchemas();
  resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab3");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,DB1,"tab%","i%");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  assertTrue("returned result shouldn't contain any value, actually returned result = " + returnedResult.toString(),returnedResult.isEmpty());
  res.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestLockPrivileges </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLockDatabase() throws Exception {
  String partialErrorMsgForNoPrivilege="No valid privileges";
  String assertErrorException="The exception is not the same as the expectation.";
  String assertExceptionThrown="SQLException will be thrown.";
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("lock_db1",privileges.get("lock_db1")).addRolesToGroup(USERGROUP1,"lock_db1").addPermissionsToRole("insert_db1",privileges.get("insert_db1")).addRolesToGroup(USERGROUP2,"insert_db1").addPermissionsToRole("select_db1",privileges.get("select_db1")).addRolesToGroup(USERGROUP2,"select_db1").addPermissionsToRole("alter_db1",privileges.get("alter_db1")).addRolesToGroup(USERGROUP2,"alter_db1").addPermissionsToRole("all_db1",privileges.get("all_db1")).addRolesToGroup(USERGROUP3,"all_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK DATABASE db_1 SHARED");
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  try {
    statement.execute("LOCK DATABASE db_1 SHARED");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK DATABASE db_1 SHARED");
  try {
    statement.execute("UNLOCK DATABASE db_1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLockTable() throws Exception {
  String partialErrorMsgForNoPrivilege="No valid privileges";
  String assertErrorException="The exception is not the same as the expectation.";
  String assertExceptionThrown="SQLException will be thrown.";
  adminCreate(DB1,tableName);
  policyFile.addPermissionsToRole("lock_db1_tb1",privileges.get("lock_db1_tb1")).addRolesToGroup(USERGROUP1,"lock_db1_tb1").addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP2,"insert_db1_tb1").addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addRolesToGroup(USERGROUP2,"select_db1_tb1").addPermissionsToRole("alter_db1_tb1",privileges.get("alter_db1_tb1")).addRolesToGroup(USERGROUP2,"alter_db1_tb1").addPermissionsToRole("all_db1_tb1",privileges.get("all_db1_tb1")).addRolesToGroup(USERGROUP3,"all_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK TABLE tb1 SHARED");
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  try {
    statement.execute("LOCK TABLE tb1 SHARED");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) > 0);
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("LOCK TABLE tb1 SHARED");
  try {
    statement.execute("UNLOCK TABLE tb1");
    fail(assertExceptionThrown);
  }
 catch (  SQLException se) {
    assertTrue(assertErrorException,se.getMessage().indexOf(partialErrorMsgForNoPrivilege) == -1);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMetadataObjectRetrieval </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that admin and all@db can describe database
 * and describe database extended. Also tests that a user
 * with no privileges on a db cannot describe database.
 */
@Test public void testDescribeDatabasesWithAllOnServerAndAllOnDb() throws Exception {
  dropDb(ADMIN1,DB1,DB2);
  createDb(ADMIN1,DB1,DB2);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  createTable(ADMIN1,DB2,dataFile,TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=" + DB1).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB1).next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE EXTENDED " + DB1).next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB1).next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE EXTENDED " + DB1).next());
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB2);
  context.assertAuthzException(statement,"DESCRIBE DATABASE EXTENDED " + DB2);
  policyFile.addPermissionsToRole(GROUP1_ROLE,INSERT_DB2_TBL1);
  writePolicyFile(policyFile);
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB2);
  context.assertAuthzException(statement,"DESCRIBE DATABASE EXTENDED " + DB2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that a user without db level privileges cannot describe default
 */
@Test public void testDescribeDefaultDatabase() throws Exception {
  createDb(ADMIN1,DB1,DB2);
  createTable(ADMIN1,"default",dataFile,TBL1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE default").next());
  statement.execute("USE " + DB1);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE default").next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB1).next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB2).next());
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=default->table=" + TBL1 + "->action=select","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=select").addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,"DESCRIBE DATABASE default");
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB1);
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMetadataPermissions </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that a user with privileges on a database can describe
 * the database.
 */
@Test public void testDescDbPrivilegesPositive() throws Exception {
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  for (  String dbName : new String[]{DB1,DB2}) {
    statement.execute("USE " + dbName);
    Assert.assertTrue(statement.executeQuery("DESCRIBE DATABASE " + dbName).next());
    Assert.assertTrue(statement.executeQuery("DESCRIBE DATABASE EXTENDED " + dbName).next());
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that a user with privileges on a table can describe the table.
 */
@Test public void testDescPrivilegesPositive() throws Exception {
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  for (  String dbName : new String[]{DB1,DB2}) {
    statement.execute("USE " + dbName);
    Assert.assertTrue(statement.executeQuery("DESCRIBE DATABASE " + dbName).next());
    for (    String tabName : new String[]{"tab1","tab2"}) {
      Assert.assertTrue(statement.executeQuery("DESCRIBE " + tabName).next());
      Assert.assertTrue(statement.executeQuery("DESCRIBE EXTENDED " + tabName).next());
    }
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMovingToProduction </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * repeat above tests, only difference is don't do 'USE <database>'
 * in this test. Instead, access table objects across database by
 * database.table
 * @throws Exception
 */
@Test public void testMovingTable2() throws Exception {
  String tableName1="tb_1";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("DROP DATABASE IF EXISTS " + DB2 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ tableName1);
  statement.execute("create table " + DB2 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("load_data","server=server1->uri=file://" + dataDir.getPath());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("LOAD DATA LOCAL INPATH 'file://" + dataDir.getPath() + "' INTO TABLE "+ DB1+ "."+ tableName1);
  policyFile.addRolesToGroup(USERGROUP1,"insert_proddb_tbl1").addPermissionsToRole("insert_proddb_tbl1","server=server1->db=" + DB2 + "->table=tb_1->action=insert");
  writePolicyFile(policyFile);
  statement.execute("INSERT OVERWRITE TABLE " + DB2 + "."+ tableName1+ " SELECT * FROM "+ DB1+ "."+ tableName1);
  policyFile.addRolesToGroup(USERGROUP1,"select_proddb_tbl1").addPermissionsToRole("select_proddb_tbl1","server=server1->db=" + DB2 + "->table=tb_1->action=select");
  writePolicyFile(policyFile);
  assertTrue("user1 should be able to select data from " + DB2 + "."+ DB2+ "."+ tableName1,statement.execute("SELECT * FROM " + DB2 + "."+ tableName1+ " LIMIT 10"));
  assertTrue("user1 should be able to describe table " + DB2 + "."+ tableName1,statement.execute("DESCRIBE " + DB2 + "."+ tableName1));
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,"INSERT OVERWRITE TABLE " + DB2 + "."+ tableName1+ " SELECT * FROM "+ DB1+ "."+ tableName1);
  context.assertAuthzException(statement,"SELECT * FROM " + DB2 + "."+ tableName1+ " LIMIT 10");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  context.assertAuthzException(statement,"DROP TABLE " + tableName1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestOperations </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testExternalTables() throws Exception {
  createDb(ADMIN1,DB1);
  File externalTblDir=new File(dataDir,"exttab");
  assertTrue("Unable to create directory for external table test",externalTblDir.mkdir());
  policyFile.addPermissionsToRole("create_db1",privileges.get("create_db1")).addPermissionsToRole("all_uri","server=server1->uri=file://" + dataDir.getPath()).addRolesToGroup(USERGROUP1,"create_db1","all_uri").addRolesToGroup(USERGROUP2,"create_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER2_1);
  Statement statement=context.createStatement(connection);
  assertSemanticException(statement,"create external table " + DB1 + ".tb1(a int) stored as "+ "textfile location 'file:"+ externalTblDir.getAbsolutePath()+ "'");
  assertSemanticException(statement,"create external table " + DB1 + ".tb2(a int) location '/user/hive/warehouse/blah'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("create external table " + DB1 + ".tb1(a int) stored as "+ "textfile location 'file:"+ externalTblDir.getAbsolutePath()+ "'");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegeAtTransform </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Steps:
 * 1. admin create database, create table, load data into it
 * 2. all@server can issue transforms command
 * 3. all@database cannot issue transform command
 * 4. insert@table select@table cannot issue transform command
 * 5. select@view cannot issue transform command
 * 6. transform@server can issue the transform command
 * 7. non-admin user with URI privilege on transform can execute query
 */
@Test public void testTransform1() throws Exception {
  policyFile.addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("transform_uri","server=server1->uri=file:///bin/cat").addRolesToGroup(USERGROUP1,"all_db1").addRolesToGroup(USERGROUP2,"all_db1","transform_uri").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  String tableName1="tb_1";
  String query="select TRANSFORM(a.under_col, a.value) " + "USING '/bin/cat' AS (tunder_col, tvalue) FROM " + DB1 + "."+ tableName1+ " a";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int, value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ DB1+ "."+ tableName1);
  assertTrue(query,statement.execute(query));
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,query);
  policyFile.addPermissionsToRole("select_tb1","server=server1->db=" + DB1 + "->table=tb_1->action=select").addPermissionsToRole("insert_tb1","server=server1->db=" + DB1 + "->table=tb_1->action=insert").addRolesToGroup(USERGROUP1,"select_tb1","insert_tb1");
  writePolicyFile(policyFile);
  context.assertAuthzException(statement,query);
  policyFile.addPermissionsToRole("all_server1","server=server1").addRolesToGroup(USERGROUP1,"all_server1");
  writePolicyFile(policyFile);
  assertTrue(query,statement.execute(query));
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  assertTrue(query,statement.execute(query));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtDatabaseScope </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test access to default DB with out of box authz config
 * All users should be able to switch to default, including the users that don't have any
 * privilege on default db objects via policy file
 * @throws Exception
 */
@Test public void testDefaultDbPrivilege() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("use default");
  statement.execute("create table tab1(a int)");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE TAB_1(A STRING)");
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("use " + DB2);
  statement.execute("CREATE TABLE TAB_2(A STRING)");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1").addRolesToGroup(USERGROUP2,"select_db2").addRolesToGroup(USERGROUP3,"all_default").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("select_db2","server=server1->db=" + DB2 + "->table=tab_2->action=select").addPermissionsToRole("all_default","server=server1->db=default").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use default");
  try {
    statement.execute("select * from tab1");
    assertTrue("Should not be allowed !!",false);
  }
 catch (  Exception e) {
  }
  context.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use default");
  context.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("use default");
  context.close();
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test privileges for 'use <db>'
 * Admin should be able to run use <db> with server level access
 * User with db level access should be able to run use <db>
 * User with table level access should be able to run use <db>
 * User with no access to that db objects, should NOT be able run use <db>
 * @throws Exception
 */
@Test public void testUseDbPrivilege() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE TAB_1(A STRING)");
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("use " + DB2);
  statement.execute("CREATE TABLE TAB_2(A STRING)");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1").addRolesToGroup(USERGROUP2,"select_db2").addRolesToGroup(USERGROUP3,"all_db3").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("select_db2","server=server1->db=" + DB2 + "->table=tab_2->action=select").addPermissionsToRole("all_db3","server=server1->db=DB_3").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  context.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("use " + DB1);
    assertFalse("user2 shouldn't be able switch to " + DB1,true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.execute("use " + DB2);
  context.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("use " + DB2);
    assertFalse("user3 shouldn't be able switch to " + DB2,true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilegeOnObjectOwnedByAdmin() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  File externalTblDir=new File(dataDir,"exttab");
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE PART_TAB_1(A STRING) partitioned by (B INT) STORED AS TEXTFILE");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=1)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=2)");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data","exttab").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("exttab","server=server1->uri=file://" + dataDir.getPath()).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_2");
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1500);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("DROP TABLE TAB_3");
  assertTrue("Unable to create directory for external table test",externalTblDir.mkdir());
  statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
  context.assertSentrySemanticException(statement,"ALTER TABLE TAB_2 SET LOCATION 'file:///tab2'",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilege() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("CREATE TABLE " + DB1 + ".TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_1");
  statement.execute("CREATE TABLE " + DB1 + ".TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_2");
  statement.execute("USE " + DB1);
  statement.execute("create table table2 as select A, count(A) from TAB_1 GROUP BY A");
  statement.execute("USE " + DB1);
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1000);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("CREATE TABLE TAB_4 AS SELECT * FROM TAB_2");
  statement.execute("ALTER TABLE TAB_3 ADD COLUMNS (B INT)");
  statement.execute("DROP TABLE TAB_3");
  try {
    statement.execute("DROP DATABASE " + DB2 + " CASCADE");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("USE " + DB2);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.execute("DROP DATABASE " + DB1 + " CASCADE");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtFunctionScope </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * admin should be able to create/drop temp functions
 * user with db level access should be able to create/drop temp functions
 * user with table level access should be able to create/drop temp functions
 * user with no privilege should NOT be able to create/drop temp functions
 */
@Test public void testFuncPrivileges1() throws Exception {
  String tableName1="tb_1";
  String udfClassName="org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf";
  CodeSource udfSrc=Class.forName(udfClassName).getProtectionDomain().getCodeSource();
  String udfLocation=System.getProperty(EXTERNAL_HIVE_LIB);
  if (udfLocation == null) {
    udfLocation=udfSrc.getLocation().getPath();
  }
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ "."+ tableName1);
  statement.execute("DROP TEMPORARY FUNCTION IF EXISTS printf_test");
  statement.execute("DROP TEMPORARY FUNCTION IF EXISTS printf_test_2");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all","UDF_JAR","data_read").addRolesToGroup(USERGROUP2,"db1_tab1","UDF_JAR").addRolesToGroup(USERGROUP3,"db1_tab1").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("db1_tab1","server=server1->db=" + DB1 + "->table="+ tableName1).addPermissionsToRole("UDF_JAR","server=server1->uri=file://" + udfLocation).addPermissionsToRole("data_read","server=server1->URI=" + "file:///tmp");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  try {
    statement.execute("CREATE TEMPORARY FUNCTION printf_test AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    LOGGER.info("Testing select from temp func printf_test");
    ResultSet res=statement.executeQuery("SELECT printf_test('%d', under_col) FROM " + tableName1);
    while (res.next()) {
      LOGGER.info(res.getString(1));
    }
    res.close();
    statement.execute("DROP TEMPORARY FUNCTION printf_test");
  }
 catch (  Exception ex) {
    LOGGER.error("test temp func printf_test failed with reason: " + ex.getStackTrace() + " "+ ex.getMessage());
    fail("fail to test temp func printf_test");
  }
  statement.execute("CREATE FUNCTION printf_test_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf' ");
  statement.execute("SELECT printf_test_perm(value) FROM " + tableName1);
  statement.execute("DROP FUNCTION printf_test_perm");
  statement.execute("CREATE FUNCTION printf_test_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf' " + " using file 'file:///tmp'");
  statement.execute("DROP FUNCTION printf_test_perm");
  context.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TEMPORARY FUNCTION printf_test_2 AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  statement.execute("SELECT printf_test_2(value) FROM " + tableName1);
  statement.execute("DROP TEMPORARY FUNCTION printf_test_2");
  statement.execute("CREATE FUNCTION " + DB1 + ".printf_test_2_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  statement.execute("SELECT printf_test_2_perm(value) FROM " + tableName1);
  statement.execute("DROP FUNCTION printf_test_2_perm");
  try {
    statement.execute("CREATE FUNCTION " + DB1 + ".printf_test_2_perm AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'"+ " using file '"+ "file://"+ dataFile.getPath()+ "'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  try {
    statement.execute("CREATE TEMPORARY FUNCTION printf_test_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("CREATE FUNCTION printf_test_perm_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE FUNCTION should fail for user3",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
  connection=context.createConnection(USER4_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("USE default");
    statement.execute("CREATE TEMPORARY FUNCTION printf_test_bad AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
    assertFalse("CREATE TEMPORARY FUNCTION should fail for user4",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtTableScope </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Test queries without from clause. Hive rewrites the queries with dummy db and table
 * entities which should not trip authorization check.
 * @throws Exception
 */
@Test public void testSelectWithoutFrom() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"all_tab1").addPermissionsToRole("all_tab1","server=server1->db=" + DB1 + "->table="+ TBL1).addRolesToGroup(USERGROUP2,"select_tab1").addPermissionsToRole("select_tab1","server=server1->db=" + DB1 + "->table="+ TBL1).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("SELECT 1 ").next());
  assertTrue(statement.executeQuery("SELECT current_database()").next());
  statement.execute("USE " + DB1);
  assertTrue(statement.executeQuery("SELECT 1 ").next());
  assertTrue(statement.executeQuery("SELECT current_database() ").next());
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-5 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInsert() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"insert_tab1","select_tab2").addPermissionsToRole("insert_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=insert").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("INSERT INTO TABLE " + TBL1 + " SELECT A, B FROM "+ TBL2);
  try {
    statement.executeQuery("SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("SELECT A FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  ResultSet resultSet=statement.executeQuery("SHOW TABLES");
  while (resultSet.next()) {
    String tableName=resultSet.getString(1);
    assertNotNull("table name is null in result set",tableName);
    assertFalse("Found VIEW_1 in the result set","VIEW_1".equalsIgnoreCase(tableName));
  }
  try {
    statement.executeQuery("CREATE VIEW VIEW_2(A) AS SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify truncate table permissions for different users with different
 * privileges
 * @throws Exception
 */
@Test public void testTruncateTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,MULTI_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(MULTI_TYPE_DATA_FILE_NAME),to);
  to.close();
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE if exists " + TBL1);
  statement.execute("DROP TABLE if exists " + TBL2);
  statement.execute("DROP TABLE if exists " + TBL3);
  statement.execute("CREATE TABLE " + TBL1 + "(B INT, A STRING) "+ " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE " + TBL2 + "(B INT, A STRING) "+ " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE " + TBL3 + "(B INT, A STRING) "+ " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL1);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL2);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL3);
  statement.execute("TRUNCATE TABLE " + TBL1);
  assertFalse(hasData(statement,TBL1));
  statement.close();
  connection.close();
  updatePolicyFile();
  truncateTableTests(false);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify truncate partitioned permissions for different users with different
 * privileges
 * @throws Exception
 */
@Test public void testTruncatePartitionedTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,MULTI_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(MULTI_TYPE_DATA_FILE_NAME),to);
  to.close();
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE if exists " + TBL1);
  statement.execute("CREATE TABLE " + TBL1 + " (i int) PARTITIONED BY (j int)");
  statement.execute("DROP TABLE if exists " + TBL2);
  statement.execute("CREATE TABLE " + TBL2 + " (i int) PARTITIONED BY (j int)");
  statement.execute("DROP TABLE if exists " + TBL3);
  statement.execute("CREATE TABLE " + TBL3 + " (i int) PARTITIONED BY (j int)");
  statement.execute("TRUNCATE TABLE " + TBL1);
  assertFalse(hasData(statement,TBL1));
  statement.close();
  connection.close();
  updatePolicyFile();
  truncateTableTests(false);
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("ALTER TABLE " + TBL1 + " ADD PARTITION (j=1) PARTITION (j=2)");
  statement.execute("ALTER TABLE " + TBL2 + " ADD PARTITION (j=1) PARTITION (j=2)");
  statement.execute("ALTER TABLE " + TBL3 + " ADD PARTITION (j=1) PARTITION (j=2)");
  statement.execute("TRUNCATE TABLE " + TBL1 + " partition (j=1)");
  statement.execute("TRUNCATE TABLE " + TBL1);
  assertFalse(hasData(statement,TBL1));
  statement.close();
  connection.close();
  truncateTableTests(true);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestRuntimeMetadataRetrieval </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Steps: 1. admin creates tables in default db
 * 2. user1 shouldn't see any table when he/she doesn't have any privilege on default
 */
@Test public void testShowTables5() throws Exception {
  String tableNames[]={"tb_1","tb_2","tb_3","tb_4"};
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  createTabs(statement,"default",tableNames);
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  ResultSet rs=statement.executeQuery("SHOW TABLES");
  Assert.assertFalse(rs.next());
  statement.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestSandboxOps </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Steps:
 * 1. Admin user creates a new database DB_1
 * 2. Admin user grants ALL on DB_1 to group GROUP_1
 * 3. User from GROUP_1 creates table TAB_1, TAB_2 in DB_1
 * 4. Admin user grants SELECT/INSERT on TAB_1 to group GROUP_2
 * a) verify users from GROUP_2 have only SELECT/INSERT
 * privileges on TAB_1. They shouldn't be able to perform
 * any operation other than those listed as
 * requiring SELECT in the privilege model.
 * b) verify users from GROUP_2 can't perform queries
 * involving join between TAB_1 and TAB_2.
 * c) verify users from GROUP_1 can't perform operations
 * requiring ALL @SERVER scope:
 * *) create database
 * *) drop database
 * *) show databases
 * *) show locks
 * *) execute ALTER TABLE .. SET LOCATION on a table in DB_1
 * *) execute ALTER PARTITION ... SET LOCATION on a table in DB_1
 * *) execute CREATE EXTERNAL TABLE ... in DB_1
 * *) execute ADD JAR
 * *) execute a query with TRANSOFORM
 * @throws Exception
 */
@Test public void testSandboxOpt17() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1,TBL2);
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addRolesToGroup(USERGROUP2,"select_tb1").addPermissionsToRole("select_tb1","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=select").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.toString());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"CREATE DATABASE " + DB3);
  ResultSet rs=statement.executeQuery("SHOW DATABASES");
  assertTrue(rs.next());
  assertEquals(DB1,rs.getString(1));
  context.assertAuthzException(statement,"ALTER TABLE " + TBL1 + " ADD PARTITION (value = 10) LOCATION '"+ dataDir.getPath()+ "'");
  context.assertAuthzException(statement,"ALTER TABLE " + TBL1 + " PARTITION (value = 10) SET LOCATION '"+ dataDir.getPath()+ "'");
  context.assertAuthzException(statement,"CREATE EXTERNAL TABLE " + TBL3 + " (under_col int, value string) LOCATION '"+ dataDir.getPath()+ "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SELECT * FROM TABLE " + TBL2 + " LIMIT 10");
  context.assertAuthzException(statement,"EXPLAIN SELECT * FROM TABLE " + TBL2 + " WHERE under_col > 5 LIMIT 10");
  context.assertAuthzException(statement,"DESCRIBE " + TBL2);
  context.assertAuthzException(statement,"LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL2);
  context.assertAuthzException(statement,"analyze table " + TBL2 + " compute statistics for columns under_col, value");
  context.assertAuthzException(statement,"SELECT " + TBL1 + ".* FROM "+ TBL1+ " JOIN "+ TBL2+ " ON ("+ TBL1+ ".value = "+ TBL2+ ".value)");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests select on table with index.
 * Steps:
 * 1. admin user create a new database DB_1
 * 2. admin create TABLE_1 in DB_1
 * 3. admin create INDEX_1 for COLUMN_1 in TABLE_1 in DB_1
 * 4. admin user grant INSERT and SELECT to user1's group on TABLE_1
 * negative test case:
 * a) user1 try to SELECT * FROM TABLE_1 WHERE COLUMN_1 == ...
 * should NOT work
 * b) user1 should not be able to check the list of view or
 * index in DB_1
 * @throws Exception
 */
@Test public void testSandboxOpt13() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  createTable(ADMIN1,DB1,dataFile,TBL2);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP INDEX IF EXISTS " + INDEX1 + " ON "+ TBL1);
  statement.execute("CREATE INDEX " + INDEX1 + " ON TABLE "+ TBL1+ " (under_col) as 'COMPACT' WITH DEFERRED REBUILD");
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL2).addRolesToGroup(USERGROUP1,GROUP1_ROLE);
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SELECT * FROM " + TBL1 + " WHERE under_col == 5");
  context.assertAuthzException(statement,"SHOW INDEXES ON " + TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL1,INSERT_DB1_TBL1,loadData);
  writePolicyFile(policyFile);
  statement.execute("USE " + DB1);
  assertTrue(statement.execute("SELECT * FROM " + TBL1 + " WHERE under_col == 5"));
  assertTrue(statement.execute("SHOW INDEXES ON " + TBL1));
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests to ensure that users with all@db can create tables
 * and that they cannot create databases or load data
 */
@Test public void testDbPrivileges() throws Exception {
  String[] dbs=new String[]{DB1,DB2};
  for (  String dbName : dbs) {
    createDb(ADMIN1,dbName);
  }
  addTwoUsersWithAllDb();
  writePolicyFile(policyFile);
  for (  String user : new String[]{USER1_1,USER1_2}) {
    for (    String dbName : dbs) {
      Connection userConn=context.createConnection(user);
      String tabName=user + "_tab1";
      Statement userStmt=context.createStatement(userConn);
      userStmt.execute("use " + dbName);
      userStmt.execute("create table " + tabName + " (id int)");
      context.assertAuthzException(userStmt,"load data local inpath '" + dataFile + "' into table "+ tabName);
      assertTrue(userStmt.execute("select * from " + tabName));
      context.assertAuthzException(userStmt,"CREATE DATABASE " + DB3);
      userStmt.close();
      userConn.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestSentryOnFailureHookLoading </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnFailureHookLoading() throws Exception {
  String hiveServer2Type=System.getProperty(HiveServerFactory.HIVESERVER2_TYPE);
  if (hiveServer2Type != null && !HiveServerFactory.isInternalServer(HiveServerFactory.HiveServer2Type.valueOf(hiveServer2Type.trim()))) {
    return;
  }
  context=createContext(testProperties);
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addPermissionsToRole("all_db1","server=server1->db=DB_1").setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("CREATE DATABASE DB_1");
  statement.execute("CREATE DATABASE DB_2");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  assertFalse(DummySentryOnFailureHook.invoked);
  try {
    statement.execute("DROP DATABASE DB_2 CASCADE");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    assertTrue(DummySentryOnFailureHook.invoked);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP DATABASE DB_1 CASCADE");
  statement.execute("DROP DATABASE DB_2 CASCADE");
  statement.close();
  connection.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestServerConfiguration </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test access to default DB with explicit privilege requirement
 * Admin should be able to run use default with server level access
 * User with db level access should be able to run use default
 * User with table level access should be able to run use default
 * User with no access to default db objects, should NOT be able run use default
 * @throws Exception
 */
@Test public void testDefaultDbRestrictivePrivilege() throws Exception {
  properties.put(HiveAuthzConf.AuthzConfVars.AUTHZ_RESTRICT_DEFAULT_DB.getVar(),"true");
  context=createContext(properties);
  policyFile.addRolesToGroup(USERGROUP1,"all_default").addRolesToGroup(USERGROUP2,"select_default").addRolesToGroup(USERGROUP3,"all_db1").addPermissionsToRole("all_default","server=server1->db=default").addPermissionsToRole("select_default","server=server1->db=default->table=tab_2->action=select").addPermissionsToRole("all_db1","server=server1->db=DB_1").setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("use default");
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use default");
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use default");
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("use default");
    assertFalse("user3 shouldn't be able switch to default",true);
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUriPermissions </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testLoadPrivileges() throws Exception {
  dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  loadData="server=server1->uri=file://" + dataFile.getPath();
  String tabName="tab1";
  Connection userConn=null;
  Statement userStmt=null;
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  adminStmt.execute("CREATE TABLE " + tabName + "(id int)");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_read","db1_write","data_read").addRolesToGroup(USERGROUP2,"db1_write").addPermissionsToRole("db1_write","server=server1->db=" + DB1 + "->table="+ tabName+ "->action=INSERT").addPermissionsToRole("db1_read","server=server1->db=" + DB1 + "->table="+ tabName+ "->action=SELECT").addPermissionsToRole("data_read",loadData);
  writePolicyFile(policyFile);
  userConn=context.createConnection(USER1_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  userStmt.execute("load data local inpath 'file://" + dataFile.getPath() + "' into table "+ tabName);
  userStmt.execute("select * from " + tabName + " limit 1");
  ResultSet res=userStmt.getResultSet();
  Assert.assertTrue("Table should have data after load",res.next());
  res.close();
  context.close();
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  context.assertAuthzException(userStmt,"load data local inpath 'file://" + dataFile.getPath() + "' into table "+ tabName);
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUserManagement </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that users without group information will cause the configuration exception
 */
@Test public void testGroup9() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP);
  writePolicyFile(policyFile);
  Connection connection=context.createConnection("admin1");
  Statement statement=connection.createStatement();
  statement.execute("DROP DATABASE IF EXISTS db1 CASCADE");
  statement.execute("CREATE DATABASE db1");
  statement.execute("USE db1");
  statement.execute("CREATE TABLE t1 (under_col int)");
  statement.close();
  connection.close();
  connection=context.createConnection("user1");
  statement=context.createStatement(connection);
  try {
    statement.execute("CREATE TABLE db1.t1 (under_col int, value string)");
    fail("User without group configuration, SentryGroupNotFoundException should be thrown ");
  }
 catch (  HiveSQLException hse) {
    assertTrue(hse.getMessage().indexOf("SentryGroupNotFoundException") >= 0);
  }
  try {
    statement.execute("SELECT under_col from db1.t1");
    fail("User without group configuration, SentryGroupNotFoundException should be thrown ");
  }
 catch (  HiveSQLException hse) {
    assertTrue(hse.getMessage().indexOf("SentryGroupNotFoundException") >= 0);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that user without uri privilege can create table but not load data
 */
@Test public void testGroup4() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addRolesToGroup("group1","non_admin_role","load_data").addPermissionsToRole("non_admin_role","server=server1->db=" + dbName).addGroupsToUser("user1","group1").addGroupsToUser("user2","group1").addGroupsToUser("user3","group1");
  writePolicyFile(policyFile);
  doDropDb("admin1");
  for (  String user : new String[]{"user1","user2","user3"}) {
    doCreateDb("admin1");
    Connection connection=context.createConnection(user);
    Statement statement=context.createStatement(connection);
    statement.execute("USE " + dbName);
    statement.execute("CREATE TABLE " + tableName + " (under_col int comment 'the under column', value string) comment '"+ tableComment+ "'");
    context.assertAuthzException(statement,"LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' into table "+ tableName);
    assertTrue(statement.execute("SELECT * FROM " + tableName));
    statement.close();
    connection.close();
    doDropDb("admin1");
  }
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that users with no privileges cannot list any tables
 */
@Test public void testGroup8() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addRolesToGroup("group1","analytics").addGroupsToUser("user1","group1").addGroupsToUser("user2","group1").addGroupsToUser("user3","group1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection("admin1");
  Statement statement=connection.createStatement();
  statement.execute("DROP DATABASE IF EXISTS db1 CASCADE");
  statement.execute("CREATE DATABASE db1");
  statement.execute("USE db1");
  statement.execute("CREATE TABLE t1 (under_col int, value string)");
  statement.close();
  connection.close();
  String[] users={"user1","user2","user3"};
  for (  String user : users) {
    connection=context.createConnection(user);
    statement=context.createStatement(connection);
    assertFalse("No results should be returned",statement.executeQuery("SHOW TABLES").next());
    statement.close();
    connection.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.TestDocLevelOperations </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Test that queries from different users only return the documents they have access to.
 */
@Test public void testDocLevelOperations() throws Exception {
  String collectionName="docLevelCollection";
  setupCollectionWithDocSecurity(collectionName);
  try {
    createDocsAndQuerySimple(collectionName,true);
    CloudSolrServer server=getCloudSolrServer(collectionName);
    try {
      setAuthenticationUser("junit");
      String fq=URLEncoder.encode(" {!raw f=" + AUTH_FIELD + " v=docLevel_role}");
      String path="/" + collectionName + "/select?q=*:*&fq="+ fq;
      String retValue=makeHttpRequest(server,"GET",path,null,null);
      assertTrue(retValue.contains("numFound=\"" + NUM_DOCS / 2 + "\" "));
      final String syntaxErrorMsg="org.apache.solr.search.SyntaxError: Cannot parse";
      fq=URLEncoder.encode(" {!raw f=" + AUTH_FIELD + " v=docLevel_role} OR ");
      path="/" + collectionName + "/select?q=*:*&fq="+ fq;
      retValue=makeHttpRequest(server,"GET",path,null,null);
      assertTrue(retValue.contains(syntaxErrorMsg));
      fq=URLEncoder.encode(" OR {!raw f=" + AUTH_FIELD + " v=docLevel_role}");
      path="/" + collectionName + "/select?q=*:*&fq="+ fq;
      retValue=makeHttpRequest(server,"GET",path,null,null);
      assertTrue(retValue.contains(syntaxErrorMsg));
    }
  finally {
      server.shutdown();
    }
  }
  finally {
    deleteCollection(collectionName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.TestUpdateOperations </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testInvariantProcessor() throws Exception {
  String collectionName="testInvariantCollection";
  uploadConfigDirToZk(RESOURCES_DIR + File.separator + DEFAULT_COLLECTION+ File.separator+ "conf");
  setupCollection(collectionName);
  setAuthenticationUser("junit");
  CloudSolrServer server=getCloudSolrServer(collectionName);
  try {
    String path="/" + collectionName + "/update?update.chain=skipUpdateIndexAuthorization&commit=true";
    String body="<add><doc><field name=\"id\">testInvariantDoc</field></doc></add>";
    String ret=makeHttpRequest(server,"POST",path,body.getBytes("UTF-8"),"text/xml");
    assertTrue("Expected sentry exception",ret.contains("SentrySolrAuthorizationException: User junit" + " does not have privileges for testInvariantCollection"));
  }
  finally {
    server.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.db.integration.TestSolrAdminOperations </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test when the collection has been deleted, the privileges in the sentry service also should be deleted
 * @throws Exception
 */
@Test public void testSyncPrivilegesWithDeleteCollection() throws Exception {
  uploadConfigDirToZk(COLLECTION_CONFIG_DIR);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.ALL);
  grantCollectionPrivilege(ADMIN_COLLECTION_NAME,ADMIN_USER,"role0",SearchConstants.ALL);
  assertTrue("user0 has one privilege on collection admin",client.listPrivilegesByRoleName("user0","role0",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(ADMIN_COLLECTION_NAME))).size() == 1);
  assertTrue("user0 has one privilege on collection collection1",client.listPrivilegesByRoleName("user0","role0",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 1);
  client.listPrivilegesByRoleName("user0","role0",COMPONENT_SOLR,CLUSTER_NAME,null);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role1",SearchConstants.ALL);
  assertTrue("user1 has one privilege record",client.listPrivilegesByRoleName("user1","role1",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 1);
  setupCollection(TEST_COLLECTION_NAME1);
  deleteCollection(TEST_COLLECTION_NAME1);
  assertTrue("user0 has one privilege on collection admin",client.listPrivilegesByRoleName("user0","role0",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(ADMIN_COLLECTION_NAME))).size() == 1);
  assertTrue("user0 has no privilege on collection collection1",client.listPrivilegesByRoleName("user0","role0",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 0);
  assertTrue("user1 has no privilege on collection collection1",client.listPrivilegesByRoleName("user1","role1",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 0);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.UPDATE);
  assertTrue("user2 has one privilege on collection collection1",client.listPrivilegesByRoleName("user2","role2",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 1);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role3",SearchConstants.QUERY);
  assertTrue("user1 has one privilege record",client.listPrivilegesByRoleName("user3","role3",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 1);
  setupCollection(TEST_COLLECTION_NAME1);
  deleteCollection(TEST_COLLECTION_NAME1);
  assertTrue("user2 has no privilege on collection collection1",client.listPrivilegesByRoleName("user2","role2",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 0);
  assertTrue("user3 has no privilege on collection collection1",client.listPrivilegesByRoleName("user3","role3",COMPONENT_SOLR,CLUSTER_NAME,Arrays.asList(new Collection(TEST_COLLECTION_NAME1))).size() == 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestConnectorEndToEnd </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testShowAllConnector() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role3.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() > 0);
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testShowSpecificConnector() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MConnector hdfsConnector=client.getConnector(HDFS_CONNECTOR_NAME);
  MConnector jdbcConnector=client.getConnector(JDBC_CONNECTOR_NAME);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrivilege readHdfsPriv=new MPrivilege(new MResource(String.valueOf(hdfsConnector.getPersistenceId()),MResource.TYPE.CONNECTOR),SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readHdfsPriv));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MPrivilege readJdbcPriv=new MPrivilege(new MResource(String.valueOf(jdbcConnector.getPersistenceId()),MResource.TYPE.CONNECTOR),SqoopActionConstant.READ,false);
  client.createRole(role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readJdbcPriv));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getConnectors().size() == 1);
  assertTrue(client.getConnector(HDFS_CONNECTOR_NAME) != null);
  assertTrue(client.getConnector(JDBC_CONNECTOR_NAME) == null);
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getConnectors().size() == 1);
  assertTrue(client.getConnector(JDBC_CONNECTOR_NAME) != null);
  assertTrue(client.getConnector(HDFS_CONNECTOR_NAME) == null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestGrantPrivilege </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testGrantPrivilege() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1Princ=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrincipal role1Princ=new MPrincipal(ROLE1,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1Princ));
  client.grantPrivilege(Lists.newArrayList(role1Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getPrivilegesByPrincipal(role1Princ,allConnector).size() == 1);
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantALLPrivilegeWithOtherPrivilegesExist() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4Princ=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MPrincipal role4Princ=new MPrincipal(ROLE4,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4Princ));
  client.grantPrivilege(Lists.newArrayList(role4Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getPrivilegesByPrincipal(role4Princ,allConnector).size() == 1);
  MPrivilege user4Privilege=client.getPrivilegesByPrincipal(role4Princ,allConnector).get(0);
  assertEquals(user4Privilege.getAction().toLowerCase(),SqoopActionConstant.READ);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrivilege writePrivilege=new MPrivilege(allConnector,SqoopActionConstant.WRITE,false);
  client.grantPrivilege(Lists.newArrayList(role4Princ),Lists.newArrayList(writePrivilege));
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getPrivilegesByPrincipal(role4Princ,allConnector).size() == 2);
  List<String> actions=Lists.newArrayList();
  for (  MPrivilege privilege : client.getPrivilegesByPrincipal(role4Princ,allConnector)) {
    actions.add(privilege.getAction().toLowerCase());
  }
  assertEquals(2,actions.size());
  assertTrue(actions.contains(SqoopActionConstant.READ));
  assertTrue(actions.contains(SqoopActionConstant.WRITE));
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrivilege allPrivilege=new MPrivilege(allConnector,SqoopActionConstant.ALL_NAME,false);
  client.grantPrivilege(Lists.newArrayList(role4Princ),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getPrivilegesByPrincipal(role4Princ,allConnector).size() == 1);
  user4Privilege=client.getPrivilegesByPrincipal(role4Princ,allConnector).get(0);
  assertEquals(user4Privilege.getAction(),SqoopActionConstant.ALL_NAME);
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testGrantPrivilegeTwice() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role2=new MRole(ROLE2);
  MPrincipal group2Princ=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MPrincipal role2Princ=new MPrincipal(ROLE2,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege writePrivilege=new MPrivilege(allConnector,SqoopActionConstant.WRITE,false);
  client.createRole(role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2Princ));
  client.grantPrivilege(Lists.newArrayList(role2Princ),Lists.newArrayList(writePrivilege));
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getPrivilegesByPrincipal(role2Princ,allConnector).size() == 1);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.grantPrivilege(Lists.newArrayList(role2Princ),Lists.newArrayList(writePrivilege));
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getPrivilegesByPrincipal(role2Princ,allConnector).size() == 1);
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantPrivilegeWithAllPrivilegeExist() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3Princ=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MPrincipal role3Princ=new MPrincipal(ROLE3,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege allPrivilege=new MPrivilege(allConnector,SqoopActionConstant.ALL_NAME,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3Princ));
  client.grantPrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  MPrivilege user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction(),SqoopActionConstant.ALL_NAME);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.grantPrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction(),SqoopActionConstant.ALL_NAME);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestJobEndToEnd </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateDeleteJob() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  rdbmsLink.setName("rdbm_testUpdateJob");
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  hdfsLink.setName("hdfs_testUpdateJob");
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job2=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job2);
  sqoopServerRunner.fillRdbmsToConfig(job2);
  sqoopServerRunner.saveJob(client,job2);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource job2Resource=new MResource(String.valueOf(job2.getPersistenceId()),MResource.TYPE.JOB);
  MPrivilege writeJob2Privilege=new MPrivilege(job2Resource,SqoopActionConstant.WRITE,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readLinkPriv=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  client.createRole(role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeJob2Privilege,readConnectorPriv,readLinkPriv));
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    assertTrue(client.getJobs().size() == 0);
    client.getJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    job2.setName("job2_update_user4_1");
    client.updateJob(job2);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getJobs().size() == 0);
    job2.setName("job2_update_user3_1");
    client.updateJob(job2);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.deleteJob(job2.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.deleteJob(job2.getPersistenceId());
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.dropRole(role4);
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowJob() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allJob=new MResource(SqoopActionConstant.ALL,MResource.TYPE.JOB);
  MPrivilege readAllPrivilege=new MPrivilege(allJob,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readAllPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MResource job1Resource=new MResource(String.valueOf(job1.getPersistenceId()),MResource.TYPE.JOB);
  MPrivilege readJob1Privilege=new MPrivilege(job1Resource,SqoopActionConstant.READ,false);
  client.createRole(role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readJob1Privilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getJobs().size() == 1);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    assertTrue(client.getJobs().size() == 1);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getJobs().size() == 0);
    client.getJob(job1.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.deleteJob(job1.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestLinkEndToEnd </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateDtestUpdateDeleteLinkeleteLink() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MRole role4=new MRole(ROLE4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  MResource hdfsLinkResource=new MResource(String.valueOf(hdfsLink.getPersistenceId()),MResource.TYPE.LINK);
  MPrivilege writeHdfsPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.WRITE,false);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readConnectorPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role4);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role4.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writeHdfsPrivilege,readConnectorPriv));
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    assertTrue(client.getLinks().size() == 0);
    client.getLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    hdfsLink.setName("hdfs_link_update_user4_1");
    client.updateLink(hdfsLink);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getLinks().size() == 0);
    hdfsLink.setName("hdfs_link_update_user3_1");
    client.updateLink(hdfsLink);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    client.deleteLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER4);
  try {
    client.deleteLink(hdfsLink.getPersistenceId());
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.dropRole(role4);
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowLink() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readAllPrivilege=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readAllPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MResource hdfsLinkResource=new MResource(String.valueOf(hdfsLink.getPersistenceId()),MResource.TYPE.LINK);
  MPrivilege readHdfsLinkPrivilege=new MPrivilege(hdfsLinkResource,SqoopActionConstant.READ,false);
  dropAndCreateRole(client,role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readHdfsLinkPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getLinks().size() == 1);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    assertTrue(client.getLinks().size() == 1);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getLinks().size() == 0);
    client.getLink(hdfsLink.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.deleteLink(hdfsLink.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestOwnerPrivilege </h4><pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJobOwner() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(ROLE3,MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getConnectors().size() > 0);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  assertTrue(client.getLinks().size() == 2);
  hdfsLink.setName("HDFS_update2");
  client.updateLink(hdfsLink);
  rdbmsLink.setName("RDBM_update");
  client.updateLink(rdbmsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getJobs().size() == 0);
  try {
    client.deleteJob(job1.getPersistenceId());
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertEquals(client.getJob(job1.getPersistenceId()),job1);
  client.deleteJob(job1.getPersistenceId());
  client.deleteLink(hdfsLink.getPersistenceId());
  client.deleteLink(rdbmsLink.getPersistenceId());
}

</code></pre>

<br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLinkOwner() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getConnectors().size() == 0);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getConnectors().size() > 0);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  assertEquals(client.getLink(hdfsLink.getPersistenceId()),hdfsLink);
  hdfsLink.setName("HDFS_update1");
  sqoopServerRunner.updateLink(client,hdfsLink);
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getLinks().size() == 0);
  client=sqoopServerRunner.getSqoopClient(USER1);
  client.deleteLink(hdfsLink.getPersistenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestRevokePrivilege </h4><pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRevokePrivilegeWithAllPrivilegeExist() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  MPrincipal group3Princ=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MPrincipal role3Princ=new MPrincipal(ROLE3,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege allPrivilege=new MPrivilege(allConnector,SqoopActionConstant.ALL_NAME,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3Princ));
  client.grantPrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  MPrivilege user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction(),SqoopActionConstant.ALL_NAME);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.revokePrivilege(Lists.newArrayList(role3Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getPrivilegesByPrincipal(role3Princ,allConnector).size() == 1);
  user3Privilege=client.getPrivilegesByPrincipal(role3Princ,allConnector).get(0);
  assertEquals(user3Privilege.getAction().toLowerCase(),SqoopActionConstant.WRITE);
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testRevokeNotExistPrivilege() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole testRole=new MRole("noexist_privilege_role1");
  MPrincipal testPrinc=new MPrincipal(testRole.getName(),MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(testRole);
  assertTrue(client.getPrivilegesByPrincipal(testPrinc,allConnector).size() == 0);
  client.revokePrivilege(Lists.newArrayList(testPrinc),Lists.newArrayList(readPrivilege));
  assertTrue(client.getPrivilegesByPrincipal(testPrinc,allConnector).size() == 0);
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRevokeAllPrivilege() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role2=new MRole(ROLE2);
  MPrincipal group2Princ=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MPrincipal role2Princ=new MPrincipal(ROLE2,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege writePrivilege=new MPrivilege(allConnector,SqoopActionConstant.WRITE,false);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role2);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2Princ));
  client.grantPrivilege(Lists.newArrayList(role2Princ),Lists.newArrayList(writePrivilege,readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getPrivilegesByPrincipal(role2Princ,allConnector).size() == 2);
  MPrivilege allPrivilege=new MPrivilege(allConnector,SqoopActionConstant.ALL_NAME,false);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.revokePrivilege(Lists.newArrayList(role2Princ),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER2);
  assertTrue(client.getPrivilegesByPrincipal(role2Princ,allConnector).size() == 0);
}

</code></pre>

<br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRevokePrivilege() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1Princ=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrincipal role1Princ=new MPrincipal(ROLE1,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPrivilege=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1Princ));
  client.grantPrivilege(Lists.newArrayList(role1Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getPrivilegesByPrincipal(role1Princ,allConnector).size() == 1);
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.revokePrivilege(Lists.newArrayList(role1Princ),Lists.newArrayList(readPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getPrivilegesByPrincipal(role1Princ,allConnector).size() == 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestRoleOperation </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleOnGroup() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role3=new MRole(ROLE3);
  client.createRole(role3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  MRole role4=new MRole(ROLE4);
  client.createRole(role4);
  MPrincipal group4=new MPrincipal(GROUP4,MPrincipal.TYPE.GROUP);
  client.grantRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertEquals(role3.getName(),client.getRolesByPrincipal(group3).get(0).getName());
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertEquals(role4.getName(),client.getRolesByPrincipal(group4).get(0).getName());
  client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.revokeRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.revokeRole(Lists.newArrayList(role4),Lists.newArrayList(group4));
  client=sqoopServerRunner.getSqoopClient(USER3);
  assertTrue(client.getRolesByPrincipal(group3).isEmpty());
  client=sqoopServerRunner.getSqoopClient(USER4);
  assertTrue(client.getRolesByPrincipal(group4).isEmpty());
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testAdminShowAllRole() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  client.createRole(new MRole("show_all_role"));
  assertTrue(client.getRoles().size() > 0);
}

</code></pre>

<br>
<pre class="type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testAdminToCreateDeleteRole() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole("create_delete_role_1");
  MRole role2=new MRole("create_delete_role_2");
  client.createRole(role1);
  client.createRole(role2);
  assertTrue(client.getRoles().size() > 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestServerScopeEndToEnd </h4><pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServerScopePrivilege() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MLink rdbmsLink=client.createLink("generic-jdbc-connector");
  sqoopServerRunner.fillRdbmsLinkConfig(rdbmsLink);
  sqoopServerRunner.saveLink(client,rdbmsLink);
  MLink hdfsLink=client.createLink("hdfs-connector");
  sqoopServerRunner.fillHdfsLink(hdfsLink);
  sqoopServerRunner.saveLink(client,hdfsLink);
  MJob job1=client.createJob(hdfsLink.getPersistenceId(),rdbmsLink.getPersistenceId());
  sqoopServerRunner.fillHdfsFromConfig(job1);
  sqoopServerRunner.fillRdbmsToConfig(job1);
  sqoopServerRunner.saveJob(client,job1);
  MResource sqoopServer1=new MResource(SQOOP_SERVER_NAME,MResource.TYPE.SERVER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrivilege readPrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role1.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(readPrivilege));
  MRole role2=new MRole(ROLE2);
  MPrincipal group2=new MPrincipal(GROUP2,MPrincipal.TYPE.GROUP);
  MPrivilege writePrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.WRITE,false);
  client.createRole(role2);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MResource allLink=new MResource(SqoopActionConstant.ALL,MResource.TYPE.LINK);
  MPrivilege readAllConPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  MPrivilege readAllLinkPriv=new MPrivilege(allLink,SqoopActionConstant.READ,false);
  client.grantRole(Lists.newArrayList(role2),Lists.newArrayList(group2));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role2.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(writePrivilege,readAllConPriv,readAllLinkPriv));
  MRole role3=new MRole(ROLE3);
  MPrincipal group3=new MPrincipal(GROUP3,MPrincipal.TYPE.GROUP);
  MPrivilege allPrivilege=new MPrivilege(sqoopServer1,SqoopActionConstant.ALL_NAME,false);
  client.createRole(role3);
  client.grantRole(Lists.newArrayList(role3),Lists.newArrayList(group3));
  client.grantPrivilege(Lists.newArrayList(new MPrincipal(role3.getName(),MPrincipal.TYPE.ROLE)),Lists.newArrayList(allPrivilege));
  client=sqoopServerRunner.getSqoopClient(USER1);
  try {
    assertTrue(client.getConnector("generic-jdbc-connector") != null);
    assertTrue(client.getConnector("hdfs-connector") != null);
    assertTrue(client.getConnectors().size() > 0);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
    assertTrue(client.getLink(rdbmsLink.getPersistenceId()) != null);
    assertTrue(client.getLinks().size() == 2);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
    assertTrue(client.getJobs().size() == 1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  try {
    hdfsLink.setName("hdfs1_update_user1");
    client.updateLink(hdfsLink);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  try {
    job1.setName("job1_update_user1");
    client.updateJob(job1);
    fail("expected Authorization exception happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,SecurityError.AUTH_0014.getMessage());
  }
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    hdfsLink.setName("hdfs1_update_user2");
    client.updateLink(hdfsLink);
    job1.setName("job1_update_user2");
    client.updateJob(job1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
  assertTrue(client.getJobs().size() == 0);
  client=sqoopServerRunner.getSqoopClient(USER3);
  try {
    assertTrue(client.getConnector("generic-jdbc-connector") != null);
    assertTrue(client.getConnector("hdfs-connector") != null);
    assertTrue(client.getConnectors().size() > 0);
    assertTrue(client.getLink(hdfsLink.getPersistenceId()) != null);
    assertTrue(client.getLink(rdbmsLink.getPersistenceId()) != null);
    assertTrue(client.getLinks().size() == 2);
    assertTrue(client.getJob(job1.getPersistenceId()) != null);
    assertTrue(client.getJobs().size() == 1);
    hdfsLink.setName("hdfs1_update_user3");
    client.updateLink(hdfsLink);
    job1.setName("job1_update_user3");
    client.updateJob(job1);
  }
 catch (  Exception e) {
    fail("unexpected Authorization exception happend");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.sqoop.TestShowPrivilege </h4><pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowPrivileges() throws Exception {
  SqoopClient client=sqoopServerRunner.getSqoopClient(ADMIN_USER);
  MRole role1=new MRole(ROLE1);
  MPrincipal group1Princ=new MPrincipal(GROUP1,MPrincipal.TYPE.GROUP);
  MPrincipal role1Princ=new MPrincipal(ROLE1,MPrincipal.TYPE.ROLE);
  MResource allConnector=new MResource(SqoopActionConstant.ALL,MResource.TYPE.CONNECTOR);
  MPrivilege readPriv=new MPrivilege(allConnector,SqoopActionConstant.READ,false);
  client.createRole(role1);
  client.grantRole(Lists.newArrayList(role1),Lists.newArrayList(group1Princ));
  client.grantPrivilege(Lists.newArrayList(role1Princ),Lists.newArrayList(readPriv));
  client=sqoopServerRunner.getSqoopClient(USER1);
  assertTrue(client.getPrivilegesByPrincipal(role1Princ,allConnector).size() == 1);
  client=sqoopServerRunner.getSqoopClient(USER2);
  try {
    client.getPrivilegesByPrincipal(role1Princ,allConnector);
    fail("expected SentryAccessDeniedException happend");
  }
 catch (  Exception e) {
    assertCausedMessage(e,"SentryAccessDeniedException");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.admin.SecureAdminHandlersTest </h4><pre class="type-16 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test public void testAllAdminHandlersSecured() throws Exception {
  int numFound=0;
  for (  Map.Entry<String,SolrRequestHandler> entry : core.getRequestHandlers().entrySet()) {
    if (entry.getKey().startsWith("/admin/") && !(entry.getValue() instanceof ShowFileRequestHandler)) {
      assertTrue(entry.getValue().getClass().getEnclosingClass().equals(SecureAdminHandlers.class));
      ++numFound;
    }
  }
  assertTrue(numFound > 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.admin.SecureCoreAdminHandlerTest </h4><pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testAllActionsChecked() throws Exception {
  for (  CoreAdminAction action : CoreAdminAction.values()) {
    assertTrue(QUERY_ACTIONS.contains(action) || UPDATE_ACTIONS.contains(action));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.component.QueryDocAuthorizationComponentTest </h4><pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a request from a user coming from an empty group.
 * This request should be rejected because otherwise document-level
 * filtering will be skipped.
 */
@Test public void testEmptyGroup() throws Exception {
  String user="bogusUser";
  try {
    NamedList args=new NamedList();
    args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
    ResponseBuilder builder=runComponent(user,args,null);
    checkParams(null,builder);
    Assert.fail("Expected SolrException");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    assertTrue(ex.getMessage().contains(user + " rejected because user is not associated with any roles"));
  }
}

</code></pre>

<br>
<pre class="type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a request from a user coming from an empty role.
 * This request should be rejected because otherwise document-level
 * filtering will be skipped.
 */
@Test public void testEmptyRole() throws Exception {
  String user="undefinedRoleUser";
  try {
    NamedList args=new NamedList();
    args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
    ResponseBuilder builder=runComponent(user,args,null);
    checkParams(null,builder);
    Assert.fail("Expected SolrException");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
    assertTrue(ex.getMessage().contains(user + " rejected because user is not associated with any roles"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.sentry.SentryIndexAuthorizationSingletonTest </h4><pre class="type-5 type-7 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting the roles from user name
 */
@Test public void testGetRoles() throws Exception {
  Collection<String> emptyCollection=ImmutableSet.<String>of();
  try {
    sentryInstance.getRoles(null);
    Assert.fail("Excepted SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  try {
    sentryInstance.getRoles("withoutGroupUser");
    Assert.fail("Excepted SentryGroupNotFoundException");
  }
 catch (  SentryGroupNotFoundException e) {
  }
  Collection<String> roles=sentryInstance.getRoles("undefinedRoleUser");
  assertTrue(CollectionUtils.isEqualCollection(emptyCollection,roles));
  Collection<String> singleRole=ImmutableSet.<String>of("junit_role");
  roles=sentryInstance.getRoles("junit");
  assertTrue(CollectionUtils.isEqualCollection(singleRole,roles));
  Collection<String> multipleRoles=ImmutableSet.<String>of("junit_role","queryOnlyAdmin_role","updateOnlyAdmin_role");
  roles=sentryInstance.getRoles("multiGroupUser");
  assertTrue(CollectionUtils.isEqualCollection(multipleRoles,roles));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.update.processor.UpdateIndexAuthorizationProcessorTest </h4><pre class="type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure no new methods have been added to base class that are not invoking
 * Sentry
 */
@Test public void testAllMethodsChecked() throws Exception {
  Method[] methods=UpdateRequestProcessor.class.getDeclaredMethods();
  TreeSet<String> foundNames=new TreeSet<String>();
  for (  Method method : methods) {
    if (Modifier.isPublic(method.getModifiers())) {
      foundNames.add(method.getName());
    }
  }
  assertEquals(methodNames.size(),foundNames.size());
  assertTrue(foundNames.containsAll(methodNames));
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
