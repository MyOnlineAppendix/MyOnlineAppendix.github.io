<h3><span class=" glyphicon glyphicon-tag"/>&nbspAPIUtilityVerifier</h3><kbd>Verifies values of objects/variables related to API calls (Java or TPL) </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestHAUpdateForwarder </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testThriftSerializer() throws Exception {
  List<String> addGroups=Lists.newArrayList("g1","g2","g3");
  List<String> delGroups=Lists.newArrayList("d1","d2","d3");
  String roleName="testRole1";
  TRoleChanges roleUpdate=new TRoleChanges(roleName,addGroups,delGroups);
  TRoleChanges newRoleUpdate=(TRoleChanges)ThriftSerializer.deserialize(roleUpdate,ThriftSerializer.serialize(roleUpdate));
  assertEquals(roleUpdate,newRoleUpdate);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestHMSPathsFullDump </h4><pre class="type-12 type-7 type-6 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDumpAndInitialize(){
  HMSPaths hmsPaths=new HMSPaths(new String[]{"/user/hive/warehouse","/user/hive/w2"});
  hmsPaths._addAuthzObject("default",Lists.newArrayList("/user/hive/warehouse"));
  hmsPaths._addAuthzObject("db1",Lists.newArrayList("/user/hive/warehouse/db1"));
  hmsPaths._addAuthzObject("db1.tbl11",Lists.newArrayList("/user/hive/warehouse/db1/tbl11"));
  hmsPaths._addPathsToAuthzObject("db1.tbl11",Lists.newArrayList("/user/hive/warehouse/db1/tbl11/part111","/user/hive/warehouse/db1/tbl11/part112","/user/hive/warehouse/db1/tbl11/p1=1/p2=x"));
  hmsPaths._addAuthzObject("db2",Lists.newArrayList("/user/hive/w2/db2"));
  hmsPaths._addAuthzObject("db2.tbl21",Lists.newArrayList("/user/hive/w2/db2/tbl21"));
  hmsPaths._addPathsToAuthzObject("db2.tbl21",Lists.newArrayList("/user/hive/w2/db2/tbl21/p1=1/p2=x"));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("default")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part111"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part112"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","p1=1","p2=x"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","p1=1"},true));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db2.tbl21")),hmsPaths.findAuthzObject(new String[]{"user","hive","w2","db2","tbl21","p1=1"},true));
  HMSPathsDumper serDe=hmsPaths.getPathsDump();
  TPathsDump pathsDump=serDe.createPathsDump();
  HMSPaths hmsPaths2=new HMSPaths(new String[]{"/user/hive/warehouse"}).getPathsDump().initializeFromDump(pathsDump);
  Assert.assertEquals(new HashSet<String>(Arrays.asList("default")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part111"},false));
  Assert.assertEquals(new HashSet<String>(Arrays.asList("db1.tbl11")),hmsPaths2.findAuthzObject(new String[]{"user","hive","warehouse","db1","tbl11","part112"},false));
  Assert.assertNull(hmsPaths2.findAuthzObject(new String[]{"user","hive","w2","db2","tbl21","p1=1"},true));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestPluginCacheSync </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void pluginCacheGC() throws Exception {
  pluginCache=new PluginCacheSyncUtil(TEST_ZPATH,conf,new TestCacheListener());
  for (int updCount=1; updCount <= PluginCacheSyncUtil.CACHE_GC_SIZE_THRESHOLD_HWM + 2; updCount++) {
    DummyUpdate dummyUpdate=new DummyUpdate();
    dummyUpdate.setSeqNum(updCount);
    dummyUpdate.setState("foo");
    pluginCache.handleCacheUpdate(dummyUpdate);
  }
  pluginCache.gcPluginCache(conf);
  HAContext haContext=HAContext.getHAContext(conf);
  List<String> znodeList=haContext.getCuratorFramework().getChildren().forPath(TEST_ZPATH + "/cache");
  assertFalse(znodeList.isEmpty());
  assertFalse(znodeList.contains(String.valueOf(PluginCacheSyncUtil.GC_COUNTER_INIT_VALUE)));
  assertFalse(znodeList.contains(String.valueOf(PluginCacheSyncUtil.GC_COUNTER_INIT_VALUE + 1)));
  assertTrue(znodeList.contains(String.valueOf(PluginCacheSyncUtil.CACHE_GC_SIZE_THRESHOLD_HWM)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestUpdateForwarder </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetUpdates() throws Exception {
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,5);
  updateForwarder.handleUpdateNotification(new DummyUpdate(5,false).setState("d"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(5,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(2,allUpdates.size());
  updateForwarder.handleUpdateNotification(new DummyUpdate(6,false).setState("e"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(7,false).setState("f"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(7,updateForwarder.getLastUpdatedSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(4,allUpdates.size());
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  Assert.assertEquals(4,allUpdates.get(0).getSeqNum());
  Assert.assertEquals("d",allUpdates.get(1).getState());
  Assert.assertEquals(5,allUpdates.get(1).getSeqNum());
  Assert.assertEquals("e",allUpdates.get(2).getState());
  Assert.assertEquals(6,allUpdates.get(2).getSeqNum());
  Assert.assertEquals("f",allUpdates.get(3).getState());
  Assert.assertEquals(7,allUpdates.get(3).getSeqNum());
  updateForwarder.handleUpdateNotification(new DummyUpdate(8,false).setState("g"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(8,updateForwarder.getLastUpdatedSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(8);
  Assert.assertEquals(1,allUpdates.size());
  Assert.assertEquals("g",allUpdates.get(0).getState());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-14 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateReceiveWithNullImageRetriver() throws Exception {
  Assume.assumeTrue(!testConf.getBoolean(ServerConfig.SENTRY_HA_ENABLED,false));
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),null,5);
  updateForwarder.handleUpdateNotification(new DummyUpdate(-1,true).setState("a"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(1);
  Assert.assertEquals("a",allUpdates.get(0).getState());
  updateForwarder.handleUpdateNotification(new DummyUpdate(6,false).setState("b"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  updateForwarder.handleUpdateNotification(new DummyUpdate(7,false).setState("c"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(7,updateForwarder.getLastUpdatedSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(2,allUpdates.size());
  Assert.assertEquals("b",allUpdates.get(0).getState());
  Assert.assertEquals("c",allUpdates.get(1).getState());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUpdateReceive() throws Exception {
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,5);
  updateForwarder.handleUpdateNotification(new DummyUpdate(5,false).setState("d"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(5,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(2,allUpdates.size());
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  Assert.assertEquals("d",allUpdates.get(1).getState());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUpdateLogCompression() throws Exception {
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,5);
  updateForwarder.handleUpdateNotification(new DummyUpdate(5,false).setState("d"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(5,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(2,allUpdates.size());
  updateForwarder.handleUpdateNotification(new DummyUpdate(6,false).setState("e"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(7,false).setState("f"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(8,false).setState("g"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(9,false).setState("h"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(10,false).setState("i"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(11,false).setState("j"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(11,updateForwarder.getLastUpdatedSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(3,allUpdates.size());
  Assert.assertEquals("a,b,c,d,e,f,g,h",allUpdates.get(0).getState());
  Assert.assertEquals(9,allUpdates.get(0).getSeqNum());
  Assert.assertEquals("i",allUpdates.get(1).getState());
  Assert.assertEquals(10,allUpdates.get(1).getSeqNum());
  Assert.assertEquals("j",allUpdates.get(2).getState());
  Assert.assertEquals(11,allUpdates.get(2).getSeqNum());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInit() throws Exception {
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,10);
  Assert.assertEquals(-2,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertTrue(allUpdates.size() == 1);
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  allUpdates=updateForwarder.getAllUpdatesFrom(100);
  Assert.assertTrue(allUpdates.size() == 1);
  Assert.assertEquals("a,b,c",allUpdates.get(0).getState());
  Assert.assertEquals(-2,allUpdates.get(0).getSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(-1);
  Assert.assertEquals(0,allUpdates.size());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-14 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetUpdatesAfterExternalEntityReset() throws Exception {
  Assume.assumeTrue(!testConf.getBoolean(ServerConfig.SENTRY_HA_ENABLED,false));
  DummyImageRetreiver imageRetreiver=new DummyImageRetreiver();
  imageRetreiver.setState("a,b,c");
  updateForwarder=UpdateForwarder.create(testConf,new DummyUpdatable(),new DummyUpdate(),imageRetreiver,5);
  updateForwarder.handleUpdateNotification(new DummyUpdate(5,false).setState("d"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  updateForwarder.handleUpdateNotification(new DummyUpdate(6,false).setState("e"));
  updateForwarder.handleUpdateNotification(new DummyUpdate(7,false).setState("f"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(7,updateForwarder.getLastUpdatedSeqNum());
  List<DummyUpdate> allUpdates=updateForwarder.getAllUpdatesFrom(0);
  Assert.assertEquals(4,allUpdates.size());
  Assert.assertEquals("f",allUpdates.get(3).getState());
  Assert.assertEquals(7,allUpdates.get(3).getSeqNum());
  updateForwarder.handleUpdateNotification(new DummyUpdate(8,false).setState("g"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  Assert.assertEquals(8,updateForwarder.getLastUpdatedSeqNum());
  allUpdates=updateForwarder.getAllUpdatesFrom(8);
  Assert.assertEquals(1,allUpdates.size());
  Assert.assertEquals("g",allUpdates.get(0).getState());
  imageRetreiver.setState("a,b,c,d,e,f,g,h");
  updateForwarder.handleUpdateNotification(new DummyUpdate(1,false).setState("h"));
  while (!updateForwarder.areAllUpdatesCommited()) {
    Thread.sleep(100);
  }
  allUpdates=updateForwarder.getAllUpdatesFrom(9);
  Assert.assertEquals(1,allUpdates.size());
  Assert.assertEquals("a,b,c,d,e,f,g,h",allUpdates.get(0).getState());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.AbstractTestSimplePolicyEngine </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAdmin() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(PERM_SERVER1_ADMIN));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getAllPrivileges(set("admin"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAnalyst() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(PERM_SERVER1_CUSTOMERS_SELECT,PERM_SERVER1_ANALYST_ALL,PERM_SERVER1_JUNIOR_ANALYST_READ));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getAllPrivileges(set("analyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOtherGroup() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(PERM_SERVER1_OTHER_GROUP_DB_CUSTOMERS_SELECT));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getAllPrivileges(set("other_group"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDbAllforOtherGroup() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(PERM_SERVER1_OTHER_GROUP_DB_CUSTOMERS_SELECT));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getAllPrivileges(set("other_group"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDbAll() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(PERM_SERVER1_JUNIOR_ANALYST_ALL,PERM_SERVER1_CUSTOMERS_DB_CUSTOMERS_PARTIAL_SELECT));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getAllPrivileges(set("jranalyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testManager() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(PERM_SERVER1_CUSTOMERS_SELECT,PERM_SERVER1_ANALYST_ALL,PERM_SERVER1_JUNIOR_ANALYST_ALL,PERM_SERVER1_JUNIOR_ANALYST_READ,PERM_SERVER1_CUSTOMERS_DB_CUSTOMERS_PARTIAL_SELECT));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getAllPrivileges(set("manager"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testJuniorAnalyst() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(PERM_SERVER1_JUNIOR_ANALYST_ALL,PERM_SERVER1_CUSTOMERS_DB_CUSTOMERS_PARTIAL_SELECT));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getAllPrivileges(set("jranalyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestPolicyParsingNegative </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPerDbFileCannotContainUsersOrDatabases() throws Exception {
  PolicyEngine policy;
  ImmutableSet<String> permissions;
  PolicyFile policyFile;
  policyFile=PolicyFile.setAdminOnServer1("admin");
  policyFile.addGroupsToUser("admin1","admin");
  policyFile.write(globalPolicyFile);
  policyFile.write(otherPolicyFile);
  policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  permissions=policy.getAllPrivileges(Sets.newHashSet("admin"),ActiveRoleSet.ALL);
  Assert.assertEquals(permissions.toString(),"[server=server1]");
  policyFile.addDatabase("other",otherPolicyFile.getPath());
  policyFile.write(globalPolicyFile);
  policyFile.write(otherPolicyFile);
  policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  permissions=policy.getAllPrivileges(Sets.newHashSet("admin"),ActiveRoleSet.ALL);
  Assert.assertEquals(permissions.toString(),"[server=server1]");
  policyFile.removeGroupsFromUser("admin1","admin").write(otherPolicyFile);
  policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  permissions=policy.getAllPrivileges(Sets.newHashSet("admin"),ActiveRoleSet.ALL);
  Assert.assertEquals(permissions.toString(),"[server=server1]");
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testAll() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = *",globalPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerAll() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=*",globalPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDatabaseRequiredInRole() throws Exception {
  append("[databases]",globalPolicyFile);
  append("other_group_db = " + otherPolicyFile.getPath(),globalPolicyFile);
  append("[groups]",otherPolicyFile);
  append("other_group = malicious_role",otherPolicyFile);
  append("[roles]",otherPolicyFile);
  append("malicious_role = server=server1",otherPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create policy file with multiple per db files.
 * Verify that a file with bad format is the only one that's ignored
 * @throws Exception
 */
@Test public void testMultiDbWithErrors() throws Exception {
  File db1PolicyFile=new File(baseDir,"db1.ini");
  File db2PolicyFile=new File(baseDir,"db2.ini");
  append("[databases]",globalPolicyFile);
  append("db1 = " + db1PolicyFile.getPath(),globalPolicyFile);
  append("db2 = " + db2PolicyFile.getPath(),globalPolicyFile);
  append("[groups]",globalPolicyFile);
  append("db3_group = db3_rule",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("db3_rule = server=server1->db=db3->table=sales->action=select",globalPolicyFile);
  append("[groups]",db1PolicyFile);
  append("db1_group = bad_rule",db1PolicyFile);
  append("[roles]",db1PolicyFile);
  append("bad_rule = server=server1->db=customers->=purchases->action=",db1PolicyFile);
  append("[groups]",db2PolicyFile);
  append("db2_group = db2_rule",db2PolicyFile);
  append("[roles]",db2PolicyFile);
  append("db2_rule = server=server1->db=db2->table=purchases->action=select",db2PolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("db1_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
  permissions=policy.getAllPrivileges(Sets.newHashSet("db2_group"),ActiveRoleSet.ALL);
  Assert.assertEquals(permissions.toString(),1,permissions.size());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=server2",globalPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUnauthorizedDbSpecifiedInDBPolicyFile() throws Exception {
  append("[databases]",globalPolicyFile);
  append("other_group_db = " + otherPolicyFile.getPath(),globalPolicyFile);
  append("[groups]",otherPolicyFile);
  append("other_group = malicious_role",otherPolicyFile);
  append("[roles]",otherPolicyFile);
  append("malicious_role = server=server1->db=customers->table=purchases->action=select",otherPolicyFile);
  PolicyEngine policy=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestResourceAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Server server1=new Server("server1");
  AccessURI uri=new AccessURI("file:///path/to/");
  Set<? extends Action> actions=EnumSet.of(DBModelAction.ALL,DBModelAction.SELECT,DBModelAction.INSERT);
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"server=" + server1.getName() + "->uri="+ uri.getName(),"server=" + server1.getName() + "->uri="+ uri.getName());
  policyFile.write(iniFile);
  DBPolicyFileBackend policy=new DBPolicyFileBackend(server1.getName(),initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNonAbolutePath() throws Exception {
  Subject user1=new Subject("user1");
  Server server1=new Server("server1");
  AccessURI uri=new AccessURI("file:///path/to/");
  Set<? extends Action> actions=EnumSet.of(DBModelAction.ALL,DBModelAction.SELECT,DBModelAction.INSERT);
  policyFile.addGroupsToUser(user1.getName(),"group1").addRolesToGroup("group1","role1").addPermissionsToRole("role1","server=" + server1.getName() + "->uri="+ uri.getName());
  policyFile.write(iniFile);
  DBPolicyFileBackend policy=new DBPolicyFileBackend(server1.getName(),initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/./");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/../");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/../../");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
  uri=new AccessURI("file:///path/to/dir/../../");
  authorizableHierarchy=ImmutableList.of(server1,uri);
  Assert.assertFalse(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestSimpleDBPolicyEngineDFS </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultiFSPolicy() throws Exception {
  File globalPolicyFile=new File(Files.createTempDir(),"global-policy.ini");
  File dbPolicyFile=new File(Files.createTempDir(),"db11-policy.ini");
  PolicyFile dbPolicy=new PolicyFile().addPermissionsToRole("db11_role","server=server1->db=db11").addRolesToGroup("group1","db11_role");
  dbPolicy.write(dbPolicyFile);
  Path dbPolicyPath=new Path(etc,"db11-policy.ini");
  PolicyFile globalPolicy=new PolicyFile().addPermissionsToRole("admin_role","server=server1").addRolesToGroup("admin_group","admin_role").addGroupsToUser("db","admin_group");
  globalPolicy.addDatabase("db11",dbPolicyPath.toUri().toString());
  globalPolicy.write(globalPolicyFile);
  PolicyFiles.copyFilesToDir(fileSystem,etc,globalPolicyFile);
  PolicyFiles.copyFilesToDir(fileSystem,etc,dbPolicyFile);
  DBPolicyFileBackend multiFSEngine=new DBPolicyFileBackend("server1",globalPolicyFile.getPath());
  Set<String> dbGroups=Sets.newHashSet();
  dbGroups.add("group1");
  ImmutableSet<String> dbPerms=multiFSEngine.getAllPrivileges(dbGroups,ActiveRoleSet.ALL);
  Assert.assertEquals("No DB permissions found",1,dbPerms.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.AbstractTestIndexerPolicyEngine </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testJuniorAnalyst() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(JRANALYST_JRANALYST1_ALL,JRANALYST_PURCHASES_PARTIAL_READ));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("jranalyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAnalyst() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ANALYST_PURCHASES_WRITE,ANALYST_ANALYST1_ALL,ANALYST_JRANALYST1_ACTION_ALL,ANALYST_TMPINDEXER_WRITE,ANALYST_TMPINDEXER_READ));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("analyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testManager() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ANALYST_PURCHASES_WRITE,ANALYST_ANALYST1_ALL,ANALYST_JRANALYST1_ACTION_ALL,ANALYST_TMPINDEXER_WRITE,ANALYST_TMPINDEXER_READ,JRANALYST_JRANALYST1_ALL,JRANALYST_PURCHASES_PARTIAL_READ));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("manager"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAdmin() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ADMIN_INDEXER_ALL));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("admin"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Indexer indexer1=new Indexer("indexer1");
  Set<? extends Action> actions=EnumSet.allOf(IndexerModelAction.class);
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"indexer=" + indexer1.getName(),"indexer=" + indexer1.getName());
  policyFile.write(iniFile);
  IndexerPolicyFileBackend policy=new IndexerPolicyFileBackend(initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(indexer1);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerPolicyNegative </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIndexerRequiredInRole() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = some_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("some_role = action=read",globalPolicyFile);
  PolicyEngine policy=new IndexerPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGroupIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = indexer=*",globalPolicyFile);
  PolicyEngine policy=new IndexerPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("incorrectGroup"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPerDbFileException() throws Exception {
  append("[databases]",globalPolicyFile);
  append("other_group_db = " + otherPolicyFile.getPath(),globalPolicyFile);
  append("[groups]",otherPolicyFile);
  append("other_group = some_role",otherPolicyFile);
  append("[roles]",otherPolicyFile);
  append("some_role = indexer=i1",otherPolicyFile);
  IndexerPolicyFileBackend policy=new IndexerPolicyFileBackend(globalPolicyFile.getPath());
  Assert.assertEquals(Collections.emptySet(),policy.getPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.AbstractTestSearchPolicyEngine </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testJuniorAnalyst() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(JRANALYST_JRANALYST1_ALL,JRANALYST_PURCHASES_PARTIAL_QUERY));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("jranalyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testManager() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ANALYST_PURCHASES_UPDATE,ANALYST_ANALYST1_ALL,ANALYST_JRANALYST1_ACTION_ALL,ANALYST_TMPCOLLECTION_UPDATE,ANALYST_TMPCOLLECTION_QUERY,JRANALYST_JRANALYST1_ALL,JRANALYST_PURCHASES_PARTIAL_QUERY));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("manager"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAnalyst() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ANALYST_PURCHASES_UPDATE,ANALYST_ANALYST1_ALL,ANALYST_JRANALYST1_ACTION_ALL,ANALYST_TMPCOLLECTION_UPDATE,ANALYST_TMPCOLLECTION_QUERY));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("analyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAdmin() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ADMIN_COLLECTION_ALL));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("admin"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Collection collection1=new Collection("collection1");
  Set<? extends Action> actions=EnumSet.allOf(SearchModelAction.class);
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"collection=" + collection1.getName(),"collection=" + collection1.getName());
  policyFile.write(iniFile);
  SearchPolicyFileBackend policy=new SearchPolicyFileBackend(initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(collection1);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchPolicyNegative </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCollectionRequiredInRole() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = some_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("some_role = action=query",globalPolicyFile);
  PolicyEngine policy=new SearchPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPerDbFileException() throws Exception {
  append("[databases]",globalPolicyFile);
  append("other_group_db = " + otherPolicyFile.getPath(),globalPolicyFile);
  append("[groups]",otherPolicyFile);
  append("other_group = some_role",otherPolicyFile);
  append("[roles]",otherPolicyFile);
  append("some_role = collection=c1",otherPolicyFile);
  SearchPolicyFileBackend policy=new SearchPolicyFileBackend(globalPolicyFile.getPath());
  Assert.assertEquals(Collections.emptySet(),policy.getPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGroupIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = collection=*",globalPolicyFile);
  PolicyEngine policy=new SearchPolicyFileBackend(globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getPrivileges(Sets.newHashSet("incorrectGroup"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.AbstractTestSqoopPolicyEngine </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testJobOperator() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(OPERATOR_JOB1_READ,OPERATOR_JOB2_READ));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("job1_2_operator"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAdmin() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ADMIN));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("admin"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLinkOperator() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(OPERATOR_LINK1_READ,OPERATOR_LINK2_READ));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("link1_2_operator"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDeveloper() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(OPERATOR_JDBC_CONNECTORS_READ,OPERATOR_HDFS_CONNECTORS_READ,OPERATOR_KAFKA_CONNECTORS_READ,OPERATOR_KITE_CONNECTORS_READ,ANALYST_JOBS_ALL,ANALYST_LINKS_ALL));
  Assert.assertEquals(expected.toString(),Sets.newTreeSet(policy.getPrivileges(set("developer"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAnalyst() throws Exception {
  Set<String> expected=Sets.newTreeSet(Sets.newHashSet(ANALYST_JOBS_ALL,ANALYST_LINKS_ALL));
  Assert.assertEquals(expected.toString(),new TreeSet<String>(policy.getPrivileges(set("analyst"),ActiveRoleSet.ALL)).toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopAuthorizationProviderSpecialCases </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDuplicateEntries() throws Exception {
  Subject user1=new Subject("user1");
  Server server1=new Server("server1");
  Connector connector1=new Connector("c1");
  Set<? extends Action> actions=Sets.newHashSet(new SqoopAction(SqoopActionConstant.READ));
  policyFile.addGroupsToUser(user1.getName(),true,"group1","group1").addRolesToGroup("group1",true,"role1","role1").addPermissionsToRole("role1",true,"server=server1->connector=c1->action=read","server=server1->connector=c1->action=read");
  policyFile.write(iniFile);
  SqoopPolicyFileProviderBackend policy=new SqoopPolicyFileProviderBackend(server1.getName(),initResource);
  authzProvider=new LocalGroupResourceAuthorizationProvider(initResource,policy);
  List<? extends Authorizable> authorizableHierarchy=ImmutableList.of(server1,connector1);
  Assert.assertTrue(authorizableHierarchy.toString(),authzProvider.hasAccess(user1,authorizableHierarchy,actions,ActiveRoleSet.ALL));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopPolicyNegative </h4><pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNoServerNameConfig() throws Exception {
  append("[groups]",globalPolicyFile);
  append("other_group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = connector=c1->action=read,link=l1->action=read",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testAll() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = *",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerIncorrect() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=server2",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testauthorizedSqoopInPolicyFile() throws Exception {
  append("[groups]",globalPolicyFile);
  append("other_group = other_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("other_role = server=server1->connector=c1->action=read, server=server1->link=l1->action=read",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("malicious_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
  permissions=policy.getAllPrivileges(Sets.newHashSet("other_group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.size() == 2);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServerAllName() throws Exception {
  append("[groups]",globalPolicyFile);
  append("group = malicious_role",globalPolicyFile);
  append("[roles]",globalPolicyFile);
  append("malicious_role = server=*",globalPolicyFile);
  PolicyEngine policy=new SqoopPolicyFileProviderBackend("server1",globalPolicyFile.getPath());
  ImmutableSet<String> permissions=policy.getAllPrivileges(Sets.newHashSet("group"),ActiveRoleSet.ALL);
  Assert.assertTrue(permissions.toString(),permissions.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.common.TestGetGroupMapping </h4><pre class="type-12 type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testResourceAuthorizationProvider(){
  final Set<String> set=Sets.newHashSet("a","b","c");
  GroupMappingService mappingService=new GroupMappingService(){
    @Override public Set<String> getGroups(    String user){
      return set;
    }
  }
;
  PolicyEngine policyEngine=new PolicyEngine(){
    @Override public PrivilegeFactory getPrivilegeFactory(){
      return null;
    }
    @Override public ImmutableSet<String> getAllPrivileges(    Set<String> groups,    ActiveRoleSet roleSet) throws SentryConfigurationException {
      return getPrivileges(groups,roleSet,null);
    }
    @Override public ImmutableSet<String> getPrivileges(    Set<String> groups,    ActiveRoleSet roleSet,    Authorizable... authorizableHierarchy){
      return ImmutableSet.of();
    }
    @Override public void validatePolicy(    boolean strictValidation) throws SentryConfigurationException {
      return;
    }
    @Override public void close(){
    }
  }
;
  TestResourceAuthorizationProvider authProvider=new TestResourceAuthorizationProvider(policyEngine,mappingService);
  assertSame(authProvider.getGroupMapping(),mappingService);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestDelegateSentryStore </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetAllRoles() throws Exception {
  String role1="r1", role2="r2";
  Set<String> twoGroups=Sets.newHashSet("g1","g2");
  String grantor="grantor";
  sentryStore.createRole(SEARCH,role1,grantor);
  sentryStore.createRole(SEARCH,role2,grantor);
  sentryStore.alterRoleAddGroups(SEARCH,role1,twoGroups,grantor);
  sentryStore.alterRoleAddGroups(SEARCH,role2,twoGroups,grantor);
  String groupName=null;
  Set<String> groups=Sets.newHashSet(groupName);
  assertEquals(Sets.newHashSet(role1,role2),sentryStore.getRolesByGroups(SEARCH,groups));
  groups.clear();
  assertEquals(0,sentryStore.getRolesByGroups(SEARCH,groups).size());
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  String roleName="test-drop-role";
  String grantor="grantor";
  long seqId=sentryStore.createRole(SEARCH,roleName,grantor).getSequenceId();
  assertEquals(seqId + 1,sentryStore.dropRole(SEARCH,roleName,grantor).getSequenceId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestPrivilegeOperatePersistence </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Grant all privilege to role r1 and revoke query privilege
 * there is update privilege related to role r1
 */
@Test public void testRevokePrivilegeWithAllPrivilegeExist() throws Exception {
  String roleName="r1";
  String grantor=ADMIN_USER;
  PrivilegeObject allPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.ALL).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,allPrivilege,grantor);
  assertEquals(Sets.newHashSet(allPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  PrivilegeObject updatePrivilege=new Builder(allPrivilege).setAction(SearchConstants.UPDATE).build();
  PrivilegeObject queryPrivilege=new Builder(allPrivilege).setAction(SearchConstants.QUERY).build();
  sentryStore.alterRoleRevokePrivilege(SEARCH,roleName,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRevokeWithGrantOption() throws Exception {
  addGroupsToUser(GRANT_OPTION_USER,GRANT_OPTION_GROUP);
  addGroupsToUser(NO_GRANT_OPTION_USER,NO_GRANT_OPTION_GROUP);
  writePolicyFile();
  String roleName1="r1";
  String grantor="g1";
  sentryStore.createRole(SEARCH,roleName1,grantor);
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(true).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  sentryStore.alterRoleAddGroups(SEARCH,roleName1,Sets.newHashSet(GRANT_OPTION_GROUP),grantor);
  String roleName2="r2";
  sentryStore.createRole(SEARCH,roleName2,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege,GRANT_OPTION_USER);
  assertEquals(Sets.newHashSet(queryPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  sentryStore.alterRoleRevokePrivilege(SEARCH,roleName2,queryPrivilege,GRANT_OPTION_USER);
  assertEquals(Sets.newHashSet(),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
}

</code></pre>

<br>
<pre class="type-12 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokeCheckWithGrantOption() throws Exception {
  addGroupsToUser(GRANT_OPTION_USER,GRANT_OPTION_GROUP);
  addGroupsToUser(NO_GRANT_OPTION_USER,NO_GRANT_OPTION_GROUP);
  writePolicyFile();
  String roleName1="r1";
  String roleName2="r2";
  String grantor="g1";
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.createRole(SEARCH,roleName2,grantor);
  PrivilegeObject queryPrivilege1=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(true).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege1,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege1),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  PrivilegeObject queryPrivilege2=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(false).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege2,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege2),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  sentryStore.alterRoleAddGroups(SEARCH,roleName1,Sets.newHashSet(GRANT_OPTION_GROUP),grantor);
  sentryStore.alterRoleAddGroups(SEARCH,roleName2,Sets.newHashSet(NO_GRANT_OPTION_GROUP),grantor);
  String roleName3="r3";
  sentryStore.createRole(SEARCH,roleName3,grantor);
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege1,GRANT_OPTION_USER);
  }
 catch (  SentryGrantDeniedException e) {
    fail("SentryGrantDeniedException shouldn't have been thrown");
  }
  try {
    sentryStore.alterRoleRevokePrivilege(SEARCH,roleName3,queryPrivilege1,GRANT_OPTION_USER);
  }
 catch (  SentryGrantDeniedException e) {
    fail("SentryGrantDeniedException shouldn't have been thrown");
  }
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege2,NO_GRANT_OPTION_USER);
    fail("SentryGrantDeniedException should have been thrown");
  }
 catch (  SentryGrantDeniedException e) {
  }
  try {
    sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,queryPrivilege2,NO_GRANT_OPTION_USER);
    fail("SentryGrantDeniedException should have been thrown");
  }
 catch (  SentryGrantDeniedException e) {
  }
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGrantWithGrantOption() throws Exception {
  addGroupsToUser(GRANT_OPTION_USER,GRANT_OPTION_GROUP);
  addGroupsToUser(NO_GRANT_OPTION_USER,NO_GRANT_OPTION_GROUP);
  writePolicyFile();
  String roleName1="r1";
  String grantor="g1";
  sentryStore.createRole(SEARCH,roleName1,grantor);
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(true).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege,ADMIN_USER);
  sentryStore.alterRoleAddGroups(SEARCH,roleName1,Sets.newHashSet(GRANT_OPTION_GROUP),grantor);
  String roleName2="r2";
  sentryStore.createRole(SEARCH,roleName2,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege,GRANT_OPTION_USER);
  assertEquals(Sets.newHashSet(queryPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Grant query privilege to role r1 and there is ALL privilege related this
 * collection existed
 */
@Test public void testGrantPrivilegeWithAllPrivilegeExist() throws Exception {
  String roleName="r1";
  String grantor=ADMIN_USER;
  PrivilegeObject allPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.ALL).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,allPrivilege,grantor);
  assertEquals(Sets.newHashSet(allPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  PrivilegeObject queryPrivilege=new Builder(allPrivilege).setAction(SearchConstants.QUERY).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilege,grantor);
  assertEquals(Sets.newHashSet(allPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Grant query and update privileges to role r1 and revoke query privilege
 * there is left update privilege related to role r1
 */
@Test public void testRevokePrivilege() throws Exception {
  String roleName="r1";
  String grantor=ADMIN_USER;
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  PrivilegeObject updatePrivilege=new Builder(queryPrivilege).setAction(SearchConstants.UPDATE).build();
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  sentryStore.alterRoleRevokePrivilege(SEARCH,roleName,queryPrivilege,grantor);
  assertEquals(Sets.newHashSet(updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRenamePrivilege() throws Exception {
  String roleName1="r1";
  String roleName2="r2";
  String grantor=ADMIN_USER;
  List<? extends Authorizable> oldAuthoriables=Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME));
  List<? extends Authorizable> newAuthoriables=Arrays.asList(new Collection(COLLECTION_NAME),new Field(NOT_FIELD_NAME));
  PrivilegeObject oldQueryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(oldAuthoriables).build();
  PrivilegeObject oldUpdatePrivilege=new Builder(oldQueryPrivilege).setAction(SearchConstants.UPDATE).build();
  PrivilegeObject oldALLPrivilege=new Builder(oldQueryPrivilege).setAction(SearchConstants.ALL).build();
  PrivilegeObject newQueryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(newAuthoriables).build();
  PrivilegeObject newUpdatePrivilege=new Builder(newQueryPrivilege).setAction(SearchConstants.UPDATE).build();
  PrivilegeObject newALLPrivilege=new Builder(newQueryPrivilege).setAction(SearchConstants.ALL).build();
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,oldQueryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,oldUpdatePrivilege,grantor);
  sentryStore.createRole(SEARCH,roleName2,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,oldALLPrivilege,grantor);
  assertEquals(Sets.newHashSet(oldQueryPrivilege,oldUpdatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  assertEquals(Sets.newHashSet(oldALLPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  sentryStore.renamePrivilege(SEARCH,SERVICE,oldAuthoriables,newAuthoriables,grantor);
  assertEquals(Sets.newHashSet(newQueryPrivilege,newUpdatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  assertEquals(Sets.newHashSet(newALLPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  List<? extends Authorizable> newAuthoriables1=Arrays.asList(new Collection(NOT_COLLECTION_NAME),new Field(NOT_FIELD_NAME));
  PrivilegeObject newQueryPrivilege1=new Builder(newQueryPrivilege).setAuthorizables(newAuthoriables1).build();
  PrivilegeObject newUpdatePrivilege1=new Builder(newUpdatePrivilege).setAuthorizables(newAuthoriables1).build();
  PrivilegeObject newALLPrivilege1=new Builder(newALLPrivilege).setAuthorizables(newAuthoriables1).build();
  sentryStore.renamePrivilege(SEARCH,SERVICE,Arrays.asList(new Collection(COLLECTION_NAME)),Arrays.asList(new Collection(NOT_COLLECTION_NAME)),grantor);
  assertEquals(Sets.newHashSet(newQueryPrivilege1,newUpdatePrivilege1),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  assertEquals(Sets.newHashSet(newALLPrivilege1),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetPrivilegesByRoleName() throws Exception {
  String roleName1="r1";
  String roleName2="r2";
  String grantor="g1";
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege,ADMIN_USER);
  PrivilegeObject updatePrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  sentryStore.createRole(SEARCH,roleName2,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,updatePrivilege,ADMIN_USER);
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1,roleName2)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetPrivilegesByProvider() throws Exception {
  String roleName1="r1";
  String roleName2="r2";
  String roleName3="r3";
  String group="g3";
  String grantor=ADMIN_USER;
  String service1="service1";
  PrivilegeObject queryPrivilege1=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(service1).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  PrivilegeObject updatePrivilege1=new Builder().setComponent(SEARCH).setAction(SearchConstants.UPDATE).setService(service1).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  PrivilegeObject queryPrivilege2=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(service1).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  PrivilegeObject updatePrivilege2=new Builder().setComponent(SEARCH).setAction(SearchConstants.UPDATE).setService(service1).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.createRole(SEARCH,roleName2,grantor);
  sentryStore.createRole(SEARCH,roleName3,grantor);
  sentryStore.alterRoleAddGroups(SEARCH,roleName3,Sets.newHashSet(group),grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege1,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,updatePrivilege1,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege2,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName3,updatePrivilege2,grantor);
  assertEquals(Sets.newHashSet(updatePrivilege1,queryPrivilege1),sentryStore.getPrivilegesByProvider(SEARCH,service1,Sets.newHashSet(roleName1),null,null));
  assertEquals(Sets.newHashSet(updatePrivilege1,queryPrivilege1,queryPrivilege2),sentryStore.getPrivilegesByProvider(SEARCH,service1,Sets.newHashSet(roleName1,roleName2),null,null));
  assertEquals(Sets.newHashSet(updatePrivilege1,queryPrivilege1,queryPrivilege2,updatePrivilege2),sentryStore.getPrivilegesByProvider(SEARCH,service1,Sets.newHashSet(roleName1,roleName2),Sets.newHashSet(group),null));
  List<? extends Authorizable> authorizables=Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME));
  assertEquals(Sets.newHashSet(updatePrivilege1,updatePrivilege2),sentryStore.getPrivilegesByProvider(SEARCH,service1,Sets.newHashSet(roleName1,roleName2),Sets.newHashSet(group),authorizables));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Grant query privilege to role r1
 */
@Test public void testGrantPrivilege() throws Exception {
  String roleName="r1";
  String grantor=ADMIN_USER;
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(null).build();
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  PrivilegeObject queryPrivilegeWithOption=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(true).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilegeWithOption,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,queryPrivilegeWithOption),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  PrivilegeObject queryPrivilegeWithNoOption=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).withGrantOption(false).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilegeWithNoOption,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,queryPrivilegeWithOption,queryPrivilegeWithNoOption),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Grant query privilege to role r1 and there are query and update privileges
 * related this collection existed
 */
@Test public void testGrantALLPrivilegeWithOtherPrivilegesExist() throws Exception {
  String roleName1="r1";
  String roleName2="r2";
  String grantor=ADMIN_USER;
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  PrivilegeObject updatePrivilege=new Builder(queryPrivilege).setAction(SearchConstants.UPDATE).build();
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.createRole(SEARCH,roleName2,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  PrivilegeObject allPrivilege=new Builder(queryPrivilege).setAction(SearchConstants.ALL).build();
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,allPrivilege,grantor);
  assertEquals(Sets.newHashSet(allPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Grant update, query and all privilege to role r1
 * Revoke query privilege from role r1
 * there is update privilege related to role r1
 */
@Test public void testRevokePrivilegeWithAllPrivilegesGranted() throws Exception {
  String roleName="r1";
  String grantor=ADMIN_USER;
  PrivilegeObject allPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.ALL).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  PrivilegeObject updatePrivilege=new Builder(allPrivilege).setAction(SearchConstants.UPDATE).build();
  PrivilegeObject queryPrivilege=new Builder(allPrivilege).setAction(SearchConstants.QUERY).build();
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,allPrivilege,grantor);
  assertEquals(Sets.newHashSet(allPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  sentryStore.alterRoleRevokePrivilege(SEARCH,roleName,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRevokeParentPrivilegeWithChildsExist() throws Exception {
  String roleName="r1";
  String grantor=ADMIN_USER;
  PrivilegeObject updatePrivilege1=new Builder().setComponent(SEARCH).setAction(SearchConstants.UPDATE).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  PrivilegeObject queryPrivilege1=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  PrivilegeObject queryPrivilege2=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(NOT_COLLECTION_NAME))).build();
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,updatePrivilege1,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilege1,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilege2,grantor);
  PrivilegeObject allPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.ALL).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  sentryStore.alterRoleRevokePrivilege(SEARCH,roleName,allPrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege2),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Grant query and update privileges to role r1 and revoke all privilege,
 * there is no privilege related to role r1
 */
@Test public void testRevokeAllPrivilege() throws Exception {
  String roleName="r1";
  String grantor=ADMIN_USER;
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  PrivilegeObject updatePrivilege=new Builder(queryPrivilege).setAction(SearchConstants.UPDATE).build();
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,queryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
  PrivilegeObject allPrivilege=new Builder(queryPrivilege).setAction(SearchConstants.ALL).build();
  sentryStore.alterRoleRevokePrivilege(SEARCH,roleName,allPrivilege,grantor);
  assertEquals(Sets.newHashSet(),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName)));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDropPrivilege() throws Exception {
  String roleName1="r1";
  String roleName2="r2";
  String grantor=ADMIN_USER;
  PrivilegeObject queryPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.QUERY).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME),new Field(FIELD_NAME))).build();
  PrivilegeObject updatePrivilege=new Builder(queryPrivilege).setAction(SearchConstants.UPDATE).build();
  sentryStore.createRole(SEARCH,roleName1,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,updatePrivilege,grantor);
  sentryStore.createRole(SEARCH,roleName2,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,queryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName2,updatePrivilege,grantor);
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  assertEquals(Sets.newHashSet(queryPrivilege,updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  sentryStore.dropPrivilege(SEARCH,queryPrivilege,grantor);
  assertEquals(Sets.newHashSet(updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  assertEquals(Sets.newHashSet(updatePrivilege),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  PrivilegeObject allPrivilege=new Builder(queryPrivilege).setAction(SearchConstants.ALL).build();
  sentryStore.dropPrivilege(SEARCH,allPrivilege,grantor);
  assertEquals(Sets.newHashSet(),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
  assertEquals(Sets.newHashSet(),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName2)));
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,queryPrivilege,grantor);
  sentryStore.alterRoleGrantPrivilege(SEARCH,roleName1,updatePrivilege,grantor);
  PrivilegeObject parentPrivilege=new Builder().setComponent(SEARCH).setAction(SearchConstants.ALL).setService(SERVICE).setAuthorizables(Arrays.asList(new Collection(COLLECTION_NAME))).build();
  sentryStore.dropPrivilege(SEARCH,parentPrivilege,grantor);
  assertEquals(Sets.newHashSet(),sentryStore.getPrivilegesByRole(SEARCH,Sets.newHashSet(roleName1)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestSentryRole </h4><pre class="type-12 type-16 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWantGrantPrivilegeTwice() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setURI(SentryStore.NULL_COL);
  hivePrivilege.setColumnName(SentryStore.NULL_COL);
  hivePrivilege.setGrantOption(true);
  MSentryPrivilege hivePrivilege2=new MSentryPrivilege(hivePrivilege);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege2=new MSentryGMPrivilege(solrPrivilege);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  solrPrivilege.appendRole(role);
  hivePrivilege.appendRole(role);
  pm.makePersistent(solrPrivilege);
  pm.makePersistent(hivePrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  if (!role.getGmPrivileges().contains(solrPrivilege2)) {
    fail("unexpect happend: the MSentryGMPrivilege:" + solrPrivilege2 + " already be granted");
  }
  if (!role.getPrivileges().contains(hivePrivilege2)) {
    fail("unexpect happend: the MSentryPrivilege:" + hivePrivilege2 + " already be granted");
  }
  commitTransaction(pm);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeletePrivilegeAndRole() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setURI(SentryStore.NULL_COL);
  hivePrivilege.setColumnName(SentryStore.NULL_COL);
  hivePrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  hivePrivilege.appendRole(role);
  solrPrivilege.appendRole(role);
  pm.makePersistent(hivePrivilege);
  pm.makePersistent(solrPrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  role.removeGMPrivileges();
  role.removePrivileges();
  pm.makePersistent(role);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(0,role.getPrivileges().size());
  assertEquals(0,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.deletePersistent(role);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  assertTrue(role == null);
  commitTransaction(pm);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void grantMixedPrivilegeTest() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  hivePrivilege.appendRole(role);
  pm.makePersistent(hivePrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(0,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  solrPrivilege.appendRole(role);
  pm.makePersistent(solrPrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMixedRevokePrivilege() throws Exception {
  String roleName="r1";
  MSentryPrivilege hivePrivilege=new MSentryPrivilege();
  hivePrivilege.setServerName("hive.server1");
  hivePrivilege.setDbName("db1");
  hivePrivilege.setTableName("tb1");
  hivePrivilege.setPrivilegeScope("table");
  hivePrivilege.setAction("select");
  hivePrivilege.setURI(SentryStore.NULL_COL);
  hivePrivilege.setColumnName(SentryStore.NULL_COL);
  hivePrivilege.setGrantOption(true);
  MSentryGMPrivilege solrPrivilege=new MSentryGMPrivilege();
  solrPrivilege.setComponentName("solr");
  solrPrivilege.setServiceName("solr.server1");
  solrPrivilege.setAuthorizables(Arrays.asList(new Collection("c1")));
  solrPrivilege.setAction("query");
  solrPrivilege.setGrantOption(true);
  PersistenceManager pm=null;
  pm=openTransaction();
  pm.makePersistent(new MSentryRole(roleName,System.currentTimeMillis()));
  commitTransaction(pm);
  pm=openTransaction();
  MSentryRole role=getMSentryRole(pm,roleName);
  hivePrivilege.appendRole(role);
  solrPrivilege.appendRole(role);
  pm.makePersistent(hivePrivilege);
  pm.makePersistent(solrPrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(1,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  solrPrivilege=(MSentryGMPrivilege)role.getGmPrivileges().toArray()[0];
  solrPrivilege.removeRole(role);
  pm.makePersistent(solrPrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(1,role.getPrivileges().size());
  assertEquals(0,role.getGmPrivileges().size());
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  hivePrivilege=(MSentryPrivilege)role.getPrivileges().toArray()[0];
  hivePrivilege.removeRole(role);
  pm.makePersistent(hivePrivilege);
  commitTransaction(pm);
  pm=openTransaction();
  role=getMSentryRole(pm,roleName);
  pm.retrieve(role);
  assertEquals(0,role.getPrivileges().size());
  assertEquals(0,role.getGmPrivileges().size());
  commitTransaction(pm);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.thrift.TestSentryGenericServiceIntegration </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testMultipleRolesSamePrivilege() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1,SOLR);
      client.createRole(requestorUserName,roleName1,SOLR);
      client.dropRoleIfExists(requestorUserName,roleName2,SOLR);
      client.createRole(requestorUserName,roleName2,SOLR);
      TSentryPrivilege queryPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.QUERY);
      client.grantPrivilege(requestorUserName,roleName1,SOLR,queryPrivilege);
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName1,SOLR,"service1");
      assertTrue("Privilege not assigned to role1 !!",listPrivilegesByRoleName.size() == 1);
      client.grantPrivilege(requestorUserName,roleName2,SOLR,queryPrivilege);
      listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,SOLR,"service1");
      assertTrue("Privilege not assigned to role2 !!",listPrivilegesByRoleName.size() == 1);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleToGroup() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String testGroupName="g1";
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(requestorUserName,Sets.newHashSet(testGroupName));
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(testGroupName));
      Set<TSentryRole> roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        String group : role.getGroups()) {
          assertEquals(testGroupName,group);
        }
      }
      client.deleteRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(testGroupName));
      roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",0,roles.size());
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropShowRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(requestorUserGroupNames));
      Set<TSentryRole> roles=client.listUserRoles(requestorUserName,SOLR);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
      }
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testShowGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      TSentryPrivilege queryPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.QUERY);
      TSentryPrivilege updatePrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.UPDATE);
      client.grantPrivilege(requestorUserName,roleName,SOLR,updatePrivilege);
      client.grantPrivilege(requestorUserName,roleName,SOLR,queryPrivilege);
      Set<TSentryPrivilege> privileges=client.listPrivilegesByRoleName(requestorUserName,roleName,SOLR,"service1");
      assertTrue(privileges.size() == 2);
      client.revokePrivilege(requestorUserName,roleName,SOLR,updatePrivilege);
      privileges=client.listPrivilegesByRoleName(requestorUserName,roleName,SOLR,"service1");
      assertTrue(privileges.size() == 1);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r1";
      String groupName="group1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(requestorUserName,Sets.newHashSet(groupName));
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName,SOLR);
      client.createRole(requestorUserName,roleName,SOLR);
      client.addRoleToGroups(requestorUserName,roleName,SOLR,Sets.newHashSet(groupName));
      Set<TSentryRole> groupRoles=client.listRolesByGroupName(requestorUserName,groupName,SOLR);
      assertTrue(groupRoles.size() == 1);
      for (      TSentryRole role : groupRoles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        String group : role.getGroups()) {
          assertEquals(groupName,group);
        }
      }
      client.dropRole(requestorUserName,roleName,SOLR);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.tools.TestSentryShellSolr </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"--create_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"-lr","-conf",confPath.getAbsolutePath()};
      SentryShellSolr sentryShell=new SentryShellSolr();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellSolr();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      args=new String[]{"--drop_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellSolr.main(args);
      Set<TSentryRole> roles=client.listAllRoles(requestorName,SOLR);
      assertEquals("Incorrect number of roles",0,roles.size());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.appender.TestRollingFileWithoutDeleteAppender </h4><pre class="type-12 type-16 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Generate log enough to cause a single rollover. Verify the file name format
 * @throws Throwable
 */
@Test public void testFileNamePattern() throws Throwable {
  if (dataDir == null) {
    fail("Excepted temp folder for audit log is created.");
  }
  RollingFileWithoutDeleteAppender appender=new RollingFileWithoutDeleteAppender(new PatternLayout("%m%n"),dataDir.getPath() + "/auditLog.log");
  appender.setMaximumFileSize(10);
  sentryLogger.addAppender(appender);
  sentryLogger.debug("123456789012345");
  File[] files=dataDir.listFiles();
  if (files != null) {
    assertEquals(files.length,2);
    assertTrue(files[0].getName().contains("auditLog.log."));
    assertTrue(files[1].getName().contains("auditLog.log."));
  }
 else {
    fail("Excepted 2 log files.");
  }
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRollOver() throws Throwable {
  if (dataDir == null) {
    fail("Excepted temp folder for audit log is created.");
  }
  RollingFileWithoutDeleteAppender appender=new RollingFileWithoutDeleteAppender(new PatternLayout("%m%n"),dataDir.getPath() + "/auditLog.log");
  appender.setMaximumFileSize(100);
  sentryLogger.addAppender(appender);
  for (int i=0; i < 99; i++) {
    if (i < 10) {
      sentryLogger.debug("Hello---" + i);
    }
 else     if (i < 100) {
      sentryLogger.debug("Hello--" + i);
    }
  }
  if (dataDir != null) {
    File[] files=dataDir.listFiles();
    if (files != null) {
      assertEquals(files.length,10);
    }
 else {
      fail("Excepted 10 log files.");
    }
  }
 else {
    fail("Excepted 10 log files.");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.entity.TestJsonLogEntityFactory </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRevokeRole(){
  TAlterSentryRoleRevokePrivilegeRequest request=new TAlterSentryRoleRevokePrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeResponse response=new TAlterSentryRoleRevokePrivilegeResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  TSentryPrivilege privilege=getPrivilege(AccessConstants.ALL,PrivilegeScope.DATABASE.name(),TEST_DATABASE_NAME,null,null,null);
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  request.setPrivileges(privileges);
  response.setStatus(Status.OK());
  DBAuditMetadataLogEntity amle=new DBAuditMetadataLogEntity();
  Set<JsonLogEntity> amles=JsonLogEntityFactory.getInstance().createJsonLogEntitys(request,response,conf);
  assertEquals(amles.size(),1);
  for (  JsonLogEntity amle1 : amles) {
    amle=(DBAuditMetadataLogEntity)amle1;
    break;
  }
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_REVOKE_PRIVILEGE,"REVOKE ALL ON DATABASE testDB FROM ROLE testRole",TEST_DATABASE_NAME,null,null,Constants.OBJECT_TYPE_PRINCIPAL);
  privilege=getPrivilege(AccessConstants.ALL,PrivilegeScope.TABLE.name(),null,TEST_TABLE_NAME,null,null);
  privileges=Sets.newHashSet();
  privileges.add(privilege);
  request.setPrivileges(privileges);
  response.setStatus(Status.InvalidInput("",null));
  amles=JsonLogEntityFactory.getInstance().createJsonLogEntitys(request,response,conf);
  assertEquals(amles.size(),1);
  for (  JsonLogEntity amle1 : amles) {
    amle=(DBAuditMetadataLogEntity)amle1;
    break;
  }
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_REVOKE_PRIVILEGE,"REVOKE ALL ON TABLE testTable FROM ROLE testRole",null,TEST_TABLE_NAME,null,Constants.OBJECT_TYPE_PRINCIPAL);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGrantRole(){
  TAlterSentryRoleGrantPrivilegeRequest request=new TAlterSentryRoleGrantPrivilegeRequest();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  TAlterSentryRoleGrantPrivilegeResponse response=new TAlterSentryRoleGrantPrivilegeResponse();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.ALL,PrivilegeScope.DATABASE.name(),TEST_DATABASE_NAME,null,null,null);
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  request.setPrivileges(privileges);
  response.setStatus(Status.OK());
  DBAuditMetadataLogEntity amle=new DBAuditMetadataLogEntity();
  Set<JsonLogEntity> amles=JsonLogEntityFactory.getInstance().createJsonLogEntitys(request,response,conf);
  assertEquals(amles.size(),1);
  for (  JsonLogEntity amle1 : amles) {
    amle=(DBAuditMetadataLogEntity)amle1;
    break;
  }
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_GRANT_PRIVILEGE,"GRANT ALL ON DATABASE testDB TO ROLE testRole",TEST_DATABASE_NAME,null,null,Constants.OBJECT_TYPE_PRINCIPAL);
  privilege=getPrivilege(AccessConstants.ALL,PrivilegeScope.TABLE.name(),null,TEST_TABLE_NAME,null,null);
  privileges=Sets.newHashSet();
  privileges.add(privilege);
  request.setPrivileges(privileges);
  response.setStatus(Status.InvalidInput("",null));
  amles=JsonLogEntityFactory.getInstance().createJsonLogEntitys(request,response,conf);
  assertEquals(amles.size(),1);
  for (  JsonLogEntity amle1 : amles) {
    amle=(DBAuditMetadataLogEntity)amle1;
    break;
  }
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_GRANT_PRIVILEGE,"GRANT ALL ON TABLE testTable TO ROLE testRole",null,TEST_TABLE_NAME,null,Constants.OBJECT_TYPE_PRINCIPAL);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.util.TestCommandUtil </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege7(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.SELECT,PrivilegeScope.URI.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT SELECT ON URI hdfs://namenode:port/path/to/dir TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE SELECT ON URI hdfs://namenode:port/path/to/dir FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege5(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.SELECT,PrivilegeScope.TABLE.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT SELECT ON TABLE tableTest TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE SELECT ON TABLE tableTest FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege3(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.SELECT,PrivilegeScope.DATABASE.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT SELECT ON DATABASE dbTest TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE SELECT ON DATABASE dbTest FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege1(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.ALL,PrivilegeScope.DATABASE.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT ALL ON DATABASE dbTest TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE ALL ON DATABASE dbTest FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokeGMPrivilege1(){
  org.apache.sentry.provider.db.generic.service.thrift.TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantGMPrivilegeRequest();
  org.apache.sentry.provider.db.generic.service.thrift.TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokeGMPrivilegeRequest();
  org.apache.sentry.provider.db.generic.service.thrift.TSentryPrivilege privilege=getGMPrivilege();
  grantRequest.setPrivilege(privilege);
  revokeRequest.setPrivilege(privilege);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantGMPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokeGMPrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForCreateOrDropRole(){
  String roleName="testRole";
  String createRoleCmdResult=CommandUtil.createCmdForCreateOrDropRole(roleName,true);
  String dropRoleCmdResult=CommandUtil.createCmdForCreateOrDropRole(roleName,false);
  String createRoleCmdExcepted="CREATE ROLE testRole";
  String dropRoleCmdExcepted="DROP ROLE testRole";
  assertEquals(createRoleCmdExcepted,createRoleCmdResult);
  assertEquals(dropRoleCmdResult,dropRoleCmdExcepted);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege8(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.SELECT,PrivilegeScope.SERVER.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  privilege.setGrantOption(TSentryGrantOption.TRUE);
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT SELECT ON SERVER serverTest TO ROLE testRole WITH GRANT OPTION";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE SELECT ON SERVER serverTest FROM ROLE testRole WITH GRANT OPTION";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege6(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.SELECT,PrivilegeScope.SERVER.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT SELECT ON SERVER serverTest TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE SELECT ON SERVER serverTest FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege4(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(null,PrivilegeScope.DATABASE.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT null ON DATABASE dbTest TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE null ON DATABASE dbTest FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokePrivilege2(){
  TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantPrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokePrivilegeRequest();
  TSentryPrivilege privilege=getPrivilege(AccessConstants.INSERT,PrivilegeScope.DATABASE.name(),"dbTest","tableTest","serverTest","hdfs://namenode:port/path/to/dir");
  Set<TSentryPrivilege> privileges=Sets.newHashSet();
  privileges.add(privilege);
  grantRequest.setPrivileges(privileges);
  revokeRequest.setPrivileges(privileges);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT INSERT ON DATABASE dbTest TO ROLE testRole";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokePrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE INSERT ON DATABASE dbTest FROM ROLE testRole";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCmdForGrantOrRevokeGMPrivilege2(){
  org.apache.sentry.provider.db.generic.service.thrift.TAlterSentryRoleGrantPrivilegeRequest grantRequest=getGrantGMPrivilegeRequest();
  org.apache.sentry.provider.db.generic.service.thrift.TAlterSentryRoleRevokePrivilegeRequest revokeRequest=getRevokeGMPrivilegeRequest();
  org.apache.sentry.provider.db.generic.service.thrift.TSentryPrivilege privilege=getGMPrivilege();
  privilege.setGrantOption(org.apache.sentry.provider.db.generic.service.thrift.TSentryGrantOption.TRUE);
  grantRequest.setPrivilege(privilege);
  revokeRequest.setPrivilege(privilege);
  String createGrantPrivilegeCmdResult=CommandUtil.createCmdForGrantGMPrivilege(grantRequest);
  String createGrantPrivilegeCmdExcepted="GRANT ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 TO ROLE testRole WITH GRANT OPTION";
  String createRevokePrivilegeCmdResult=CommandUtil.createCmdForRevokeGMPrivilege(revokeRequest);
  String createRevokePrivilegeCmdExcepted="REVOKE ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 FROM ROLE testRole WITH GRANT OPTION";
  assertEquals(createGrantPrivilegeCmdExcepted,createGrantPrivilegeCmdResult);
  assertEquals(createRevokePrivilegeCmdExcepted,createRevokePrivilegeCmdResult);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStore </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilege() throws Exception {
  String roleName="test-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSentryTablePrivilegeSome() throws Exception {
  String roleName="test-table-privilege-some";
  String grantor="g1";
  String dbName="db1";
  String table="tb1";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("TABLE","server1","ALL");
  tSentryPrivilege.setDbName(dbName);
  tSentryPrivilege.setTableName(table);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setDb(dbName);
  tSentryAuthorizable.setTable(AccessConstants.SOME);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->db=" + dbName + "->table="+ table+ "->action=all"));
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeColumnPrivilegeDowngradeByDb() throws Exception {
  String roleName="test-column-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeCol1=new TSentryPrivilege();
  privilegeCol1.setPrivilegeScope("COLUMN");
  privilegeCol1.setServerName(server);
  privilegeCol1.setDbName(db);
  privilegeCol1.setTableName(table);
  privilegeCol1.setColumnName(column1);
  privilegeCol1.setAction(AccessConstants.ALL);
  privilegeCol1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeCol2=privilegeCol1.deepCopy();
  ;
  privilegeCol2.setColumnName(column2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeCol2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilegeCol2.setAction(AccessConstants.INSERT);
  privilegeCol2.setPrivilegeScope("DATABASE");
  privilegeCol2.unsetTableName();
  privilegeCol2.unsetColumnName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(column1,mPrivilege.getColumnName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeTablePrivilegeDowngradeByDb() throws Exception {
  String roleName="test-table-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table1="tbl1";
  String table2="tbl2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeTable1=new TSentryPrivilege();
  privilegeTable1.setPrivilegeScope("TABLE");
  privilegeTable1.setServerName(server);
  privilegeTable1.setDbName(db);
  privilegeTable1.setTableName(table1);
  privilegeTable1.setAction(AccessConstants.ALL);
  privilegeTable1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeTable2=privilegeTable1.deepCopy();
  ;
  privilegeTable2.setTableName(table2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeTable2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getTableName().equals(table1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getTableName().equals(table2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected table name: " + mPrivilege.getTableName());
    }
  }
  privilegeTable2.setAction(AccessConstants.INSERT);
  privilegeTable2.setPrivilegeScope("DATABASE");
  privilegeTable2.unsetTableName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table1,mPrivilege.getTableName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<br>
<pre class="type-17 type-12 type-7 type-6 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Much like testPrivilegeCleanup, make a lot of privileges and make sure
 * they get cleaned up.  The difference here is that the privileges are
 * created by granting ALL and then removing SELECT - thus leaving INSERT.
 * This test exists because the revocation plays havoc with the orphan
 * cleanup thread.
 * @throws Exception
 */
@Ignore("Disabled with SENTRY-545 following SENTRY-140 problems") @Test public void testPrivilegeCleanup2() throws Exception {
  final String roleName="test-priv-cleanup";
  final String grantor="g1";
  final String server="server";
  final String dBase="db";
  final String table="table-";
  sentryStore.createSentryRole(roleName);
  for (int i=0; i < NUM_PRIVS; i++) {
    TSentryPrivilege priv=new TSentryPrivilege();
    priv.setPrivilegeScope("DATABASE");
    priv.setServerName(server);
    priv.setAction(AccessConstants.ALL);
    priv.setCreateTime(System.currentTimeMillis());
    priv.setTableName(table + i);
    priv.setDbName(dBase);
    priv.setGrantOption(TSentryGrantOption.TRUE);
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,priv);
    priv.setAction(AccessConstants.SELECT);
    priv.setGrantOption(TSentryGrantOption.UNSET);
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,priv);
    MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
    Set<MSentryPrivilege> privileges=role.getPrivileges();
    assertEquals(privileges.toString(),i + 1,privileges.size());
    MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
    assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
  }
  sentryStore.dropSentryRole(roleName);
  verifyOrphanCleanup();
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSentryColumnPrivilegeSome() throws Exception {
  String roleName="test-column-privilege-some";
  String grantor="g1";
  String dbName="db1";
  String table="tb1";
  String column="col1";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("TABLE","server1","ALL");
  tSentryPrivilege.setDbName(dbName);
  tSentryPrivilege.setTableName(table);
  tSentryPrivilege.setColumnName(column);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setDb(dbName);
  tSentryAuthorizable.setTable(table);
  tSentryAuthorizable.setColumn(AccessConstants.SOME);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->db=" + dbName + "->table="+ table+ "->column="+ column+ "->action=all"));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testURI() throws Exception {
  String roleName="test-dup-role";
  String grantor="g1";
  String uri="file:///var/folders/dt/9zm44z9s6bjfxbrm4v36lzdc0000gp/T/1401860678102-0/data/kv1.dat";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("URI","server1","ALL");
  tSentryPrivilege.setURI(uri);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setUri(uri);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->uri=" + uri + "->action=all"));
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGrantRevokePrivilegeWithGrantOption() throws Exception {
  String roleName="test-grantOption-table";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  TSentryGrantOption grantOption=TSentryGrantOption.TRUE;
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  privilege.setGrantOption(grantOption);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  assertEquals(Boolean.valueOf(privilege.getGrantOption().toString()),Iterables.get(privileges,0).getGrantOption());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
  roleName="test-grantOption-db";
  sentryStore.createSentryRole(roleName);
  privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("DATABASE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setAction(AccessConstants.ALL);
  privilege.setGrantOption(TSentryGrantOption.TRUE);
  privilege.setCreateTime(System.currentTimeMillis());
  privilege.setGrantOption(grantOption);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  privilege.setGrantOption(TSentryGrantOption.UNSET);
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServerForHaWithoutKerberos </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testQueryPushDown() throws Exception {
  String requestorUserName=ADMIN_USER;
  Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
  setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
  writePolicyFile();
  String roleName1="admin_r1";
  String roleName2="admin_r2";
  String group1="g1";
  String group2="g2";
  client.dropRoleIfExists(requestorUserName,roleName1);
  client.createRole(requestorUserName,roleName1);
  client.grantRoleToGroup(requestorUserName,group1,roleName1);
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
  client.dropRoleIfExists(requestorUserName,roleName2);
  client.createRole(requestorUserName,roleName2);
  client.grantRoleToGroup(requestorUserName,group1,roleName2);
  client.grantRoleToGroup(requestorUserName,group2,roleName2);
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db3","table5","ALL");
  Set<TSentryPrivilege> listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db1")));
  assertEquals("Privilege not assigned to role2 !!",2,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db2"),new Table("table1")));
  assertEquals("Privilege not assigned to role2 !!",0,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db1"),new Table("table1")));
  assertEquals("Privilege not assigned to role2 !!",1,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db3")));
  assertEquals("Privilege not assigned to role2 !!",1,listPrivilegesByRoleName.size());
  Set<String> listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),ActiveRoleSet.ALL,new Server("server"),new Database("db2"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",Sets.newHashSet("server=server->db=db2->table=table4->action=all","server=server->db=db2->table=table3->action=all"),listPrivilegesForProvider);
  listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),ActiveRoleSet.ALL,new Server("server"),new Database("db3"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",Sets.newHashSet("server=server->db=db3->table=table5->action=all"),listPrivilegesForProvider);
  listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),new ActiveRoleSet(Sets.newHashSet(roleName1)),new Server("server"),new Database("db3"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",Sets.newHashSet("server=+"),listPrivilegesForProvider);
  listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),new ActiveRoleSet(Sets.newHashSet(roleName1)),new Server("server1"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",new HashSet<String>(),listPrivilegesForProvider);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServerWithoutKerberos </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testQueryPushDown() throws Exception {
  String requestorUserName=ADMIN_USER;
  Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
  setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
  writePolicyFile();
  String roleName1="admin_r1";
  String roleName2="admin_r2";
  String group1="g1";
  String group2="g2";
  client.dropRoleIfExists(requestorUserName,roleName1);
  client.createRole(requestorUserName,roleName1);
  client.grantRoleToGroup(requestorUserName,group1,roleName1);
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
  client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
  client.dropRoleIfExists(requestorUserName,roleName2);
  client.createRole(requestorUserName,roleName2);
  client.grantRoleToGroup(requestorUserName,group1,roleName2);
  client.grantRoleToGroup(requestorUserName,group2,roleName2);
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
  client.grantTablePrivilege(requestorUserName,roleName2,"server","db3","table5","ALL");
  Set<TSentryPrivilege> listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,null);
  assertEquals("Privilege not assigned to role2 !!",5,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,new ArrayList<Authorizable>());
  assertEquals("Privilege not assigned to role2 !!",5,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db1")));
  assertEquals("Privilege not assigned to role2 !!",2,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db2"),new Table("table1")));
  assertEquals("Privilege not assigned to role2 !!",0,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db1"),new Table("table1")));
  assertEquals("Privilege not assigned to role2 !!",1,listPrivilegesByRoleName.size());
  listPrivilegesByRoleName=client.listPrivilegesByRoleName(requestorUserName,roleName2,Lists.newArrayList(new Server("server"),new Database("db3")));
  assertEquals("Privilege not assigned to role2 !!",1,listPrivilegesByRoleName.size());
  Set<String> listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),ActiveRoleSet.ALL,new Server("server"),new Database("db2"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",Sets.newHashSet("server=server->db=db2->table=table4->action=all","server=server->db=db2->table=table3->action=all"),listPrivilegesForProvider);
  listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),ActiveRoleSet.ALL,new Server("server"),new Database("db3"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",Sets.newHashSet("server=server->db=db3->table=table5->action=all"),listPrivilegesForProvider);
  listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),new ActiveRoleSet(Sets.newHashSet(roleName1)),new Server("server"),new Database("db3"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",Sets.newHashSet("server=+"),listPrivilegesForProvider);
  listPrivilegesForProvider=client.listPrivilegesForProvider(Sets.newHashSet(group1,group2),new ActiveRoleSet(Sets.newHashSet(roleName1)),new Server("server1"));
  Assert.assertEquals("Privilege not correctly assigned to roles !!",new HashSet<String>(),listPrivilegesForProvider);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceClientPool </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testConnectionWithMultipleRetries() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      List<Future<Boolean>> tasks=new ArrayList<Future<Boolean>>();
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      ExecutorService executorService=Executors.newFixedThreadPool(20);
      Callable<Boolean> func=new Callable<Boolean>(){
        public Boolean call() throws Exception {
          return Subject.doAs(clientSubject,new PrivilegedExceptionAction<Boolean>(){
            @Override public Boolean run() throws Exception {
              try {
                client.listRoles(ADMIN_USER);
                return true;
              }
 catch (              SentryUserException sue) {
                return false;
              }
            }
          }
);
        }
      }
;
      for (int i=0; i < 30; i++) {
        FutureTask<Boolean> task=new FutureTask<Boolean>(func);
        tasks.add(task);
        executorService.submit(task);
      }
      for (      Future<Boolean> task : tasks) {
        Boolean result=task.get();
        assertTrue("Some tasks are failed.",result);
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceFailureCase </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClientServerConnectionFailure() throws Exception {
  try {
    connectToSentryService();
    Assert.fail("Failed to receive Exception");
  }
 catch (  PrivilegedActionException e) {
    LOGGER.info("Excepted exception",e);
    Exception cause=e.getException();
    if (cause == null) {
      throw e;
    }
    String msg="Exception message: " + cause.getMessage() + " to contain "+ PEER_CALLBACK_FAILURE;
    Assert.assertTrue(msg,Strings.nullToEmpty(cause.getMessage()).contains(PEER_CALLBACK_FAILURE));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceIntegration </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testListByAuthTab() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName1="role1";
      String roleName2="role2";
      String server="server1";
      String db="testDB";
      String db2="testDB2";
      String tab="testTab";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantDatabasePrivilege(requestorUserName,roleName1,server,db,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db,tab,AccessConstants.ALL);
      TSentryPrivilege role1db2tab=client.grantTablePrivilege(requestorUserName,roleName1,server,db2,tab,AccessConstants.SELECT);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db,AccessConstants.ALL);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db2,AccessConstants.SELECT);
      TSentryPrivilege role2db2tab=client.grantTablePrivilege(requestorUserName,roleName2,server,db2,tab,AccessConstants.ALL);
      client.grantURIPrivilege(requestorUserName,roleName1,server,"hdfs:///fooUri");
      TSentryPrivilegeMap db1RoleToPrivMap=new TSentryPrivilegeMap(new TreeMap<String,Set<TSentryPrivilege>>());
      db1RoleToPrivMap.getPrivilegeMap().put(roleName1,Sets.newHashSet(role1db2tab));
      db1RoleToPrivMap.getPrivilegeMap().put(roleName2,Sets.newHashSet(role2db2tab));
      Map<TSentryAuthorizable,TSentryPrivilegeMap> expectedResults=Maps.newTreeMap();
      List<? extends Authorizable> db2TabAuthrizable=Lists.newArrayList(new Server(server),new Database(db2),new Table(tab));
      expectedResults.put(SentryPolicyServiceClientDefaultImpl.setupSentryAuthorizable(db2TabAuthrizable),db1RoleToPrivMap);
      Set<List<? extends Authorizable>> authorizableSet=Sets.newHashSet();
      authorizableSet.add(db2TabAuthrizable);
      Map<TSentryAuthorizable,TSentryPrivilegeMap> authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,null,null);
      assertEquals(expectedResults,authPrivMap);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String server="server1";
      String db="testDB";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantDatabasePrivilege(requestorUserName,roleName,server,db,AccessConstants.ALL);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 1);
      client.revokeDatabasePrivilege(requestorUserName,roleName,server,db,AccessConstants.ALL);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGranRevokePrivilegeOnColumnForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table2","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db1","table2","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db2","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName1,"server","db2","table2","col1","ALL");
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table1","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col2","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db2","table1","col1","ALL");
      client.grantColumnPrivilege(requestorUserName,roleName2,"server","db2","table2","col1","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertEquals("Privilege not assigned to role1 !!",6,listPrivilegesByRoleName.size());
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertEquals("Privilege not assigned to role2 !!",6,listPrivilegesByRoleName.size());
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db1","table1","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 5);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 6);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 4);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 5);
      client.revokeDatabasePrivilege(requestorUserName,roleName1,"server","db1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 2);
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db2","table1","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName1,"server","db2","table2","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db1","table2","col2","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db2","table1","col1","ALL");
      client.revokeColumnPrivilege(requestorUserName,roleName2,"server","db2","table2","col1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testListByAuthDB() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName1="role1";
      String roleName2="role2";
      Set<String> testRoleSet=Sets.newHashSet(roleName1,roleName2);
      String group1="group1";
      String group2="group2";
      Set<String> testGroupSet=Sets.newHashSet(group1,group2);
      String server="server1";
      String db="testDB";
      String db2="testDB2";
      String tab="testTab";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      String group1user="group1user";
      setLocalGroupMapping(group1user,Sets.newHashSet(group1));
      String group2user="group2user";
      setLocalGroupMapping(group2user,Sets.newHashSet(group2));
      setLocalGroupMapping("random",Sets.newHashSet("foo"));
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      TSentryPrivilege role1db1=client.grantDatabasePrivilege(requestorUserName,roleName1,server,db,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db,tab,AccessConstants.ALL);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db2,tab,AccessConstants.SELECT);
      client.grantURIPrivilege(requestorUserName,roleName1,server,"hdfs:///fooUri");
      client.grantRoleToGroup(requestorUserName,group1,roleName1);
      TSentryPrivilege role2db1=client.grantDatabasePrivilege(requestorUserName,roleName2,server,db,AccessConstants.ALL);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db2,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName2,server,db2,tab,AccessConstants.ALL);
      client.grantRoleToGroup(requestorUserName,group2,roleName2);
      TSentryPrivilegeMap db1RoleToPrivMap=new TSentryPrivilegeMap(new TreeMap<String,Set<TSentryPrivilege>>());
      db1RoleToPrivMap.getPrivilegeMap().put(roleName1,Sets.newHashSet(role1db1));
      db1RoleToPrivMap.getPrivilegeMap().put(roleName2,Sets.newHashSet(role2db1));
      Map<TSentryAuthorizable,TSentryPrivilegeMap> expectedResults=Maps.newTreeMap();
      List<? extends Authorizable> db1Authrizable=Lists.newArrayList(new Server(server),new Database(db));
      expectedResults.put(SentryPolicyServiceClientDefaultImpl.setupSentryAuthorizable(db1Authrizable),db1RoleToPrivMap);
      Set<List<? extends Authorizable>> authorizableSet=Sets.newHashSet();
      authorizableSet.add(db1Authrizable);
      Map<TSentryAuthorizable,TSentryPrivilegeMap> authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,null,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,null,new ActiveRoleSet(testRoleSet));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,null,ActiveRoleSet.ALL);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,testGroupSet,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,testGroupSet,new ActiveRoleSet(testRoleSet));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,testGroupSet,ActiveRoleSet.ALL);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable("random",authorizableSet,new HashSet<String>(),ActiveRoleSet.ALL);
      expectedResults.clear();
      expectedResults.put(SentryPolicyServiceClientDefaultImpl.setupSentryAuthorizable(db1Authrizable),new TSentryPrivilegeMap(new HashMap<String,Set<TSentryPrivilege>>()));
      assertEquals(expectedResults,authPrivMap);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGranRevokePrivilegeOnTableForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertEquals("Privilege not assigned to role1 !!",4,listPrivilegesByRoleName.size());
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertEquals("Privilege not assigned to role2 !!",4,listPrivilegesByRoleName.size());
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 4);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table1","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 3);
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db1","table2","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db2","table3","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName1,"server","db2","table4","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db1","table2","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db2","table3","ALL");
      client.revokeTablePrivilege(requestorUserName,roleName2,"server","db2","table4","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not correctly revoked !!",listPrivilegesByRoleName.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testListByAuthUri() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName1="role1";
      String roleName2="role2";
      String server="server1";
      String db="testDB";
      String db2="testDB2";
      String tab="testTab";
      String uri1="hdfs:///fooUri";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantDatabasePrivilege(requestorUserName,roleName1,server,db,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db,tab,AccessConstants.ALL);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db2,tab,AccessConstants.SELECT);
      TSentryPrivilege role1uri1=client.grantURIPrivilege(requestorUserName,roleName1,server,uri1);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db,AccessConstants.ALL);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db2,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName2,server,db2,tab,AccessConstants.ALL);
      TSentryPrivilege role2uri2=client.grantURIPrivilege(requestorUserName,roleName2,server,uri1);
      TSentryPrivilegeMap db1RoleToPrivMap=new TSentryPrivilegeMap(new TreeMap<String,Set<TSentryPrivilege>>());
      db1RoleToPrivMap.getPrivilegeMap().put(roleName1,Sets.newHashSet(role1uri1));
      db1RoleToPrivMap.getPrivilegeMap().put(roleName2,Sets.newHashSet(role2uri2));
      Map<TSentryAuthorizable,TSentryPrivilegeMap> expectedResults=Maps.newTreeMap();
      List<? extends Authorizable> uri1Authrizable=Lists.newArrayList(new Server(server),new AccessURI(uri1));
      expectedResults.put(SentryPolicyServiceClientDefaultImpl.setupSentryAuthorizable(uri1Authrizable),db1RoleToPrivMap);
      Set<List<? extends Authorizable>> authorizableSet=Sets.newHashSet();
      authorizableSet.add(uri1Authrizable);
      Map<TSentryAuthorizable,TSentryPrivilegeMap> authPrivMap=client.listPrivilegsbyAuthorizable(requestorUserName,authorizableSet,null,null);
      assertEquals(expectedResults,authPrivMap);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUriWithEquals() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String server="server1";
      String uri="file://u/w/h/t/partition=value/";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantURIPrivilege(requestorUserName,roleName,server,uri);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 1);
      client.revokeURIPrivilege(requestorUserName,roleName,server,uri);
      privileges=client.listAllPrivilegesByRoleName(requestorUserName,roleName);
      assertTrue(privileges.size() == 0);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShowRoleGrant() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_testdb";
      String groupName="group1";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      client.grantRoleToGroup(requestorUserName,groupName,roleName);
      Set<TSentryRole> groupRoles=client.listRolesByGroupName(requestorUserName,groupName);
      assertTrue(groupRoles.size() == 1);
      for (      TSentryRole role : groupRoles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
        assertTrue(role.getGroups().size() == 1);
        for (        TSentryGroup group : role.getGroups()) {
          assertTrue(group.getGroupName(),group.getGroupName().equalsIgnoreCase(groupName));
        }
      }
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testMultipleRolesSamePrivilege() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantTablePrivilege(requestorUserName,roleName1,"server","db","table","ALL");
      Set<TSentryPrivilege> listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not assigned to role1 !!",listPrivilegesByRoleName.size() == 1);
      client.grantTablePrivilege(requestorUserName,roleName2,"server","db","table","ALL");
      listPrivilegesByRoleName=client.listAllPrivilegesByRoleName(requestorUserName,roleName2);
      assertTrue("Privilege not assigned to role2 !!",listPrivilegesByRoleName.size() == 1);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropShowRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      Set<TSentryRole> roles=client.listRoles(requestorUserName);
      assertEquals("Incorrect number of roles",1,roles.size());
      for (      TSentryRole role : roles) {
        assertTrue(role.getRoleName(),role.getRoleName().equalsIgnoreCase(roleName));
      }
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testGranRevokePrivilegeOnServerForRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.grantServerPrivilege(requestorUserName,roleName1,"server",false);
      Set<TSentryPrivilege> listPrivs=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege should be all:",listPrivs.iterator().next().getAction().equals("*"));
      client.revokeServerPrivilege(requestorUserName,roleName1,"server",false);
      listPrivs=client.listAllPrivilegesByRoleName(requestorUserName,roleName1);
      assertTrue("Privilege not correctly revoked !!",listPrivs.size() == 0);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-5 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * List privileges by authorizables executed by non-admin user
 * Test various positive and negative cases for non-admin user
 * @throws Exception
 */
@Test public void testListByAuthTabForNonAdmin() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      String user1="user1";
      String group1="group1";
      String group2="group2";
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      Set<String> userGroupNames1=Sets.newHashSet(group1);
      Set<String> userGroupNames2=Sets.newHashSet(group2);
      String roleName1="role1";
      String roleName2="role2";
      String server="server1";
      String db="testDB";
      String db2="testDB2";
      String tab="testTab";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      setLocalGroupMapping(user1,userGroupNames1);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName1);
      client.createRole(requestorUserName,roleName1);
      client.dropRoleIfExists(requestorUserName,roleName2);
      client.createRole(requestorUserName,roleName2);
      client.grantDatabasePrivilege(requestorUserName,roleName1,server,db,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName1,server,db,tab,AccessConstants.ALL);
      TSentryPrivilege role1db2tab=client.grantTablePrivilege(requestorUserName,roleName1,server,db2,tab,AccessConstants.SELECT);
      client.grantRoleToGroup(requestorUserName,group1,roleName1);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db,AccessConstants.ALL);
      client.grantDatabasePrivilege(requestorUserName,roleName2,server,db2,AccessConstants.SELECT);
      client.grantTablePrivilege(requestorUserName,roleName2,server,db2,tab,AccessConstants.ALL);
      client.grantURIPrivilege(requestorUserName,roleName1,server,"hdfs:///fooUri");
      TSentryPrivilegeMap db1RoleToPrivMap=new TSentryPrivilegeMap(new TreeMap<String,Set<TSentryPrivilege>>());
      db1RoleToPrivMap.getPrivilegeMap().put(roleName1,Sets.newHashSet(role1db2tab));
      Map<TSentryAuthorizable,TSentryPrivilegeMap> expectedResults=Maps.newTreeMap();
      List<? extends Authorizable> db2TabAuthorizable=Lists.newArrayList(new Server(server),new Database(db2),new Table(tab));
      expectedResults.put(SentryPolicyServiceClientDefaultImpl.setupSentryAuthorizable(db2TabAuthorizable),db1RoleToPrivMap);
      Set<List<? extends Authorizable>> authorizableSet=Sets.newHashSet();
      authorizableSet.add(db2TabAuthorizable);
      Map<TSentryAuthorizable,TSentryPrivilegeMap> authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,new HashSet<String>(),null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,new ActiveRoleSet(true));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames1,null);
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames1,new ActiveRoleSet(true));
      assertEquals(expectedResults,authPrivMap);
      authPrivMap=client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,new ActiveRoleSet(Sets.newHashSet(roleName1.toUpperCase())));
      assertEquals(expectedResults,authPrivMap);
      try {
        client.listPrivilegsbyAuthorizable(user1,authorizableSet,userGroupNames2,null);
        fail("listPrivilegsbyAuthorizable() should fail for user1 accessing " + group2);
      }
 catch (      SentryAccessDeniedException e) {
      }
      ActiveRoleSet roleSet2=new ActiveRoleSet(Sets.newHashSet(roleName2));
      try {
        client.listPrivilegsbyAuthorizable(user1,authorizableSet,null,roleSet2);
        fail("listPrivilegsbyAuthorizable() should fail for user1 accessing " + roleName2);
      }
 catch (      SentryAccessDeniedException e) {
      }
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryWebServerWithKerberos </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPingWithoutSubject() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  try {
    new AuthenticatedURL(new KerberosAuthenticator()).openConnection(url,new AuthenticatedURL.Token());
    fail("Here should fail.");
  }
 catch (  Exception e) {
    boolean isExpectError=e.getMessage().contains("No valid credentials provided");
    Assert.assertTrue("Here should fail by 'No valid credentials provided'," + " but the exception is:" + e,isExpectError);
  }
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPing() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
      HttpURLConnection conn=new AuthenticatedURL(new KerberosAuthenticator()).openConnection(url,new AuthenticatedURL.Token());
      Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
      String response=IOUtils.toString(conn.getInputStream());
      Assert.assertEquals("pong\n",response);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPingUsingHttpURLConnection() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  HttpURLConnection conn=(HttpURLConnection)url.openConnection();
  Assert.assertEquals(HttpURLConnection.HTTP_UNAUTHORIZED,conn.getResponseCode());
  String errorMessage=IOUtils.toString(conn.getErrorStream());
  Assert.assertTrue(errorMessage.contains("Authentication required"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryWebServerWithoutSecurity </h4><pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPing() throws Exception {
  final URL url=new URL("http://" + SERVER_HOST + ":"+ webServerPort+ "/ping");
  HttpURLConnection conn=(HttpURLConnection)url.openConnection();
  Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
  String response=IOUtils.toString(conn.getInputStream());
  Assert.assertEquals("pong\n",response);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.tools.TestSentryShellHive </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilegeWithLongOption() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--grant_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--list_privilege","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> privilegeStrs=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of privileges",6,privilegeStrs.size());
      assertTrue(privilegeStrs.contains("server=server1->action=*"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->action=select"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true"));
      assertTrue(privilegeStrs.contains("server=server1->uri=hdfs://path/testuri->action=*"));
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",5,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",4,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",3,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",2,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",1,privileges.size());
      args=new String[]{"--revoke_privilege_role","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",0,privileges.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilegeWithShortOption() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lp","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> privilegeStrs=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of privileges",6,privilegeStrs.size());
      assertTrue(privilegeStrs.contains("server=server1->action=*"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->action=select"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col1->action=insert"));
      assertTrue(privilegeStrs.contains("server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true"));
      assertTrue(privilegeStrs.contains("server=server1->uri=hdfs://path/testuri->action=*"));
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryPrivilege> privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",5,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->column=col2->action=insert->grantoption=true","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",4,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->uri=hdfs://path/testuri","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",3,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->table=tbl1->action=insert","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",2,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->db=db1->action=select","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",1,privileges.size());
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-p","server=server1->action=*","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      privileges=client.listAllPrivilegesByRoleName(requestorName,TEST_ROLE_NAME_1);
      assertEquals("Incorrect number of privileges",0,privileges.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDeleteRoleForGroup() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      client.createRole(requestorName,TEST_ROLE_NAME_2);
      String[] args={"-arg","-r",TEST_ROLE_NAME_1,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-arg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--add_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lr","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-g","testGroup2","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",1,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-g","testGroup3","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",1,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_1,"-g","testGroup2,testGroup3","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--delete_role_group","-r",TEST_ROLE_NAME_2,"-g","testGroup1","-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryRole> roles=client.listRolesByGroupName(requestorName,"testGroup1");
      assertEquals("Incorrect number of roles",0,roles.size());
      roles=client.listRolesByGroupName(requestorName,"testGroup2");
      assertEquals("Incorrect number of roles",0,roles.size());
      roles=client.listRolesByGroupName(requestorName,"testGroup3");
      assertEquals("Incorrect number of roles",0,roles.size());
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
      client.dropRole(requestorName,TEST_ROLE_NAME_2);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String[] args={"-cr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--create_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"-lr","-conf",confPath.getAbsolutePath()};
      SentryShellHive sentryShell=new SentryShellHive();
      Set<String> roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"--list_role","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      roleNames=getShellResultWithOSRedirect(sentryShell,args,true);
      assertEquals("Incorrect number of roles",2,roleNames.size());
      for (      String roleName : roleNames) {
        assertTrue(TEST_ROLE_NAME_1.equalsIgnoreCase(roleName) || TEST_ROLE_NAME_2.equalsIgnoreCase(roleName));
      }
      args=new String[]{"-dr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      args=new String[]{"--drop_role","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      SentryShellHive.main(args);
      Set<TSentryRole> roles=client.listRoles(requestorName);
      assertEquals("Incorrect number of roles",0,roles.size());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestColumnEndToEnd </h4><pre class="type-12 type-5 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDescribeTbl() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE IF NOT EXISTS t1 (c1 string, c2 string)");
  statement.execute("CREATE TABLE t2 (c1 string, c2 string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE user_role1");
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  ResultSet rs=statement.executeQuery("DESCRIBE t1");
  assertTrue(rs.next());
  assertEquals("c1",rs.getString(1));
  assertEquals("string",rs.getString(2));
  assertTrue(rs.next());
  assertEquals("c2",rs.getString(1));
  assertEquals("string",rs.getString(2));
  statement.executeQuery("DESCRIBE t1 c1");
  statement.executeQuery("DESCRIBE t1 c2");
  try {
    statement.executeQuery("DESCRIBE t2");
    fail("Expected DESCRIBE to fail on t2");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE FORMATTED t1");
    fail("Expected DESCRIBE FORMATTED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("DESCRIBE EXTENDED t1");
    fail("Expected DESCRIBE EXTENDED to fail");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP TABLE t1");
  statement.execute("DROP TABLE t2");
  statement.execute("DROP ROLE user_role1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestConcurrentClients </h4><pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test when concurrent HS2 clients talking to server,
 * Privileges are correctly created and updated.
 * @throws Exception
 */
@Test public void testConccurentHS2Client() throws Exception {
  ExecutorService executor=Executors.newFixedThreadPool(NUM_OF_THREADS);
  final TestRuntimeState state=new TestRuntimeState();
  for (int i=0; i < NUM_OF_TASKS; i++) {
    executor.execute(new Runnable(){
      @Override public void run(){
        LOGGER.info("Starting tests: create role, show role, create db and tbl, and create partitions");
        if (state.failed)         return;
        try {
          Long startTime=System.currentTimeMillis();
          Long elapsedTime=0L;
          while (Long.compare(elapsedTime,HS2_CLIENT_TEST_DURATION_MS) <= 0) {
            String randStr=randomString(5);
            String test_role="test_role_" + randStr;
            String test_db="test_db_" + randStr;
            String test_tb="test_tb_" + randStr;
            LOGGER.info("Start to test sentry with hs2 client with role " + test_role);
            adminCreateRole(test_role);
            adminShowRole(test_role);
            createDbTb(ADMIN1,test_db,test_tb);
            adminGrant(test_db,test_tb,test_role,USERGROUP1);
            createPartition(USER1_1,test_db,test_tb);
            adminCleanUp(test_db,test_role);
            elapsedTime=System.currentTimeMillis() - startTime;
            LOGGER.info("elapsedTime = " + elapsedTime);
          }
          state.setNumSuccess();
        }
 catch (        Exception e) {
          LOGGER.error("Exception: " + e);
          state.setFirstException(e);
        }
      }
    }
);
  }
  executor.shutdown();
  while (!executor.isTerminated()) {
    Thread.sleep(1000);
  }
  Throwable ex=state.getFirstException();
  assertFalse(ex == null ? "Test failed" : ex.toString(),state.failed);
  assertEquals(NUM_OF_TASKS,state.getNumSuccess());
}

</code></pre>

<br>
<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test when concurrent sentry clients talking to sentry server, threads data are synchronized
 * @throws Exception
 */
@Test public void testConcurrentSentryClient() throws Exception {
  final String HIVE_KEYTAB_PATH=System.getProperty("sentry.e2etest.hive.policyOwnerKeytab");
  final SentryPolicyServiceClient client=getSentryClient("hive",HIVE_KEYTAB_PATH);
  ExecutorService executor=Executors.newFixedThreadPool(NUM_OF_THREADS);
  final TestRuntimeState state=new TestRuntimeState();
  for (int i=0; i < NUM_OF_TASKS; i++) {
    LOGGER.info("Start to test sentry client with task id [" + i + "]");
    executor.execute(new Runnable(){
      @Override public void run(){
        if (state.failed) {
          LOGGER.error("found one failed state, abort test from here.");
          return;
        }
        try {
          String randStr=randomString(5);
          String test_role="test_role_" + randStr;
          LOGGER.info("Start to test role: " + test_role);
          Long startTime=System.currentTimeMillis();
          Long elapsedTime=0L;
          while (Long.compare(elapsedTime,SENTRY_CLIENT_TEST_DURATION_MS) <= 0) {
            LOGGER.info("Test role " + test_role + " runs "+ elapsedTime+ " ms.");
            client.createRole(ADMIN1,test_role);
            client.listRoles(ADMIN1);
            client.grantServerPrivilege(ADMIN1,test_role,"server1",false);
            client.listAllPrivilegesByRoleName(ADMIN1,test_role);
            client.dropRole(ADMIN1,test_role);
            elapsedTime=System.currentTimeMillis() - startTime;
          }
          state.setNumSuccess();
        }
 catch (        Exception e) {
          LOGGER.error("Sentry Client Testing Exception: ",e);
          state.setFirstException(e);
        }
      }
    }
);
  }
  executor.shutdown();
  while (!executor.isTerminated()) {
    Thread.sleep(1000);
  }
  Throwable ex=state.getFirstException();
  assertFalse(ex == null ? "Test failed" : ex.toString(),state.failed);
  assertEquals(NUM_OF_TASKS,state.getNumSuccess());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDatabaseProvider </h4><pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON SERVER serverName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleObObjectGivenServer() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE default");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-10 type-19 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON URI uriName: Needs Hive patch
 * @throws Exception
 */
@Ignore @Test public void testShowPrivilegesByRoleOnUri() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON URI 'file:///tmp/file.txt'");
  assertTrue("Expecting SQL Exception",false);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW ROLES
 * @throws Exception3.1. When there are no roles, returns empty list
 * 3.2. When there are roles, returns correct list with correct schema.
 */
@Test public void testShowRoles() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW ROLES");
  List<String> expected=new ArrayList<>();
  expected.add("admin_role");
  assertTestRoles(resultSet,expected,true);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  resultSet=statement.executeQuery("SHOW ROLES");
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(1));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  expected.add("role1");
  expected.add("role2");
  assertTestRoles(resultSet,expected,true);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void testUriWithEquals() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/partition=value/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/partition=value/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON TABLE tableName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenTable() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string)");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON COLUMN colName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenColumn() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t2(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t3(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t4(c1 string, c2 int)");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE role1");
  statement.execute("GRANT SELECT (c2) ON TABLE t2 TO ROLE role1");
  statement.execute("GRANT SELECT (c1,c2) ON TABLE t3 TO ROLE role1");
  statement.execute("GRANT SELECT (c1,c2) ON TABLE t4 TO ROLE role1 with grant option");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1 (c1)");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t2 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t2"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t3 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t3"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t3 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t3"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t4 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t4"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("True")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t4 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t4"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("True")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t2 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON DATABASE databaseName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenDatabase() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON DATABASE default TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE default");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE " + DB1);
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. When there are no roles and group, throws SentryNoSuchObjectException
 * 4.2. When there are roles, returns correct list with correct schema.
 */
@Test public void testShowRolesByGroup() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("CREATE ROLE role3");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(4));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  assertThat(resultSetMetaData.getColumnName(2),equalToIgnoringCase("grant_option"));
  assertThat(resultSetMetaData.getColumnName(3),equalToIgnoringCase("grant_time"));
  assertThat(resultSetMetaData.getColumnName(4),equalToIgnoringCase("grantor"));
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
    assertThat(resultSet.getBoolean(2),is(new Boolean("False")));
    assertThat(resultSet.getString(4),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Grant/Revoke privilege - Positive cases
 * @throws Exception1.1. All on server
 * 1.2. All on database
 * 1.3. All on URI
 * 1.4. All on table
 * 1.5. Insert on table
 * 1.6. Select on table
 * 1.7. Partial privileges on table
 * 1.7.1. Grant all, revoke insert leads to select on table
 * 1.7.2. Grant all, revoke select leads to select on table
 */
@Test public void testGrantRevokePrivileges() throws Exception {
  Connection connection;
  Statement statement;
  ResultSet resultSet;
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 to role role1");
  statement.execute("GRANT Role role1 to group " + ADMINGROUP);
  statement.execute("Create table tab1(col1 int)");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON SERVER server1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON DATABASE default to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON DATABASE default from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON URI 'file:///path' to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file://path"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON URI 'file:///path' from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT INSERT ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("insert"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE INSERT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT SELECT ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE SELECT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT SELECT(col1) ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("col1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE SELECT(col1) ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("REVOKE INSERT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("REVOKE SELECT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("insert"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. Show role grant works for non-admin users when the user belongs to the requested group
 * 4.2. Show role grant FAILS for non-admin users when the user doesn't belongs to the requested group
 */
@Test public void testShowRolesByGroupNonAdmin() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP2);
  statement.execute("GRANT ROLE role1 to GROUP " + ADMINGROUP);
  statement.execute("GRANT ROLE role2 to GROUP " + ADMINGROUP);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + ADMINGROUP,SentryAccessDeniedException.class.getSimpleName());
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP2);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role2"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName
 * @throws Exception5.1. When there are no privileges granted to a role, returns an empty list
 * 5.2. When there are privileges, returns correct list with correct schema.
 * 5.3. Given privileges on table, show grant on table should return table privilege.
 * 5.4. Privileges on database
 * 5.4.1. Show grant on database should return correct priv
 * 5.4.2. Show grant on table should return correct priv
 * 5.5. Privileges on server
 * 5.5.1. Show grant on database should return correct priv
 * 5.5.2. Show grant on table should return correct priv
 * 5.5.3. Show grant on server should return correct priv (sql not supported yet in hive)
 * 5.6. Show grant on uri (sql not supported yet in hive)
 */
@Test public void testShowPrivilegesByRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("CREATE ROLE role2");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string, c2 int)");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE role1");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  String[] users={ADMIN1,USER1_1};
  for (  String user : users) {
    connection=context.createConnection(user);
    statement=context.createStatement(connection);
    resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
    ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
    assertThat(resultSetMetaData.getColumnCount(),is(10));
    assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("database"));
    assertThat(resultSetMetaData.getColumnName(2),equalToIgnoringCase("table"));
    assertThat(resultSetMetaData.getColumnName(3),equalToIgnoringCase("partition"));
    assertThat(resultSetMetaData.getColumnName(4),equalToIgnoringCase("column"));
    assertThat(resultSetMetaData.getColumnName(5),equalToIgnoringCase("principal_name"));
    assertThat(resultSetMetaData.getColumnName(6),equalToIgnoringCase("principal_type"));
    assertThat(resultSetMetaData.getColumnName(7),equalToIgnoringCase("privilege"));
    assertThat(resultSetMetaData.getColumnName(8),equalToIgnoringCase("grant_option"));
    assertThat(resultSetMetaData.getColumnName(9),equalToIgnoringCase("grant_time"));
    assertThat(resultSetMetaData.getColumnName(10),equalToIgnoringCase("grantor"));
    while (resultSet.next()) {
      assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
      assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
      assertThat(resultSet.getString(3),equalToIgnoringCase(""));
      assertThat(resultSet.getString(4),equalToIgnoringCase(""));
      assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
      assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
      assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
      assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
      assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
    }
    statement.close();
    connection.close();
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW GRANT ROLE role1",SentryAccessDeniedException.class.getSimpleName());
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW CURRENT ROLE
 * @throws Exception
 */
@Test public void testShowCurrentRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ROLE role1 TO GROUP " + ADMINGROUP);
  statement.execute("SET ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(1));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Corner cases
 * @throws Exception7.1. Drop role which doesn't exist, throws SentryNoSuchObjectException
 * 7.2. Create role which already exists, throws SentryAlreadyExitsException
 * 7.3. Drop role when privileges mapping exists and create role with same name, old
 * mappings should not exist
 * 7.4. Grant role, when role doesn't exist, throws SentryNoSuchObjectException
 * 7.5. Grant role when mapping exists, silently allows
 * 7.6. Grant multiple roles to a group
 * 7.7. Revoke role after role has been dropped, SentryNoSuchObjectException
 * 7.8. Revoke role from a group when mapping doesn't exist, silently allows
 * 7.9. Grant privilege to a role, privilege already exists, silently allows
 * 7.10. Grant privilege to a role, mapping already exists, silently allows
 * 7.11. Multiple privileges to a role
 * 7.12. Revoke privilege when privilege doesn't exist, silently allows
 * 7.13. Revoke privilege, when role doesn't exist, SentryNoSuchObjectException
 * 7.14. Revoke privilege when mapping doesn't exist, silently allows
 * 7.15. Drop role should remove role-group mapping
 */
@Test public void testCornerCases() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE IF NOT EXISTS tab1(c1 string)");
  context.assertSentryException(statement,"DROP ROLE role1",SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role1");
  context.assertSentryException(statement,"CREATE ROLE role1",SentryAlreadyExistsException.class.getSimpleName());
  statement.execute("GRANT ROLE role1 TO GROUP " + USERGROUP1);
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("DROP ROLE role1");
  statement.execute("CREATE ROLE role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  context.assertSentryException(statement,"GRANT role role2 TO GROUP " + USERGROUP1,SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertResultSize(resultSet,2);
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("DROP ROLE role2");
  context.assertSentryException(statement,"REVOKE role role2 from group " + USERGROUP1,SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("REVOKE ROLE role1 from GROUP " + USERGROUP1);
  statement.execute("REVOKE ROLE role1 from GROUP " + USERGROUP1);
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role2");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  resultSet=statement.executeQuery("SHOW GRANT ROLE role2");
  assertResultSize(resultSet,1);
  statement.execute("GRANT ALL ON TABLE tab1 to ROLE role2");
  statement.execute("GRANT ALL,INSERT ON TABLE tab1 to ROLE role2");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role2");
  assertResultSize(resultSet,2);
  statement.execute("DROP role role2");
  statement.execute("REVOKE ALL ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  int count=0;
  while (resultSet.next()) {
    count++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
  }
  assertThat(count,is(1));
  context.assertSentryException(statement,"REVOKE ALL ON SERVER server1 from role role2",SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ALL on TABLE tab1 to ROLE role2");
  statement.execute("REVOKE ALL on TABLE tab1 from Role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("DROP role role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("DROP ROLE role1");
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertResultSize(resultSet,0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbEndToEnd </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUPrivileges() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("CREATE ROLE uri_role");
  statement.execute("GRANT SELECT ON URI 'file://" + dataDir.getPath() + "' TO ROLE uri_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE uri_role TO GROUP " + USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE uri_role");
  assertTrue(resultSet.next());
  assertEquals("file://" + dataDir.getPath(),resultSet.getString(1));
  resultSet.close();
  resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertTrue(resultSet.next());
  assertEquals("default",resultSet.getString(1));
  assertEquals("t1",resultSet.getString(2));
  resultSet.close();
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestCrossDbOps </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Test Case 2.11 admin user create a new database DB_1 and grant ALL to
 * himself on DB_1 should work
 */
@Test public void testAdminDbPrivileges() throws Exception {
  createDb(ADMIN1,DB1);
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  String tabName=DB1 + "." + "admin_tab1";
  adminStmt.execute("create table " + tabName + "(c1 string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ tabName);
  assertTrue(adminStmt.executeQuery("select * from " + tabName).next());
  adminStmt.close();
  adminCon.close();
}

</code></pre>

<br>
<pre class="type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testJDBCGetSchemasAndGetTables() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB1(id int)");
  statement.executeQuery("SHOW TABLES");
  statement.execute("USE " + DB2);
  statement.execute("CREATE TABLE TAB2(id int)");
  statement.execute("CREATE TABLE TAB3(id int)");
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=" + DB1 + "->table=tab1->action=select").addPermissionsToRole("select_tab3","server=server1->db=" + DB2 + "->table=tab3->action=select").addPermissionsToRole("insert_tab2","server=server1->db=" + DB2 + "->table=tab2->action=insert").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection conn=context.createConnection(USER1_1);
  Statement stmt=context.createStatement(conn);
  ResultSet res=stmt.executeQuery("SHOW DATABASES");
  res=conn.getMetaData().getSchemas();
  ResultSetMetaData resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  List<String> expectedResult=new ArrayList<String>();
  List<String> returnedResult=new ArrayList<String>();
  expectedResult.add(DB1);
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB1,"tab%",null);
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB2,"tab%",null);
  expectedResult.add("tab2");
  while (res.next()) {
    returnedResult.add(res.getString(3).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab2");
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  conn.close();
  conn=context.createConnection(USER2_1);
  res=conn.getMetaData().getSchemas();
  resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab3");
  while (res.next()) {
    returnedResult.add(res.getString(3).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,DB1,"tab%","i%");
  while (res.next()) {
    returnedResult.add(res.getString(4).trim());
  }
  validateReturnedResult(expectedResult,returnedResult);
  returnedResult.clear();
  expectedResult.clear();
  res.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestExportImportPrivileges </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testInsertToDirPrivileges() throws Exception {
  Connection connection=null;
  Statement statement=null;
  String dumpDir=dfs.getBaseDir() + "/hive_data_dump";
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  policyFile.addRolesToGroup(USERGROUP1,"db1_read","db1_write","data_dump").addRolesToGroup(USERGROUP2,"db1_read","db1_write").addPermissionsToRole("db1_write","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=INSERT").addPermissionsToRole("db1_read","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=SELECT").addPermissionsToRole("data_dump","server=server1->URI=" + dumpDir);
  writePolicyFile(policyFile);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  context.assertAuthzException(statement,"INSERT OVERWRITE DIRECTORY '" + dumpDir + "' SELECT * FROM "+ TBL1);
  statement.close();
  connection.close();
  String scratchLikeDir=context.getProperty(HiveConf.ConfVars.SCRATCHDIR.varname) + "_foo";
  dfs.assertCreateDir(scratchLikeDir);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  context.assertAuthzException(statement,"INSERT OVERWRITE DIRECTORY '" + scratchLikeDir + "/bar' SELECT * FROM "+ TBL1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  assertTrue(statement.executeQuery("SELECT * FROM " + TBL1).next());
  statement.execute("INSERT OVERWRITE DIRECTORY '" + dumpDir + "' SELECT * FROM "+ TBL1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestJDBCInterface </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJDBCGetSchemasAndGetTables() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB2 CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB1(id int)");
  statement.executeQuery("SHOW TABLES");
  statement.execute("USE " + DB2);
  statement.execute("CREATE TABLE TAB2(id int)");
  statement.execute("CREATE TABLE TAB3(id int)");
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","insert_tab2").addRolesToGroup(USERGROUP2,"select_tab3").addPermissionsToRole("select_tab1","server=server1->db=" + DB1 + "->table=tab1->action=select").addPermissionsToRole("select_tab3","server=server1->db=" + DB2 + "->table=tab3->action=select").addPermissionsToRole("insert_tab2","server=server1->db=" + DB2 + "->table=tab2->action=insert");
  writePolicyFile(policyFile);
  Connection conn=context.createConnection(USER1_1);
  List<String> expectedResult=new ArrayList<String>();
  List<String> returnedResult=new ArrayList<String>();
  ResultSet res=conn.getMetaData().getSchemas();
  ResultSetMetaData resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  expectedResult.add(DB1);
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB1,"tab%",null);
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,DB2,"tab%",null);
  expectedResult.add("tab2");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab2");
  expectedResult.add("tab1");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  conn.close();
  conn=context.createConnection(USER2_1);
  res=conn.getMetaData().getSchemas();
  resMeta=res.getMetaData();
  assertEquals(2,resMeta.getColumnCount());
  assertEquals("TABLE_SCHEM",resMeta.getColumnName(1));
  assertEquals("TABLE_CATALOG",resMeta.getColumnName(2));
  expectedResult.add(DB2);
  expectedResult.add("default");
  while (res.next()) {
    returnedResult.add(res.getString(1));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getTables(null,"DB%","tab%",null);
  expectedResult.add("tab3");
  while (res.next()) {
    returnedResult.add(res.getString(3));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,"DB%","tab%","i%");
  expectedResult.add("id");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  validateReturnedResult(expectedResult,returnedResult);
  expectedResult.clear();
  returnedResult.clear();
  res.close();
  res=conn.getMetaData().getColumns(null,DB1,"tab%","i%");
  while (res.next()) {
    returnedResult.add(res.getString(4));
  }
  assertTrue("returned result shouldn't contain any value, actually returned result = " + returnedResult.toString(),returnedResult.isEmpty());
  res.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMetadataObjectRetrieval </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that admin and all@db can describe database
 * and describe database extended. Also tests that a user
 * with no privileges on a db cannot describe database.
 */
@Test public void testDescribeDatabasesWithAllOnServerAndAllOnDb() throws Exception {
  dropDb(ADMIN1,DB1,DB2);
  createDb(ADMIN1,DB1,DB2);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  createTable(ADMIN1,DB2,dataFile,TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=" + DB1).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB1).next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE EXTENDED " + DB1).next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB1).next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE EXTENDED " + DB1).next());
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB2);
  context.assertAuthzException(statement,"DESCRIBE DATABASE EXTENDED " + DB2);
  policyFile.addPermissionsToRole(GROUP1_ROLE,INSERT_DB2_TBL1);
  writePolicyFile(policyFile);
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB2);
  context.assertAuthzException(statement,"DESCRIBE DATABASE EXTENDED " + DB2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that a user without db level privileges cannot describe default
 */
@Test public void testDescribeDefaultDatabase() throws Exception {
  createDb(ADMIN1,DB1,DB2);
  createTable(ADMIN1,"default",dataFile,TBL1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE default").next());
  statement.execute("USE " + DB1);
  assertTrue(statement.executeQuery("DESCRIBE DATABASE default").next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB1).next());
  assertTrue(statement.executeQuery("DESCRIBE DATABASE " + DB2).next());
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=default->table=" + TBL1 + "->action=select","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=select").addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,"DESCRIBE DATABASE default");
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB1);
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMetadataPermissions </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that a user with privileges on a database can describe
 * the database.
 */
@Test public void testDescDbPrivilegesPositive() throws Exception {
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  for (  String dbName : new String[]{DB1,DB2}) {
    statement.execute("USE " + dbName);
    Assert.assertTrue(statement.executeQuery("DESCRIBE DATABASE " + dbName).next());
    Assert.assertTrue(statement.executeQuery("DESCRIBE DATABASE EXTENDED " + dbName).next());
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure that a user with privileges on a table can describe the table.
 */
@Test public void testDescPrivilegesPositive() throws Exception {
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  for (  String dbName : new String[]{DB1,DB2}) {
    statement.execute("USE " + dbName);
    Assert.assertTrue(statement.executeQuery("DESCRIBE DATABASE " + dbName).next());
    for (    String tabName : new String[]{"tab1","tab2"}) {
      Assert.assertTrue(statement.executeQuery("DESCRIBE " + tabName).next());
      Assert.assertTrue(statement.executeQuery("DESCRIBE EXTENDED " + tabName).next());
    }
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMovingToProduction </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * repeat above tests, only difference is don't do 'USE <database>'
 * in this test. Instead, access table objects across database by
 * database.table
 * @throws Exception
 */
@Test public void testMovingTable2() throws Exception {
  String tableName1="tb_1";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("DROP DATABASE IF EXISTS " + DB2 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ tableName1);
  statement.execute("create table " + DB2 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("load_data","server=server1->uri=file://" + dataDir.getPath());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("LOAD DATA LOCAL INPATH 'file://" + dataDir.getPath() + "' INTO TABLE "+ DB1+ "."+ tableName1);
  policyFile.addRolesToGroup(USERGROUP1,"insert_proddb_tbl1").addPermissionsToRole("insert_proddb_tbl1","server=server1->db=" + DB2 + "->table=tb_1->action=insert");
  writePolicyFile(policyFile);
  statement.execute("INSERT OVERWRITE TABLE " + DB2 + "."+ tableName1+ " SELECT * FROM "+ DB1+ "."+ tableName1);
  policyFile.addRolesToGroup(USERGROUP1,"select_proddb_tbl1").addPermissionsToRole("select_proddb_tbl1","server=server1->db=" + DB2 + "->table=tb_1->action=select");
  writePolicyFile(policyFile);
  assertTrue("user1 should be able to select data from " + DB2 + "."+ DB2+ "."+ tableName1,statement.execute("SELECT * FROM " + DB2 + "."+ tableName1+ " LIMIT 10"));
  assertTrue("user1 should be able to describe table " + DB2 + "."+ tableName1,statement.execute("DESCRIBE " + DB2 + "."+ tableName1));
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,"INSERT OVERWRITE TABLE " + DB2 + "."+ tableName1+ " SELECT * FROM "+ DB1+ "."+ tableName1);
  context.assertAuthzException(statement,"SELECT * FROM " + DB2 + "."+ tableName1+ " LIMIT 10");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  context.assertAuthzException(statement,"DROP TABLE " + tableName1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegeAtTransform </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Steps:
 * 1. admin create database, create table, load data into it
 * 2. all@server can issue transforms command
 * 3. all@database cannot issue transform command
 * 4. insert@table select@table cannot issue transform command
 * 5. select@view cannot issue transform command
 * 6. transform@server can issue the transform command
 * 7. non-admin user with URI privilege on transform can execute query
 */
@Test public void testTransform1() throws Exception {
  policyFile.addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("transform_uri","server=server1->uri=file:///bin/cat").addRolesToGroup(USERGROUP1,"all_db1").addRolesToGroup(USERGROUP2,"all_db1","transform_uri").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  String tableName1="tb_1";
  String query="select TRANSFORM(a.under_col, a.value) " + "USING '/bin/cat' AS (tunder_col, tvalue) FROM " + DB1 + "."+ tableName1+ " a";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int, value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ DB1+ "."+ tableName1);
  assertTrue(query,statement.execute(query));
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,query);
  policyFile.addPermissionsToRole("select_tb1","server=server1->db=" + DB1 + "->table=tb_1->action=select").addPermissionsToRole("insert_tb1","server=server1->db=" + DB1 + "->table=tb_1->action=insert").addRolesToGroup(USERGROUP1,"select_tb1","insert_tb1");
  writePolicyFile(policyFile);
  context.assertAuthzException(statement,query);
  policyFile.addPermissionsToRole("all_server1","server=server1").addRolesToGroup(USERGROUP1,"all_server1");
  writePolicyFile(policyFile);
  assertTrue(query,statement.execute(query));
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  assertTrue(query,statement.execute(query));
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtDatabaseScope </h4><pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilegeOnObjectOwnedByAdmin() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  File externalTblDir=new File(dataDir,"exttab");
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE PART_TAB_1(A STRING) partitioned by (B INT) STORED AS TEXTFILE");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=1)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE PART_TAB_1 PARTITION(B=2)");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data","exttab").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("exttab","server=server1->uri=file://" + dataDir.getPath()).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_1");
  statement.execute("CREATE TABLE TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE TAB_2");
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1500);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("DROP TABLE TAB_3");
  assertTrue("Unable to create directory for external table test",externalTblDir.mkdir());
  statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
  context.assertSentrySemanticException(statement,"ALTER TABLE TAB_2 SET LOCATION 'file:///tab2'",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("CREATE EXTERNAL TABLE EXT_TAB_1(A STRING) STORED AS TEXTFILE LOCATION 'file:" + externalTblDir.getAbsolutePath() + "'");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAllPrivilege() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("CREATE DATABASE " + DB2);
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addRolesToGroup(USERGROUP2,"all_db2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("CREATE TABLE " + DB1 + ".TAB_1(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_1");
  statement.execute("CREATE TABLE " + DB1 + ".TAB_2(A STRING)");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".TAB_2");
  statement.execute("USE " + DB1);
  statement.execute("create table table2 as select A, count(A) from TAB_1 GROUP BY A");
  statement.execute("USE " + DB1);
  statement.execute("CREATE VIEW VIEW_1(A) AS SELECT A FROM TAB_1");
  statement.execute("INSERT INTO TABLE TAB_1 SELECT A FROM TAB_2");
  ResultSet resultSet=statement.executeQuery("SELECT COUNT(A) FROM TAB_1");
  int count=0;
  int countRows=0;
  while (resultSet.next()) {
    count=resultSet.getInt(1);
    countRows++;
  }
  assertTrue("Incorrect row count",countRows == 1);
  assertTrue("Incorrect result",count == 1000);
  statement.execute("ALTER TABLE TAB_1 RENAME TO TAB_3");
  statement.execute("CREATE TABLE TAB_4 AS SELECT * FROM TAB_2");
  statement.execute("ALTER TABLE TAB_3 ADD COLUMNS (B INT)");
  statement.execute("DROP TABLE TAB_3");
  try {
    statement.execute("DROP DATABASE " + DB2 + " CASCADE");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.execute("USE " + DB2);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.execute("DROP DATABASE " + DB1 + " CASCADE");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtTableScope </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Test queries without from clause. Hive rewrites the queries with dummy db and table
 * entities which should not trip authorization check.
 * @throws Exception
 */
@Test public void testSelectWithoutFrom() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"all_tab1").addPermissionsToRole("all_tab1","server=server1->db=" + DB1 + "->table="+ TBL1).addRolesToGroup(USERGROUP2,"select_tab1").addPermissionsToRole("select_tab1","server=server1->db=" + DB1 + "->table="+ TBL1).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  assertTrue(statement.executeQuery("SELECT 1 ").next());
  assertTrue(statement.executeQuery("SELECT current_database()").next());
  statement.execute("USE " + DB1);
  assertTrue(statement.executeQuery("SELECT 1 ").next());
  assertTrue(statement.executeQuery("SELECT current_database() ").next());
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-17 type-12 type-5 type-10 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInsert() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"insert_tab1","select_tab2").addPermissionsToRole("insert_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=insert").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL2 + "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("INSERT INTO TABLE " + TBL1 + " SELECT A, B FROM "+ TBL2);
  try {
    statement.executeQuery("SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  try {
    statement.executeQuery("SELECT A FROM VIEW_1");
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  ResultSet resultSet=statement.executeQuery("SHOW TABLES");
  while (resultSet.next()) {
    String tableName=resultSet.getString(1);
    assertNotNull("table name is null in result set",tableName);
    assertFalse("Found VIEW_1 in the result set","VIEW_1".equalsIgnoreCase(tableName));
  }
  try {
    statement.executeQuery("CREATE VIEW VIEW_2(A) AS SELECT A FROM " + TBL1);
    Assert.fail("Expected SQL Exception");
  }
 catch (  SQLException e) {
    context.verifyAuthzException(e);
  }
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify truncate table permissions for different users with different
 * privileges
 * @throws Exception
 */
@Test public void testTruncateTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,MULTI_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(MULTI_TYPE_DATA_FILE_NAME),to);
  to.close();
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE if exists " + TBL1);
  statement.execute("DROP TABLE if exists " + TBL2);
  statement.execute("DROP TABLE if exists " + TBL3);
  statement.execute("CREATE TABLE " + TBL1 + "(B INT, A STRING) "+ " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE " + TBL2 + "(B INT, A STRING) "+ " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("CREATE TABLE " + TBL3 + "(B INT, A STRING) "+ " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL1);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL2);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL3);
  statement.execute("TRUNCATE TABLE " + TBL1);
  assertFalse(hasData(statement,TBL1));
  statement.close();
  connection.close();
  updatePolicyFile();
  truncateTableTests(false);
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify truncate partitioned permissions for different users with different
 * privileges
 * @throws Exception
 */
@Test public void testTruncatePartitionedTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,MULTI_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(MULTI_TYPE_DATA_FILE_NAME),to);
  to.close();
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE if exists " + TBL1);
  statement.execute("CREATE TABLE " + TBL1 + " (i int) PARTITIONED BY (j int)");
  statement.execute("DROP TABLE if exists " + TBL2);
  statement.execute("CREATE TABLE " + TBL2 + " (i int) PARTITIONED BY (j int)");
  statement.execute("DROP TABLE if exists " + TBL3);
  statement.execute("CREATE TABLE " + TBL3 + " (i int) PARTITIONED BY (j int)");
  statement.execute("TRUNCATE TABLE " + TBL1);
  assertFalse(hasData(statement,TBL1));
  statement.close();
  connection.close();
  updatePolicyFile();
  truncateTableTests(false);
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("ALTER TABLE " + TBL1 + " ADD PARTITION (j=1) PARTITION (j=2)");
  statement.execute("ALTER TABLE " + TBL2 + " ADD PARTITION (j=1) PARTITION (j=2)");
  statement.execute("ALTER TABLE " + TBL3 + " ADD PARTITION (j=1) PARTITION (j=2)");
  statement.execute("TRUNCATE TABLE " + TBL1 + " partition (j=1)");
  statement.execute("TRUNCATE TABLE " + TBL1);
  assertFalse(hasData(statement,TBL1));
  statement.close();
  connection.close();
  truncateTableTests(true);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestRuntimeMetadataRetrieval </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Steps: 1. admin creates tables in default db
 * 2. user1 shouldn't see any table when he/she doesn't have any privilege on default
 */
@Test public void testShowTables5() throws Exception {
  String tableNames[]={"tb_1","tb_2","tb_3","tb_4"};
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  createTabs(statement,"default",tableNames);
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  ResultSet rs=statement.executeQuery("SHOW TABLES");
  Assert.assertFalse(rs.next());
  statement.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestSandboxOps </h4><pre class="type-12 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Steps:
 * 1. Admin user creates a new database DB_1
 * 2. Admin user grants ALL on DB_1 to group GROUP_1
 * 3. User from GROUP_1 creates table TAB_1, TAB_2 in DB_1
 * 4. Admin user grants SELECT/INSERT on TAB_1 to group GROUP_2
 * a) verify users from GROUP_2 have only SELECT/INSERT
 * privileges on TAB_1. They shouldn't be able to perform
 * any operation other than those listed as
 * requiring SELECT in the privilege model.
 * b) verify users from GROUP_2 can't perform queries
 * involving join between TAB_1 and TAB_2.
 * c) verify users from GROUP_1 can't perform operations
 * requiring ALL @SERVER scope:
 * *) create database
 * *) drop database
 * *) show databases
 * *) show locks
 * *) execute ALTER TABLE .. SET LOCATION on a table in DB_1
 * *) execute ALTER PARTITION ... SET LOCATION on a table in DB_1
 * *) execute CREATE EXTERNAL TABLE ... in DB_1
 * *) execute ADD JAR
 * *) execute a query with TRANSOFORM
 * @throws Exception
 */
@Test public void testSandboxOpt17() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1,TBL2);
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addRolesToGroup(USERGROUP2,"select_tb1").addPermissionsToRole("select_tb1","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=select").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("load_data","server=server1->uri=file://" + dataFile.toString());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"CREATE DATABASE " + DB3);
  ResultSet rs=statement.executeQuery("SHOW DATABASES");
  assertTrue(rs.next());
  assertEquals(DB1,rs.getString(1));
  context.assertAuthzException(statement,"ALTER TABLE " + TBL1 + " ADD PARTITION (value = 10) LOCATION '"+ dataDir.getPath()+ "'");
  context.assertAuthzException(statement,"ALTER TABLE " + TBL1 + " PARTITION (value = 10) SET LOCATION '"+ dataDir.getPath()+ "'");
  context.assertAuthzException(statement,"CREATE EXTERNAL TABLE " + TBL3 + " (under_col int, value string) LOCATION '"+ dataDir.getPath()+ "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SELECT * FROM TABLE " + TBL2 + " LIMIT 10");
  context.assertAuthzException(statement,"EXPLAIN SELECT * FROM TABLE " + TBL2 + " WHERE under_col > 5 LIMIT 10");
  context.assertAuthzException(statement,"DESCRIBE " + TBL2);
  context.assertAuthzException(statement,"LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ TBL2);
  context.assertAuthzException(statement,"analyze table " + TBL2 + " compute statistics for columns under_col, value");
  context.assertAuthzException(statement,"SELECT " + TBL1 + ".* FROM "+ TBL1+ " JOIN "+ TBL2+ " ON ("+ TBL1+ ".value = "+ TBL2+ ".value)");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests select on table with index.
 * Steps:
 * 1. admin user create a new database DB_1
 * 2. admin create TABLE_1 in DB_1
 * 3. admin create INDEX_1 for COLUMN_1 in TABLE_1 in DB_1
 * 4. admin user grant INSERT and SELECT to user1's group on TABLE_1
 * negative test case:
 * a) user1 try to SELECT * FROM TABLE_1 WHERE COLUMN_1 == ...
 * should NOT work
 * b) user1 should not be able to check the list of view or
 * index in DB_1
 * @throws Exception
 */
@Test public void testSandboxOpt13() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  createTable(ADMIN1,DB1,dataFile,TBL2);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP INDEX IF EXISTS " + INDEX1 + " ON "+ TBL1);
  statement.execute("CREATE INDEX " + INDEX1 + " ON TABLE "+ TBL1+ " (under_col) as 'COMPACT' WITH DEFERRED REBUILD");
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL2).addRolesToGroup(USERGROUP1,GROUP1_ROLE);
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SELECT * FROM " + TBL1 + " WHERE under_col == 5");
  context.assertAuthzException(statement,"SHOW INDEXES ON " + TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL1,INSERT_DB1_TBL1,loadData);
  writePolicyFile(policyFile);
  statement.execute("USE " + DB1);
  assertTrue(statement.execute("SELECT * FROM " + TBL1 + " WHERE under_col == 5"));
  assertTrue(statement.execute("SHOW INDEXES ON " + TBL1));
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests to ensure that users with all@db can create tables
 * and that they cannot create databases or load data
 */
@Test public void testDbPrivileges() throws Exception {
  String[] dbs=new String[]{DB1,DB2};
  for (  String dbName : dbs) {
    createDb(ADMIN1,dbName);
  }
  addTwoUsersWithAllDb();
  writePolicyFile(policyFile);
  for (  String user : new String[]{USER1_1,USER1_2}) {
    for (    String dbName : dbs) {
      Connection userConn=context.createConnection(user);
      String tabName=user + "_tab1";
      Statement userStmt=context.createStatement(userConn);
      userStmt.execute("use " + dbName);
      userStmt.execute("create table " + tabName + " (id int)");
      context.assertAuthzException(userStmt,"load data local inpath '" + dataFile + "' into table "+ tabName);
      assertTrue(userStmt.execute("select * from " + tabName));
      context.assertAuthzException(userStmt,"CREATE DATABASE " + DB3);
      userStmt.close();
      userConn.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUriPermissions </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testLoadPrivileges() throws Exception {
  dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  loadData="server=server1->uri=file://" + dataFile.getPath();
  String tabName="tab1";
  Connection userConn=null;
  Statement userStmt=null;
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  adminStmt.execute("CREATE TABLE " + tabName + "(id int)");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_read","db1_write","data_read").addRolesToGroup(USERGROUP2,"db1_write").addPermissionsToRole("db1_write","server=server1->db=" + DB1 + "->table="+ tabName+ "->action=INSERT").addPermissionsToRole("db1_read","server=server1->db=" + DB1 + "->table="+ tabName+ "->action=SELECT").addPermissionsToRole("data_read",loadData);
  writePolicyFile(policyFile);
  userConn=context.createConnection(USER1_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  userStmt.execute("load data local inpath 'file://" + dataFile.getPath() + "' into table "+ tabName);
  userStmt.execute("select * from " + tabName + " limit 1");
  ResultSet res=userStmt.getResultSet();
  Assert.assertTrue("Table should have data after load",res.next());
  res.close();
  context.close();
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  context.assertAuthzException(userStmt,"load data local inpath 'file://" + dataFile.getPath() + "' into table "+ tabName);
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUserManagement </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that user without uri privilege can create table but not load data
 */
@Test public void testGroup4() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addRolesToGroup("group1","non_admin_role","load_data").addPermissionsToRole("non_admin_role","server=server1->db=" + dbName).addGroupsToUser("user1","group1").addGroupsToUser("user2","group1").addGroupsToUser("user3","group1");
  writePolicyFile(policyFile);
  doDropDb("admin1");
  for (  String user : new String[]{"user1","user2","user3"}) {
    doCreateDb("admin1");
    Connection connection=context.createConnection(user);
    Statement statement=context.createStatement(connection);
    statement.execute("USE " + dbName);
    statement.execute("CREATE TABLE " + tableName + " (under_col int comment 'the under column', value string) comment '"+ tableComment+ "'");
    context.assertAuthzException(statement,"LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' into table "+ tableName);
    assertTrue(statement.execute("SELECT * FROM " + tableName));
    statement.close();
    connection.close();
    doDropDb("admin1");
  }
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that users with no privileges cannot list any tables
 */
@Test public void testGroup8() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addRolesToGroup("group1","analytics").addGroupsToUser("user1","group1").addGroupsToUser("user2","group1").addGroupsToUser("user3","group1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection("admin1");
  Statement statement=connection.createStatement();
  statement.execute("DROP DATABASE IF EXISTS db1 CASCADE");
  statement.execute("CREATE DATABASE db1");
  statement.execute("USE db1");
  statement.execute("CREATE TABLE t1 (under_col int, value string)");
  statement.close();
  connection.close();
  String[] users={"user1","user2","user3"};
  for (  String user : users) {
    connection=context.createConnection(user);
    statement=context.createStatement(connection);
    assertFalse("No results should be returned",statement.executeQuery("SHOW TABLES").next());
    statement.close();
    connection.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestViewPrivileges </h4><pre class="type-17 type-12 type-5 type-7 type-14 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartitioned() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  String viewName="view1";
  String db="db1";
  String tabName="tab1";
  policyFile.addPermissionsToRole("view","server=server1->db=" + db + "->table="+ viewName).addRolesToGroup(USERGROUP1,"view").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  policyFile.write(context.getPolicyFile());
  Connection conn=context.createConnection(ADMIN1);
  Statement stmt=context.createStatement(conn);
  stmt.execute("DROP DATABASE IF EXISTS " + db + " CASCADE");
  stmt.execute("CREATE DATABASE " + db);
  stmt.execute("use " + db);
  stmt.execute("create table " + tabName + " (id int) partitioned by (part string)");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"a\")");
  stmt.execute("load data local inpath '" + dataFile + "' into table "+ tabName+ " PARTITION (part=\"b\")");
  ResultSet res=stmt.executeQuery("select count(*) from " + tabName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    Assume.assumeTrue(res.getInt(1) == new Integer(1000));
  }
  stmt.execute("create view " + viewName + " as select * from "+ tabName+ " where id<100");
  res=stmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  int rowsInView=0;
  while (res.next()) {
    rowsInView=res.getInt(1);
  }
  stmt.close();
  conn.close();
  Connection userConn=context.createConnection(USER1_1);
  Statement userStmt=context.createStatement(userConn);
  userStmt.execute("use " + db);
  res=userStmt.executeQuery("select count(*) from " + viewName);
  org.junit.Assert.assertThat(res,notNullValue());
  while (res.next()) {
    org.junit.Assert.assertThat(res.getInt(1),is(rowsInView));
  }
  userStmt.close();
  userConn.close();
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  try {
    userStmt.executeQuery("select count(*) from " + viewName);
    Assert.fail("Expected SQL exception");
  }
 catch (  SQLException e) {
  }
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestAuthorizingObjectStore </h4><pre class="type-12 type-5 type-7 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * User accessAllMetaUser is configured as the value of
 * "sentry.metastore.service.users" and has all access to databases and
 * tables.
 * @throws Exception
 */
@Test public void testPrivilegesForUserWithoutAccess() throws Exception {
  HiveMetaStoreClient client=context.getMetaStoreClient(userWithoutAccess);
  assertThat(client.getDatabase(dbName1),notNullValue());
  assertThat(client.getDatabase(dbName2),notNullValue());
  assertThat(client.getAllDatabases().size(),equalTo(3));
  assertThat(client.getDatabases("*").size(),equalTo(3));
  assertThat(client.getTable(dbName1,tabName1),notNullValue());
  assertThat(client.getTable(dbName1,tabName2),notNullValue());
  assertThat(client.getTable(dbName2,tabName3),notNullValue());
  assertThat(client.getTable(dbName2,tabName4),notNullValue());
  assertThat(client.listPartitions(dbName1,tabName1,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.listPartitions(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)1).size(),equalTo(1));
  assertThat(client.getPartition(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getPartition(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal))),notNullValue());
  assertThat(client.getTables(dbName1,"tab*").size(),equalTo(2));
  assertThat(client.getTables(dbName2,"tab*").size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName1,new ArrayList<String>(Arrays.asList(tabName1,tabName2))).size(),equalTo(2));
  assertThat(client.getTableObjectsByName(dbName2,new ArrayList<String>(Arrays.asList(tabName3,tabName4))).size(),equalTo(2));
  assertThat(client.getAllTables(dbName1).size(),equalTo(2));
  assertThat(client.getAllTables(dbName2).size(),equalTo(2));
  assertThat(client.listPartitionNames(dbName1,tabName1,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.listPartitionNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),(short)2).size(),equalTo(1));
  assertThat(client.getPartitionsByNames(dbName1,tabName1,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName1,tabName2,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName3,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  assertThat(client.getPartitionsByNames(dbName2,tabName4,new ArrayList<String>(Arrays.asList(""))).size(),equalTo(0));
  try {
    client.getIndex(dbName1,tabName1,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName1,tabName2,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  try {
    client.getIndex(dbName2,tabName3,"empty");
    fail("NoSuchObjectException should have been thrown");
  }
 catch (  NoSuchObjectException noe) {
  }
  assertThat(client.listIndexes(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexes(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName1,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName1,tabName2,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName3,(short)1).size(),equalTo(0));
  assertThat(client.listIndexNames(dbName2,tabName4,(short)1).size(),equalTo(0));
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName1,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName1,tabName2,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName3,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getPartitionWithAuthInfo(dbName2,tabName4,new ArrayList<String>(Arrays.asList(partitionVal)),"tempuser",new ArrayList<String>(Arrays.asList("tempgroup"))),notNullValue());
  assertThat(client.getTableColumnStatistics(dbName1,tabName1,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName1,tabName2,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName3,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  assertThat(client.getTableColumnStatistics(dbName2,tabName4,new ArrayList<String>(Arrays.asList(colName1))).size(),equalTo(0));
  client.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.TestDocLevelOperations </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test the allRolesToken.  Make it a keyword in the query language ("OR")
 * to make sure it is treated literally rather than interpreted.
 */
@Test public void testAllRolesToken() throws Exception {
  String collectionName="allRolesCollection";
  setupCollectionWithDocSecurity(collectionName);
  try {
    String allRolesToken="OR";
    int junitFactor=2;
    int allRolesFactor=5;
    int totalJunitAdded=0;
    int totalAllRolesAdded=0;
    int totalOnlyAllRolesAdded=0;
    ArrayList<SolrInputDocument> docs=new ArrayList<SolrInputDocument>();
    for (int i=0; i < NUM_DOCS; ++i) {
      boolean addedViaJunit=false;
      SolrInputDocument doc=new SolrInputDocument();
      String iStr=Long.toString(i);
      doc.addField("id",iStr);
      doc.addField("description","description" + iStr);
      if (i % junitFactor == 0) {
        doc.addField(AUTH_FIELD,"junit_role");
        addedViaJunit=true;
        ++totalJunitAdded;
      }
      if (i % allRolesFactor == 0) {
        doc.addField(AUTH_FIELD,allRolesToken);
        ++totalAllRolesAdded;
        if (!addedViaJunit)         ++totalOnlyAllRolesAdded;
      }
      docs.add(doc);
    }
    assert (totalOnlyAllRolesAdded > 0);
    assert (totalJunitAdded > totalAllRolesAdded);
    CloudSolrServer server=getCloudSolrServer(collectionName);
    try {
      server.add(docs);
      server.commit(true,true);
      SolrQuery query=new SolrQuery();
      query.setQuery("*:*");
      setAuthenticationUser("admin");
      QueryResponse rsp=server.query(query);
      SolrDocumentList docList=rsp.getResults();
      assertEquals(totalAllRolesAdded,docList.getNumFound());
      for (      SolrDocument doc : docList) {
        String id=doc.getFieldValue("id").toString();
        assertEquals(0,Long.valueOf(id) % allRolesFactor);
      }
      setAuthenticationUser("junit");
      rsp=server.query(query);
      docList=rsp.getResults();
      assertEquals(totalJunitAdded + totalOnlyAllRolesAdded,docList.getNumFound());
      for (      SolrDocument doc : docList) {
        String id=doc.getFieldValue("id").toString();
        boolean addedJunit=(Long.valueOf(id) % junitFactor) == 0;
        boolean onlyAllRoles=!addedJunit && (Long.valueOf(id) % allRolesFactor) == 0;
        assertEquals(true,addedJunit || onlyAllRoles);
      }
    }
  finally {
      server.shutdown();
    }
  }
  finally {
    deleteCollection(collectionName);
  }
}

</code></pre>

<br>
<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Test that queries from different users only return the documents they have access to.
 */
@Test public void testDocLevelOperations() throws Exception {
  String collectionName="docLevelCollection";
  setupCollectionWithDocSecurity(collectionName);
  try {
    createDocsAndQuerySimple(collectionName,true);
    CloudSolrServer server=getCloudSolrServer(collectionName);
    try {
      setAuthenticationUser("junit");
      String fq=URLEncoder.encode(" {!raw f=" + AUTH_FIELD + " v=docLevel_role}");
      String path="/" + collectionName + "/select?q=*:*&fq="+ fq;
      String retValue=makeHttpRequest(server,"GET",path,null,null);
      assertTrue(retValue.contains("numFound=\"" + NUM_DOCS / 2 + "\" "));
      final String syntaxErrorMsg="org.apache.solr.search.SyntaxError: Cannot parse";
      fq=URLEncoder.encode(" {!raw f=" + AUTH_FIELD + " v=docLevel_role} OR ");
      path="/" + collectionName + "/select?q=*:*&fq="+ fq;
      retValue=makeHttpRequest(server,"GET",path,null,null);
      assertTrue(retValue.contains(syntaxErrorMsg));
      fq=URLEncoder.encode(" OR {!raw f=" + AUTH_FIELD + " v=docLevel_role}");
      path="/" + collectionName + "/select?q=*:*&fq="+ fq;
      retValue=makeHttpRequest(server,"GET",path,null,null);
      assertTrue(retValue.contains(syntaxErrorMsg));
    }
  finally {
      server.shutdown();
    }
  }
  finally {
    deleteCollection(collectionName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.TestUpdateOperations </h4><pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testInvariantProcessor() throws Exception {
  String collectionName="testInvariantCollection";
  uploadConfigDirToZk(RESOURCES_DIR + File.separator + DEFAULT_COLLECTION+ File.separator+ "conf");
  setupCollection(collectionName);
  setAuthenticationUser("junit");
  CloudSolrServer server=getCloudSolrServer(collectionName);
  try {
    String path="/" + collectionName + "/update?update.chain=skipUpdateIndexAuthorization&commit=true";
    String body="<add><doc><field name=\"id\">testInvariantDoc</field></doc></add>";
    String ret=makeHttpRequest(server,"POST",path,body.getBytes("UTF-8"),"text/xml");
    assertTrue("Expected sentry exception",ret.contains("SentrySolrAuthorizationException: User junit" + " does not have privileges for testInvariantCollection"));
  }
  finally {
    server.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.db.integration.TestSolrDocLevelOperations </h4><pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDocLevelOperations() throws Exception {
  setupCollectionWithDocSecurity(TEST_COLLECTION_NAME1);
  createDocument(TEST_COLLECTION_NAME1);
  CloudSolrServer server=getCloudSolrServer(TEST_COLLECTION_NAME1);
  try {
    SolrQuery query=new SolrQuery();
    query.setQuery("*:*");
    setAuthenticationUser(ADMIN_USER);
    QueryResponse rsp=server.query(query);
    SolrDocumentList docList=rsp.getResults();
    assertEquals(NUM_DOCS,docList.getNumFound());
    setAuthenticationUser("user0");
    grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.QUERY);
    rsp=server.query(query);
    docList=rsp.getResults();
    assertEquals(NUM_DOCS / 4,rsp.getResults().getNumFound());
    setAuthenticationUser("user1");
    grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role1",SearchConstants.QUERY);
    rsp=server.query(query);
    docList=rsp.getResults();
    assertEquals(NUM_DOCS / 4,rsp.getResults().getNumFound());
    docList=rsp.getResults();
    assertEquals(NUM_DOCS / 4,rsp.getResults().getNumFound());
    setAuthenticationUser("user2");
    grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.QUERY);
    rsp=server.query(query);
    docList=rsp.getResults();
    assertEquals(NUM_DOCS / 4,rsp.getResults().getNumFound());
    setAuthenticationUser("user3");
    grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role3",SearchConstants.QUERY);
    rsp=server.query(query);
    docList=rsp.getResults();
    assertEquals(NUM_DOCS / 4,rsp.getResults().getNumFound());
  }
  finally {
    server.shutdown();
  }
  deleteCollection(TEST_COLLECTION_NAME1);
}

</code></pre>

<br>
<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void updateDocsTest() throws Exception {
  setupCollectionWithDocSecurity(TEST_COLLECTION_NAME1);
  createDocument(TEST_COLLECTION_NAME1);
  CloudSolrServer server=getCloudSolrServer(TEST_COLLECTION_NAME1);
  try {
    setAuthenticationUser("user0");
    grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.QUERY);
    String docIdStr=Long.toString(1);
    SolrQuery query=new SolrQuery();
    query.setQuery("id:" + docIdStr);
    QueryResponse rsp=server.query(query);
    assertEquals(0,rsp.getResults().getNumFound());
    setAuthenticationUser(ADMIN_USER);
    ArrayList<SolrInputDocument> docs=new ArrayList<SolrInputDocument>();
    SolrInputDocument doc=new SolrInputDocument();
    doc.addField("id",docIdStr);
    doc.addField("description","description" + docIdStr);
    doc.addField(AUTH_FIELD,"role0");
    docs.add(doc);
    server.add(docs);
    server.commit();
    setAuthenticationUser("user0");
    rsp=server.query(query);
    assertEquals(1,rsp.getResults().getNumFound());
  }
  finally {
    server.shutdown();
  }
  deleteCollection(TEST_COLLECTION_NAME1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.sentry.SentryIndexAuthorizationSingletonTest </h4><pre class="type-12 type-5 type-7 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoBinding() throws Exception {
  Constructor ctor=SentryIndexAuthorizationSingleton.class.getDeclaredConstructor(String.class);
  ctor.setAccessible(true);
  SentryIndexAuthorizationSingleton nonSingleton=(SentryIndexAuthorizationSingleton)ctor.newInstance("");
  doExpectUnauthorized(nonSingleton,null,null,"binding");
  try {
    nonSingleton.getUserName(null);
    Assert.fail("Expected Solr exception");
  }
 catch (  SolrException ex) {
    assertEquals(ex.code(),SolrException.ErrorCode.UNAUTHORIZED.code);
  }
  Collection<String> groups=nonSingleton.getRoles("junit");
  assertEquals(null,groups);
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
