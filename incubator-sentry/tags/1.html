<h3><span class=" glyphicon glyphicon-tag"/>&nbspExecutionTester</h3><kbd>Executes methods or other tests from the same test unit</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.sentry.binding.hive.TestHiveAuthzBindings </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testValidateCreateFunctionAppropiateURI() throws Exception {
  inputTabHierarcyList.add(Arrays.asList(new DBModelAuthorizable[]{new Server(SERVER1),new AccessURI("file:///path/to/some/lib/dir/my.jar")}));
  testAuth.authorize(HiveOperation.CREATEFUNCTION,createFuncPrivileges,ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate create table permissions for admin in customer db
 */
@Test public void testValidateCreateTabPrivilegesForAdmin() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,null));
  testAuth.authorize(HiveOperation.CREATETABLE,createTabPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate create database permission for admin
 */
@Test public void testValidateCreateDbForAdmin() throws Exception {
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,null,null));
  testAuth.authorize(HiveOperation.CREATEDATABASE,createDbPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate create database permission for admin
 */
@Test(expected=AuthorizationException.class) public void testValidateCreateDbRejectionForUser() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,null,null));
  testAuth.authorize(HiveOperation.CREATEDATABASE,createDbPrivileges,ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate create table permissions denided to junior_analyst in customer db
 */
@Test(expected=AuthorizationException.class) public void testValidateCreateTabPrivilegesRejectionForUser() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,null));
  testAuth.authorize(HiveOperation.CREATETABLE,createTabPrivileges,JUNIOR_ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate read permission for admin on customer:purchase
 */
@Test public void testValidateSelectPrivilegesForUsers() throws Exception {
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.QUERY,queryPrivileges,ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate load table permissions on manager for customer:purchases
 */
@Test public void testValidateLoadTabPrivilegesForUser() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.LOAD,loadTabPrivileges,MANAGER_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryGroupNotFoundException.class) public void testValidateCreateFunctionRejectionForUnknownUser() throws Exception {
  inputTabHierarcyList.add(Arrays.asList(new DBModelAuthorizable[]{new Server(SERVER1),new AccessURI("file:///path/to/some/lib/dir/my.jar")}));
  testAuth.authorize(HiveOperation.CREATEFUNCTION,createFuncPrivileges,NO_SUCH_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate create table permissions for manager in junior_analyst sandbox db
 */
@Test public void testValidateCreateTabPrivilegesForUser() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,JUNIOR_ANALYST_DB,null));
  testAuth.authorize(HiveOperation.CREATETABLE,createTabPrivileges,MANAGER_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate create table permissions denided to junior_analyst in analyst sandbox db
 */
@Test(expected=AuthorizationException.class) public void testValidateCreateTabPrivilegesRejectionForUser2() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,ANALYST_DB,null));
  testAuth.authorize(HiveOperation.CREATETABLE,createTabPrivileges,JUNIOR_ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * hive.metastore.sasl.enabled != true, make sure InvalidConfigurationException is thrown.
 * @throws Exception
 */
@Test(expected=InvalidConfigurationException.class) public void testHiveMetaStoreSSLConfig() throws Exception {
  hiveConf.setBoolVar(ConfVars.METASTORE_USE_THRIFT_SASL,false);
  hiveConf.setBoolVar(ConfVars.METASTORE_EXECUTE_SET_UGI,true);
  authzConf.set(AuthzConfVars.SENTRY_TESTING_MODE.getVar(),"false");
  testAuth=new HiveAuthzBinding(HiveAuthzBinding.HiveHook.HiveMetaStore,hiveConf,authzConf);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate read permission for admin on customer:purchase
 */
@Test public void testValidateSelectPrivilegesForAdmin() throws Exception {
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.QUERY,queryPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Turn on impersonation and make sure that the authorization fails.
 * @throws Exception
 */
@Test public void testImpersonationAllowed() throws Exception {
  hiveConf.setBoolVar(ConfVars.HIVE_SERVER2_ENABLE_DOAS,true);
  hiveConf.setVar(ConfVars.HIVE_SERVER2_AUTHENTICATION,"Kerberos");
  authzConf.set(AuthzConfVars.SENTRY_TESTING_MODE.getVar(),"false");
  authzConf.set(AuthzConfVars.AUTHZ_ALLOW_HIVE_IMPERSONATION.getVar(),"true");
  testAuth=new HiveAuthzBinding(hiveConf,authzConf);
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.QUERY,queryPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate load table permissions rejected for analyst on customer:purchases
 */
@Test(expected=AuthorizationException.class) public void testValidateLoadTabPrivilegesRejectionForUser() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.LOAD,loadTabPrivileges,ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AuthorizationException.class) public void testValidateCreateFunctionRejectionForUserWithoutURI() throws Exception {
  inputTabHierarcyList.add(Arrays.asList(new DBModelAuthorizable[]{new Server(SERVER1),new Database(CUSTOMER_DB),new Table(AccessConstants.ALL)}));
  inputTabHierarcyList.add(Arrays.asList(new DBModelAuthorizable[]{new Server(SERVER1),new AccessURI("file:///some/path/to/a.jar")}));
  testAuth.authorize(HiveOperation.CREATEFUNCTION,createFuncPrivileges,ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * HiveServer2 not using string authentication, make sure InvalidConfigurationException is thrown.
 * @throws Exception
 */
@Test(expected=InvalidConfigurationException.class) public void testHiveServer2AuthRestriction() throws Exception {
  hiveConf.setBoolVar(ConfVars.HIVE_SERVER2_ENABLE_DOAS,false);
  hiveConf.setVar(ConfVars.HIVE_SERVER2_AUTHENTICATION,"none");
  authzConf.set(AuthzConfVars.SENTRY_TESTING_MODE.getVar(),"false");
  testAuth=new HiveAuthzBinding(hiveConf,authzConf);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Turn off authentication and verify exception is raised in non-testing mode
 * @throws Exception
 */
@Test(expected=InvalidConfigurationException.class) public void testNoAuthenticationRestriction() throws Exception {
  hiveConf.setVar(ConfVars.HIVE_SERVER2_AUTHENTICATION,"None");
  authzConf.set(AuthzConfVars.SENTRY_TESTING_MODE.getVar(),"false");
  testAuth=new HiveAuthzBinding(hiveConf,authzConf);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate read permission for denied for junior analyst on customer:purchase
 */
@Test(expected=AuthorizationException.class) public void testValidateSelectPrivilegesRejectionForUsers() throws Exception {
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.QUERY,queryPrivileges,JUNIOR_ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Validate create function permission for admin (server level priviledge
 */
@Test public void testValidateCreateFunctionForAdmin() throws Exception {
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB,AGE_COL));
  inputTabHierarcyList.add(Arrays.asList(new DBModelAuthorizable[]{new Server(SERVER1),new AccessURI("file:///some/path/to/a/jar")}));
  testAuth.authorize(HiveOperation.CREATEFUNCTION,createFuncPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Positive test case for MSCK REPAIR TABLE. User has privileges to execute the
 * operation.
 */
@Test public void testMsckRepairTable() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,JUNIOR_ANALYST_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.MSCK,alterTabPrivileges,MANAGER_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
  testAuth.authorize(HiveOperation.MSCK,alterTabPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,ANALYST_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.MSCK,alterTabPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Negative case for MSCK REPAIR TABLE. User should not have privileges to execute
 * the operation.
 */
@Test(expected=AuthorizationException.class) public void testMsckRepairTableRejection() throws Exception {
  inputTabHierarcyList.add(buildObjectHierarchy(SERVER1,JUNIOR_ANALYST_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.MSCK,alterTabPrivileges,JUNIOR_ANALYST_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Turn on impersonation and make sure InvalidConfigurationException is thrown.
 * @throws Exception
 */
@Test(expected=InvalidConfigurationException.class) public void testImpersonationRestriction() throws Exception {
  hiveConf.setBoolVar(ConfVars.HIVE_SERVER2_ENABLE_DOAS,true);
  hiveConf.setVar(ConfVars.HIVE_SERVER2_AUTHENTICATION,"Kerberos");
  authzConf.set(AuthzConfVars.SENTRY_TESTING_MODE.getVar(),"false");
  testAuth=new HiveAuthzBinding(hiveConf,authzConf);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * hive.metastore.execute.setugi != true, make sure InvalidConfigurationException is thrown.
 * @throws Exception
 */
@Test(expected=InvalidConfigurationException.class) public void testHiveMetaStoreUGIConfig() throws Exception {
  hiveConf.setBoolVar(ConfVars.METASTORE_USE_THRIFT_SASL,true);
  hiveConf.setBoolVar(ConfVars.METASTORE_EXECUTE_SET_UGI,false);
  authzConf.set(AuthzConfVars.SENTRY_TESTING_MODE.getVar(),"true");
  testAuth=new HiveAuthzBinding(HiveAuthzBinding.HiveHook.HiveMetaStore,hiveConf,authzConf);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * validate load permissions for admin on customer:purchases
 */
@Test public void testValidateLoadTabPrivilegesForAdmin() throws Exception {
  outputTabHierarcyList.add(buildObjectHierarchy(SERVER1,CUSTOMER_DB,PURCHASES_TAB));
  testAuth.authorize(HiveOperation.LOAD,loadTabPrivileges,ADMIN_SUBJECT,inputTabHierarcyList,outputTabHierarcyList);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.binding.hive.TestSentryHiveAuthorizationTaskFactory </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * REVOKE ROLE ... FROM USER ...
 */
@Test public void testRevokeRoleUser() throws Exception {
  expectSemanticException("REVOKE ROLE " + ROLE + " FROM USER "+ USER,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_ON_OBJECT + "USER");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * REVOKE ... ON TABLE ... FROM USER ...
 */
@Test public void testRevokeUserTable() throws Exception {
  expectSemanticException("REVOKE " + ALL + " ON TABLE "+ TABLE+ " FROM USER "+ USER,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "USER");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * SHOW GRANT GROUP ... ON TABLE ...
 */
@Test public void testShowGrantGroupOnTable() throws Exception {
  expectSemanticException("SHOW GRANT GROUP " + GROUP + " ON TABLE "+ TABLE,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "GROUP");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * SHOW ROLE GRANT USER ...
 */
@Test public void testShowRoleGrantUser() throws Exception {
  expectSemanticException("SHOW ROLE GRANT USER " + USER,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "USER");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * GRANT ROLE ... TO USER ...
 */
@Test public void testGrantRoleUser() throws Exception {
  expectSemanticException("GRANT ROLE " + ROLE + " TO USER "+ USER,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_ON_OBJECT + "USER");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * GRANT ... ON TABLE ... TO USER ...
 */
@Test public void testGrantUserTable() throws Exception {
  expectSemanticException("GRANT " + ALL + " ON TABLE "+ TABLE+ " TO USER "+ USER,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "USER");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * GRANT ROLE ... TO ROLE ...
 */
@Test public void testGrantRoleRole() throws Exception {
  expectSemanticException("GRANT ROLE " + ROLE + " TO ROLE "+ ROLE,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_ON_OBJECT + "ROLE");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * SHOW ROLE GRANT ROLE ...
 */
@Test public void testShowRoleGrantRole() throws Exception {
  expectSemanticException("SHOW ROLE GRANT ROLE " + ROLE,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "ROLE");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * REVOKE ... ON TABLE ... FROM GROUP ...
 */
@Test public void testRevokeGroupTable() throws Exception {
  expectSemanticException("REVOKE " + ALL + " ON TABLE "+ TABLE+ " FROM GROUP "+ GROUP,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "GROUP");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * GRANT ... ON TABLE ... TO GROUP ...
 */
@Test public void testGrantGroupTable() throws Exception {
  expectSemanticException("GRANT " + ALL + " ON TABLE "+ TABLE+ " TO GROUP "+ GROUP,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "GROUP");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * SHOW GRANT USER ... ON TABLE ...
 */
@Test public void testShowGrantUserOnTable() throws Exception {
  expectSemanticException("SHOW GRANT USER " + USER + " ON TABLE "+ TABLE,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_FOR_PRINCIPAL + "USER");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * REVOKE ROLE ... FROM ROLE ...
 */
@Test public void testRevokeRoleRole() throws Exception {
  expectSemanticException("REVOKE ROLE " + ROLE + " FROM ROLE "+ ROLE,SentryHiveConstants.GRANT_REVOKE_NOT_SUPPORTED_ON_OBJECT + "ROLE");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.binding.solr.TestSolrAuthzBinding </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that a full sentry-site definition works.
 */
@Test public void testSolrAuthzConfs() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  new SolrAuthzBinding(solrAuthzConf);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that when the resource is put on  HDFS and the scheme of the resource is not set,
 * the resouce can be found if fs.defaultFS is specified
 */
@Test public void testResourceWithSchemeNotSet() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  MiniDFSCluster dfsCluster=HdfsTestUtil.setupClass(new File(Files.createTempDir(),TestSolrAuthzBinding.class.getName() + "_" + System.currentTimeMillis()).getAbsolutePath());
  String resourceOnHDFS="/hdfs" + File.separator + UUID.randomUUID()+ File.separator+ "test-authz-provider.ini";
  try {
    Path src=new Path(baseDir.getPath(),RESOURCE_PATH);
    dfsCluster.getFileSystem().copyFromLocalFile(false,new Path(baseDir.getPath(),RESOURCE_PATH),new Path(resourceOnHDFS));
    solrAuthzConf.set(AuthzConfVars.AUTHZ_PROVIDER_RESOURCE.getVar(),resourceOnHDFS);
    solrAuthzConf.set("fs.defaultFS",dfsCluster.getFileSystem().getConf().get("fs.defaultFS"));
    new SolrAuthzBinding(solrAuthzConf);
  }
  finally {
    if (dfsCluster != null) {
      HdfsTestUtil.teardownClass(dfsCluster);
    }
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that a bogus collection name throws an exception
 */
@Test public void testNoCollection() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  expectAuthException(binding,corporal1,new Collection("bogus"),querySet);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that standard authorized attempts succeed
 */
@Test public void testAuthAllowed() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  binding.authorizeCollection(corporal1,infoCollection,querySet);
  binding.authorizeCollection(sergeant1,infoCollection,querySet);
  binding.authorizeCollection(sergeant1,infoCollection,updateSet);
  binding.authorizeCollection(general1,infoCollection,querySet);
  binding.authorizeCollection(general1,infoCollection,updateSet);
  binding.authorizeCollection(general1,infoCollection,allSet);
  binding.authorizeCollection(general1,infoCollection,allOfSet);
  binding.authorizeCollection(general1,generalInfoCollection,querySet);
  binding.authorizeCollection(general1,generalInfoCollection,updateSet);
  binding.authorizeCollection(general1,generalInfoCollection,allSet);
  binding.authorizeCollection(general1,generalInfoCollection,allOfSet);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that standard unauthorized attempts fail
 */
@Test public void testAuthException() throws Exception {
  SolrAuthzConf solrAuthzConf=new SolrAuthzConf(Resources.getResource("sentry-site.xml"));
  setUsableAuthzConf(solrAuthzConf);
  SolrAuthzBinding binding=new SolrAuthzBinding(solrAuthzConf);
  expectAuthException(binding,corporal1,infoCollection,updateSet);
  expectAuthException(binding,corporal1,infoCollection,allSet);
  expectAuthException(binding,corporal1,generalInfoCollection,querySet);
  expectAuthException(binding,corporal1,generalInfoCollection,updateSet);
  expectAuthException(binding,corporal1,generalInfoCollection,allSet);
  expectAuthException(binding,sergeant1,infoCollection,allSet);
  expectAuthException(binding,sergeant1,generalInfoCollection,querySet);
  expectAuthException(binding,sergeant1,generalInfoCollection,updateSet);
  expectAuthException(binding,sergeant1,generalInfoCollection,allSet);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.indexer.TestIndexer </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNullIndexer(){
  Indexer nullIndexer=new Indexer(null);
  nullIndexer.getName();
  nullIndexer.toString();
  nullIndexer.getAuthzType();
  nullIndexer.getTypeName();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.core.search.TestCollection </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNullCollection(){
  Collection nullCollection=new Collection(null);
  nullCollection.getName();
  nullCollection.toString();
  nullCollection.getAuthzType();
  nullCollection.getTypeName();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.hdfs.TestKrbConnectionTimeout </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testConnectionAfterTicketTimeout() throws Exception {
  Thread.sleep(400000);
  connectToHdfsSyncService();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.common.TestKeyValue </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  new KeyValue(KV_JOINER.join("","b"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTwoParameterConstructor() throws Exception {
  KeyValue kv1=new KeyValue("k1","v1");
  KeyValue kv2=new KeyValue("k1","v1");
  KeyValue kv3=new KeyValue("k2","v2");
  doTest(kv1,kv2,kv3);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOneParameterConstructor() throws Exception {
  KeyValue kv1=new KeyValue(KV_JOINER.join("k1","v1"));
  KeyValue kv2=new KeyValue(KV_JOINER.join("k1","v1"));
  KeyValue kv3=new KeyValue(KV_JOINER.join("k2","v2"));
  doTest(kv1,kv2,kv3);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  new KeyValue(KV_JOINER.join("a",""));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestDBModelAuthorizables </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(DBModelAuthorizables.from("=v"));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNoKV() throws Exception {
  System.out.println(DBModelAuthorizables.from("nonsense"));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(DBModelAuthorizables.from("k="));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestDBWildcardPrivilege </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyPart() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_JOINER.join("server","server1"),"")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(create(KV_JOINER.join("db","")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyString() throws Exception {
  System.out.println(create(""));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testOnlySeperators() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_SEPARATOR,KV_SEPARATOR,KV_SEPARATOR)));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNullString() throws Exception {
  System.out.println(create((String)null));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(create(KV_JOINER.join("","db1")));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestDatabaseRequiredInRole </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testURIInPerDbPolicyFile() throws Exception {
  DatabaseRequiredInPrivilege dbRequiredInRole=new DatabaseRequiredInPrivilege();
  System.setProperty("sentry.allow.uri.db.policyfile","true");
  dbRequiredInRole.validate(new PrivilegeValidatorContext("db1","server=server1->URI=file:///user/db/warehouse/tab1"));
  System.setProperty("sentry.allow.uri.db.policyfile","false");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.db.TestResourceAuthorizationProviderGeneralCases </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAdmin() throws Exception {
  doTestResourceAuthorizationProvider(SUB_ADMIN,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,ALL,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,INSERT,true);
  doTestAuthorizables(SUB_ADMIN,SELECT,true,SVR_ALL,DB_CUSTOMERS,TBL_PURCHASES);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJuniorAnalyst() throws Exception {
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,ALL,false);
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,SELECT,false);
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,INSERT,false);
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_ALL,DB_CUSTOMERS,TBL_PURCHASES,SELECT,false);
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_SERVER1,DB_JR_ANALYST,TBL_PURCHASES,ALL,true);
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_SERVER1,DB_JR_ANALYST,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_SERVER1,DB_JR_ANALYST,TBL_PURCHASES,INSERT,true);
  doTestResourceAuthorizationProvider(SUB_JUNIOR_ANALYST,SVR_ALL,DB_JR_ANALYST,TBL_PURCHASES,SELECT,true);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testManager() throws Exception {
  doTestResourceAuthorizationProvider(SUB_MANAGER,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,ALL,false);
  doTestResourceAuthorizationProvider(SUB_MANAGER,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_MANAGER,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,INSERT,false);
  doTestResourceAuthorizationProvider(SUB_MANAGER,SVR_ALL,DB_CUSTOMERS,TBL_PURCHASES,SELECT,true);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAnalyst() throws Exception {
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,ALL,false);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_CUSTOMERS,TBL_PURCHASES,INSERT,false);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_ALL,DB_CUSTOMERS,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_ANALYST,TBL_PURCHASES,ALL,true);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_ANALYST,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_ANALYST,TBL_PURCHASES,INSERT,true);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_ALL,DB_ANALYST,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_JR_ANALYST,TBL_PURCHASES,ALL,false);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_JR_ANALYST,TBL_PURCHASES,SELECT,true);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_SERVER1,DB_JR_ANALYST,TBL_PURCHASES,INSERT,false);
  doTestResourceAuthorizationProvider(SUB_ANALYST,SVR_ALL,DB_JR_ANALYST,TBL_PURCHASES,SELECT,true);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerAuthorizationProviderGeneralCases </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAnalyst() throws Exception {
  Set<IndexerModelAction> writeOnly=EnumSet.of(IndexerModelAction.WRITE);
  doTestAuthProviderOnIndexer(SUB_ANALYST,IND_PURCHASES,writeOnly);
  Set<IndexerModelAction> allActions=EnumSet.allOf(IndexerModelAction.class);
  doTestAuthProviderOnIndexer(SUB_ANALYST,IND_ANALYST1,allActions);
  doTestAuthProviderOnIndexer(SUB_ANALYST,IND_JRANALYST1,allActions);
  Set<IndexerModelAction> readWriteOnly=EnumSet.of(READ,WRITE);
  doTestAuthProviderOnIndexer(SUB_ANALYST,IND_TMP,readWriteOnly);
  Set<IndexerModelAction> noActions=EnumSet.noneOf(IndexerModelAction.class);
  doTestAuthProviderOnIndexer(SUB_ANALYST,IND_PURCHASES_PARTIAL,noActions);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJuniorAnalyst() throws Exception {
  Set<IndexerModelAction> allActions=EnumSet.allOf(IndexerModelAction.class);
  doTestAuthProviderOnIndexer(SUB_JUNIOR_ANALYST,IND_JRANALYST1,allActions);
  Set<IndexerModelAction> readOnly=EnumSet.of(IndexerModelAction.READ);
  doTestAuthProviderOnIndexer(SUB_JUNIOR_ANALYST,IND_PURCHASES_PARTIAL,readOnly);
  Set<IndexerModelAction> noActions=EnumSet.noneOf(IndexerModelAction.class);
  doTestAuthProviderOnIndexer(SUB_JUNIOR_ANALYST,IND_PURCHASES,noActions);
  doTestAuthProviderOnIndexer(SUB_JUNIOR_ANALYST,IND_ANALYST1,noActions);
  doTestAuthProviderOnIndexer(SUB_JUNIOR_ANALYST,IND_TMP,noActions);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAdmin() throws Exception {
  Set<IndexerModelAction> allActions=EnumSet.allOf(IndexerModelAction.class);
  doTestAuthProviderOnIndexer(SUB_ADMIN,IND_PURCHASES,allActions);
  doTestAuthProviderOnIndexer(SUB_ADMIN,IND_ANALYST1,allActions);
  doTestAuthProviderOnIndexer(SUB_ADMIN,IND_JRANALYST1,allActions);
  doTestAuthProviderOnIndexer(SUB_ADMIN,IND_TMP,allActions);
  doTestAuthProviderOnIndexer(SUB_ADMIN,IND_PURCHASES_PARTIAL,allActions);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testManager() throws Exception {
  Set<IndexerModelAction> writeOnly=EnumSet.of(IndexerModelAction.WRITE);
  doTestAuthProviderOnIndexer(SUB_MANAGER,IND_PURCHASES,writeOnly);
  Set<IndexerModelAction> allActions=EnumSet.allOf(IndexerModelAction.class);
  doTestAuthProviderOnIndexer(SUB_MANAGER,IND_ANALYST1,allActions);
  doTestAuthProviderOnIndexer(SUB_MANAGER,IND_JRANALYST1,allActions);
  Set<IndexerModelAction> readWriteOnly=EnumSet.of(READ,WRITE);
  doTestAuthProviderOnIndexer(SUB_MANAGER,IND_TMP,readWriteOnly);
  Set<IndexerModelAction> readOnly=EnumSet.of(IndexerModelAction.READ);
  doTestAuthProviderOnIndexer(SUB_MANAGER,IND_PURCHASES_PARTIAL,readOnly);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerModelAuthorizables </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(IndexerModelAuthorizables.from("=v"));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNoKV() throws Exception {
  System.out.println(IndexerModelAuthorizables.from("nonsense"));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(IndexerModelAuthorizables.from("k="));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerRequiredInRole </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testIndexerWithAction() throws Exception {
  IndexerRequiredInPrivilege indRequiredInRole=new IndexerRequiredInPrivilege();
  indRequiredInRole.validate(new PrivilegeValidatorContext(null,"indexer=nodb->action=read"));
  indRequiredInRole.validate(new PrivilegeValidatorContext("db2","indexer=db->action=write"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testIndexerWithoutAction() throws Exception {
  IndexerRequiredInPrivilege indRequiredInRole=new IndexerRequiredInPrivilege();
  indRequiredInRole.validate(new PrivilegeValidatorContext("indexer=nodb"));
  indRequiredInRole.validate(new PrivilegeValidatorContext("db2","indexer=db"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.indexer.TestIndexerWildcardPrivilege </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyPart() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_JOINER.join("indexer11","index1"),"")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNullString() throws Exception {
  System.out.println(create((String)null));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyString() throws Exception {
  System.out.println(create(""));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(create(KV_JOINER.join("indexer","")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testOnlySeperators() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_SEPARATOR,KV_SEPARATOR,KV_SEPARATOR)));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(create(KV_JOINER.join("","index1")));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestCollectionRequiredInRole </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCollectionWithAction() throws Exception {
  CollectionRequiredInPrivilege collRequiredInRole=new CollectionRequiredInPrivilege();
  collRequiredInRole.validate(new PrivilegeValidatorContext(null,"collection=nodb->action=query"));
  collRequiredInRole.validate(new PrivilegeValidatorContext("db2","collection=db->action=update"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCollectionWithoutAction() throws Exception {
  CollectionRequiredInPrivilege collRequiredInRole=new CollectionRequiredInPrivilege();
  collRequiredInRole.validate(new PrivilegeValidatorContext("collection=nodb"));
  collRequiredInRole.validate(new PrivilegeValidatorContext("db2","collection=db"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchAuthorizationProviderGeneralCases </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testManager() throws Exception {
  Set<SearchModelAction> updateOnly=EnumSet.of(SearchModelAction.UPDATE);
  doTestAuthProviderOnCollection(SUB_MANAGER,COLL_PURCHASES,updateOnly);
  Set<SearchModelAction> allActions=EnumSet.allOf(SearchModelAction.class);
  doTestAuthProviderOnCollection(SUB_MANAGER,COLL_ANALYST1,allActions);
  doTestAuthProviderOnCollection(SUB_MANAGER,COLL_JRANALYST1,allActions);
  Set<SearchModelAction> queryUpdateOnly=EnumSet.of(QUERY,UPDATE);
  doTestAuthProviderOnCollection(SUB_MANAGER,COLL_TMP,queryUpdateOnly);
  Set<SearchModelAction> queryOnly=EnumSet.of(SearchModelAction.QUERY);
  doTestAuthProviderOnCollection(SUB_MANAGER,COLL_PURCHASES_PARTIAL,queryOnly);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAdmin() throws Exception {
  Set<SearchModelAction> allActions=EnumSet.allOf(SearchModelAction.class);
  doTestAuthProviderOnCollection(SUB_ADMIN,COLL_PURCHASES,allActions);
  doTestAuthProviderOnCollection(SUB_ADMIN,COLL_ANALYST1,allActions);
  doTestAuthProviderOnCollection(SUB_ADMIN,COLL_JRANALYST1,allActions);
  doTestAuthProviderOnCollection(SUB_ADMIN,COLL_TMP,allActions);
  doTestAuthProviderOnCollection(SUB_ADMIN,COLL_PURCHASES_PARTIAL,allActions);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAnalyst() throws Exception {
  Set<SearchModelAction> updateOnly=EnumSet.of(SearchModelAction.UPDATE);
  doTestAuthProviderOnCollection(SUB_ANALYST,COLL_PURCHASES,updateOnly);
  Set<SearchModelAction> allActions=EnumSet.allOf(SearchModelAction.class);
  doTestAuthProviderOnCollection(SUB_ANALYST,COLL_ANALYST1,allActions);
  doTestAuthProviderOnCollection(SUB_ANALYST,COLL_JRANALYST1,allActions);
  Set<SearchModelAction> queryUpdateOnly=EnumSet.of(QUERY,UPDATE);
  doTestAuthProviderOnCollection(SUB_ANALYST,COLL_TMP,queryUpdateOnly);
  Set<SearchModelAction> noActions=EnumSet.noneOf(SearchModelAction.class);
  doTestAuthProviderOnCollection(SUB_ANALYST,COLL_PURCHASES_PARTIAL,noActions);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJuniorAnalyst() throws Exception {
  Set<SearchModelAction> allActions=EnumSet.allOf(SearchModelAction.class);
  doTestAuthProviderOnCollection(SUB_JUNIOR_ANALYST,COLL_JRANALYST1,allActions);
  Set<SearchModelAction> queryOnly=EnumSet.of(SearchModelAction.QUERY);
  doTestAuthProviderOnCollection(SUB_JUNIOR_ANALYST,COLL_PURCHASES_PARTIAL,queryOnly);
  Set<SearchModelAction> noActions=EnumSet.noneOf(SearchModelAction.class);
  doTestAuthProviderOnCollection(SUB_JUNIOR_ANALYST,COLL_PURCHASES,noActions);
  doTestAuthProviderOnCollection(SUB_JUNIOR_ANALYST,COLL_ANALYST1,noActions);
  doTestAuthProviderOnCollection(SUB_JUNIOR_ANALYST,COLL_TMP,noActions);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchModelAuthorizables </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(SearchModelAuthorizables.from("k="));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNoKV() throws Exception {
  System.out.println(SearchModelAuthorizables.from("nonsense"));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(SearchModelAuthorizables.from("=v"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.search.TestSearchWildcardPrivilege </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(create(KV_JOINER.join("collection","")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyPart() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_JOINER.join("collection1","coll1"),"")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyString() throws Exception {
  System.out.println(create(""));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNullString() throws Exception {
  System.out.println(create((String)null));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(create(KV_JOINER.join("","coll1")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testOnlySeperators() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_SEPARATOR,KV_SEPARATOR,KV_SEPARATOR)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopAuthorizationProviderGeneralCases </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAnalyst() throws Exception {
  Set<SqoopAction> allActions=Sets.newHashSet(ALL,READ,WRITE);
  for (  SqoopAction action : allActions) {
    for (    Connector connector : Sets.newHashSet(jdbc_connector,hdfs_connector,kafka_connector,kite_connector))     doTestResourceAuthorizationProvider(SUB_ANALYST,Arrays.asList(server1,connector),Sets.newHashSet(action),false);
  }
  for (  Link link : Sets.newHashSet(link1,link2)) {
    doTestResourceAuthorizationProvider(SUB_ANALYST,Arrays.asList(server1,link),allActions,true);
  }
  for (  Job job : Sets.newHashSet(job1,job2)) {
    doTestResourceAuthorizationProvider(SUB_ANALYST,Arrays.asList(server1,job),allActions,true);
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeveloper() throws Exception {
  Set<SqoopAction> allActions=Sets.newHashSet(ALL,READ,WRITE);
  for (  SqoopAction action : allActions) {
    for (    Connector connector : Sets.newHashSet(jdbc_connector,hdfs_connector,kafka_connector,kite_connector))     doTestResourceAuthorizationProvider(SUB_DEVELOPER,Arrays.asList(server1,connector),Sets.newHashSet(action),READ.equals(action));
  }
  for (  Link link : Sets.newHashSet(link1,link2)) {
    doTestResourceAuthorizationProvider(SUB_DEVELOPER,Arrays.asList(server1,link),allActions,true);
  }
  for (  Job job : Sets.newHashSet(job1,job2)) {
    doTestResourceAuthorizationProvider(SUB_DEVELOPER,Arrays.asList(server1,job),allActions,true);
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testLinkOperator() throws Exception {
  Set<SqoopAction> allActions=Sets.newHashSet(ALL,READ,WRITE);
  for (  SqoopAction action : allActions) {
    for (    Link link : Sets.newHashSet(link1,link2)) {
      doTestResourceAuthorizationProvider(SUB_LINK_OPERATOR,Arrays.asList(server1,link),Sets.newHashSet(action),READ.equals(action));
    }
    for (    Job job : Sets.newHashSet(job1,job2)) {
      doTestResourceAuthorizationProvider(SUB_LINK_OPERATOR,Arrays.asList(server1,job),Sets.newHashSet(action),false);
    }
    for (    Connector connector : Sets.newHashSet(jdbc_connector,hdfs_connector,kafka_connector,kite_connector)) {
      doTestResourceAuthorizationProvider(SUB_LINK_OPERATOR,Arrays.asList(server1,connector),Sets.newHashSet(action),false);
    }
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAdmin() throws Exception {
  Set<? extends Action> allActions=Sets.newHashSet(ALL,READ,WRITE);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,hdfs_connector),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,jdbc_connector),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,kafka_connector),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,kite_connector),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,link1),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,link2),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,job1),allActions,true);
  doTestResourceAuthorizationProvider(SUB_ADMIN,Arrays.asList(server1,job2),allActions,true);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testConnectorOperator() throws Exception {
  Set<SqoopAction> allActions=Sets.newHashSet(ALL,READ,WRITE);
  for (  SqoopAction action : allActions) {
    for (    Connector connector : Sets.newHashSet(jdbc_connector,hdfs_connector,kafka_connector,kite_connector)) {
      doTestResourceAuthorizationProvider(SUB_CONNECTOR_OPERATOR,Arrays.asList(server1,connector),Sets.newHashSet(action),READ.equals(action));
    }
    for (    Job job : Sets.newHashSet(job1,job2)) {
      doTestResourceAuthorizationProvider(SUB_CONNECTOR_OPERATOR,Arrays.asList(server1,job),Sets.newHashSet(action),false);
    }
    for (    Link link : Sets.newHashSet(link1,link2)) {
      doTestResourceAuthorizationProvider(SUB_CONNECTOR_OPERATOR,Arrays.asList(server1,link),Sets.newHashSet(action),false);
    }
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJobOperator() throws Exception {
  Set<SqoopAction> allActions=Sets.newHashSet(ALL,READ,WRITE);
  for (  SqoopAction action : allActions) {
    for (    Job job : Sets.newHashSet(job1,job2)) {
      doTestResourceAuthorizationProvider(SUB_JOB_OPERATOR,Arrays.asList(server1,job),Sets.newHashSet(action),READ.equals(action));
    }
    for (    Link link : Sets.newHashSet(link1,link2)) {
      doTestResourceAuthorizationProvider(SUB_JOB_OPERATOR,Arrays.asList(server1,link),Sets.newHashSet(action),false);
    }
    for (    Connector connector : Sets.newHashSet(jdbc_connector,hdfs_connector,kafka_connector,kite_connector)) {
      doTestResourceAuthorizationProvider(SUB_JOB_OPERATOR,Arrays.asList(server1,connector),Sets.newHashSet(action),false);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopModelAuthorizables </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(SqoopModelAuthorizables.from("SERVER="));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(SqoopModelAuthorizables.from("=server1"));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNoKV() throws Exception {
  System.out.println(SqoopModelAuthorizables.from("nonsense"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.policy.sqoop.TestSqoopWildcardPrivilege </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testNullString() throws Exception {
  System.out.println(create((String)null));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyKey() throws Exception {
  System.out.println(create(KV_JOINER.join("","server1")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyValue() throws Exception {
  System.out.println(create(KV_JOINER.join("SERVER","")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyString() throws Exception {
  System.out.println(create(""));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyPart() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_JOINER.join("SERVER","server1"),"")));
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testOnlySeperators() throws Exception {
  System.out.println(create(AUTHORIZABLE_JOINER.join(KV_SEPARATOR,KV_SEPARATOR,KV_SEPARATOR)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.cache.TestCacheProvider </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalStateException.class) public void testUninitializeGetPrivileges(){
  backend.getPrivileges(new HashSet<String>(),ActiveRoleSet.ALL);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalStateException.class) public void testUninitializeValidatePolicy(){
  backend.validatePolicy(true);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.persistent.TestDelegateSentryStore </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryNoSuchObjectException.class) public void testAddGroupsNonExistantRole() throws Exception {
  String roleName="non-existant-role";
  String grantor="grantor";
  sentryStore.alterRoleAddGroups(SEARCH,roleName,Sets.newHashSet("g1"),grantor);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryNoSuchObjectException.class) public void testDeleteGroupsNonExistantRole() throws Exception {
  String roleName="non-existant-role";
  String grantor="grantor";
  sentryStore.alterRoleDeleteGroups(SEARCH,roleName,Sets.newHashSet("g1"),grantor);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryAlreadyExistsException.class) public void testCreateDuplicateRole() throws Exception {
  String roleName="test-dup-role";
  String grantor="grantor";
  sentryStore.createRole(SEARCH,roleName,grantor);
  sentryStore.createRole(SEARCH,roleName,grantor);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryNoSuchObjectException.class) public void testDropNotExistRole() throws Exception {
  String roleName="not-exist";
  String grantor="grantor";
  sentryStore.dropRole(SEARCH,roleName,grantor);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.thrift.TestSentryGenericPolicyProcessor </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNotAdminOperation() throws Exception {
  String requestUser="not_" + ADMIN_USER;
  Status validateStatus=Status.ACCESS_DENIED;
  testOperation(requestUser,validateStatus);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryConfigurationException.class) public void testConfigCannotCreateNotificationHandler() throws Exception {
  Configuration conf=new Configuration();
  conf.set(PolicyStoreConstants.SENTRY_GENERIC_POLICY_NOTIFICATION,"junk");
  SentryGenericPolicyProcessor.createHandlers(conf);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAdminOperation() throws Exception {
  when(mockStore.createRole(anyString(),anyString(),anyString())).thenReturn(new CommitContext(SERVER_UUID,SEQ_ID));
  when(mockStore.dropRole(anyString(),anyString(),anyString())).thenReturn(new CommitContext(SERVER_UUID,SEQ_ID + 1));
  when(mockStore.alterRoleAddGroups(anyString(),anyString(),anySetOf(String.class),anyString())).thenReturn(new CommitContext(SERVER_UUID,SEQ_ID + 2));
  when(mockStore.alterRoleDeleteGroups(anyString(),anyString(),anySetOf(String.class),anyString())).thenReturn(new CommitContext(SERVER_UUID,SEQ_ID + 3));
  when(mockStore.dropPrivilege(anyString(),any(PrivilegeObject.class),anyString())).thenReturn(new CommitContext(SERVER_UUID,SEQ_ID + 4));
  when(mockStore.renamePrivilege(anyString(),anyString(),anyListOf(Authorizable.class),anyListOf(Authorizable.class),anyString())).thenReturn(new CommitContext(SERVER_UUID,SEQ_ID + 5));
  testOperation(ADMIN_USER,Status.OK);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryConfigurationException.class) public void testConfigCannotCreateSentryStore() throws Exception {
  Configuration conf=new Configuration();
  conf.set(PolicyStoreConstants.SENTRY_GENERIC_POLICY_STORE,"junk");
  SentryGenericPolicyProcessor.createStore(conf);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.service.thrift.TestSentryGenericServiceIntegration </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGranRevokePrivilege() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName1="admin_r1";
      String roleName2="admin_r2";
      client.dropRoleIfExists(requestorUserName,roleName1,SOLR);
      client.createRole(requestorUserName,roleName1,SOLR);
      client.dropRoleIfExists(requestorUserName,roleName2,SOLR);
      client.createRole(requestorUserName,roleName2,SOLR);
      TSentryPrivilege queryPrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.QUERY);
      TSentryPrivilege updatePrivilege=new TSentryPrivilege(SOLR,"service1",fromAuthorizable(Arrays.asList(new Collection("c1"),new Field("f1"))),SearchConstants.UPDATE);
      client.grantPrivilege(requestorUserName,roleName1,SOLR,queryPrivilege);
      client.grantPrivilege(requestorUserName,roleName2,SOLR,updatePrivilege);
      client.revokePrivilege(requestorUserName,roleName1,SOLR,queryPrivilege);
      client.revokePrivilege(requestorUserName,roleName2,SOLR,updatePrivilege);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.generic.tools.TestSentryShellSolr </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGrantRevokePrivilegeWithShortOption() throws Exception {
  assertGrantRevokePrivilege(true);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGrantRevokePrivilegeWithLongOption() throws Exception {
  assertGrantRevokePrivilege(false);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.entity.TestDbAuditMetadataLogEntity </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testToJsonFormatLog() throws Throwable {
  DBAuditMetadataLogEntity amle=new DBAuditMetadataLogEntity("serviceName","userName","impersonator","ipAddress","operation","eventTime","operationText","allowed","objectType","component","databaseName","tableName","columnName","resourcePath");
  String jsonAuditLog=amle.toJsonFormatLog();
  ContainerNode rootNode=AuditMetadataLogEntity.parse(jsonAuditLog);
  assertEntryEquals(rootNode,Constants.LOG_FIELD_SERVICE_NAME,"serviceName");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_USER_NAME,"userName");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_IMPERSONATOR,"impersonator");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_IP_ADDRESS,"ipAddress");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_OPERATION,"operation");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_EVENT_TIME,"eventTime");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_OPERATION_TEXT,"operationText");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_ALLOWED,"allowed");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_DATABASE_NAME,"databaseName");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_TABLE_NAME,"tableName");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_COLUMN_NAME,"columnName");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_RESOURCE_PATH,"resourcePath");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_OBJECT_TYPE,"objectType");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.entity.TestGMAuditMetadataLogEntity </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testToJsonFormatLog() throws Throwable {
  Map<String,String> privilegesMap=new HashMap<String,String>();
  privilegesMap.put("resourceType1","resourceName1");
  privilegesMap.put("resourceType2","resourceName2");
  privilegesMap.put("resourceType3","resourceName3");
  privilegesMap.put("resourceType4","resourceName4");
  GMAuditMetadataLogEntity gmamle=new GMAuditMetadataLogEntity("serviceName","userName","impersonator","ipAddress","operation","eventTime","operationText","allowed","objectType","component",privilegesMap);
  String jsonAuditLog=gmamle.toJsonFormatLog();
  ContainerNode rootNode=AuditMetadataLogEntity.parse(jsonAuditLog);
  assertEntryEquals(rootNode,Constants.LOG_FIELD_SERVICE_NAME,"serviceName");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_USER_NAME,"userName");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_IMPERSONATOR,"impersonator");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_IP_ADDRESS,"ipAddress");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_OPERATION,"operation");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_EVENT_TIME,"eventTime");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_OPERATION_TEXT,"operationText");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_ALLOWED,"allowed");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_OBJECT_TYPE,"objectType");
  assertEntryEquals(rootNode,Constants.LOG_FIELD_COMPONENT,"component");
  assertEntryEquals(rootNode,"resourceType1","resourceName1");
  assertEntryEquals(rootNode,"resourceType2","resourceName2");
  assertEntryEquals(rootNode,"resourceType3","resourceName3");
  assertEntryEquals(rootNode,"resourceType4","resourceName4");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.entity.TestJsonLogEntityFactory </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteRole(){
  TAlterSentryRoleDeleteGroupsRequest request=new TAlterSentryRoleDeleteGroupsRequest();
  TAlterSentryRoleDeleteGroupsResponse response=new TAlterSentryRoleDeleteGroupsResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  request.setGroups(getGroups());
  response.setStatus(Status.OK());
  DBAuditMetadataLogEntity amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_DELETE_ROLE,"REVOKE ROLE testRole FROM GROUP testGroup",null,null,null,Constants.OBJECT_TYPE_ROLE);
  response.setStatus(Status.InvalidInput("",null));
  amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_DELETE_ROLE,"REVOKE ROLE testRole FROM GROUP testGroup",null,null,null,Constants.OBJECT_TYPE_ROLE);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateRole(){
  TCreateSentryRoleRequest request=new TCreateSentryRoleRequest();
  TCreateSentryRoleResponse response=new TCreateSentryRoleResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  response.setStatus(Status.OK());
  DBAuditMetadataLogEntity amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_CREATE_ROLE,"CREATE ROLE testRole",null,null,null,Constants.OBJECT_TYPE_ROLE);
  response.setStatus(Status.InvalidInput("",null));
  amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_CREATE_ROLE,"CREATE ROLE testRole",null,null,null,Constants.OBJECT_TYPE_ROLE);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAddRole(){
  TAlterSentryRoleAddGroupsRequest request=new TAlterSentryRoleAddGroupsRequest();
  TAlterSentryRoleAddGroupsResponse response=new TAlterSentryRoleAddGroupsResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  request.setGroups(getGroups());
  response.setStatus(Status.OK());
  DBAuditMetadataLogEntity amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_ADD_ROLE,"GRANT ROLE testRole TO GROUP testGroup",null,null,null,Constants.OBJECT_TYPE_ROLE);
  response.setStatus(Status.InvalidInput("",null));
  amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_ADD_ROLE,"GRANT ROLE testRole TO GROUP testGroup",null,null,null,Constants.OBJECT_TYPE_ROLE);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDropRole(){
  TDropSentryRoleRequest request=new TDropSentryRoleRequest();
  TDropSentryRoleResponse response=new TDropSentryRoleResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  response.setStatus(Status.OK());
  DBAuditMetadataLogEntity amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_DROP_ROLE,"DROP ROLE testRole",null,null,null,Constants.OBJECT_TYPE_ROLE);
  response.setStatus(Status.InvalidInput("",null));
  amle=(DBAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_DROP_ROLE,"DROP ROLE testRole",null,null,null,Constants.OBJECT_TYPE_ROLE);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.log.entity.TestJsonLogEntityFactoryGM </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRevokeRole(){
  TAlterSentryRoleRevokePrivilegeRequest request=new TAlterSentryRoleRevokePrivilegeRequest();
  TAlterSentryRoleRevokePrivilegeResponse response=new TAlterSentryRoleRevokePrivilegeResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  TSentryPrivilege privilege=getPrivilege();
  request.setPrivilege(privilege);
  response.setStatus(Status.OK());
  GMAuditMetadataLogEntity amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_REVOKE_PRIVILEGE,"REVOKE ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 resourceType3 resourceName3 FROM ROLE testRole",Constants.OBJECT_TYPE_PRINCIPAL,TEST_PRIVILEGES_MAP);
  response.setStatus(Status.InvalidInput("",null));
  amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_REVOKE_PRIVILEGE,"REVOKE ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 resourceType3 resourceName3 FROM ROLE testRole",Constants.OBJECT_TYPE_PRINCIPAL,TEST_PRIVILEGES_MAP);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAddRole(){
  TAlterSentryRoleAddGroupsRequest request=new TAlterSentryRoleAddGroupsRequest();
  TAlterSentryRoleAddGroupsResponse response=new TAlterSentryRoleAddGroupsResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  request.setGroups(getGroups());
  response.setStatus(Status.OK());
  GMAuditMetadataLogEntity amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_ADD_ROLE,"GRANT ROLE testRole TO GROUP testGroup",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
  response.setStatus(Status.InvalidInput("",null));
  amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_ADD_ROLE,"GRANT ROLE testRole TO GROUP testGroup",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGrantRole(){
  TAlterSentryRoleGrantPrivilegeRequest request=new TAlterSentryRoleGrantPrivilegeRequest();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  TAlterSentryRoleGrantPrivilegeResponse response=new TAlterSentryRoleGrantPrivilegeResponse();
  TSentryPrivilege privilege=getPrivilege();
  request.setPrivilege(privilege);
  response.setStatus(Status.OK());
  GMAuditMetadataLogEntity amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_GRANT_PRIVILEGE,"GRANT ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 resourceType3 resourceName3 TO ROLE testRole",Constants.OBJECT_TYPE_PRINCIPAL,TEST_PRIVILEGES_MAP);
  response.setStatus(Status.InvalidInput("",null));
  amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_GRANT_PRIVILEGE,"GRANT ACTION ON resourceType1 resourceName1 resourceType2 resourceName2 resourceType3 resourceName3 TO ROLE testRole",Constants.OBJECT_TYPE_PRINCIPAL,TEST_PRIVILEGES_MAP);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateRole(){
  TCreateSentryRoleRequest request=new TCreateSentryRoleRequest();
  TCreateSentryRoleResponse response=new TCreateSentryRoleResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  response.setStatus(Status.OK());
  GMAuditMetadataLogEntity amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_CREATE_ROLE,"CREATE ROLE testRole",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
  response.setStatus(Status.InvalidInput("",null));
  amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_CREATE_ROLE,"CREATE ROLE testRole",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDropRole(){
  TDropSentryRoleRequest request=new TDropSentryRoleRequest();
  TDropSentryRoleResponse response=new TDropSentryRoleResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  response.setStatus(Status.OK());
  GMAuditMetadataLogEntity amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_DROP_ROLE,"DROP ROLE testRole",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
  response.setStatus(Status.InvalidInput("",null));
  amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_DROP_ROLE,"DROP ROLE testRole",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteRole(){
  TAlterSentryRoleDeleteGroupsRequest request=new TAlterSentryRoleDeleteGroupsRequest();
  TAlterSentryRoleDeleteGroupsResponse response=new TAlterSentryRoleDeleteGroupsResponse();
  request.setRequestorUserName(TEST_USER_NAME);
  request.setRoleName(TEST_ROLE_NAME);
  request.setGroups(getGroups());
  response.setStatus(Status.OK());
  GMAuditMetadataLogEntity amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.TRUE,Constants.OPERATION_DELETE_ROLE,"REVOKE ROLE testRole FROM GROUP testGroup",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
  response.setStatus(Status.InvalidInput("",null));
  amle=(GMAuditMetadataLogEntity)JsonLogEntityFactory.getInstance().createJsonLogEntity(request,response,conf);
  assertCommon(amle,Constants.FALSE,Constants.OPERATION_DELETE_ROLE,"REVOKE ROLE testRole FROM GROUP testGroup",Constants.OBJECT_TYPE_ROLE,new HashMap<String,String>());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStore </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryNoSuchObjectException.class) public void testAddDeleteGroupsNonExistantRole() throws Exception {
  String roleName="non-existant-role";
  String grantor="g1";
  Set<TSentryGroup> groups=Sets.newHashSet();
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,groups);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStoreImportExport </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy4() throws Exception {
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
  sentryRolePrivilegesMap1.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2));
  sentryRolePrivilegesMap1.put("role2",Sets.newHashSet(tSentryPrivilege3,tSentryPrivilege4));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,false);
  TSentryMappingData tSentryMappingData2=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap2=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap2=Maps.newHashMap();
  sentryGroupRolesMap2.put("group2",Sets.newHashSet("role2"));
  sentryRolePrivilegesMap2.put("role2",Sets.newHashSet(tSentryPrivilege5,tSentryPrivilege6));
  sentryRolePrivilegesMap2.put("role3",Sets.newHashSet(tSentryPrivilege7,tSentryPrivilege8));
  tSentryMappingData2.setGroupRolesMap(sentryGroupRolesMap2);
  tSentryMappingData2.setRolePrivilegesMap(sentryRolePrivilegesMap2);
  sentryStore.importSentryMetaData(tSentryMappingData2,false);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2","role3"));
  verifyGroups(groupsMap,Sets.newHashSet("group1","group2"));
  verifyPrivileges(privilegesList,Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1","role2"));
  exceptedGroupRolesMap.put("group2",Sets.newHashSet("role2"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  Map<String,Set<TSentryPrivilege>> exceptedRolePrivilegesMap=Maps.newHashMap();
  exceptedRolePrivilegesMap.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2));
  exceptedRolePrivilegesMap.put("role2",Sets.newHashSet(tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6));
  exceptedRolePrivilegesMap.put("role3",Sets.newHashSet(tSentryPrivilege7,tSentryPrivilege8));
  verifyRolePrivilegesMap(actualRolePrivilegesMap,exceptedRolePrivilegesMap);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy2() throws Exception {
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1"));
  sentryRolePrivilegesMap1.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,false);
  TSentryMappingData tSentryMappingData2=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap2=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap2=Maps.newHashMap();
  sentryGroupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
  sentryGroupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
  sentryRolePrivilegesMap2.put("role2",Sets.newHashSet(tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  sentryRolePrivilegesMap2.put("role3",Sets.newHashSet(tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  tSentryMappingData2.setGroupRolesMap(sentryGroupRolesMap2);
  tSentryMappingData2.setRolePrivilegesMap(sentryRolePrivilegesMap2);
  sentryStore.importSentryMetaData(tSentryMappingData2,false);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2","role3"));
  verifyGroups(groupsMap,Sets.newHashSet("group1","group2","group3"));
  verifyPrivileges(privilegesList,Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1"));
  exceptedGroupRolesMap.put("group2",Sets.newHashSet("role2","role3"));
  exceptedGroupRolesMap.put("group3",Sets.newHashSet("role2","role3"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  Map<String,Set<TSentryPrivilege>> exceptedRolePrivilegesMap=Maps.newHashMap();
  exceptedRolePrivilegesMap.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4));
  exceptedRolePrivilegesMap.put("role2",Sets.newHashSet(tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  exceptedRolePrivilegesMap.put("role3",Sets.newHashSet(tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  verifyRolePrivilegesMap(actualRolePrivilegesMap,exceptedRolePrivilegesMap);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy8() throws Exception {
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
  sentryGroupRolesMap1.put("group2",Sets.newHashSet("role1","role2"));
  sentryGroupRolesMap1.put("group3",Sets.newHashSet("role1","role2"));
  sentryRolePrivilegesMap1.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5));
  sentryRolePrivilegesMap1.put("role2",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,true);
  TSentryMappingData tSentryMappingData2=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap2=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap2=Maps.newHashMap();
  sentryGroupRolesMap2.put("group1",Sets.newHashSet("role2","role3"));
  sentryGroupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
  sentryGroupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
  sentryRolePrivilegesMap2.put("role2",Sets.newHashSet(tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  sentryRolePrivilegesMap2.put("role3",Sets.newHashSet(tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  tSentryMappingData2.setGroupRolesMap(sentryGroupRolesMap2);
  tSentryMappingData2.setRolePrivilegesMap(sentryRolePrivilegesMap2);
  sentryStore.importSentryMetaData(tSentryMappingData2,true);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2","role3"));
  verifyGroups(groupsMap,Sets.newHashSet("group1","group2","group3"));
  verifyPrivileges(privilegesList,Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1","role2","role3"));
  exceptedGroupRolesMap.put("group2",Sets.newHashSet("role1","role2","role3"));
  exceptedGroupRolesMap.put("group3",Sets.newHashSet("role1","role2","role3"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  Map<String,Set<TSentryPrivilege>> exceptedRolePrivilegesMap=Maps.newHashMap();
  exceptedRolePrivilegesMap.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5));
  exceptedRolePrivilegesMap.put("role2",Sets.newHashSet(tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  exceptedRolePrivilegesMap.put("role3",Sets.newHashSet(tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  verifyRolePrivilegesMap(actualRolePrivilegesMap,exceptedRolePrivilegesMap);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy1() throws Exception {
  TSentryMappingData tSentryMappingData=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap=Maps.newHashMap();
  sentryGroupRolesMap.put("group1",Sets.newHashSet("Role1","role2","role3"));
  sentryGroupRolesMap.put("group2",Sets.newHashSet("Role1","role2","role3"));
  sentryGroupRolesMap.put("group3",Sets.newHashSet("Role1","role2","role3"));
  sentryRolePrivilegesMap.put("Role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  sentryRolePrivilegesMap.put("role2",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  sentryRolePrivilegesMap.put("role3",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  tSentryMappingData.setGroupRolesMap(sentryGroupRolesMap);
  tSentryMappingData.setRolePrivilegesMap(sentryRolePrivilegesMap);
  sentryStore.importSentryMetaData(tSentryMappingData,false);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2","role3"));
  verifyGroups(groupsMap,Sets.newHashSet("group1","group2","group3"));
  verifyPrivileges(privilegesList,Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1","role2","role3"));
  exceptedGroupRolesMap.put("group2",Sets.newHashSet("role1","role2","role3"));
  exceptedGroupRolesMap.put("group3",Sets.newHashSet("role1","role2","role3"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  Map<String,Set<TSentryPrivilege>> exceptedRolePrivilegesMap=Maps.newHashMap();
  exceptedRolePrivilegesMap.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  exceptedRolePrivilegesMap.put("role2",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  exceptedRolePrivilegesMap.put("role3",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  verifyRolePrivilegesMap(actualRolePrivilegesMap,exceptedRolePrivilegesMap);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy3() throws Exception {
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
  sentryGroupRolesMap1.put("group2",Sets.newHashSet("role1","role2"));
  sentryGroupRolesMap1.put("group3",Sets.newHashSet("role1","role2"));
  sentryRolePrivilegesMap1.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5));
  sentryRolePrivilegesMap1.put("role2",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,false);
  TSentryMappingData tSentryMappingData2=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap2=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap2=Maps.newHashMap();
  sentryGroupRolesMap2.put("group1",Sets.newHashSet("role2","role3"));
  sentryGroupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
  sentryGroupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
  sentryRolePrivilegesMap2.put("role2",Sets.newHashSet(tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  sentryRolePrivilegesMap2.put("role3",Sets.newHashSet(tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  tSentryMappingData2.setGroupRolesMap(sentryGroupRolesMap2);
  tSentryMappingData2.setRolePrivilegesMap(sentryRolePrivilegesMap2);
  sentryStore.importSentryMetaData(tSentryMappingData2,false);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2","role3"));
  verifyGroups(groupsMap,Sets.newHashSet("group1","group2","group3"));
  verifyPrivileges(privilegesList,Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1","role2","role3"));
  exceptedGroupRolesMap.put("group2",Sets.newHashSet("role1","role2","role3"));
  exceptedGroupRolesMap.put("group3",Sets.newHashSet("role1","role2","role3"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  Map<String,Set<TSentryPrivilege>> exceptedRolePrivilegesMap=Maps.newHashMap();
  exceptedRolePrivilegesMap.put("role1",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5));
  exceptedRolePrivilegesMap.put("role2",Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2,tSentryPrivilege3,tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  exceptedRolePrivilegesMap.put("role3",Sets.newHashSet(tSentryPrivilege4,tSentryPrivilege5,tSentryPrivilege6,tSentryPrivilege7,tSentryPrivilege8));
  verifyRolePrivilegesMap(actualRolePrivilegesMap,exceptedRolePrivilegesMap);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy9() throws Exception {
  TSentryPrivilege testPrivilege1=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl1","","",AccessConstants.SELECT,TSentryGrantOption.TRUE);
  TSentryPrivilege testPrivilege2=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl1","","",AccessConstants.INSERT,TSentryGrantOption.FALSE);
  TSentryPrivilege testPrivilege3=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl1","","",AccessConstants.ACTION_ALL,TSentryGrantOption.TRUE);
  TSentryPrivilege testPrivilege4=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl1","","",AccessConstants.INSERT,TSentryGrantOption.TRUE);
  TSentryPrivilege testPrivilege5=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl2","","",AccessConstants.SELECT,TSentryGrantOption.TRUE);
  TSentryPrivilege testPrivilege6=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl2","","",AccessConstants.INSERT,TSentryGrantOption.FALSE);
  TSentryPrivilege testPrivilege7=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl2","","",AccessConstants.ALL,TSentryGrantOption.TRUE);
  TSentryPrivilege testPrivilege8=createTSentryPrivilege(PrivilegeScope.TABLE.name(),"server1","db1","tbl2","","",AccessConstants.INSERT,TSentryGrantOption.TRUE);
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
  sentryRolePrivilegesMap1.put("role1",Sets.newHashSet(testPrivilege1,testPrivilege2,testPrivilege3,testPrivilege4));
  sentryRolePrivilegesMap1.put("role2",Sets.newHashSet(testPrivilege5,testPrivilege6,testPrivilege7,testPrivilege8));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,true);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2"));
  verifyGroups(groupsMap,Sets.newHashSet("group1"));
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1","role2"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  Map<String,Set<TSentryPrivilege>> exceptedRolePrivilegesMap=Maps.newHashMap();
  exceptedRolePrivilegesMap.put("role1",Sets.newHashSet(testPrivilege2,testPrivilege3));
  exceptedRolePrivilegesMap.put("role2",Sets.newHashSet(testPrivilege6,testPrivilege7));
  verifyRolePrivilegesMap(actualRolePrivilegesMap,exceptedRolePrivilegesMap);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy7() throws Exception {
  TSentryMappingData tSentryMappingData1=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap1=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap1=Maps.newHashMap();
  sentryGroupRolesMap1.put("group1",Sets.newHashSet("role1"));
  sentryRolePrivilegesMap1.put("role1",Sets.newHashSet(tSentryPrivilege1));
  tSentryMappingData1.setGroupRolesMap(sentryGroupRolesMap1);
  tSentryMappingData1.setRolePrivilegesMap(sentryRolePrivilegesMap1);
  sentryStore.importSentryMetaData(tSentryMappingData1,true);
  TSentryMappingData tSentryMappingData2=new TSentryMappingData();
  Map<String,Set<String>> sentryGroupRolesMap2=Maps.newHashMap();
  Map<String,Set<TSentryPrivilege>> sentryRolePrivilegesMap2=Maps.newHashMap();
  sentryGroupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
  sentryGroupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
  sentryRolePrivilegesMap2.put("role2",Sets.newHashSet(tSentryPrivilege2));
  sentryRolePrivilegesMap2.put("role3",Sets.newHashSet(tSentryPrivilege2));
  tSentryMappingData2.setGroupRolesMap(sentryGroupRolesMap2);
  tSentryMappingData2.setRolePrivilegesMap(sentryRolePrivilegesMap2);
  sentryStore.importSentryMetaData(tSentryMappingData2,true);
  Map<String,MSentryRole> rolesMap=sentryStore.getRolesMap();
  Map<String,MSentryGroup> groupsMap=sentryStore.getGroupNameTGroupMap();
  List<MSentryPrivilege> privilegesList=sentryStore.getPrivilegesList();
  verifyRoles(rolesMap,Sets.newHashSet("role1","role2","role3"));
  verifyGroups(groupsMap,Sets.newHashSet("group1","group2","group3"));
  verifyPrivileges(privilegesList,Sets.newHashSet(tSentryPrivilege1,tSentryPrivilege2));
  Map<String,Set<String>> actualGroupRolesMap=sentryStore.getGroupNameRoleNamesMap();
  Map<String,Set<String>> exceptedGroupRolesMap=Maps.newHashMap();
  exceptedGroupRolesMap.put("group1",Sets.newHashSet("role1"));
  exceptedGroupRolesMap.put("group2",Sets.newHashSet("role2","role3"));
  exceptedGroupRolesMap.put("group3",Sets.newHashSet("role2","role3"));
  verifyGroupRolesMap(actualGroupRolesMap,exceptedGroupRolesMap);
  Map<String,Set<TSentryPrivilege>> actualRolePrivilegesMap=sentryStore.getRoleNameTPrivilegesMap();
  Map<String,Set<TSentryPrivilege>> exceptedRolePrivilegesMap=Maps.newHashMap();
  exceptedRolePrivilegesMap.put("role1",Sets.newHashSet(tSentryPrivilege1));
  exceptedRolePrivilegesMap.put("role2",Sets.newHashSet(tSentryPrivilege2));
  exceptedRolePrivilegesMap.put("role3",Sets.newHashSet(tSentryPrivilege2));
  verifyRolePrivilegesMap(actualRolePrivilegesMap,exceptedRolePrivilegesMap);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryVersion </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Create the schema using auto creation Create new sentry store without
 * implicit schema creation on the same backend db and make sure it starts
 * @throws Exception
 */
@Test public void testVerifySentryVersionCheck() throws Exception {
  conf.set(ServerConfig.SENTRY_VERIFY_SCHEM_VERSION,"false");
  SentryStore sentryStore=new SentryStore(conf);
  sentryStore.stop();
  conf.set(ServerConfig.SENTRY_VERIFY_SCHEM_VERSION,"true");
  sentryStore=new SentryStore(conf);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestConnectionWithTicketTimeout </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test is run only when sentry.hive.test.ticket.timeout is set to "true"
 * @throws Exception
 */
@Test public void testConnectionAfterTicketTimeout() throws Exception {
  Thread.sleep(400000);
  connectToSentryService();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestNotificationHandlerInvoker </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAlterSentryRoleDeleteGroups() throws Exception {
  TAlterSentryRoleDeleteGroupsRequest request=new TAlterSentryRoleDeleteGroupsRequest();
  TAlterSentryRoleDeleteGroupsResponse response=new TAlterSentryRoleDeleteGroupsResponse();
  invoker.alter_sentry_role_delete_groups(commitContext,request,response);
  Mockito.verify(handler).alter_sentry_role_delete_groups(commitContext,request,response);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAlterSentryRoleAddGroups() throws Exception {
  TAlterSentryRoleAddGroupsRequest request=new TAlterSentryRoleAddGroupsRequest();
  TAlterSentryRoleAddGroupsResponse response=new TAlterSentryRoleAddGroupsResponse();
  invoker.alter_sentry_role_add_groups(commitContext,request,response);
  Mockito.verify(handler).alter_sentry_role_add_groups(commitContext,request,response);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateSentryRole() throws Exception {
  TCreateSentryRoleRequest request=new TCreateSentryRoleRequest();
  TCreateSentryRoleResponse response=new TCreateSentryRoleResponse();
  invoker.create_sentry_role(commitContext,request,response);
  Mockito.verify(handler).create_sentry_role(commitContext,request,response);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDropSentryRole() throws Exception {
  TDropSentryRoleRequest request=new TDropSentryRoleRequest();
  TDropSentryRoleResponse response=new TDropSentryRoleResponse();
  invoker.drop_sentry_role(commitContext,request,response);
  Mockito.verify(handler).drop_sentry_role(commitContext,request,response);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryPolicyStoreProcessor </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryConfigurationException.class) public void testConfigCannotCreateNotificationHandler() throws Exception {
  conf.set(PolicyStoreServerConfig.NOTIFICATION_HANDLERS,ExceptionInConstructorNotificationHandler.class.getName());
  SentryPolicyStoreProcessor.createHandlers(conf);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryThriftAPIMismatchException.class) public void testSentryThriftAPIMismatch() throws Exception {
  SentryPolicyStoreProcessor.validateClientVersion(ServiceConstants.ThriftConstants.TSENTRY_SERVICE_VERSION_CURRENT - 1);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryConfigurationException.class) public void testConfigNotAClassNotificationHandler() throws Exception {
  conf.set(PolicyStoreServerConfig.NOTIFICATION_HANDLERS,"junk");
  SentryPolicyStoreProcessor.createHandlers(conf);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryConfigurationException.class) public void testConfigNotNotificationHandler() throws Exception {
  conf.set(PolicyStoreServerConfig.NOTIFICATION_HANDLERS,Object.class.getName());
  SentryPolicyStoreProcessor.createHandlers(conf);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSentryThriftAPIMatchVersion() throws Exception {
  SentryPolicyStoreProcessor.validateClientVersion(ServiceConstants.ThriftConstants.TSENTRY_SERVICE_VERSION_CURRENT);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServerForHaWithoutKerberos </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that we are correctly substituting "_HOST" if/when needed.
 * @throws Exception
 */
@Test public void testHostSubstitution() throws Exception {
  connectToSentryService();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateRole() throws Exception {
  String requestorUserName=ADMIN_USER;
  Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
  setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
  writePolicyFile();
  String roleName="admin_r";
  client.dropRoleIfExists(requestorUserName,roleName);
  client.createRole(requestorUserName,roleName);
  client.dropRole(requestorUserName,roleName);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServerWithoutKerberos </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateRole() throws Exception {
  String requestorUserName=ADMIN_USER;
  Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
  setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
  writePolicyFile();
  String roleName="admin_r";
  client.dropRoleIfExists(requestorUserName,roleName);
  client.createRole(requestorUserName,roleName);
  client.dropRole(requestorUserName,roleName);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceClientPool </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testConnectionWhenReconnect() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      String roleName="admin_r";
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      client.listRoles(requestorUserName);
      stopSentryService();
      server=new SentryServiceFactory().create(conf);
      startSentryService();
      client.listRoles(requestorUserName);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceForHAWithKerberos </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateRole() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String requestorUserName=ADMIN_USER;
      Set<String> requestorUserGroupNames=Sets.newHashSet(ADMIN_GROUP);
      setLocalGroupMapping(requestorUserName,requestorUserGroupNames);
      writePolicyFile();
      String roleName="admin_r";
      client.dropRoleIfExists(requestorUserName,roleName);
      client.createRole(requestorUserName,roleName);
      client.dropRole(requestorUserName,roleName);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceImportExport </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy6() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Map<String,Map<String,Set<String>>> policyFileMappingData1=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap1=Maps.newHashMap();
      groupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
      groupRolesMap1.put("group2",Sets.newHashSet("role1","role2"));
      groupRolesMap1.put("group3",Sets.newHashSet("role1","role2"));
      Map<String,Set<String>> rolePrivilegesMap1=Maps.newHashMap();
      rolePrivilegesMap1.put("role1",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5));
      rolePrivilegesMap1.put("role2",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5));
      policyFileMappingData1.put(PolicyFileConstants.GROUPS,groupRolesMap1);
      policyFileMappingData1.put(PolicyFileConstants.ROLES,rolePrivilegesMap1);
      client.importPolicy(policyFileMappingData1,ADMIN_USER,true);
      Map<String,Map<String,Set<String>>> policyFileMappingData2=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap2=Maps.newHashMap();
      groupRolesMap2.put("group1",Sets.newHashSet("role2","role3"));
      groupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
      groupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
      Map<String,Set<String>> rolePrivilegesMap2=Maps.newHashMap();
      rolePrivilegesMap2.put("role2",Sets.newHashSet(PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      rolePrivilegesMap2.put("role3",Sets.newHashSet(PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      policyFileMappingData2.put(PolicyFileConstants.GROUPS,groupRolesMap2);
      policyFileMappingData2.put(PolicyFileConstants.ROLES,rolePrivilegesMap2);
      client.importPolicy(policyFileMappingData2,ADMIN_USER,true);
      Map<String,Map<String,Set<String>>> exceptedMappingData=Maps.newHashMap();
      Map<String,Set<String>> exceptedRolesMap=Maps.newHashMap();
      exceptedRolesMap.put("group1",Sets.newHashSet("role1","role2","role3"));
      exceptedRolesMap.put("group2",Sets.newHashSet("role1","role2","role3"));
      exceptedRolesMap.put("group3",Sets.newHashSet("role1","role2","role3"));
      Map<String,Set<String>> exceptedPrivilegesMap=Maps.newHashMap();
      exceptedPrivilegesMap.put("role1",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5));
      exceptedPrivilegesMap.put("role2",Sets.newHashSet(PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      exceptedPrivilegesMap.put("role3",Sets.newHashSet(PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      exceptedMappingData.put(PolicyFileConstants.GROUPS,exceptedRolesMap);
      exceptedMappingData.put(PolicyFileConstants.ROLES,exceptedPrivilegesMap);
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,exceptedMappingData);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy8() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String testPrivilege1="server=server1->db=db1->table=tbl1->action=select->grantoption=true";
      String testPrivilege2="server=server1->db=db1->table=tbl1->action=insert->grantoption=true";
      String testPrivilege3="server=server1->db=db1->table=tbl1->action=all->grantoption=true";
      String testPrivilege4="server=server1->db=db1->table=tbl2->action=select->grantoption=true";
      String testPrivilege5="server=server1->db=db1->table=tbl2->action=insert->grantoption=true";
      String testPrivilege6="server=server1->db=db1->table=tbl2->action=*->grantoption=true";
      Map<String,Map<String,Set<String>>> policyFileMappingData1=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap1=Maps.newHashMap();
      groupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
      Map<String,Set<String>> rolePrivilegesMap1=Maps.newHashMap();
      rolePrivilegesMap1.put("role1",Sets.newHashSet(testPrivilege1,testPrivilege2));
      rolePrivilegesMap1.put("role2",Sets.newHashSet(testPrivilege4,testPrivilege5));
      policyFileMappingData1.put(PolicyFileConstants.GROUPS,groupRolesMap1);
      policyFileMappingData1.put(PolicyFileConstants.ROLES,rolePrivilegesMap1);
      client.importPolicy(policyFileMappingData1,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> policyFileMappingData2=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap2=Maps.newHashMap();
      groupRolesMap2.put("group1",Sets.newHashSet("role1","role2"));
      Map<String,Set<String>> rolePrivilegesMap2=Maps.newHashMap();
      rolePrivilegesMap2.put("role1",Sets.newHashSet(testPrivilege3));
      rolePrivilegesMap2.put("role2",Sets.newHashSet(testPrivilege6));
      policyFileMappingData2.put(PolicyFileConstants.GROUPS,groupRolesMap2);
      policyFileMappingData2.put(PolicyFileConstants.ROLES,rolePrivilegesMap2);
      client.importPolicy(policyFileMappingData2,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> exceptedMappingData=policyFileMappingData2;
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,exceptedMappingData);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy2() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Map<String,Map<String,Set<String>>> policyFileMappingData1=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap1=Maps.newHashMap();
      groupRolesMap1.put("group1",Sets.newHashSet("role1"));
      Map<String,Set<String>> rolePrivilegesMap1=Maps.newHashMap();
      rolePrivilegesMap1.put("role1",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4));
      policyFileMappingData1.put(PolicyFileConstants.GROUPS,groupRolesMap1);
      policyFileMappingData1.put(PolicyFileConstants.ROLES,rolePrivilegesMap1);
      client.importPolicy(policyFileMappingData1,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> policyFileMappingData2=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap2=Maps.newHashMap();
      groupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
      groupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
      Map<String,Set<String>> rolePrivilegesMap2=Maps.newHashMap();
      rolePrivilegesMap2.put("role2",Sets.newHashSet(PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      rolePrivilegesMap2.put("role3",Sets.newHashSet(PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      policyFileMappingData2.put(PolicyFileConstants.GROUPS,groupRolesMap2);
      policyFileMappingData2.put(PolicyFileConstants.ROLES,rolePrivilegesMap2);
      client.importPolicy(policyFileMappingData2,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> exceptedMappingData=Maps.newHashMap();
      exceptedMappingData.put(PolicyFileConstants.GROUPS,policyFileMappingData1.get(PolicyFileConstants.GROUPS));
      exceptedMappingData.get(PolicyFileConstants.GROUPS).putAll(policyFileMappingData2.get(PolicyFileConstants.GROUPS));
      exceptedMappingData.put(PolicyFileConstants.ROLES,policyFileMappingData1.get(PolicyFileConstants.ROLES));
      exceptedMappingData.get(PolicyFileConstants.ROLES).putAll(policyFileMappingData2.get(PolicyFileConstants.ROLES));
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,exceptedMappingData);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy4() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Map<String,Map<String,Set<String>>> policyFileMappingData=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap=Maps.newHashMap();
      Set<String> roles=Sets.newHashSet("role1","role2");
      groupRolesMap.put("group1",roles);
      Map<String,Set<String>> rolePrivilegesMap=Maps.newHashMap();
      policyFileMappingData.put(PolicyFileConstants.GROUPS,groupRolesMap);
      policyFileMappingData.put(PolicyFileConstants.ROLES,rolePrivilegesMap);
      client.importPolicy(policyFileMappingData,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,policyFileMappingData);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy7() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String testPrivilege1="server=server1->db=db1->table=tbl1->action=select->grantoption=true";
      String testPrivilege2="server=server1->db=db1->table=tbl1->action=insert->grantoption=false";
      String testPrivilege3="server=server1->db=db1->table=tbl1->action=all->grantoption=true";
      String testPrivilege4="server=server1->db=db1->table=tbl1->action=insert->grantoption=true";
      String testPrivilege5="server=server1->db=db1->table=tbl2->action=select->grantoption=true";
      String testPrivilege6="server=server1->db=db1->table=tbl2->action=insert->grantoption=false";
      String testPrivilege7="server=server1->db=db1->table=tbl2->action=*->grantoption=true";
      String testPrivilege8="server=server1->db=db1->table=tbl2->action=insert->grantoption=true";
      Map<String,Map<String,Set<String>>> policyFileMappingData1=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap1=Maps.newHashMap();
      groupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
      Map<String,Set<String>> rolePrivilegesMap1=Maps.newHashMap();
      rolePrivilegesMap1.put("role1",Sets.newHashSet(testPrivilege1,testPrivilege2,testPrivilege3,testPrivilege4));
      rolePrivilegesMap1.put("role2",Sets.newHashSet(testPrivilege5,testPrivilege6,testPrivilege7,testPrivilege8));
      policyFileMappingData1.put(PolicyFileConstants.GROUPS,groupRolesMap1);
      policyFileMappingData1.put(PolicyFileConstants.ROLES,rolePrivilegesMap1);
      client.importPolicy(policyFileMappingData1,ADMIN_USER,true);
      Map<String,Map<String,Set<String>>> exceptedMappingData=Maps.newHashMap();
      Map<String,Set<String>> exceptedRolesMap=Maps.newHashMap();
      exceptedRolesMap.put("group1",Sets.newHashSet("role1","role2"));
      Map<String,Set<String>> exceptedPrivilegesMap=Maps.newHashMap();
      exceptedPrivilegesMap.put("role1",Sets.newHashSet(testPrivilege2,testPrivilege3));
      exceptedPrivilegesMap.put("role2",Sets.newHashSet(testPrivilege6,testPrivilege7));
      exceptedMappingData.put(PolicyFileConstants.GROUPS,exceptedRolesMap);
      exceptedMappingData.put(PolicyFileConstants.ROLES,exceptedPrivilegesMap);
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,exceptedMappingData);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy1() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Map<String,Map<String,Set<String>>> policyFileMappingData=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap=Maps.newHashMap();
      Set<String> roles=Sets.newHashSet("role1","role2","role3");
      groupRolesMap.put("group1",roles);
      groupRolesMap.put("group2",roles);
      groupRolesMap.put("group3",roles);
      Map<String,Set<String>> rolePrivilegesMap=Maps.newHashMap();
      for (      String roleName : roles) {
        rolePrivilegesMap.put(roleName,Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      }
      policyFileMappingData.put(PolicyFileConstants.GROUPS,groupRolesMap);
      policyFileMappingData.put(PolicyFileConstants.ROLES,rolePrivilegesMap);
      client.importPolicy(policyFileMappingData,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,policyFileMappingData);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy3() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Map<String,Map<String,Set<String>>> policyFileMappingData1=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap1=Maps.newHashMap();
      groupRolesMap1.put("group1",Sets.newHashSet("role1","role2"));
      groupRolesMap1.put("group2",Sets.newHashSet("role1","role2"));
      groupRolesMap1.put("group3",Sets.newHashSet("role1","role2"));
      Map<String,Set<String>> rolePrivilegesMap1=Maps.newHashMap();
      rolePrivilegesMap1.put("role1",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5));
      rolePrivilegesMap1.put("role2",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5));
      policyFileMappingData1.put(PolicyFileConstants.GROUPS,groupRolesMap1);
      policyFileMappingData1.put(PolicyFileConstants.ROLES,rolePrivilegesMap1);
      client.importPolicy(policyFileMappingData1,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> policyFileMappingData2=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap2=Maps.newHashMap();
      groupRolesMap2.put("group1",Sets.newHashSet("role2","role3"));
      groupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
      groupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
      Map<String,Set<String>> rolePrivilegesMap2=Maps.newHashMap();
      rolePrivilegesMap2.put("role2",Sets.newHashSet(PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      rolePrivilegesMap2.put("role3",Sets.newHashSet(PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      policyFileMappingData2.put(PolicyFileConstants.GROUPS,groupRolesMap2);
      policyFileMappingData2.put(PolicyFileConstants.ROLES,rolePrivilegesMap2);
      client.importPolicy(policyFileMappingData2,ADMIN_USER,false);
      Map<String,Map<String,Set<String>>> exceptedMappingData=Maps.newHashMap();
      Map<String,Set<String>> exceptedRolesMap=Maps.newHashMap();
      exceptedRolesMap.put("group1",Sets.newHashSet("role1","role2","role3"));
      exceptedRolesMap.put("group2",Sets.newHashSet("role1","role2","role3"));
      exceptedRolesMap.put("group3",Sets.newHashSet("role1","role2","role3"));
      Map<String,Set<String>> exceptedPrivilegesMap=Maps.newHashMap();
      exceptedPrivilegesMap.put("role1",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5));
      exceptedPrivilegesMap.put("role2",Sets.newHashSet(PRIVILIEGE1,PRIVILIEGE2,PRIVILIEGE3,PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      exceptedPrivilegesMap.put("role3",Sets.newHashSet(PRIVILIEGE4,PRIVILIEGE5,PRIVILIEGE6,PRIVILIEGE7,PRIVILIEGE8));
      exceptedMappingData.put(PolicyFileConstants.GROUPS,exceptedRolesMap);
      exceptedMappingData.put(PolicyFileConstants.ROLES,exceptedPrivilegesMap);
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,exceptedMappingData);
    }
  }
);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy5() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      Map<String,Map<String,Set<String>>> policyFileMappingData1=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap1=Maps.newHashMap();
      groupRolesMap1.put("group1",Sets.newHashSet("role1"));
      Map<String,Set<String>> rolePrivilegesMap1=Maps.newHashMap();
      rolePrivilegesMap1.put("role1",Sets.newHashSet(PRIVILIEGE1));
      policyFileMappingData1.put(PolicyFileConstants.GROUPS,groupRolesMap1);
      policyFileMappingData1.put(PolicyFileConstants.ROLES,rolePrivilegesMap1);
      client.importPolicy(policyFileMappingData1,ADMIN_USER,true);
      Map<String,Map<String,Set<String>>> policyFileMappingData2=Maps.newHashMap();
      Map<String,Set<String>> groupRolesMap2=Maps.newHashMap();
      groupRolesMap2.put("group2",Sets.newHashSet("role2","role3"));
      groupRolesMap2.put("group3",Sets.newHashSet("role2","role3"));
      Map<String,Set<String>> rolePrivilegesMap2=Maps.newHashMap();
      rolePrivilegesMap2.put("role2",Sets.newHashSet(PRIVILIEGE2));
      rolePrivilegesMap2.put("role3",Sets.newHashSet(PRIVILIEGE2));
      policyFileMappingData2.put(PolicyFileConstants.GROUPS,groupRolesMap2);
      policyFileMappingData2.put(PolicyFileConstants.ROLES,rolePrivilegesMap2);
      client.importPolicy(policyFileMappingData2,ADMIN_USER,true);
      Map<String,Map<String,Set<String>>> exceptedMappingData=Maps.newHashMap();
      Map<String,Set<String>> exceptedRolesMap=Maps.newHashMap();
      exceptedRolesMap.put("group1",Sets.newHashSet("role1"));
      exceptedRolesMap.put("group2",Sets.newHashSet("role2","role3"));
      exceptedRolesMap.put("group3",Sets.newHashSet("role2","role3"));
      Map<String,Set<String>> exceptedPrivilegesMap=Maps.newHashMap();
      exceptedPrivilegesMap.put("role1",Sets.newHashSet(PRIVILIEGE1));
      exceptedPrivilegesMap.put("role2",Sets.newHashSet(PRIVILIEGE2));
      exceptedPrivilegesMap.put("role3",Sets.newHashSet(PRIVILIEGE2));
      exceptedMappingData.put(PolicyFileConstants.GROUPS,exceptedRolesMap);
      exceptedMappingData.put(PolicyFileConstants.ROLES,exceptedPrivilegesMap);
      Map<String,Map<String,Set<String>>> sentryMappingData=client.exportPolicy(ADMIN_USER);
      validateSentryMappingData(sentryMappingData,exceptedMappingData);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.service.thrift.TestSentryServiceWithKerberos </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that we are correctly substituting "_HOST" if/when needed.
 * @throws Exception
 */
@Test public void testHostSubstitution() throws Exception {
  connectToSentryService();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.tools.TestSentrySchemaTool </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testInitTo() throws Exception {
  schemaTool.doInit(SentryStoreSchemaInfo.getSentryVersion());
  schemaTool.verifySchemaVersion();
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryUserException.class) public void testDryRun() throws Exception {
  schemaTool.setDryRun(true);
  schemaTool.doInit();
  schemaTool.setDryRun(false);
  schemaTool.verifySchemaVersion();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testInitNonDefault() throws Exception {
  nonDefaultsetup();
  schemaTool.doInit();
  schemaTool.verifySchemaVersion();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testInit() throws Exception {
  schemaTool.doInit();
  schemaTool.verifySchemaVersion();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpgrade() throws Exception {
  schemaTool.doInit(OLDEST_INIT_VERSION);
  schemaTool.doUpgrade();
  schemaTool.verifySchemaVersion();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.db.tools.TestSentryShellHive </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNegativeCaseWithoutRequiredArgument() throws Exception {
  runTestAsSubject(new TestOperation(){
    @Override public void runTestAsSubject() throws Exception {
      String strOptionConf="conf";
      client.createRole(requestorName,TEST_ROLE_NAME_1);
      String[] args={"-cr","-r",TEST_ROLE_NAME_1};
      SentryShellHive sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + strOptionConf);
      args=new String[]{"-cr","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-dr","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-arg","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-arg","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_GROUP_NAME);
      args=new String[]{"-drg","-g","testGroup1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-drg","-r",TEST_ROLE_NAME_2,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_GROUP_NAME);
      args=new String[]{"-gpr","-p","server=server1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-gpr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_PRIVILEGE);
      args=new String[]{"-rpr","-p","server=server1","-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_ROLE_NAME);
      args=new String[]{"-rpr","-r",TEST_ROLE_NAME_1,"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsg(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + SentryShellCommon.OPTION_DESC_PRIVILEGE);
      args=new String[]{"-conf",confPath.getAbsolutePath()};
      sentryShell=new SentryShellHive();
      validateMissingParameterMsgsContains(sentryShell,args,SentryShellCommon.PREFIX_MESSAGE_MISSING_OPTION + "[","-arg Add group to role","-cr Create role","-rpr Revoke privilege from role","-drg Delete group from role","-lr List role","-lp List privilege","-gpr Grant privilege to role","-dr Drop role");
      client.dropRole(requestorName,TEST_ROLE_NAME_1);
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.provider.file.TestSimpleFileProvderBackend </h4><pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalStateException.class) public void testUninitializeValidatePolicy(){
  backend.validatePolicy(true);
}

</code></pre>

<br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalStateException.class) public void testUninitializeGetPrivileges(){
  backend.getPrivileges(new HashSet<String>(),ActiveRoleSet.ALL);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestColumnEndToEnd </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPositive() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE database " + DB1);
  statement.execute("use " + DB1);
  statement.execute("CREATE TABLE t1 (c1 string, c2 string)");
  statement.execute("CREATE ROLE user_role1");
  statement.execute("CREATE ROLE user_role2");
  statement.execute("CREATE ROLE user_role3");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE user_role1");
  statement.execute("GRANT SELECT (c1, c2) ON TABLE t1 TO ROLE user_role2");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role3");
  statement.execute("GRANT ROLE user_role1 TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE user_role2 TO GROUP " + USERGROUP2);
  statement.execute("GRANT ROLE user_role3 TO GROUP " + USERGROUP3);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("SELECT c1 FROM t1");
  statement.execute("DESCRIBE t1");
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("SELECT c1,c2 FROM t1");
  statement.execute("SELECT * FROM t1");
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("SELECT * FROM t1");
  statement.execute("SELECT c1,c2 FROM t1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBasic() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE database " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"CREATE ROLE r2",SentryAccessDeniedException.class.getSimpleName());
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDatabaseProvider </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Create and Drop role by admin
 * @throws Exception
 */
@Test public void testCreateDropRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW roles");
  List<String> expected=new ArrayList<String>();
  expected.add("role1");
  expected.add("admin_role");
  assertTestRoles(resultSet,expected,true);
  statement.execute("DROP ROLE role1");
  resultSet=statement.executeQuery("SHOW roles");
  expected.clear();
  expected.add("admin_role");
  assertTestRoles(resultSet,expected,true);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Verify 'SHOW CURRENT ROLES' show all roles for the give user when there no
 * 'SET ROLE' called
 * @throws Exception
 */
@Test public void testShowAllCurrentRoles() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  String testRole1="role1", testRole2="role2";
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("CREATE ROLE " + testRole2);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole2 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ USERGROUP1);
  statement.execute("GRANT ROLE " + testRole2 + " TO GROUP "+ USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  List<String> expected=new ArrayList<>();
  expected.add("admin_role");
  expected.add(testRole1);
  expected.add(testRole2);
  assertTestRoles(resultSet,expected,true);
  statement.execute("SET ROLE " + testRole1);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  expected.clear();
  expected.add(testRole1);
  assertTestRoles(resultSet,expected,true);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  assertResultSize(resultSet,0);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  expected.clear();
  expected.add(testRole1);
  expected.add(testRole2);
  assertTestRoles(resultSet,expected,false);
  statement.execute("SET ROLE " + testRole2);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  expected.clear();
  expected.add(testRole2);
  assertTestRoles(resultSet,expected,false);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCaseSensitiveGroupNames() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet resultSet;
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + ADMINGROUP);
  List<String> expected=new ArrayList<>();
  assertTestRoles(resultSet,expected,false);
  String testRole1="role1";
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ ADMINGROUP);
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + ADMINGROUP);
  expected.clear();
  expected.add(testRole1);
  assertTestRoles(resultSet,expected,false);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP Admin",SentryNoSuchObjectException.class.getSimpleName());
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGrantDuplicateonDb() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON DATABASE db1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON DATABASE DB1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON DATABASE Db1 TO ROLE user_role");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBasic() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"CREATE ROLE r2",SentryAccessDeniedException.class.getSimpleName());
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE user_role");
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE NONE");
  context.assertAuthzException(statement,"SELECT * FROM t1");
  statement.execute("SET ROLE ALL");
  statement.execute("SELECT * FROM t1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbColumnLevelMetaDataOps </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Requires table level privileges
 */
@Test public void testShowTblProperties() throws Exception {
  String query="SHOW TBLPROPERTIES " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Requires table level privileges
 */
@Test public void testTableExtendLike() throws Exception {
  String query="SHOW TABLE EXTENDED IN " + TEST_COL_METADATA_OPS_DB + " LIKE "+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test with column level privilege
 * user can NOT "show table extended"
 */
@Test public void testShowExtended() throws Exception {
  String query="SHOW TABLE EXTENDED IN " + TEST_COL_METADATA_OPS_DB + " like '"+ TEST_COL_METADATA_OPS_TB+ "'";
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test SHOW TBLPROPERTIES requires table level privileges
 * @throws Exception
 */
@Test public void testShowProperties() throws Exception {
  String query="SHOW TBLPROPERTIES " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
}

</code></pre>

<br>
<pre class="type-1 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
- Is not executed with the test suite
"></span><br>
/** 
 * Test with column level select privilege,
 * user can only do "explain select column";
 * any other select requires table level privileges
 * @throws Exception
 */
@Ignore("After fix SENTRY-849, should enable this test") @Test public void testExplainSelect() throws Exception {
  String query="EXPLAIN SELECT privileged FROM " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateShowsAllColumns(query,"Explain",USER1_1);
  validateSemanticException(query,USER2_1);
  query="EXPLAIN SELECT unprivileged FROM " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
  query="EXPLAIN SELECT * FROM " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
  query="EXPLAIN SELECT count(*) FROM " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
  query="EXPLAIN SELECT * FROM (SELECT privileged AS c FROM " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB+ " union all select unprivileged as c from "+ TEST_COL_METADATA_OPS_DB+ "."+ TEST_COL_METADATA_OPS_TB+ ") subq1 order by c";
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Requires table level privileges
 */
@Test public void testShowCreateTable() throws Exception {
  String query="SHOW CREATE TABLE " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test with column level privileges,
 * user can list all columns for now
 */
@Test public void testShowColumns() throws Exception {
  String query="SHOW COLUMNS IN " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateFiltersInaccessibleColumns(query,"field",USER1_1,"privileged");
  validateSemanticException(query,USER2_1);
}

</code></pre>

<br>
<pre class="type-1 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
- Is not executed with the test suite
"></span><br>
/** 
 * Grant user column level privileges, show partitions
 * should list user's granted columns
 * @throws Exception
 */
@Ignore("After fix SENTRY-898, turn on this test") @Test public void testShowPartitions() throws Exception {
  final String PAR_ROLE_NAME=TEST_COL_METADATA_OPS_ROLE + "_2";
  establishSession(ADMIN1);
  statement.execute("USE " + TEST_COL_METADATA_OPS_DB);
  statement.execute("CREATE ROLE " + PAR_ROLE_NAME);
  statement.execute("GRANT SELECT(privileged_par) ON TABLE " + TEST_COL_METADATA_OPS_TB + " TO ROLE "+ PAR_ROLE_NAME);
  statement.execute("GRANT ROLE " + PAR_ROLE_NAME + " TO GROUP "+ USERGROUP1);
  String query="SHOW PARTITIONS " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateFiltersInaccessibleColumns(query,"partition",USER1_1,"privileged_par");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test with column level select privilege,
 * user can do "describe table"
 */
@Test public void testDescribeTable() throws Exception {
  String query="DESCRIBE " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateShowsAllColumns(query,"col_name",USER1_1);
  validateSemanticException(query,USER2_1);
  query="DESCRIBE EXTENDED " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
  query="DESCRIBE EXTENDED " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB+ " s";
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
  query="DESCRIBE FORMATTED " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB;
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
  query="DESCRIBE FORMATTED " + TEST_COL_METADATA_OPS_DB + "."+ TEST_COL_METADATA_OPS_TB+ " s";
  validateSemanticException(query,USER1_1);
  validateSemanticException(query,USER2_1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbComplexView </h4><pre class="type-1 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
- Is not executed with the test suite
"></span><br>
/** 
 * Create a view with nested query
 * Grant and verify select privilege
 * @throws ExceptionSENTRY-716: Hive plugin does not correctly enforce
 * privileges for new in case of nested queries
 * Once backport HIVE-10875 to Sentry repo, will enable this test.
 */
@Ignore("After SENTRY-716 is fixed, turn on this test") @Test public void TestDbViewWithNestedQuery() throws Exception {
  List<String> sqls=new ArrayList<String>();
  sqls.add("USE " + TEST_VIEW_DB);
  sqls.add("CREATE VIEW " + TEST_VIEW + " AS SELECT * FROM "+ TEST_VIEW_TB);
  execBatch(ADMIN1,sqls);
  grantAndValidatePrivilege(TEST_VIEW,TEST_VIEW_ROLE,USERGROUP1,USER1_1,false);
  sqls.clear();
  sqls.add("USE " + TEST_VIEW_DB);
  sqls.add("SELECT * FROM (SELECT * FROM " + TEST_VIEW + ") v2");
  execBatch(USER1_1,sqls);
}

</code></pre>

<br>
<pre class="type-1 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
- Is not executed with the test suite
"></span><br>
/** 
 * Create a view with union two tables
 * Grant and verify select privilege
 * @throws ExceptionSENTRY-747: Create a view by union tables, grant select
 * then select from view encounter errors
 * Once backport HIVE-10875 to Sentry repo, will enable this test.
 */
@Ignore("After SENTRY-747 is fixed, turn on this test") @Test public void TestDbViewWithUnion() throws Exception {
  List<String> sqls=new ArrayList<String>();
  String testTable="test_user_info";
  sqls.add("USE " + TEST_VIEW_DB);
  sqls.add("DROP TABLE IF EXISTS " + testTable);
  sqls.add("CREATE TABLE " + testTable + " (userid VARCHAR(64), name STRING, address STRING, tel STRING) ");
  sqls.add("INSERT INTO TABLE " + testTable + " VALUES "+ "('tlee', "+ "'Tod Lee', '1234 23nd Ave SFO, CA', '123-456-7890')");
  sqls.add("SELECT * FROM " + testTable);
  sqls.add(String.format("CREATE VIEW " + TEST_VIEW + " AS "+ "SELECT u.userid, u.name, u.address, res.uid "+ "FROM ("+ "SELECT t1.userid AS uid "+ "FROM %s t1 "+ "UNION ALL "+ "SELECT t2.userid AS uid "+ "FROM %s t2 "+ ") res JOIN %s u ON (u.userid = res.uid)",TEST_VIEW_TB,TEST_VIEW_TB2,testTable));
  execBatch(ADMIN1,sqls);
  grantAndValidatePrivilege(TEST_VIEW,TEST_VIEW_ROLE,USERGROUP1,USER1_1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Create a view by join two tables
 * Grant and verify select privilege
 * @throws Exception
 */
@Test public void TestDbViewWithJoin() throws Exception {
  List<String> sqls=new ArrayList<String>();
  sqls.add("USE " + TEST_VIEW_DB);
  sqls.add(String.format("create view %s as select name,age,gpa from %s join %s on " + "(%s.userid=%s.userid) where name='Tod Lee'",TEST_VIEW,TEST_VIEW_TB2,TEST_VIEW_TB,TEST_VIEW_TB2,TEST_VIEW_TB));
  execBatch(ADMIN1,sqls);
  grantAndValidatePrivilege(TEST_VIEW,TEST_VIEW_ROLE,USERGROUP1,USER1_1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Create view1 and view2 from view1
 * Grant and validate select privileges to both views
 * @throws Exception
 */
@Test public void testDbViewFromView() throws Exception {
  List<String> sqls=new ArrayList<String>();
  sqls.add("USE " + TEST_VIEW_DB);
  sqls.add("CREATE VIEW " + TEST_VIEW + "(userid,link) AS SELECT userid,link from "+ TEST_VIEW_TB);
  String testView2="view1_from_" + TEST_VIEW;
  String testRole2=testView2 + "_test_role";
  sqls.add(String.format("CREATE VIEW %s AS SELECT userid,link from %s",testView2,TEST_VIEW));
  String testView3="view2_from_" + TEST_VIEW;
  String testRole3=testView3 + "_test_role";
  sqls.add(String.format("CREATE VIEW %s(userid,link) AS SELECT userid,link from %s",testView3,TEST_VIEW));
  execBatch(ADMIN1,sqls);
  grantAndValidatePrivilege(TEST_VIEW,TEST_VIEW_ROLE,USERGROUP1,USER1_1);
  grantAndValidatePrivilege(testView2,testRole2,USERGROUP2,USER2_1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbEndToEnd </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBasic() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"CREATE ROLE r2",SentryAccessDeniedException.class.getSimpleName());
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE user_role");
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE ALL");
  statement.execute("SELECT * FROM t1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps:
 * 1. admin create a new experimental database
 * 2. admin create a new production database, create table, load data
 * 3. admin grant privilege all@'experimental database' to usergroup1
 * 4. user create table, load data in experimental DB
 * 5. user create view based on table in experimental DB
 * 6. admin create table (same name) in production DB
 * 7. admin grant read@DB2.table to group
 * admin grant select@DB2.table to group
 * 8. user load data from experimental table to production table
 */
@Test public void testEndToEnd1() throws Exception {
  String tableName1="tb_1";
  String tableName2="tb_2";
  String viewName1="view_1";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("DROP DATABASE IF EXISTS " + DB2 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB2);
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ tableName1);
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ tableName2);
  statement.execute("create table " + DB2 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("create table " + DB2 + "."+ tableName2+ " (under_col int comment 'the under column', value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ tableName2);
  statement.execute("CREATE ROLE all_db1");
  statement.execute("GRANT ALL ON DATABASE " + DB1 + " TO ROLE all_db1");
  statement.execute("CREATE ROLE select_tb1");
  statement.execute("CREATE ROLE insert_tb1");
  statement.execute("CREATE ROLE insert_tb2");
  statement.execute("CREATE ROLE data_uri");
  statement.execute("USE " + DB2);
  statement.execute("GRANT INSERT ON TABLE " + tableName1 + " TO ROLE insert_tb1");
  statement.execute("GRANT INSERT ON TABLE " + tableName2 + " TO ROLE insert_tb2");
  statement.execute("GRANT ALL ON URI 'file://" + dataDir.getPath() + "' TO ROLE data_uri");
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("GRANT SELECT ON TABLE " + tableName1 + " TO ROLE select_tb1");
  statement.execute("GRANT ROLE all_db1, select_tb1, insert_tb1, insert_tb2, data_uri TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ tableName1);
  statement.execute("CREATE VIEW " + viewName1 + " (value) AS SELECT value from "+ tableName1+ " LIMIT 10");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  statement.execute("INSERT OVERWRITE TABLE " + DB2 + "."+ tableName2+ " SELECT * FROM "+ DB1+ "."+ tableName1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNonDefault() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE database " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbPrivilegeCleanupOnDrop </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * drop table and verify that the no privileges are referring to it drop db
 * and verify that the no privileges are referring to it drop db cascade
 * verify that the no privileges are referring to db and tables under it
 * @throws Exception
 */
@Test public void testDropObjects() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  setupRoles(statement);
  setupDbObjects(statement);
  setupPrivileges(statement);
  dropDbObjects(statement);
  verifyPrivilegesDropped(statement);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * rename table and verify that the no privileges are referring to it old table
 * verify that the same privileges are created for the new table name
 * @throws Exception
 */
@Test public void testRenameTables() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  setupRoles(statement);
  setupDbObjects(statement);
  setupPrivileges(statement);
  statement.execute("USE " + DB2);
  verifyTablePrivilegeExist(statement,Lists.newArrayList("select_tbl1","insert_tbl1","all_tbl1"),tableName1);
  verifyTablePrivilegeExist(statement,Lists.newArrayList("all_tbl2"),tableName2);
  renameTables(statement);
  verifyTablePrivilegesDropped(statement);
  statement.execute("USE " + DB2);
  verifyTablePrivilegeExist(statement,Lists.newArrayList("select_tbl1","insert_tbl1","all_tbl1"),tableName1 + renameTag);
  verifyTablePrivilegeExist(statement,Lists.newArrayList("all_tbl2"),tableName2 + renameTag);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * After we drop/rename table, we will drop/rename all privileges(ALL,SELECT,INSERT,ALTER,DROP...)
 * from this role
 * @throws Exception
 */
@Test public void testDropAndRenameWithMultiAction() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALTER ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT DROP ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT CREATE ON DATABASE " + DB1 + " TO ROLE user_role");
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("ALTER TABLE t1 RENAME TO t2");
  context.assertSentrySemanticException(statement,"drop table t1",semanticException);
  statement.execute("drop table t2");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertRemainingRows(resultSet,1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * drop table and verify that the no privileges are referring to it drop db
 * and verify that the no privileges are referring to it drop db cascade
 * verify that the no privileges are referring to db and tables under it
 * @throws Exception
 */
@Test public void testReCreateObjects() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  setupRoles(statement);
  setupDbObjects(statement);
  setupPrivileges(statement);
  dropDbObjects(statement);
  setupDbObjects(statement);
  verifyPrivilegesDropped(statement);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDbSentryOnFailureHookLoading </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOnFailureHookForAuthDDL() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE admin_role");
  statement.execute("GRANT ALL ON SERVER " + HiveServerFactory.DEFAULT_AUTHZ_SERVER_NAME + " TO ROLE admin_role");
  statement.execute("GRANT ROLE admin_role TO GROUP " + ADMINGROUP);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("CREATE DATABASE DB_1");
  statement.execute("CREATE TABLE DB_1.tab1(a int )");
  statement.execute("CREATE ROLE all_db1");
  statement.execute("GRANT ALL ON DATABASE DB_1 TO ROLE all_db1");
  statement.execute("GRANT ROLE all_db1 TO GROUP " + USERGROUP1);
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE DB_1");
  statement.execute("CREATE TABLE foo (id int)");
  verifyFailureHook(statement,"CREATE ROLE fooTest",HiveOperation.CREATEROLE,null,null,true);
  verifyFailureHook(statement,"DROP ROLE fooTest",HiveOperation.DROPROLE,null,null,true);
  verifyFailureHook(statement,"GRANT ALL ON SERVER server1 TO ROLE admin_role",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  verifyFailureHook(statement,"REVOKE ALL ON SERVER server1 FROM ROLE admin_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  verifyFailureHook(statement,"GRANT ROLE all_db1 TO GROUP " + USERGROUP1,HiveOperation.GRANT_ROLE,null,null,true);
  verifyFailureHook(statement,"REVOKE ROLE all_db1 FROM GROUP " + USERGROUP1,HiveOperation.REVOKE_ROLE,null,null,true);
  verifyFailureHook(statement,"SHOW ROLES",HiveOperation.SHOW_ROLES,null,null,true);
  verifyFailureHook(statement,"SHOW ROLE GRANT group group1",HiveOperation.SHOW_ROLE_GRANT,null,null,true);
  verifyFailureHook(statement,"SHOW GRANT role role1",HiveOperation.SHOW_GRANT,null,null,true);
  statement.execute("SHOW GRANT role all_db1");
  verifyFailureHook(statement,"GRANT ALL ON TABLE db_1.tab1 TO ROLE admin_role",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  verifyFailureHook(statement,"REVOKE ALL ON TABLE db_1.tab1 FROM ROLE admin_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  verifyFailureHook(statement,"GRANT ALL ON Database db_1 TO ROLE admin_role",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  verifyFailureHook(statement,"REVOKE ALL ON Database db_1 FROM ROLE admin_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  statement.close();
  connection.close();
  context.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOnFailureHookLoading() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  try {
    statement.execute("DROP ROLE admin_role");
  }
 catch (  Exception ex) {
  }
  statement.execute("CREATE ROLE admin_role");
  statement.execute("GRANT ALL ON SERVER " + HiveServerFactory.DEFAULT_AUTHZ_SERVER_NAME + " TO ROLE admin_role");
  statement.execute("GRANT ROLE admin_role TO GROUP " + ADMINGROUP);
  statement.execute("DROP DATABASE IF EXISTS DB_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS DB_2 CASCADE");
  statement.execute("CREATE DATABASE DB_1");
  statement.execute("CREATE DATABASE DB_2");
  statement.execute("CREATE TABLE db_2.tab1(a int )");
  statement.execute("CREATE ROLE all_db1");
  statement.execute("GRANT ALL ON DATABASE DB_1 TO ROLE all_db1");
  statement.execute("GRANT ROLE all_db1 TO GROUP " + USERGROUP1);
  statement.execute("CREATE ROLE lock_db2_tab1");
  statement.execute("GRANT ROLE lock_db2_tab1 TO GROUP " + USERGROUP1);
  statement.execute("USE db_2");
  statement.execute("GRANT LOCK ON TABLE tab1 TO ROLE lock_db2_tab1");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  verifyFailureHook(statement,"CREATE TABLE DB_2.TAB2(id INT)",HiveOperation.CREATETABLE,"db_2",null,false);
  verifyFailureHook(statement,"CREATE TABLE DB_2.TAB1(id INT)",HiveOperation.CREATETABLE,"db_2",null,false);
  verifyFailureHook(statement,"select * from db_2.tab1",HiveOperation.QUERY,null,null,false);
  statement.execute("USE DB_2");
  verifyFailureHook(statement,"ALTER TABLE tab1 CHANGE id id1 INT",HiveOperation.ALTERTABLE_RENAMECOL,"db_2",null,false);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP DATABASE DB_1 CASCADE");
  statement.execute("DROP DATABASE DB_2 CASCADE");
  statement.close();
  connection.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestPrivilegeWithGrantOption </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test privileges with grant on parent objects are sufficient for operation
 * on child objects
 * @throws Exception
 */
@Test public void testImpliedPrivilegesWithGrant() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS db_1 CASCADE");
  statement.execute("CREATE DATABASE db_1");
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON DATABASE db_1 TO ROLE role1 WITH GRANT OPTION");
  statement.execute("GRANT ROLE role1 TO GROUP " + USERGROUP1);
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role2 TO GROUP " + USERGROUP2);
  statement.execute("CREATE ROLE role3_1");
  statement.execute("GRANT ROLE role3_1 TO GROUP " + USERGROUP3);
  statement.execute("CREATE ROLE role3_2");
  statement.execute("GRANT ROLE role3_2 TO GROUP " + USERGROUP3);
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE db_1");
  statement.execute("CREATE TABLE foo (id int)");
  statement.execute("GRANT ALL ON TABLE foo TO ROLE role2");
  statement.execute("GRANT SELECT ON DATABASE db_1 TO ROLE role3_1");
  statement.execute("GRANT INSERT ON TABLE foo TO ROLE role3_2");
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE db_1");
  runSQLWithError(statement,"GRANT ALL ON TABLE foo TO ROLE role3_2",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("use db_1");
  verifySingleGrantWithGrantOption(statement,"SHOW GRANT ROLE role2 ON TABLE foo",SHOW_GRANT_ROLE_TABLE_POSITION,"foo");
  verifySingleGrantWithGrantOption(statement,"SHOW GRANT ROLE role3_1 ON DATABASE db_1",SHOW_GRANT_ROLE_DB_POSITION,"db_1");
  verifySingleGrantWithGrantOption(statement,"SHOW GRANT ROLE role3_2 ON TABLE foo",SHOW_GRANT_ROLE_TABLE_POSITION,"foo");
  verifySingleGrantWithGrantOption(statement,"show grant role role1",SHOW_GRANT_ROLE_WITH_GRANT_POSITION,"true");
  verifySingleGrantWithGrantOption(statement,"SHOW GRANT ROLE role1 ON DATABASE db_1",SHOW_GRANT_ROLE_WITH_GRANT_POSITION,"true");
  verifySingleGrantWithGrantOption(statement,"SHOW GRANT ROLE role1 ON TABLE foo",SHOW_GRANT_ROLE_WITH_GRANT_POSITION,"true");
  verifySingleGrantWithGrantOption(statement,"show grant role role2",SHOW_GRANT_ROLE_WITH_GRANT_POSITION,"false");
  verifySingleGrantWithGrantOption(statement,"SHOW GRANT ROLE role2 ON TABLE foo",SHOW_GRANT_ROLE_WITH_GRANT_POSITION,"false");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOnGrantPrivilege() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS db_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS db_2 CASCADE");
  statement.execute("CREATE DATABASE db_1");
  statement.execute("CREATE ROLE group1_role");
  statement.execute("GRANT ALL ON DATABASE db_1 TO ROLE group1_role");
  statement.execute("GRANT ROLE group1_role TO GROUP " + USERGROUP1);
  statement.execute("CREATE ROLE group3_grant_role");
  statement.execute("GRANT ALL ON DATABASE db_1 TO ROLE group3_grant_role WITH GRANT OPTION");
  statement.execute("GRANT ROLE group3_grant_role TO GROUP " + USERGROUP3);
  statement.execute("CREATE ROLE group2_role");
  statement.execute("GRANT ROLE group2_role TO GROUP " + USERGROUP2);
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE db_1");
  statement.execute("CREATE TABLE foo (id int)");
  runSQLWithError(statement,"GRANT ALL ON DATABASE db_1 TO ROLE group2_role",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  runSQLWithError(statement,"GRANT ALL ON DATABASE db_1 TO ROLE group2_role WITH GRANT OPTION",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("GRANT ALL ON DATABASE db_1 TO ROLE group2_role");
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  runSQLWithError(statement,"REVOKE ALL ON Database db_1 FROM ROLE admin_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  runSQLWithError(statement,"REVOKE ALL ON Database db_1 FROM ROLE group2_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  runSQLWithError(statement,"REVOKE ALL ON Database db_1 FROM ROLE group3_grant_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE ALL ON Database db_1 FROM ROLE group2_role");
  statement.execute("REVOKE ALL ON Database db_1 FROM ROLE group3_grant_role");
  runSQLWithError(statement,"REVOKE ALL ON Database db_1 FROM ROLE group1_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  connection.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestPrivilegeWithHAGrantOption </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testOnGrantPrivilege() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE admin_role");
  statement.execute("GRANT ALL ON SERVER " + HiveServerFactory.DEFAULT_AUTHZ_SERVER_NAME + " TO ROLE admin_role");
  statement.execute("GRANT ROLE admin_role TO GROUP " + ADMINGROUP);
  statement.execute("DROP DATABASE IF EXISTS db_1 CASCADE");
  statement.execute("DROP DATABASE IF EXISTS db_2 CASCADE");
  statement.execute("CREATE DATABASE db_1");
  shutdownAllSentryService();
  startSentryService(1);
  statement.execute("CREATE ROLE group1_role");
  statement.execute("GRANT ALL ON DATABASE db_1 TO ROLE group1_role");
  statement.execute("GRANT ROLE group1_role TO GROUP " + USERGROUP1);
  statement.execute("CREATE ROLE group3_grant_role");
  shutdownAllSentryService();
  startSentryService(1);
  statement.execute("GRANT ALL ON DATABASE db_1 TO ROLE group3_grant_role WITH GRANT OPTION");
  statement.execute("GRANT ROLE group3_grant_role TO GROUP " + USERGROUP3);
  shutdownAllSentryService();
  startSentryService(1);
  statement.execute("CREATE ROLE group2_role");
  statement.execute("GRANT ROLE group2_role TO GROUP " + USERGROUP2);
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE db_1");
  statement.execute("CREATE TABLE foo (id int)");
  verifyFailureHook(statement,"GRANT ALL ON DATABASE db_1 TO ROLE group2_role",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  verifyFailureHook(statement,"GRANT ALL ON DATABASE db_1 TO ROLE group2_role WITH GRANT OPTION",HiveOperation.GRANT_PRIVILEGE,null,null,true);
  connection.close();
  connection=context.createConnection(USER3_1);
  shutdownAllSentryService();
  startSentryService(1);
  statement=context.createStatement(connection);
  statement.execute("GRANT ALL ON DATABASE db_1 TO ROLE group2_role");
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  verifyFailureHook(statement,"REVOKE ALL ON Database db_1 FROM ROLE admin_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  shutdownAllSentryService();
  startSentryService(1);
  verifyFailureHook(statement,"REVOKE ALL ON Database db_1 FROM ROLE group2_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  verifyFailureHook(statement,"REVOKE ALL ON Database db_1 FROM ROLE group3_grant_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE ALL ON Database db_1 FROM ROLE group2_role");
  statement.execute("REVOKE ALL ON Database db_1 FROM ROLE group3_grant_role");
  verifyFailureHook(statement,"REVOKE ALL ON Database db_1 FROM ROLE group1_role",HiveOperation.REVOKE_PRIVILEGE,null,null,true);
  connection.close();
  context.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.ha.TestHaEnd2End </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test service failover. Run Sentry operations with shutting down one or more
 * of the services.
 * @throws Exception
 */
@Test public void testFailover() throws Exception {
  String roleName1="test_role_1";
  String roleName2="test_role_2";
  String roleName3="test_role_3";
  dropDb(ADMIN1,DB1);
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use " + DB1);
  getSentrySrv().stop(0);
  adminStmt.execute("CREATE ROLE " + roleName1);
  verifyRoleExists(adminStmt,roleName1);
  getSentrySrv().start(0);
  getSentrySrv().stop(1);
  adminStmt.execute("CREATE ROLE " + roleName2);
  verifyRoleExists(adminStmt,roleName2);
  getSentrySrv().stop(0);
  getSentrySrv().stop(1);
  context.assertAuthzExecHookException(adminStmt,"CREATE ROLE " + roleName3,HAClientInvocationHandler.SENTRY_HA_ERROR_MESSAGE);
  getSentrySrv().start(0);
  getSentrySrv().start(1);
  adminStmt.execute("CREATE ROLE " + roleName3);
  verifyRoleExists(adminStmt,roleName3);
  dropDb(ADMIN1,DB1);
  adminStmt.execute("DROP ROLE " + roleName1);
  adminStmt.execute("DROP ROLE " + roleName2);
  adminStmt.execute("DROP ROLE " + roleName3);
  adminStmt.close();
  adminCon.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Basic test with two Sentry service running.
 * @throws Exception
 */
@Test public void testBasic() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"CREATE ROLE r2",SentryAccessDeniedException.class.getSimpleName());
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE user_role");
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE ALL");
  statement.execute("SELECT * FROM t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("DROP ROLE user_role");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegration </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAuthzObjOnPartitionSameTable() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external/p1");
  miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role","tab1_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("use " + dbName);
  stmt.execute("create table tab1 (s string) partitioned by (month int)");
  stmt.execute("alter table tab1 add partition (month = 1) location '/tmp/external/p1'");
  stmt.execute("create role tab1_role");
  stmt.execute("grant insert on table tab1 to role tab1_role");
  stmt.execute("grant role tab1_role to group " + StaticUserGroup.USERGROUP1);
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/tmp/external/p1",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP1,true);
  stmt.execute("alter table tab1 add partition (month = 2) location '/tmp/external/p1'");
  verifyOnPath("/tmp/external/p1",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP1,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAuthzObjOnMultipleTables() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external/p1");
  miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role","tab1_role","tab2_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("use " + dbName);
  stmt.execute("create external table tab1 (s string) partitioned by (month int) location '/tmp/external/p1'");
  stmt.execute("create role tab1_role");
  stmt.execute("grant insert on table tab1 to role tab1_role");
  stmt.execute("grant role tab1_role to group " + StaticUserGroup.USERGROUP1);
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/tmp/external/p1",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP1,true);
  stmt.execute("create table tab2 (s string) partitioned by (month int) location '/tmp/external/p1'");
  stmt.execute("create role tab2_role");
  stmt.execute("grant select on table tab2 to role tab2_role");
  stmt.execute("grant role tab2_role to group " + StaticUserGroup.USERGROUP1);
  verifyOnPath("/tmp/external/p1",FsAction.ALL,StaticUserGroup.USERGROUP1,true);
  stmt.execute("DROP TABLE IF EXISTS tab1");
  Thread.sleep(CACHE_REFRESH);
  verifyOnPath("/tmp/external/p1",FsAction.READ_EXECUTE,StaticUserGroup.USERGROUP1,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testViews() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external");
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  try {
    stmt.execute("create database " + dbName);
    stmt.execute("create table test(a string)");
    stmt.execute("create view testView as select * from test");
    stmt.execute("create or replace view testView as select * from test");
    stmt.execute("drop view testView");
  }
 catch (  Exception s) {
    throw s;
  }
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAccessToTableDirectory() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external");
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role","table_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("use " + dbName);
  stmt.execute("create table tb1(a string)");
  stmt.execute("create role table_role");
  stmt.execute("grant all on table tb1 to role table_role");
  stmt.execute("grant role table_role to group " + StaticUserGroup.USERGROUP1);
  Thread.sleep(CACHE_REFRESH);
  verifyAccessToPath(StaticUserGroup.USER1_1,StaticUserGroup.USERGROUP1,"/user/hive/warehouse/db1.db/tb1",true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAllColumn() throws Throwable {
  String dbName="db2";
  tmpHDFSDir=new Path("/tmp/external");
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role","col_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role with grant option");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("use " + dbName);
  stmt.execute("create table p1 (c1 string, c2 string) partitioned by (month int, day int)");
  stmt.execute("alter table p1 add partition (month=1, day=1)");
  loadDataTwoCols(stmt);
  stmt.execute("create role col_role");
  stmt.execute("grant select(c1,c2) on p1 to role col_role");
  stmt.execute("grant role col_role to group " + StaticUserGroup.USERGROUP1);
  Thread.sleep(100);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/p1",null,StaticUserGroup.USERGROUP1,false);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-1 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
- Is not executed with the test suite
"></span><br>
@Ignore("SENTRY-546") @Test public void testExternalTable() throws Throwable {
  String dbName="db2";
  tmpHDFSDir=new Path("/tmp/external");
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant all on uri 'hdfs:///tmp/external' to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("create external table tab1(a int) location '/tmp/external/tab1_loc'");
  verifyOnAllSubDirs("/tmp/external/tab1_loc",FsAction.ALL,StaticUserGroup.ADMINGROUP,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAuthzObjOnPartitionMultipleTables() throws Throwable {
  String dbName="db1";
  tmpHDFSDir=new Path("/tmp/external");
  miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  Path partitionDir=new Path("/tmp/external/p1");
  miniDFS.getFileSystem().mkdirs(partitionDir);
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role","tab1_role","tab2_role","tab3_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("use " + dbName);
  stmt.execute("create external table tab1 (s string) partitioned by (month int) location '/tmp/external/p1'");
  stmt.execute("create role tab1_role");
  stmt.execute("grant insert on table tab1 to role tab1_role");
  stmt.execute("grant role tab1_role to group " + StaticUserGroup.USERGROUP1);
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/tmp/external/p1",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP1,true);
  stmt.execute("create external table tab2 (s string) partitioned by (month int)");
  stmt.execute("alter table tab2 add partition (month = 1) location '/tmp/external'");
  stmt.execute("create role tab2_role");
  stmt.execute("grant select on table tab2 to role tab2_role");
  stmt.execute("grant role tab2_role to group " + StaticUserGroup.USERGROUP2);
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/tab2",FsAction.READ_EXECUTE,StaticUserGroup.USERGROUP2,true);
  verifyOnPath("/tmp/external",FsAction.READ_EXECUTE,StaticUserGroup.USERGROUP2,true);
  stmt.execute("create table tab3 (s string) partitioned by (month int)");
  stmt.execute("alter table tab3 add partition (month = 1) location '/tmp/external'");
  stmt.execute("create role tab3_role");
  stmt.execute("grant insert on table tab3 to role tab3_role");
  stmt.execute("grant role tab3_role to group " + StaticUserGroup.USERGROUP3);
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/tab3",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP3,true);
  verifyOnPath("/tmp/external",FsAction.READ_EXECUTE,StaticUserGroup.USERGROUP2,true);
  verifyOnPath("/tmp/external",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP3,true);
  stmt.execute("alter table tab2 rename to tabx");
  Thread.sleep(CACHE_REFRESH);
  verifyOnPath("/tmp/external",FsAction.READ_EXECUTE,StaticUserGroup.USERGROUP2,true);
  verifyOnPath("/tmp/external",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP3,true);
  stmt.execute("ALTER TABLE tabx DROP PARTITION (month = 1)");
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/tab3",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP3,true);
  verifyOnPath("/tmp/external",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP3,true);
  stmt.execute("DROP TABLE IF EXISTS tabx");
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/tab3",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP3,true);
  verifyOnPath("/tmp/external",FsAction.WRITE_EXECUTE,StaticUserGroup.USERGROUP3,true);
  stmt.close();
  conn.close();
  miniDFS.getFileSystem().delete(partitionDir,true);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Make sure non HDFS paths are not added to the object - location map.
 * @throws Throwable
 */
@Test public void testNonHDFSLocations() throws Throwable {
  String dbName="db2";
  tmpHDFSDir=new Path("/tmp/external");
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role","user_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role");
  stmt.execute("grant all on uri 'file:///tmp/external' to role admin_role");
  stmt.execute("grant all on uri 'hdfs:///tmp/external' to role admin_role");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(admin,admin);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.close();
  conn.close();
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role user_role");
  stmt.execute("grant all on database " + dbName + " to role user_role");
  stmt.execute("grant role user_role to group " + StaticUserGroup.USERGROUP1);
  stmt.close();
  conn.close();
  conn=hiveServer2.createConnection(admin,admin);
  stmt=conn.createStatement();
  miniDFS.getFileSystem().mkdirs(tmpHDFSDir);
  miniDFS.getFileSystem().setOwner(tmpHDFSDir,"hive","hive");
  miniDFS.getFileSystem().mkdirs(new Path("/tmp/external/tab1_loc"));
  stmt.execute("use " + dbName);
  stmt.execute("create external table tab1(a int) location 'file:///tmp/external/tab1_loc'");
  verifyOnAllSubDirs("/tmp/external/tab1_loc",null,StaticUserGroup.USERGROUP1,false);
  miniDFS.getFileSystem().mkdirs(new Path("/tmp/external/tab2_loc/i=1"));
  stmt.execute("create external table tab2 (s string) partitioned by (i int) location 'file:///tmp/external/tab2_loc'");
  verifyOnAllSubDirs("/tmp/external/tab2_loc",null,StaticUserGroup.USERGROUP1,false);
  stmt.execute("alter table tab2 add partition (i=1)");
  stmt.execute("alter table tab2 partition (i=1) set location 'file:///tmp/external/tab2_loc/i=1'");
  verifyOnAllSubDirs("/tmp/external/tab2_loc/i=1",null,StaticUserGroup.USERGROUP1,false);
  stmt.execute("create external table tab3(a int) location '/tmp/external/tab3_loc'");
  verifyOnAllSubDirs("/tmp/external/tab3_loc",null,StaticUserGroup.USERGROUP1,true);
  stmt.execute("alter table tab3 set location 'file:///tmp/external/tab3_loc'");
  verifyOnAllSubDirs("/tmp/external/tab3_loc",null,StaticUserGroup.USERGROUP1,false);
  stmt.execute("create table tab4(a int) location 'file:///tmp/external/tab4_loc'");
  stmt.execute("alter table tab4 set location 'hdfs:///tmp/external/tab4_loc'");
  miniDFS.getFileSystem().mkdirs(new Path("/tmp/external/tab4_loc"));
  verifyOnAllSubDirs("/tmp/external/tab4_loc",null,StaticUserGroup.USERGROUP1,true);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testColumnPrivileges() throws Throwable {
  String dbName="db2";
  tmpHDFSDir=new Path("/tmp/external");
  dbNames=new String[]{dbName};
  roles=new String[]{"admin_role","tab_role","db_role","col_role"};
  admin=StaticUserGroup.ADMIN1;
  Connection conn;
  Statement stmt;
  conn=hiveServer2.createConnection("hive","hive");
  stmt=conn.createStatement();
  stmt.execute("create role admin_role");
  stmt.execute("grant all on server server1 to role admin_role with grant option");
  stmt.execute("grant role admin_role to group " + StaticUserGroup.ADMINGROUP);
  conn=hiveServer2.createConnection(StaticUserGroup.ADMIN1,StaticUserGroup.ADMIN1);
  stmt=conn.createStatement();
  stmt.execute("create database " + dbName);
  stmt.execute("use " + dbName);
  stmt.execute("create table p1 (s string) partitioned by (month int, day int)");
  stmt.execute("alter table p1 add partition (month=1, day=1)");
  stmt.execute("alter table p1 add partition (month=1, day=2)");
  stmt.execute("alter table p1 add partition (month=2, day=1)");
  stmt.execute("alter table p1 add partition (month=2, day=2)");
  loadData(stmt);
  stmt.execute("create role db_role");
  stmt.execute("grant select on database " + dbName + " to role db_role");
  stmt.execute("create role tab_role");
  stmt.execute("grant select on p1 to role tab_role");
  stmt.execute("create role col_role");
  stmt.execute("grant select(s) on p1 to role col_role");
  stmt.execute("grant role col_role to group " + StaticUserGroup.USERGROUP1);
  stmt.execute("grant role tab_role to group " + StaticUserGroup.USERGROUP2);
  stmt.execute("grant role col_role to group " + StaticUserGroup.USERGROUP2);
  stmt.execute("grant role db_role to group " + StaticUserGroup.USERGROUP3);
  stmt.execute("grant role col_role to group " + StaticUserGroup.USERGROUP3);
  stmt.execute("grant role col_role to group " + StaticUserGroup.ADMINGROUP);
  Thread.sleep(CACHE_REFRESH);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/p1",null,StaticUserGroup.USERGROUP1,false);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/p1",FsAction.READ_EXECUTE,StaticUserGroup.USERGROUP2,true);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/p1",FsAction.READ_EXECUTE,StaticUserGroup.USERGROUP3,true);
  verifyOnAllSubDirs("/user/hive/warehouse/" + dbName + ".db/p1",null,StaticUserGroup.ADMINGROUP,false);
  stmt.close();
  conn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestCrossDbOps </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test Case 2.17 Execution steps
 * a) Admin user creates a new database DB_1,
 * b) Admin user grants ALL on DB_1 to group GROUP_1
 * c) User from GROUP_1 creates table TAB_1, TAB_2 in DB_1
 * d) Admin user grants SELECT on TAB_1 to group GROUP_2
 * 1) verify users from GROUP_2 have only SELECT privileges on TAB_1. They
 * shouldn't be able to perform any operation other than those listed as
 * requiring SELECT in the privilege model.
 * 2) verify users from GROUP_2 can't perform queries involving join between
 * TAB_1 and TAB_2.
 * 3) verify users from GROUP_1 can't perform operations requiring ALL @
 * SERVER scope. Refer to list
 */
@Test public void testNegUserPrivilegesAll() throws Exception {
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("drop table if exists table_def");
  adminStmt.execute("create table table_def (name string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table table_def");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  adminStmt.execute("create table table_1 (name string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table table_1");
  adminStmt.execute("create table table_2 (name string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table table_2");
  adminStmt.execute("create view v1 AS select * from table_1");
  adminStmt.execute("create table table_part_1 (name string) PARTITIONED BY (year INT)");
  adminStmt.execute("ALTER TABLE table_part_1 ADD PARTITION (year = 2012)");
  adminStmt.close();
  adminCon.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all").addRolesToGroup(USERGROUP2,"db1_tab1_select").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("db1_tab1_select","server=server1->db=" + DB1 + "->table=table_1->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection userConn=context.createConnection(USER2_1);
  Statement userStmt=context.createStatement(userConn);
  context.assertAuthzException(userStmt,"drop database " + DB1);
  context.assertAuthzException(userStmt,"CREATE TEMPORARY FUNCTION strip AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  context.assertAuthzException(userStmt,"create table  " + DB1 + ".c_tab_2 as select * from  "+ DB1+ ".table_2");
  context.assertAuthzException(userStmt,"select * from  " + DB1 + ".table_2");
  context.assertAuthzException(userStmt,"ALTER DATABASE " + DB1 + " SET DBPROPERTIES ('foo' = 'bar')");
  context.assertAuthzException(userStmt,"drop table " + DB1 + ".table_1");
  context.assertAuthzException(userStmt,"DROP VIEW IF EXISTS " + DB1 + ".v1");
  context.assertAuthzException(userStmt,"create table " + DB1 + ".table_5 (name string)");
  context.assertAuthzException(userStmt,"ALTER TABLE " + DB1 + ".table_1  RENAME TO "+ DB1+ ".table_99");
  context.assertAuthzException(userStmt,"insert overwrite table " + DB1 + ".table_2 select * from "+ DB1+ ".table_1");
  context.assertAuthzException(userStmt,"insert overwrite table " + DB1 + ".table_2 select * from "+ "table_def");
  context.assertAuthzException(userStmt,"ALTER TABLE " + DB1 + ".table_part_1 ADD IF NOT EXISTS PARTITION (year = 2012)");
  context.assertAuthzException(userStmt,"ALTER TABLE " + DB1 + ".table_part_1 PARTITION (year = 2012) SET LOCATION '/etc'");
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test Case 2.16 admin user create a new database DB_1 create TABLE_1 and
 * TABLE_2 (same schema) in DB_1 admin user grant SELECT, INSERT to user1's
 * group on TABLE_2 negative test case: user1 try to do following on TABLE_1
 * will fail: --insert overwrite TABLE_2 select * from TABLE_1
 */
@Test public void testNegativeUserDMLPrivileges() throws Exception {
  createDb(ADMIN1,DB1);
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("create table " + DB1 + ".table_1 (id int)");
  adminStmt.execute("create table " + DB1 + ".table_2 (id int)");
  adminStmt.close();
  adminCon.close();
  policyFile.addPermissionsToRole("db1_tab2_all","server=server1->db=" + DB1 + "->table=table_2").addRolesToGroup(USERGROUP1,"db1_tab2_all").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection userConn=context.createConnection(USER1_1);
  Statement userStmt=context.createStatement(userConn);
  context.assertAuthzException(userStmt,"insert overwrite table  " + DB1 + ".table_2 select * from "+ DB1+ ".table_1");
  context.assertAuthzException(userStmt,"insert overwrite directory '" + dataDir.getPath() + "' select * from  "+ DB1+ ".table_1");
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin user create databases, DB_1 and DB_2, no table or other
 * object in database
 * 2. admin grant all to user1's group on DB_1 and DB_2
 * positive test case:
 * a)user1 has the privilege to create table, load data,
 * drop table, create view, insert more data on both databases
 * b) user1 can switch between DB_1 and DB_2 without exception
 * negative test case:
 * c) user1 cannot drop database
 */
@Test public void testSandboxOpt9() throws Exception {
  createDb(ADMIN1,DB1,DB2);
  policyFile.addPermissionsToRole(GROUP1_ROLE,ALL_DB1,ALL_DB2,loadData).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ TBL1);
  statement.execute("create table " + DB1 + "."+ TBL1+ " (under_col int comment 'the under column', value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ DB1+ "."+ TBL1);
  statement.execute("DROP VIEW IF EXISTS " + DB1 + "."+ VIEW1);
  statement.execute("CREATE VIEW " + DB1 + "."+ VIEW1+ " (value) AS SELECT value from "+ DB1+ "."+ TBL1+ " LIMIT 10");
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ TBL1);
  statement.execute("CREATE TABLE " + DB2 + "."+ TBL1+ " AS SELECT value from "+ DB1+ "."+ TBL1+ " LIMIT 10");
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ TBL2);
  statement.execute("create table " + DB2 + "."+ TBL2+ " (under_col int comment 'the under column', value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ DB2+ "."+ TBL2);
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ TBL3);
  statement.execute("create table " + DB2 + "."+ TBL3+ " (under_col int comment 'the under column', value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ DB2+ "."+ TBL3);
  policyFile.removePermissionsFromRole(GROUP1_ROLE,ALL_DB2);
  writePolicyFile(policyFile);
  statement.execute("DROP VIEW IF EXISTS " + DB1 + "."+ VIEW2);
  context.assertAuthzException(statement,"CREATE VIEW " + DB1 + "."+ VIEW2+ " (value) AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ TBL2);
  context.assertAuthzException(statement,"CREATE TABLE " + DB1 + "."+ TBL2+ " AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test Case 2.14 admin user create a new database DB_1 create TABLE_1 in DB_1
 * admin user grant INSERT to user1's group on TABLE_1 negative test case:
 * user1 try to do following on TABLE_1 will fail: --explain --analyze
 * --describe --describe function --show columns --show table status --show
 * table properties --show create table --show partitions --show indexes
 * --select * from TABLE_1.
 */
@Test public void testNegativeUserPrivileges() throws Exception {
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("create table " + DB1 + ".table_1 (id int)");
  adminStmt.execute("create table " + DB1 + ".table_2 (id int)");
  adminStmt.close();
  adminCon.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_tab1_insert","db1_tab2_all").addPermissionsToRole("db1_tab2_all","server=server1->db=" + DB1 + "->table=table_2").addPermissionsToRole("db1_tab1_insert","server=server1->db=" + DB1 + "->table=table_1->action=insert").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection userConn=context.createConnection(USER1_1);
  Statement userStmt=context.createStatement(userConn);
  context.assertAuthzException(userStmt,"select * from " + DB1 + ".table_1");
  userConn.close();
  userStmt.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin user create databases, DB_1 and DB_2, no table or other
 * object in database positive test case:
 * d) user1 has the privilege to create view on tables in DB_1 negative test case:
 * e) user1 cannot create view in DB_1 that select from tables in DB_2
 * with no select privilege 2.
 * positive test case:
 * f) user1 has the privilege to create view to select from DB_1.tb_1
 * and DB_2.tb_2 negative test case:
 * g) user1 cannot create view to select from DB_1.tb_1 and DB_2.tb_3
 */
@Test public void testCrossDbViewOperations() throws Exception {
  createDb(ADMIN1,DB1,DB2);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE " + DB1 + "."+ TBL1+ "(id int)");
  statement.execute("CREATE TABLE " + DB2 + "."+ TBL1+ "(id int)");
  statement.execute("CREATE TABLE " + DB2 + "."+ TBL2+ "(id int)");
  context.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data","select_tb2").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("all_db2","server=server1->db=" + DB2).addPermissionsToRole("select_tb2","server=server1->db=" + DB2 + "->table=tb_1->action=select").addPermissionsToRole("load_data","server=server1->URI=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ TBL1);
  statement.execute("create table " + DB1 + "."+ TBL1+ " (under_col int comment 'the under column', value string)");
  statement.execute("DROP VIEW IF EXISTS " + DB1 + "."+ VIEW1);
  context.assertAuthzException(statement,"CREATE VIEW " + DB1 + "."+ VIEW1+ " (value) AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
  statement.execute("DROP VIEW IF EXISTS " + DB1 + "."+ VIEW2);
  statement.execute("CREATE VIEW " + DB1 + "."+ VIEW2+ " (value) AS SELECT value from "+ DB1+ "."+ TBL1+ " LIMIT 10");
  statement.execute("DROP VIEW IF EXISTS " + DB1 + "."+ VIEW3);
  context.assertAuthzException(statement,"CREATE VIEW " + DB1 + "."+ VIEW3+ " (value) AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * 2.8 admin user create two database, DB_1, DB_2 admin grant all to USER1_1,
 * USER1_2 on DB_1, admin grant all to user1's group, user2's group on DB_2
 * positive test case: user1, user2 has ALL privilege on both DB_1 and DB_2
 * negative test case: user1, user2 don't have ALL privilege on SERVER
 */
@Test public void testDbPrivileges() throws Exception {
  createDb(ADMIN1,DB1,DB2);
  policyFile.addRolesToGroup(USERGROUP1,"db1_all,db2_all, load_data").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("db2_all","server=server1->db=" + DB2).addPermissionsToRole("load_data","server=server1->URI=file://" + dataFile.getPath()).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  for (  String user : new String[]{USER1_1,USER1_2}) {
    for (    String dbName : new String[]{DB1,DB2}) {
      Connection userConn=context.createConnection(user);
      String tabName=user + "_tab1";
      Statement userStmt=context.createStatement(userConn);
      userStmt.execute("Use " + dbName);
      userStmt.execute("create table " + dbName + "."+ tabName+ " (id int)");
      userStmt.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ tabName);
      userStmt.execute("select * from " + dbName + "."+ tabName);
      context.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestEndToEnd </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps:
 * 1. admin create a new experimental database
 * 2. admin create a new production database, create table, load data
 * 3. admin grant privilege all@'experimental database' to usergroup1
 * 4. user create table, load data in experimental DB
 * 5. user create view based on table in experimental DB
 * 6. admin create table (same name) in production DB
 * 7. admin grant read@productionDB.table to group
 * admin grant select@productionDB.table to group
 * 8. user load data from experimental table to production table
 */
@Test public void testEndToEnd1() throws Exception {
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  String tableName1="tb_1";
  String tableName2="tb_2";
  String viewName1="view_1";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("DROP DATABASE IF EXISTS " + DB2 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB2);
  statement.execute("DROP TABLE IF EXISTS " + DB2 + "."+ tableName2);
  statement.execute("create table " + DB2 + "."+ tableName2+ " (under_col int comment 'the under column', value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ tableName2);
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","data_uri","select_tb1","insert_tb1").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("select_tb1","server=server1->db=" + DB2 + "->table=tb_1->action=select").addPermissionsToRole("insert_tb2","server=server1->db=" + DB2 + "->table=tb_2->action=insert").addPermissionsToRole("insert_tb1","server=server1->db=" + DB2 + "->table=tb_2->action=insert").addPermissionsToRole("data_uri","server=server1->uri=file://" + dataDir.getPath());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ tableName1);
  statement.execute("CREATE VIEW " + viewName1 + " (value) AS SELECT value from "+ tableName1+ " LIMIT 10");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  statement.execute("DROP TABLE IF EXISTS " + DB1 + "."+ tableName1);
  statement.execute("create table " + DB1 + "."+ tableName1+ " (under_col int comment 'the under column', value string)");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  statement.execute("INSERT OVERWRITE TABLE " + DB2 + "."+ tableName2+ " SELECT * FROM "+ DB1+ "."+ tableName1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestExportImportPrivileges </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExportImportPrivileges() throws Exception {
  Connection connection=null;
  Statement statement=null;
  String exportDir=dfs.getBaseDir() + "/hive_export1";
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  policyFile.addRolesToGroup(USERGROUP1,"tab1_read","tab1_write","db1_all","data_read","data_export").addRolesToGroup(USERGROUP2,"tab1_write","tab1_read").addRolesToGroup(USERGROUP3,"col1_read").addPermissionsToRole("tab1_write","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=INSERT").addPermissionsToRole("tab1_read","server=server1->db=" + DB1 + "->table="+ TBL1+ "->action=SELECT").addPermissionsToRole("col1_read","server=server1->db=" + DB1 + "->table="+ TBL1+ "->column=under_col->action=SELECT").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("data_read","server=server1->URI=file://" + dataFile.getPath()).addPermissionsToRole("data_export","server=server1->URI=" + exportDir);
  writePolicyFile(policyFile);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  context.assertAuthzException(statement,"EXPORT TABLE " + TBL1 + " TO '"+ exportDir+ "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("EXPORT TABLE " + TBL1 + " TO '"+ exportDir+ "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  context.assertAuthzException(statement,"IMPORT TABLE " + TBL2 + " FROM '"+ exportDir+ "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("IMPORT TABLE " + TBL2 + " FROM '"+ exportDir+ "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("SELECT under_col FROM " + TBL1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMetadataObjectRetrieval </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests to ensure that a user is able to view metadata
 * with all on db
 * Test positive:
 * describe table
 * describe table column
 * show columns from table
 * show create table table
 * show tblproperties table
 * Positive tests are run twice:
 * all@server
 * all@db
 */
@Test public void testAllOnServerAndAllOnDb() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  positiveDescribeShowTests(ADMIN1,DB1,TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=" + DB1).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  positiveDescribeShowTests(USER1_1,DB1,TBL1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests that users without privileges cannot execute show indexes
 * and that users with all on table can execute show indexes
 */
@Test public void testShowIndexes1() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  createTable(ADMIN1,DB1,dataFile,TBL2);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP INDEX IF EXISTS " + INDEX1 + " ON "+ TBL1);
  statement.execute("CREATE INDEX " + INDEX1 + " ON TABLE "+ TBL1+ "(value) AS 'org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler' WITH DEFERRED REBUILD");
  statement.execute("DROP VIEW IF EXISTS " + VIEW1);
  statement.execute("CREATE VIEW " + VIEW1 + " (value) AS SELECT value from "+ TBL1+ " LIMIT 10");
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL2).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SHOW INDEX ON " + TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_VIEW1);
  writePolicyFile(policyFile);
  context.assertAuthzException(statement,"SHOW INDEX ON " + TBL1);
  policyFile.removePermissionsFromRole(GROUP1_ROLE,SELECT_DB1_VIEW1).addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL1);
  writePolicyFile(policyFile);
  verifyIndex(statement,DB1,TBL1,INDEX1);
  policyFile.removePermissionsFromRole(GROUP1_ROLE,SELECT_DB1_TBL1).addPermissionsToRole(GROUP1_ROLE,INSERT_DB1_TBL1);
  writePolicyFile(policyFile);
  verifyIndex(statement,DB1,TBL1,INDEX1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests that users without privileges cannot execute show partitions
 * and that users with select on table can execute show partitions
 */
@Test public void testShowPartitions1() throws Exception {
  createDb(ADMIN1,DB1);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS " + TBL2);
  statement.execute("create table " + TBL2 + " (under_col int, value string) PARTITIONED BY (dt INT)");
  statement.execute("DROP TABLE IF EXISTS " + TBL1);
  statement.execute("create table " + TBL1 + " (under_col int, value string) PARTITIONED BY (dt INT)");
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ TBL1+ " PARTITION (dt=3)");
  statement.execute("DROP VIEW IF EXISTS " + VIEW1);
  statement.execute("CREATE VIEW " + VIEW1 + " (value) AS SELECT value from "+ TBL1+ " LIMIT 10");
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL2).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SHOW PARTITIONS " + TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_VIEW1);
  writePolicyFile(policyFile);
  context.assertAuthzException(statement,"SHOW PARTITIONS " + TBL1);
  policyFile.removePermissionsFromRole(GROUP1_ROLE,SELECT_DB1_VIEW1).addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL1);
  writePolicyFile(policyFile);
  verifyParition(statement,TBL1);
  policyFile.removePermissionsFromRole(GROUP1_ROLE,SELECT_DB1_TBL1).addPermissionsToRole(GROUP1_ROLE,INSERT_DB1_TBL1);
  writePolicyFile(policyFile);
  verifyParition(statement,TBL1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests to ensure a user with all on server,
 * insert|select on table can view metadata while
 * a user with all on a different table cannot
 * view the metadata.
 * Test both positive and negative of:
 * describe table
 * describe table column
 * show columns from table
 * show create table table
 * show tblproperties table
 * Positive tests are run with:
 * all@server
 * select@table
 * insert@table
 * Negative tests are run three times:
 * none
 * insert@different table
 */
@Test public void testAllOnServerSelectInsertNegativeNoneAllOnDifferentTable() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  createTable(ADMIN1,DB1,dataFile,TBL2);
  positiveDescribeShowTests(ADMIN1,DB1,TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=" + DB1 + "->table="+ TBL2).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  negativeDescribeShowTests(USER1_1,DB1,TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB1_TBL1);
  writePolicyFile(policyFile);
  positiveDescribeShowTests(USER1_1,DB1,TBL1);
  policyFile.removePermissionsFromRole(GROUP1_ROLE,SELECT_DB1_TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,INSERT_DB1_TBL1);
  writePolicyFile(policyFile);
  positiveDescribeShowTests(USER1_1,DB1,TBL1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests to ensure that a user is able to view metadata
 * with all on table
 * Test positive:
 * describe table
 * describe table column
 * show columns from table
 * show create table table
 * show tblproperties table
 * Positive tests are run twice:
 * all@server
 * all@table
 */
@Test public void testAllOnServerAndAllOnTable() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  positiveDescribeShowTests(ADMIN1,DB1,TBL1);
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=" + DB1 + "->table="+ TBL1).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  positiveDescribeShowTests(USER1_1,DB1,TBL1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test to ensure that all on view do not result in
 * metadata privileges on the underlying table
 * Test both positive and negative of:
 * describe table
 * describe table column
 * show columns from table
 * show create table table
 * show tblproperties table
 * Positive tests are run with all@server
 * Negative tests are run three times:
 * none
 * all@view
 */
@Test public void testAllOnServerNegativeAllOnView() throws Exception {
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP VIEW IF EXISTS " + VIEW1);
  statement.execute("CREATE VIEW " + VIEW1 + " (value) AS SELECT value from "+ TBL1+ " LIMIT 10");
  positiveDescribeShowTests(ADMIN1,DB1,TBL1);
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole(GROUP1_ROLE,"server=server1->db=" + DB1 + "->table="+ VIEW1).addRolesToGroup(USERGROUP1,GROUP1_ROLE).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  negativeDescribeShowTests(USER1_1,DB1,TBL1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestMetadataPermissions </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Ensure that a user with no privileges on a database cannot
 * query that databases metadata.
 */
@Test public void testDescPrivilegesNegative() throws Exception {
  Connection connection=context.createConnection(USER2_1);
  Statement statement=context.createStatement(connection);
  context.assertAuthzException(statement,"USE " + DB2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Ensure that a user cannot describe databases to which the user
 * has no privilege.
 */
@Test public void testDescDbPrivilegesNegative() throws Exception {
  Connection connection=context.createConnection(USER2_1);
  Statement statement=context.createStatement(connection);
  context.assertAuthzException(statement,"DESCRIBE DATABASE " + DB2);
  context.assertAuthzException(statement,"DESCRIBE DATABASE EXTENDED " + DB2);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestOperations </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFullyQualifiedTableName() throws Exception {
  Connection connection;
  Statement statement;
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("create database " + DB1);
  statement.execute("create table " + DB1 + ".tb1(a int)");
  statement.execute("DROP table " + DB1 + ".tb1");
  statement.execute("create table " + DB1 + ".tb1(a int)");
  statement.execute("use " + DB1);
  statement.execute("drop table tb1");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testInsert() throws Exception {
  File dataFile;
  dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  dropDb(ADMIN1,DB1);
  dropDb(ADMIN1,DB2);
  createDb(ADMIN1,DB1);
  createDb(ADMIN1,DB2);
  createTable(ADMIN1,DB1,dataFile,tableName);
  createTable(ADMIN1,DB2,null,"tb2");
  String location=dfs.getBaseDir() + "/" + Math.random();
  policyFile.addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addPermissionsToRole("insert_db2_tb2",privileges.get("insert_db2_tb2")).addRolesToGroup(USERGROUP1,"select_db1_tb1","insert_db2_tb2").addPermissionsToRole("all_uri","server=server1->uri=" + location).addRolesToGroup(USERGROUP2,"select_db1_tb1","all_uri");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  assertSemanticException(statement,"insert overwrite directory '" + location + "' select * from "+ DB1+ ".tb1");
  statement.execute("insert overwrite table " + DB2 + ".tb2 select * from "+ DB1+ ".tb1");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("insert overwrite directory '" + location + "' select * from "+ DB1+ ".tb1");
  assertSemanticException(statement,"insert overwrite table " + DB2 + ".tb2 select * from "+ DB1+ ".tb1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testLoad() throws Exception {
  File dataFile;
  dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  adminCreate(DB1,tableName);
  policyFile.addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addPermissionsToRole("all_uri","server=server1->uri=file://" + dataDir).addRolesToGroup(USERGROUP1,"insert_db1_tb1","all_uri");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("load data local inpath '" + dataFile.getPath() + "' into table tb1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateView() throws Exception {
  adminCreate(DB1,tableName);
  adminCreate(DB2,null);
  policyFile.addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addPermissionsToRole("create_db2",privileges.get("create_db2")).addRolesToGroup(USERGROUP1,"select_db1_tb1","create_db2");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("use " + DB2);
  statement.execute("create view view1 as select a from " + DB1 + ".tb1");
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP3,"insert_db1_tb1","create_db2");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB2);
  context.assertSentrySemanticException(statement,"create view view1 as select a from " + DB1 + ".tb1",semanticException);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void dropPartition() throws Exception {
  adminCreate(DB1,tableName,true);
  policyFile.addPermissionsToRole("alter_db1_tb1",privileges.get("alter_db1_tb1")).addPermissionsToRole("drop_db1_tb1",privileges.get("drop_db1_tb1")).addRolesToGroup(USERGROUP1,"alter_db1_tb1","drop_db1_tb1").addRolesToGroup(USERGROUP2,"alter_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection;
  Statement statement;
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '10') ");
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  assertSemanticException(statement,"ALTER TABLE tb1 DROP PARTITION (b = 10)");
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("ALTER TABLE tb1 DROP PARTITION (b = 10)");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testIndexTable() throws Exception {
  adminCreate(DB1,tableName,true);
  policyFile.addPermissionsToRole("index_db1_tb1",privileges.get("index_db1_tb1")).addRolesToGroup(USERGROUP1,"index_db1_tb1").addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP2,"insert_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection;
  Statement statement;
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("CREATE INDEX table01_index ON TABLE tb1 (a) AS 'COMPACT' WITH DEFERRED REBUILD");
  statement.execute("ALTER INDEX table01_index ON tb1 REBUILD");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  assertSemanticException(statement,"CREATE INDEX table02_index ON TABLE tb1 (a) AS 'COMPACT' WITH DEFERRED REBUILD");
  assertSemanticException(statement,"ALTER INDEX table01_index ON tb1 REBUILD");
  assertSemanticException(statement,"DROP INDEX table01_index ON tb1");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("DROP INDEX table01_index ON tb1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSelectOnTable() throws Exception {
  adminCreate(DB1,tableName,true);
  adminCreatePartition();
  policyFile.addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addRolesToGroup(USERGROUP1,"select_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("select * from tb1");
  statement.executeQuery("SHOW Partitions tb1");
  statement.executeQuery("SHOW TBLPROPERTIES tb1");
  statement.executeQuery("SHOW CREATE TABLE tb1");
  statement.executeQuery("SHOW indexes on tb1");
  statement.executeQuery("SHOW COLUMNS from tb1");
  statement.executeQuery("SHOW functions '.*'");
  statement.executeQuery("SHOW TABLE EXTENDED IN " + DB1 + " LIKE 'tb*'");
  statement.executeQuery("DESCRIBE tb1");
  statement.executeQuery("DESCRIBE tb1 PARTITION (b=1)");
  statement.close();
  connection.close();
  adminCreate(DB2,tableName);
  policyFile.addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP3,"insert_db1_tb1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  context.assertSentrySemanticException(statement,"select * from tb1",semanticException);
  context.assertSentrySemanticException(statement,"SHOW TABLE EXTENDED IN " + DB2 + " LIKE 'tb*'",semanticException);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDescDB() throws Exception {
  adminCreate(DB1,tableName);
  policyFile.addPermissionsToRole("select_db1",privileges.get("select_db1")).addPermissionsToRole("insert_db1",privileges.get("insert_db1")).addRolesToGroup(USERGROUP1,"select_db1").addRolesToGroup(USERGROUP2,"insert_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("describe database " + DB1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("describe database " + DB1);
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole("all_db1_tb1",privileges.get("all_db1_tb1")).addRolesToGroup(USERGROUP3,"all_db1_tb1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentrySemanticException(statement,"describe database " + DB1,semanticException);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAlterTable() throws Exception {
  adminCreate(DB1,tableName,true);
  Connection connection;
  Statement statement;
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '10') ");
  statement.execute("ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '1') ");
  statement.execute("DROP TABLE IF EXISTS ptab");
  statement.execute("CREATE TABLE ptab (a int) STORED AS PARQUET");
  policyFile.addPermissionsToRole("alter_db1_tb1",privileges.get("alter_db1_tb1")).addPermissionsToRole("alter_db1_ptab",privileges.get("alter_db1_ptab")).addRolesToGroup(USERGROUP1,"alter_db1_tb1","alter_db1_ptab").addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP2,"insert_db1_tb1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  assertSemanticException(statement,"ALTER TABLE tb1 SET TBLPROPERTIES ('comment' = 'new_comment')");
  assertSemanticException(statement,"ALTER TABLE tb1 SET SERDEPROPERTIES ('field.delim' = ',')");
  assertSemanticException(statement,"ALTER TABLE tb1 CLUSTERED BY (a) SORTED BY (a) INTO 1 BUCKETS");
  assertSemanticException(statement,"ALTER TABLE tb1 TOUCH");
  assertSemanticException(statement,"ALTER TABLE tb1 ENABLE NO_DROP");
  assertSemanticException(statement,"ALTER TABLE tb1 DISABLE OFFLINE");
  assertSemanticException(statement,"ALTER TABLE tb1 SET FILEFORMAT RCFILE");
  assertSemanticException(statement,"ALTER TABLE tb1 PARTITION (b = 10) RENAME TO PARTITION (b = 2)");
  assertSemanticException(statement,"ALTER TABLE tb1 PARTITION (b = 10) SET SERDEPROPERTIES ('field.delim' = ',')");
  assertSemanticException(statement,"ALTER TABLE tb1 PARTITION (b = 10) SET FILEFORMAT RCFILE");
  assertSemanticException(statement,"ALTER TABLE tb1 TOUCH PARTITION (b = 10)");
  assertSemanticException(statement,"ALTER TABLE tb1 PARTITION (b = 10) DISABLE NO_DROP");
  assertSemanticException(statement,"ALTER TABLE tb1 PARTITION (b = 10) DISABLE OFFLINE");
  assertSemanticException(statement,"ALTER TABLE tb1 CHANGE COLUMN a c int");
  assertSemanticException(statement,"ALTER TABLE tb1 ADD COLUMNS (a int)");
  assertSemanticException(statement,"ALTER TABLE ptab REPLACE COLUMNS (a int, c int)");
  assertSemanticException(statement,"MSCK REPAIR TABLE tb1");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("ALTER TABLE tb1 SET TBLPROPERTIES ('comment' = 'new_comment')");
  statement.execute("ALTER TABLE tb1 SET SERDEPROPERTIES ('field.delim' = ',')");
  statement.execute("ALTER TABLE tb1 CLUSTERED BY (a) SORTED BY (a) INTO 1 BUCKETS");
  statement.execute("ALTER TABLE tb1 TOUCH");
  statement.execute("ALTER TABLE tb1 ENABLE NO_DROP");
  statement.execute("ALTER TABLE tb1 DISABLE OFFLINE");
  statement.execute("ALTER TABLE tb1 SET FILEFORMAT RCFILE");
  statement.execute("ALTER TABLE tb1 PARTITION (b = 1) RENAME TO PARTITION (b = 2)");
  statement.execute("ALTER TABLE tb1 PARTITION (b = 2) SET SERDEPROPERTIES ('field.delim' = ',')");
  statement.execute("ALTER TABLE tb1 PARTITION (b = 2) SET FILEFORMAT RCFILE");
  statement.execute("ALTER TABLE tb1 TOUCH PARTITION (b = 2)");
  statement.execute("ALTER TABLE tb1 PARTITION (b = 2) DISABLE NO_DROP");
  statement.execute("ALTER TABLE tb1 PARTITION (b = 2) DISABLE OFFLINE");
  statement.execute("ALTER TABLE tb1 CHANGE COLUMN a c int");
  statement.execute("ALTER TABLE tb1 ADD COLUMNS (a int)");
  statement.execute("ALTER TABLE ptab REPLACE COLUMNS (a int, c int)");
  statement.execute("MSCK REPAIR TABLE tb1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAlterOnDatabase() throws Exception {
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("alter_db1",privileges.get("alter_db1")).addPermissionsToRole("all_db1",privileges.get("all_db1")).addRolesToGroup(USERGROUP2,"all_db1").addRolesToGroup(USERGROUP1,"alter_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("ALTER DATABASE " + DB1 + " SET DBPROPERTIES ('comment'='comment')");
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("ALTER DATABASE " + DB1 + " SET DBPROPERTIES ('comment'='comment')");
  statement.close();
  connection.close();
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("select_db1",privileges.get("select_db1")).addRolesToGroup(USERGROUP3,"select_db1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentrySemanticException(statement,"ALTER DATABASE " + DB1 + " SET DBPROPERTIES ('comment'='comment')",semanticException);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExportImport() throws Exception {
  File dataFile;
  dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  dropDb(ADMIN1,DB1);
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,tableName);
  String location=dfs.getBaseDir() + "/" + Math.random();
  policyFile.addPermissionsToRole("create_db1",privileges.get("create_db1")).addPermissionsToRole("all_uri","server=server1->uri=" + location).addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addPermissionsToRole("insert_db1",privileges.get("insert_db1")).addRolesToGroup(USERGROUP1,"select_db1_tb1","all_uri").addRolesToGroup(USERGROUP2,"create_db1","all_uri").addRolesToGroup(USERGROUP3,"insert_db1","all_uri");
  writePolicyFile(policyFile);
  Connection connection;
  Statement statement;
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  context.assertSentrySemanticException(statement,"export table tb1 to '" + location + "'",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("export table tb1 to '" + location + "'");
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  context.assertSentrySemanticException(statement,"import table tb2 from '" + location + "'",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("import table tb2 from '" + location + "'");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void renameTable() throws Exception {
  adminCreate(DB1,tableName);
  policyFile.addPermissionsToRole("alter_db1_tb1",privileges.get("alter_db1_tb1")).addPermissionsToRole("create_db1",privileges.get("create_db1")).addRolesToGroup(USERGROUP1,"alter_db1_tb1","create_db1").addRolesToGroup(USERGROUP2,"create_db1").addRolesToGroup(USERGROUP3,"alter_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection;
  Statement statement;
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  assertSemanticException(statement,"ALTER TABLE tb1 RENAME TO tb2");
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  assertSemanticException(statement,"ALTER TABLE tb1 RENAME TO tb2");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("ALTER TABLE tb1 RENAME TO tb2");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCaseSensitivity() throws Exception {
  Statement statement=null;
  Connection connection=null;
  try {
    createDb(ADMIN1,DB1);
    Path extParentDir=dfs.assertCreateDir("/ABC/hhh");
    Path extTableDir=dfs.assertCreateDir("/abc/hhh");
    policyFile.addPermissionsToRole("create_db1",privileges.get("create_db1")).addPermissionsToRole("all_uri","server=server1->uri=" + extParentDir).addRolesToGroup(USERGROUP1,"create_db1","all_uri");
    writePolicyFile(policyFile);
    connection=context.createConnection(USER1_1);
    statement=context.createStatement(connection);
    assertSemanticException(statement,"create external table " + DB1 + ".tb1(a int) location '"+ extTableDir+ "'");
  }
  finally {
    if (statement != null)     statement.close();
    if (connection != null)     connection.close();
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAlterOnTableAndURI() throws Exception {
  adminCreate(DB1,tableName,true);
  String tabLocation=dfs.getBaseDir() + "/" + Math.random();
  policyFile.addPermissionsToRole("alter_db1_tb1",privileges.get("alter_db1_tb1")).addPermissionsToRole("all_uri","server=server1->uri=" + tabLocation).addRolesToGroup(USERGROUP1,"alter_db1_tb1","all_uri").addRolesToGroup(USERGROUP2,"alter_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER2_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  assertSemanticException(statement,"ALTER TABLE tb1 SET LOCATION '" + tabLocation + "'");
  assertSemanticException(statement,"ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '3') LOCATION '" + tabLocation + "/part'");
  statement.execute("ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '1') ");
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("ALTER TABLE tb1 SET LOCATION '" + tabLocation + "'");
  statement.execute("ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '3') LOCATION '" + tabLocation + "/part'");
  statement.execute("ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '10') ");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  context.assertSentrySemanticException(statement,"ALTER TABLE tb1 SET LOCATION '" + tabLocation + "'",semanticException);
  context.assertSentrySemanticException(statement,"ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '3') LOCATION '" + tabLocation + "/part'",semanticException);
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP3,"insert_db1_tb1","all_uri");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  assertSemanticException(statement,"ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '2') ");
  assertSemanticException(statement,"ALTER TABLE tb1 SET LOCATION '" + tabLocation + "'");
  assertSemanticException(statement,"ALTER TABLE tb1 ADD IF NOT EXISTS PARTITION (b = '3') LOCATION '" + tabLocation + "/part'");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDropOnDatabase() throws Exception {
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("drop_db1",privileges.get("drop_db1")).addRolesToGroup(USERGROUP1,"drop_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE " + DB1);
  statement.close();
  connection.close();
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("all_db1",privileges.get("all_db1")).addRolesToGroup(USERGROUP2,"all_db1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("DROP DATABASE " + DB1);
  statement.close();
  connection.close();
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("select_db1",privileges.get("select_db1")).addRolesToGroup(USERGROUP3,"select_db1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentrySemanticException(statement,"drop database " + DB1,semanticException);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateOnDatabase() throws Exception {
  adminCreate(DB1,null);
  policyFile.addPermissionsToRole("create_db1",privileges.get("create_db1")).addPermissionsToRole("all_db1",privileges.get("all_db1")).addRolesToGroup(USERGROUP1,"create_db1").addRolesToGroup(USERGROUP2,"all_db1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE " + DB1 + ".tb2(a int)");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("CREATE TABLE " + DB1 + ".tb3(a int)");
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole("all_db1_tb1",privileges.get("select_db1")).addRolesToGroup(USERGROUP3,"all_db1_tb1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentrySemanticException(statement,"CREATE TABLE " + DB1 + ".tb1(a int)",semanticException);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateOnServer() throws Exception {
  policyFile.addPermissionsToRole("create_server",privileges.get("create_server")).addRolesToGroup(USERGROUP1,"create_server");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Create database " + DB2);
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole("create_db1",privileges.get("create_db1")).addRolesToGroup(USERGROUP2,"create_db1");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentrySemanticException(statement,"CREATE database " + DB1,semanticException);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSelectAndInsertOnTable() throws Exception {
  adminCreate(DB1,tableName,true);
  adminCreatePartition();
  policyFile.addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP1,"select_db1_tb1","insert_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("ANALYZE TABLE tb1 PARTITION (b='1' ) COMPUTE STATISTICS");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testInsertOnTable() throws Exception {
  adminCreate(DB1,tableName,true);
  adminCreatePartition();
  policyFile.addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP1,"insert_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.executeQuery("SHOW TBLPROPERTIES tb1");
  statement.executeQuery("SHOW CREATE TABLE tb1");
  statement.executeQuery("SHOW indexes on tb1");
  statement.executeQuery("SHOW COLUMNS from tb1");
  statement.executeQuery("SHOW functions '.*'");
  statement.executeQuery("SHOW TABLE EXTENDED IN " + DB1 + " LIKE 'tb*'");
  statement.executeQuery("DESCRIBE tb1");
  statement.executeQuery("DESCRIBE tb1 PARTITION (b=1)");
  statement.executeQuery("SHOW Partitions tb1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCTAS() throws Exception {
  adminCreate(DB1,tableName);
  adminCreate(DB2,null);
  String location=dfs.getBaseDir() + "/" + Math.random();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("create view view1 as select a from " + DB1 + ".tb1");
  statement.close();
  connection.close();
  policyFile.addPermissionsToRole("select_db1_tb1",privileges.get("select_db1_tb1")).addPermissionsToRole("select_db1_view1",privileges.get("select_db1_view1")).addPermissionsToRole("create_db2",privileges.get("create_db2")).addPermissionsToRole("all_uri","server=server1->uri=" + location).addRolesToGroup(USERGROUP1,"select_db1_tb1","create_db2").addRolesToGroup(USERGROUP2,"select_db1_view1","create_db2").addRolesToGroup(USERGROUP3,"select_db1_tb1","create_db2,all_uri");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB2);
  statement.execute("create table tb2 as select a from " + DB1 + ".tb1");
  context.assertSentrySemanticException(statement,"create table tb3 location '" + location + "' as select a from "+ DB1+ ".tb1",semanticException);
  context.assertSentrySemanticException(statement,"create table tb3 as select a from " + DB1 + ".view1",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB2);
  statement.execute("create table tb3 as select a from " + DB1 + ".view1");
  context.assertSentrySemanticException(statement,"create table tb4 as select a from " + DB1 + ".tb1",semanticException);
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB2);
  statement.execute("create table tb4 location '" + location + "' as select a from "+ DB1+ ".tb1");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDropTable() throws Exception {
  adminCreate(DB1,tableName,true);
  policyFile.addPermissionsToRole("drop_db1_tb1",privileges.get("drop_db1_tb1")).addRolesToGroup(USERGROUP1,"drop_db1_tb1").addPermissionsToRole("insert_db1_tb1",privileges.get("insert_db1_tb1")).addRolesToGroup(USERGROUP2,"insert_db1_tb1");
  writePolicyFile(policyFile);
  Connection connection;
  Statement statement;
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  assertSemanticException(statement,"drop table " + tableName);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("Use " + DB1);
  statement.execute("drop table " + tableName);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPerDBConfiguration </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPerDB() throws Exception {
  PolicyFile db2PolicyFile=new PolicyFile();
  File db2PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB2_POLICY_FILE);
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl2","server=server1->db=" + DB2 + "->table=tbl2->action=select").write(db2PolicyFileHandle);
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl1","server=server1->db=" + DB1 + "->table=tbl1->action=select").addDatabase(DB2,prefix + db2PolicyFileHandle.getName()).setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  verifyCount(statement,"SELECT COUNT(*) FROM tbl1",1,12);
  context.assertAuthzException(statement,"USE " + DB2);
  context.assertAuthzException(statement,"SELECT COUNT(*) FROM " + DB2 + ".tbl2");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  verifyCount(statement,"SELECT COUNT(*) FROM tbl2",1,12);
  context.assertAuthzException(statement,"SELECT COUNT(*) FROM " + DB1 + ".tbl1");
  context.assertAuthzException(statement,"USE " + DB1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test 'use default' statement. It should work as long as the user as privilege to assess any object in system
 * @throws Exception
 */
@Test public void testDefaultDb() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addPermissionsToRole("select_tbl1","server=server1->db=" + DB1 + "->table=tbl1->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE default");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,"USE default");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Multiple DB files with some containing badly formatted rules
 * The privileges should work for good files
 * No access for bad formatted ones
 * @throws Exception
 */
@Test public void testMultiPerDBwithErrors() throws Exception {
  String DB3_POLICY_FILE="db3-policy-file.ini";
  String DB4_POLICY_FILE="db4-policy-file.ini";
  File db2PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB2_POLICY_FILE);
  File db3PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB3_POLICY_FILE);
  File db4PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB4_POLICY_FILE);
  PolicyFile db2PolicyFile=new PolicyFile();
  PolicyFile db3PolicyFile=new PolicyFile();
  PolicyFile db4PolicyFile=new PolicyFile();
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl2","server=server1->db=" + DB2 + "->table=tbl2->action=select").write(db2PolicyFileHandle);
  db3PolicyFile.addRolesToGroup(USERGROUP3,"select_tbl3_BAD").addPermissionsToRole("select_tbl3_BAD","server=server1->db=db3------>table->action=select").write(db3PolicyFileHandle);
  db4PolicyFile.addRolesToGroup(USERGROUP4,"select_tbl4").addPermissionsToRole("select_tbl4","server=server1->db=db4->table=tbl4->action=select").write(db4PolicyFileHandle);
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl1","server=server1->db=" + DB1 + "->table=tbl1->action=select").addDatabase(DB2,prefix + db2PolicyFileHandle.getName()).addDatabase("db3",prefix + db3PolicyFileHandle.getName()).addDatabase("db4",prefix + db4PolicyFileHandle.getName()).setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  verifyCount(statement,"SELECT COUNT(*) FROM tbl1",1,12);
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  verifyCount(statement,"SELECT COUNT(*) FROM tbl2",1,12);
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,"USE db3");
  context.assertAuthzException(statement,"SELECT COUNT(*) FROM db3.tbl3");
  connection.close();
  connection=context.createConnection(USER4_1);
  statement=context.createStatement(connection);
  statement.execute("USE db4");
  verifyCount(statement,"SELECT COUNT(*) FROM tbl4",1,12);
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDefaultDBwithDbPolicy() throws Exception {
  File db2PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB2_POLICY_FILE);
  File defaultPolicyFileHandle=new File(context.getPolicyFile().getParent(),"default.ini");
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl1","server=server1->db=" + DB1 + "->table=tbl1->action=select").addDatabase(DB2,prefix + db2PolicyFileHandle.getName()).addDatabase("default",prefix + defaultPolicyFileHandle.getName()).setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  PolicyFile db2PolicyFile=new PolicyFile();
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl2","server=server1->db=" + DB2 + "->table=tbl2->action=select").write(db2PolicyFileHandle);
  PolicyFile defaultPolicyFile=new PolicyFile();
  defaultPolicyFile.addRolesToGroup(USERGROUP2,"select_def").addPermissionsToRole("select_def","server=server1->db=default->table=dtab->action=select").write(defaultPolicyFileHandle);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE default");
  statement.execute("DROP TABLE IF EXISTS dtab");
  statement.execute("CREATE TABLE dtab(B INT, A STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("USE default");
  context.assertAuthzException(statement,"SELECT * FROM dtab");
  statement.execute("USE " + DB1);
  context.assertAuthzException(statement,"SELECT * FROM default.dtab");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  statement.execute("USE default");
  statement.execute("SELECT * FROM dtab");
  statement.execute("USE " + DB2);
  statement.execute("SELECT * FROM default.dtab");
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertAuthzException(statement,"USE default");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPerDBPolicyFileWithURI() throws Exception {
  File db2PolicyFileHandle=new File(context.getPolicyFile().getParent(),DB2_POLICY_FILE);
  PolicyFile db2PolicyFile=new PolicyFile();
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl5","data_read","insert_tbl5").addPermissionsToRole("select_tbl5","server=server1->db=" + DB2 + "->table=tbl5->action=select").addPermissionsToRole("insert_tbl5","server=server1->db=" + DB2 + "->table=tbl5->action=insert").addPermissionsToRole("data_read","server=server1->URI=file://" + dataFile).write(db2PolicyFileHandle);
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl5").addPermissionsToRole("select_tbl1","server=server1->db=" + DB1 + "->table=tbl1->action=select").addDatabase(DB2,prefix + db2PolicyFileHandle.getName()).setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  System.setProperty(SimpleDBPolicyEngine.ACCESS_ALLOW_URI_PER_DB_POLICYFILE,"true");
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  verifyCount(statement,"SELECT COUNT(*) FROM tbl1",1,12);
  context.assertAuthzException(statement,"USE " + DB2);
  context.assertAuthzException(statement,"SELECT COUNT(*) FROM " + DB2 + ".tbl5");
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  verifyCount(statement,"SELECT COUNT(*) FROM tbl5",1,0);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE tbl5");
  context.assertAuthzException(statement,"SELECT COUNT(*) FROM " + DB1 + ".tbl1");
  context.assertAuthzException(statement,"USE " + DB1);
  System.setProperty(SimpleDBPolicyEngine.ACCESS_ALLOW_URI_PER_DB_POLICYFILE,"false");
  context.assertAuthzException(statement,"USE " + DB2);
  System.setProperty(SimpleDBPolicyEngine.ACCESS_ALLOW_URI_PER_DB_POLICYFILE,"true");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPerDatabasePolicyFile </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Ensure that db specific file cannot grant to all servers
 */
@Test public void testDbSpecificFileGrantsToAllServers() throws Exception {
  doTestDbSpecificFileGrants("server=*");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Ensure that db specific file cannot grant to other db
 */
@Test public void testDbSpecificFileGrantsToOtherDb() throws Exception {
  doTestDbSpecificFileGrants("server=server1->db=" + DB1);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Ensure that db specific file cannot grant to all
 */
@Test public void testDbSpecificFileGrantsToAll() throws Exception {
  doTestDbSpecificFileGrants("*");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Ensure that db specific file cannot grant to all db
 */
@Test public void testDbSpecificFileGrantsToAllDb() throws Exception {
  doTestDbSpecificFileGrants("server=server1");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPolicyImportExport </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testImportExportPolicy() throws Exception {
  String importFileName="testPolicyImport.ini";
  String exportFileName="testPolicyExport.ini";
  File importFile=new File(dataDir,importFileName);
  File exportFile=new File(dataDir,exportFileName);
  FileOutputStream to=new FileOutputStream(importFile);
  Resources.copy(Resources.getResource(importFileName),to);
  to.close();
  configTool.setImportPolicyFilePath(importFile.getAbsolutePath());
  configTool.importPolicy();
  configTool.setExportPolicyFilePath(exportFile.getAbsolutePath());
  configTool.exportPolicy();
  SentryPolicyFileFormatter sentryPolicyFileFormatter=SentryPolicyFileFormatFactory.createFileFormatter(configTool.getAuthzConf());
  Map<String,Map<String,Set<String>>> exportMappingData=sentryPolicyFileFormatter.parse(exportFile.getAbsolutePath(),configTool.getAuthzConf());
  prepareExceptedData();
  validateSentryMappingData(exportMappingData,policyFileMappingData);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtColumnScope </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPartition() throws Exception {
  policyFile.addRolesToGroup(USERGROUP1,"select_tab3_A","select_tab3_C").addRolesToGroup(USERGROUP2,"select_tab3_A").addRolesToGroup(USERGROUP3,"select_tab3_C").addPermissionsToRole("select_tab3_A","server=server1->db=DB_1->table=TAB_3->column=A->action=select").addPermissionsToRole("select_tab3_C","server=server1->db=DB_1->table=TAB_3->column=C->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  String[] positiveUsers={USER1_1,USER3_1};
  for (  String user : positiveUsers) {
    Connection connection=context.createConnection(user);
    Statement statement=context.createStatement(connection);
    statement.execute("USE DB_1");
    statement.execute("SELECT C FROM TAB_3");
    statement.close();
    connection.close();
  }
  String[] negativeUsers={USER2_1};
  for (  String user : negativeUsers) {
    Connection connection=context.createConnection(USER1_1);
    Statement statement=context.createStatement(connection);
    statement.execute("USE DB_1");
    try {
      statement.execute("SELECT C FROM TAB_3");
    }
 catch (    SQLException e) {
      context.verifyAuthzException(e);
    }
    statement.close();
    connection.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtDatabaseScope </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAllOnDb() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("create database " + DB1);
  statement.execute("create table " + DB1 + ".tab1(a int)");
  policyFile.addRolesToGroup(USERGROUP1,"all_db1").addPermissionsToRole("all_db1","server=server1->db=" + DB1 + "->action=all").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("use " + DB1);
  statement.execute("select * from tab1");
  policyFile.addPermissionsToRole("all_db1","server=server1->db=" + DB1);
  writePolicyFile(policyFile);
  statement.execute("use " + DB1);
  statement.execute("select * from tab1");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtFunctionScope </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUdfWhiteList() throws Exception {
  String tableName1="tab1";
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=connection.createStatement();
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("create table " + tableName1 + " (under_col int comment 'the under column', value string)");
  policyFile.addRolesToGroup(USERGROUP1,"db1_all","UDF_JAR").addRolesToGroup(USERGROUP2,"db1_tab1","UDF_JAR").addRolesToGroup(USERGROUP3,"db1_tab1").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("db1_tab1","server=server1->db=" + DB1 + "->table="+ tableName1).addPermissionsToRole("UDF_JAR","server=server1->uri=file://${user.home}/.m2");
  writePolicyFile(policyFile);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ "."+ tableName1);
  statement.execute("SELECT rand(), concat(value, '_foo') FROM " + tableName1);
  context.assertAuthzException(statement,"SELECT  reflect('java.net.URLDecoder', 'decode', 'http://www.apache.org', 'utf-8'), value FROM " + tableName1);
  context.assertAuthzException(statement,"SELECT  java_method('java.net.URLDecoder', 'decode', 'http://www.apache.org', 'utf-8'), value FROM " + tableName1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestPrivilegesAtTableScope </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDummyPartition() throws Exception {
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE if exists " + TBL1);
  statement.execute("CREATE table " + TBL1 + " (a int) PARTITIONED BY (b string, c string)");
  statement.execute("DROP TABLE if exists " + TBL3);
  statement.execute("CREATE table " + TBL3 + " (a2 int) PARTITIONED BY (b2 string, c2 string)");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"select_tab1","select_tab2").addPermissionsToRole("select_tab1","server=server1->db=DB_1->table=" + TBL1 + "->action=select").addPermissionsToRole("select_tab2","server=server1->db=DB_1->table=" + TBL3 + "->action=insert");
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("INSERT OVERWRITE TABLE " + TBL3 + " PARTITION(b2='abc', c2) select a, b as c2 from "+ TBL1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestReloadPrivileges </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testReload() throws Exception {
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("RELOAD");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestRuntimeMetadataRetrieval </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin create db_1 and db_1.tb_1
 * 2. admin should see all tables
 * 3. user1 should only see the tables it has any level of privilege
 */
@Test public void testShowTables1() throws Exception {
  String tableNames[]={"tb_1","tb_2","tb_3","tb_4"};
  List<String> tableNamesValidation=new ArrayList<String>();
  String user1TableNames[]={"tb_1","tb_2","tb_3"};
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  createTabs(statement,DB1,tableNames);
  ResultSet rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(tableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
  policyFile.addRolesToGroup(USERGROUP1,"tab1_priv,tab2_priv,tab3_priv").addPermissionsToRole("tab1_priv","server=server1->db=" + DB1 + "->table="+ tableNames[0]+ "->action=select").addPermissionsToRole("tab2_priv","server=server1->db=" + DB1 + "->table="+ tableNames[1]+ "->action=insert").addPermissionsToRole("tab3_priv","server=server1->db=" + DB1 + "->table="+ tableNames[2]+ "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(user1TableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin create db_1 and db_1.tb_1
 * 2. admin should see all tables
 * 3. user1 should only see the tables he/she has any level of privilege
 */
@Test public void testShowTables3() throws Exception {
  String tableNames[]={"tb_1","tb_2","tb_3","newtab_3"};
  List<String> tableNamesValidation=new ArrayList<String>();
  String adminTableNames[]={"tb_3","newtab_3","tb_2","tb_1"};
  String user1TableNames[]={"newtab_3"};
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  createTabs(statement,DB1,tableNames);
  ResultSet rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(adminTableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
  policyFile.addRolesToGroup(USERGROUP1,"tab_priv").addPermissionsToRole("tab_priv","server=server1->db=" + DB1 + "->table="+ tableNames[3]+ "->action=insert").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(user1TableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin create few dbs
 * 2. admin can do show databases
 * 3. users with db level permissions should only those dbs on 'show database'
 */
@Test public void testShowDatabases1() throws Exception {
  List<String> dbNamesValidation=new ArrayList<String>();
  String[] dbNames={DB1,DB2,DB3};
  String[] user1DbNames={DB1};
  createDb(ADMIN1,dbNames);
  dbNamesValidation.addAll(Arrays.asList(dbNames));
  dbNamesValidation.add("default");
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet rs=statement.executeQuery("SHOW DATABASES");
  validateDBs(rs,dbNamesValidation);
  rs.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all").addPermissionsToRole("db1_all","server=server1->db=" + DB1).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  rs=statement.executeQuery("SHOW DATABASES");
  dbNamesValidation.addAll(Arrays.asList(user1DbNames));
  dbNamesValidation.add("default");
  validateDBs(rs,dbNamesValidation);
  rs.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin create db_1 and tables
 * 2. admin should see all tables
 * 3. user1 should only see the all tables with db level privilege
 */
@Test public void testShowTables2() throws Exception {
  String tableNames[]={"tb_1","tb_2","tb_3","tb_4"};
  List<String> tableNamesValidation=new ArrayList<String>();
  String user1TableNames[]={"tb_1","tb_2","tb_3","tb_4"};
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  createTabs(statement,DB1,tableNames);
  ResultSet rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(tableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
  policyFile.addRolesToGroup(USERGROUP1,"db_priv").addPermissionsToRole("db_priv","server=server1->db=" + DB1).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(user1TableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin create db_1 and db_1.tb_1
 * 2. admin should see all tables
 * 3. user1 should only see the tables with db level privilege
 */
@Test public void testShowTables4() throws Exception {
  String tableNames[]={"tb_1","tb_2","tb_3","newtab_3"};
  List<String> tableNamesValidation=new ArrayList<String>();
  String adminTableNames[]={"tb_3","newtab_3","tb_1","tb_2"};
  String user1TableNames[]={"tb_3","newtab_3","tb_1","tb_2"};
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  createTabs(statement,DB1,tableNames);
  ResultSet rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(adminTableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
  policyFile.addRolesToGroup(USERGROUP1,"tab_priv").addPermissionsToRole("tab_priv","server=server1->db=" + DB1).setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  rs=statement.executeQuery("SHOW TABLES");
  tableNamesValidation.addAll(Arrays.asList(user1TableNames));
  validateTables(rs,DB1,tableNamesValidation);
  statement.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin create few dbs
 * 2. admin can do show databases
 * 3. users with table level permissions should should only those parent dbs on 'show
 * database'
 */
@Test public void testShowDatabases2() throws Exception {
  String[] dbNames={DB1,DB2,DB3};
  List<String> dbNamesValidation=new ArrayList<String>();
  String[] user1DbNames={DB1,DB2};
  String tableNames[]={"tb_1"};
  createDb(ADMIN1,dbNames);
  dbNamesValidation.addAll(Arrays.asList(dbNames));
  dbNamesValidation.add("default");
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  createTabs(statement,DB1,tableNames);
  createTabs(statement,DB2,tableNames);
  ResultSet rs=statement.executeQuery("SHOW DATABASES");
  validateDBs(rs,dbNamesValidation);
  rs.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_tab,db2_tab").addPermissionsToRole("db1_tab","server=server1->db=" + DB1 + "->table=tb_1->action=select").addPermissionsToRole("db2_tab","server=server1->db=" + DB2 + "->table=tb_1->action=insert").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  rs=statement.executeQuery("SHOW DATABASES");
  dbNamesValidation.addAll(Arrays.asList(user1DbNames));
  dbNamesValidation.add("default");
  validateDBs(rs,dbNamesValidation);
  rs.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps: 1. admin create db_1 and tb_1, tb_2, tb_3, tb_4 and table_5
 * 2. admin should see all tables except table_5 which does not match tb
 * 3. user1 should only see the matched tables it has any level of privilege
 */
@Test public void testShowTablesExtended() throws Exception {
  String tableNames[]={"tb_1","tb_2","tb_3","tb_4","table_5"};
  List<String> tableNamesValidation=new ArrayList<String>();
  String user1TableNames[]={"tb_1","tb_2","tb_3"};
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  createTabs(statement,DB1,tableNames);
  policyFile.addRolesToGroup(USERGROUP1,"tab1_priv,tab2_priv,tab3_priv").addPermissionsToRole("tab1_priv","server=server1->db=" + DB1 + "->table="+ tableNames[0]+ "->action=select").addPermissionsToRole("tab2_priv","server=server1->db=" + DB1 + "->table="+ tableNames[1]+ "->action=insert").addPermissionsToRole("tab3_priv","server=server1->db=" + DB1 + "->table="+ tableNames[2]+ "->action=select").setUserGroupMapping(StaticUserGroup.getStaticMapping());
  writePolicyFile(policyFile);
  ResultSet rs=statement.executeQuery("SHOW TABLE EXTENDED IN " + DB1 + " LIKE 'tb*'");
  tableNamesValidation.addAll(Arrays.asList(tableNames).subList(0,4));
  validateTablesInRs(rs,DB1,tableNamesValidation);
  statement.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  rs=statement.executeQuery("SHOW TABLE EXTENDED IN " + DB1 + " LIKE 'tb*'");
  tableNamesValidation.addAll(Arrays.asList(user1TableNames));
  validateTablesInRs(rs,DB1,tableNamesValidation);
  statement.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestSandboxOps </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Positive and negative tests for INSERT OVERWRITE [LOCAL] DIRECTORY and
 * LOAD DATA [LOCAL] INPATH. EXPORT/IMPORT are handled in separate junit class.
 * Formerly testSandboxOpt18
 */
@Test public void testInsertOverwriteAndLoadData() throws Exception {
  long counter=System.currentTimeMillis();
  File allowedDir=assertCreateDir(new File(baseDir,"test-" + (counter++)));
  File restrictedDir=assertCreateDir(new File(baseDir,"test-" + (counter++)));
  Path allowedDfsDir=dfs.assertCreateDir("test-" + (counter++));
  Path restrictedDfsDir=dfs.assertCreateDir("test-" + (counter++));
  baseDir.setWritable(true,false);
  createDb(ADMIN1,DB1);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  policyFile.addRolesToGroup(USERGROUP1,"all_db1","load_data").addPermissionsToRole("all_db1","server=server1->db=" + DB1).addPermissionsToRole("load_data","server=server1->uri=file://" + allowedDir.getPath() + ", server=server1->uri=file://"+ allowedDir.getPath()+ ", server=server1->uri="+ allowedDfsDir.toString());
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("INSERT OVERWRITE LOCAL DIRECTORY 'file://" + allowedDir.getPath() + "' SELECT * FROM "+ TBL1);
  statement.execute("INSERT OVERWRITE DIRECTORY '" + allowedDfsDir + "' SELECT * FROM "+ TBL1);
  statement.execute("LOAD DATA LOCAL INPATH 'file://" + allowedDir.getPath() + "' INTO TABLE "+ TBL1);
  statement.execute("LOAD DATA INPATH '" + allowedDfsDir + "' INTO TABLE "+ TBL1);
  context.assertAuthzException(statement,"INSERT OVERWRITE LOCAL DIRECTORY 'file://" + restrictedDir.getPath() + "' SELECT * FROM "+ TBL1);
  context.assertAuthzException(statement,"INSERT OVERWRITE DIRECTORY '" + restrictedDfsDir + "' SELECT * FROM "+ TBL1);
  context.assertAuthzException(statement,"LOAD DATA INPATH 'file://" + restrictedDir.getPath() + "' INTO TABLE "+ TBL1);
  context.assertAuthzException(statement,"LOAD DATA LOCAL INPATH 'file://" + restrictedDir.getPath() + "' INTO TABLE "+ TBL1);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test Case 2.16 admin user create a new database DB_1 create TABLE_1 and
 * TABLE_2 (same schema) in DB_1 admin user grant SELECT, INSERT to user1's
 * group on TABLE_2 negative test case: user1 try to do following on TABLE_1
 * will fail: --insert overwrite TABLE_2 select * from TABLE_1
 */
@Test public void testNegativeUserDMLPrivileges() throws Exception {
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  adminStmt.execute("create table table_1 (id int)");
  adminStmt.execute("create table table_2 (id int)");
  adminStmt.close();
  adminCon.close();
  policyFile.addPermissionsToRole("db1_tab2_all","server=server1->db=" + DB1 + "->table=table_2").addRolesToGroup(USERGROUP1,"db1_tab2_all");
  writePolicyFile(policyFile);
  Connection userConn=context.createConnection(USER1_1);
  Statement userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  context.assertAuthzException(userStmt,"insert overwrite table table_2 select * from table_1");
  context.assertAuthzException(userStmt,"insert overwrite directory '" + baseDir.getPath() + "' select * from table_1");
  userConn.close();
  userStmt.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test Case 2.17 Execution steps a) Admin user creates a new database DB_1,
 * b) Admin user grants ALL on DB_1 to group GROUP_1 c) User from GROUP_1
 * creates table TAB_1, TAB_2 in DB_1 d) Admin user grants SELECT on TAB_1 to
 * group GROUP_2
 * 1) verify users from GROUP_2 have only SELECT privileges on TAB_1. They
 * shouldn't be able to perform any operation other than those listed as
 * requiring SELECT in the privilege model.
 * 2) verify users from GROUP_2 can't perform queries involving join between
 * TAB_1 and TAB_2.
 * 3) verify users from GROUP_1 can't perform operations requiring ALL @
 * SERVER scope. Refer to list
 */
@Test public void testNegUserPrivilegesAll() throws Exception {
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  adminStmt.execute("create table table_1 (name string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table table_1");
  adminStmt.execute("create table table_2 (name string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table table_2");
  adminStmt.execute("create view v1 AS select * from table_1");
  adminStmt.execute("create table table_part_1 (name string) PARTITIONED BY (year INT)");
  adminStmt.execute("ALTER TABLE table_part_1 ADD PARTITION (year = 2012)");
  adminStmt.execute("ALTER TABLE table_1 SET TBLPROPERTIES (\"createTime\"=\"1375824555\")");
  adminStmt.close();
  adminCon.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all").addRolesToGroup(USERGROUP2,"db1_tab1_select").addPermissionsToRole("db1_tab1_select","server=server1->db=" + DB1 + "->table=table_1->action=select").addPermissionsToRole("db1_all","server=server1->db=" + DB1);
  writePolicyFile(policyFile);
  Connection userConn=context.createConnection(USER2_1);
  Statement userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  context.assertAuthzException(userStmt,"alter table table_2 add columns (id int)");
  context.assertAuthzException(userStmt,"drop database " + DB1);
  context.assertAuthzException(userStmt,"CREATE INDEX x ON TABLE table_1(name) AS 'org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler'");
  context.assertAuthzException(userStmt,"CREATE TEMPORARY FUNCTION strip AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFPrintf'");
  context.assertAuthzException(userStmt,"create table foo(id int)");
  context.assertAuthzException(userStmt,"create table c_tab_2 as select * from table_2");
  context.assertAuthzException(userStmt,"create table c_tab_1 as select * from table_1");
  context.assertAuthzException(userStmt,"ALTER DATABASE " + DB1 + " SET DBPROPERTIES ('foo' = 'bar')");
  context.assertAuthzException(userStmt,"ALTER VIEW v1 SET TBLPROPERTIES ('foo' = 'bar')");
  context.assertAuthzException(userStmt,"DROP VIEW IF EXISTS v1");
  context.assertAuthzException(userStmt,"create table table_5 (name string)");
  context.assertAuthzException(userStmt,"ALTER TABLE table_1  RENAME TO table_99");
  context.assertAuthzException(userStmt,"insert overwrite table table_2 select * from table_1");
  context.assertAuthzException(userStmt,"ALTER TABLE table_part_1 ADD IF NOT EXISTS PARTITION (year = 2012)");
  context.assertAuthzException(userStmt,"ALTER TABLE table_part_1 PARTITION (year = 2012) SET LOCATION '" + baseDir.getPath() + "'");
  context.assertAuthzException(userStmt,"ALTER TABLE table_1 SET TBLPROPERTIES (\"createTime\"=\"1375824555\")");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test Case 2.11 admin user create a new database DB_1 and grant ALL to
 * himself on DB_1 should work
 */
@Test public void testAdminDbPrivileges() throws Exception {
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  String tabName="admin_tab1";
  adminStmt.execute("create table " + tabName + "(c1 string)");
  adminStmt.execute("load data local inpath '" + dataFile.getPath() + "' into table "+ tabName);
  adminStmt.execute("select * from " + tabName);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Steps:
 * 1. admin user create databases, DB_1 and DB_2, no table or other
 * object in database
 * 2. admin grant all to user1's group on DB_1 and DB_2
 * positive test case:
 * a)user1 has the privilege to create table, load data,
 * drop table, create view, insert more data on both databases
 * b) user1 can switch between DB_1 and DB_2 without
 * exception negative test case:
 * c) user1 cannot drop database
 * 3. admin remove all to group1 on DB_2
 * positive test case:
 * d) user1 has the privilege to create view on tables in DB_1
 * negative test case:
 * e) user1 cannot create view on tables in DB_1 that select
 * from tables in DB_2
 * 4. admin grant select to group1 on DB_2.ta_2
 * positive test case:
 * f) user1 has the privilege to create view to select from
 * DB_1.tb_1 and DB_2.tb_2
 * negative test case:
 * g) user1 cannot create view to select from DB_1.tb_1
 * and DB_2.tb_3
 * @throws Exception
 */
@Test public void testSandboxOpt9() throws Exception {
  createDb(ADMIN1,DB1,DB2);
  policyFile.addPermissionsToRole(GROUP1_ROLE,ALL_DB1,ALL_DB2,loadData).addRolesToGroup(USERGROUP1,GROUP1_ROLE);
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  createTable(USER1_1,DB1,dataFile,TBL1);
  statement.execute("DROP VIEW IF EXISTS " + VIEW1);
  statement.execute("CREATE VIEW " + VIEW1 + " (value) AS SELECT value from "+ TBL1+ " LIMIT 10");
  createTable(USER1_1,DB2,dataFile,TBL2,TBL3);
  statement.execute("USE " + DB1);
  policyFile.removePermissionsFromRole(GROUP1_ROLE,ALL_DB2);
  writePolicyFile(policyFile);
  statement.execute("DROP VIEW IF EXISTS " + VIEW2);
  context.assertAuthzException(statement,"CREATE VIEW " + VIEW2 + " (value) AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
  statement.execute("DROP TABLE IF EXISTS " + TBL2);
  context.assertAuthzException(statement,"CREATE TABLE " + TBL2 + " AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
  context.assertAuthzException(statement,"CREATE TABLE " + DB2 + "."+ TBL2+ " AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
  policyFile.addPermissionsToRole(GROUP1_ROLE,SELECT_DB2_TBL2);
  writePolicyFile(policyFile);
  statement.execute("DROP VIEW IF EXISTS " + VIEW2);
  statement.execute("CREATE VIEW " + VIEW2 + " (value) AS SELECT value from "+ DB2+ "."+ TBL2+ " LIMIT 10");
  statement.execute("DROP VIEW IF EXISTS " + VIEW3);
  context.assertAuthzException(statement,"CREATE VIEW " + VIEW3 + " (value) AS SELECT value from "+ DB2+ "."+ TBL3+ " LIMIT 10");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * test create table as with cross database ref
 * @throws Exception
 */
@Test public void testSandboxOpt10() throws Exception {
  String rTab1="rtab_1";
  String rTab2="rtab_2";
  createDb(ADMIN1,DB1,DB2);
  createTable(ADMIN1,DB1,dataFile,TBL1);
  createTable(ADMIN1,DB2,dataFile,TBL2,TBL3);
  policyFile.addPermissionsToRole(GROUP1_ROLE,ALL_DB1,SELECT_DB2_TBL2,loadData).addRolesToGroup(USERGROUP1,GROUP1_ROLE);
  writePolicyFile(policyFile);
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE " + rTab1 + " AS SELECT * FROM "+ DB2+ "."+ TBL2);
  context.assertAuthzException(statement,"CREATE TABLE " + rTab2 + " AS SELECT * FROM "+ DB2+ "."+ TBL3);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPerDbPolicyOnDFS() throws Exception {
  File db2PolicyFileHandle=new File(baseDir.getPath(),DB2_POLICY_FILE);
  PolicyFile db2PolicyFile=new PolicyFile();
  db2PolicyFile.addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl2","server=server1->db=" + DB2 + "->table=tbl2->action=select").write(db2PolicyFileHandle);
  PolicyFiles.copyFilesToDir(fileSystem,dfs.getBaseDir(),db2PolicyFileHandle);
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("CREATE TABLE tbl1(B INT, A STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE tbl1");
  statement.execute("CREATE DATABASE " + DB2);
  statement.execute("USE " + DB2);
  statement.execute("CREATE TABLE tbl2(B INT, A STRING) " + " row format delimited fields terminated by '|'  stored as textfile");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE tbl2");
  statement.close();
  connection.close();
  policyFile.addRolesToGroup(USERGROUP1,"select_tbl1").addRolesToGroup(USERGROUP2,"select_tbl2").addPermissionsToRole("select_tbl1","server=server1->db=" + DB1 + "->table=tbl1->action=select").addDatabase(DB2,dfs.getBaseDir().toUri().toString() + "/" + DB2_POLICY_FILE);
  writePolicyFile(policyFile);
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB2);
  statement.execute("select * from tbl2");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestServerConfiguration </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that the required access configs are set by session hook
 */
@Test public void testAccessConfigRestrictions() throws Exception {
  context=createContext(properties);
  policyFile.setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  String testUser=USER1_1;
  verifyConfig(testUser,ConfVars.SEMANTIC_ANALYZER_HOOK.varname,HiveAuthzBindingSessionHook.SEMANTIC_HOOK);
  verifyConfig(testUser,ConfVars.HIVE_CAPTURE_TRANSFORM_ENTITY.varname,"true");
  verifyConfig(testUser,ConfVars.HIVE_SECURITY_COMMAND_WHITELIST.varname,"set");
  verifyConfig(testUser,ConfVars.SCRATCHDIRPERMISSION.varname,HiveAuthzBindingSessionHook.SCRATCH_DIR_PERMISSIONS);
  verifyConfig(testUser,HiveConf.ConfVars.HIVE_CONF_RESTRICTED_LIST.varname,HiveAuthzBindingSessionHook.ACCESS_RESTRICT_LIST);
  verifyConfig(testUser,HiveAuthzConf.HIVE_ACCESS_SUBJECT_NAME,testUser);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * hive.server2.enable.impersonation must be disabled
 */
@Test public void testImpersonationIsDisabled() throws Exception {
  properties.put(HiveServerFactory.ACCESS_TESTING_MODE,"false");
  properties.put("hive.server2.enable.impersonation","true");
  verifyInvalidConfigurationException(properties);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * hive.server2.authentication must be set to LDAP or KERBEROS
 */
@Test public void testAuthenticationIsStrong() throws Exception {
  properties.put(HiveServerFactory.ACCESS_TESTING_MODE,"false");
  properties.put("hive.server2.authentication","NONE");
  verifyInvalidConfigurationException(properties);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAddDeleteDFSRestriction() throws Exception {
  context=createContext(properties);
  policyFile.addRolesToGroup(USERGROUP1,"all_db1").addRolesToGroup(USERGROUP2,"select_tb1").addPermissionsToRole("select_tb1","server=server1->db=db_1->table=tbl_1->action=select").addPermissionsToRole("all_db1","server=server1->db=db_1").setUserGroupMapping(StaticUserGroup.getStaticMapping()).write(context.getPolicyFile());
  Connection connection=context.createConnection(USER1_1);
  Statement statement=context.createStatement(connection);
  context.assertAuthzException(statement,"ADD JAR /usr/lib/hive/lib/hbase.jar");
  context.assertAuthzException(statement,"ADD FILE /tmp/tt.py");
  context.assertAuthzException(statement,"DFS -ls");
  context.assertAuthzException(statement,"DELETE JAR /usr/lib/hive/lib/hbase.jar");
  context.assertAuthzException(statement,"DELETE FILE /tmp/tt.py");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUriPermissions </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAlterTableLocationPrivileges() throws Exception {
  String tabName="tab1";
  String tabDir=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + "/" + tabName;
  Connection userConn=null;
  Statement userStmt=null;
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  adminStmt.execute("CREATE TABLE " + tabName + " (id int)  PARTITIONED BY (dt string)");
  adminCon.close();
  policyFile.addRolesToGroup(USERGROUP1,"server1_all").addRolesToGroup(USERGROUP2,"db1_all, data_read").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("data_read","server=server1->URI=" + tabDir).addPermissionsToRole("server1_all","server=server1");
  writePolicyFile(policyFile);
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  userStmt.execute("ALTER TABLE " + tabName + " SET LOCATION '"+ tabDir+ "'");
  userConn.close();
  userConn=context.createConnection(USER1_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  userStmt.execute("ALTER TABLE " + tabName + " SET LOCATION '"+ tabDir+ "'");
  userConn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExternalTablePrivileges() throws Exception {
  Connection userConn=null;
  Statement userStmt=null;
  String dataDirPath="file://" + dataDir;
  String tableDir=dataDirPath + "/" + Math.random();
  baseDir.setWritable(true,false);
  dataDir.setWritable(true,false);
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.close();
  adminCon.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all","data_read").addRolesToGroup(USERGROUP2,"db1_all").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("data_read","server=server1->URI=" + dataDirPath);
  writePolicyFile(policyFile);
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  context.assertAuthzException(userStmt,"CREATE EXTERNAL TABLE extab1(id INT) LOCATION '" + tableDir + "'");
  context.assertAuthzException(userStmt,"CREATE TABLE extab1(id INT) LOCATION '" + tableDir + "'");
  userStmt.close();
  userConn.close();
  userConn=context.createConnection(USER1_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  userStmt.execute("CREATE EXTERNAL TABLE extab1(id INT) LOCATION '" + tableDir + "'");
  userStmt.execute("DROP TABLE extab1");
  userStmt.execute("CREATE TABLE extab1(id INT) LOCATION '" + tableDir + "'");
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAlterPartitionLocationPrivileges() throws Exception {
  String tabName="tab1";
  String newPartitionDir="foo";
  String tabDir=hiveServer.getProperty(HiveServerFactory.WAREHOUSE_DIR) + "/" + tabName+ "/"+ newPartitionDir;
  Connection userConn=null;
  Statement userStmt=null;
  Connection adminCon=context.createConnection(ADMIN1);
  Statement adminStmt=context.createStatement(adminCon);
  adminStmt.execute("use default");
  adminStmt.execute("CREATE DATABASE " + DB1);
  adminStmt.execute("use " + DB1);
  adminStmt.execute("CREATE TABLE " + tabName + " (id int) PARTITIONED BY (dt string)");
  adminCon.close();
  policyFile.addRolesToGroup(USERGROUP1,"db1_all","data_read").addRolesToGroup(USERGROUP2,"db1_all").addRolesToGroup(USERGROUP3,"db1_tab1_all","data_read").addPermissionsToRole("db1_all","server=server1->db=" + DB1).addPermissionsToRole("db1_tab1_all","server=server1->db=" + DB1 + "->table="+ tabName).addPermissionsToRole("data_read","server=server1->uri=" + tabDir);
  writePolicyFile(policyFile);
  userConn=context.createConnection(USER1_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  userStmt.execute("ALTER TABLE " + tabName + " ADD IF NOT EXISTS PARTITION (dt = '21-Dec-2012') "+ " LOCATION '"+ tabDir+ "'");
  userStmt.execute("ALTER TABLE " + tabName + " DROP PARTITION (dt = '21-Dec-2012')");
  userStmt.execute("ALTER TABLE " + tabName + " ADD PARTITION (dt = '21-Dec-2012') "+ " LOCATION '"+ tabDir+ "'");
  userStmt.execute("ALTER TABLE " + tabName + " PARTITION (dt = '21-Dec-2012') "+ " SET LOCATION '"+ tabDir+ "'");
  userConn.close();
  userConn=context.createConnection(USER2_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  context.assertAuthzException(userStmt,"ALTER TABLE " + tabName + " ADD PARTITION (dt = '22-Dec-2012') "+ " LOCATION '"+ tabDir+ "/foo'");
  userStmt.execute("ALTER TABLE " + tabName + " ADD PARTITION (dt = '22-Dec-2012')");
  userStmt.execute("ALTER TABLE " + tabName + " DROP PARTITION (dt = '22-Dec-2012')");
  userStmt.execute("ALTER TABLE " + tabName + " ADD IF NOT EXISTS PARTITION (dt = '22-Dec-2012')");
  userStmt.execute("ALTER TABLE " + tabName + " DROP PARTITION (dt = '22-Dec-2012')");
  userConn.close();
  userConn=context.createConnection(USER3_1);
  userStmt=context.createStatement(userConn);
  userStmt.execute("use " + DB1);
  userStmt.execute("ALTER TABLE " + tabName + " ADD PARTITION (dt = '22-Dec-2012') "+ " LOCATION '"+ tabDir+ "/foo'");
  userStmt.execute("ALTER TABLE " + tabName + " DROP PARTITION (dt = '21-Dec-2012')");
  userStmt.close();
  userConn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.hive.TestUserManagement </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Basic sanity test
 */
@Test public void testSanity() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP);
  writePolicyFile(policyFile);
  doCreateDbLoadDataDropDb("admin1","admin1");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests admin group does not infect non-admin group
 */
@Test public void testAdmin6() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addRolesToGroup("group1","non_admin_role").addPermissionsToRole("non_admin_role","server=server1->db=" + dbName).addGroupsToUser("user1","group1");
  writePolicyFile(policyFile);
  doCreateDbLoadDataDropDb("admin1","admin1");
  Connection connection=context.createConnection("user1");
  Statement statement=connection.createStatement();
  context.assertAuthzException(statement,"CREATE DATABASE " + dbName);
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests that user with two roles the most powerful role takes effect
 */
@Test public void testGroup2() throws Exception {
  policyFile=new PolicyFile();
  policyFile.addRolesToGroup("group1",ADMINGROUP,"analytics").addPermissionsToRole(ADMINGROUP,"server=server1").addPermissionsToRole("analytics","server=server1->db=" + dbName).addGroupsToUser("user1","group1").addGroupsToUser("user2","group1").addGroupsToUser("user3","group1");
  writePolicyFile(policyFile);
  doCreateDbLoadDataDropDb("user1","user1","user2","user3");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests that group names with special characters are handled correctly
 */
@Test public void testGroup6() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addRolesToGroup("group1~!@#$%^&*()+-","analytics","load_data").addPermissionsToRole("analytics","server=server1->db=" + dbName).addPermissionsToRole("load_data","server=server1->URI=file://" + dataFile.getPath()).addGroupsToUser("user1","group1~!@#$%^&*()+-").addGroupsToUser("user2","group1~!@#$%^&*()+-").addGroupsToUser("user3","group1~!@#$%^&*()+-");
  writePolicyFile(policyFile);
  doDropDb("admin1");
  for (  String user : new String[]{"user1","user2","user3"}) {
    doCreateDb("admin1");
    doCreateTableLoadData(user);
    doDropDb("admin1");
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests admin privileges allow admins to create/drop dbs
 */
@Test public void testAdmin1() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addGroupsToUser("admin2",ADMINGROUP).addGroupsToUser("admin3",ADMINGROUP);
  writePolicyFile(policyFile);
  doCreateDbLoadDataDropDb("admin1","admin1","admin2","admin3");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Negative case: Tests that when a user is removed
 * from the policy file their permissions have no effect
 */
@Test public void testAdmin3() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addGroupsToUser("admin2",ADMINGROUP).addGroupsToUser("admin3",ADMINGROUP);
  writePolicyFile(policyFile);
  doCreateDbLoadDataDropDb("admin1","admin1","admin2","admin3");
  policyFile.removeGroupsFromUser("admin1",ADMINGROUP).write(context.getPolicyFile());
  Connection connection=context.createConnection("admin1");
  Statement statement=connection.createStatement();
  context.assertAuthzException(statement,"CREATE DATABASE somedb");
  statement.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests that users in two groups work correctly
 */
@Test public void testAdmin5() throws Exception {
  policyFile=new PolicyFile();
  policyFile.addRolesToGroup("admin_group1",ADMINGROUP).addRolesToGroup("admin_group2",ADMINGROUP).addPermissionsToRole(ADMINGROUP,"server=server1").addGroupsToUser("admin1","admin_group1","admin_group2").addGroupsToUser("admin2","admin_group1","admin_group2").addGroupsToUser("admin3","admin_group1","admin_group2");
  writePolicyFile(policyFile);
  doCreateDbLoadDataDropDb("admin1","admin1","admin2","admin3");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests users can have same name as groups
 */
@Test public void testGroup5() throws Exception {
  policyFile=PolicyFile.setAdminOnServer1(ADMINGROUP);
  policyFile.addGroupsToUser("admin1",ADMINGROUP).addRolesToGroup("group1","non_admin_role","load_data").addPermissionsToRole("non_admin_role","server=server1->db=" + dbName).addPermissionsToRole("load_data","server=server1->URI=file://" + dataFile.getPath()).addGroupsToUser("group1","group1").addGroupsToUser("user2","group1").addGroupsToUser("user3","group1");
  writePolicyFile(policyFile);
  doDropDb("admin1");
  for (  String user : new String[]{"group1","user2","user3"}) {
    doCreateDb("admin1");
    doCreateTableLoadData(user);
    doDropDb("admin1");
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMrAclsSetting() throws Exception {
  Connection connection=context.createConnection("admin1");
  context.verifySessionConf(connection,JobContext.JOB_ACL_VIEW_JOB,"admin1");
  context.verifySessionConf(connection,JobContext.JOB_ACL_VIEW_JOB,"admin1");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests that user names with special characters are handled correctly
 */
@Test public void testGroup7() throws Exception {
  policyFile=new PolicyFile();
  policyFile.addRolesToGroup("group1",ADMINGROUP).addPermissionsToRole(ADMINGROUP,"server=server1").addGroupsToUser("user1~!#$%^&*()+-","group1").addGroupsToUser("user2","group1").addGroupsToUser("user3","group1");
  writePolicyFile(policyFile);
  doCreateDbLoadDataDropDb("user1~!#$%^&*()+-","user1~!#$%^&*()+-","user2","user3");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.metastore.TestMetastoreEndToEnd </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Verify data load into new partition using INSERT .. PARTITION statement
 */
@Test public void testPartionInsert() throws Exception {
  String partVal1="part1", partVal2="part2", partVal3="part5";
  policyFile.addRolesToGroup(USERGROUP1,uri_role).addPermissionsToRole(uri_role,"server=server1->uri=file://" + dataFile.getPath());
  writePolicyFile(policyFile);
  execHiveSQL("CREATE TABLE " + dbName + "."+ tabName1+ " (id int) PARTITIONED BY (part_col string)",USER1_1);
  execHiveSQL("CREATE TABLE " + dbName + "."+ tabName2+ " (id int)",USER1_1);
  execHiveSQL("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ dbName+ "."+ tabName2,USER1_1);
  execHiveSQL("INSERT OVERWRITE TABLE " + dbName + "."+ tabName1+ " PARTITION (part_col='"+ partVal1+ "') SELECT * FROM "+ dbName+ "."+ tabName2,USER1_1);
  verifyPartitionExists(dbName,tabName1,partVal1);
  execHiveSQL("INSERT OVERWRITE TABLE " + dbName + "."+ tabName1+ " PARTITION (part_col='"+ partVal2+ "') SELECT * FROM "+ dbName+ "."+ tabName2,USER2_1);
  verifyPartitionExists(dbName,tabName1,partVal2);
  Map<String,String> dynamicInsertProperties=Maps.newHashMap();
  dynamicInsertProperties.put(ConfVars.DYNAMICPARTITIONING.varname,"true");
  dynamicInsertProperties.put(ConfVars.DYNAMICPARTITIONINGMODE.varname,"nonstrict");
  execHiveSQL("CREATE TABLE " + dbName + "."+ tabName3+ " (id int) PARTITIONED BY (part_col string)",USER1_1);
  execHiveSQLwithOverlay("INSERT OVERWRITE TABLE " + dbName + "."+ tabName3+ " partition (part_col) SELECT id, part_col FROM "+ dbName+ "."+ tabName1,USER1_1,dynamicInsertProperties);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.TestDocLevelOperations </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test to validate doc level security on collections without perm for Index level auth.
 * @throws Exception
 */
@Test public void indexDocAuthTests() throws Exception {
  String collectionName="testIndexlevelDoclevelOperations";
  setupCollectionWithDocSecurity(collectionName);
  try {
    createDocsAndQuerySimple(collectionName,false);
    verifyQueryFail("junit",collectionName,ALL_DOCS);
    verifyQueryFail("docLevel",collectionName,ALL_DOCS);
  }
  finally {
    deleteCollection(collectionName);
  }
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateDeleteOperations() throws Exception {
  String collectionName="testUpdateDeleteOperations";
  setupCollectionWithDocSecurity(collectionName);
  try {
    createDocsAndQuerySimple(collectionName,true);
    deleteByQueryTest(collectionName,"junit","*:*","docLevel",0);
    deleteByQueryTest(collectionName,"junit","sentry_auth:docLevel_role","docLevel",0);
    deleteByIdTest(collectionName);
    updateDocsTest(collectionName);
  }
  finally {
    deleteCollection(collectionName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.TestUpdateOperations </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateDistribPhase() throws Exception {
  final String collectionName="testUpdateDistribPhase";
  final String userName="junit";
  uploadConfigDirToZk(RESOURCES_DIR + File.separator + DEFAULT_COLLECTION+ File.separator+ "conf");
  setupCollection(collectionName);
  setAuthenticationUser(userName);
  CloudSolrServer server=getCloudSolrServer(collectionName);
  try {
    checkUpdateDistribPhase(server,collectionName,userName,null);
    for (    DistribPhase phase : DistribPhase.values()) {
      checkUpdateDistribPhase(server,collectionName,userName,phase);
    }
  }
  finally {
    server.shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.db.integration.TestSolrAdminOperations </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAdminOperations() throws Exception {
  uploadConfigDirToZk(COLLECTION_CONFIG_DIR);
  verifyCollectionAdminOpPass(ADMIN_USER,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(ADMIN_USER,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  String grantor="user0";
  grantCollectionPrivilege(ADMIN_COLLECTION_NAME,ADMIN_USER,"role0",SearchConstants.ALL);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.ALL);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  revokeCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.UPDATE);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  grantor="user1";
  grantCollectionPrivilege(ADMIN_COLLECTION_NAME,ADMIN_USER,"role1",SearchConstants.UPDATE);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role1",SearchConstants.UPDATE);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  revokeCollectionPrivilege(ADMIN_COLLECTION_NAME,ADMIN_USER,"role1",SearchConstants.UPDATE);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  grantor="user2";
  grantCollectionPrivilege(ADMIN_COLLECTION_NAME,ADMIN_USER,"role2",SearchConstants.QUERY);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.QUERY);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.UPDATE);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  grantCollectionPrivilege(ADMIN_COLLECTION_NAME,ADMIN_USER,"role2",SearchConstants.UPDATE);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  grantor="user3";
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpFail(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
  grantCollectionPrivilege(ADMIN_COLLECTION_NAME,ADMIN_USER,"role3",SearchConstants.ALL);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role3",SearchConstants.ALL);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATE,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.RELOAD,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.CREATEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETEALIAS,TEST_COLLECTION_NAME1);
  verifyCollectionAdminOpPass(grantor,CollectionAction.DELETE,TEST_COLLECTION_NAME1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.db.integration.TestSolrDocLevelOperations </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test to validate doc level security on collections without perm for Index level auth.
 * @throws Exception
 */
@Test public void indexDocAuthTests() throws Exception {
  setupCollectionWithDocSecurity(TEST_COLLECTION_NAME1);
  try {
    createDocument(TEST_COLLECTION_NAME1);
    verifyQueryFail("user0",TEST_COLLECTION_NAME1,ALL_DOCS);
    verifyQueryFail("user1",TEST_COLLECTION_NAME1,ALL_DOCS);
    verifyQueryFail("user2",TEST_COLLECTION_NAME1,ALL_DOCS);
    verifyQueryFail("user3",TEST_COLLECTION_NAME1,ALL_DOCS);
  }
  finally {
    deleteCollection(TEST_COLLECTION_NAME1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.db.integration.TestSolrQueryOperations </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testQueryOperations() throws Exception {
  uploadConfigDirToZk(COLLECTION_CONFIG_DIR);
  setupCollection(TEST_COLLECTION_NAME1);
  cleanSolrCollection(TEST_COLLECTION_NAME1);
  SolrInputDocument solrInputDoc=createSolrTestDoc();
  uploadSolrDoc(TEST_COLLECTION_NAME1,solrInputDoc);
  String grantor="user0";
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.ALL);
  verifyQueryPass(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  revokeCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.UPDATE);
  verifyQueryPass(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  revokeCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.QUERY);
  verifyQueryFail(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  grantor="user1";
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role1",SearchConstants.QUERY);
  verifyQueryPass(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  revokeCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role1",SearchConstants.QUERY);
  verifyQueryFail(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  grantor="user2";
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.UPDATE);
  verifyQueryFail(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.QUERY);
  verifyQueryPass(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  client.renamePrivilege(ADMIN_USER,COMPONENT_SOLR,CLUSTER_NAME,Lists.newArrayList(new Collection(TEST_COLLECTION_NAME1)),Lists.newArrayList(new Collection("new_" + TEST_COLLECTION_NAME1)));
  verifyQueryFail(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  grantor="user3";
  verifyQueryFail(grantor,TEST_COLLECTION_NAME1,ALL_DOCS);
  deleteCollection(TEST_COLLECTION_NAME1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.sentry.tests.e2e.solr.db.integration.TestSolrUpdateOperations </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateOperations() throws Exception {
  uploadConfigDirToZk(COLLECTION_CONFIG_DIR);
  setupCollection(TEST_COLLECTION_NAME1);
  cleanSolrCollection(TEST_COLLECTION_NAME1);
  SolrInputDocument solrInputDoc=createSolrTestDoc();
  String grantor="user0";
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role0",SearchConstants.ALL);
  cleanSolrCollection(TEST_COLLECTION_NAME1);
  verifyUpdatePass(grantor,TEST_COLLECTION_NAME1,solrInputDoc);
  verifyDeletedocsPass(grantor,TEST_COLLECTION_NAME1,false);
  dropCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER);
  verifyUpdateFail(grantor,TEST_COLLECTION_NAME1,solrInputDoc);
  uploadSolrDoc(TEST_COLLECTION_NAME1,solrInputDoc);
  verifyDeletedocsFail(grantor,TEST_COLLECTION_NAME1,false);
  grantor="user1";
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role1",SearchConstants.UPDATE);
  cleanSolrCollection(TEST_COLLECTION_NAME1);
  verifyUpdatePass(grantor,TEST_COLLECTION_NAME1,solrInputDoc);
  verifyDeletedocsPass(grantor,TEST_COLLECTION_NAME1,false);
  revokeCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role1",SearchConstants.ALL);
  verifyUpdateFail(grantor,TEST_COLLECTION_NAME1,solrInputDoc);
  uploadSolrDoc(TEST_COLLECTION_NAME1,solrInputDoc);
  verifyDeletedocsFail(grantor,TEST_COLLECTION_NAME1,false);
  grantor="user2";
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.QUERY);
  cleanSolrCollection(TEST_COLLECTION_NAME1);
  verifyUpdateFail(grantor,TEST_COLLECTION_NAME1,solrInputDoc);
  uploadSolrDoc(TEST_COLLECTION_NAME1,solrInputDoc);
  verifyDeletedocsFail(grantor,TEST_COLLECTION_NAME1,false);
  grantCollectionPrivilege(TEST_COLLECTION_NAME1,ADMIN_USER,"role2",SearchConstants.ALL);
  cleanSolrCollection(TEST_COLLECTION_NAME1);
  verifyUpdatePass(grantor,TEST_COLLECTION_NAME1,solrInputDoc);
  verifyDeletedocsPass(grantor,TEST_COLLECTION_NAME1,false);
  grantor="user3";
  cleanSolrCollection(TEST_COLLECTION_NAME1);
  verifyUpdateFail(grantor,TEST_COLLECTION_NAME1,solrInputDoc);
  uploadSolrDoc(TEST_COLLECTION_NAME1,solrInputDoc);
  verifyDeletedocsFail(grantor,TEST_COLLECTION_NAME1,false);
  deleteCollection(TEST_COLLECTION_NAME1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.TestSecureAnalysisHandlers </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDocumentAnalysisRequestHandler() throws Exception {
  SolrRequestHandler handler=core.getRequestHandler("/analysis/document");
  verifyQueryAccess(handler);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSecureFieldAnalysisRequestHandler() throws Exception {
  SolrRequestHandler handler=core.getRequestHandler("/analysis/field");
  verifyQueryAccess(handler);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.TestSecureReplicationHandler </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSecureReplicationHandler() throws Exception {
  SolrRequestHandler handler=core.getRequestHandler("/replication");
  verifyAuthorized(handler,prepareCollAndUser(core,getRequest(),"collection1","junit",false));
  verifyUnauthorized(handler,prepareCollAndUser(core,getRequest(),"queryCollection","junit",false),"queryCollection","junit");
  verifyUnauthorized(handler,prepareCollAndUser(core,getRequest(),"bogusCollection","junit",false),"bogusCollection","junit");
  verifyUnauthorized(handler,prepareCollAndUser(core,getRequest(),"updateCollection","junit",false),"updateCollection","junit");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.admin.SecureAdminHandlersTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSecureAdminHandlers() throws Exception {
  verifyLuke();
  verifyMBeans();
  verifyPlugins();
  verifyThreads();
  verifyProperties();
  verifyLogging();
  verifyFile();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.admin.SecureCollectionsHandlerTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSecureCollectionsHandler() throws Exception {
  for (  CollectionAction action : CollectionAction.values()) {
    verifyUpdateAccess(action);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.admin.SecureCoreAdminHandlerTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSecureAdminHandler() throws Exception {
  for (  CoreAdminAction action : QUERY_ACTIONS) {
    verifyQueryAccess(action,!NO_CHECK_COLLECTIONS.contains(action));
  }
  for (  CoreAdminAction action : UPDATE_ACTIONS) {
    verifyUpdateAccess(action,!NO_CHECK_COLLECTIONS.contains(action));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.admin.SecureInfoHandlerTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSecureInfoHandlers() throws Exception {
  verifyThreadDumpHandler();
  verifyPropertiesHandler();
  verifyLoggingHandler();
  verifySystemInfoHandler();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.component.QueryDocAuthorizationComponentTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAllRolesToken() throws Exception {
  NamedList args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  ResponseBuilder builder=runComponent("junit",args,null);
  String expect=getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"junit_role");
  checkParams(new String[]{expect},builder);
  args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  args.add(QueryDocAuthorizationComponent.ALL_ROLES_TOKEN_PROP,"");
  builder=runComponent("junit",args,null);
  expect=getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"junit_role");
  checkParams(new String[]{expect},builder);
  String allRolesToken="specialAllRolesToken";
  args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  args.add(QueryDocAuthorizationComponent.ALL_ROLES_TOKEN_PROP,allRolesToken);
  builder=runComponent("junit",args,null);
  expect=getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"junit_role") + getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,allRolesToken);
  checkParams(new String[]{expect},builder);
  builder=runComponent("multiGroupUser",args,null);
  expect=getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"junit_role") + getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"queryOnlyAdmin_role") + getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"updateOnlyAdmin_role")+ getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,allRolesToken);
  checkParams(new String[]{expect},builder);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnabled() throws Exception {
  NamedList args=new NamedList();
  ResponseBuilder builder=runComponent("junit",args,null);
  checkParams(null,builder);
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"false");
  builder=runComponent("junit",args,null);
  checkParams(null,builder);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMultipleRoles() throws Exception {
  NamedList args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  ResponseBuilder builder=runComponent("multiGroupUser",args,null);
  String expect=getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"junit_role") + getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"queryOnlyAdmin_role") + getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"updateOnlyAdmin_role");
  checkParams(new String[]{expect},builder);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExistingFilterQuery() throws Exception {
  ModifiableSolrParams newParams=new ModifiableSolrParams();
  String existingFq="bogusField:(bogusUser)";
  newParams.add("fq",existingFq);
  NamedList args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  ResponseBuilder builder=runComponent("junit",args,newParams);
  String expect=getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"junit_role");
  checkParams(new String[]{existingFq,expect},builder);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSimple() throws Exception {
  NamedList args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  ResponseBuilder builder=runComponent("junit",args,null);
  String expect=getClause(QueryDocAuthorizationComponent.DEFAULT_AUTH_FIELD,"junit_role");
  checkParams(new String[]{expect},builder);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSuperUser() throws Exception {
  String superUser=(System.getProperty("solr.authorization.superuser","solr"));
  NamedList args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  ResponseBuilder builder=runComponent(superUser,args,null);
  prepareCollAndUser(core,builder.req,"collection1",superUser);
  checkParams(null,builder);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testAuthFieldNonDefault() throws Exception {
  String authField="nonDefaultAuthField";
  NamedList args=new NamedList();
  args.add(QueryDocAuthorizationComponent.ENABLED_PROP,"true");
  args.add(QueryDocAuthorizationComponent.AUTH_FIELD_PROP,authField);
  ResponseBuilder builder=runComponent("junit",args,null);
  String expect=getClause(authField,"junit_role");
  checkParams(new String[]{expect},builder);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.handler.component.QueryIndexAuthorizationComponentTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the QueryIndexAuthorizationComponent on a collection that
 * the user has QUERY only access
 */
@Test public void testQueryComponentAccessQuery() throws Exception {
  ResponseBuilder responseBuilder=getResponseBuilder();
  prepareCollAndUser(core,responseBuilder.req,"queryCollection","junit");
  QueryIndexAuthorizationComponent query=new QueryIndexAuthorizationComponent(sentryInstance);
  query.prepare(responseBuilder);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the QueryIndexAuthorizationComponent on a collection that
 * the user has no access
 */
@Test public void testQueryComponentAccessNone() throws Exception {
  doExpectComponentUnauthorized(new QueryIndexAuthorizationComponent(sentryInstance),"noAccessCollection","junit");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the QueryIndexAuthorizationComponent on a collection that
 * the user has UPDATE only access
 */
@Test public void testQueryComponentAccessUpdate() throws Exception {
  doExpectComponentUnauthorized(new QueryIndexAuthorizationComponent(sentryInstance),"updateCollection","junit");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the QueryIndexAuthorizationComponent on a collection that
 * the user has ALL access
 */
@Test public void testQueryComponentAccessAll() throws Exception {
  ResponseBuilder responseBuilder=getResponseBuilder();
  prepareCollAndUser(core,responseBuilder.req,"collection1","junit");
  QueryIndexAuthorizationComponent query=new QueryIndexAuthorizationComponent(sentryInstance);
  query.prepare(responseBuilder);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.sentry.SentryIndexAuthorizationSingletonTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNoHttpRequest() throws Exception {
  SolrQueryRequest request=getRequest();
  doExpectUnauthorized(request,null,"HttpServletRequest");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * User name matches super user, should have access otherwise
 */
@Test public void testSuperUserAccess() throws Exception {
  System.setProperty("solr.authorization.superuser","junit");
  SolrQueryRequest request=getRequest();
  prepareCollAndUser(core,request,"collection1","junit");
  sentryInstance.authorizeCollectionAction(request,EnumSet.of(SearchModelAction.ALL),OPERATION_NAME);
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEmptySuperUser() throws Exception {
  System.setProperty("solr.authorization.superuser","");
  SolrQueryRequest request=getRequest();
  prepareCollAndUser(core,request,"collection1","solr");
  doExpectExceptionWithoutGroup(sentryInstance,request,EnumSet.of(SearchModelAction.ALL));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNullUserName() throws Exception {
  SolrQueryRequest request=getRequest();
  prepareCollAndUser(core,request,"collection1",null);
  doExpectExceptionWithoutGroup(sentryInstance,request,EnumSet.of(SearchModelAction.ALL));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * User name matches super user, should not have access otherwise
 */
@Test public void testSuperUserNoAccess() throws Exception {
  System.setProperty("solr.authorization.superuser","junit");
  SolrQueryRequest request=getRequest();
  prepareCollAndUser(core,request,"bogusCollection","junit");
  sentryInstance.authorizeCollectionAction(request,EnumSet.of(SearchModelAction.ALL),OPERATION_NAME);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.solr.update.processor.UpdateIndexAuthorizationProcessorTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the UpdateIndexAuthorizationComponent on a collection that
 * the user has no access
 */
@Test public void testUpdateComponentAccessNone() throws Exception {
  verifyUnauthorized("noAccessCollection","junit");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the UpdateIndexAuthorizationComponent on a collection that
 * the user has ALL access
 */
@Test public void testUpdateComponentAccessAll() throws Exception {
  verifyAuthorized("collection1","junit");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the UpdateIndexAuthorizationComponent on a collection that
 * the user has QUERY only access
 */
@Test public void testUpdateComponentAccessQuery() throws Exception {
  verifyUnauthorized("queryCollection","junit");
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test the UpdateIndexAuthorizationComponent on a collection that
 * the user has UPDATE only access
 */
@Test public void testUpdateComponentAccessUpdate() throws Exception {
  verifyAuthorized("updateCollection","junit");
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
