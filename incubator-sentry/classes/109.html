<h3 style="margin:0px">Class: org.apache.sentry.tests.e2e.dbprovider.TestDatabaseProvider (32 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="19"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('19')" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements"><kbd id="tag-19"class="label-info"style="display: inline-block;font-size:7pt" >ConditionMatcher&nbsp;(13)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="17"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('17')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-17"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(5)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="18"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('18')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-18"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Create and Drop role by admin
 * @throws Exception
 */
@Test public void testCreateDropRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW roles");
  List<String> expected=new ArrayList<String>();
  expected.add("role1");
  expected.add("admin_role");
  assertTestRoles(resultSet,expected,true);
  statement.execute("DROP ROLE role1");
  resultSet=statement.executeQuery("SHOW roles");
  expected.clear();
  expected.add("admin_role");
  assertTestRoles(resultSet,expected,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Verify 'SHOW CURRENT ROLES' show all roles for the give user when there no
 * 'SET ROLE' called
 * @throws Exception
 */
@Test public void testShowAllCurrentRoles() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  String testRole1="role1", testRole2="role2";
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("CREATE ROLE " + testRole2);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole2 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ USERGROUP1);
  statement.execute("GRANT ROLE " + testRole2 + " TO GROUP "+ USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  List<String> expected=new ArrayList<>();
  expected.add("admin_role");
  expected.add(testRole1);
  expected.add(testRole2);
  assertTestRoles(resultSet,expected,true);
  statement.execute("SET ROLE " + testRole1);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  expected.clear();
  expected.add(testRole1);
  assertTestRoles(resultSet,expected,true);
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  assertResultSize(resultSet,0);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  expected.clear();
  expected.add(testRole1);
  expected.add(testRole2);
  assertTestRoles(resultSet,expected,false);
  statement.execute("SET ROLE " + testRole2);
  resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  expected.clear();
  expected.add(testRole2);
  assertTestRoles(resultSet,expected,false);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void serverActions() throws Exception {
  String[] dbs={DB1,DB2};
  String tbl=TBL1;
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE server_all");
  statement.execute("CREATE ROLE server_select");
  statement.execute("CREATE ROLE server_insert");
  statement.execute("GRANT ALL ON SERVER server1 to ROLE server_all");
  statement.execute("GRANT SELECT ON SERVER server1 to ROLE server_select");
  statement.execute("GRANT INSERT ON SERVER server1 to ROLE server_insert");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE server_select");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE server_insert");
  statement.execute("GRANT ROLE server_all to GROUP " + ADMINGROUP);
  statement.execute("GRANT ROLE server_select to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE server_insert to GROUP " + USERGROUP2);
  for (  String db : dbs) {
    statement.execute("CREATE DATABASE IF NOT EXISTS " + db);
    statement.execute("CREATE TABLE IF NOT EXISTS " + db + "."+ tbl+ "(a String)");
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  for (  String db : dbs) {
    statement.execute("SELECT * FROM " + db + "."+ tbl);
    try {
      statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ db+ "."+ tbl);
      assertTrue("INSERT should not be capable here:",true);
    }
 catch (    SQLException e) {
    }
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  for (  String db : dbs) {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ db+ "."+ tbl);
    try {
      statement.execute("SELECT * FROM " + db + "."+ tbl);
    }
 catch (    SQLException e) {
    }
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE SELECT ON SERVER server1 from ROLE server_select");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + dbs[0] + "."+ tbl);
    assertTrue("Revoke Select on server Failed",false);
  }
 catch (  SQLException e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke insert on table after:
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeINSERTOnTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE INSERT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON SERVER serverName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleObObjectGivenServer() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE default");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCaseSensitiveGroupNames() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet resultSet;
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + ADMINGROUP);
  List<String> expected=new ArrayList<>();
  assertTestRoles(resultSet,expected,false);
  String testRole1="role1";
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ ADMINGROUP);
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + ADMINGROUP);
  expected.clear();
  expected.add(testRole1);
  assertTestRoles(resultSet,expected,false);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP Admin",SentryNoSuchObjectException.class.getSimpleName());
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testGrantINSERTonDb() throws Exception {
  File dataFile=doSetupForGrantDbTests();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("GRANT INSERT ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t2");
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("only SELECT allowed on t1!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    assertTrue("only INSERT allowed on t2!!",false);
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-10 type-19 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON URI uriName: Needs Hive patch
 * @throws Exception
 */
@Ignore @Test public void testShowPrivilegesByRoleOnUri() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON URI 'file:///tmp/file.txt'");
  assertTrue("Expecting SQL Exception",false);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW ROLES
 * @throws Exception3.1. When there are no roles, returns empty list
 * 3.2. When there are roles, returns correct list with correct schema.
 */
@Test public void testShowRoles() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW ROLES");
  List<String> expected=new ArrayList<>();
  expected.add("admin_role");
  assertTestRoles(resultSet,expected,true);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  resultSet=statement.executeQuery("SHOW ROLES");
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(1));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  expected.add("role1");
  expected.add("role2");
  assertTestRoles(resultSet,expected,true);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke select on table after:
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeSELECTOnTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE SELECT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke all on table after:
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeAllOnTable() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE ALL ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),1);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void testUriWithEquals() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON URI 'file:///tmp/partition=value/file.txt' TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file:///tmp/partition=value/file.txt"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON TABLE tableName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenTable() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string)");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * SENTRY-299
 * 1. Create 2 Roles (user_role & user_role2)
 * 2. Create a Table t1
 * 3. grant ALL on t1 to user_role
 * 4. grant INSERT on t1 to user_role2
 * 5. Revoke INSERT on t1 from user_role
 * - This would imply user_role can still SELECT
 * - But user_role should NOT be allowed to LOAD
 * 6. Ensure Presense of another role will still enforce the revoke
 * @throws Exception
 */
@Test public void testRevokeFailAnotherRoleExist() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("CREATE ROLE user_role2");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role2");
  statement.execute("GRANT ALL ON URI \"file://" + dataFile.getPath() + "\" TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role2");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role2");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE user_role2 TO GROUP " + USERGROUP2);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE INSERT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT Should Not be allowed since we Revoked INSERT privileges on the table !!",false);
  }
 catch (  Exception e) {
  }
 finally {
    statement.close();
    connection.close();
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,2);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON COLUMN colName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenColumn() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t2(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t3(c1 string, c2 int)");
  statement.execute("CREATE TABLE IF NOT EXISTS t4(c1 string, c2 int)");
  statement.execute("GRANT SELECT (c1) ON TABLE t1 TO ROLE role1");
  statement.execute("GRANT SELECT (c2) ON TABLE t2 TO ROLE role1");
  statement.execute("GRANT SELECT (c1,c2) ON TABLE t3 TO ROLE role1");
  statement.execute("GRANT SELECT (c1,c2) ON TABLE t4 TO ROLE role1 with grant option");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1 (c1)");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t2 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t2"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t3 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t3"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t3 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t3"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t4 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t4"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("True")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t4 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("t4"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("c2"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("True")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  assertThat(rowCount,is(1));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t1 (c2)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE t2 (c1)");
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * SENTRY-302
 * 1. Create Role user_role
 * 2. Create a Table t1
 * 3. grant ALL on t1 to user_role
 * 4. grant INSERT on t1 to user_role
 * 5. Revoke INSERT on t1 from user_role
 * - This would imply user_role can still SELECT
 * - But user_role should NOT be allowed to LOAD
 * 6. Ensure INSERT is revoked on table
 * @throws Exception
 */
@Test public void testRevokeFailMultipleGrantsExist() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE INSERT ON TABLE t1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT Should Not be allowed since we Revoked INSERT privileges on the table !!",false);
  }
 catch (  Exception e) {
  }
 finally {
    statement.close();
    connection.close();
  }
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),2);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName ON DATABASE databaseName
 * @throws Exception
 */
@Test public void testShowPrivilegesByRoleOnObjectGivenDatabase() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON DATABASE default TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON TABLE tab1");
  int rowCount=0;
  while (resultSet.next()) {
    rowCount++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE default");
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1 ON DATABASE " + DB1);
  rowCount=0;
  while (resultSet.next()) {
    rowCount++;
  }
  assertThat(rowCount,is(0));
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRevokeDbALLAfterGrantTable() throws Exception {
  doSetup();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("REVOKE ALL ON DATABASE " + DB1 + " from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM t1");
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    assertTrue("SELECT should not be allowed after revoke on parent!!",false);
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,1);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGrantDuplicateonDb() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON DATABASE db1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON DATABASE DB1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON DATABASE Db1 TO ROLE user_role");
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke all on database after:
 * - grant all on db
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 */
@Test public void testRevokeAllOnDb() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),3);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE ALL ON DATABASE " + DB1 + " from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),1);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBasic() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP TABLE t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"CREATE ROLE r2",SentryAccessDeniedException.class.getSimpleName());
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE user_role");
  statement.execute("SELECT * FROM t1");
  statement.execute("SET ROLE NONE");
  context.assertAuthzException(statement,"SELECT * FROM t1");
  statement.execute("SET ROLE ALL");
  statement.execute("SELECT * FROM t1");
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. When there are no roles and group, throws SentryNoSuchObjectException
 * 4.2. When there are roles, returns correct list with correct schema.
 */
@Test public void testShowRolesByGroup() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("CREATE ROLE role3");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(4));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  assertThat(resultSetMetaData.getColumnName(2),equalToIgnoringCase("grant_option"));
  assertThat(resultSetMetaData.getColumnName(3),equalToIgnoringCase("grant_time"));
  assertThat(resultSetMetaData.getColumnName(4),equalToIgnoringCase("grantor"));
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
    assertThat(resultSet.getBoolean(2),is(new Boolean("False")));
    assertThat(resultSet.getString(4),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Grant/Revoke privilege - Positive cases
 * @throws Exception1.1. All on server
 * 1.2. All on database
 * 1.3. All on URI
 * 1.4. All on table
 * 1.5. Insert on table
 * 1.6. Select on table
 * 1.7. Partial privileges on table
 * 1.7.1. Grant all, revoke insert leads to select on table
 * 1.7.2. Grant all, revoke select leads to select on table
 */
@Test public void testGrantRevokePrivileges() throws Exception {
  Connection connection;
  Statement statement;
  ResultSet resultSet;
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 to role role1");
  statement.execute("GRANT Role role1 to group " + ADMINGROUP);
  statement.execute("Create table tab1(col1 int)");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON SERVER server1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON DATABASE default to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON DATABASE default from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON URI 'file:///path' to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("file://path"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON URI 'file:///path' from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE ALL ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT INSERT ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("insert"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE INSERT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT SELECT ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE SELECT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT SELECT(col1) ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase("col1"));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("REVOKE SELECT(col1) ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("REVOKE INSERT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.execute("GRANT ALL ON TABLE tab1 to role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("REVOKE SELECT ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
    assertThat(resultSet.getString(2),equalToIgnoringCase("tab1"));
    assertThat(resultSet.getString(3),equalToIgnoringCase(""));
    assertThat(resultSet.getString(4),equalToIgnoringCase(""));
    assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
    assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
    assertThat(resultSet.getString(7),equalToIgnoringCase("insert"));
    assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
    assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-12 type-10 type-19 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * SHOW ROLE GRANT GROUP groupName
 * @throws Exception4.1. Show role grant works for non-admin users when the user belongs to the requested group
 * 4.2. Show role grant FAILS for non-admin users when the user doesn't belongs to the requested group
 */
@Test public void testShowRolesByGroupNonAdmin() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP2);
  statement.execute("GRANT ROLE role1 to GROUP " + ADMINGROUP);
  statement.execute("GRANT ROLE role2 to GROUP " + ADMINGROUP);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + ADMINGROUP,SentryAccessDeniedException.class.getSimpleName());
  ResultSet resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP2);
  assertTrue(resultSet.next());
  assertThat(resultSet.getString(1),equalToIgnoringCase("role2"));
  assertFalse(resultSet.next());
  statement.close();
  connection.close();
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW ROLE GRANT GROUP " + USERGROUP1,SentryAccessDeniedException.class.getSimpleName());
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW GRANT ROLE roleName
 * @throws Exception5.1. When there are no privileges granted to a role, returns an empty list
 * 5.2. When there are privileges, returns correct list with correct schema.
 * 5.3. Given privileges on table, show grant on table should return table privilege.
 * 5.4. Privileges on database
 * 5.4.1. Show grant on database should return correct priv
 * 5.4.2. Show grant on table should return correct priv
 * 5.5. Privileges on server
 * 5.5.1. Show grant on database should return correct priv
 * 5.5.2. Show grant on table should return correct priv
 * 5.5.3. Show grant on server should return correct priv (sql not supported yet in hive)
 * 5.6. Show grant on uri (sql not supported yet in hive)
 */
@Test public void testShowPrivilegesByRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  statement.execute("CREATE ROLE role2");
  statement.execute("CREATE TABLE IF NOT EXISTS t1(c1 string, c2 int)");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE role1");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  String[] users={ADMIN1,USER1_1};
  for (  String user : users) {
    connection=context.createConnection(user);
    statement=context.createStatement(connection);
    resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
    ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
    assertThat(resultSetMetaData.getColumnCount(),is(10));
    assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("database"));
    assertThat(resultSetMetaData.getColumnName(2),equalToIgnoringCase("table"));
    assertThat(resultSetMetaData.getColumnName(3),equalToIgnoringCase("partition"));
    assertThat(resultSetMetaData.getColumnName(4),equalToIgnoringCase("column"));
    assertThat(resultSetMetaData.getColumnName(5),equalToIgnoringCase("principal_name"));
    assertThat(resultSetMetaData.getColumnName(6),equalToIgnoringCase("principal_type"));
    assertThat(resultSetMetaData.getColumnName(7),equalToIgnoringCase("privilege"));
    assertThat(resultSetMetaData.getColumnName(8),equalToIgnoringCase("grant_option"));
    assertThat(resultSetMetaData.getColumnName(9),equalToIgnoringCase("grant_time"));
    assertThat(resultSetMetaData.getColumnName(10),equalToIgnoringCase("grantor"));
    while (resultSet.next()) {
      assertThat(resultSet.getString(1),equalToIgnoringCase("default"));
      assertThat(resultSet.getString(2),equalToIgnoringCase("t1"));
      assertThat(resultSet.getString(3),equalToIgnoringCase(""));
      assertThat(resultSet.getString(4),equalToIgnoringCase(""));
      assertThat(resultSet.getString(5),equalToIgnoringCase("role1"));
      assertThat(resultSet.getString(6),equalToIgnoringCase("role"));
      assertThat(resultSet.getString(7),equalToIgnoringCase("select"));
      assertThat(resultSet.getBoolean(8),is(new Boolean("False")));
      assertThat(resultSet.getString(10),equalToIgnoringCase("--"));
    }
    statement.close();
    connection.close();
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  context.assertSentryException(statement,"SHOW GRANT ROLE role1",SentryAccessDeniedException.class.getSimpleName());
}

</code></pre>

<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-303 and SENTRY-543.
 */
@Test public void testGrantRevokeSELECTonDb() throws Exception {
  File dataFile=doSetupForGrantDbTests();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("GRANT SELECT ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("SELECT * FROM " + DB1 + ".t2");
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("only SELECT allowed on t1!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t2");
    assertTrue("only SELECT allowed on t2!!",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("REVOKE SELECT ON DATABASE " + DB1 + " FROM ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    fail("SELECT should have been revoked from t1");
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    fail("SELECT should have been revoked from t2");
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-5 type-10 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  String testRole0="role1", testRole1="role2";
  statement.execute("CREATE ROLE " + testRole0);
  statement.execute("CREATE ROLE " + testRole1);
  statement.execute("GRANT ROLE " + testRole0 + " TO GROUP "+ ADMINGROUP);
  statement.execute("GRANT ROLE " + testRole1 + " TO GROUP "+ USERGROUP1);
  statement.execute("SET ROLE " + testRole0);
  try {
    statement.execute("SET ROLE " + testRole1);
    fail("User " + ADMIN1 + " shouldn't be able to set "+ testRole1);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SET ROLE " + testRole1);
  try {
    statement.execute("SET ROLE " + testRole0);
    fail("User " + USER1_1 + " shouldn't be able to set "+ testRole0);
  }
 catch (  SQLException e) {
    assertTrue(e.getMessage().contains("Not authorized to set role"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Regression test for SENTRY-617.
 */
@Test public void testGrantRevokeRoleToGroups() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string,c2 string,c3 string,c4 string,c5 string)");
  statement.execute("CREATE ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1 + ", GROUP "+ USERGROUP2+ ", GROUP "+ USERGROUP3);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE ROLE user_role FROM GROUP " + USERGROUP1 + ", GROUP "+ USERGROUP2);
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("after revoking, user1 has no permission to access table t1",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(USER2_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("after revoking, user1 has no permission to access table t1",false);
  }
 catch (  Exception e) {
  }
  connection=context.createConnection(USER3_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRevokeServerAfterGrantTable() throws Exception {
  doSetup();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,2);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("REVOKE ALL ON SERVER server1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM t1");
    assertTrue("SELECT should not be allowed after revoke on parent!!",false);
  }
 catch (  Exception e) {
  }
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t2");
    assertTrue("SELECT should not be allowed after revoke on parent!!",false);
  }
 catch (  Exception e) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  resultSet=statement.executeQuery("SHOW GRANT ROLE user_role");
  assertResultSize(resultSet,0);
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * SHOW CURRENT ROLE
 * @throws Exception
 */
@Test public void testShowCurrentRole() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE role1");
  statement.execute("GRANT ROLE role1 TO GROUP " + ADMINGROUP);
  statement.execute("SET ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW CURRENT ROLES");
  ResultSetMetaData resultSetMetaData=resultSet.getMetaData();
  assertThat(resultSetMetaData.getColumnCount(),is(1));
  assertThat(resultSetMetaData.getColumnName(1),equalToIgnoringCase("role"));
  while (resultSet.next()) {
    assertThat(resultSet.getString(1),equalToIgnoringCase("role1"));
  }
  statement.close();
  connection.close();
}

</code></pre>

<pre class="type-17 type-12 type-19 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Corner cases
 * @throws Exception7.1. Drop role which doesn't exist, throws SentryNoSuchObjectException
 * 7.2. Create role which already exists, throws SentryAlreadyExitsException
 * 7.3. Drop role when privileges mapping exists and create role with same name, old
 * mappings should not exist
 * 7.4. Grant role, when role doesn't exist, throws SentryNoSuchObjectException
 * 7.5. Grant role when mapping exists, silently allows
 * 7.6. Grant multiple roles to a group
 * 7.7. Revoke role after role has been dropped, SentryNoSuchObjectException
 * 7.8. Revoke role from a group when mapping doesn't exist, silently allows
 * 7.9. Grant privilege to a role, privilege already exists, silently allows
 * 7.10. Grant privilege to a role, mapping already exists, silently allows
 * 7.11. Multiple privileges to a role
 * 7.12. Revoke privilege when privilege doesn't exist, silently allows
 * 7.13. Revoke privilege, when role doesn't exist, SentryNoSuchObjectException
 * 7.14. Revoke privilege when mapping doesn't exist, silently allows
 * 7.15. Drop role should remove role-group mapping
 */
@Test public void testCornerCases() throws Exception {
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE TABLE IF NOT EXISTS tab1(c1 string)");
  context.assertSentryException(statement,"DROP ROLE role1",SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role1");
  context.assertSentryException(statement,"CREATE ROLE role1",SentryAlreadyExistsException.class.getSimpleName());
  statement.execute("GRANT ROLE role1 TO GROUP " + USERGROUP1);
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  ResultSet resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("DROP ROLE role1");
  statement.execute("CREATE ROLE role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,0);
  context.assertSentryException(statement,"GRANT role role2 TO GROUP " + USERGROUP1,SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ROLE role2 to GROUP " + USERGROUP1);
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertResultSize(resultSet,2);
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("DROP ROLE role2");
  context.assertSentryException(statement,"REVOKE role role2 from group " + USERGROUP1,SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("REVOKE ROLE role1 from GROUP " + USERGROUP1);
  statement.execute("REVOKE ROLE role1 from GROUP " + USERGROUP1);
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role1");
  statement.execute("GRANT ALL ON SERVER server1 TO ROLE role2");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  resultSet=statement.executeQuery("SHOW GRANT ROLE role2");
  assertResultSize(resultSet,1);
  statement.execute("GRANT ALL ON TABLE tab1 to ROLE role2");
  statement.execute("GRANT ALL,INSERT ON TABLE tab1 to ROLE role2");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role2");
  assertResultSize(resultSet,2);
  statement.execute("DROP role role2");
  statement.execute("REVOKE ALL ON TABLE tab1 from role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  int count=0;
  while (resultSet.next()) {
    count++;
    assertThat(resultSet.getString(1),equalToIgnoringCase("*"));
    assertThat(resultSet.getString(2),equalToIgnoringCase(""));
    assertThat(resultSet.getString(7),equalToIgnoringCase("*"));
  }
  assertThat(count,is(1));
  context.assertSentryException(statement,"REVOKE ALL ON SERVER server1 from role role2",SentryNoSuchObjectException.class.getSimpleName());
  statement.execute("CREATE ROLE role2");
  statement.execute("GRANT ALL on TABLE tab1 to ROLE role2");
  statement.execute("REVOKE ALL on TABLE tab1 from Role role1");
  resultSet=statement.executeQuery("SHOW GRANT ROLE role1");
  assertResultSize(resultSet,1);
  statement.execute("DROP role role2");
  statement.execute("GRANT ROLE role1 to GROUP " + USERGROUP1);
  statement.execute("DROP ROLE role1");
  resultSet=statement.executeQuery("SHOW ROLE GRANT GROUP " + USERGROUP1);
  assertResultSize(resultSet,0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Revoke all on server after:
 * - grant all on db
 * - grant all on table
 * - grant select on table
 * - grant insert on table
 * - grant all on URI
 * - grant select on URI
 * - grant insert on URI
 */
@Test public void testRevokeAllOnServer() throws Exception {
  File dataDir=context.getDataDir();
  File dataFile=new File(dataDir,SINGLE_TYPE_DATA_FILE_NAME);
  FileOutputStream to=new FileOutputStream(dataFile);
  Resources.copy(Resources.getResource(SINGLE_TYPE_DATA_FILE_NAME),to);
  to.close();
  Connection connection=context.createConnection(ADMIN1);
  Statement statement=context.createStatement(connection);
  statement.execute("CREATE ROLE user_role");
  statement.execute("DROP DATABASE IF EXISTS " + DB1 + " CASCADE");
  statement.execute("CREATE DATABASE " + DB1);
  statement.execute("USE " + DB1);
  statement.execute("DROP TABLE IF EXISTS t1");
  statement.execute("CREATE TABLE t1 (c1 string)");
  statement.execute("GRANT ALL ON DATABASE " + DB1 + " TO ROLE user_role");
  statement.execute("GRANT ALL ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT SELECT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT INSERT ON TABLE t1 TO ROLE user_role");
  statement.execute("GRANT ALL ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT SELECT ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT INSERT ON URI 'file://" + dataFile.getPath() + "' TO ROLE user_role");
  statement.execute("GRANT ROLE user_role TO GROUP " + USERGROUP1);
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  statement.execute("SELECT * FROM " + DB1 + ".t1");
  statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),3);
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  statement.execute("USE " + DB1);
  statement.execute("REVOKE ALL ON SERVER server1 from ROLE user_role");
  statement.close();
  connection.close();
  connection=context.createConnection(USER1_1);
  statement=context.createStatement(connection);
  try {
    statement.execute("SELECT * FROM " + DB1 + ".t1");
    assertTrue("SELECT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  try {
    statement.execute("LOAD DATA LOCAL INPATH '" + dataFile.getPath() + "' INTO TABLE "+ DB1+ ".t1");
    assertTrue("INSERT should not be allowed !!",false);
  }
 catch (  SQLException se) {
  }
  statement.close();
  connection.close();
  connection=context.createConnection(ADMIN1);
  statement=context.createStatement(connection);
  assertResultSize(statement.executeQuery("SHOW GRANT ROLE user_role"),0);
  statement.close();
  connection.close();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
