<h3 style="margin:0px">Class: org.apache.sentry.provider.db.service.persistent.TestSentryStore (38 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(31)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(30)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(2)</kbd></button>&nbsp;<button id="17"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('17')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-17"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="18"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('18')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-18"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRenameTableWithColumn() throws Exception {
  String roleName1="role1", roleName2="role2";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setAction(AccessConstants.SELECT);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c1=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c1.setPrivilegeScope("COLUMN");
  privilege_tbl1_c1.setColumnName("c1");
  privilege_tbl1_c1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c2=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c2.setPrivilegeScope("COLUMN");
  privilege_tbl1_c2.setColumnName("c2");
  privilege_tbl1_c2.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c3=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c3.setPrivilegeScope("COLUMN");
  privilege_tbl1_c3.setColumnName("c3");
  privilege_tbl1_c3.setCreateTime(System.currentTimeMillis());
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c1);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c2);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_tbl1_c3);
  Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(2,privilegeSet.size());
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(1,privilegeSet.size());
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(2,privilegeSet.size());
  for (  TSentryPrivilege privilege : privilegeSet) {
    assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
  }
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(1,privilegeSet.size());
}

</code></pre>

<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRevokeCheckWithGrantOption() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1","user2"};
  String[] roles={"role0","role1","role2"};
  String[] groups={"group0","group1","group2"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("DATABASE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setAction(AccessConstants.SELECT);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor="g1";
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("TABLE");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setTableName(table);
  privilege2.setAction(AccessConstants.ALL);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[2];
  grantor="g1";
  TSentryPrivilege privilege3=new TSentryPrivilege();
  privilege3.setPrivilegeScope("TABLE");
  privilege3.setServerName(server);
  privilege3.setDbName(db);
  privilege3.setTableName(table);
  privilege3.setAction(AccessConstants.SELECT);
  privilege3.setCreateTime(System.currentTimeMillis());
  privilege3.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege3);
  roleName=roles[2];
  grantor=users[1];
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege3);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[1];
  grantor=users[0];
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege2);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[2];
  grantor=users[0];
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege3);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
}

</code></pre>

<pre class="type-12 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantRevokePrivilege() throws Exception {
  String roleName="test-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-550
 * Use case:
 * GRANT INSERT on TABLE tbl1 to ROLE role1
 * GRANT SELECT on TABLE tbl1 to ROLE role1
 * GRANT ALTER on TABLE tbl1 to ROLE role1
 * GRANT DROP on TABLE tbl1 to ROLE role1
 * RENAME TABLE tbl1 to tbl2
 * After rename tbl1 to tbl2, table name of all role1's privileges should be "tbl2"
 */
@Test public void testRenameTableWithMultiAction() throws Exception {
  String roleName1="role1";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction(AccessConstants.INSERT);
  TSentryPrivilege privilege_tbl1_select=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_select.setAction(AccessConstants.SELECT);
  TSentryPrivilege privilege_tbl1_alter=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_alter.setAction(AccessConstants.ALTER);
  TSentryPrivilege privilege_tbl1_drop=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_drop.setAction(AccessConstants.DROP);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_select);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_alter);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_drop);
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(4,privilegeSet.size());
  for (  TSentryPrivilege privilege : privilegeSet) {
    assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
  }
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SentryNoSuchObjectException.class) public void testAddDeleteGroupsNonExistantRole() throws Exception {
  String roleName="non-existant-role";
  String grantor="g1";
  Set<TSentryGroup> groups=Sets.newHashSet();
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,groups);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDropOverlappedPrivileges() throws Exception {
  String roleName1="list-privs-r1";
  String grantor="g1";
  sentryStore.createSentryRole(roleName1);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName("tbl1");
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction("INSERT");
  TSentryPrivilege privilege_tbl1_all=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_all.setAction("*");
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_all);
  sentryStore.dropPrivilege(toTSentryAuthorizable(privilege_tbl1));
  assertEquals(0,sentryStore.getAllTSentryPrivilegesByRoleName(roleName1).size());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void teardown(){
  if (sentryStore != null) {
    sentryStore.stop();
  }
  if (dataDir != null) {
    FileUtils.deleteQuietly(dataDir);
  }
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDropTableWithColumn() throws Exception {
  String roleName1="role1", roleName2="role2";
  String grantor="g1";
  String table1="tbl1";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setAction(AccessConstants.SELECT);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c1=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c1.setPrivilegeScope("COLUMN");
  privilege_tbl1_c1.setColumnName("c1");
  privilege_tbl1_c1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c2=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c2.setPrivilegeScope("COLUMN");
  privilege_tbl1_c2.setColumnName("c2");
  privilege_tbl1_c2.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_c3=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_c3.setPrivilegeScope("COLUMN");
  privilege_tbl1_c3.setColumnName("c3");
  privilege_tbl1_c3.setCreateTime(System.currentTimeMillis());
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c1);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_c2);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_tbl1_c3);
  Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(2,privilegeSet.size());
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(1,privilegeSet.size());
  TSentryAuthorizable tableAuthorizable=toTSentryAuthorizable(privilege_tbl1);
  sentryStore.dropPrivilege(tableAuthorizable);
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName1);
  assertEquals(0,privilegeSet.size());
  privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName2);
  assertEquals(0,privilegeSet.size());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCaseSensitiveScope() throws Exception {
  String roleName="role1";
  String grantor="g1";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege sentryPrivilege=new TSentryPrivilege("Database","server1","all");
  sentryPrivilege.setDbName("db1");
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,sentryPrivilege).getSequenceId());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRevokeAllGrantOption() throws Exception {
  String grantor="g1";
  String[] users={"user0"};
  String[] roles={"role0"};
  String[] groups={"group0"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.SELECT);
  privilege.setCreateTime(System.currentTimeMillis());
  privilege.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege);
  roleName=roles[0];
  grantor="g1";
  privilege.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege);
  roleName=roles[0];
  grantor="g1";
  privilege.setGrantOption(TSentryGrantOption.UNSET);
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),0,privileges.size());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateDropRole() throws Exception {
  String roleName="test-drop-role";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  assertEquals(seqId + 1,sentryStore.dropSentryRole(roleName).getSequenceId());
}

</code></pre>

<pre class="type-7 type-6 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Create several privileges in the database, then delete the role that
 * created them.  This makes them all orphans.  Wait a bit to ensure the
 * cleanup thread runs, and expect them all to be gone from the database.
 * @throws Exception
 */
@Ignore("Disabled with SENTRY-545 following SENTRY-140 problems") @Test public void testPrivilegeCleanup() throws Exception {
  final String roleName="test-priv-cleanup";
  final String grantor="g1";
  final String server="server";
  final String dBase="db";
  final String table="table-";
  sentryStore.createSentryRole(roleName);
  for (int i=0; i < NUM_PRIVS; i++) {
    TSentryPrivilege priv=new TSentryPrivilege();
    priv.setPrivilegeScope("TABLE");
    priv.setServerName(server);
    priv.setAction(AccessConstants.ALL);
    priv.setCreateTime(System.currentTimeMillis());
    priv.setTableName(table + i);
    priv.setDbName(dBase);
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,priv);
  }
  assertEquals(sentryStore.countMSentryPrivileges(),NUM_PRIVS);
  sentryStore.dropSentryRole(roleName);
  verifyOrphanCleanup();
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Assign multiple table and SERVER privileges to roles
 * drop privilege for the object verify that it's removed correctl
 * @throws Exception
 */
@Test public void testDropDbObject() throws Exception {
  String roleName1="list-privs-r1", roleName2="list-privs-r2", roleName3="list-privs-r3";
  String grantor="g1";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  sentryStore.createSentryRole(roleName3);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName("tbl1");
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege1=new TSentryPrivilege(privilege_tbl1);
  privilege1.setAction("SELECT");
  TSentryPrivilege privilege2_1=new TSentryPrivilege(privilege_tbl1);
  privilege2_1.setAction("INSERT");
  TSentryPrivilege privilege3_1=new TSentryPrivilege(privilege_tbl1);
  privilege3_1.setAction("*");
  TSentryPrivilege privilege_server=new TSentryPrivilege();
  privilege_server.setPrivilegeScope("SERVER");
  privilege_server.setServerName("server1");
  privilege_server.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl2=new TSentryPrivilege();
  privilege_tbl2.setPrivilegeScope("TABLE");
  privilege_tbl2.setServerName("server1");
  privilege_tbl2.setDbName("db1");
  privilege_tbl2.setTableName("tbl2");
  privilege_tbl2.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege2_3=new TSentryPrivilege(privilege_tbl2);
  privilege2_3.setAction("SELECT");
  TSentryPrivilege privilege3_2=new TSentryPrivilege(privilege_tbl2);
  privilege3_2.setAction("INSERT");
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege1);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege2_1);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_server);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege2_3);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName3,privilege3_1);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName3,privilege3_2);
  sentryStore.dropPrivilege(toTSentryAuthorizable(privilege_tbl1));
  assertEquals(0,sentryStore.getAllTSentryPrivilegesByRoleName(roleName1).size());
  assertEquals(2,sentryStore.getAllTSentryPrivilegesByRoleName(roleName2).size());
  assertEquals(1,sentryStore.getAllTSentryPrivilegesByRoleName(roleName3).size());
  sentryStore.dropPrivilege(toTSentryAuthorizable(privilege_tbl2));
  assertEquals(0,sentryStore.getAllTSentryPrivilegesByRoleName(roleName1).size());
  assertEquals(1,sentryStore.getAllTSentryPrivilegesByRoleName(roleName2).size());
  assertEquals(0,sentryStore.getAllTSentryPrivilegesByRoleName(roleName3).size());
}

</code></pre>

<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSentryTablePrivilegeSome() throws Exception {
  String roleName="test-table-privilege-some";
  String grantor="g1";
  String dbName="db1";
  String table="tb1";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("TABLE","server1","ALL");
  tSentryPrivilege.setDbName(dbName);
  tSentryPrivilege.setTableName(table);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setDb(dbName);
  tSentryAuthorizable.setTable(AccessConstants.SOME);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->db=" + dbName + "->table="+ table+ "->action=all"));
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGrantRevokeMultiPrivileges() throws Exception {
  String roleName="test-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String[] columns={"c1","c2","c3","c4"};
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  Set<TSentryPrivilege> tPrivileges=Sets.newHashSet();
  for (  String column : columns) {
    TSentryPrivilege privilege=new TSentryPrivilege();
    privilege.setPrivilegeScope("Column");
    privilege.setServerName(server);
    privilege.setDbName(db);
    privilege.setTableName(table);
    privilege.setColumnName(column);
    privilege.setAction(AccessConstants.SELECT);
    privilege.setCreateTime(System.currentTimeMillis());
    tPrivileges.add(privilege);
  }
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivileges(grantor,roleName,tPrivileges).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),4,privileges.size());
  tPrivileges=Sets.newHashSet();
  for (int i=0; i < 2; i++) {
    TSentryPrivilege privilege=new TSentryPrivilege();
    privilege.setPrivilegeScope("Column");
    privilege.setServerName(server);
    privilege.setDbName(db);
    privilege.setTableName(table);
    privilege.setColumnName(columns[i]);
    privilege.setAction(AccessConstants.SELECT);
    privilege.setCreateTime(System.currentTimeMillis());
    tPrivileges.add(privilege);
  }
  assertEquals(seqId + 2,sentryStore.alterSentryRoleRevokePrivileges(grantor,roleName,tPrivileges).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("Table");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.SELECT);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),0,privileges.size());
}

</code></pre>

<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeColumnPrivilegeDowngradeByDb() throws Exception {
  String roleName="test-column-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeCol1=new TSentryPrivilege();
  privilegeCol1.setPrivilegeScope("COLUMN");
  privilegeCol1.setServerName(server);
  privilegeCol1.setDbName(db);
  privilegeCol1.setTableName(table);
  privilegeCol1.setColumnName(column1);
  privilegeCol1.setAction(AccessConstants.ALL);
  privilegeCol1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeCol2=privilegeCol1.deepCopy();
  ;
  privilegeCol2.setColumnName(column2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeCol2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilegeCol2.setAction(AccessConstants.INSERT);
  privilegeCol2.setPrivilegeScope("DATABASE");
  privilegeCol2.unsetTableName();
  privilegeCol2.unsetColumnName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeCol2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table,mPrivilege.getTableName());
  assertEquals(column1,mPrivilege.getColumnName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<pre class="type-12 type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-552
 */
@Test public void testGrantRevokeTablePrivilegeDowngradeByDb() throws Exception {
  String roleName="test-table-db-downgrade-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table1="tbl1";
  String table2="tbl2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilegeTable1=new TSentryPrivilege();
  privilegeTable1.setPrivilegeScope("TABLE");
  privilegeTable1.setServerName(server);
  privilegeTable1.setDbName(db);
  privilegeTable1.setTableName(table1);
  privilegeTable1.setAction(AccessConstants.ALL);
  privilegeTable1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilegeTable2=privilegeTable1.deepCopy();
  ;
  privilegeTable2.setTableName(table2);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable1).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilegeTable2.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getTableName().equals(table1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getTableName().equals(table2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected table name: " + mPrivilege.getTableName());
    }
  }
  privilegeTable2.setAction(AccessConstants.INSERT);
  privilegeTable2.setPrivilegeScope("DATABASE");
  privilegeTable2.unsetTableName();
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilegeTable2).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(table1,mPrivilege.getTableName());
  assertEquals(AccessConstants.SELECT,mPrivilege.getAction());
  assertFalse(mPrivilege.getGrantOption());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testListRole() throws Exception {
  String roleName1="role1", roleName2="role2", roleName3="role3";
  String group1="group1", group2="group2";
  String grantor="g1";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  sentryStore.createSentryRole(roleName3);
  sentryStore.alterSentryRoleAddGroups(grantor,roleName1,Sets.newHashSet(new TSentryGroup(group1)));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName2,Sets.newHashSet(new TSentryGroup(group2)));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName3,Sets.newHashSet(new TSentryGroup(group1),new TSentryGroup(group2)));
  assertEquals(2,sentryStore.getTSentryRolesByGroupName(Sets.newHashSet(group1),false).size());
  assertEquals(2,sentryStore.getTSentryRolesByGroupName(Sets.newHashSet(group2),false).size());
  assertEquals(3,sentryStore.getTSentryRolesByGroupName(Sets.newHashSet(group1,group2),false).size());
  assertEquals(0,sentryStore.getTSentryRolesByGroupName(Sets.newHashSet("foo"),true).size());
}

</code></pre>

<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantCheckWithColumn() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1"};
  String[] roles={"role0","role1"};
  String[] groups={"group0","group1"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("TABLE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setTableName(table);
  privilege1.setAction(AccessConstants.SELECT);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor=users[0];
  String column="c1";
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("COLUMN");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setTableName(table);
  privilege2.setColumnName(column);
  privilege2.setAction(AccessConstants.SELECT);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[0];
  grantor=users[1];
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege1);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[1];
  grantor=users[0];
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege2);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
}

</code></pre>

<pre class="type-17 type-12 type-7 type-6 type-9 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Much like testPrivilegeCleanup, make a lot of privileges and make sure
 * they get cleaned up.  The difference here is that the privileges are
 * created by granting ALL and then removing SELECT - thus leaving INSERT.
 * This test exists because the revocation plays havoc with the orphan
 * cleanup thread.
 * @throws Exception
 */
@Ignore("Disabled with SENTRY-545 following SENTRY-140 problems") @Test public void testPrivilegeCleanup2() throws Exception {
  final String roleName="test-priv-cleanup";
  final String grantor="g1";
  final String server="server";
  final String dBase="db";
  final String table="table-";
  sentryStore.createSentryRole(roleName);
  for (int i=0; i < NUM_PRIVS; i++) {
    TSentryPrivilege priv=new TSentryPrivilege();
    priv.setPrivilegeScope("DATABASE");
    priv.setServerName(server);
    priv.setAction(AccessConstants.ALL);
    priv.setCreateTime(System.currentTimeMillis());
    priv.setTableName(table + i);
    priv.setDbName(dBase);
    priv.setGrantOption(TSentryGrantOption.TRUE);
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,priv);
    priv.setAction(AccessConstants.SELECT);
    priv.setGrantOption(TSentryGrantOption.UNSET);
    sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,priv);
    MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
    Set<MSentryPrivilege> privileges=role.getPrivileges();
    assertEquals(privileges.toString(),i + 1,privileges.size());
    MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
    assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
  }
  sentryStore.dropSentryRole(roleName);
  verifyOrphanCleanup();
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCaseInsensitiveRole() throws Exception {
  String roleName="newRole";
  String grantor="g1";
  Set<TSentryGroup> groups=Sets.newHashSet();
  TSentryGroup group=new TSentryGroup();
  group.setGroupName("test-groups-g1");
  groups.add(group);
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName("server1");
  privilege.setDbName("default");
  privilege.setTableName("table1");
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  assertEquals(seqId + 1,sentryStore.alterSentryRoleAddGroups(grantor,roleName,groups).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleDeleteGroups(roleName,groups).getSequenceId());
  assertEquals(seqId + 3,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void after(){
  sentryStore.clearAllTables();
}

</code></pre>

<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create roles and assign privileges for same table rename the privileges for
 * the table and verify the new privileges
 * @throws Exception
 */
@Test public void testRenameTable() throws Exception {
  String roleName1="role1", roleName2="role2", roleName3="role3";
  String grantor="g1";
  String table1="tbl1", table2="tbl2";
  sentryStore.createSentryRole(roleName1);
  sentryStore.createSentryRole(roleName2);
  sentryStore.createSentryRole(roleName3);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName(table1);
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction(AccessConstants.INSERT);
  TSentryPrivilege privilege_tbl1_select=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_select.setAction(AccessConstants.SELECT);
  TSentryPrivilege privilege_tbl1_all=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_all.setAction(AccessConstants.ALL);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege_tbl1_select);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName3,privilege_tbl1_all);
  TSentryAuthorizable oldTable=toTSentryAuthorizable(privilege_tbl1);
  TSentryAuthorizable newTable=toTSentryAuthorizable(privilege_tbl1);
  newTable.setTable(table2);
  sentryStore.renamePrivilege(oldTable,newTable);
  for (  String roleName : Sets.newHashSet(roleName1,roleName2,roleName3)) {
    Set<TSentryPrivilege> privilegeSet=sentryStore.getAllTSentryPrivilegesByRoleName(roleName);
    assertEquals(1,privilegeSet.size());
    for (    TSentryPrivilege privilege : privilegeSet) {
      assertTrue(table2.equalsIgnoreCase(privilege.getTableName()));
    }
  }
}

</code></pre>

<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSentryColumnPrivilegeSome() throws Exception {
  String roleName="test-column-privilege-some";
  String grantor="g1";
  String dbName="db1";
  String table="tb1";
  String column="col1";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("TABLE","server1","ALL");
  tSentryPrivilege.setDbName(dbName);
  tSentryPrivilege.setTableName(table);
  tSentryPrivilege.setColumnName(column);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setDb(dbName);
  tSentryAuthorizable.setTable(table);
  tSentryAuthorizable.setColumn(AccessConstants.SOME);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->db=" + dbName + "->table="+ table+ "->column="+ column+ "->action=all"));
}

</code></pre>

<pre class="type-12 type-7 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testURI() throws Exception {
  String roleName="test-dup-role";
  String grantor="g1";
  String uri="file:///var/folders/dt/9zm44z9s6bjfxbrm4v36lzdc0000gp/T/1401860678102-0/data/kv1.dat";
  sentryStore.createSentryRole(roleName);
  TSentryPrivilege tSentryPrivilege=new TSentryPrivilege("URI","server1","ALL");
  tSentryPrivilege.setURI(uri);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,tSentryPrivilege);
  TSentryAuthorizable tSentryAuthorizable=new TSentryAuthorizable();
  tSentryAuthorizable.setUri(uri);
  tSentryAuthorizable.setServer("server1");
  Set<TSentryPrivilege> privileges=sentryStore.getTSentryPrivileges(new HashSet<String>(Arrays.asList(roleName)),tSentryAuthorizable);
  assertTrue(privileges.size() == 1);
  Set<TSentryGroup> tSentryGroups=new HashSet<TSentryGroup>();
  tSentryGroups.add(new TSentryGroup("group1"));
  sentryStore.alterSentryRoleAddGroups(grantor,roleName,tSentryGroups);
  TSentryActiveRoleSet thriftRoleSet=new TSentryActiveRoleSet(true,new HashSet<String>(Arrays.asList(roleName)));
  Set<String> privs=sentryStore.listSentryPrivilegesForProvider(new HashSet<String>(Arrays.asList("group1")),thriftRoleSet,tSentryAuthorizable);
  assertTrue(privs.size() == 1);
  assertTrue(privs.contains("server=server1->uri=" + uri + "->action=all"));
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSentryPrivilegeSize() throws Exception {
  String role1="role1";
  String role2="role2";
  sentryStore.createSentryRole(role1);
  sentryStore.createSentryRole(role2);
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName("server1");
  privilege.setDbName("db1");
  privilege.setTableName("tb1");
  privilege.setCreateTime(System.currentTimeMillis());
  String grantor="g1";
  assertEquals(new Long(0),sentryStore.getPrivilegeCountGauge().getValue());
  sentryStore.alterSentryRoleGrantPrivilege(grantor,role1,privilege);
  assertEquals(new Long(1),sentryStore.getPrivilegeCountGauge().getValue());
  sentryStore.alterSentryRoleGrantPrivilege(grantor,role2,privilege);
  assertEquals(new Long(1),sentryStore.getPrivilegeCountGauge().getValue());
  privilege.setTableName("tb2");
  sentryStore.alterSentryRoleGrantPrivilege(grantor,role2,privilege);
  assertEquals(new Long(2),sentryStore.getPrivilegeCountGauge().getValue());
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCredentialProvider() throws Exception {
  assertArrayEquals(passwd,conf.getPassword(ServerConfig.SENTRY_STORE_JDBC_PASS));
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void before() throws Exception {
  policyFile=new PolicyFile();
  String adminUser="g1";
  addGroupsToUser(adminUser,adminGroups);
  writePolicyFile();
}

</code></pre>

<pre class="type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGrantCheckWithGrantOption() throws Exception {
  String grantor="g1";
  String[] users={"user0","user1","user2","user3","user4"};
  String[] roles={"role0","role1","role2","role3","role4"};
  String[] groups={"group0","group1","group2","group3","group4"};
  for (int i=0; i < users.length; i++) {
    addGroupsToUser(users[i],groups[i]);
    sentryStore.createSentryRole(roles[i]);
    Set<TSentryGroup> tGroups=Sets.newHashSet();
    TSentryGroup tGroup=new TSentryGroup(groups[i]);
    tGroups.add(tGroup);
    sentryStore.alterSentryRoleAddGroups(grantor,roles[i],tGroups);
  }
  writePolicyFile();
  String server="server1";
  String db="db1";
  String table="tbl1";
  String roleName=roles[0];
  grantor="g1";
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("DATABASE");
  privilege1.setServerName(server);
  privilege1.setDbName(db);
  privilege1.setAction(AccessConstants.ALL);
  privilege1.setCreateTime(System.currentTimeMillis());
  privilege1.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege1);
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  roleName=roles[1];
  grantor=users[0];
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("DATABASE");
  privilege2.setServerName(server);
  privilege2.setDbName(db);
  privilege2.setAction(AccessConstants.SELECT);
  privilege2.setCreateTime(System.currentTimeMillis());
  privilege2.setGrantOption(TSentryGrantOption.TRUE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege2);
  roleName=roles[2];
  grantor=users[0];
  TSentryPrivilege privilege3=new TSentryPrivilege();
  privilege3.setPrivilegeScope("TABLE");
  privilege3.setServerName(server);
  privilege3.setDbName(db);
  privilege3.setTableName(table);
  privilege3.setAction(AccessConstants.ALL);
  privilege3.setCreateTime(System.currentTimeMillis());
  privilege3.setGrantOption(TSentryGrantOption.FALSE);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege3);
  roleName=roles[3];
  grantor=users[1];
  TSentryPrivilege privilege4=new TSentryPrivilege();
  privilege4.setPrivilegeScope("DATABASE");
  privilege4.setServerName(server);
  privilege4.setDbName(db);
  privilege4.setAction(AccessConstants.INSERT);
  privilege4.setCreateTime(System.currentTimeMillis());
  privilege4.setGrantOption(TSentryGrantOption.FALSE);
  boolean isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege4);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
  roleName=roles[4];
  grantor=users[2];
  TSentryPrivilege privilege5=new TSentryPrivilege();
  privilege5.setPrivilegeScope("TABLE");
  privilege5.setServerName(server);
  privilege5.setDbName(db);
  privilege5.setTableName(table);
  privilege5.setAction(AccessConstants.INSERT);
  privilege5.setCreateTime(System.currentTimeMillis());
  privilege5.setGrantOption(TSentryGrantOption.FALSE);
  isGrantOptionException=false;
  try {
    sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege5);
  }
 catch (  SentryGrantDeniedException e) {
    isGrantOptionException=true;
    System.err.println(e.getMessage());
  }
  assertTrue(isGrantOptionException);
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testListSentryPrivilegesForProvider() throws Exception {
  String roleName1="list-privs-r1", roleName2="list-privs-r2";
  String groupName1="list-privs-g1", groupName2="list-privs-g2";
  String grantor="g1";
  long seqId=sentryStore.createSentryRole(roleName1).getSequenceId();
  assertEquals(seqId + 1,sentryStore.createSentryRole(roleName2).getSequenceId());
  TSentryPrivilege privilege1=new TSentryPrivilege();
  privilege1.setPrivilegeScope("TABLE");
  privilege1.setServerName("server1");
  privilege1.setDbName("db1");
  privilege1.setTableName("tbl1");
  privilege1.setAction("SELECT");
  privilege1.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege1).getSequenceId());
  assertEquals(seqId + 3,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege1).getSequenceId());
  TSentryPrivilege privilege2=new TSentryPrivilege();
  privilege2.setPrivilegeScope("SERVER");
  privilege2.setServerName("server1");
  privilege2.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 4,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName2,privilege2).getSequenceId());
  Set<TSentryGroup> groups=Sets.newHashSet();
  TSentryGroup group=new TSentryGroup();
  group.setGroupName(groupName1);
  groups.add(group);
  assertEquals(seqId + 5,sentryStore.alterSentryRoleAddGroups(grantor,roleName1,groups).getSequenceId());
  groups.clear();
  group=new TSentryGroup();
  group.setGroupName(groupName2);
  groups.add(group);
  assertEquals(seqId + 6,sentryStore.alterSentryRoleAddGroups(grantor,roleName1,groups).getSequenceId());
  assertEquals(seqId + 7,sentryStore.alterSentryRoleAddGroups(grantor,roleName2,groups).getSequenceId());
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1),new TSentryActiveRoleSet(true,new HashSet<String>()))));
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1),new TSentryActiveRoleSet(false,Sets.newHashSet(roleName1)))));
  assertEquals(Sets.newHashSet(),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1),new TSentryActiveRoleSet(false,Sets.newHashSet("not a role")))));
  assertEquals(Sets.newHashSet(),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1),new TSentryActiveRoleSet(false,new HashSet<String>()))));
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select","server=server1"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName2),new TSentryActiveRoleSet(true,new HashSet<String>()))));
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName2),new TSentryActiveRoleSet(false,Sets.newHashSet(roleName1)))));
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select","server=server1"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName2),new TSentryActiveRoleSet(false,Sets.newHashSet(roleName2)))));
  assertEquals(Sets.newHashSet(),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName2),new TSentryActiveRoleSet(false,Sets.newHashSet("not a role")))));
  assertEquals(Sets.newHashSet(),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName2),new TSentryActiveRoleSet(false,new HashSet<String>()))));
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select","server=server1"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1,groupName2),new TSentryActiveRoleSet(true,new HashSet<String>()))));
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1,groupName2),new TSentryActiveRoleSet(false,Sets.newHashSet(roleName1)))));
  assertEquals(Sets.newHashSet("server=server1->db=db1->table=tbl1->action=select","server=server1"),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1,groupName2),new TSentryActiveRoleSet(false,Sets.newHashSet(roleName2)))));
  assertEquals(Sets.newHashSet(),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1,groupName2),new TSentryActiveRoleSet(false,Sets.newHashSet("not a role")))));
  assertEquals(Sets.newHashSet(),SentryStore.toTrimedLower(sentryStore.listAllSentryPrivilegesForProvider(Sets.newHashSet(groupName1,groupName2),new TSentryActiveRoleSet(false,new HashSet<String>()))));
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Regression test for SENTRY-547 and SENTRY-548
 * Use case:
 * GRANT INSERT on TABLE tbl1 to ROLE role1
 * GRANT SELECT on TABLE tbl1 to ROLE role1
 * GRANT ALTER on TABLE tbl1 to ROLE role1
 * GRANT DROP on TABLE tbl1 to ROLE role1
 * DROP TABLE tbl1
 * After drop tbl1, role1 should have 0 privileges
 */
@Test public void testDropTableWithMultiAction() throws Exception {
  String roleName1="role1";
  String grantor="g1";
  sentryStore.createSentryRole(roleName1);
  TSentryPrivilege privilege_tbl1=new TSentryPrivilege();
  privilege_tbl1.setPrivilegeScope("TABLE");
  privilege_tbl1.setServerName("server1");
  privilege_tbl1.setDbName("db1");
  privilege_tbl1.setTableName("tbl1");
  privilege_tbl1.setCreateTime(System.currentTimeMillis());
  TSentryPrivilege privilege_tbl1_insert=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_insert.setAction(AccessConstants.INSERT);
  TSentryPrivilege privilege_tbl1_select=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_select.setAction(AccessConstants.SELECT);
  TSentryPrivilege privilege_tbl1_alter=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_alter.setAction(AccessConstants.ALTER);
  TSentryPrivilege privilege_tbl1_drop=new TSentryPrivilege(privilege_tbl1);
  privilege_tbl1_drop.setAction(AccessConstants.DROP);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_insert);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_select);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_alter);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName1,privilege_tbl1_drop);
  assertEquals(4,sentryStore.getAllTSentryPrivilegesByRoleName(roleName1).size());
  sentryStore.dropPrivilege(toTSentryAuthorizable(privilege_tbl1));
  assertEquals(0,sentryStore.getAllTSentryPrivilegesByRoleName(roleName1).size());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGrantDuplicatePrivilege() throws Exception {
  String roleName="test-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  privilege.setServerName("Server1");
  privilege.setDbName("DB1");
  privilege.setTableName("TBL1");
  assertEquals(seqId + 3,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSentryGroupsSize() throws Exception {
  String role1="role1";
  String role2="role2";
  sentryStore.createSentryRole(role1);
  sentryStore.createSentryRole(role2);
  Set<TSentryGroup> groups=Sets.newHashSet();
  TSentryGroup group=new TSentryGroup();
  group.setGroupName("group1");
  groups.add(group);
  String grantor="g1";
  sentryStore.alterSentryRoleAddGroups(grantor,role1,groups);
  assertEquals(new Long(1),sentryStore.getGroupCountGauge().getValue());
  sentryStore.alterSentryRoleAddGroups(grantor,role2,groups);
  assertEquals(new Long(1),sentryStore.getGroupCountGauge().getValue());
  groups.add(new TSentryGroup("group2"));
  sentryStore.alterSentryRoleAddGroups(grantor,role2,groups);
  assertEquals(new Long(2),sentryStore.getGroupCountGauge().getValue());
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCreateDuplicateRole() throws Exception {
  String roleName="test-dup-role";
  sentryStore.createSentryRole(roleName);
  try {
    sentryStore.createSentryRole(roleName);
    fail("Expected SentryAlreadyExistsException");
  }
 catch (  SentryAlreadyExistsException e) {
  }
}

</code></pre>

<pre class="type-16 type-5 type-7 type-10 type-6 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Regression test for SENTRY-74 and SENTRY-552
 */
@Test public void testGrantRevokePrivilegeWithColumn() throws Exception {
  String roleName="test-col-privilege";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  String column1="c1";
  String column2="c2";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("COLUMN");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setColumnName(column1);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  privilege.setColumnName(column2);
  assertEquals(seqId + 2,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  assertEquals(seqId + 3,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),2,privileges.size());
  for (  MSentryPrivilege mPrivilege : privileges) {
    assertEquals(server,mPrivilege.getServerName());
    assertEquals(db,mPrivilege.getDbName());
    assertEquals(table,mPrivilege.getTableName());
    assertFalse(mPrivilege.getGrantOption());
    if (mPrivilege.getColumnName().equals(column1)) {
      assertEquals(AccessConstants.ALL,mPrivilege.getAction());
    }
 else     if (mPrivilege.getColumnName().equals(column2)) {
      assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
    }
 else {
      fail("Unexpected column name: " + mPrivilege.getColumnName());
    }
  }
  privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.INSERT);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 4,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  assertEquals(column1,Iterables.get(privileges,0).getColumnName());
  assertEquals(AccessConstants.SELECT,Iterables.get(privileges,0).getAction());
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  assertEquals(seqId + 5,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),0,privileges.size());
}

</code></pre>

<pre class="type-12 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGrantRevokePrivilegeWithGrantOption() throws Exception {
  String roleName="test-grantOption-table";
  String grantor="g1";
  String server="server1";
  String db="db1";
  String table="tbl1";
  TSentryGrantOption grantOption=TSentryGrantOption.TRUE;
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  TSentryPrivilege privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("TABLE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setTableName(table);
  privilege.setAction(AccessConstants.ALL);
  privilege.setCreateTime(System.currentTimeMillis());
  privilege.setGrantOption(grantOption);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  Set<MSentryPrivilege> privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  assertEquals(Boolean.valueOf(privilege.getGrantOption().toString()),Iterables.get(privileges,0).getGrantOption());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege).getSequenceId());
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(0,privileges.size());
  roleName="test-grantOption-db";
  sentryStore.createSentryRole(roleName);
  privilege=new TSentryPrivilege();
  privilege.setPrivilegeScope("DATABASE");
  privilege.setServerName(server);
  privilege.setDbName(db);
  privilege.setAction(AccessConstants.ALL);
  privilege.setGrantOption(TSentryGrantOption.TRUE);
  privilege.setCreateTime(System.currentTimeMillis());
  privilege.setGrantOption(grantOption);
  sentryStore.alterSentryRoleGrantPrivilege(grantor,roleName,privilege);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  privilege.setAction(AccessConstants.SELECT);
  privilege.setGrantOption(TSentryGrantOption.UNSET);
  sentryStore.alterSentryRoleRevokePrivilege(grantor,roleName,privilege);
  role=sentryStore.getMSentryRoleByName(roleName);
  privileges=role.getPrivileges();
  assertEquals(privileges.toString(),1,privileges.size());
  MSentryPrivilege mPrivilege=Iterables.get(privileges,0);
  assertEquals(server,mPrivilege.getServerName());
  assertEquals(db,mPrivilege.getDbName());
  assertEquals(AccessConstants.INSERT,mPrivilege.getAction());
}

</code></pre>

<pre class="type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddDeleteGroups() throws Exception {
  String roleName="test-groups";
  String grantor="g1";
  long seqId=sentryStore.createSentryRole(roleName).getSequenceId();
  Set<TSentryGroup> groups=Sets.newHashSet();
  TSentryGroup group=new TSentryGroup();
  group.setGroupName("test-groups-g1");
  groups.add(group);
  group=new TSentryGroup();
  group.setGroupName("test-groups-g2");
  groups.add(group);
  assertEquals(seqId + 1,sentryStore.alterSentryRoleAddGroups(grantor,roleName,groups).getSequenceId());
  assertEquals(seqId + 2,sentryStore.alterSentryRoleDeleteGroups(roleName,groups).getSequenceId());
  MSentryRole role=sentryStore.getMSentryRoleByName(roleName);
  assertEquals(Collections.emptySet(),role.getGroups());
}

</code></pre>

<pre class="type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSentryRoleSize() throws Exception {
  for (long i=0; i < 5; i++) {
    assertEquals((Long)i,sentryStore.getRoleCountGauge().getValue());
    sentryStore.createSentryRole("role" + i);
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
