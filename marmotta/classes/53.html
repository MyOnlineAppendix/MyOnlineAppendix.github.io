<h3 style="margin:0px">Class: org.apache.marmotta.kiwi.test.RepositoryTest (16 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(14)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Sets implicit assumptions "><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >AssumptionSetter&nbsp;(4)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >ConditionMatcher&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-4 type-12 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test is for a strange bug that happens when running SPARQL updates that delete and reinsert a triple in
 * the same transaction. See https://issues.apache.org/jira/browse/MARMOTTA-283
 */
@Test public void testMARMOTTA283() throws RepositoryException, RDFParseException, IOException, MalformedQueryException, UpdateExecutionException {
  InputStream rdfXML=this.getClass().getResourceAsStream("demo-data.foaf");
  assumeThat("Could not load test-data: demo-data.foaf",rdfXML,notNullValue(InputStream.class));
  RepositoryConnection connectionRDF=repository.getConnection();
  try {
    connectionRDF.add(rdfXML,"http://localhost/foaf/",RDFFormat.RDFXML);
    connectionRDF.commit();
  }
  finally {
    connectionRDF.close();
  }
  String update="DELETE { ?s ?p ?o } INSERT { <http://localhost:8080/LMF/resource/hans_meier> <http://xmlns.com/foaf/0.1/name> \"Hans Meier\" . <http://localhost:8080/LMF/resource/hans_meier> <http://xmlns.com/foaf/0.1/based_near> <http://dbpedia.org/resource/Traunstein> . <http://localhost:8080/LMF/resource/hans_meier> <http://xmlns.com/foaf/0.1/interest> <http://rdf.freebase.com/ns/en.linux> } WHERE { ?s ?p ?o . FILTER ( ?s = <http://localhost:8080/LMF/resource/hans_meier> ) }";
  RepositoryConnection connectionUpdate=repository.getConnection();
  try {
    Update u=connectionUpdate.prepareUpdate(QueryLanguage.SPARQL,update);
    u.execute();
    connectionUpdate.commit();
  }
  finally {
    connectionUpdate.close();
  }
  RepositoryConnection connectionVerify=repository.getConnection();
  try {
    URI hans_meier=repository.getValueFactory().createURI("http://localhost:8080/LMF/resource/hans_meier");
    URI foaf_name=repository.getValueFactory().createURI("http://xmlns.com/foaf/0.1/name");
    URI foaf_based_near=repository.getValueFactory().createURI("http://xmlns.com/foaf/0.1/based_near");
    URI foaf_interest=repository.getValueFactory().createURI("http://xmlns.com/foaf/0.1/interest");
    URI freebase_linux=repository.getValueFactory().createURI("http://rdf.freebase.com/ns/en.linux");
    URI traunstein=repository.getValueFactory().createURI("http://dbpedia.org/resource/Traunstein");
    Assert.assertTrue(connectionVerify.hasStatement(hans_meier,foaf_name,null,true));
    Assert.assertTrue(connectionVerify.hasStatement(hans_meier,foaf_based_near,traunstein,true));
    Assert.assertTrue(connectionVerify.hasStatement(hans_meier,foaf_interest,freebase_linux,true));
    connectionVerify.commit();
  }
  finally {
    connectionVerify.close();
  }
}

</code></pre>

<pre class="type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * This test is for a strange bug that happens when running SPARQL updates that delete and reinsert a triple in
 * the same transaction. It is similar to #testMARMOTTA283, but simulates the issue in more detail.
 * See https://issues.apache.org/jira/browse/MARMOTTA-283
 */
@Test public void testMARMOTTA283_2() throws RepositoryException, RDFParseException, IOException, MalformedQueryException, UpdateExecutionException {
  String insert="WITH <http://resource.org/video>" + "INSERT {" + "   <http://resource.org/video> <http://ontology.org#hasFragment> <http://resource.org/fragment1>."+ "   <http://resource.org/annotation1> <http://ontology.org#hasTarget> <http://resource.org/fragment1>."+ "   <http://resource.org/annotation1> <http://ontology.org#hasBody> <http://resource.org/subject1>."+ "   <http://resource.org/fragment1> <http://ontology.org#shows> <http://resource.org/subject1>."+ "} WHERE {}";
  RepositoryConnection connectionInsert=repository.getConnection();
  try {
    Update u=connectionInsert.prepareUpdate(QueryLanguage.SPARQL,insert);
    u.execute();
    connectionInsert.commit();
  }
  finally {
    connectionInsert.close();
  }
  String update="WITH <http://resource.org/video>" + "DELETE { " + "   ?annotation ?p ?v."+ "   ?fragment ?r ?s."+ "   <http://resource.org/video> <http://ontology.org#hasFragment> ?fragment."+ "} INSERT {"+ "   <http://resource.org/video> <http://ontology.org#hasFragment> <http://resource.org/fragment1>."+ "   <http://resource.org/annotation1> <http://ontology.org#hasTarget> <http://resource.org/fragment1>."+ "   <http://resource.org/annotation1> <http://ontology.org#hasBody> <http://resource.org/subject1>."+ "   <http://resource.org/fragment1> <http://ontology.org#shows> <http://resource.org/subject1>."+ "} WHERE {"+ "   ?annotation <http://ontology.org#hasTarget> ?fragment."+ "   ?annotation ?p ?v."+ "   OPTIONAL {"+ "       ?fragment ?r ?s"+ "   }"+ "   FILTER (?fragment = <http://resource.org/fragment1>)"+ "} ";
  RepositoryConnection connectionUpdate=repository.getConnection();
  try {
    Update u=connectionUpdate.prepareUpdate(QueryLanguage.SPARQL,update);
    u.execute();
    connectionUpdate.commit();
  }
  finally {
    connectionUpdate.close();
  }
  RepositoryConnection connectionVerify=repository.getConnection();
  try {
    URI video=repository.getValueFactory().createURI("http://resource.org/video");
    URI hasFragment=repository.getValueFactory().createURI("http://ontology.org#hasFragment");
    URI fragment=repository.getValueFactory().createURI("http://resource.org/fragment1");
    URI annotation=repository.getValueFactory().createURI("http://resource.org/annotation1");
    URI hasTarget=repository.getValueFactory().createURI("http://ontology.org#hasTarget");
    URI hasBody=repository.getValueFactory().createURI("http://ontology.org#hasBody");
    URI subject=repository.getValueFactory().createURI("http://resource.org/subject1");
    URI shows=repository.getValueFactory().createURI("http://ontology.org#shows");
    Assert.assertTrue(connectionVerify.hasStatement(video,hasFragment,fragment,true,video));
    Assert.assertTrue(connectionVerify.hasStatement(annotation,hasTarget,fragment,true,video));
    Assert.assertTrue(connectionVerify.hasStatement(annotation,hasBody,subject,true,video));
    Assert.assertTrue(connectionVerify.hasStatement(fragment,shows,subject,true,video));
    connectionVerify.commit();
  }
  finally {
    connectionVerify.close();
  }
}

</code></pre>

<pre class="type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void initDatabase() throws RepositoryException {
  store=new KiWiStore(kiwiConfiguration);
  store.setDropTablesOnShutdown(true);
  repository=new SailRepository(store);
  repository.initialize();
}

</code></pre>

<pre class="type-11 type-4 type-12 type-3 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteTriple() throws RepositoryException, RDFParseException, IOException {
  InputStream rdfXML=this.getClass().getResourceAsStream("demo-data.foaf");
  assumeThat("Could not load test-data: demo-data.foaf",rdfXML,notNullValue(InputStream.class));
  RepositoryConnection connectionRDF=repository.getConnection();
  try {
    connectionRDF.add(rdfXML,"http://localhost/foaf/",RDFFormat.RDFXML);
    connectionRDF.commit();
  }
  finally {
    connectionRDF.close();
  }
  RepositoryConnection connection=repository.getConnection();
  try {
    connection.begin();
    List<String> resources=ImmutableList.copyOf(Iterables.transform(ResourceUtils.listResources(connection),new Function<Resource,String>(){
      @Override public String apply(      Resource input){
        return input.stringValue();
      }
    }
));
    Assert.assertEquals(30,resources.size());
    Assert.assertThat(resources,hasItems("http://localhost:8080/LMF/resource/hans_meier","http://localhost:8080/LMF/resource/sepp_huber","http://localhost:8080/LMF/resource/anna_schmidt"));
    long oldsize=connection.size();
    connection.commit();
    connection.begin();
    ResourceUtils.removeResource(connection,connection.getValueFactory().createURI("http://localhost:8080/LMF/resource/hans_meier"));
    connection.commit();
    connection.begin();
    long newsize=connection.size();
    Assert.assertThat(newsize,lessThan(oldsize));
    List<String> resources2=ImmutableList.copyOf(Iterables.transform(ResourceUtils.listSubjects(connection),new Function<Resource,String>(){
      @Override public String apply(      Resource input){
        return input.stringValue();
      }
    }
));
    Assert.assertThat(resources2,not(hasItem("http://localhost:8080/LMF/resource/hans_meier")));
  }
  finally {
    connection.commit();
    connection.close();
  }
}

</code></pre>

<pre class="type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test adding-deleting-adding a triple
 * @throws Exception
 */
@Test public void testRepeatedAddRemove() throws Exception {
  String value=RandomStringUtils.randomAlphanumeric(8);
  URI subject=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  URI predicate=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  Literal object1=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection1=repository.getConnection();
  try {
    connection1.add(subject,predicate,object1);
    connection1.commit();
    Assert.assertTrue(connection1.hasStatement(subject,predicate,object1,true));
    connection1.commit();
  }
  finally {
    connection1.close();
  }
  Literal object2=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection2=repository.getConnection();
  try {
    Assert.assertTrue(connection2.hasStatement(subject,predicate,object2,true));
    connection2.remove(subject,predicate,object2);
    connection2.commit();
    Assert.assertFalse(connection2.hasStatement(subject,predicate,object2,true));
    connection2.commit();
  }
  finally {
    connection2.close();
  }
  Literal object3=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection3=repository.getConnection();
  try {
    Assert.assertFalse(connection3.hasStatement(subject,predicate,object3,true));
    connection3.add(subject,predicate,object3);
    connection3.commit();
    Assert.assertTrue(connection3.hasStatement(subject,predicate,object3,true));
    connection3.commit();
  }
  finally {
    connection3.close();
  }
  Literal object4=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection4=repository.getConnection();
  try {
    Assert.assertTrue(connection4.hasStatement(subject,predicate,object4,true));
    connection4.commit();
  }
  finally {
    connection4.close();
  }
}

</code></pre>

<pre class="type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRepeatedAddRemoveSPARQL() throws RepositoryException, MalformedQueryException, UpdateExecutionException {
  String value=RandomStringUtils.randomAlphanumeric(8);
  URI subject=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  URI predicate=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  Literal object1=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection1=repository.getConnection();
  try {
    connection1.add(subject,predicate,object1);
    connection1.commit();
    Assert.assertTrue(connection1.hasStatement(subject,predicate,object1,true));
    connection1.commit();
  }
  finally {
    connection1.close();
  }
  RepositoryConnection connection2=repository.getConnection();
  try {
    String query=String.format("DELETE { <%s> <%s> ?v } INSERT { <%s> <%s> ?v . } WHERE { <%s> <%s> ?v }",subject.stringValue(),predicate.stringValue(),subject.stringValue(),predicate.stringValue(),subject.stringValue(),predicate.stringValue());
    Update u=connection2.prepareUpdate(QueryLanguage.SPARQL,query);
    u.execute();
    connection2.commit();
  }
  finally {
    connection2.close();
  }
  RepositoryConnection connection3=repository.getConnection();
  try {
    Assert.assertTrue(connection3.hasStatement(subject,predicate,object1,true));
    connection3.commit();
  }
  finally {
    connection3.close();
  }
}

</code></pre>

<pre class="type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test adding-deleting-adding a triple
 * @throws Exception
 */
@Test public void testRepeatedAddRemoveTransaction() throws Exception {
  String value=RandomStringUtils.randomAlphanumeric(8);
  URI subject=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  URI predicate=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  Literal object1=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection1=repository.getConnection();
  try {
    connection1.add(subject,predicate,object1);
    connection1.commit();
    Assert.assertTrue(connection1.hasStatement(subject,predicate,object1,true));
    connection1.commit();
  }
  finally {
    connection1.close();
  }
  Literal object2=repository.getValueFactory().createLiteral(value);
  Literal object3=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection2=repository.getConnection();
  try {
    Assert.assertTrue(connection2.hasStatement(subject,predicate,object2,true));
    connection2.remove(subject,predicate,object2);
    Assert.assertFalse(connection2.hasStatement(subject,predicate,object2,true));
    connection2.add(subject,predicate,object3);
    Assert.assertTrue(connection2.hasStatement(subject,predicate,object3,true));
    connection2.commit();
  }
  finally {
    connection2.close();
  }
  Literal object4=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection4=repository.getConnection();
  try {
    Assert.assertTrue(connection4.hasStatement(subject,predicate,object4,true));
    connection4.commit();
  }
  finally {
    connection4.close();
  }
  Literal object5=repository.getValueFactory().createLiteral(RandomStringUtils.randomAlphanumeric(8));
  RepositoryConnection connection5=repository.getConnection();
  try {
    Assert.assertFalse(connection5.hasStatement(subject,predicate,object5,true));
    connection5.add(subject,predicate,object5);
    Assert.assertTrue(connection5.hasStatement(subject,predicate,object5,true));
    connection5.remove(subject,predicate,object5);
    Assert.assertFalse(connection5.hasStatement(subject,predicate,object5,true));
    connection5.add(subject,predicate,object5);
    Assert.assertTrue(connection5.hasStatement(subject,predicate,object5,true));
    connection5.commit();
  }
  finally {
    connection5.close();
  }
  RepositoryConnection connection6=repository.getConnection();
  try {
    Assert.assertTrue(connection6.hasStatement(subject,predicate,object5,true));
    connection6.commit();
  }
  finally {
    connection6.close();
  }
}

</code></pre>

<pre class="type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * MARMOTTA-506 introduces a more efficient clearing of triples, which abandons some consistency guarantees. This
 * test aims to check for any side effect of this change.
 * @throws Exception
 */
@Test public void testFastClearSameTransaction() throws Exception {
  String value=RandomStringUtils.randomAlphanumeric(8);
  URI subject=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  URI predicate=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  Literal object1=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection1=repository.getConnection();
  try {
    connection1.add(subject,predicate,object1);
    Assert.assertTrue(connection1.hasStatement(subject,predicate,object1,true));
    connection1.clear();
    Assert.assertFalse(connection1.hasStatement(subject,predicate,object1,true));
    connection1.add(subject,predicate,object1);
    Assert.assertTrue(connection1.hasStatement(subject,predicate,object1,true));
    connection1.commit();
  }
  finally {
    connection1.close();
  }
}

</code></pre>

<pre class="type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test the concurrent connection problem reported in MARMOTTA-236 for facading:
 * - get two parallel connections
 * - add triple in connection 1; should be available in connection 1 and not in connection 2
 * - add same triple in connection 2; should be available in both, connection 1 and connection 2 or
 * fail-fast by throwing a ConcurrentModificationException
 * @throws Exception
 */
@Test public void testMARMOTTA236() throws Exception {
  RepositoryConnection con1=repository.getConnection();
  RepositoryConnection con2=repository.getConnection();
  try {
    URI r1=repository.getValueFactory().createURI("http://localhost/" + RandomStringUtils.randomAlphanumeric(8));
    URI r2=repository.getValueFactory().createURI("http://localhost/" + RandomStringUtils.randomAlphanumeric(8));
    URI r3=repository.getValueFactory().createURI("http://localhost/" + RandomStringUtils.randomAlphanumeric(8));
    con1.begin();
    con1.add(r1,r2,r3);
    Assert.assertTrue(con1.hasStatement(r1,r2,r3,true));
    con2.begin();
    Assert.assertFalse(con2.hasStatement(r1,r2,r3,true));
    con2.add(r1,r2,r3);
    Assert.assertTrue(con2.hasStatement(r1,r2,r3,true));
    con2.rollback();
    con1.commit();
  }
 catch (  ConcurrentModificationException ex) {
  }
 finally {
    con1.close();
    con2.close();
  }
}

</code></pre>

<pre class="type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * MARMOTTA-506 introduces a more efficient clearing of triples, which abandons some consistency guarantees. This
 * test aims to check for any side effect of this change.
 * @throws Exception
 */
@Test public void testFastClearDifferentTransactions() throws Exception {
  String value=RandomStringUtils.randomAlphanumeric(8);
  URI subject=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  URI predicate=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  Literal object1=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection1=repository.getConnection();
  try {
    connection1.add(subject,predicate,object1);
    connection1.commit();
    Assert.assertTrue(connection1.hasStatement(subject,predicate,object1,true));
    connection1.commit();
  }
  finally {
    connection1.close();
  }
  RepositoryConnection connection2=repository.getConnection();
  try {
    connection2.clear();
    connection2.commit();
    Assert.assertFalse(connection2.hasStatement(subject,predicate,object1,true));
    connection2.commit();
  }
  finally {
    connection2.close();
  }
  RepositoryConnection connection3=repository.getConnection();
  try {
    connection3.add(subject,predicate,object1);
    connection3.commit();
    Assert.assertTrue(connection3.hasStatement(subject,predicate,object1,true));
    connection3.commit();
  }
  finally {
    connection3.close();
  }
}

</code></pre>

<pre class="type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRepeatedAddRemoveCrossTransaction() throws RepositoryException {
  String value=RandomStringUtils.randomAlphanumeric(8);
  URI subject=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  URI predicate=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  Literal object1=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection1=repository.getConnection();
  try {
    connection1.add(subject,predicate,object1);
    connection1.commit();
    Assert.assertTrue(connection1.hasStatement(subject,predicate,object1,true));
    connection1.commit();
  }
  finally {
    connection1.close();
  }
  RepositoryConnection connection2=repository.getConnection();
  try {
    connection2.remove(subject,predicate,object1);
    Assert.assertFalse(connection2.hasStatement(subject,predicate,object1,true));
    connection2.add(subject,predicate,object1);
    Assert.assertTrue(connection2.hasStatement(subject,predicate,object1,true));
    connection2.commit();
  }
  finally {
    connection2.close();
  }
  RepositoryConnection connection3=repository.getConnection();
  try {
    Assert.assertTrue(connection3.hasStatement(subject,predicate,object1,true));
    connection3.commit();
  }
  finally {
    connection3.close();
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void dropDatabase() throws RepositoryException, SQLException {
  repository.shutDown();
}

</code></pre>

<pre class="type-11 type-4 type-12 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test importing data; the test will load a small sample RDF file and check whether the expected resources are
 * present.
 * @throws RepositoryException
 * @throws RDFParseException
 * @throws IOException
 */
@Test public void testImport() throws RepositoryException, RDFParseException, IOException {
  long start, end;
  start=System.currentTimeMillis();
  InputStream rdfXML=this.getClass().getResourceAsStream("demo-data.foaf");
  assumeThat("Could not load test-data: demo-data.foaf",rdfXML,notNullValue(InputStream.class));
  RepositoryConnection connectionRDF=repository.getConnection();
  try {
    connectionRDF.add(rdfXML,"http://localhost/foaf/",RDFFormat.RDFXML);
    connectionRDF.commit();
  }
  finally {
    connectionRDF.close();
  }
  end=System.currentTimeMillis();
  log.info("IMPORT: {} ms",end - start);
  start=System.currentTimeMillis();
  RepositoryConnection connection=repository.getConnection();
  List<String> resources=ImmutableList.copyOf(Iterables.transform(ResourceUtils.listResources(connection),new Function<Resource,String>(){
    @Override public String apply(    Resource input){
      return input.stringValue();
    }
  }
));
  Assert.assertThat(resources,hasItems("http://localhost:8080/LMF/resource/hans_meier","http://localhost:8080/LMF/resource/sepp_huber","http://localhost:8080/LMF/resource/anna_schmidt"));
  connection.commit();
  connection.close();
  end=System.currentTimeMillis();
  log.info("QUERY EVALUATION: {} ms",end - start);
}

</code></pre>

<pre class="type-4 type-3 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test setting, retrieving and updating namespaces through the repository API
 * @throws RepositoryException
 */
@Test @SuppressWarnings("unchecked") public void testNamespaces() throws RepositoryException {
  RepositoryConnection connection=repository.getConnection();
  connection.begin();
  connection.setNamespace("ns1","http://localhost/ns1/");
  connection.setNamespace("ns2","http://localhost/ns2/");
  connection.commit();
  Assert.assertEquals("http://localhost/ns1/",connection.getNamespace("ns1"));
  Assert.assertEquals("http://localhost/ns2/",connection.getNamespace("ns2"));
  Assert.assertEquals(2,Iterations.asList(connection.getNamespaces()).size());
  Assert.assertThat(Iterations.asList(connection.getNamespaces()),CoreMatchers.<Namespace>hasItems(hasProperty("name",is("http://localhost/ns1/")),hasProperty("name",is("http://localhost/ns2/"))));
  connection.begin();
  connection.setNamespace("ns1","http://localhost/ns3/");
  connection.commit();
  Assert.assertEquals("http://localhost/ns3/",connection.getNamespace("ns1"));
  Assert.assertThat(Iterations.asList(connection.getNamespaces()),CoreMatchers.<Namespace>hasItems(hasProperty("name",is("http://localhost/ns3/")),hasProperty("name",is("http://localhost/ns2/"))));
  connection.begin();
  connection.removeNamespace("ns2");
  connection.commit();
  connection.begin();
  Assert.assertEquals(1,Iterations.asList(connection.getNamespaces()).size());
  connection.commit();
  connection.close();
}

</code></pre>

<pre class="type-4 type-12 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a repeated addition of the same triple, because this is a special case in the database.
 */
@Test public void testRepeatedAdd() throws RepositoryException, IOException, RDFParseException {
  InputStream rdfXML=this.getClass().getResourceAsStream("srfg-ontology.rdf");
  assumeThat("Could not load test-data: srfg-ontology.rdf",rdfXML,notNullValue(InputStream.class));
  long oldsize, newsize;
  List<Statement> oldTriples, newTriples;
  RepositoryConnection connectionRDF=repository.getConnection();
  try {
    connectionRDF.begin();
    connectionRDF.add(rdfXML,"http://localhost/srfg/",RDFFormat.RDFXML);
    connectionRDF.commit();
    oldTriples=Iterations.asList(connectionRDF.getStatements(null,null,null,true));
    oldsize=connectionRDF.size();
  }
  finally {
    connectionRDF.close();
  }
  rdfXML=this.getClass().getResourceAsStream("srfg-ontology.rdf");
  RepositoryConnection connection=repository.getConnection();
  try {
    connection.begin();
    connection.add(rdfXML,"http://localhost/srfg/",RDFFormat.RDFXML);
    connection.commit();
    newTriples=Iterations.asList(connection.getStatements(null,null,null,true));
    newsize=connection.size();
  }
  finally {
    connection.commit();
    connection.close();
  }
  Assert.assertEquals(oldTriples,newTriples);
  Assert.assertEquals(oldsize,newsize);
}

</code></pre>

<pre class="type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test the rollback functionality of the triple store by adding a triple, rolling back, adding the triple again.
 * @throws Exception
 */
@Test public void testRollback() throws Exception {
  String value=RandomStringUtils.randomAlphanumeric(8);
  URI subject=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  URI predicate=repository.getValueFactory().createURI("http://localhost/resource/" + RandomStringUtils.randomAlphanumeric(8));
  Literal object=repository.getValueFactory().createLiteral(value);
  RepositoryConnection connection1=repository.getConnection();
  try {
    connection1.begin();
    connection1.add(subject,predicate,object);
    connection1.rollback();
  }
  finally {
    connection1.close();
  }
  RepositoryConnection connection2=repository.getConnection();
  try {
    connection2.begin();
    Assert.assertFalse(connection2.hasStatement(subject,predicate,object,true));
    connection2.add(subject,predicate,object);
    connection2.commit();
    Assert.assertTrue(connection2.hasStatement(subject,predicate,object,true));
    connection2.commit();
  }
  finally {
    connection2.close();
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
