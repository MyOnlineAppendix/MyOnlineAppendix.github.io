<h3 style="margin:0px">Class: org.apache.cassandra.service.MoveTest (9 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(4)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMoveWithPendingRangesForSimpleStrategyFourNode() throws Exception {
  StorageService ss=StorageService.instance;
  final int RING_SIZE=4;
  TokenMetadata tmd=ss.getTokenMetadata();
  tmd.clearUnsafe();
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  ArrayList<Token> endpointTokens=new ArrayList<>();
  ArrayList<Token> keyTokens=new ArrayList<>();
  List<InetAddress> hosts=new ArrayList<>();
  List<UUID> hostIds=new ArrayList<>();
  Util.createInitialRing(ss,partitioner,endpointTokens,keyTokens,hosts,hostIds,RING_SIZE);
  PendingRangeCalculatorService.instance.blockUntilFinished();
  int MOVING_NODE=0;
  moveHost(hosts.get(MOVING_NODE),2,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.1")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.1")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.1")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),2,tmd);
  moveHost(hosts.get(MOVING_NODE),0,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.2")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.3")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.4")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),0,tmd);
  moveHost(hosts.get(MOVING_NODE),1500,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1500,0,"127.0.0.2")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1500,0,"127.0.0.3")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1500,0,"127.0.0.4")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),1500,tmd);
  moveHost(hosts.get(MOVING_NODE),0,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1500,0,"127.0.0.1")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1500,0,"127.0.0.1")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1500,0,"127.0.0.1")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),0,tmd);
  moveHost(hosts.get(MOVING_NODE),15,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(10,15,"127.0.0.1"),generatePendingMapEntry(30,0,"127.0.0.2")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(20,30,"127.0.0.2"),generatePendingMapEntry(10,15,"127.0.0.1"),generatePendingMapEntry(0,10,"127.0.0.1")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(15,20,"127.0.0.2"),generatePendingMapEntry(0,10,"127.0.0.1")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),15,tmd);
  moveHost(hosts.get(MOVING_NODE),0,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,0,"127.0.0.1"),generatePendingMapEntry(10,15,"127.0.0.3")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(20,30,"127.0.0.1"),generatePendingMapEntry(10,15,"127.0.0.4"),generatePendingMapEntry(0,10,"127.0.0.3")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(15,20,"127.0.0.1"),generatePendingMapEntry(0,10,"127.0.0.4")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),0,tmd);
  moveHost(hosts.get(MOVING_NODE),26,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(20,26,"127.0.0.1"),generatePendingMapEntry(30,0,"127.0.0.2")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(26,30,"127.0.0.2"),generatePendingMapEntry(30,0,"127.0.0.3"),generatePendingMapEntry(10,20,"127.0.0.1")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,10,"127.0.0.1"),generatePendingMapEntry(26,30,"127.0.0.3")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),26,tmd);
  moveHost(hosts.get(MOVING_NODE),0,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(20,26,"127.0.0.4"),generatePendingMapEntry(30,0,"127.0.0.1")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,0,"127.0.0.1"),generatePendingMapEntry(26,30,"127.0.0.1"),generatePendingMapEntry(10,20,"127.0.0.4")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(26,30,"127.0.0.1"),generatePendingMapEntry(0,10,"127.0.0.4")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),0,tmd);
  MOVING_NODE=3;
  moveHost(hosts.get(MOVING_NODE),33,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,33,"127.0.0.4")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,33,"127.0.0.4")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,33,"127.0.0.4")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),33,tmd);
  moveHost(hosts.get(MOVING_NODE),30,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,33,"127.0.0.1")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,33,"127.0.0.2")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,33,"127.0.0.3")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),30,tmd);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void clearTokenMetadata(){
  PendingRangeCalculatorService.instance.blockUntilFinished();
  StorageService.instance.getTokenMetadata().clearUnsafe();
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMoveWithPendingRangesNetworkStrategyRackAwareThirtyNodes() throws Exception {
  StorageService ss=StorageService.instance;
  final int RING_SIZE=60;
  TokenMetadata tmd=ss.getTokenMetadata();
  tmd.clearUnsafe();
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  ArrayList<Token> endpointTokens=new ArrayList<>();
  ArrayList<Token> keyTokens=new ArrayList<>();
  List<InetAddress> hosts=new ArrayList<>();
  List<UUID> hostIds=new ArrayList<>();
  for (int i=0; i < RING_SIZE / 2; i++) {
    endpointTokens.add(new BigIntegerToken(String.valueOf(10 * i)));
    endpointTokens.add(new BigIntegerToken(String.valueOf((10 * i) + 1)));
  }
  Util.createInitialRing(ss,partitioner,endpointTokens,keyTokens,hosts,hostIds,RING_SIZE);
  PendingRangeCalculatorService.instance.blockUntilFinished();
  int MOVING_NODE=36;
  moveHost(hosts.get(MOVING_NODE),215,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(150,151,"127.0.0.43"),generatePendingMapEntry(151,160,"127.0.0.43"),generatePendingMapEntry(160,161,"127.0.0.43"),generatePendingMapEntry(161,170,"127.0.0.43"),generatePendingMapEntry(170,171,"127.0.0.43"),generatePendingMapEntry(171,180,"127.0.0.43"),generatePendingMapEntry(210,211,"127.0.0.37"),generatePendingMapEntry(211,215,"127.0.0.37")),Network_33_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),215,tmd);
  moveHost(hosts.get(MOVING_NODE),180,tmd,valueFactory);
  finishMove(hosts.get(MOVING_NODE),180,tmd);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void tearDown(){
  StorageService.instance.setPartitionerUnsafe(oldPartitioner);
}

</code></pre>

<pre class="type-7 type-13 type-4 type-5 type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void newTestWriteEndpointsDuringMove() throws Exception {
  StorageService ss=StorageService.instance;
  final int RING_SIZE=10;
  final int MOVING_NODE=3;
  TokenMetadata tmd=ss.getTokenMetadata();
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  ArrayList<Token> endpointTokens=new ArrayList<Token>();
  ArrayList<Token> keyTokens=new ArrayList<Token>();
  List<InetAddress> hosts=new ArrayList<InetAddress>();
  List<UUID> hostIds=new ArrayList<UUID>();
  Util.createInitialRing(ss,partitioner,endpointTokens,keyTokens,hosts,hostIds,RING_SIZE);
  Map<Token,List<InetAddress>> expectedEndpoints=new HashMap<Token,List<InetAddress>>();
  for (  Token token : keyTokens) {
    List<InetAddress> endpoints=new ArrayList<InetAddress>();
    Iterator<Token> tokenIter=TokenMetadata.ringIterator(tmd.sortedTokens(),token,false);
    while (tokenIter.hasNext()) {
      endpoints.add(tmd.getEndpoint(tokenIter.next()));
    }
    expectedEndpoints.put(token,endpoints);
  }
  Token newToken=positionToken(MOVING_NODE);
  ss.onChange(hosts.get(MOVING_NODE),ApplicationState.STATUS,valueFactory.moving(newToken));
  PendingRangeCalculatorService.instance.blockUntilFinished();
  assertTrue(tmd.isMoving(hosts.get(MOVING_NODE)));
  AbstractReplicationStrategy strategy;
  for (  String keyspaceName : Schema.instance.getNonSystemKeyspaces()) {
    strategy=getStrategy(keyspaceName,tmd);
    if (strategy instanceof NetworkTopologyStrategy)     continue;
    int numMoved=0;
    for (    Token token : keyTokens) {
      int replicationFactor=strategy.getReplicationFactor();
      HashSet<InetAddress> actual=new HashSet<InetAddress>(tmd.getWriteEndpoints(token,keyspaceName,strategy.calculateNaturalEndpoints(token,tmd.cloneOnlyTokenMap())));
      HashSet<InetAddress> expected=new HashSet<InetAddress>();
      for (int i=0; i < replicationFactor; i++) {
        expected.add(expectedEndpoints.get(token).get(i));
      }
      if (expected.size() == actual.size()) {
        assertEquals("mismatched endpoint sets",expected,actual);
      }
 else {
        expected.add(hosts.get(MOVING_NODE));
        assertEquals("mismatched endpoint sets",expected,actual);
        numMoved++;
      }
    }
    assertEquals("mismatched number of moved token",1,numMoved);
  }
  ss.onChange(hosts.get(MOVING_NODE),ApplicationState.STATUS,valueFactory.normal(Collections.singleton(newToken)));
}

</code></pre>

<pre class="type-6 type-7 type-4 type-5 type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSimultaneousMove() throws UnknownHostException {
  StorageService ss=StorageService.instance;
  final int RING_SIZE=10;
  TokenMetadata tmd=ss.getTokenMetadata();
  IPartitioner partitioner=RandomPartitioner.instance;
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  ArrayList<Token> endpointTokens=new ArrayList<Token>();
  ArrayList<Token> keyTokens=new ArrayList<Token>();
  List<InetAddress> hosts=new ArrayList<InetAddress>();
  List<UUID> hostIds=new ArrayList<UUID>();
  Util.createInitialRing(ss,partitioner,endpointTokens,keyTokens,hosts,hostIds,RING_SIZE);
  final int[] MOVING=new int[]{6,8,9};
  Map<Integer,Token> newTokens=new HashMap<Integer,Token>();
  for (  int movingIndex : MOVING) {
    Token newToken=positionToken(movingIndex);
    ss.onChange(hosts.get(movingIndex),ApplicationState.STATUS,valueFactory.moving(newToken));
    newTokens.put(movingIndex,newToken);
  }
  Collection<InetAddress> endpoints;
  tmd=tmd.cloneAfterAllSettled();
  ss.setTokenMetadataUnsafe(tmd);
  InetAddress boot1=InetAddress.getByName("127.0.1.1");
  Gossiper.instance.initializeNodeUnsafe(boot1,UUID.randomUUID(),1);
  Gossiper.instance.injectApplicationState(boot1,ApplicationState.TOKENS,valueFactory.tokens(Collections.singleton(keyTokens.get(5))));
  ss.onChange(boot1,ApplicationState.STATUS,valueFactory.bootstrapping(Collections.<Token>singleton(keyTokens.get(5))));
  PendingRangeCalculatorService.instance.blockUntilFinished();
  InetAddress boot2=InetAddress.getByName("127.0.1.2");
  Gossiper.instance.initializeNodeUnsafe(boot2,UUID.randomUUID(),1);
  Gossiper.instance.injectApplicationState(boot2,ApplicationState.TOKENS,valueFactory.tokens(Collections.singleton(keyTokens.get(7))));
  ss.onChange(boot2,ApplicationState.STATUS,valueFactory.bootstrapping(Collections.<Token>singleton(keyTokens.get(7))));
  PendingRangeCalculatorService.instance.blockUntilFinished();
  Map<String,AbstractReplicationStrategy> keyspaceStrategyMap=new HashMap<String,AbstractReplicationStrategy>();
  for (int i=1; i <= 4; i++) {
    keyspaceStrategyMap.put("MoveTestKeyspace" + i,getStrategy("MoveTestKeyspace" + i,tmd));
  }
  Multimap<InetAddress,Range<Token>> keyspace1ranges=keyspaceStrategyMap.get(Simple_RF1_KeyspaceName).getAddressRanges();
  Collection<Range<Token>> ranges1=keyspace1ranges.get(InetAddress.getByName("127.0.0.1"));
  assertEquals(1,collectionSize(ranges1));
  assertEquals(generateRange(97,0),ranges1.iterator().next());
  Collection<Range<Token>> ranges2=keyspace1ranges.get(InetAddress.getByName("127.0.0.2"));
  assertEquals(1,collectionSize(ranges2));
  assertEquals(generateRange(0,10),ranges2.iterator().next());
  Collection<Range<Token>> ranges3=keyspace1ranges.get(InetAddress.getByName("127.0.0.3"));
  assertEquals(1,collectionSize(ranges3));
  assertEquals(generateRange(10,20),ranges3.iterator().next());
  Collection<Range<Token>> ranges4=keyspace1ranges.get(InetAddress.getByName("127.0.0.4"));
  assertEquals(1,collectionSize(ranges4));
  assertEquals(generateRange(20,30),ranges4.iterator().next());
  Collection<Range<Token>> ranges5=keyspace1ranges.get(InetAddress.getByName("127.0.0.5"));
  assertEquals(1,collectionSize(ranges5));
  assertEquals(generateRange(30,40),ranges5.iterator().next());
  Collection<Range<Token>> ranges6=keyspace1ranges.get(InetAddress.getByName("127.0.0.6"));
  assertEquals(1,collectionSize(ranges6));
  assertEquals(generateRange(40,50),ranges6.iterator().next());
  Collection<Range<Token>> ranges7=keyspace1ranges.get(InetAddress.getByName("127.0.0.7"));
  assertEquals(1,collectionSize(ranges7));
  assertEquals(generateRange(50,67),ranges7.iterator().next());
  Collection<Range<Token>> ranges8=keyspace1ranges.get(InetAddress.getByName("127.0.0.8"));
  assertEquals(1,collectionSize(ranges8));
  assertEquals(generateRange(67,70),ranges8.iterator().next());
  Collection<Range<Token>> ranges9=keyspace1ranges.get(InetAddress.getByName("127.0.0.9"));
  assertEquals(1,collectionSize(ranges9));
  assertEquals(generateRange(70,87),ranges9.iterator().next());
  Collection<Range<Token>> ranges10=keyspace1ranges.get(InetAddress.getByName("127.0.0.10"));
  assertEquals(1,collectionSize(ranges10));
  assertEquals(generateRange(87,97),ranges10.iterator().next());
  Multimap<InetAddress,Range<Token>> keyspace3ranges=keyspaceStrategyMap.get(KEYSPACE3).getAddressRanges();
  ranges1=keyspace3ranges.get(InetAddress.getByName("127.0.0.1"));
  assertEquals(collectionSize(ranges1),5);
  assertTrue(ranges1.equals(generateRanges(97,0,70,87,50,67,87,97,67,70)));
  ranges2=keyspace3ranges.get(InetAddress.getByName("127.0.0.2"));
  assertEquals(collectionSize(ranges2),5);
  assertTrue(ranges2.equals(generateRanges(97,0,70,87,87,97,0,10,67,70)));
  ranges3=keyspace3ranges.get(InetAddress.getByName("127.0.0.3"));
  assertEquals(collectionSize(ranges3),5);
  assertTrue(ranges3.equals(generateRanges(97,0,70,87,87,97,0,10,10,20)));
  ranges4=keyspace3ranges.get(InetAddress.getByName("127.0.0.4"));
  assertEquals(collectionSize(ranges4),5);
  assertTrue(ranges4.equals(generateRanges(97,0,20,30,87,97,0,10,10,20)));
  ranges5=keyspace3ranges.get(InetAddress.getByName("127.0.0.5"));
  assertEquals(collectionSize(ranges5),5);
  assertTrue(ranges5.equals(generateRanges(97,0,30,40,20,30,0,10,10,20)));
  ranges6=keyspace3ranges.get(InetAddress.getByName("127.0.0.6"));
  assertEquals(collectionSize(ranges6),5);
  assertTrue(ranges6.equals(generateRanges(40,50,30,40,20,30,0,10,10,20)));
  ranges7=keyspace3ranges.get(InetAddress.getByName("127.0.0.7"));
  assertEquals(collectionSize(ranges7),5);
  assertTrue(ranges7.equals(generateRanges(40,50,30,40,50,67,20,30,10,20)));
  ranges8=keyspace3ranges.get(InetAddress.getByName("127.0.0.8"));
  assertEquals(collectionSize(ranges8),5);
  assertTrue(ranges8.equals(generateRanges(40,50,30,40,50,67,20,30,67,70)));
  ranges9=keyspace3ranges.get(InetAddress.getByName("127.0.0.9"));
  assertEquals(collectionSize(ranges9),5);
  assertTrue(ranges9.equals(generateRanges(40,50,70,87,30,40,50,67,67,70)));
  ranges10=keyspace3ranges.get(InetAddress.getByName("127.0.0.10"));
  assertEquals(collectionSize(ranges10),5);
  assertTrue(ranges10.equals(generateRanges(40,50,70,87,50,67,87,97,67,70)));
  Multimap<InetAddress,Range<Token>> keyspace4ranges=keyspaceStrategyMap.get(Simple_RF3_KeyspaceName).getAddressRanges();
  ranges1=keyspace4ranges.get(InetAddress.getByName("127.0.0.1"));
  assertEquals(collectionSize(ranges1),3);
  assertTrue(ranges1.equals(generateRanges(97,0,70,87,87,97)));
  ranges2=keyspace4ranges.get(InetAddress.getByName("127.0.0.2"));
  assertEquals(collectionSize(ranges2),3);
  assertTrue(ranges2.equals(generateRanges(97,0,87,97,0,10)));
  ranges3=keyspace4ranges.get(InetAddress.getByName("127.0.0.3"));
  assertEquals(collectionSize(ranges3),3);
  assertTrue(ranges3.equals(generateRanges(97,0,0,10,10,20)));
  ranges4=keyspace4ranges.get(InetAddress.getByName("127.0.0.4"));
  assertEquals(collectionSize(ranges4),3);
  assertTrue(ranges4.equals(generateRanges(20,30,0,10,10,20)));
  ranges5=keyspace4ranges.get(InetAddress.getByName("127.0.0.5"));
  assertEquals(collectionSize(ranges5),3);
  assertTrue(ranges5.equals(generateRanges(30,40,20,30,10,20)));
  ranges6=keyspace4ranges.get(InetAddress.getByName("127.0.0.6"));
  assertEquals(collectionSize(ranges6),3);
  assertTrue(ranges6.equals(generateRanges(40,50,30,40,20,30)));
  ranges7=keyspace4ranges.get(InetAddress.getByName("127.0.0.7"));
  assertEquals(collectionSize(ranges7),3);
  assertTrue(ranges7.equals(generateRanges(40,50,30,40,50,67)));
  ranges8=keyspace4ranges.get(InetAddress.getByName("127.0.0.8"));
  assertEquals(collectionSize(ranges8),3);
  assertTrue(ranges8.equals(generateRanges(40,50,50,67,67,70)));
  ranges9=keyspace4ranges.get(InetAddress.getByName("127.0.0.9"));
  assertEquals(collectionSize(ranges9),3);
  assertTrue(ranges9.equals(generateRanges(70,87,50,67,67,70)));
  ranges10=keyspace4ranges.get(InetAddress.getByName("127.0.0.10"));
  assertEquals(collectionSize(ranges10),3);
  assertTrue(ranges10.equals(generateRanges(70,87,87,97,67,70)));
  Map<String,Multimap<Token,InetAddress>> expectedEndpoints=new HashMap<String,Multimap<Token,InetAddress>>();
  expectedEndpoints.put(Simple_RF1_KeyspaceName,HashMultimap.<Token,InetAddress>create());
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("5"),makeAddrs("127.0.0.2"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("15"),makeAddrs("127.0.0.3"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("25"),makeAddrs("127.0.0.4"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("35"),makeAddrs("127.0.0.5"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("45"),makeAddrs("127.0.0.6"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("55"),makeAddrs("127.0.0.7","127.0.1.1"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("65"),makeAddrs("127.0.0.7"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("75"),makeAddrs("127.0.0.9","127.0.1.2"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("85"),makeAddrs("127.0.0.9"));
  expectedEndpoints.get(Simple_RF1_KeyspaceName).putAll(new BigIntegerToken("95"),makeAddrs("127.0.0.10"));
  expectedEndpoints.put(KEYSPACE2,HashMultimap.<Token,InetAddress>create());
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("5"),makeAddrs("127.0.0.2"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("15"),makeAddrs("127.0.0.3"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("25"),makeAddrs("127.0.0.4"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("35"),makeAddrs("127.0.0.5"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("45"),makeAddrs("127.0.0.6"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("55"),makeAddrs("127.0.0.7","127.0.1.1"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("65"),makeAddrs("127.0.0.7"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("75"),makeAddrs("127.0.0.9","127.0.1.2"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("85"),makeAddrs("127.0.0.9"));
  expectedEndpoints.get(KEYSPACE2).putAll(new BigIntegerToken("95"),makeAddrs("127.0.0.10"));
  expectedEndpoints.put(KEYSPACE3,HashMultimap.<Token,InetAddress>create());
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("5"),makeAddrs("127.0.0.2","127.0.0.3","127.0.0.4","127.0.0.5","127.0.0.6"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("15"),makeAddrs("127.0.0.3","127.0.0.4","127.0.0.5","127.0.0.6","127.0.0.7","127.0.1.1"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("25"),makeAddrs("127.0.0.4","127.0.0.5","127.0.0.6","127.0.0.7","127.0.0.8","127.0.1.1"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("35"),makeAddrs("127.0.0.5","127.0.0.6","127.0.0.7","127.0.0.8","127.0.0.9","127.0.1.1","127.0.1.2"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("45"),makeAddrs("127.0.0.6","127.0.0.7","127.0.0.8","127.0.0.9","127.0.0.10","127.0.1.1","127.0.1.2"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("55"),makeAddrs("127.0.0.7","127.0.0.8","127.0.0.9","127.0.0.10","127.0.0.1","127.0.1.1","127.0.1.2"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("65"),makeAddrs("127.0.0.7","127.0.0.8","127.0.0.9","127.0.0.10","127.0.0.1","127.0.1.2"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("75"),makeAddrs("127.0.0.9","127.0.0.10","127.0.0.1","127.0.0.2","127.0.0.3","127.0.1.2"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("85"),makeAddrs("127.0.0.9","127.0.0.10","127.0.0.1","127.0.0.2","127.0.0.3"));
  expectedEndpoints.get(KEYSPACE3).putAll(new BigIntegerToken("95"),makeAddrs("127.0.0.10","127.0.0.1","127.0.0.2","127.0.0.3","127.0.0.4"));
  expectedEndpoints.put(Simple_RF3_KeyspaceName,HashMultimap.<Token,InetAddress>create());
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("5"),makeAddrs("127.0.0.2","127.0.0.3","127.0.0.4"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("15"),makeAddrs("127.0.0.3","127.0.0.4","127.0.0.5"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("25"),makeAddrs("127.0.0.4","127.0.0.5","127.0.0.6"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("35"),makeAddrs("127.0.0.5","127.0.0.6","127.0.0.7","127.0.1.1"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("45"),makeAddrs("127.0.0.6","127.0.0.7","127.0.0.8","127.0.1.1"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("55"),makeAddrs("127.0.0.7","127.0.0.8","127.0.0.9","127.0.1.1","127.0.1.2"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("65"),makeAddrs("127.0.0.7","127.0.0.8","127.0.0.9","127.0.1.2"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("75"),makeAddrs("127.0.0.9","127.0.0.10","127.0.0.1","127.0.1.2"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("85"),makeAddrs("127.0.0.9","127.0.0.10","127.0.0.1"));
  expectedEndpoints.get(Simple_RF3_KeyspaceName).putAll(new BigIntegerToken("95"),makeAddrs("127.0.0.10","127.0.0.1","127.0.0.2"));
  for (  Map.Entry<String,AbstractReplicationStrategy> keyspaceStrategy : keyspaceStrategyMap.entrySet()) {
    String keyspaceName=keyspaceStrategy.getKey();
    AbstractReplicationStrategy strategy=keyspaceStrategy.getValue();
    for (    Token token : keyTokens) {
      endpoints=tmd.getWriteEndpoints(token,keyspaceName,strategy.getNaturalEndpoints(token));
      assertEquals(expectedEndpoints.get(keyspaceName).get(token).size(),endpoints.size());
      assertTrue(expectedEndpoints.get(keyspaceName).get(token).containsAll(endpoints));
    }
    if (strategy.getReplicationFactor() != 3)     continue;
    for (int i=0; i < 3; i++) {
      endpoints=tmd.getWriteEndpoints(keyTokens.get(i),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(i)));
      assertEquals(3,endpoints.size());
      assertTrue(endpoints.contains(hosts.get(i + 1)));
      assertTrue(endpoints.contains(hosts.get(i + 2)));
      assertTrue(endpoints.contains(hosts.get(i + 3)));
    }
    endpoints=tmd.getWriteEndpoints(keyTokens.get(3),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(3)));
    assertEquals(4,endpoints.size());
    assertTrue(endpoints.contains(hosts.get(4)));
    assertTrue(endpoints.contains(hosts.get(5)));
    assertTrue(endpoints.contains(hosts.get(6)));
    assertTrue(endpoints.contains(boot1));
    endpoints=tmd.getWriteEndpoints(keyTokens.get(4),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(4)));
    assertEquals(4,endpoints.size());
    assertTrue(endpoints.contains(hosts.get(5)));
    assertTrue(endpoints.contains(hosts.get(6)));
    assertTrue(endpoints.contains(hosts.get(7)));
    assertTrue(endpoints.contains(boot1));
    endpoints=tmd.getWriteEndpoints(keyTokens.get(5),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(5)));
    assertEquals(5,endpoints.size());
    assertTrue(endpoints.contains(hosts.get(6)));
    assertTrue(endpoints.contains(hosts.get(7)));
    assertTrue(endpoints.contains(hosts.get(8)));
    assertTrue(endpoints.contains(boot1));
    assertTrue(endpoints.contains(boot2));
    endpoints=tmd.getWriteEndpoints(keyTokens.get(6),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(6)));
    assertEquals(4,endpoints.size());
    assertTrue(endpoints.contains(hosts.get(6)));
    assertTrue(endpoints.contains(hosts.get(7)));
    assertTrue(endpoints.contains(hosts.get(8)));
    assertTrue(endpoints.contains(boot2));
    endpoints=tmd.getWriteEndpoints(keyTokens.get(7),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(7)));
    assertEquals(4,endpoints.size());
    assertTrue(endpoints.contains(hosts.get(8)));
    assertTrue(endpoints.contains(hosts.get(9)));
    assertTrue(endpoints.contains(hosts.get(0)));
    assertTrue(endpoints.contains(boot2));
    endpoints=tmd.getWriteEndpoints(keyTokens.get(8),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(8)));
    assertEquals(3,endpoints.size());
    assertTrue(endpoints.contains(hosts.get(8)));
    assertTrue(endpoints.contains(hosts.get(9)));
    assertTrue(endpoints.contains(hosts.get(0)));
    endpoints=tmd.getWriteEndpoints(keyTokens.get(9),keyspaceName,strategy.getNaturalEndpoints(keyTokens.get(9)));
    assertEquals(3,endpoints.size());
    assertTrue(endpoints.contains(hosts.get(9)));
    assertTrue(endpoints.contains(hosts.get(0)));
    assertTrue(endpoints.contains(hosts.get(1)));
  }
  for (  Integer movingIndex : MOVING) {
    ss.onChange(hosts.get(movingIndex),ApplicationState.STATUS,valueFactory.normal(Collections.singleton(newTokens.get(movingIndex))));
  }
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMoveWithPendingRangesNetworkStrategyTenNode() throws Exception {
  StorageService ss=StorageService.instance;
  final int RING_SIZE=14;
  TokenMetadata tmd=ss.getTokenMetadata();
  tmd.clearUnsafe();
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  ArrayList<Token> endpointTokens=new ArrayList<>();
  ArrayList<Token> keyTokens=new ArrayList<>();
  List<InetAddress> hosts=new ArrayList<>();
  List<UUID> hostIds=new ArrayList<>();
  for (int i=0; i < RING_SIZE / 2; i++) {
    endpointTokens.add(new BigIntegerToken(String.valueOf(10 * i)));
    endpointTokens.add(new BigIntegerToken(String.valueOf((10 * i) + 1)));
  }
  Util.createInitialRing(ss,partitioner,endpointTokens,keyTokens,hosts,hostIds,RING_SIZE);
  PendingRangeCalculatorService.instance.blockUntilFinished();
  int MOVING_NODE=0;
  moveHost(hosts.get(MOVING_NODE),5,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,1,"127.0.0.1"),generatePendingMapEntry(1,5,"127.0.0.1")),Network_11_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,1,"127.0.0.1"),generatePendingMapEntry(1,5,"127.0.0.1")),Network_22_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,1,"127.0.0.1"),generatePendingMapEntry(1,5,"127.0.0.1")),Network_33_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),5,tmd);
  moveHost(hosts.get(MOVING_NODE),0,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,1,"127.0.0.3"),generatePendingMapEntry(1,5,"127.0.0.3")),Network_11_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,1,"127.0.0.5"),generatePendingMapEntry(1,5,"127.0.0.5")),Network_22_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,1,"127.0.0.7"),generatePendingMapEntry(1,5,"127.0.0.7")),Network_33_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),0,tmd);
  MOVING_NODE=1;
  moveHost(hosts.get(MOVING_NODE),5,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,5,"127.0.0.2")),Network_11_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,5,"127.0.0.2")),Network_22_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,5,"127.0.0.2")),Network_33_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),5,tmd);
  moveHost(hosts.get(MOVING_NODE),1,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,5,"127.0.0.4")),Network_11_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,5,"127.0.0.6")),Network_22_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,5,"127.0.0.8")),Network_33_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),1,tmd);
  MOVING_NODE=3;
  moveHost(hosts.get(MOVING_NODE),25,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,10,"127.0.0.6"),generatePendingMapEntry(10,11,"127.0.0.6"),generatePendingMapEntry(21,25,"127.0.0.4")),Network_11_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(61,0,"127.0.0.6"),generatePendingMapEntry(0,1,"127.0.0.6"),generatePendingMapEntry(21,25,"127.0.0.4"),generatePendingMapEntry(11,20,"127.0.0.4"),generatePendingMapEntry(20,21,"127.0.0.4")),Network_22_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(51,60,"127.0.0.6"),generatePendingMapEntry(60,61,"127.0.0.6"),generatePendingMapEntry(21,25,"127.0.0.4"),generatePendingMapEntry(11,20,"127.0.0.4"),generatePendingMapEntry(20,21,"127.0.0.4")),Network_33_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),25,tmd);
  moveHost(hosts.get(MOVING_NODE),11,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1,10,"127.0.0.4"),generatePendingMapEntry(10,11,"127.0.0.4"),generatePendingMapEntry(21,25,"127.0.0.8")),Network_11_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(61,0,"127.0.0.4"),generatePendingMapEntry(0,1,"127.0.0.4"),generatePendingMapEntry(11,20,"127.0.0.8"),generatePendingMapEntry(20,21,"127.0.0.8"),generatePendingMapEntry(21,25,"127.0.0.10")),Network_22_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(51,60,"127.0.0.4"),generatePendingMapEntry(60,61,"127.0.0.4"),generatePendingMapEntry(21,25,"127.0.0.12"),generatePendingMapEntry(11,20,"127.0.0.10"),generatePendingMapEntry(20,21,"127.0.0.10")),Network_33_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),11,tmd);
}

</code></pre>

<pre class="type-4 type-5 type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStateJumpToNormal() throws UnknownHostException {
  StorageService ss=StorageService.instance;
  TokenMetadata tmd=ss.getTokenMetadata();
  IPartitioner partitioner=RandomPartitioner.instance;
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  ArrayList<Token> endpointTokens=new ArrayList<Token>();
  ArrayList<Token> keyTokens=new ArrayList<Token>();
  List<InetAddress> hosts=new ArrayList<InetAddress>();
  List<UUID> hostIds=new ArrayList<UUID>();
  Util.createInitialRing(ss,partitioner,endpointTokens,keyTokens,hosts,hostIds,6);
  Token newToken=positionToken(7);
  ss.onChange(hosts.get(2),ApplicationState.STATUS,valueFactory.moving(newToken));
  assertTrue(tmd.isMoving(hosts.get(2)));
  assertEquals(endpointTokens.get(2),tmd.getToken(hosts.get(2)));
  Gossiper.instance.injectApplicationState(hosts.get(2),ApplicationState.TOKENS,valueFactory.tokens(Collections.singleton(newToken)));
  ss.onChange(hosts.get(2),ApplicationState.STATUS,valueFactory.normal(Collections.singleton(newToken)));
  assertTrue(tmd.getMovingEndpoints().isEmpty());
  assertEquals(newToken,tmd.getToken(hosts.get(2)));
  newToken=positionToken(8);
  ss.onChange(hosts.get(2),ApplicationState.STATUS,valueFactory.moving(newToken));
  Gossiper.instance.injectApplicationState(hosts.get(2),ApplicationState.TOKENS,valueFactory.tokens(Collections.singleton(newToken)));
  ss.onChange(hosts.get(2),ApplicationState.STATUS,valueFactory.normal(Collections.singleton(newToken)));
  assertTrue(tmd.getBootstrapTokens().isEmpty());
  assertTrue(tmd.getMovingEndpoints().isEmpty());
  assertEquals(newToken,tmd.getToken(hosts.get(2)));
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMoveWithPendingRangesSimpleStrategyTenNode() throws Exception {
  StorageService ss=StorageService.instance;
  final int RING_SIZE=10;
  TokenMetadata tmd=ss.getTokenMetadata();
  tmd.clearUnsafe();
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  ArrayList<Token> endpointTokens=new ArrayList<>();
  ArrayList<Token> keyTokens=new ArrayList<>();
  List<InetAddress> hosts=new ArrayList<>();
  List<UUID> hostIds=new ArrayList<>();
  Util.createInitialRing(ss,partitioner,endpointTokens,keyTokens,hosts,hostIds,RING_SIZE);
  PendingRangeCalculatorService.instance.blockUntilFinished();
  final int MOVING_NODE=0;
  moveHost(hosts.get(MOVING_NODE),2,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.1")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.1")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.1")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),2,tmd);
  moveHost(hosts.get(MOVING_NODE),0,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.2")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.3")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(0,2,"127.0.0.4")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),0,tmd);
  moveHost(hosts.get(MOVING_NODE),1000,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1000,0,"127.0.0.2")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1000,0,"127.0.0.3")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1000,0,"127.0.0.4")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),1000,tmd);
  moveHost(hosts.get(MOVING_NODE),0,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1000,0,"127.0.0.1")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1000,0,"127.0.0.1")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(1000,0,"127.0.0.1")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),0,tmd);
  moveHost(hosts.get(MOVING_NODE),35,tmd,valueFactory);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,35,"127.0.0.1"),generatePendingMapEntry(90,0,"127.0.0.2")),Simple_RF1_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,35,"127.0.0.1"),generatePendingMapEntry(20,30,"127.0.0.1"),generatePendingMapEntry(80,90,"127.0.0.2"),generatePendingMapEntry(90,0,"127.0.0.3")),Simple_RF2_KeyspaceName);
  assertPendingRanges(tmd,generatePendingRanges(generatePendingMapEntry(30,35,"127.0.0.1"),generatePendingMapEntry(20,30,"127.0.0.1"),generatePendingMapEntry(80,90,"127.0.0.3"),generatePendingMapEntry(90,0,"127.0.0.4"),generatePendingMapEntry(10,20,"127.0.0.1"),generatePendingMapEntry(70,80,"127.0.0.2")),Simple_RF3_KeyspaceName);
  finishMove(hosts.get(MOVING_NODE),35,tmd);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
