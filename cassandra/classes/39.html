<h3 style="margin:0px">Class: org.apache.cassandra.cql3.ViewTest (28 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(11)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testNonExistingOnes() throws Throwable {
  assertInvalidMessage("Cannot drop non existing materialized view","DROP MATERIALIZED VIEW " + KEYSPACE + ".view_does_not_exist");
  assertInvalidMessage("Cannot drop non existing materialized view","DROP MATERIALIZED VIEW keyspace_does_not_exist.view_does_not_exist");
  execute("DROP MATERIALIZED VIEW IF EXISTS " + KEYSPACE + ".view_does_not_exist");
  execute("DROP MATERIALIZED VIEW IF EXISTS keyspace_does_not_exist.view_does_not_exist");
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void complexTimestampUpdateTestWithoutFlush() throws Throwable {
  complexTimestampUpdateTest(false);
}

</code></pre>

<pre class="type-4 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testIgnoreUpdate() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int, " + "b int, "+ "c int, "+ "d int, "+ "PRIMARY KEY (a, b))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT a, b, c FROM %%s WHERE a IS NOT NULL AND b IS NOT NULL PRIMARY KEY (b, a)");
  updateView("INSERT INTO %s (a, b, c) VALUES (?, ?, ?)",0,0,0);
  assertRows(execute("SELECT a, b, c from mv WHERE b = ?",0),row(0,0,0));
  updateView("UPDATE %s SET d = ? WHERE a = ? AND b = ?",0,0,0);
  assertRows(execute("SELECT a, b, c from mv WHERE b = ?",0),row(0,0,0));
  String table=KEYSPACE + "." + currentTable();
  updateView("BEGIN BATCH " + "INSERT INTO " + table + " (a, b, c, d) VALUES (?, ?, ?, ?); "+ "UPDATE "+ table+ " SET d = ? WHERE a = ? AND b = ?; "+ "APPLY BATCH",0,0,0,0,1,0,1);
  assertRows(execute("SELECT a, b, c from mv WHERE b = ?",0),row(0,0,0));
  assertEmpty(execute("SELECT a, b, c from mv WHERE b = ?",1));
  ColumnFamilyStore cfs=Keyspace.open(keyspace()).getColumnFamilyStore("mv");
  cfs.forceBlockingFlush();
  Assert.assertEquals(1,cfs.getLiveSSTables().size());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBuilderWidePartition() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "c int, "+ "intval int, "+ "PRIMARY KEY (k, c))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  for (int i=0; i < 1024; i++)   execute("INSERT INTO %s (k, c, intval) VALUES (?, ?, ?)",0,i,0);
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE k IS NOT NULL AND c IS NOT NULL AND intval IS NOT NULL PRIMARY KEY (intval, c, k)");
  while (!SystemKeyspace.isViewBuilt(keyspace(),"mv"))   Thread.sleep(1000);
  assertRows(execute("SELECT count(*) from %s WHERE k = ?",0),row(1024L));
  assertRows(execute("SELECT count(*) from mv WHERE intval = ?",0),row(1024L));
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPartitionTombstone() throws Throwable {
  createTable("CREATE TABLE %s (k1 int, c1 int , val int, PRIMARY KEY (k1))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("view1","CREATE MATERIALIZED VIEW view1 AS SELECT k1 FROM %%s WHERE k1 IS NOT NULL AND c1 IS NOT NULL AND val IS NOT NULL PRIMARY KEY (val, k1, c1)");
  updateView("INSERT INTO %s (k1, c1, val) VALUES (1, 2, 200)");
  updateView("INSERT INTO %s (k1, c1, val) VALUES (1, 3, 300)");
  Assert.assertEquals(1,execute("select * from %s").size());
  Assert.assertEquals(1,execute("select * from view1").size());
  updateView("DELETE FROM %s WHERE k1 = 1");
  Assert.assertEquals(0,execute("select * from %s").size());
  Assert.assertEquals(0,execute("select * from view1").size());
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangeTombstone2() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "asciival ascii, "+ "bigintval bigint, "+ "textval1 text, "+ "PRIMARY KEY((k, asciival), bigintval)"+ ")");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE textval1 IS NOT NULL AND k IS NOT NULL AND asciival IS NOT NULL AND bigintval IS NOT NULL PRIMARY KEY ((textval1, k), asciival, bigintval)");
  for (int i=0; i < 100; i++)   updateView("INSERT into %s (k,asciival,bigintval,textval1)VALUES(?,?,?,?)",0,"foo",(long)i % 2,"bar" + i);
  Assert.assertEquals(1,execute("select * from %s where k = 0 and asciival = 'foo' and bigintval = 0").size());
  Assert.assertEquals(1,execute("select * from %s where k = 0 and asciival = 'foo' and bigintval = 1").size());
  Assert.assertEquals(2,execute("select * from %s").size());
  Assert.assertEquals(2,execute("select * from mv").size());
  updateView("DELETE FROM %s WHERE k = ? AND asciival = ? and bigintval = ?",0,"foo",0L);
  Assert.assertEquals(1,execute("select * from %s").size());
  Assert.assertEquals(1,execute("select * from mv").size());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCollections() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "intval int, "+ "listval list<int>, "+ "PRIMARY KEY (k))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE k IS NOT NULL AND intval IS NOT NULL PRIMARY KEY (intval, k)");
  updateView("INSERT INTO %s (k, intval, listval) VALUES (?, ?, fromJson(?))",0,0,"[1, 2, 3]");
  assertRows(execute("SELECT k, listval FROM %s WHERE k = ?",0),row(0,list(1,2,3)));
  assertRows(execute("SELECT k, listval from mv WHERE intval = ?",0),row(0,list(1,2,3)));
  updateView("INSERT INTO %s (k, intval) VALUES (?, ?)",1,1);
  updateView("INSERT INTO %s (k, listval) VALUES (?, fromJson(?))",1,"[1, 2, 3]");
  assertRows(execute("SELECT k, listval FROM %s WHERE k = ?",1),row(1,list(1,2,3)));
  assertRows(execute("SELECT k, listval from mv WHERE intval = ?",1),row(1,list(1,2,3)));
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPrimaryKeyOnlyTable() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "PRIMARY KEY (a, b))");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv1","CREATE MATERIALIZED VIEW %s AS SELECT a, b FROM %%s WHERE b IS NOT NULL PRIMARY KEY (b, a)");
  updateView("INSERT INTO %s (a, b) VALUES (?, ?)",1,1);
  ResultSet mvRows=executeNet(protocolVersion,"SELECT a, b FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(1,1));
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPartitionKeyOnlyTable() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "PRIMARY KEY ((a, b)))");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv1","CREATE MATERIALIZED VIEW %s AS SELECT a, b FROM %%s WHERE a IS NOT NULL AND b IS NOT NULL PRIMARY KEY (b, a)");
  updateView("INSERT INTO %s (a, b) VALUES (?, ?)",1,1);
  ResultSet mvRows=executeNet(protocolVersion,"SELECT a, b FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(1,1));
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangeTombstone3() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "asciival ascii, "+ "bigintval bigint, "+ "textval1 text, "+ "PRIMARY KEY((k, asciival), bigintval)"+ ")");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE textval1 IS NOT NULL AND k IS NOT NULL AND asciival IS NOT NULL AND bigintval IS NOT NULL PRIMARY KEY ((textval1, k), asciival, bigintval)");
  for (int i=0; i < 100; i++)   updateView("INSERT into %s (k,asciival,bigintval,textval1)VALUES(?,?,?,?)",0,"foo",(long)i % 2,"bar" + i);
  Assert.assertEquals(1,execute("select * from %s where k = 0 and asciival = 'foo' and bigintval = 0").size());
  Assert.assertEquals(1,execute("select * from %s where k = 0 and asciival = 'foo' and bigintval = 1").size());
  Assert.assertEquals(2,execute("select * from %s").size());
  Assert.assertEquals(2,execute("select * from mv").size());
  updateView("DELETE FROM %s WHERE k = ? AND asciival = ? and bigintval >= ?",0,"foo",0L);
  Assert.assertEquals(0,execute("select * from %s").size());
  Assert.assertEquals(0,execute("select * from mv").size());
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDeleteSingleColumnInViewPartitionKey() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "c int,"+ "d int,"+ "PRIMARY KEY (a, b))");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv1","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE a IS NOT NULL AND b IS NOT NULL AND d IS NOT NULL PRIMARY KEY (d, a, b)");
  updateView("INSERT INTO %s (a, b, c, d) VALUES (?, ?, ?, ?)",0,0,0,0);
  ResultSet mvRows=executeNet(protocolVersion,"SELECT a, d, b, c FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(0,0,0,0));
  updateView("DELETE c FROM %s WHERE a = ? AND b = ?",0,0);
  mvRows=executeNet(protocolVersion,"SELECT a, d, b, c FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(0,0,0,null));
  updateView("DELETE d FROM %s WHERE a = ? AND b = ?",0,0);
  mvRows=executeNet(protocolVersion,"SELECT a, d, b FROM mv1");
  assertTrue(mvRows.isExhausted());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdate() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "intval int, "+ "PRIMARY KEY (k))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE k IS NOT NULL AND intval IS NOT NULL PRIMARY KEY (intval, k)");
  updateView("INSERT INTO %s (k, intval) VALUES (?, ?)",0,0);
  assertRows(execute("SELECT k, intval FROM %s WHERE k = ?",0),row(0,0));
  assertRows(execute("SELECT k, intval from mv WHERE intval = ?",0),row(0,0));
  updateView("INSERT INTO %s (k, intval) VALUES (?, ?)",0,1);
  assertRows(execute("SELECT k, intval FROM %s WHERE k = ?",0),row(0,1));
  assertRows(execute("SELECT k, intval from mv WHERE intval = ?",1),row(0,1));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void begin(){
  views.clear();
}

</code></pre>

<pre class="type-15 type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStaticTable() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "c int, "+ "sval text static, "+ "val text, "+ "PRIMARY KEY(k,c))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  try {
    createView("mv_static","CREATE MATERIALIZED VIEW %%s AS SELECT * FROM %s WHERE sval IS NOT NULL AND k IS NOT NULL AND c IS NOT NULL PRIMARY KEY (sval,k,c)");
    Assert.fail("MV on static should fail");
  }
 catch (  InvalidQueryException e) {
  }
  createView("mv_static","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE val IS NOT NULL AND k IS NOT NULL AND c IS NOT NULL PRIMARY KEY (val,k,c)");
  for (int i=0; i < 100; i++)   updateView("INSERT into %s (k,c,sval,val)VALUES(?,?,?,?)",0,i % 2,"bar" + i,"baz");
  Assert.assertEquals(2,execute("select * from %s").size());
  assertRows(execute("SELECT sval from %s"),row("bar99"),row("bar99"));
  Assert.assertEquals(2,execute("select * from mv_static").size());
  assertInvalid("SELECT sval from mv_static");
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRegularColumnTimestampUpdates() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int PRIMARY KEY, " + "c int, "+ "val int)");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv_rctstest","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE k IS NOT NULL AND c IS NOT NULL PRIMARY KEY (k,c)");
  updateView("UPDATE %s SET c = ?, val = ? WHERE k = ?",0,0,0);
  updateView("UPDATE %s SET val = ? WHERE k = ?",1,0);
  updateView("UPDATE %s SET c = ? WHERE k = ?",1,0);
  assertRows(execute("SELECT c, k, val FROM mv_rctstest"),row(1,0,1));
  updateView("TRUNCATE %s");
  updateView("UPDATE %s USING TIMESTAMP 1 SET c = ?, val = ? WHERE k = ?",0,0,0);
  updateView("UPDATE %s USING TIMESTAMP 3 SET c = ? WHERE k = ?",1,0);
  updateView("UPDATE %s USING TIMESTAMP 2 SET val = ? WHERE k = ?",1,0);
  updateView("UPDATE %s USING TIMESTAMP 4 SET c = ? WHERE k = ?",2,0);
  updateView("UPDATE %s USING TIMESTAMP 3 SET val = ? WHERE k = ?",2,0);
  assertRows(execute("SELECT c, k, val FROM mv_rctstest"),row(2,0,2));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void end() throws Throwable {
  for (  String viewName : views)   executeNet(protocolVersion,"DROP MATERIALIZED VIEW " + viewName);
}

</code></pre>

<pre class="type-13 type-15 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testCompoundPartitionKey() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "asciival ascii, "+ "bigintval bigint, "+ "PRIMARY KEY((k, asciival)))");
  CFMetaData metadata=currentTableMetadata();
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  for (  ColumnDefinition def : new HashSet<>(metadata.allColumns())) {
    try {
      String query="CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE " + def.name + " IS NOT NULL AND k IS NOT NULL "+ (def.name.toString().equals("asciival") ? "" : "AND asciival IS NOT NULL ")+ "PRIMARY KEY ("+ def.name+ ", k"+ (def.name.toString().equals("asciival") ? "" : ", asciival")+ ")";
      createView("mv1_" + def.name,query);
      if (def.type.isMultiCell())       Assert.fail("MV on a multicell should fail " + def);
    }
 catch (    InvalidQueryException e) {
      if (!def.type.isMultiCell() && !def.isPartitionKey())       Assert.fail("MV creation failed on " + def);
    }
    try {
      String query="CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE " + def.name + " IS NOT NULL AND k IS NOT NULL "+ (def.name.toString().equals("asciival") ? "" : "AND asciival IS NOT NULL ")+ " PRIMARY KEY ("+ def.name+ ", asciival"+ (def.name.toString().equals("k") ? "" : ", k")+ ")";
      createView("mv2_" + def.name,query);
      if (def.type.isMultiCell())       Assert.fail("MV on a multicell should fail " + def);
    }
 catch (    InvalidQueryException e) {
      if (!def.type.isMultiCell() && !def.isPartitionKey())       Assert.fail("MV creation failed on " + def);
    }
    try {
      String query="CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE " + def.name + " IS NOT NULL AND k IS NOT NULL "+ (def.name.toString().equals("asciival") ? "" : "AND asciival IS NOT NULL ")+ "PRIMARY KEY (("+ def.name+ ", k), asciival)";
      createView("mv3_" + def.name,query);
      if (def.type.isMultiCell())       Assert.fail("MV on a multicell should fail " + def);
    }
 catch (    InvalidQueryException e) {
      if (!def.type.isMultiCell() && !def.isPartitionKey())       Assert.fail("MV creation failed on " + def);
    }
    try {
      String query="CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE " + def.name + " IS NOT NULL AND k IS NOT NULL "+ (def.name.toString().equals("asciival") ? "" : "AND asciival IS NOT NULL ")+ "PRIMARY KEY (("+ def.name+ ", k), asciival)";
      createView("mv3_" + def.name,query);
      Assert.fail("Should fail on duplicate name");
    }
 catch (    Exception e) {
    }
    try {
      String query="CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE " + def.name + " IS NOT NULL AND k IS NOT NULL "+ (def.name.toString().equals("asciival") ? "" : "AND asciival IS NOT NULL ")+ "PRIMARY KEY (("+ def.name+ ", k), nonexistentcolumn)";
      createView("mv3_" + def.name,query);
      Assert.fail("Should fail with unknown base column");
    }
 catch (    InvalidQueryException e) {
    }
  }
  updateView("INSERT INTO %s (k, asciival, bigintval) VALUES (?, ?, fromJson(?))",0,"ascii text","123123123123");
  updateView("INSERT INTO %s (k, asciival) VALUES (?, fromJson(?))",0,"\"ascii text\"");
  assertRows(execute("SELECT bigintval FROM %s WHERE k = ? and asciival = ?",0,"ascii text"),row(123123123123L));
  assertRows(execute("SELECT k, bigintval from mv1_asciival WHERE asciival = ?","ascii text"),row(0,123123123123L));
  assertRows(execute("SELECT k, bigintval from mv2_k WHERE asciival = ? and k = ?","ascii text",0),row(0,123123123123L));
  assertRows(execute("SELECT k from mv1_bigintval WHERE bigintval = ?",123123123123L),row(0));
  assertRows(execute("SELECT asciival from mv3_bigintval where bigintval = ? AND k = ?",123123123123L,0),row("ascii text"));
  updateView("INSERT INTO %s (k, asciival, bigintval) VALUES (?, ?, fromJson(?))",0,"ascii text","1");
  assertRows(execute("SELECT bigintval FROM %s WHERE k = ? and asciival = ?",0,"ascii text"),row(1L));
  assertRows(execute("SELECT k, bigintval from mv1_asciival WHERE asciival = ?","ascii text"),row(0,1L));
  assertRows(execute("SELECT k, bigintval from mv2_k WHERE asciival = ? and k = ?","ascii text",0),row(0,1L));
  assertRows(execute("SELECT k from mv1_bigintval WHERE bigintval = ?",123123123123L));
  assertRows(execute("SELECT asciival from mv3_bigintval where bigintval = ? AND k = ?",123123123123L,0));
  assertRows(execute("SELECT asciival from mv3_bigintval where bigintval = ? AND k = ?",1L,0),row("ascii text"));
  updateView("TRUNCATE %s");
  assertRows(execute("SELECT bigintval FROM %s WHERE k = ? and asciival = ?",0,"ascii text"));
  assertRows(execute("SELECT k, bigintval from mv1_asciival WHERE asciival = ?","ascii text"));
  assertRows(execute("SELECT k, bigintval from mv2_k WHERE asciival = ? and k = ?","ascii text",0));
  assertRows(execute("SELECT asciival from mv3_bigintval where bigintval = ? AND k = ?",1L,0));
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testClusteringOrder() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "c int,"+ "d int,"+ "PRIMARY KEY (a, b, c))"+ "WITH CLUSTERING ORDER BY (b ASC, c DESC)");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv1","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE b IS NOT NULL AND c IS NOT NULL PRIMARY KEY (a, b, c) WITH CLUSTERING ORDER BY (b DESC)");
  createView("mv2","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE b IS NOT NULL AND c IS NOT NULL PRIMARY KEY (a, c, b) WITH CLUSTERING ORDER BY (c ASC)");
  createView("mv3","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE b IS NOT NULL AND c IS NOT NULL PRIMARY KEY (a, b, c)");
  createView("mv4","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE b IS NOT NULL AND c IS NOT NULL PRIMARY KEY (a, c, b) WITH CLUSTERING ORDER BY (c DESC)");
  updateView("INSERT INTO %s (a, b, c, d) VALUES (?, ?, ?, ?)",1,1,1,1);
  updateView("INSERT INTO %s (a, b, c, d) VALUES (?, ?, ?, ?)",1,2,2,2);
  ResultSet mvRows=executeNet(protocolVersion,"SELECT b FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(2),row(1));
  mvRows=executeNet(protocolVersion,"SELECT c FROM mv2");
  assertRowsNet(protocolVersion,mvRows,row(1),row(2));
  mvRows=executeNet(protocolVersion,"SELECT b FROM mv3");
  assertRowsNet(protocolVersion,mvRows,row(1),row(2));
  mvRows=executeNet(protocolVersion,"SELECT c FROM mv4");
  assertRowsNet(protocolVersion,mvRows,row(2),row(1));
}

</code></pre>

<pre class="type-7 type-5 type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void ttlTest() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "c int,"+ "d int,"+ "PRIMARY KEY (a, b))");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE c IS NOT NULL AND a IS NOT NULL AND b IS NOT NULL PRIMARY KEY (c, a, b)");
  updateView("INSERT INTO %s (a, b, c, d) VALUES (?, ?, ?, ?) USING TTL 5",1,1,1,1);
  Thread.sleep(TimeUnit.SECONDS.toMillis(3));
  updateView("INSERT INTO %s (a, b, c) VALUES (?, ?, ?)",1,1,2);
  Thread.sleep(TimeUnit.SECONDS.toMillis(3));
  List<Row> results=executeNet(protocolVersion,"SELECT d FROM mv WHERE c = 2 AND a = 1 AND b = 1").all();
  Assert.assertEquals(1,results.size());
  Assert.assertTrue("There should be a null result given back due to ttl expiry",results.get(0).isNull(0));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testPrimaryKeyIsNotNull() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "asciival ascii, "+ "bigintval bigint, "+ "PRIMARY KEY((k, asciival)))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  try {
    createView("mv_test","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s");
    Assert.fail("Should fail if no primary key is filtered as NOT NULL");
  }
 catch (  Exception e) {
  }
  try {
    createView("mv_test","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE bigintval IS NOT NULL AND asciival IS NOT NULL PRIMARY KEY (bigintval, k, asciival)");
    Assert.fail("Should fail if compound primary is not completely filtered as NOT NULL");
  }
 catch (  Exception e) {
  }
  dropTable("DROP TABLE %s");
  createTable("CREATE TABLE %s (" + "k int, " + "asciival ascii, "+ "bigintval bigint, "+ "PRIMARY KEY(k, asciival))");
  try {
    createView("mv_test","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s");
    Assert.fail("Should fail if no primary key is filtered as NOT NULL");
  }
 catch (  Exception e) {
  }
  createView("mv_test","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE bigintval IS NOT NULL AND asciival IS NOT NULL PRIMARY KEY (bigintval, k, asciival)");
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangeTombstone() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "asciival ascii, "+ "bigintval bigint, "+ "textval1 text, "+ "textval2 text, "+ "PRIMARY KEY((k, asciival), bigintval, textval1)"+ ")");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv_test1","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE textval2 IS NOT NULL AND k IS NOT NULL AND asciival IS NOT NULL AND bigintval IS NOT NULL AND textval1 IS NOT NULL PRIMARY KEY ((textval2, k), asciival, bigintval, textval1)");
  for (int i=0; i < 100; i++)   updateView("INSERT into %s (k,asciival,bigintval,textval1,textval2)VALUES(?,?,?,?,?)",0,"foo",(long)i % 2,"bar" + i,"baz");
  Assert.assertEquals(50,execute("select * from %s where k = 0 and asciival = 'foo' and bigintval = 0").size());
  Assert.assertEquals(50,execute("select * from %s where k = 0 and asciival = 'foo' and bigintval = 1").size());
  Assert.assertEquals(100,execute("select * from mv_test1").size());
  createView("mv_test2","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE textval2 IS NOT NULL AND k IS NOT NULL AND asciival IS NOT NULL AND bigintval IS NOT NULL AND textval1 IS NOT NULL PRIMARY KEY ((textval2, k), asciival, bigintval, textval1)");
  while (!SystemKeyspace.isViewBuilt(keyspace(),"mv_test2"))   Thread.sleep(10);
  Assert.assertEquals(100,execute("select * from mv_test2").size());
  createView("mv_test3","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE textval2 IS NOT NULL AND k IS NOT NULL AND asciival IS NOT NULL AND bigintval IS NOT NULL AND textval1 IS NOT NULL PRIMARY KEY ((textval2, k), bigintval, textval1, asciival)");
  while (!SystemKeyspace.isViewBuilt(keyspace(),"mv_test3"))   Thread.sleep(10);
  Assert.assertEquals(100,execute("select * from mv_test3").size());
  Assert.assertEquals(100,execute("select asciival from mv_test3 where textval2 = ? and k = ?","baz",0).size());
  updateView("DELETE FROM %s WHERE k = ? AND asciival = ? and bigintval = ?",0,"foo",0L);
  Assert.assertEquals(50,execute("select asciival from mv_test3 where textval2 = ? and k = ?","baz",0).size());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void complexTimestampUpdateTestWithFlush() throws Throwable {
  complexTimestampUpdateTest(true);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testClusteringKeyTombstone() throws Throwable {
  createTable("CREATE TABLE %s (k1 int, c1 int , val int, PRIMARY KEY (k1, c1))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("view1","CREATE MATERIALIZED VIEW view1 AS SELECT k1 FROM %%s WHERE k1 IS NOT NULL AND c1 IS NOT NULL AND val IS NOT NULL PRIMARY KEY (val, k1, c1)");
  updateView("INSERT INTO %s (k1, c1, val) VALUES (1, 2, 200)");
  updateView("INSERT INTO %s (k1, c1, val) VALUES (1, 3, 300)");
  Assert.assertEquals(2,execute("select * from %s").size());
  Assert.assertEquals(2,execute("select * from view1").size());
  updateView("DELETE FROM %s WHERE k1 = 1 and c1 = 3");
  Assert.assertEquals(1,execute("select * from %s").size());
  Assert.assertEquals(1,execute("select * from view1").size());
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testDeleteSingleColumnInViewClustering() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "c int,"+ "d int,"+ "PRIMARY KEY (a, b))");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv1","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE a IS NOT NULL AND b IS NOT NULL AND d IS NOT NULL PRIMARY KEY (a, d, b)");
  updateView("INSERT INTO %s (a, b, c, d) VALUES (?, ?, ?, ?)",0,0,0,0);
  ResultSet mvRows=executeNet(protocolVersion,"SELECT a, d, b, c FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(0,0,0,0));
  updateView("DELETE c FROM %s WHERE a = ? AND b = ?",0,0);
  mvRows=executeNet(protocolVersion,"SELECT a, d, b, c FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(0,0,0,null));
  updateView("DELETE d FROM %s WHERE a = ? AND b = ?",0,0);
  mvRows=executeNet(protocolVersion,"SELECT a, d, b FROM mv1");
  assertTrue(mvRows.isExhausted());
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCountersTable() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int PRIMARY KEY, " + "count counter)");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  try {
    createView("mv_counter","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE count IS NOT NULL AND k IS NOT NULL PRIMARY KEY (count,k)");
    Assert.fail("MV on counter should fail");
  }
 catch (  InvalidQueryException e) {
  }
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMultipleDeletes() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "PRIMARY KEY (a, b))");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv1","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE b IS NOT NULL PRIMARY KEY (b, a)");
  updateView("INSERT INTO %s (a, b) VALUES (?, ?)",1,1);
  updateView("INSERT INTO %s (a, b) VALUES (?, ?)",1,2);
  updateView("INSERT INTO %s (a, b) VALUES (?, ?)",1,3);
  ResultSet mvRows=executeNet(protocolVersion,"SELECT a, b FROM mv1");
  assertRowsNet(protocolVersion,mvRows,row(1,1),row(1,2),row(1,3));
  updateView(String.format("BEGIN UNLOGGED BATCH " + "DELETE FROM %s WHERE a = 1 AND b > 1 AND b < 3;" + "DELETE FROM %s WHERE a = 1;"+ "APPLY BATCH",currentTable(),currentTable()));
  mvRows=executeNet(protocolVersion,"SELECT a, b FROM mv1");
  assertRowsNet(protocolVersion,mvRows);
}

</code></pre>

<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void conflictingTimestampTest() throws Throwable {
  createTable("CREATE TABLE %s (" + "a int," + "b int,"+ "c int,"+ "PRIMARY KEY (a, b))");
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE c IS NOT NULL AND a IS NOT NULL AND b IS NOT NULL PRIMARY KEY (c, a, b)");
  for (int i=0; i < 50; i++) {
    updateView("INSERT INTO %s (a, b, c) VALUES (?, ?, ?) USING TIMESTAMP 1",1,1,i);
  }
  ResultSet mvRows=executeNet(protocolVersion,"SELECT c FROM mv");
  List<Row> rows=executeNet(protocolVersion,"SELECT c FROM %s").all();
  Assert.assertEquals("There should be exactly one row in base",1,rows.size());
  int expected=rows.get(0).getInt("c");
  assertRowsNet(protocolVersion,mvRows,row(expected));
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOldTimestamps() throws Throwable {
  createTable("CREATE TABLE %s (" + "k int, " + "c int, "+ "val text, "+ "PRIMARY KEY(k,c))");
  execute("USE " + keyspace());
  executeNet(protocolVersion,"USE " + keyspace());
  createView("mv_tstest","CREATE MATERIALIZED VIEW %s AS SELECT * FROM %%s WHERE val IS NOT NULL AND k IS NOT NULL AND c IS NOT NULL PRIMARY KEY (val,k,c)");
  for (int i=0; i < 100; i++)   updateView("INSERT into %s (k,c,val)VALUES(?,?,?)",0,i % 2,"baz");
  Keyspace.open(keyspace()).getColumnFamilyStore(currentTable()).forceBlockingFlush();
  Assert.assertEquals(2,execute("select * from %s").size());
  Assert.assertEquals(2,execute("select * from mv_tstest").size());
  assertRows(execute("SELECT val from %s where k = 0 and c = 0"),row("baz"));
  assertRows(execute("SELECT c from mv_tstest where k = 0 and val = ?","baz"),row(0),row(1));
  updateView("UPDATE %s USING TIMESTAMP 100 SET val = ? where k = ? AND c = ?","bar",0,0);
  assertRows(execute("SELECT val from %s where k = 0 and c = 0"),row("baz"));
  assertRows(execute("SELECT c from mv_tstest where k = 0 and val = ?","baz"),row(0),row(1));
  assertRows(execute("SELECT c from mv_tstest where k = 0 and val = ?","bar"));
  updateView("UPDATE %s SET val = ? where k = ? AND c = ?","bar",0,0);
  assertRows(execute("SELECT val from %s where k = 0 and c = 0"),row("bar"));
  assertRows(execute("SELECT c from mv_tstest where k = 0 and val = ?","bar"),row(0));
  assertRows(execute("SELECT c from mv_tstest where k = 0 and val = ?","baz"),row(1));
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
