<h3><span class=" glyphicon glyphicon-tag"/>&nbspBooleanVerifier</h3><kbd>Verifies boolean conditions</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.twill.discovery.DiscoveryServiceTestBase </h4><pre class="type-4 type-2 type-3 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChangeListener() throws InterruptedException {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  String serviceName="listener_test";
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover(serviceName);
  final BlockingQueue<List<Discoverable>> events=new ArrayBlockingQueue<List<Discoverable>>(10);
  serviceDiscovered.watchChanges(new ServiceDiscovered.ChangeListener(){
    @Override public void onChange(    ServiceDiscovered serviceDiscovered){
      events.add(ImmutableList.copyOf(serviceDiscovered));
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  List<Discoverable> discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  Assert.assertTrue(discoverables.isEmpty());
  Cancellable cancellable=register(discoveryService,serviceName,"localhost",10000);
  discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  Assert.assertEquals(1,discoverables.size());
  Cancellable cancellable2=register(discoveryService,serviceName,"localhost",10001);
  discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  Assert.assertEquals(2,discoverables.size());
  cancellable.cancel();
  cancellable2.cancel();
  discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  if (!discoverables.isEmpty()) {
    discoverables=events.poll(20,TimeUnit.SECONDS);
  }
  Assert.assertTrue(discoverables.isEmpty());
}

</code></pre>

<br>
<pre class="type-6 type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void manySameDiscoverable() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  List<Cancellable> cancellables=Lists.newArrayList();
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",1));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",2));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",3));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",4));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",5));
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover("manyDiscoverable");
  Assert.assertTrue(waitTillExpected(5,serviceDiscovered));
  for (int i=0; i < 5; i++) {
    cancellables.get(i).cancel();
    Assert.assertTrue(waitTillExpected(4 - i,serviceDiscovered));
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIterator() throws InterruptedException {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  final DiscoveryService service=entry.getKey();
  DiscoveryServiceClient client=entry.getValue();
  final String serviceName="iterator";
  ServiceDiscovered discovered=client.discover(serviceName);
  Thread t=new Thread(){
    @Override public void run(){
      service.register(new Discoverable(){
        @Override public String getName(){
          return serviceName;
        }
        @Override public InetSocketAddress getSocketAddress(){
          return new InetSocketAddress(12345);
        }
      }
);
    }
  }
;
  Iterator<Discoverable> iterator=discovered.iterator();
  t.start();
  t.join();
  Assert.assertFalse(iterator.hasNext());
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void simpleDiscoverable() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  Cancellable cancellable=register(discoveryService,"foo","localhost",8090);
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover("foo");
  Assert.assertTrue(waitTillExpected(1,serviceDiscovered));
  Discoverable discoverable=new Discoverable(){
    @Override public String getName(){
      return "foo";
    }
    @Override public InetSocketAddress getSocketAddress(){
      return new InetSocketAddress("localhost",8090);
    }
  }
;
  Assert.assertTrue(serviceDiscovered.contains(discoverable));
  cancellable.cancel();
  Assert.assertTrue(waitTillExpected(0,serviceDiscovered));
  Assert.assertFalse(serviceDiscovered.contains(discoverable));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void multiServiceDiscoverable() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  List<Cancellable> cancellables=Lists.newArrayList();
  cancellables.add(register(discoveryService,"service1","localhost",1));
  cancellables.add(register(discoveryService,"service1","localhost",2));
  cancellables.add(register(discoveryService,"service1","localhost",3));
  cancellables.add(register(discoveryService,"service1","localhost",4));
  cancellables.add(register(discoveryService,"service1","localhost",5));
  cancellables.add(register(discoveryService,"service2","localhost",1));
  cancellables.add(register(discoveryService,"service2","localhost",2));
  cancellables.add(register(discoveryService,"service2","localhost",3));
  cancellables.add(register(discoveryService,"service3","localhost",1));
  cancellables.add(register(discoveryService,"service3","localhost",2));
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover("service1");
  Assert.assertTrue(waitTillExpected(5,serviceDiscovered));
  serviceDiscovered=discoveryServiceClient.discover("service2");
  Assert.assertTrue(waitTillExpected(3,serviceDiscovered));
  serviceDiscovered=discoveryServiceClient.discover("service3");
  Assert.assertTrue(waitTillExpected(2,serviceDiscovered));
  cancellables.add(register(discoveryService,"service3","localhost",3));
  Assert.assertTrue(waitTillExpected(3,serviceDiscovered));
  for (  Cancellable cancellable : cancellables) {
    cancellable.cancel();
  }
  Assert.assertTrue(waitTillExpected(0,discoveryServiceClient.discover("service1")));
  Assert.assertTrue(waitTillExpected(0,discoveryServiceClient.discover("service2")));
  Assert.assertTrue(waitTillExpected(0,discoveryServiceClient.discover("service3")));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.discovery.ZKDiscoveryServiceTest </h4><pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSessionExpires() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  Cancellable cancellable=register(discoveryService,"test_expires","localhost",54321);
  ServiceDiscovered discoverables=discoveryServiceClient.discover("test_expires");
  Assert.assertTrue(waitTillExpected(1,discoverables));
  KillZKSession.kill(zkClient.getZooKeeperSupplier().get(),zkServer.getConnectionStr(),10000);
  Cancellable cancellable2=register(discoveryService,"test_expires","localhost",54322);
  Assert.assertTrue(waitTillExpected(2,discoverables));
  cancellable.cancel();
  cancellable2.cancel();
  Assert.assertTrue(waitTillExpected(0,discoverables));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testDoubleRegister() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  Cancellable cancellable=register(discoveryService,"test_double_reg","localhost",54321);
  Cancellable cancellable2=register(discoveryService,"test_double_reg","localhost",54321);
  ServiceDiscovered discoverables=discoveryServiceClient.discover("test_double_reg");
  Assert.assertTrue(waitTillExpected(1,discoverables));
  cancellable.cancel();
  cancellable2.cancel();
  final ZKClientService zkClient2=ZKClientServices.delegate(ZKClients.retryOnFailure(ZKClients.reWatchOnExpire(ZKClientService.Builder.of(zkServer.getConnectionStr()).build()),RetryStrategies.fixDelay(1,TimeUnit.SECONDS)));
  zkClient2.startAndWait();
  try {
    DiscoveryService discoveryService2=new ZKDiscoveryService(zkClient2);
    cancellable2=register(discoveryService2,"test_multi_client","localhost",54321);
    new Thread(){
      @Override public void run(){
        try {
          TimeUnit.SECONDS.sleep(2);
          zkClient2.stopAndWait();
        }
 catch (        InterruptedException e) {
          LOG.error(e.getMessage(),e);
        }
      }
    }
.start();
    cancellable=register(discoveryService,"test_multi_client","localhost",54321);
    cancellable.cancel();
  }
  finally {
    zkClient2.stopAndWait();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.filesystem.LocationTestBase </h4><pre class="type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasic() throws Exception {
  LocationFactory factory=locationFactoryCache.getUnchecked("basic");
  URI baseURI=factory.create("/").toURI();
  Assert.assertEquals(factory.create("/file"),factory.create("/file"));
  Assert.assertEquals(factory.create("/file2"),factory.create(URI.create(baseURI.getScheme() + ":" + baseURI.getPath()+ "/file2")));
  Assert.assertEquals(factory.create("/file3"),factory.create(new URI(baseURI.getScheme(),baseURI.getAuthority(),baseURI.getPath() + "/file3",null,null)));
  Assert.assertEquals(factory.create("/"),factory.create("/"));
  Assert.assertEquals(factory.create("/"),factory.create(URI.create(baseURI.getScheme() + ":" + baseURI.getPath())));
  Assert.assertEquals(factory.create("/"),factory.create(new URI(baseURI.getScheme(),baseURI.getAuthority(),baseURI.getPath(),null,null)));
  Location location=factory.create("/file");
  Assert.assertTrue(location.createNew());
  Assert.assertTrue(location.exists());
  Location location2=factory.create("/file2");
  String message="Testing Message";
  try (Writer writer=new OutputStreamWriter(location2.getOutputStream(),Charsets.UTF_8)){
    writer.write(message);
  }
   long length=location2.length();
  long lastModified=location2.lastModified();
  location2.renameTo(location);
  Assert.assertFalse(location2.exists());
  try (Reader reader=new InputStreamReader(location.getInputStream(),Charsets.UTF_8)){
    Assert.assertEquals(message,CharStreams.toString(reader));
  }
   Assert.assertEquals(length,location.length());
  Assert.assertEquals(lastModified,location.lastModified());
}

</code></pre>

<br>
<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDelete() throws IOException {
  LocationFactory factory=locationFactoryCache.getUnchecked("delete");
  Location base=factory.create("test").getTempFile(".tmp");
  Assert.assertTrue(base.mkdirs());
  Assert.assertTrue(base.append("test1").getTempFile(".tmp").createNew());
  Assert.assertTrue(base.append("test2").getTempFile(".tmp").createNew());
  Location subDir=base.append("test3");
  Assert.assertTrue(subDir.mkdirs());
  Assert.assertTrue(subDir.append("test4").getTempFile(".tmp").createNew());
  Assert.assertTrue(subDir.append("test5").getTempFile(".tmp").createNew());
  Assert.assertTrue(base.delete(true));
  Assert.assertFalse(base.exists());
}

</code></pre>

<br>
<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testHelper(){
  LocationFactory factory=LocationFactories.namespace(locationFactoryCache.getUnchecked("helper"),"testhelper");
  Location location=factory.create("test");
  Assert.assertTrue(location.toURI().getPath().endsWith("testhelper/test"));
  location=factory.create(URI.create("test2"));
  Assert.assertTrue(location.toURI().getPath().endsWith("testhelper/test2"));
}

</code></pre>

<br>
<pre class="type-9 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testList() throws IOException {
  LocationFactory factory=locationFactoryCache.getUnchecked("list");
  Location dir=factory.create("dir");
  Assert.assertFalse(dir.isDirectory());
  Assert.assertTrue(dir.mkdirs());
  Assert.assertTrue(dir.isDirectory());
  Assert.assertTrue(dir.list().isEmpty());
  Location file=dir.append("file");
  Assert.assertFalse(file.isDirectory());
  Assert.assertTrue(file.createNew());
  Assert.assertFalse(file.isDirectory());
  Assert.assertTrue(file.list().isEmpty());
  List<Location> listing=dir.list();
  Assert.assertEquals(1,listing.size());
  Assert.assertEquals(file,listing.get(0));
  file.delete();
  Assert.assertTrue(dir.list().isEmpty());
  try {
    file.list();
    Assert.fail("List should fail on non-exist location.");
  }
 catch (  IOException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.CompositeServiceTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testOrder() throws InterruptedException, ExecutionException, TimeoutException {
  List<Service> services=Lists.newArrayList();
  Semaphore semaphore=new Semaphore(0);
  for (int i=0; i < 10; i++) {
    services.add(new TestService(semaphore,i));
  }
  Service service=new CompositeService(services);
  service.start().get(5,TimeUnit.SECONDS);
  Assert.assertTrue(semaphore.tryAcquire(10,5,TimeUnit.SECONDS));
  Assert.assertTrue(Iterables.all(services,serviceStatePredicate(Service.State.RUNNING)));
  semaphore.release(10);
  service.stop().get(5,TimeUnit.SECONDS);
  Assert.assertFalse(semaphore.tryAcquire(10));
  Assert.assertTrue(Iterables.all(services,serviceStatePredicate(Service.State.TERMINATED)));
}

</code></pre>

<br>
<pre class="type-9 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testErrorStart() throws InterruptedException {
  List<Service> services=Lists.newArrayList();
  Semaphore semaphore=new Semaphore(0);
  for (int i=0; i < 5; i++) {
    services.add(new TestService(semaphore,i,i == 3));
  }
  Service service=new CompositeService(services);
  try {
    service.start().get();
    Assert.fail();
  }
 catch (  ExecutionException e) {
  }
  Assert.assertTrue(Iterables.all(services,Predicates.not(serviceStatePredicate(Service.State.RUNNING))));
  Assert.assertTrue(Iterables.removeIf(services,serviceStatePredicate(Service.State.FAILED)));
  for (  Service s : services) {
    Assert.assertNotEquals(3,((TestService)s).getOrder());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.ControllerTest </h4><pre class="type-9 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testControllerBefore() throws InterruptedException, ExecutionException, TimeoutException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().build();
  zkServer.startAndWait();
  LOG.info("ZKServer: " + zkServer.getConnectionStr());
  try {
    RunId runId=RunIds.generate();
    ZKClientService zkClientService=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    zkClientService.startAndWait();
    final CountDownLatch runLatch=new CountDownLatch(1);
    TwillController controller=getController(zkClientService,runId);
    controller.onRunning(new Runnable(){
      @Override public void run(){
        runLatch.countDown();
      }
    }
,Threads.SAME_THREAD_EXECUTOR);
    Service service=createService(zkClientService,runId);
    service.start();
    Assert.assertTrue(runLatch.await(2,TimeUnit.SECONDS));
    try {
      controller.awaitTerminated(2,TimeUnit.SECONDS);
      Assert.fail("Service should not be terminated");
    }
 catch (    TimeoutException e) {
    }
    service.stop();
    controller.awaitTerminated(120,TimeUnit.SECONDS);
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testController() throws ExecutionException, InterruptedException, TimeoutException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().build();
  zkServer.startAndWait();
  LOG.info("ZKServer: " + zkServer.getConnectionStr());
  try {
    RunId runId=RunIds.generate();
    ZKClientService zkClientService=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    zkClientService.startAndWait();
    Service service=createService(zkClientService,runId);
    service.startAndWait();
    TwillController controller=getController(zkClientService,runId);
    controller.sendCommand(Command.Builder.of("test").build()).get(2,TimeUnit.SECONDS);
    controller.terminate().get(2,TimeUnit.SECONDS);
    final CountDownLatch terminateLatch=new CountDownLatch(1);
    service.addListener(new ServiceListenerAdapter(){
      @Override public void terminated(      Service.State from){
        terminateLatch.countDown();
      }
    }
,Threads.SAME_THREAD_EXECUTOR);
    Assert.assertTrue(service.state() == Service.State.TERMINATED || terminateLatch.await(2,TimeUnit.SECONDS));
    zkClientService.stopAndWait();
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testControllerListener() throws InterruptedException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().build();
  zkServer.startAndWait();
  LOG.info("ZKServer: " + zkServer.getConnectionStr());
  try {
    RunId runId=RunIds.generate();
    ZKClientService zkClientService=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    zkClientService.startAndWait();
    Service service=createService(zkClientService,runId);
    service.startAndWait();
    final CountDownLatch runLatch=new CountDownLatch(1);
    TwillController controller=getController(zkClientService,runId);
    controller.onRunning(new Runnable(){
      @Override public void run(){
        runLatch.countDown();
      }
    }
,Threads.SAME_THREAD_EXECUTOR);
    Assert.assertTrue(runLatch.await(2,TimeUnit.SECONDS));
    service.stopAndWait();
    zkClientService.stopAndWait();
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.ServicesTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCompletion() throws ExecutionException, InterruptedException {
  Service service=new DummyService("s1",new AtomicBoolean());
  ListenableFuture<Service.State> completion=Services.getCompletionFuture(service);
  service.start();
  service.stop();
  completion.get();
  AtomicBoolean transiting=new AtomicBoolean();
  service=new DummyService("s2",transiting);
  completion=Services.getCompletionFuture(service);
  service.startAndWait();
  transiting.set(true);
  service.stop();
  try {
    completion.get();
    Assert.assertTrue(false);
  }
 catch (  ExecutionException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.zookeeper.LeaderElectionTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=150000) public void testDisconnect() throws IOException, InterruptedException {
  File zkDataDir=tmpFolder.newFolder();
  InMemoryZKServer ownZKServer=InMemoryZKServer.builder().setDataDir(zkDataDir).build();
  ownZKServer.startAndWait();
  try {
    ZKClientService zkClient=ZKClientService.Builder.of(ownZKServer.getConnectionStr()).build();
    zkClient.startAndWait();
    try {
      final Semaphore leaderSem=new Semaphore(0);
      final Semaphore followerSem=new Semaphore(0);
      LeaderElection leaderElection=new LeaderElection(zkClient,"/testDisconnect",new ElectionHandler(){
        @Override public void leader(){
          leaderSem.release();
        }
        @Override public void follower(){
          followerSem.release();
        }
      }
);
      leaderElection.start();
      leaderSem.tryAcquire(20,TimeUnit.SECONDS);
      int zkPort=ownZKServer.getLocalAddress().getPort();
      ownZKServer.stopAndWait();
      followerSem.tryAcquire(20,TimeUnit.SECONDS);
      ownZKServer=InMemoryZKServer.builder().setDataDir(zkDataDir).setPort(zkPort).build();
      ownZKServer.startAndWait();
      leaderSem.tryAcquire(20,TimeUnit.SECONDS);
      ownZKServer.stopAndWait();
      followerSem.tryAcquire(20,TimeUnit.SECONDS);
      ListenableFuture<?> cancelFuture=leaderElection.stop();
      ownZKServer=InMemoryZKServer.builder().setDataDir(zkDataDir).setPort(zkPort).build();
      ownZKServer.startAndWait();
      Futures.getUnchecked(cancelFuture);
      Assert.assertFalse(leaderSem.tryAcquire(10,TimeUnit.SECONDS));
    }
  finally {
      zkClient.stopAndWait();
    }
  }
  finally {
    ownZKServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=150000) public void testCancel() throws InterruptedException, IOException {
  List<LeaderElection> leaderElections=Lists.newArrayList();
  List<ZKClientService> zkClients=Lists.newArrayList();
  final Semaphore leaderSem=new Semaphore(0);
  final Semaphore followerSem=new Semaphore(0);
  final AtomicInteger leaderIdx=new AtomicInteger();
  try {
    for (int i=0; i < 2; i++) {
      ZKClientService zkClient=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
      zkClient.startAndWait();
      zkClients.add(zkClient);
      final int finalI=i;
      leaderElections.add(new LeaderElection(zkClient,"/testCancel",new ElectionHandler(){
        @Override public void leader(){
          leaderIdx.set(finalI);
          leaderSem.release();
        }
        @Override public void follower(){
          followerSem.release();
        }
      }
));
    }
    for (    LeaderElection leaderElection : leaderElections) {
      leaderElection.start();
    }
    leaderSem.tryAcquire(10,TimeUnit.SECONDS);
    followerSem.tryAcquire(10,TimeUnit.SECONDS);
    int leader=leaderIdx.get();
    int follower=1 - leader;
    KillZKSession.kill(zkClients.get(follower).getZooKeeperSupplier().get(),zkClients.get(follower).getConnectString(),20000);
    leaderElections.get(leader).stopAndWait();
    leaderSem.tryAcquire(30,TimeUnit.SECONDS);
    leader=leaderIdx.get();
    follower=1 - leader;
    leaderElections.set(follower,new LeaderElection(zkClients.get(follower),"/testCancel",new ElectionHandler(){
      @Override public void leader(){
        leaderSem.release();
      }
      @Override public void follower(){
        followerSem.release();
      }
    }
));
    leaderElections.get(follower).start();
    leaderElections.get(follower).stopAndWait();
    leaderElections.get(leader).stopAndWait();
    Assert.assertFalse(leaderSem.tryAcquire(10,TimeUnit.SECONDS));
  }
  finally {
    for (    ZKClientService zkClient : zkClients) {
      zkClient.stopAndWait();
    }
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRace() throws InterruptedException {
  ExecutorService executor=Executors.newFixedThreadPool(2);
  final AtomicInteger leaderCount=new AtomicInteger(0);
  final CountDownLatch completeLatch=new CountDownLatch(2);
  for (int i=0; i < 2; i++) {
    final ZKClientService zkClient=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    zkClient.startAndWait();
    executor.execute(new Runnable(){
      @Override public void run(){
        try {
          for (int i=0; i < 1000; i++) {
            final CountDownLatch leaderLatch=new CountDownLatch(1);
            LeaderElection election=new LeaderElection(zkClient,"/testRace",new ElectionHandler(){
              @Override public void leader(){
                leaderCount.incrementAndGet();
                leaderLatch.countDown();
              }
              @Override public void follower(){
              }
            }
);
            election.startAndWait();
            Uninterruptibles.awaitUninterruptibly(leaderLatch);
            election.stopAndWait();
          }
          completeLatch.countDown();
        }
  finally {
          zkClient.stopAndWait();
        }
      }
    }
);
  }
  try {
    Assert.assertTrue(completeLatch.await(2,TimeUnit.MINUTES));
  }
  finally {
    executor.shutdownNow();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.zookeeper.ReentrantDistributedLockTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=20000) public void testMultiThreads() throws InterruptedException {
  ZKClientService zkClient=createZKClient();
  try {
    final ReentrantDistributedLock lock=new ReentrantDistributedLock(zkClient,"multiThreads");
    final CountDownLatch acquired=new CountDownLatch(1);
    Thread t=new Thread(){
      @Override public void run(){
        lock.lock();
        try {
          acquired.countDown();
        }
  finally {
          lock.unlock();
        }
      }
    }
;
    lock.lock();
    try {
      t.start();
      Assert.assertFalse(acquired.await(1,TimeUnit.SECONDS));
    }
  finally {
      lock.unlock();
    }
    Assert.assertTrue(acquired.await(5,TimeUnit.SECONDS));
    t.join();
  }
  finally {
    zkClient.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=20000) public void testTryLockMultiClients() throws InterruptedException {
  ZKClientService zkClient1=createZKClient();
  ZKClientService zkClient2=createZKClient();
  try {
    final ReentrantDistributedLock lock1=new ReentrantDistributedLock(zkClient1,"/multiTrylock");
    final ReentrantDistributedLock lock2=new ReentrantDistributedLock(zkClient2,"/multiTrylock");
    final CountDownLatch lockAcquired=new CountDownLatch(1);
    final CountDownLatch lockFailed=new CountDownLatch(2);
    Thread t=new Thread(){
      @Override public void run(){
        try {
          if (!lock2.tryLock()) {
            lockFailed.countDown();
          }
          if (!lock2.tryLock(1,TimeUnit.SECONDS)) {
            lockFailed.countDown();
          }
          if (lock2.tryLock(5000,TimeUnit.SECONDS)) {
            if (lock2.tryLock(1,TimeUnit.SECONDS)) {
              if (lock2.tryLock()) {
                lockAcquired.countDown();
                lock2.unlock();
              }
              lock2.unlock();
            }
            lock2.unlock();
          }
        }
 catch (        InterruptedException e) {
          LOG.error(e.getMessage(),e);
        }
      }
    }
;
    lock1.lock();
    try {
      t.start();
      Assert.assertTrue(lockFailed.await(5000,TimeUnit.SECONDS));
    }
  finally {
      lock1.unlock();
    }
    Assert.assertTrue(lockAcquired.await(10000,TimeUnit.SECONDS));
    t.join();
    Assert.assertTrue(lock1.tryLock());
    lock1.unlock();
  }
  finally {
    zkClient1.stopAndWait();
    zkClient2.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=20000) public void testReentrantMultiClients() throws InterruptedException {
  ZKClientService zkClient1=createZKClient();
  ZKClientService zkClient2=createZKClient();
  try {
    ReentrantDistributedLock lock1=new ReentrantDistributedLock(zkClient1,"multiClients");
    final ReentrantDistributedLock lock2=new ReentrantDistributedLock(zkClient2,"multiClients");
    final CountDownLatch lockAcquired=new CountDownLatch(1);
    Thread t=new Thread(){
      @Override public void run(){
        lock2.lock();
        try {
          lockAcquired.countDown();
        }
  finally {
          lock2.unlock();
        }
      }
    }
;
    lock1.lock();
    try {
      t.start();
      Assert.assertFalse(lockAcquired.await(1,TimeUnit.SECONDS));
      lock1.lock();
      lock1.unlock();
      Assert.assertFalse(lockAcquired.await(1,TimeUnit.SECONDS));
    }
  finally {
      lock1.unlock();
    }
    Assert.assertTrue(lockAcquired.await(5,TimeUnit.SECONDS));
    t.join();
  }
  finally {
    zkClient1.stopAndWait();
    zkClient2.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=20000) public void testLockInterrupt() throws InterruptedException {
  ZKClientService zkClient=createZKClient();
  try {
    final ReentrantDistributedLock lock=new ReentrantDistributedLock(zkClient,"/interrupt");
    lock.lock();
    try {
      final CountDownLatch lockAcquired=new CountDownLatch(1);
      final CountDownLatch lockInterrupted=new CountDownLatch(1);
      Thread t=new Thread(){
        @Override public void run(){
          try {
            lock.lockInterruptibly();
            try {
              lockAcquired.countDown();
            }
  finally {
              lock.unlock();
            }
          }
 catch (          InterruptedException e) {
            lockInterrupted.countDown();
          }
        }
      }
;
      t.start();
      t.interrupt();
      Assert.assertFalse(lockAcquired.await(2,TimeUnit.SECONDS));
      Assert.assertTrue(lockInterrupted.await(2,TimeUnit.SECONDS));
    }
  finally {
      lock.unlock();
    }
  }
  finally {
    zkClient.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=60000) public void testLockSessionExpire() throws Exception {
  ZKClientService zkClient1=createZKClient();
  final ZKClientService zkClient2=createZKClient();
  try {
    Lock lock1=new ReentrantDistributedLock(zkClient1,"/lockexpire");
    lock1.lock();
    try {
      final CountDownLatch started=new CountDownLatch(1);
      final CountDownLatch failure=new CountDownLatch(1);
      Thread t=new Thread(){
        @Override public void run(){
          try {
            started.countDown();
            Lock lock2=new ReentrantDistributedLock(zkClient2,"/lockexpire");
            lock2.lock();
            try {
            }
  finally {
              lock2.unlock();
            }
          }
 catch (          Exception ex) {
            failure.countDown();
          }
        }
      }
;
      t.start();
      Assert.assertTrue(started.await(5,TimeUnit.SECONDS));
      while (zkClient1.getChildren("/lockexpire").get().getChildren().size() != 2) {
        TimeUnit.SECONDS.sleep(1);
      }
      KillZKSession.kill(zkClient2.getZooKeeperSupplier().get(),zkClient2.getConnectString(),10000);
      Assert.assertTrue(failure.await(10,TimeUnit.SECONDS));
    }
  finally {
      lock1.unlock();
    }
  }
  finally {
    zkClient1.stopAndWait();
    zkClient2.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=20000) public void testTryLock() throws InterruptedException {
  ZKClientService zkClient=createZKClient();
  try {
    final ReentrantDistributedLock lock=new ReentrantDistributedLock(zkClient,"/trylock");
    final CountDownLatch lockAcquired=new CountDownLatch(1);
    final CountDownLatch lockFailed=new CountDownLatch(2);
    Thread t=new Thread(){
      @Override public void run(){
        try {
          if (!lock.tryLock()) {
            lockFailed.countDown();
          }
          if (!lock.tryLock(1,TimeUnit.SECONDS)) {
            lockFailed.countDown();
          }
          if (lock.tryLock(5,TimeUnit.SECONDS)) {
            if (lock.tryLock(1,TimeUnit.SECONDS)) {
              if (lock.tryLock()) {
                lockAcquired.countDown();
                lock.unlock();
              }
              lock.unlock();
            }
            lock.unlock();
          }
        }
 catch (        InterruptedException e) {
          LOG.error(e.getMessage(),e);
        }
      }
    }
;
    lock.lock();
    try {
      t.start();
      Assert.assertTrue(lockFailed.await(5,TimeUnit.SECONDS));
    }
  finally {
      lock.unlock();
    }
    Assert.assertTrue(lockAcquired.await(2,TimeUnit.SECONDS));
    t.join();
    Assert.assertTrue(lock.tryLock());
    lock.unlock();
  }
  finally {
    zkClient.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=60000) public void testLockRace() throws Exception {
  ZKClientService zkClient1=createZKClient();
  ZKClientService zkClient2=createZKClient();
  try {
    final Lock[] locks=new Lock[]{new ReentrantDistributedLock(zkClient1,"/lockrace"),new ReentrantDistributedLock(zkClient2,"/lockrace")};
    final CyclicBarrier barrier=new CyclicBarrier(2);
    final CountDownLatch lockLatch=new CountDownLatch(2);
    for (int i=0; i < 2; i++) {
      final int threadId=i;
      Thread t=new Thread(){
        @Override public void run(){
          try {
            barrier.await();
            for (int i=0; i < 100; i++) {
              Lock lock=locks[threadId];
              lock.lock();
              try {
                Uninterruptibles.sleepUninterruptibly(1,TimeUnit.MILLISECONDS);
              }
  finally {
                lock.unlock();
              }
            }
            lockLatch.countDown();
          }
 catch (          Exception e) {
            LOG.error("Exception",e);
          }
        }
      }
;
      t.start();
    }
    Assert.assertTrue(lockLatch.await(30,TimeUnit.SECONDS));
  }
  finally {
    zkClient1.stopAndWait();
    zkClient2.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=200000) public void testLockInterruptMultiClients() throws InterruptedException {
  ZKClientService zkClient1=createZKClient();
  ZKClientService zkClient2=createZKClient();
  try {
    final ReentrantDistributedLock lock1=new ReentrantDistributedLock(zkClient1,"/multiInterrupt");
    final ReentrantDistributedLock lock2=new ReentrantDistributedLock(zkClient2,"/multiInterrupt");
    lock1.lock();
    try {
      final CountDownLatch lockAcquired=new CountDownLatch(1);
      final CountDownLatch lockInterrupted=new CountDownLatch(1);
      Thread t=new Thread(){
        @Override public void run(){
          try {
            lock2.lockInterruptibly();
            try {
              lockAcquired.countDown();
            }
  finally {
              lock2.unlock();
            }
          }
 catch (          InterruptedException e) {
            lockInterrupted.countDown();
          }
        }
      }
;
      t.start();
      TimeUnit.SECONDS.sleep(2);
      t.interrupt();
      Assert.assertFalse(lockAcquired.await(2,TimeUnit.SECONDS));
      Assert.assertTrue(lockInterrupted.await(2,TimeUnit.SECONDS));
    }
  finally {
      lock1.unlock();
    }
    lock2.lock();
    lock2.unlock();
  }
  finally {
    zkClient1.stopAndWait();
    zkClient2.stopAndWait();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.kafka.client.KafkaTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testKafkaClient() throws Exception {
  String topic="testClient";
  Thread t1=createPublishThread(kafkaClient,topic,Compression.GZIP,"GZIP Testing message",10);
  Thread t2=createPublishThread(kafkaClient,topic,Compression.NONE,"Testing message",10);
  t1.start();
  t2.start();
  Thread t3=createPublishThread(kafkaClient,topic,Compression.SNAPPY,"Snappy Testing message",10);
  t2.join();
  t3.start();
  final CountDownLatch latch=new CountDownLatch(30);
  final CountDownLatch stopLatch=new CountDownLatch(1);
  Cancellable cancel=kafkaClient.getConsumer().prepare().add(topic,0,0).consume(new KafkaConsumer.MessageCallback(){
    @Override public void onReceived(    Iterator<FetchedMessage> messages){
      while (messages.hasNext()) {
        LOG.info(Charsets.UTF_8.decode(messages.next().getPayload()).toString());
        latch.countDown();
      }
    }
    @Override public void finished(){
      stopLatch.countDown();
    }
  }
);
  Assert.assertTrue(latch.await(5,TimeUnit.SECONDS));
  cancel.cancel();
  Assert.assertTrue(stopLatch.await(1,TimeUnit.SECONDS));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.ContainerSizeTestRun </h4><pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Test for requesting different container size in different order.
 * It specifically test for workaround for YARN-314.
 */
@Test public void testContainerSize() throws InterruptedException, TimeoutException, ExecutionException {
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new SleepApp()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).start();
  try {
    ServiceDiscovered discovered=controller.discoverService("sleep");
    Assert.assertTrue(waitForSize(discovered,2,120));
  }
  finally {
    controller.terminate().get(120,TimeUnit.SECONDS);
  }
}

</code></pre>

<br>
<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testMaxHeapSize() throws InterruptedException, TimeoutException, ExecutionException {
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new MaxHeapApp()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).start();
  try {
    ServiceDiscovered discovered=controller.discoverService("sleep");
    Assert.assertTrue(waitForSize(discovered,1,120));
  }
  finally {
    controller.terminate().get(120,TimeUnit.SECONDS);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.DebugTestRun </h4><pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDebugPortOneRunnable() throws Exception {
  YarnTwillRunnerService runner=getTwillRunner();
  runner.start();
  TwillController controller=runner.prepare(new DummyApplication()).enableDebugging("r1").addLogHandler(new PrinterLogHandler(new PrintWriter(System.out))).start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Assert.assertTrue(waitForDebugPort(controller,"r1",30));
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDebugPortAllRunnables() throws Exception {
  YarnTwillRunnerService runner=getTwillRunner();
  runner.start();
  TwillController controller=runner.prepare(new DummyApplication()).enableDebugging().addLogHandler(new PrinterLogHandler(new PrintWriter(System.out))).start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Assert.assertTrue(waitForDebugPort(controller,"r1",30));
  Assert.assertTrue(waitForDebugPort(controller,"r2",30));
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.DistributeShellTestRun </h4><pre class="type-2 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testDistributedShell() throws InterruptedException {
  TwillRunner twillRunner=getTwillRunner();
  TwillController controller=twillRunner.prepare(new DistributedShell("pwd","ls -al")).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out))).start();
  final CountDownLatch stopLatch=new CountDownLatch(1);
  controller.onTerminated(new Runnable(){
    @Override public void run(){
      stopLatch.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(stopLatch.await(10,TimeUnit.SECONDS));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.EchoServerTestRun </h4><pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEchoServer() throws Exception {
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new EchoServer(),ResourceSpecification.Builder.with().setVirtualCores(1).setMemory(1,ResourceSpecification.SizeUnit.GIGA).setInstances(2).build()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("EchoServer","echo2").start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Iterable<Discoverable> echoServices=controller.discoverService("echo");
  Assert.assertTrue(waitForSize(echoServices,2,120));
  for (  Discoverable discoverable : echoServices) {
    String msg="Hello: " + discoverable.getSocketAddress();
    try (Socket socket=new Socket(discoverable.getSocketAddress().getAddress(),discoverable.getSocketAddress().getPort())){
      PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
      LineReader reader=new LineReader(new InputStreamReader(socket.getInputStream(),Charsets.UTF_8));
      writer.println(msg);
      Assert.assertEquals(msg,reader.readLine());
    }
   }
  controller.changeInstances("EchoServer",3);
  Assert.assertTrue(waitForSize(echoServices,3,120));
  echoServices=controller.discoverService("echo2");
  controller.changeInstances("EchoServer",1);
  Assert.assertTrue(waitForSize(echoServices,1,120));
  controller.changeInstances("EchoServer",2);
  Assert.assertTrue(waitForSize(echoServices,2,120));
  Map<Integer,String> instanceIdToContainerId=Maps.newHashMap();
  ResourceReport report=waitForAfterRestartResourceReport(controller,"EchoServer",15L,TimeUnit.MINUTES,2,null);
  Assert.assertTrue(report != null);
  Collection<TwillRunResources> runResources=report.getRunnableResources("EchoServer");
  for (  TwillRunResources twillRunResources : runResources) {
    instanceIdToContainerId.put(twillRunResources.getInstanceId(),twillRunResources.getContainerId());
  }
  controller.restartAllInstances("EchoServer");
  Assert.assertTrue(waitForSize(echoServices,2,120));
  report=waitForAfterRestartResourceReport(controller,"EchoServer",15L,TimeUnit.MINUTES,2,instanceIdToContainerId);
  Assert.assertTrue(report != null);
  Iterable<TwillRunner.LiveInfo> apps=runner.lookupLive();
  Assert.assertTrue(waitForSize(apps,1,120));
  TwillRunnerService runnerService=TWILL_TESTER.createTwillRunnerService();
  runnerService.start();
  try {
    Iterable<TwillController> controllers=runnerService.lookup("EchoServer");
    Assert.assertTrue(waitForSize(controllers,1,120));
    for (    TwillController c : controllers) {
      LOG.info("Stopping application: " + c.getRunId());
      c.terminate().get(30,TimeUnit.SECONDS);
    }
    Assert.assertTrue(waitForSize(apps,0,120));
  }
  finally {
    runnerService.stop();
  }
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<pre class="type-7 type-2 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZKCleanup() throws Exception {
  ZKClientService zkClient=ZKClientService.Builder.of(getZKConnectionString() + "/twill").build();
  zkClient.startAndWait();
  try {
    TwillRunner runner=getTwillRunner();
    TwillController controller=runner.prepare(new EchoServer()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("EchoServer","echo2").start();
    Iterable<Discoverable> echoServices=controller.discoverService("echo");
    Assert.assertTrue(waitForSize(echoServices,1,120));
    controller.terminate().get();
    Assert.assertNull(zkClient.exists("/EchoServer").get());
    List<TwillController> controllers=new ArrayList<>();
    for (int i=0; i < 2; i++) {
      controllers.add(runner.prepare(new EchoServer()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("EchoServer","echo2").start());
    }
    echoServices=controller.discoverService("echo");
    Assert.assertTrue(waitForSize(echoServices,2,120));
    controllers.get(0).terminate().get();
    Assert.assertNotNull(zkClient.exists("/EchoServer").get());
    echoServices=controller.discoverService("echo");
    Assert.assertTrue(waitForSize(echoServices,1,120));
    controllers.get(1).terminate().get();
    Assert.assertNull(zkClient.exists("/EchoServer").get());
  }
  finally {
    zkClient.stopAndWait();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.FailureRestartTestRun </h4><pre class="type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFailureRestart() throws Exception {
  TwillRunner runner=getTwillRunner();
  ResourceSpecification resource=ResourceSpecification.Builder.with().setVirtualCores(1).setMemory(512,ResourceSpecification.SizeUnit.MEGA).setInstances(2).build();
  TwillController controller=runner.prepare(new FailureRunnable(),resource).withApplicationArguments("failure").withArguments(FailureRunnable.class.getSimpleName(),"failure2").addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).start();
  Iterable<Discoverable> discoverables=controller.discoverService("failure");
  Assert.assertTrue(waitForSize(discoverables,2,120));
  Assert.assertEquals(Sets.newHashSet(0,1),getInstances(discoverables));
  controller.sendCommand(FailureRunnable.class.getSimpleName(),Command.Builder.of("kill0").build());
  Assert.assertTrue(waitForSize(discoverables,1,120));
  Assert.assertTrue(waitForSize(discoverables,2,120));
  Assert.assertEquals(Sets.newHashSet(0,1),getInstances(discoverables));
  controller.terminate().get(120,TimeUnit.SECONDS);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.InitializeFailTestRun </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testInitFail() throws InterruptedException, ExecutionException, TimeoutException {
  TwillRunner runner=getTwillRunner();
  final CountDownLatch logLatch=new CountDownLatch(1);
  LogHandler logVerifyHandler=new LogHandler(){
    @Override public void onLog(    LogEntry logEntry){
      LogThrowable logThrowable=logEntry.getThrowable();
      if (logThrowable != null) {
        while (logThrowable.getCause() != null) {
          logThrowable=logThrowable.getCause();
        }
        if (IllegalStateException.class.getName().equals(logThrowable.getClassName()) && logThrowable.getMessage().contains("Fail to init")) {
          logLatch.countDown();
        }
      }
    }
  }
;
  TwillController controller=runner.prepare(new InitFailRunnable()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out))).addLogHandler(logVerifyHandler).start();
  controller.awaitTerminated(2,TimeUnit.MINUTES);
  Assert.assertTrue(logLatch.await(10,TimeUnit.SECONDS));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.LocalFileTestRun </h4><pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLocalFile() throws Exception {
  String header=Files.readFirstLine(new File(getClass().getClassLoader().getResource("header.txt").toURI()),Charsets.UTF_8);
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new LocalFileApplication()).addJVMOptions(" -verbose:gc -Xloggc:gc.log -XX:+PrintGCDetails").withApplicationArguments("local").withArguments("LocalFileSocketServer","local2").addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).start();
  Iterable<Discoverable> discoverables=controller.discoverService("local");
  Assert.assertTrue(waitForSize(discoverables,1,60));
  InetSocketAddress socketAddress=discoverables.iterator().next().getSocketAddress();
  try (Socket socket=new Socket(socketAddress.getAddress(),socketAddress.getPort())){
    PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
    LineReader reader=new LineReader(new InputStreamReader(socket.getInputStream(),Charsets.UTF_8));
    String msg="Local file test";
    writer.println(msg);
    Assert.assertEquals(header,reader.readLine());
    Assert.assertEquals(msg,reader.readLine());
  }
   controller.terminate().get(120,TimeUnit.SECONDS);
  Assert.assertTrue(waitForSize(discoverables,0,60));
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.LogHandlerTestRun </h4><pre class="type-4 type-14 type-7 type-2 type-3 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLogHandler() throws ExecutionException, InterruptedException, TimeoutException {
  final CountDownLatch latch=new CountDownLatch(3);
  final Queue<LogThrowable> throwables=new ConcurrentLinkedQueue<LogThrowable>();
  final Queue<String> runnables=new ConcurrentLinkedQueue<String>();
  LogHandler logHandler=new LogHandler(){
    @Override public void onLog(    LogEntry logEntry){
      if (logEntry.getSourceClassName().contains("LogHandlerTestRun")) {
        runnables.add(logEntry.getRunnableName());
      }
      if (logEntry.getSourceClassName().contains("ApplicationMasterService")) {
        Assert.assertNull(logEntry.getRunnableName());
      }
      if (logEntry.getMessage().startsWith("Starting runnable " + LogRunnable.class.getSimpleName())) {
        latch.countDown();
      }
 else       if (logEntry.getMessage().equals("Running")) {
        latch.countDown();
      }
 else       if (logEntry.getMessage().equals("Got exception") && logEntry.getThrowable() != null) {
        throwables.add(logEntry.getThrowable());
        latch.countDown();
      }
    }
  }
;
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new LogRunnable()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).addLogHandler(logHandler).start();
  try {
    Assert.assertTrue(latch.await(100,TimeUnit.SECONDS));
  }
  finally {
    controller.terminate().get(120,TimeUnit.SECONDS);
  }
  Assert.assertEquals(2,runnables.size());
  Assert.assertArrayEquals(new String[]{"LogRunnable","LogRunnable"},runnables.toArray());
  Assert.assertEquals(1,throwables.size());
  LogThrowable t=throwables.poll();
  Assert.assertEquals(RuntimeException.class.getName(),t.getClassName());
  Assert.assertNotNull(t.getCause());
  Assert.assertEquals(5,t.getStackTraces().length);
  t=t.getCause();
  Assert.assertEquals(Exception.class.getName(),t.getClassName());
  Assert.assertEquals("Exception",t.getMessage());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.LogLevelTestRun </h4><pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDebugLogLevel() throws Exception {
  YarnTwillRunnerService runner=getTwillRunner();
  runner.start();
  TwillController controller=runner.prepare(new LogLevelTestApplication()).setLogLevel(LogEntry.Level.DEBUG).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out))).start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(200,TimeUnit.SECONDS));
  LogEntry.Level logLevel=waitForLogLevel(controller,LogLevelTestRunnable.class.getSimpleName(),5L,TimeUnit.SECONDS);
  Assert.assertEquals(LogEntry.Level.DEBUG,logLevel);
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.PlacementPolicyTestRun </h4><pre class="type-7 type-2 type-16 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify placement policy without dynamically changing number of instances.
 */
@Test public void testPlacementPolicy() throws Exception {
  Assume.assumeTrue(YarnUtils.getHadoopVersion().equals(YarnUtils.HadoopVersions.HADOOP_22));
  waitNodeManagerCount(0,10,TimeUnit.SECONDS);
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new PlacementPolicyApplication()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("PlacementPolicyTest").withArguments("hostRunnable","host").withArguments("hostRackRunnable","hostRack").withArguments("distributedRunnable","distributed").start();
  try {
    ServiceDiscovered serviceDiscovered=controller.discoverService("PlacementPolicyTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,4,80));
    Assert.assertTrue(getProvisionedNodeManagerCount() >= 2);
  }
  finally {
    controller.terminate().get(120,TimeUnit.SECONDS);
  }
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<pre class="type-7 type-2 type-16 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify changing instances during application run works for DISTRIBUTED runnables.
 */
@Test public void testChangeInstance() throws InterruptedException, TimeoutException, ExecutionException {
  Assume.assumeTrue(YarnUtils.getHadoopVersion().equals(YarnUtils.HadoopVersions.HADOOP_22));
  ServiceDiscovered serviceDiscovered;
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new ChangeInstanceApplication()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("DistributedTest").withArguments("Alice","alice").withArguments("Bob","bob").withArguments("Eve","eve").start();
  try {
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,4,60));
    controller.changeInstances("Alice",4);
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,6,60));
    controller.changeInstances("Alice",1);
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,3,60));
    controller.changeInstances("Bob",3);
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,5,60));
    controller.changeInstances("Eve",3);
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,7,60));
  }
  finally {
    controller.terminate().get(120,TimeUnit.SECONDS);
  }
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<pre class="type-7 type-2 type-16 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify DISTRIBUTED placement policies are taken care of when number of instances are changed.
 * Also, verifies that DISTRIBUTED placement policies do not affect other runnables.
 */
@Test public void testDistributedPlacementPolicy() throws Exception {
  Assume.assumeTrue(YarnUtils.getHadoopVersion().equals(YarnUtils.HadoopVersions.HADOOP_22));
  waitNodeManagerCount(0,10,TimeUnit.SECONDS);
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new DistributedApplication()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("DistributedTest").withArguments("Alice","alice").withArguments("Bob","bob").withArguments("Eve","eve").start();
  try {
    ServiceDiscovered serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,3,60));
    Assert.assertTrue(getProvisionedNodeManagerCount() >= 2);
    controller.changeInstances("Alice",2);
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,4,60));
    Assert.assertTrue(getProvisionedNodeManagerCount() >= 3);
    controller.changeInstances("Eve",2);
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,5,60));
    controller.changeInstances("Bob",2);
    serviceDiscovered=controller.discoverService("DistributedTest");
    Assert.assertTrue(waitForSize(serviceDiscovered,6,60));
    Assert.assertTrue(getProvisionedNodeManagerCount() >= 3);
  }
  finally {
    controller.terminate().get(120,TimeUnit.SECONDS);
  }
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.ResourceReportTestRun </h4><pre class="type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResourceReportWithFailingContainers() throws InterruptedException, IOException, TimeoutException, ExecutionException {
  TwillRunner runner=getTwillRunner();
  ResourceSpecification resourceSpec=ResourceSpecification.Builder.with().setVirtualCores(1).setMemory(256,ResourceSpecification.SizeUnit.MEGA).setInstances(2).build();
  TwillController controller=runner.prepare(new BuggyServer(),resourceSpec).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("BuggyServer","echo2").start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Iterable<Discoverable> echoServices=controller.discoverService("echo");
  Assert.assertTrue(waitForSize(echoServices,2,120));
  ResourceReport report=controller.getResourceReport();
  Assert.assertEquals(2,report.getRunnableResources("BuggyServer").size());
  Discoverable discoverable=echoServices.iterator().next();
  try (Socket socket=new Socket(discoverable.getSocketAddress().getAddress(),discoverable.getSocketAddress().getPort())){
    PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
    writer.println("0");
  }
   int count=0;
  while (count < 100) {
    report=controller.getResourceReport();
    if (report.getRunnableResources("BuggyServer").size() == 1) {
      break;
    }
    LOG.info("Wait for BuggyServer to have 1 instance left. Trial {}.",count);
    count++;
    TimeUnit.SECONDS.sleep(1);
  }
  Assert.assertTrue("Still has 2 contains running after 100 seconds",count < 100);
  controller.terminate().get(100,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRunnablesGetAllowedResourcesInEnv() throws InterruptedException, IOException, TimeoutException, ExecutionException {
  TwillRunner runner=getTwillRunner();
  ResourceSpecification resourceSpec=ResourceSpecification.Builder.with().setVirtualCores(1).setMemory(2048,ResourceSpecification.SizeUnit.MEGA).setInstances(1).build();
  TwillController controller=runner.prepare(new EnvironmentEchoServer(),resourceSpec).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("envecho").withArguments("EnvironmentEchoServer","echo2").start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Iterable<Discoverable> envEchoServices=controller.discoverService("envecho");
  Assert.assertTrue(waitForSize(envEchoServices,1,120));
  Map<String,String> expectedValues=Maps.newHashMap();
  expectedValues.put(EnvKeys.YARN_CONTAINER_MEMORY_MB,"2048");
  expectedValues.put(EnvKeys.TWILL_INSTANCE_COUNT,"1");
  Discoverable discoverable=envEchoServices.iterator().next();
  for (  Map.Entry<String,String> expected : expectedValues.entrySet()) {
    try (Socket socket=new Socket(discoverable.getSocketAddress().getHostName(),discoverable.getSocketAddress().getPort())){
      PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
      LineReader reader=new LineReader(new InputStreamReader(socket.getInputStream(),Charsets.UTF_8));
      writer.println(expected.getKey());
      Assert.assertEquals(expected.getValue(),reader.readLine());
    }
   }
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResourceReport() throws InterruptedException, ExecutionException, IOException, URISyntaxException, TimeoutException {
  TwillRunner runner=getTwillRunner();
  final TwillController controller=runner.prepare(new ResourceApplication()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("echo1","echo1").withArguments("echo2","echo2").start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Iterable<Discoverable> echoServices=controller.discoverService("echo");
  Assert.assertTrue(waitForSize(echoServices,3,120));
  ResourceReport report=controller.getResourceReport();
  Map<String,Collection<TwillRunResources>> usedResources=report.getResources();
  Assert.assertEquals(2,usedResources.keySet().size());
  Assert.assertTrue(usedResources.containsKey("echo1"));
  Assert.assertTrue(usedResources.containsKey("echo2"));
  waitForSize(new Iterable<String>(){
    @Override public Iterator<String> iterator(){
      return controller.getResourceReport().getServices().iterator();
    }
  }
,3,120);
  report=controller.getResourceReport();
  Assert.assertEquals(ImmutableSet.of("echo","echo1","echo2"),ImmutableSet.copyOf(report.getServices()));
  Collection<TwillRunResources> echo1Resources=usedResources.get("echo1");
  Assert.assertEquals(2,echo1Resources.size());
  for (  TwillRunResources resources : echo1Resources) {
    Assert.assertEquals(256,resources.getMemoryMB());
  }
  Collection<TwillRunResources> echo2Resources=usedResources.get("echo2");
  Assert.assertEquals(1,echo2Resources.size());
  for (  TwillRunResources resources : echo2Resources) {
    Assert.assertEquals(512,resources.getMemoryMB());
  }
  controller.changeInstances("echo1",1);
  echoServices=controller.discoverService("echo1");
  Assert.assertTrue(waitForSize(echoServices,1,60));
  report=controller.getResourceReport();
  usedResources=report.getResources();
  Assert.assertEquals(2,usedResources.keySet().size());
  Assert.assertTrue(usedResources.containsKey("echo1"));
  Assert.assertTrue(usedResources.containsKey("echo2"));
  echo1Resources=usedResources.get("echo1");
  Assert.assertEquals(1,echo1Resources.size());
  for (  TwillRunResources resources : echo1Resources) {
    Assert.assertEquals(256,resources.getMemoryMB());
  }
  echo2Resources=usedResources.get("echo2");
  Assert.assertEquals(1,echo2Resources.size());
  for (  TwillRunResources resources : echo2Resources) {
    Assert.assertEquals(512,resources.getMemoryMB());
  }
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.ServiceDiscoveryTestRun </h4><pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testServiceDiscovery() throws InterruptedException, ExecutionException, TimeoutException {
  TwillRunner twillRunner=getTwillRunner();
  TwillController controller=twillRunner.prepare(new ServiceApplication()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").start();
  ServiceDiscovered discovered=controller.discoverService("discovered");
  Assert.assertTrue(waitForSize(discovered,1,120));
  controller.terminate().get();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.SessionExpireTestRun </h4><pre class="type-6 type-9 type-7 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAppSessionExpire() throws InterruptedException, ExecutionException, TimeoutException {
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new SleepRunnable(600)).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).start();
  final CountDownLatch runLatch=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      runLatch.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(runLatch.await(60,TimeUnit.SECONDS));
  for (int i=0; i < 2; i++) {
    Assert.assertTrue(expireAppMasterZKSession(controller,10,TimeUnit.SECONDS));
    try {
      controller.awaitTerminated(10,TimeUnit.SECONDS);
      Assert.fail("Unexpected application termination.");
    }
 catch (    TimeoutException e) {
    }
  }
  controller.terminate().get(120,TimeUnit.SECONDS);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.TaskCompletedTestRun </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testTaskCompleted() throws InterruptedException, TimeoutException, ExecutionException {
  TwillRunner twillRunner=getTwillRunner();
  TwillController controller=twillRunner.prepare(new SleepTask(),ResourceSpecification.Builder.with().setVirtualCores(1).setMemory(512,ResourceSpecification.SizeUnit.MEGA).setInstances(3).build()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).start();
  final CountDownLatch runLatch=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      runLatch.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(runLatch.await(1,TimeUnit.MINUTES));
  controller.awaitTerminated(1,TimeUnit.MINUTES);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.zookeeper.ZKClientTest </h4><pre class="type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren() throws ExecutionException, InterruptedException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setTickTime(1000).build();
  zkServer.startAndWait();
  try {
    ZKClientService client=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    client.startAndWait();
    try {
      client.create("/test",null,CreateMode.PERSISTENT).get();
      Assert.assertTrue(client.getChildren("/test").get().getChildren().isEmpty());
      Futures.allAsList(ImmutableList.of(client.create("/test/c1",null,CreateMode.EPHEMERAL),client.create("/test/c2",null,CreateMode.EPHEMERAL))).get();
      NodeChildren nodeChildren=client.getChildren("/test").get();
      Assert.assertEquals(2,nodeChildren.getChildren().size());
      Assert.assertEquals(ImmutableSet.of("c1","c2"),ImmutableSet.copyOf(nodeChildren.getChildren()));
    }
  finally {
      client.stopAndWait();
    }
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testACL() throws IOException, ExecutionException, InterruptedException, NoSuchAlgorithmException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setDataDir(tmpFolder.newFolder()).setTickTime(1000).build();
  zkServer.startAndWait();
  try {
    String userPass="user:pass";
    String digest=DigestAuthenticationProvider.generateDigest(userPass);
    ZKClientService zkClient=ZKClientService.Builder.of(zkServer.getConnectionStr()).addAuthInfo("digest",userPass.getBytes()).build();
    zkClient.startAndWait();
    ZKClientService noAuthClient=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    noAuthClient.startAndWait();
    String path="/testacl";
    zkClient.create(path,"test".getBytes(),CreateMode.PERSISTENT,ImmutableList.of(new ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE),new ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS))).get();
    ACLData aclData=zkClient.getACL(path).get();
    Assert.assertEquals(2,aclData.getACL().size());
    ACL acl=aclData.getACL().get(1);
    Assert.assertEquals(ZooDefs.Perms.ALL,acl.getPerms());
    Assert.assertEquals("digest",acl.getId().getScheme());
    Assert.assertEquals(digest,acl.getId().getId());
    Assert.assertArrayEquals("test".getBytes(),noAuthClient.getData(path).get().getData());
    try {
      noAuthClient.setData(path,"test2".getBytes()).get();
      Assert.fail();
    }
 catch (    ExecutionException e) {
      Assert.assertTrue(e.getCause() instanceof KeeperException.NoAuthException);
    }
    zkClient.setACL(path,ImmutableList.of(new ACL(ZooDefs.Perms.WRITE,ZooDefs.Ids.ANYONE_ID_UNSAFE))).get();
    noAuthClient.setData(path,"test2".getBytes()).get();
    noAuthClient.stopAndWait();
    zkClient.stopAndWait();
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpireRewatch() throws InterruptedException, IOException, ExecutionException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setTickTime(1000).build();
  zkServer.startAndWait();
  try {
    final CountDownLatch expireReconnectLatch=new CountDownLatch(1);
    final AtomicBoolean expired=new AtomicBoolean(false);
    final ZKClientService client=ZKClientServices.delegate(ZKClients.reWatchOnExpire(ZKClientService.Builder.of(zkServer.getConnectionStr()).setSessionTimeout(2000).setConnectionWatcher(new Watcher(){
      @Override public void process(      WatchedEvent event){
        if (event.getState() == Event.KeeperState.Expired) {
          expired.set(true);
        }
 else         if (event.getState() == Event.KeeperState.SyncConnected && expired.compareAndSet(true,true)) {
          expireReconnectLatch.countDown();
        }
      }
    }
).build()));
    client.startAndWait();
    try {
      final BlockingQueue<Watcher.Event.EventType> events=new LinkedBlockingQueue<>();
      client.exists("/expireRewatch",new Watcher(){
        @Override public void process(        final WatchedEvent event){
          Futures.addCallback(client.exists("/expireRewatch",this),new FutureCallback<Stat>(){
            @Override public void onSuccess(            Stat result){
              events.add(event.getType());
            }
            @Override public void onFailure(            Throwable t){
              LOG.error("Failed to call exists on /expireRewatch",t);
            }
          }
);
        }
      }
);
      client.create("/expireRewatch",null,CreateMode.PERSISTENT);
      Assert.assertEquals(Watcher.Event.EventType.NodeCreated,events.poll(60,TimeUnit.SECONDS));
      KillZKSession.kill(client.getZooKeeperSupplier().get(),zkServer.getConnectionStr(),10000);
      Assert.assertTrue(expireReconnectLatch.await(60,TimeUnit.SECONDS));
      while (ZKOperations.ignoreError(client.delete("/expireRewatch"),KeeperException.class,null).get() == null) {
        LOG.info("Delete failed. Retrying to delete /expireRewatch");
        TimeUnit.MILLISECONDS.sleep(10);
      }
      Assert.assertEquals(Watcher.Event.EventType.NodeDeleted,events.poll(60,TimeUnit.SECONDS));
    }
  finally {
      client.stopAndWait();
    }
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRetry() throws ExecutionException, InterruptedException, TimeoutException, IOException {
  File dataDir=tmpFolder.newFolder();
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setDataDir(dataDir).setTickTime(1000).build();
  zkServer.startAndWait();
  int port=zkServer.getLocalAddress().getPort();
  final CountDownLatch disconnectLatch=new CountDownLatch(1);
  ZKClientService client=ZKClientServices.delegate(ZKClients.retryOnFailure(ZKClientService.Builder.of(zkServer.getConnectionStr()).setConnectionWatcher(new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getState() == Event.KeeperState.Disconnected) {
        disconnectLatch.countDown();
      }
    }
  }
).build(),RetryStrategies.fixDelay(0,TimeUnit.SECONDS)));
  final CountDownLatch createLatch=new CountDownLatch(1);
  client.startAndWait();
  try {
    zkServer.stopAndWait();
    Assert.assertTrue(disconnectLatch.await(1,TimeUnit.SECONDS));
    Futures.addCallback(client.create("/testretry/test",null,CreateMode.PERSISTENT),new FutureCallback<String>(){
      @Override public void onSuccess(      String result){
        createLatch.countDown();
      }
      @Override public void onFailure(      Throwable t){
        t.printStackTrace(System.out);
      }
    }
);
    TimeUnit.SECONDS.sleep(2);
    zkServer=InMemoryZKServer.builder().setDataDir(dataDir).setAutoCleanDataDir(true).setPort(port).setTickTime(1000).build();
    zkServer.startAndWait();
    try {
      Assert.assertTrue(createLatch.await(10,TimeUnit.SECONDS));
    }
  finally {
      zkServer.stopAndWait();
    }
  }
  finally {
    client.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testStop() throws IOException, InterruptedException, ExecutionException {
  try (final ServerSocket serverSocket=new ServerSocket(0)){
    final CountDownLatch connectLatch=new CountDownLatch(1);
    Thread serverThread=new Thread(){
      public void run(){
        try {
          while (!interrupted()) {
            serverSocket.accept().close();
            connectLatch.countDown();
          }
        }
 catch (        Exception e) {
        }
      }
    }
;
    serverThread.start();
    ZKClientService zkClient=ZKClientService.Builder.of("localhost:" + serverSocket.getLocalPort()).build();
    zkClient.start();
    Assert.assertTrue(connectLatch.await(10,TimeUnit.SECONDS));
    zkClient.stopAndWait();
    serverThread.interrupt();
  }
 }

</code></pre>

<br>
<pre class="type-7 type-2 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetData() throws ExecutionException, InterruptedException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setTickTime(1000).build();
  zkServer.startAndWait();
  try {
    ZKClientService client=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    client.startAndWait();
    client.create("/test",null,CreateMode.PERSISTENT).get();
    Assert.assertNull(client.getData("/test").get().getData());
    client.setData("/test","testing".getBytes()).get();
    Assert.assertTrue(Arrays.equals("testing".getBytes(),client.getData("/test").get().getData()));
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-6 type-7 type-2 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateParent() throws ExecutionException, InterruptedException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setTickTime(1000).build();
  zkServer.startAndWait();
  try {
    ZKClientService client=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    client.startAndWait();
    try {
      String path=client.create("/test1/test2/test3/test4/test5","testing".getBytes(),CreateMode.PERSISTENT_SEQUENTIAL).get();
      Assert.assertTrue(path.startsWith("/test1/test2/test3/test4/test5"));
      String dataPath="";
      for (int i=1; i <= 4; i++) {
        dataPath=dataPath + "/test" + i;
        Assert.assertNull(client.getData(dataPath).get().getData());
      }
      Assert.assertTrue(Arrays.equals("testing".getBytes(),client.getData(path).get().getData()));
    }
  finally {
      client.stopAndWait();
    }
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
