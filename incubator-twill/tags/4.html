<h3><span class=" glyphicon glyphicon-tag"/>&nbspAPIUtilityVerifier</h3><kbd>Verifies values of objects/variables related to API calls (Java or TPL) </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.twill.discovery.DiscoveryServiceTestBase </h4><pre class="type-4 type-2 type-3 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChangeListener() throws InterruptedException {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  String serviceName="listener_test";
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover(serviceName);
  final BlockingQueue<List<Discoverable>> events=new ArrayBlockingQueue<List<Discoverable>>(10);
  serviceDiscovered.watchChanges(new ServiceDiscovered.ChangeListener(){
    @Override public void onChange(    ServiceDiscovered serviceDiscovered){
      events.add(ImmutableList.copyOf(serviceDiscovered));
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  List<Discoverable> discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  Assert.assertTrue(discoverables.isEmpty());
  Cancellable cancellable=register(discoveryService,serviceName,"localhost",10000);
  discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  Assert.assertEquals(1,discoverables.size());
  Cancellable cancellable2=register(discoveryService,serviceName,"localhost",10001);
  discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  Assert.assertEquals(2,discoverables.size());
  cancellable.cancel();
  cancellable2.cancel();
  discoverables=events.poll(20,TimeUnit.SECONDS);
  Assert.assertNotNull(discoverables);
  if (!discoverables.isEmpty()) {
    discoverables=events.poll(20,TimeUnit.SECONDS);
  }
  Assert.assertTrue(discoverables.isEmpty());
}

</code></pre>

<br>
<pre class="type-6 type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void manySameDiscoverable() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  List<Cancellable> cancellables=Lists.newArrayList();
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",1));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",2));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",3));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",4));
  cancellables.add(register(discoveryService,"manyDiscoverable","localhost",5));
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover("manyDiscoverable");
  Assert.assertTrue(waitTillExpected(5,serviceDiscovered));
  for (int i=0; i < 5; i++) {
    cancellables.get(i).cancel();
    Assert.assertTrue(waitTillExpected(4 - i,serviceDiscovered));
  }
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIterator() throws InterruptedException {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  final DiscoveryService service=entry.getKey();
  DiscoveryServiceClient client=entry.getValue();
  final String serviceName="iterator";
  ServiceDiscovered discovered=client.discover(serviceName);
  Thread t=new Thread(){
    @Override public void run(){
      service.register(new Discoverable(){
        @Override public String getName(){
          return serviceName;
        }
        @Override public InetSocketAddress getSocketAddress(){
          return new InetSocketAddress(12345);
        }
      }
);
    }
  }
;
  Iterator<Discoverable> iterator=discovered.iterator();
  t.start();
  t.join();
  Assert.assertFalse(iterator.hasNext());
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void simpleDiscoverable() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  Cancellable cancellable=register(discoveryService,"foo","localhost",8090);
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover("foo");
  Assert.assertTrue(waitTillExpected(1,serviceDiscovered));
  Discoverable discoverable=new Discoverable(){
    @Override public String getName(){
      return "foo";
    }
    @Override public InetSocketAddress getSocketAddress(){
      return new InetSocketAddress("localhost",8090);
    }
  }
;
  Assert.assertTrue(serviceDiscovered.contains(discoverable));
  cancellable.cancel();
  Assert.assertTrue(waitTillExpected(0,serviceDiscovered));
  Assert.assertFalse(serviceDiscovered.contains(discoverable));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void multiServiceDiscoverable() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  List<Cancellable> cancellables=Lists.newArrayList();
  cancellables.add(register(discoveryService,"service1","localhost",1));
  cancellables.add(register(discoveryService,"service1","localhost",2));
  cancellables.add(register(discoveryService,"service1","localhost",3));
  cancellables.add(register(discoveryService,"service1","localhost",4));
  cancellables.add(register(discoveryService,"service1","localhost",5));
  cancellables.add(register(discoveryService,"service2","localhost",1));
  cancellables.add(register(discoveryService,"service2","localhost",2));
  cancellables.add(register(discoveryService,"service2","localhost",3));
  cancellables.add(register(discoveryService,"service3","localhost",1));
  cancellables.add(register(discoveryService,"service3","localhost",2));
  ServiceDiscovered serviceDiscovered=discoveryServiceClient.discover("service1");
  Assert.assertTrue(waitTillExpected(5,serviceDiscovered));
  serviceDiscovered=discoveryServiceClient.discover("service2");
  Assert.assertTrue(waitTillExpected(3,serviceDiscovered));
  serviceDiscovered=discoveryServiceClient.discover("service3");
  Assert.assertTrue(waitTillExpected(2,serviceDiscovered));
  cancellables.add(register(discoveryService,"service3","localhost",3));
  Assert.assertTrue(waitTillExpected(3,serviceDiscovered));
  for (  Cancellable cancellable : cancellables) {
    cancellable.cancel();
  }
  Assert.assertTrue(waitTillExpected(0,discoveryServiceClient.discover("service1")));
  Assert.assertTrue(waitTillExpected(0,discoveryServiceClient.discover("service2")));
  Assert.assertTrue(waitTillExpected(0,discoveryServiceClient.discover("service3")));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.discovery.ZKDiscoveryServiceTest </h4><pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSessionExpires() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  Cancellable cancellable=register(discoveryService,"test_expires","localhost",54321);
  ServiceDiscovered discoverables=discoveryServiceClient.discover("test_expires");
  Assert.assertTrue(waitTillExpected(1,discoverables));
  KillZKSession.kill(zkClient.getZooKeeperSupplier().get(),zkServer.getConnectionStr(),10000);
  Cancellable cancellable2=register(discoveryService,"test_expires","localhost",54322);
  Assert.assertTrue(waitTillExpected(2,discoverables));
  cancellable.cancel();
  cancellable2.cancel();
  Assert.assertTrue(waitTillExpected(0,discoverables));
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testDoubleRegister() throws Exception {
  Map.Entry<DiscoveryService,DiscoveryServiceClient> entry=create();
  DiscoveryService discoveryService=entry.getKey();
  DiscoveryServiceClient discoveryServiceClient=entry.getValue();
  Cancellable cancellable=register(discoveryService,"test_double_reg","localhost",54321);
  Cancellable cancellable2=register(discoveryService,"test_double_reg","localhost",54321);
  ServiceDiscovered discoverables=discoveryServiceClient.discover("test_double_reg");
  Assert.assertTrue(waitTillExpected(1,discoverables));
  cancellable.cancel();
  cancellable2.cancel();
  final ZKClientService zkClient2=ZKClientServices.delegate(ZKClients.retryOnFailure(ZKClients.reWatchOnExpire(ZKClientService.Builder.of(zkServer.getConnectionStr()).build()),RetryStrategies.fixDelay(1,TimeUnit.SECONDS)));
  zkClient2.startAndWait();
  try {
    DiscoveryService discoveryService2=new ZKDiscoveryService(zkClient2);
    cancellable2=register(discoveryService2,"test_multi_client","localhost",54321);
    new Thread(){
      @Override public void run(){
        try {
          TimeUnit.SECONDS.sleep(2);
          zkClient2.stopAndWait();
        }
 catch (        InterruptedException e) {
          LOG.error(e.getMessage(),e);
        }
      }
    }
.start();
    cancellable=register(discoveryService,"test_multi_client","localhost",54321);
    cancellable.cancel();
  }
  finally {
    zkClient2.stopAndWait();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.ext.BundledJarRunnableTest </h4><pre class="type-4 type-7 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testArgumentsOperations(){
  String[] mainArgs={"a","b","c"};
  String jarFileName="test/123.jar";
  String libFolder="libsdf";
  String mainClassName="org.apache.twill.ext.Test";
  List<String> argsArrayList=ImmutableList.<String>builder().add(jarFileName).add(libFolder).add(mainClassName).addAll(Lists.newArrayList(mainArgs)).build();
  String[] argsArray=argsArrayList.toArray(new String[argsArrayList.size()]);
  BundledJarRunner.Arguments args=new BundledJarRunner.Arguments.Builder().setMainArgs(mainArgs).setJarFileName(jarFileName).setLibFolder(libFolder).setMainClassName(mainClassName).createArguments();
  Assert.assertArrayEquals(mainArgs,args.getMainArgs());
  Assert.assertEquals(jarFileName,args.getJarFileName());
  Assert.assertEquals(libFolder,args.getLibFolder());
  Assert.assertEquals(mainClassName,args.getMainClassName());
  String[] array=args.toArray();
  Assert.assertArrayEquals(argsArray,array);
  Assert.assertEquals(args,BundledJarRunner.Arguments.fromArray(array));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.ControllerTest </h4><pre class="type-4 type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testController() throws ExecutionException, InterruptedException, TimeoutException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().build();
  zkServer.startAndWait();
  LOG.info("ZKServer: " + zkServer.getConnectionStr());
  try {
    RunId runId=RunIds.generate();
    ZKClientService zkClientService=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    zkClientService.startAndWait();
    Service service=createService(zkClientService,runId);
    service.startAndWait();
    TwillController controller=getController(zkClientService,runId);
    controller.sendCommand(Command.Builder.of("test").build()).get(2,TimeUnit.SECONDS);
    controller.terminate().get(2,TimeUnit.SECONDS);
    final CountDownLatch terminateLatch=new CountDownLatch(1);
    service.addListener(new ServiceListenerAdapter(){
      @Override public void terminated(      Service.State from){
        terminateLatch.countDown();
      }
    }
,Threads.SAME_THREAD_EXECUTOR);
    Assert.assertTrue(service.state() == Service.State.TERMINATED || terminateLatch.await(2,TimeUnit.SECONDS));
    zkClientService.stopAndWait();
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.json.JvmOptionsCodecTest </h4><pre class="type-4 type-7 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNoNulls() throws Exception {
  JvmOptions options=new JvmOptions("-version",new JvmOptions.DebugOptions(true,false,ImmutableSet.of("one","two")));
  final StringWriter writer=new StringWriter();
  JvmOptionsCodec.encode(options,new OutputSupplier<Writer>(){
    @Override public Writer getOutput() throws IOException {
      return writer;
    }
  }
);
  JvmOptions options1=JvmOptionsCodec.decode(new InputSupplier<Reader>(){
    @Override public Reader getInput() throws IOException {
      return new StringReader(writer.toString());
    }
  }
);
  Assert.assertEquals(options.getExtraOptions(),options1.getExtraOptions());
  Assert.assertEquals(options.getDebugOptions().doDebug(),options1.getDebugOptions().doDebug());
  Assert.assertEquals(options.getDebugOptions().doSuspend(),options1.getDebugOptions().doSuspend());
  Assert.assertEquals(options.getDebugOptions().getRunnables(),options1.getDebugOptions().getRunnables());
}

</code></pre>

<br>
<pre class="type-4 type-7 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNoRunnables() throws Exception {
  List<String> noRunnables=Collections.emptyList();
  JvmOptions options=new JvmOptions(null,new JvmOptions.DebugOptions(true,false,noRunnables));
  final StringWriter writer=new StringWriter();
  JvmOptionsCodec.encode(options,new OutputSupplier<Writer>(){
    @Override public Writer getOutput() throws IOException {
      return writer;
    }
  }
);
  JvmOptions options1=JvmOptionsCodec.decode(new InputSupplier<Reader>(){
    @Override public Reader getInput() throws IOException {
      return new StringReader(writer.toString());
    }
  }
);
  Assert.assertEquals(options.getExtraOptions(),options1.getExtraOptions());
  Assert.assertEquals(options.getDebugOptions().doDebug(),options1.getDebugOptions().doDebug());
  Assert.assertEquals(options.getDebugOptions().doSuspend(),options1.getDebugOptions().doSuspend());
  Assert.assertEquals(options.getDebugOptions().getRunnables(),options1.getDebugOptions().getRunnables());
}

</code></pre>

<br>
<pre class="type-4 type-7 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSomeNulls() throws Exception {
  JvmOptions options=new JvmOptions(null,new JvmOptions.DebugOptions(false,false,null));
  final StringWriter writer=new StringWriter();
  JvmOptionsCodec.encode(options,new OutputSupplier<Writer>(){
    @Override public Writer getOutput() throws IOException {
      return writer;
    }
  }
);
  JvmOptions options1=JvmOptionsCodec.decode(new InputSupplier<Reader>(){
    @Override public Reader getInput() throws IOException {
      return new StringReader(writer.toString());
    }
  }
);
  Assert.assertEquals(options.getExtraOptions(),options1.getExtraOptions());
  Assert.assertEquals(options.getDebugOptions().doDebug(),options1.getDebugOptions().doDebug());
  Assert.assertEquals(options.getDebugOptions().doSuspend(),options1.getDebugOptions().doSuspend());
  Assert.assertEquals(options.getDebugOptions().getRunnables(),options1.getDebugOptions().getRunnables());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.internal.utils.ApplicationBundlerTest </h4><pre class="type-4 type-7 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testFindDependencies() throws IOException, ClassNotFoundException {
  Location location=new LocalLocationFactory(tmpDir.newFolder()).create("test.jar");
  ApplicationBundler bundler=new ApplicationBundler(ImmutableList.<String>of());
  bundler.createBundle(location,ApplicationBundler.class);
  File targetDir=tmpDir.newFolder();
  unjar(new File(location.toURI()),targetDir);
  ClassLoader classLoader=createClassLoader(targetDir);
  Class<?> clz=classLoader.loadClass(ApplicationBundler.class.getName());
  Assert.assertSame(classLoader,clz.getClassLoader());
  clz=classLoader.loadClass(Object.class.getName());
  Assert.assertNotSame(classLoader,clz.getClassLoader());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.EchoServerTestRun </h4><pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEchoServer() throws Exception {
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new EchoServer(),ResourceSpecification.Builder.with().setVirtualCores(1).setMemory(1,ResourceSpecification.SizeUnit.GIGA).setInstances(2).build()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("EchoServer","echo2").start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Iterable<Discoverable> echoServices=controller.discoverService("echo");
  Assert.assertTrue(waitForSize(echoServices,2,120));
  for (  Discoverable discoverable : echoServices) {
    String msg="Hello: " + discoverable.getSocketAddress();
    try (Socket socket=new Socket(discoverable.getSocketAddress().getAddress(),discoverable.getSocketAddress().getPort())){
      PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
      LineReader reader=new LineReader(new InputStreamReader(socket.getInputStream(),Charsets.UTF_8));
      writer.println(msg);
      Assert.assertEquals(msg,reader.readLine());
    }
   }
  controller.changeInstances("EchoServer",3);
  Assert.assertTrue(waitForSize(echoServices,3,120));
  echoServices=controller.discoverService("echo2");
  controller.changeInstances("EchoServer",1);
  Assert.assertTrue(waitForSize(echoServices,1,120));
  controller.changeInstances("EchoServer",2);
  Assert.assertTrue(waitForSize(echoServices,2,120));
  Map<Integer,String> instanceIdToContainerId=Maps.newHashMap();
  ResourceReport report=waitForAfterRestartResourceReport(controller,"EchoServer",15L,TimeUnit.MINUTES,2,null);
  Assert.assertTrue(report != null);
  Collection<TwillRunResources> runResources=report.getRunnableResources("EchoServer");
  for (  TwillRunResources twillRunResources : runResources) {
    instanceIdToContainerId.put(twillRunResources.getInstanceId(),twillRunResources.getContainerId());
  }
  controller.restartAllInstances("EchoServer");
  Assert.assertTrue(waitForSize(echoServices,2,120));
  report=waitForAfterRestartResourceReport(controller,"EchoServer",15L,TimeUnit.MINUTES,2,instanceIdToContainerId);
  Assert.assertTrue(report != null);
  Iterable<TwillRunner.LiveInfo> apps=runner.lookupLive();
  Assert.assertTrue(waitForSize(apps,1,120));
  TwillRunnerService runnerService=TWILL_TESTER.createTwillRunnerService();
  runnerService.start();
  try {
    Iterable<TwillController> controllers=runnerService.lookup("EchoServer");
    Assert.assertTrue(waitForSize(controllers,1,120));
    for (    TwillController c : controllers) {
      LOG.info("Stopping application: " + c.getRunId());
      c.terminate().get(30,TimeUnit.SECONDS);
    }
    Assert.assertTrue(waitForSize(apps,0,120));
  }
  finally {
    runnerService.stop();
  }
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.EnvironmentTestRun </h4><pre class="type-4 type-7 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEnv() throws Exception {
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new EchoApp()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("echo1","echo1").withArguments("echo2","echo2").withEnv(ImmutableMap.of("GREETING","Hello")).withEnv("echo2",ImmutableMap.of("GREETING","Hello2")).start();
  Map<String,String> runnableGreetings=ImmutableMap.of("echo1","Hello","echo2","Hello2");
  for (  Map.Entry<String,String> entry : runnableGreetings.entrySet()) {
    Discoverable discoverable=getDiscoverable(controller.discoverService(entry.getKey()),60,TimeUnit.SECONDS);
    try (Socket socket=new Socket(discoverable.getSocketAddress().getAddress(),discoverable.getSocketAddress().getPort())){
      PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
      LineReader reader=new LineReader(new InputStreamReader(socket.getInputStream(),Charsets.UTF_8));
      writer.println("GREETING");
      Assert.assertEquals(entry.getValue(),reader.readLine());
    }
   }
  controller.terminate().get();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.LocalFileTestRun </h4><pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLocalFile() throws Exception {
  String header=Files.readFirstLine(new File(getClass().getClassLoader().getResource("header.txt").toURI()),Charsets.UTF_8);
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new LocalFileApplication()).addJVMOptions(" -verbose:gc -Xloggc:gc.log -XX:+PrintGCDetails").withApplicationArguments("local").withArguments("LocalFileSocketServer","local2").addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).start();
  Iterable<Discoverable> discoverables=controller.discoverService("local");
  Assert.assertTrue(waitForSize(discoverables,1,60));
  InetSocketAddress socketAddress=discoverables.iterator().next().getSocketAddress();
  try (Socket socket=new Socket(socketAddress.getAddress(),socketAddress.getPort())){
    PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
    LineReader reader=new LineReader(new InputStreamReader(socket.getInputStream(),Charsets.UTF_8));
    String msg="Local file test";
    writer.println(msg);
    Assert.assertEquals(header,reader.readLine());
    Assert.assertEquals(msg,reader.readLine());
  }
   controller.terminate().get(120,TimeUnit.SECONDS);
  Assert.assertTrue(waitForSize(discoverables,0,60));
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.LogHandlerTestRun </h4><pre class="type-4 type-14 type-7 type-2 type-3 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLogHandler() throws ExecutionException, InterruptedException, TimeoutException {
  final CountDownLatch latch=new CountDownLatch(3);
  final Queue<LogThrowable> throwables=new ConcurrentLinkedQueue<LogThrowable>();
  final Queue<String> runnables=new ConcurrentLinkedQueue<String>();
  LogHandler logHandler=new LogHandler(){
    @Override public void onLog(    LogEntry logEntry){
      if (logEntry.getSourceClassName().contains("LogHandlerTestRun")) {
        runnables.add(logEntry.getRunnableName());
      }
      if (logEntry.getSourceClassName().contains("ApplicationMasterService")) {
        Assert.assertNull(logEntry.getRunnableName());
      }
      if (logEntry.getMessage().startsWith("Starting runnable " + LogRunnable.class.getSimpleName())) {
        latch.countDown();
      }
 else       if (logEntry.getMessage().equals("Running")) {
        latch.countDown();
      }
 else       if (logEntry.getMessage().equals("Got exception") && logEntry.getThrowable() != null) {
        throwables.add(logEntry.getThrowable());
        latch.countDown();
      }
    }
  }
;
  TwillRunner runner=getTwillRunner();
  TwillController controller=runner.prepare(new LogRunnable()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).addLogHandler(logHandler).start();
  try {
    Assert.assertTrue(latch.await(100,TimeUnit.SECONDS));
  }
  finally {
    controller.terminate().get(120,TimeUnit.SECONDS);
  }
  Assert.assertEquals(2,runnables.size());
  Assert.assertArrayEquals(new String[]{"LogRunnable","LogRunnable"},runnables.toArray());
  Assert.assertEquals(1,throwables.size());
  LogThrowable t=throwables.poll();
  Assert.assertEquals(RuntimeException.class.getName(),t.getClassName());
  Assert.assertNotNull(t.getCause());
  Assert.assertEquals(5,t.getStackTraces().length);
  t=t.getCause();
  Assert.assertEquals(Exception.class.getName(),t.getClassName());
  Assert.assertEquals("Exception",t.getMessage());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.LogLevelTestRun </h4><pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDebugLogLevel() throws Exception {
  YarnTwillRunnerService runner=getTwillRunner();
  runner.start();
  TwillController controller=runner.prepare(new LogLevelTestApplication()).setLogLevel(LogEntry.Level.DEBUG).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out))).start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(200,TimeUnit.SECONDS));
  LogEntry.Level logLevel=waitForLogLevel(controller,LogLevelTestRunnable.class.getSimpleName(),5L,TimeUnit.SECONDS);
  Assert.assertEquals(LogEntry.Level.DEBUG,logLevel);
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.yarn.ResourceReportTestRun </h4><pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRunnablesGetAllowedResourcesInEnv() throws InterruptedException, IOException, TimeoutException, ExecutionException {
  TwillRunner runner=getTwillRunner();
  ResourceSpecification resourceSpec=ResourceSpecification.Builder.with().setVirtualCores(1).setMemory(2048,ResourceSpecification.SizeUnit.MEGA).setInstances(1).build();
  TwillController controller=runner.prepare(new EnvironmentEchoServer(),resourceSpec).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("envecho").withArguments("EnvironmentEchoServer","echo2").start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Iterable<Discoverable> envEchoServices=controller.discoverService("envecho");
  Assert.assertTrue(waitForSize(envEchoServices,1,120));
  Map<String,String> expectedValues=Maps.newHashMap();
  expectedValues.put(EnvKeys.YARN_CONTAINER_MEMORY_MB,"2048");
  expectedValues.put(EnvKeys.TWILL_INSTANCE_COUNT,"1");
  Discoverable discoverable=envEchoServices.iterator().next();
  for (  Map.Entry<String,String> expected : expectedValues.entrySet()) {
    try (Socket socket=new Socket(discoverable.getSocketAddress().getHostName(),discoverable.getSocketAddress().getPort())){
      PrintWriter writer=new PrintWriter(new OutputStreamWriter(socket.getOutputStream(),Charsets.UTF_8),true);
      LineReader reader=new LineReader(new InputStreamReader(socket.getInputStream(),Charsets.UTF_8));
      writer.println(expected.getKey());
      Assert.assertEquals(expected.getValue(),reader.readLine());
    }
   }
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<pre class="type-4 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResourceReport() throws InterruptedException, ExecutionException, IOException, URISyntaxException, TimeoutException {
  TwillRunner runner=getTwillRunner();
  final TwillController controller=runner.prepare(new ResourceApplication()).addLogHandler(new PrinterLogHandler(new PrintWriter(System.out,true))).withApplicationArguments("echo").withArguments("echo1","echo1").withArguments("echo2","echo2").start();
  final CountDownLatch running=new CountDownLatch(1);
  controller.onRunning(new Runnable(){
    @Override public void run(){
      running.countDown();
    }
  }
,Threads.SAME_THREAD_EXECUTOR);
  Assert.assertTrue(running.await(120,TimeUnit.SECONDS));
  Iterable<Discoverable> echoServices=controller.discoverService("echo");
  Assert.assertTrue(waitForSize(echoServices,3,120));
  ResourceReport report=controller.getResourceReport();
  Map<String,Collection<TwillRunResources>> usedResources=report.getResources();
  Assert.assertEquals(2,usedResources.keySet().size());
  Assert.assertTrue(usedResources.containsKey("echo1"));
  Assert.assertTrue(usedResources.containsKey("echo2"));
  waitForSize(new Iterable<String>(){
    @Override public Iterator<String> iterator(){
      return controller.getResourceReport().getServices().iterator();
    }
  }
,3,120);
  report=controller.getResourceReport();
  Assert.assertEquals(ImmutableSet.of("echo","echo1","echo2"),ImmutableSet.copyOf(report.getServices()));
  Collection<TwillRunResources> echo1Resources=usedResources.get("echo1");
  Assert.assertEquals(2,echo1Resources.size());
  for (  TwillRunResources resources : echo1Resources) {
    Assert.assertEquals(256,resources.getMemoryMB());
  }
  Collection<TwillRunResources> echo2Resources=usedResources.get("echo2");
  Assert.assertEquals(1,echo2Resources.size());
  for (  TwillRunResources resources : echo2Resources) {
    Assert.assertEquals(512,resources.getMemoryMB());
  }
  controller.changeInstances("echo1",1);
  echoServices=controller.discoverService("echo1");
  Assert.assertTrue(waitForSize(echoServices,1,60));
  report=controller.getResourceReport();
  usedResources=report.getResources();
  Assert.assertEquals(2,usedResources.keySet().size());
  Assert.assertTrue(usedResources.containsKey("echo1"));
  Assert.assertTrue(usedResources.containsKey("echo2"));
  echo1Resources=usedResources.get("echo1");
  Assert.assertEquals(1,echo1Resources.size());
  for (  TwillRunResources resources : echo1Resources) {
    Assert.assertEquals(256,resources.getMemoryMB());
  }
  echo2Resources=usedResources.get("echo2");
  Assert.assertEquals(1,echo2Resources.size());
  for (  TwillRunResources resources : echo2Resources) {
    Assert.assertEquals(512,resources.getMemoryMB());
  }
  controller.terminate().get(120,TimeUnit.SECONDS);
  TimeUnit.SECONDS.sleep(2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.twill.zookeeper.ZKClientTest </h4><pre class="type-4 type-7 type-3 type-1 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNamespace() throws ExecutionException, InterruptedException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setTickTime(1000).build();
  zkServer.startAndWait();
  try {
    ZKClientService zkClient=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    zkClient.startAndWait();
    ZKClient zk=ZKClients.namespace(zkClient,"/test");
    OperationFuture<String> createFuture=zk.create("/",null,CreateMode.PERSISTENT);
    Assert.assertEquals("/",createFuture.getRequestPath());
    Assert.assertEquals("/",createFuture.get());
    createFuture=zk.create("/subpath",null,CreateMode.PERSISTENT);
    Assert.assertEquals("/subpath",createFuture.getRequestPath());
    Assert.assertEquals("/subpath",createFuture.get());
    OperationFuture<Stat> existsFuture=zk.exists("/subpath");
    Assert.assertEquals("/subpath",existsFuture.getRequestPath());
    Assert.assertNotNull(existsFuture.get());
    OperationFuture<Stat> setFuture=zk.setData("/subpath","hello".getBytes());
    Assert.assertEquals("/subpath",setFuture.getRequestPath());
    Assert.assertNotNull(setFuture.get());
    OperationFuture<NodeData> getFuture=zk.getData("/subpath");
    Assert.assertEquals("/subpath",getFuture.getRequestPath());
    Assert.assertArrayEquals("hello".getBytes(),getFuture.get().getData());
    OperationFuture<String> deleteFuture=zk.delete("/subpath");
    Assert.assertEquals("/subpath",deleteFuture.getRequestPath());
    Assert.assertEquals("/subpath",deleteFuture.get());
    deleteFuture=zk.delete("/");
    Assert.assertEquals("/",deleteFuture.getRequestPath());
    Assert.assertEquals("/",deleteFuture.get());
    Assert.assertNull(zkClient.exists("/test").get());
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-7 type-2 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testACL() throws IOException, ExecutionException, InterruptedException, NoSuchAlgorithmException {
  InMemoryZKServer zkServer=InMemoryZKServer.builder().setDataDir(tmpFolder.newFolder()).setTickTime(1000).build();
  zkServer.startAndWait();
  try {
    String userPass="user:pass";
    String digest=DigestAuthenticationProvider.generateDigest(userPass);
    ZKClientService zkClient=ZKClientService.Builder.of(zkServer.getConnectionStr()).addAuthInfo("digest",userPass.getBytes()).build();
    zkClient.startAndWait();
    ZKClientService noAuthClient=ZKClientService.Builder.of(zkServer.getConnectionStr()).build();
    noAuthClient.startAndWait();
    String path="/testacl";
    zkClient.create(path,"test".getBytes(),CreateMode.PERSISTENT,ImmutableList.of(new ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE),new ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS))).get();
    ACLData aclData=zkClient.getACL(path).get();
    Assert.assertEquals(2,aclData.getACL().size());
    ACL acl=aclData.getACL().get(1);
    Assert.assertEquals(ZooDefs.Perms.ALL,acl.getPerms());
    Assert.assertEquals("digest",acl.getId().getScheme());
    Assert.assertEquals(digest,acl.getId().getId());
    Assert.assertArrayEquals("test".getBytes(),noAuthClient.getData(path).get().getData());
    try {
      noAuthClient.setData(path,"test2".getBytes()).get();
      Assert.fail();
    }
 catch (    ExecutionException e) {
      Assert.assertTrue(e.getCause() instanceof KeeperException.NoAuthException);
    }
    zkClient.setACL(path,ImmutableList.of(new ACL(ZooDefs.Perms.WRITE,ZooDefs.Ids.ANYONE_ID_UNSAFE))).get();
    noAuthClient.setData(path,"test2".getBytes()).get();
    noAuthClient.stopAndWait();
    zkClient.stopAndWait();
  }
  finally {
    zkServer.stopAndWait();
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
