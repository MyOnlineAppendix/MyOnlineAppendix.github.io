<h3 style="margin:0px">Class: org.apache.hive.hcatalog.api.TestHCatClient (20 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(18)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(17)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(1)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * This test tests that a plain table instantiation matches what hive says an
 * empty table create should look like.
 * @throws Exception
 */
@Test public void testEmptyTableInstantiation() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  String dbName="default";
  String tblName="testEmptyCreate";
  ArrayList<HCatFieldSchema> cols=new ArrayList<HCatFieldSchema>();
  cols.add(new HCatFieldSchema("id",Type.INT,"id comment"));
  cols.add(new HCatFieldSchema("value",Type.STRING,"value comment"));
  client.dropTable(dbName,tblName,true);
  client.createTable(HCatCreateTableDesc.create(new HCatTable(dbName,tblName).cols(cols),false).build());
  HCatTable tCreated=client.getTable(dbName,tblName);
  org.apache.hadoop.hive.metastore.api.Table emptyTable=Table.getEmptyTable(dbName,tblName);
  Map<String,String> createdProps=tCreated.getTblProps();
  Map<String,String> emptyProps=emptyTable.getParameters();
  mapEqualsContainedIn(emptyProps,createdProps);
  Map<String,String> createdSdParams=tCreated.getSerdeParams();
  Map<String,String> emptySdParams=emptyTable.getSd().getSerdeInfo().getParameters();
  mapEqualsContainedIn(emptySdParams,createdSdParams);
}

</code></pre>

<pre class="type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testCreateTableLike() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  String tableName="tableone";
  String cloneTable="tabletwo";
  client.dropTable(null,tableName,true);
  client.dropTable(null,cloneTable,true);
  ArrayList<HCatFieldSchema> cols=new ArrayList<HCatFieldSchema>();
  cols.add(new HCatFieldSchema("id",Type.INT,"id columns"));
  cols.add(new HCatFieldSchema("value",Type.STRING,"id columns"));
  HCatCreateTableDesc tableDesc=HCatCreateTableDesc.create(null,tableName,cols).fileFormat("rcfile").build();
  client.createTable(tableDesc);
  client.createTableLike(null,tableName,cloneTable,true,false,null);
  List<String> tables=client.listTableNamesByPattern(null,"table*");
  assertTrue(tables.size() == 2);
  client.close();
}

</code></pre>

<pre class="type-11 type-12 type-3 type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasicDDLCommands() throws Exception {
  String db="testdb";
  String tableOne="testTable1";
  String tableTwo="testTable2";
  String tableThree="testTable3";
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  client.dropDatabase(db,true,HCatClient.DropDBMode.CASCADE);
  HCatCreateDBDesc dbDesc=HCatCreateDBDesc.create(db).ifNotExists(false).build();
  client.createDatabase(dbDesc);
  List<String> dbNames=client.listDatabaseNamesByPattern("*");
  assertTrue(dbNames.contains("default"));
  assertTrue(dbNames.contains(db));
  HCatDatabase testDb=client.getDatabase(db);
  assertTrue(testDb.getComment() == null);
  assertTrue(testDb.getProperties().size() == 0);
  String warehouseDir=System.getProperty("test.warehouse.dir","/user/hive/warehouse");
  if (useExternalMS) {
    assertTrue(testDb.getLocation().matches(".*" + "/" + db + ".db"));
  }
 else {
    String expectedDir=warehouseDir.replaceFirst("pfile:///","pfile:/");
    assertEquals(expectedDir + "/" + db+ ".db",testDb.getLocation());
  }
  ArrayList<HCatFieldSchema> cols=new ArrayList<HCatFieldSchema>();
  cols.add(new HCatFieldSchema("id",Type.INT,"id comment"));
  cols.add(new HCatFieldSchema("value",Type.STRING,"value comment"));
  HCatCreateTableDesc tableDesc=HCatCreateTableDesc.create(db,tableOne,cols).fileFormat("rcfile").build();
  client.createTable(tableDesc);
  HCatTable table1=client.getTable(db,tableOne);
  assertTrue(table1.getInputFileFormat().equalsIgnoreCase(RCFileInputFormat.class.getName()));
  assertTrue(table1.getOutputFileFormat().equalsIgnoreCase(RCFileOutputFormat.class.getName()));
  assertTrue(table1.getSerdeLib().equalsIgnoreCase(LazyBinaryColumnarSerDe.class.getName()));
  assertTrue(table1.getCols().equals(cols));
  try {
    client.createTable(tableDesc);
    fail("Expected exception");
  }
 catch (  HCatException e) {
    assertTrue(e.getMessage().contains("AlreadyExistsException while creating table."));
  }
  client.dropTable(db,tableOne,true);
  HCatCreateTableDesc tableDesc2=HCatCreateTableDesc.create(db,tableTwo,cols).fieldsTerminatedBy('\001').escapeChar('\002').linesTerminatedBy('\003').mapKeysTerminatedBy('\004').collectionItemsTerminatedBy('\005').nullDefinedAs('\006').build();
  client.createTable(tableDesc2);
  HCatTable table2=client.getTable(db,tableTwo);
  assertTrue("Expected TextInputFormat, but got: " + table2.getInputFileFormat(),table2.getInputFileFormat().equalsIgnoreCase(TextInputFormat.class.getName()));
  assertTrue(table2.getOutputFileFormat().equalsIgnoreCase(HiveIgnoreKeyTextOutputFormat.class.getName()));
  assertTrue("SerdeParams not found",table2.getSerdeParams() != null);
  assertEquals("checking " + serdeConstants.FIELD_DELIM,Character.toString('\001'),table2.getSerdeParams().get(serdeConstants.FIELD_DELIM));
  assertEquals("checking " + serdeConstants.ESCAPE_CHAR,Character.toString('\002'),table2.getSerdeParams().get(serdeConstants.ESCAPE_CHAR));
  assertEquals("checking " + serdeConstants.LINE_DELIM,Character.toString('\003'),table2.getSerdeParams().get(serdeConstants.LINE_DELIM));
  assertEquals("checking " + serdeConstants.MAPKEY_DELIM,Character.toString('\004'),table2.getSerdeParams().get(serdeConstants.MAPKEY_DELIM));
  assertEquals("checking " + serdeConstants.COLLECTION_DELIM,Character.toString('\005'),table2.getSerdeParams().get(serdeConstants.COLLECTION_DELIM));
  assertEquals("checking " + serdeConstants.SERIALIZATION_NULL_FORMAT,Character.toString('\006'),table2.getSerdeParams().get(serdeConstants.SERIALIZATION_NULL_FORMAT));
  assertTrue(table2.getLocation().toLowerCase().matches(".*" + ("/" + db + ".db/"+ tableTwo).toLowerCase()));
  HCatCreateTableDesc tableDesc3=HCatCreateTableDesc.create(db,tableThree,cols).fileFormat("orcfile").build();
  client.createTable(tableDesc3);
  HCatTable table3=client.getTable(db,tableThree);
  assertTrue(table3.getInputFileFormat().equalsIgnoreCase(OrcInputFormat.class.getName()));
  assertTrue(table3.getOutputFileFormat().equalsIgnoreCase(OrcOutputFormat.class.getName()));
  assertTrue(table3.getSerdeLib().equalsIgnoreCase(OrcSerde.class.getName()));
  assertTrue(table1.getCols().equals(cols));
  client.close();
}

</code></pre>

<pre class="type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartitionSchema() throws Exception {
  try {
    HCatClient client=HCatClient.create(new Configuration(hcatConf));
    final String dbName="myDb";
    final String tableName="myTable";
    client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    client.createDatabase(HCatCreateDBDesc.create(dbName).build());
    List<HCatFieldSchema> columnSchema=Arrays.asList(new HCatFieldSchema("foo",Type.INT,""),new HCatFieldSchema("bar",Type.STRING,""));
    List<HCatFieldSchema> partitionSchema=Arrays.asList(new HCatFieldSchema("dt",Type.STRING,""),new HCatFieldSchema("grid",Type.STRING,""));
    client.createTable(HCatCreateTableDesc.create(dbName,tableName,columnSchema).partCols(partitionSchema).build());
    HCatTable table=client.getTable(dbName,tableName);
    List<HCatFieldSchema> partitionColumns=table.getPartCols();
    assertArrayEquals("Didn't get expected partition-schema back from the HCatTable.",partitionSchema.toArray(),partitionColumns.toArray());
    client.dropDatabase(dbName,false,HCatClient.DropDBMode.CASCADE);
  }
 catch (  Exception unexpected) {
    LOG.error("Unexpected exception!",unexpected);
    assertTrue("Unexpected exception! " + unexpected.getMessage(),false);
  }
}

</code></pre>

<pre class="type-6 type-4 type-5 type-7 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that partition-definitions can be replicated between HCat-instances,
 * independently of table-metadata replication, using PartitionSpec interfaces.
 * (This is essentially the same test as testPartitionRegistrationWithCustomSchema(),
 * transliterated to use the PartitionSpec APIs.)
 * 2 identical tables are created on 2 different HCat instances ("source" and "target").
 * On the source instance,
 * 1. One partition is added with the old format ("TEXTFILE").
 * 2. The table is updated with an additional column and the data-format changed to ORC.
 * 3. Another partition is added with the new format.
 * 4. The partitions' metadata is copied to the target HCat instance, without updating the target table definition.
 * 5. The partitions' metadata is tested to be an exact replica of that on the source.
 * @throws Exception
 */
@Test public void testPartitionSpecRegistrationWithCustomSchema() throws Exception {
  try {
    startReplicationTargetMetaStoreIfRequired();
    HCatClient sourceMetaStore=HCatClient.create(new Configuration(hcatConf));
    final String dbName="myDb";
    final String tableName="myTable";
    sourceMetaStore.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    sourceMetaStore.createDatabase(HCatCreateDBDesc.create(dbName).build());
    List<HCatFieldSchema> columnSchema=new ArrayList<HCatFieldSchema>(Arrays.asList(new HCatFieldSchema("foo",Type.INT,""),new HCatFieldSchema("bar",Type.STRING,"")));
    List<HCatFieldSchema> partitionSchema=Arrays.asList(new HCatFieldSchema("dt",Type.STRING,""),new HCatFieldSchema("grid",Type.STRING,""));
    HCatTable sourceTable=new HCatTable(dbName,tableName).cols(columnSchema).partCols(partitionSchema).comment("Source table.");
    sourceMetaStore.createTable(HCatCreateTableDesc.create(sourceTable).build());
    sourceTable=sourceMetaStore.getTable(dbName,tableName);
    assertNotNull("Table couldn't be queried for. ",sourceTable);
    Map<String,String> partitionSpec_1=new HashMap<String,String>();
    partitionSpec_1.put("grid","AB");
    partitionSpec_1.put("dt","2011_12_31");
    HCatPartition sourcePartition_1=new HCatPartition(sourceTable,partitionSpec_1,makePartLocation(sourceTable,partitionSpec_1));
    sourceMetaStore.addPartition(HCatAddPartitionDesc.create(sourcePartition_1).build());
    assertEquals("Unexpected number of partitions. ",1,sourceMetaStore.getPartitions(dbName,tableName).size());
    HCatPartition addedPartition_1=sourceMetaStore.getPartition(dbName,tableName,partitionSpec_1);
    assertEquals("Column schema doesn't match.",sourceTable.getCols(),addedPartition_1.getColumns());
    assertEquals("InputFormat doesn't match.",sourceTable.getInputFileFormat(),addedPartition_1.getInputFormat());
    assertEquals("OutputFormat doesn't match.",sourceTable.getOutputFileFormat(),addedPartition_1.getOutputFormat());
    assertEquals("SerDe doesn't match.",sourceTable.getSerdeLib(),addedPartition_1.getSerDe());
    assertEquals("SerDe params don't match.",sourceTable.getSerdeParams(),addedPartition_1.getSerdeParams());
    HCatClient targetMetaStore=HCatClient.create(new Configuration(replicationTargetHCatConf));
    targetMetaStore.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    targetMetaStore.createDatabase(HCatCreateDBDesc.create(dbName).build());
    HCatTable targetTable=targetMetaStore.deserializeTable(sourceMetaStore.serializeTable(sourceTable));
    targetMetaStore.createTable(HCatCreateTableDesc.create(targetTable).build());
    targetTable=targetMetaStore.getTable(dbName,tableName);
    assertEquals("Created table doesn't match the source.",HCatTable.NO_DIFF,targetTable.diff(sourceTable));
    List<HCatFieldSchema> newColumnSchema=new ArrayList<HCatFieldSchema>(columnSchema);
    newColumnSchema.add(new HCatFieldSchema("goo_new",Type.DOUBLE,""));
    Map<String,String> tableParams=new HashMap<String,String>(1);
    tableParams.put("orc.compress","ZLIB");
    sourceTable.cols(newColumnSchema).fileFormat("orcfile").tblProps(tableParams).serdeParam(serdeConstants.FIELD_DELIM,Character.toString('\001'));
    sourceMetaStore.updateTableSchema(dbName,tableName,sourceTable);
    sourceTable=sourceMetaStore.getTable(dbName,tableName);
    Map<String,String> partitionSpec_2=new HashMap<String,String>();
    partitionSpec_2.put("grid","AB");
    partitionSpec_2.put("dt","2012_01_01");
    HCatPartition sourcePartition_2=new HCatPartition(sourceTable,partitionSpec_2,makePartLocation(sourceTable,partitionSpec_2));
    sourceMetaStore.addPartition(HCatAddPartitionDesc.create(sourcePartition_2).build());
    HCatPartitionSpec sourcePartitionSpec=sourceMetaStore.getPartitionSpecs(dbName,tableName,-1);
    assertEquals("Unexpected number of source partitions.",2,sourcePartitionSpec.size());
    List<String> partitionSpecString=sourceMetaStore.serializePartitionSpec(sourcePartitionSpec);
    HCatPartitionSpec targetPartitionSpec=targetMetaStore.deserializePartitionSpec(partitionSpecString);
    assertEquals("Could not add the expected number of partitions.",sourcePartitionSpec.size(),targetMetaStore.addPartitionSpec(targetPartitionSpec));
    targetPartitionSpec=targetMetaStore.getPartitionSpecs(dbName,tableName,-1);
    assertEquals("Could not retrieve the expected number of partitions.",sourcePartitionSpec.size(),targetPartitionSpec.size());
    HCatPartitionSpec.HCatPartitionIterator sourceIterator=sourcePartitionSpec.getPartitionIterator();
    HCatPartitionSpec.HCatPartitionIterator targetIterator=targetPartitionSpec.getPartitionIterator();
    while (targetIterator.hasNext()) {
      assertTrue("Fewer target partitions than source.",sourceIterator.hasNext());
      HCatPartition sourcePartition=sourceIterator.next();
      HCatPartition targetPartition=targetIterator.next();
      assertEquals("Column schema doesn't match.",sourcePartition.getColumns(),targetPartition.getColumns());
      assertEquals("InputFormat doesn't match.",sourcePartition.getInputFormat(),targetPartition.getInputFormat());
      assertEquals("OutputFormat doesn't match.",sourcePartition.getOutputFormat(),targetPartition.getOutputFormat());
      assertEquals("SerDe doesn't match.",sourcePartition.getSerDe(),targetPartition.getSerDe());
      assertEquals("SerDe params don't match.",sourcePartition.getSerdeParams(),targetPartition.getSerdeParams());
    }
  }
 catch (  Exception unexpected) {
    LOG.error("Unexpected exception! ",unexpected);
    assertTrue("Unexpected exception! " + unexpected.getMessage(),false);
  }
}

</code></pre>

<pre class="type-11 type-6 type-4 type-5 type-7 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that partition-definitions can be replicated between HCat-instances,
 * independently of table-metadata replication.
 * 2 identical tables are created on 2 different HCat instances ("source" and "target").
 * On the source instance,
 * 1. One partition is added with the old format ("TEXTFILE").
 * 2. The table is updated with an additional column and the data-format changed to ORC.
 * 3. Another partition is added with the new format.
 * 4. The partitions' metadata is copied to the target HCat instance, without updating the target table definition.
 * 5. The partitions' metadata is tested to be an exact replica of that on the source.
 * @throws Exception
 */
@Test public void testPartitionRegistrationWithCustomSchema() throws Exception {
  try {
    startReplicationTargetMetaStoreIfRequired();
    HCatClient sourceMetaStore=HCatClient.create(new Configuration(hcatConf));
    final String dbName="myDb";
    final String tableName="myTable";
    sourceMetaStore.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    sourceMetaStore.createDatabase(HCatCreateDBDesc.create(dbName).build());
    List<HCatFieldSchema> columnSchema=new ArrayList<HCatFieldSchema>(Arrays.asList(new HCatFieldSchema("foo",Type.INT,""),new HCatFieldSchema("bar",Type.STRING,"")));
    List<HCatFieldSchema> partitionSchema=Arrays.asList(new HCatFieldSchema("dt",Type.STRING,""),new HCatFieldSchema("grid",Type.STRING,""));
    HCatTable sourceTable=new HCatTable(dbName,tableName).cols(columnSchema).partCols(partitionSchema).comment("Source table.");
    sourceMetaStore.createTable(HCatCreateTableDesc.create(sourceTable).build());
    sourceTable=sourceMetaStore.getTable(dbName,tableName);
    assertNotNull("Table couldn't be queried for. ",sourceTable);
    Map<String,String> partitionSpec_1=new HashMap<String,String>();
    partitionSpec_1.put("grid","AB");
    partitionSpec_1.put("dt","2011_12_31");
    HCatPartition sourcePartition_1=new HCatPartition(sourceTable,partitionSpec_1,makePartLocation(sourceTable,partitionSpec_1));
    sourceMetaStore.addPartition(HCatAddPartitionDesc.create(sourcePartition_1).build());
    assertEquals("Unexpected number of partitions. ",1,sourceMetaStore.getPartitions(dbName,tableName).size());
    HCatPartition addedPartition_1=sourceMetaStore.getPartition(dbName,tableName,partitionSpec_1);
    assertEquals("Column schema doesn't match.",sourceTable.getCols(),addedPartition_1.getColumns());
    assertEquals("InputFormat doesn't match.",sourceTable.getInputFileFormat(),addedPartition_1.getInputFormat());
    assertEquals("OutputFormat doesn't match.",sourceTable.getOutputFileFormat(),addedPartition_1.getOutputFormat());
    assertEquals("SerDe doesn't match.",sourceTable.getSerdeLib(),addedPartition_1.getSerDe());
    assertEquals("SerDe params don't match.",sourceTable.getSerdeParams(),addedPartition_1.getSerdeParams());
    HCatClient targetMetaStore=HCatClient.create(new Configuration(replicationTargetHCatConf));
    targetMetaStore.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    targetMetaStore.createDatabase(HCatCreateDBDesc.create(dbName).build());
    HCatTable targetTable=targetMetaStore.deserializeTable(sourceMetaStore.serializeTable(sourceTable));
    targetMetaStore.createTable(HCatCreateTableDesc.create(targetTable).build());
    targetTable=targetMetaStore.getTable(dbName,tableName);
    assertEquals("Created table doesn't match the source.",HCatTable.NO_DIFF,targetTable.diff(sourceTable));
    List<HCatFieldSchema> newColumnSchema=new ArrayList<HCatFieldSchema>(columnSchema);
    newColumnSchema.add(new HCatFieldSchema("goo_new",Type.DOUBLE,""));
    Map<String,String> tableParams=new HashMap<String,String>(1);
    tableParams.put("orc.compress","ZLIB");
    sourceTable.cols(newColumnSchema).fileFormat("orcfile").tblProps(tableParams).serdeParam(serdeConstants.FIELD_DELIM,Character.toString('\001'));
    sourceMetaStore.updateTableSchema(dbName,tableName,sourceTable);
    sourceTable=sourceMetaStore.getTable(dbName,tableName);
    Map<String,String> partitionSpec_2=new HashMap<String,String>();
    partitionSpec_2.put("grid","AB");
    partitionSpec_2.put("dt","2012_01_01");
    HCatPartition sourcePartition_2=new HCatPartition(sourceTable,partitionSpec_2,makePartLocation(sourceTable,partitionSpec_2));
    sourceMetaStore.addPartition(HCatAddPartitionDesc.create(sourcePartition_2).build());
    List<HCatPartition> sourcePartitions=sourceMetaStore.getPartitions(dbName,tableName);
    assertEquals("Unexpected number of source partitions.",2,sourcePartitions.size());
    List<HCatAddPartitionDesc> addPartitionDescs=new ArrayList<HCatAddPartitionDesc>(sourcePartitions.size());
    for (    HCatPartition partition : sourcePartitions) {
      addPartitionDescs.add(HCatAddPartitionDesc.create(partition).build());
    }
    targetMetaStore.addPartitions(addPartitionDescs);
    List<HCatPartition> targetPartitions=targetMetaStore.getPartitions(dbName,tableName);
    assertEquals("Expected the same number of partitions. ",sourcePartitions.size(),targetPartitions.size());
    for (int i=0; i < targetPartitions.size(); ++i) {
      HCatPartition sourcePartition=sourcePartitions.get(i), targetPartition=targetPartitions.get(i);
      assertEquals("Column schema doesn't match.",sourcePartition.getColumns(),targetPartition.getColumns());
      assertEquals("InputFormat doesn't match.",sourcePartition.getInputFormat(),targetPartition.getInputFormat());
      assertEquals("OutputFormat doesn't match.",sourcePartition.getOutputFormat(),targetPartition.getOutputFormat());
      assertEquals("SerDe doesn't match.",sourcePartition.getSerDe(),targetPartition.getSerDe());
      assertEquals("SerDe params don't match.",sourcePartition.getSerdeParams(),targetPartition.getSerdeParams());
    }
  }
 catch (  Exception unexpected) {
    LOG.error("Unexpected exception! ",unexpected);
    assertTrue("Unexpected exception! " + unexpected.getMessage(),false);
  }
}

</code></pre>

<pre class="type-4 type-5 type-7 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetPartitionsWithPartialSpec() throws Exception {
  try {
    HCatClient client=HCatClient.create(new Configuration(hcatConf));
    final String dbName="myDb";
    final String tableName="myTable";
    client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    client.createDatabase(HCatCreateDBDesc.create(dbName).build());
    List<HCatFieldSchema> columnSchema=Arrays.asList(new HCatFieldSchema("foo",Type.INT,""),new HCatFieldSchema("bar",Type.STRING,""));
    List<HCatFieldSchema> partitionSchema=Arrays.asList(new HCatFieldSchema("dt",Type.STRING,""),new HCatFieldSchema("grid",Type.STRING,""));
    HCatTable table=new HCatTable(dbName,tableName).cols(columnSchema).partCols(partitionSchema);
    client.createTable(HCatCreateTableDesc.create(table,false).build());
    table=client.getTable(dbName,tableName);
    assertNotNull("The created just now can't be null.",table);
    Map<String,String> partitionSpec=new HashMap<String,String>();
    partitionSpec.put("grid","AB");
    partitionSpec.put("dt","2011_12_31");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    partitionSpec.put("grid","AB");
    partitionSpec.put("dt","2012_01_01");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    partitionSpec.put("dt","2012_01_01");
    partitionSpec.put("grid","OB");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    partitionSpec.put("dt","2012_01_01");
    partitionSpec.put("grid","XB");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    Map<String,String> partialPartitionSpec=new HashMap<String,String>();
    partialPartitionSpec.put("dt","2012_01_01");
    List<HCatPartition> partitions=client.getPartitions(dbName,tableName,partialPartitionSpec);
    assertEquals("Unexpected number of partitions.",3,partitions.size());
    assertArrayEquals("Mismatched partition.",new String[]{"2012_01_01","AB"},partitions.get(0).getValues().toArray());
    assertArrayEquals("Mismatched partition.",new String[]{"2012_01_01","OB"},partitions.get(1).getValues().toArray());
    assertArrayEquals("Mismatched partition.",new String[]{"2012_01_01","XB"},partitions.get(2).getValues().toArray());
    client.dropDatabase(dbName,false,HCatClient.DropDBMode.CASCADE);
  }
 catch (  Exception unexpected) {
    LOG.error("Unexpected exception!",unexpected);
    assertTrue("Unexpected exception! " + unexpected.getMessage(),false);
  }
}

</code></pre>

<pre class="type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testObjectNotFoundException() throws Exception {
  try {
    HCatClient client=HCatClient.create(new Configuration(hcatConf));
    String dbName="testObjectNotFoundException_DBName";
    String tableName="testObjectNotFoundException_TableName";
    client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    try {
      client.getDatabase(dbName);
      assertTrue("Expected ObjectNotFoundException.",false);
    }
 catch (    Exception exception) {
      LOG.info("Got exception: ",exception);
      assertTrue("Expected ObjectNotFoundException. Got:" + exception.getClass(),exception instanceof ObjectNotFoundException);
    }
    client.createDatabase(HCatCreateDBDesc.create(dbName).build());
    try {
      client.getTable(dbName,tableName);
      assertTrue("Expected ObjectNotFoundException.",false);
    }
 catch (    Exception exception) {
      LOG.info("Got exception: ",exception);
      assertTrue("Expected ObjectNotFoundException. Got:" + exception.getClass(),exception instanceof ObjectNotFoundException);
    }
    String partitionColumn="part";
    List<HCatFieldSchema> columns=Arrays.asList(new HCatFieldSchema("col",Type.STRING,""));
    ArrayList<HCatFieldSchema> partitionColumns=new ArrayList<HCatFieldSchema>(Arrays.asList(new HCatFieldSchema(partitionColumn,Type.STRING,"")));
    HCatTable table=new HCatTable(dbName,tableName).cols(columns).partCols(partitionColumns);
    client.createTable(HCatCreateTableDesc.create(table,false).build());
    HCatTable createdTable=client.getTable(dbName,tableName);
    Map<String,String> partitionSpec=new HashMap<String,String>();
    partitionSpec.put(partitionColumn,"foobar");
    try {
      client.getPartition(dbName,tableName,partitionSpec);
      assertTrue("Expected ObjectNotFoundException.",false);
    }
 catch (    Exception exception) {
      LOG.info("Got exception: ",exception);
      assertTrue("Expected ObjectNotFoundException. Got:" + exception.getClass(),exception instanceof ObjectNotFoundException);
    }
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(createdTable,partitionSpec,makePartLocation(createdTable,partitionSpec))).build());
    assertEquals("Expected empty set of partitions.",0,client.listPartitionsByFilter(dbName,tableName,partitionColumn + " < 'foobar'").size());
    try {
      partitionSpec.put("NonExistentKey","foobar");
      client.getPartition(dbName,tableName,partitionSpec);
      assertTrue("Expected HCatException.",false);
    }
 catch (    Exception exception) {
      LOG.info("Got exception: ",exception);
      assertTrue("Expected HCatException. Got:" + exception.getClass(),exception instanceof HCatException);
      assertFalse("Did not expect ObjectNotFoundException.",exception instanceof ObjectNotFoundException);
    }
  }
 catch (  Throwable t) {
    LOG.error("Unexpected exception!",t);
    assertTrue("Unexpected exception! " + t.getMessage(),false);
  }
}

</code></pre>

<pre class="type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testDatabaseLocation() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  String dbName="locationDB";
  client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
  HCatCreateDBDesc dbDesc=HCatCreateDBDesc.create(dbName).ifNotExists(true).location("/tmp/" + dbName).build();
  client.createDatabase(dbDesc);
  HCatDatabase newDB=client.getDatabase(dbName);
  assertTrue(newDB.getLocation().matches(".*/tmp/" + dbName));
  client.close();
}

</code></pre>

<pre class="type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTransportFailure() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  boolean isExceptionCaught=false;
  final String tableName="Temptable" + new BigInteger(200,new Random()).toString(2);
  ArrayList<HCatFieldSchema> cols=new ArrayList<HCatFieldSchema>();
  cols.add(new HCatFieldSchema("id",Type.INT,"id columns"));
  cols.add(new HCatFieldSchema("value",Type.STRING,"id columns"));
  try {
    HCatCreateTableDesc tableDesc=HCatCreateTableDesc.create(null,tableName,cols).fileFormat("rcfile").build();
    client.createTable(tableDesc);
  }
 catch (  Exception exp) {
    isExceptionCaught=true;
    assertEquals("Unexpected exception type.",HCatException.class,exp.getClass());
    client=HCatClient.create(new Configuration(hcatConf));
    String newName="goodTable";
    client.dropTable(null,newName,true);
    HCatCreateTableDesc tableDesc2=HCatCreateTableDesc.create(null,newName,cols).fileFormat("rcfile").build();
    client.createTable(tableDesc2);
    HCatTable newTable=client.getTable(null,newName);
    assertTrue(newTable != null);
    assertTrue(newTable.getTableName().equalsIgnoreCase(newName));
  }
 finally {
    client.close();
    assertTrue("The expected exception was never thrown.",isExceptionCaught);
  }
}

</code></pre>

<pre class="type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testOtherFailure() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  String tableName="Temptable";
  boolean isExceptionCaught=false;
  client.dropTable(null,tableName,true);
  ArrayList<HCatFieldSchema> cols=new ArrayList<HCatFieldSchema>();
  cols.add(new HCatFieldSchema("id",Type.INT,"id columns"));
  cols.add(new HCatFieldSchema("value",Type.STRING,"id columns"));
  try {
    HCatCreateTableDesc tableDesc=HCatCreateTableDesc.create(null,tableName,cols).fileFormat("rcfile").build();
    client.createTable(tableDesc);
    client.getTable("foo",tableName);
  }
 catch (  Exception exp) {
    isExceptionCaught=true;
    assertTrue(exp instanceof HCatException);
    String newName="goodTable";
    client.dropTable(null,newName,true);
    HCatCreateTableDesc tableDesc2=HCatCreateTableDesc.create(null,newName,cols).fileFormat("rcfile").build();
    client.createTable(tableDesc2);
    HCatTable newTable=client.getTable(null,newName);
    assertTrue(newTable != null);
    assertTrue(newTable.getTableName().equalsIgnoreCase(newName));
  }
 finally {
    client.close();
    assertTrue("The expected exception was never thrown.",isExceptionCaught);
  }
}

</code></pre>

<pre class="type-11 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test for event-based replication scenario
 * Does not test if replication actually happened, merely tests if we're able to consume a repl task
 * iter appropriately, calling all the functions expected of the interface, without errors.
 */
@Test public void testReplicationTaskIter() throws Exception {
  Configuration cfg=new Configuration(hcatConf);
  cfg.set(HiveConf.ConfVars.METASTORE_BATCH_RETRIEVE_MAX.varname,"10");
  cfg.set(HiveConf.ConfVars.HIVE_REPL_TASK_FACTORY.varname,EximReplicationTaskFactory.class.getName());
  HCatClient sourceMetastore=HCatClient.create(cfg);
  String dbName="testReplicationTaskIter";
  long baseId=sourceMetastore.getCurrentNotificationEventId();
{
    sourceMetastore.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    sourceMetastore.createDatabase(HCatCreateDBDesc.create(dbName).ifNotExists(false).build());
    String tblName1="T1";
    List<HCatFieldSchema> cols1=HCatSchemaUtils.getHCatSchema("a:int,b:string").getFields();
    HCatTable table1=(new HCatTable(dbName,tblName1)).cols(cols1);
    sourceMetastore.createTable(HCatCreateTableDesc.create(table1).build());
    String tblName2="T2";
    List<HCatFieldSchema> cols2=HCatSchemaUtils.getHCatSchema("a:int").getFields();
    List<HCatFieldSchema> pcols2=HCatSchemaUtils.getHCatSchema("b:string").getFields();
    HCatTable table2=(new HCatTable(dbName,tblName2)).cols(cols2).partCols(pcols2);
    sourceMetastore.createTable(HCatCreateTableDesc.create(table2).build());
    HCatTable table2Created=sourceMetastore.getTable(dbName,tblName2);
    Map<String,String> ptnDesc1=new HashMap<String,String>();
    ptnDesc1.put("b","test1");
    HCatPartition ptn1=(new HCatPartition(table2Created,ptnDesc1,makePartLocation(table2Created,ptnDesc1)));
    sourceMetastore.addPartition(HCatAddPartitionDesc.create(ptn1).build());
    for (int i=0; i < 20; i++) {
      Map<String,String> ptnDesc=new HashMap<String,String>();
      ptnDesc.put("b","testmul" + i);
      HCatPartition ptn=(new HCatPartition(table2Created,ptnDesc,makePartLocation(table2Created,ptnDesc)));
      sourceMetastore.addPartition(HCatAddPartitionDesc.create(ptn).build());
      sourceMetastore.dropPartitions(dbName,tblName2,ptnDesc,true);
    }
    sourceMetastore.dropTable(dbName,tblName1,true);
    sourceMetastore.dropTable(dbName,tblName2,true);
    long currId=sourceMetastore.getCurrentNotificationEventId();
    assertTrue("currId[" + currId + "] must be more than 25 greater than baseId["+ baseId+ "]",currId > baseId + 25);
  }
  List<HCatNotificationEvent> notifs=sourceMetastore.getNextNotification(0,0,new IMetaStoreClient.NotificationFilter(){
    @Override public boolean accept(    NotificationEvent event){
      return true;
    }
  }
);
  for (  HCatNotificationEvent n : notifs) {
    LOG.info("notif from dblistener:" + n.getEventId() + ":"+ n.getEventTime()+ ",t:"+ n.getEventType()+ ",o:"+ n.getDbName()+ "."+ n.getTableName());
  }
  Iterator<ReplicationTask> taskIter=sourceMetastore.getReplicationTasks(0,-1,dbName,null);
  while (taskIter.hasNext()) {
    ReplicationTask task=taskIter.next();
    HCatNotificationEvent n=task.getEvent();
    LOG.info("notif from tasks:" + n.getEventId() + ":"+ n.getEventTime()+ ",t:"+ n.getEventType()+ ",o:"+ n.getDbName()+ "."+ n.getTableName()+ ",s:"+ n.getEventScope());
    LOG.info("task :" + task.getClass().getName());
    if (task.needsStagingDirs()) {
      StagingDirectoryProvider provider=new StagingDirectoryProvider(){
        @Override public String getStagingDirectory(        String key){
          LOG.info("getStagingDirectory(" + key + ") called!");
          return "/tmp/" + key.replaceAll(" ","_");
        }
      }
;
      task.withSrcStagingDirProvider(provider).withDstStagingDirProvider(provider);
    }
    if (task.isActionable()) {
      LOG.info("task was actionable!");
      Function<Command,String> commandDebugPrinter=new Function<Command,String>(){
        @Override public String apply(        @Nullable Command cmd){
          StringBuilder sb=new StringBuilder();
          String serializedCmd=null;
          try {
            serializedCmd=ReplicationUtils.serializeCommand(cmd);
          }
 catch (          IOException e) {
            e.printStackTrace();
            throw new RuntimeException(e);
          }
          sb.append("SERIALIZED:" + serializedCmd + "\n");
          Command command=null;
          try {
            command=ReplicationUtils.deserializeCommand(serializedCmd);
          }
 catch (          IOException e) {
            e.printStackTrace();
            throw new RuntimeException(e);
          }
          sb.append("CMD:[" + command.getClass().getName() + "]\n");
          sb.append("EVENTID:[" + command.getEventId() + "]\n");
          for (          String s : command.get()) {
            sb.append("CMD:" + s);
            sb.append("\n");
          }
          sb.append("Retriable:" + command.isRetriable() + "\n");
          sb.append("Undoable:" + command.isUndoable() + "\n");
          if (command.isUndoable()) {
            for (            String s : command.getUndo()) {
              sb.append("UNDO:" + s);
              sb.append("\n");
            }
          }
          List<String> locns=command.cleanupLocationsPerRetry();
          sb.append("cleanupLocationsPerRetry entries :" + locns.size());
          for (          String s : locns) {
            sb.append("RETRY_CLEANUP:" + s);
            sb.append("\n");
          }
          locns=command.cleanupLocationsAfterEvent();
          sb.append("cleanupLocationsAfterEvent entries :" + locns.size());
          for (          String s : locns) {
            sb.append("AFTER_EVENT_CLEANUP:" + s);
            sb.append("\n");
          }
          return sb.toString();
        }
      }
;
      LOG.info("On src:");
      for (      String s : Iterables.transform(task.getSrcWhCommands(),commandDebugPrinter)) {
        LOG.info(s);
      }
      LOG.info("On dest:");
      for (      String s : Iterables.transform(task.getDstWhCommands(),commandDebugPrinter)) {
        LOG.info(s);
      }
    }
 else {
      LOG.info("task was not actionable.");
    }
  }
}

</code></pre>

<pre class="type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRenameTable() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  String tableName="temptable";
  String newName="mytable";
  client.dropTable(null,tableName,true);
  client.dropTable(null,newName,true);
  ArrayList<HCatFieldSchema> cols=new ArrayList<HCatFieldSchema>();
  cols.add(new HCatFieldSchema("id",Type.INT,"id columns"));
  cols.add(new HCatFieldSchema("value",Type.STRING,"id columns"));
  HCatCreateTableDesc tableDesc=HCatCreateTableDesc.create(null,tableName,cols).fileFormat("rcfile").build();
  client.createTable(tableDesc);
  client.renameTable(null,tableName,newName);
  try {
    client.getTable(null,tableName);
  }
 catch (  HCatException exp) {
    assertTrue("Unexpected exception message: " + exp.getMessage(),exp.getMessage().contains("NoSuchObjectException while fetching table"));
  }
  HCatTable newTable=client.getTable(null,newName);
  assertTrue(newTable != null);
  assertTrue(newTable.getTableName().equals(newName));
  client.close();
}

</code></pre>

<pre class="type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetMessageBusTopicName() throws Exception {
  try {
    HCatClient client=HCatClient.create(new Configuration(hcatConf));
    String dbName="testGetMessageBusTopicName_DBName";
    String tableName="testGetMessageBusTopicName_TableName";
    client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    client.createDatabase(HCatCreateDBDesc.create(dbName).build());
    String messageBusTopicName="MY.topic.name";
    Map<String,String> tableProperties=new HashMap<String,String>(1);
    tableProperties.put(HCatConstants.HCAT_MSGBUS_TOPIC_NAME,messageBusTopicName);
    client.createTable(HCatCreateTableDesc.create(dbName,tableName,Arrays.asList(new HCatFieldSchema("foo",Type.STRING,""))).tblProps(tableProperties).build());
    assertEquals("MessageBus topic-name doesn't match!",messageBusTopicName,client.getMessageBusTopicName(dbName,tableName));
    client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    client.close();
  }
 catch (  Exception exception) {
    LOG.error("Unexpected exception.",exception);
    assertTrue("Unexpected exception:" + exception.getMessage(),false);
  }
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDropTableException() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  String tableName="tableToBeDropped";
  boolean isExceptionCaught=false;
  client.dropTable(null,tableName,true);
  try {
    client.dropTable(null,tableName,false);
  }
 catch (  Exception exp) {
    isExceptionCaught=true;
    assertTrue(exp instanceof HCatException);
    LOG.info("Drop Table Exception: " + exp.getCause());
  }
 finally {
    client.close();
    assertTrue("The expected exception was never thrown.",isExceptionCaught);
  }
}

</code></pre>

<pre class="type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testPartitionsHCatClientImpl() throws Exception {
  HCatClient client=HCatClient.create(new Configuration(hcatConf));
  String dbName="ptnDB";
  String tableName="pageView";
  client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
  HCatCreateDBDesc dbDesc=HCatCreateDBDesc.create(dbName).ifNotExists(true).build();
  client.createDatabase(dbDesc);
  ArrayList<HCatFieldSchema> cols=new ArrayList<HCatFieldSchema>();
  cols.add(new HCatFieldSchema("userid",Type.INT,"id columns"));
  cols.add(new HCatFieldSchema("viewtime",Type.BIGINT,"view time columns"));
  cols.add(new HCatFieldSchema("pageurl",Type.STRING,""));
  cols.add(new HCatFieldSchema("ip",Type.STRING,"IP Address of the User"));
  ArrayList<HCatFieldSchema> ptnCols=new ArrayList<HCatFieldSchema>();
  ptnCols.add(new HCatFieldSchema("dt",Type.STRING,"date column"));
  ptnCols.add(new HCatFieldSchema("country",Type.STRING,"country column"));
  HCatTable table=new HCatTable(dbName,tableName).cols(cols).partCols(ptnCols).fileFormat("sequenceFile");
  HCatCreateTableDesc tableDesc=HCatCreateTableDesc.create(table,false).build();
  client.createTable(tableDesc);
  table=client.getTable(dbName,tableName);
  Map<String,String> firstPtn=new HashMap<String,String>();
  firstPtn.put("dt","04/30/2012");
  firstPtn.put("country","usa");
  HCatAddPartitionDesc addPtn=HCatAddPartitionDesc.create(new HCatPartition(table,firstPtn,null)).build();
  client.addPartition(addPtn);
  Map<String,String> secondPtn=new HashMap<String,String>();
  secondPtn.put("dt","04/12/2012");
  secondPtn.put("country","brazil");
  HCatAddPartitionDesc addPtn2=HCatAddPartitionDesc.create(dbName,tableName,null,secondPtn).build();
  client.addPartition(addPtn2);
  Map<String,String> thirdPtn=new HashMap<String,String>();
  thirdPtn.put("dt","04/13/2012");
  thirdPtn.put("country","argentina");
  HCatAddPartitionDesc addPtn3=HCatAddPartitionDesc.create(dbName,tableName,null,thirdPtn).build();
  client.addPartition(addPtn3);
  List<HCatPartition> ptnList=client.listPartitionsByFilter(dbName,tableName,null);
  assertTrue(ptnList.size() == 3);
  HCatPartition ptn=client.getPartition(dbName,tableName,firstPtn);
  assertTrue(ptn != null);
  client.dropPartitions(dbName,tableName,firstPtn,true);
  ptnList=client.listPartitionsByFilter(dbName,tableName,null);
  assertTrue(ptnList.size() == 2);
  List<HCatPartition> ptnListTwo=client.listPartitionsByFilter(dbName,tableName,"country = \"argentina\"");
  assertTrue(ptnListTwo.size() == 1);
  client.markPartitionForEvent(dbName,tableName,thirdPtn,PartitionEventType.LOAD_DONE);
  boolean isMarked=client.isPartitionMarkedForEvent(dbName,tableName,thirdPtn,PartitionEventType.LOAD_DONE);
  assertTrue(isMarked);
  client.close();
}

</code></pre>

<pre class="type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateTableSchema() throws Exception {
  try {
    HCatClient client=HCatClient.create(new Configuration(hcatConf));
    final String dbName="testUpdateTableSchema_DBName";
    final String tableName="testUpdateTableSchema_TableName";
    client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    client.createDatabase(HCatCreateDBDesc.create(dbName).build());
    List<HCatFieldSchema> oldSchema=Arrays.asList(new HCatFieldSchema("foo",Type.INT,""),new HCatFieldSchema("bar",Type.STRING,""));
    client.createTable(HCatCreateTableDesc.create(dbName,tableName,oldSchema).build());
    List<HCatFieldSchema> newSchema=Arrays.asList(new HCatFieldSchema("completely",Type.DOUBLE,""),new HCatFieldSchema("new",Type.STRING,""),new HCatFieldSchema("fields",Type.STRING,""));
    client.updateTableSchema(dbName,tableName,newSchema);
    assertArrayEquals(newSchema.toArray(),client.getTable(dbName,tableName).getCols().toArray());
    client.dropDatabase(dbName,false,HCatClient.DropDBMode.CASCADE);
  }
 catch (  Exception exception) {
    LOG.error("Unexpected exception.",exception);
    assertTrue("Unexpected exception: " + exception.getMessage(),false);
  }
}

</code></pre>

<pre class="type-4 type-5 type-7 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for detecting schema-changes for an HCatalog table, across 2 different HCat instances.
 * A table is created with the same schema on 2 HCat instances. The table-schema is modified on the source HCat
 * instance (columns, I/O formats, SerDe definitions, etc.). The table metadata is compared between source
 * and target, the changes are detected and propagated to target.
 * @throws Exception
 */
@Test public void testTableSchemaPropagation() throws Exception {
  try {
    startReplicationTargetMetaStoreIfRequired();
    HCatClient sourceMetaStore=HCatClient.create(new Configuration(hcatConf));
    final String dbName="myDb";
    final String tableName="myTable";
    sourceMetaStore.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    sourceMetaStore.createDatabase(HCatCreateDBDesc.create(dbName).build());
    List<HCatFieldSchema> columnSchema=Arrays.asList(new HCatFieldSchema("foo",Type.INT,""),new HCatFieldSchema("bar",Type.STRING,""));
    List<HCatFieldSchema> partitionSchema=Arrays.asList(new HCatFieldSchema("dt",Type.STRING,""),new HCatFieldSchema("grid",Type.STRING,""));
    HCatTable sourceTable=new HCatTable(dbName,tableName).cols(columnSchema).partCols(partitionSchema);
    sourceMetaStore.createTable(HCatCreateTableDesc.create(sourceTable).build());
    sourceTable=sourceMetaStore.getTable(dbName,tableName);
    assertNotNull("Table couldn't be queried for. ",sourceTable);
    String tableStringRep=sourceMetaStore.serializeTable(sourceTable);
    HCatClient targetMetaStore=HCatClient.create(new Configuration(replicationTargetHCatConf));
    targetMetaStore.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    targetMetaStore.createDatabase(HCatCreateDBDesc.create(dbName).build());
    HCatTable targetTable=targetMetaStore.deserializeTable(tableStringRep);
    assertEquals("Table after deserialization should have been identical to sourceTable.",HCatTable.NO_DIFF,sourceTable.diff(targetTable));
    targetMetaStore.createTable(HCatCreateTableDesc.create(targetTable).build());
    targetTable=targetMetaStore.getTable(dbName,tableName);
    assertEquals("Table after deserialization should have been identical to sourceTable.",HCatTable.NO_DIFF,sourceTable.diff(targetTable));
    List<HCatFieldSchema> newColumnSchema=new ArrayList<HCatFieldSchema>(columnSchema);
    newColumnSchema.add(new HCatFieldSchema("goo_new",Type.DOUBLE,""));
    Map<String,String> tableParams=new HashMap<String,String>(1);
    tableParams.put("orc.compress","ZLIB");
    sourceTable.cols(newColumnSchema).fileFormat("orcfile").tblProps(tableParams).serdeParam(serdeConstants.FIELD_DELIM,Character.toString('\001'));
    sourceMetaStore.updateTableSchema(dbName,tableName,sourceTable);
    sourceTable=sourceMetaStore.getTable(dbName,tableName);
    EnumSet<HCatTable.TableAttribute> diff=targetTable.diff(sourceTable);
    assertTrue("Couldn't find change in column-schema.",diff.contains(HCatTable.TableAttribute.COLUMNS));
    assertTrue("Couldn't find change in InputFormat.",diff.contains(HCatTable.TableAttribute.INPUT_FORMAT));
    assertTrue("Couldn't find change in OutputFormat.",diff.contains(HCatTable.TableAttribute.OUTPUT_FORMAT));
    assertTrue("Couldn't find change in SerDe.",diff.contains(HCatTable.TableAttribute.SERDE));
    assertTrue("Couldn't find change in SerDe parameters.",diff.contains(HCatTable.TableAttribute.SERDE_PROPERTIES));
    assertTrue("Couldn't find change in Table parameters.",diff.contains(HCatTable.TableAttribute.TABLE_PROPERTIES));
    targetMetaStore.updateTableSchema(dbName,tableName,targetTable.resolve(sourceTable,diff));
    targetTable=targetMetaStore.getTable(dbName,tableName);
    assertEquals("After propagating schema changes, source and target tables should have been equivalent.",HCatTable.NO_DIFF,targetTable.diff(sourceTable));
  }
 catch (  Exception unexpected) {
    LOG.error("Unexpected exception!",unexpected);
    assertTrue("Unexpected exception! " + unexpected.getMessage(),false);
  }
}

</code></pre>

<pre class="type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void tearDown() throws Exception {
  if (!useExternalMS) {
    LOG.info("Shutting down metastore.");
    System.setSecurityManager(securityManager);
  }
}

</code></pre>

<pre class="type-11 type-4 type-5 type-7 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDropPartitionsWithPartialSpec() throws Exception {
  try {
    HCatClient client=HCatClient.create(new Configuration(hcatConf));
    final String dbName="myDb";
    final String tableName="myTable";
    client.dropDatabase(dbName,true,HCatClient.DropDBMode.CASCADE);
    client.createDatabase(HCatCreateDBDesc.create(dbName).build());
    List<HCatFieldSchema> columnSchema=Arrays.asList(new HCatFieldSchema("foo",Type.INT,""),new HCatFieldSchema("bar",Type.STRING,""));
    List<HCatFieldSchema> partitionSchema=Arrays.asList(new HCatFieldSchema("dt",Type.STRING,""),new HCatFieldSchema("grid",Type.STRING,""));
    HCatTable table=new HCatTable(dbName,tableName).cols(columnSchema).partCols(partitionSchema);
    client.createTable(HCatCreateTableDesc.create(table,false).build());
    table=client.getTable(dbName,tableName);
    assertNotNull("Table couldn't be queried for. ",table);
    Map<String,String> partitionSpec=new HashMap<String,String>();
    partitionSpec.put("grid","AB");
    partitionSpec.put("dt","2011_12_31");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    partitionSpec.put("grid","AB");
    partitionSpec.put("dt","2012_01_01");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    partitionSpec.put("dt","2012_01_01");
    partitionSpec.put("grid","OB");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    partitionSpec.put("dt","2012_01_01");
    partitionSpec.put("grid","XB");
    client.addPartition(HCatAddPartitionDesc.create(new HCatPartition(table,partitionSpec,makePartLocation(table,partitionSpec))).build());
    Map<String,String> partialPartitionSpec=new HashMap<String,String>();
    partialPartitionSpec.put("dt","2012_01_01");
    client.dropPartitions(dbName,tableName,partialPartitionSpec,true);
    List<HCatPartition> partitions=client.getPartitions(dbName,tableName);
    assertEquals("Unexpected number of partitions.",1,partitions.size());
    assertArrayEquals("Mismatched partition.",new String[]{"2011_12_31","AB"},partitions.get(0).getValues().toArray());
    List<HCatFieldSchema> partColumns=partitions.get(0).getPartColumns();
    assertEquals(2,partColumns.size());
    assertEquals("dt",partColumns.get(0).getName());
    assertEquals("grid",partColumns.get(1).getName());
    client.dropDatabase(dbName,false,HCatClient.DropDBMode.CASCADE);
  }
 catch (  Exception unexpected) {
    LOG.error("Unexpected exception!",unexpected);
    assertTrue("Unexpected exception! " + unexpected.getMessage(),false);
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
