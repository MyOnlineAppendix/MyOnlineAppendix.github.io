<h3 style="margin:0px">Class: org.apache.hive.jdbc.TestJdbcWithMiniHS2 (15 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(2)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConnectionSchemaAPIs() throws Exception {
  String db1="DB1";
  HiveConnection hiveConn=(HiveConnection)hs2Conn;
  assertEquals("default",hiveConn.getSchema());
  Statement stmt=hs2Conn.createStatement();
  stmt.execute("DROP DATABASE IF EXISTS " + db1 + " CASCADE");
  stmt.execute("CREATE DATABASE " + db1);
  assertEquals("default",hiveConn.getSchema());
  stmt.execute("USE " + db1);
  assertEquals(db1,hiveConn.getSchema());
  stmt.execute("USE default");
  assertEquals("default",hiveConn.getSchema());
  hiveConn.setSchema(db1);
  assertEquals(db1,hiveConn.getSchema());
  hiveConn.setSchema("default");
  assertEquals("default",hiveConn.getSchema());
  assertTrue(hiveConn.getCatalog().isEmpty());
  hiveConn.setCatalog("foo");
  assertTrue(hiveConn.getCatalog().isEmpty());
}

</code></pre>

<pre class="type-11 type-3 type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConcurrentStatements() throws Exception {
  String tableName="testConcurrentStatements";
  Statement stmt=hs2Conn.createStatement();
  stmt.execute("DROP TABLE IF EXISTS " + tableName);
  stmt.execute("CREATE TABLE " + tableName + " (under_col INT COMMENT 'the under column', value STRING) COMMENT ' test table'");
  stmt.execute("load data local inpath '" + kvDataFilePath.toString() + "' into table "+ tableName);
  ResultSet res=stmt.executeQuery("SELECT * FROM " + tableName);
  assertTrue(res.next());
  res.close();
  stmt.close();
  int POOL_SIZE=100;
  int TASK_COUNT=300;
  SynchronousQueue<Runnable> executorQueue=new SynchronousQueue<Runnable>();
  ExecutorService workers=new ThreadPoolExecutor(1,POOL_SIZE,20,TimeUnit.SECONDS,executorQueue);
  List<Future<Boolean>> list=new ArrayList<Future<Boolean>>();
  int i=0;
  while (i < TASK_COUNT) {
    try {
      Future<Boolean> future=workers.submit(new JDBCTask(hs2Conn,i,tableName));
      list.add(future);
      i++;
    }
 catch (    RejectedExecutionException ree) {
      try {
        TimeUnit.MILLISECONDS.sleep(100);
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
      }
    }
  }
  for (  Future<Boolean> future : list) {
    try {
      Boolean result=future.get(30,TimeUnit.SECONDS);
      assertTrue(result);
    }
 catch (    ExecutionException ee) {
      fail("Concurrent Statement failed: " + ee.getCause());
    }
catch (    TimeoutException te) {
      System.out.println("Task was timeout after 30 second: " + te);
    }
catch (    CancellationException ce) {
      System.out.println("Task was interrupted: " + ce);
    }
catch (    InterruptedException ie) {
      System.out.println("Thread was interrupted: " + ie);
    }
  }
  workers.shutdown();
}

</code></pre>

<pre class="type-3 type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for http header size
 * @throws Exception
 */
@Test public void testHttpHeaderSize() throws Exception {
  if (miniHS2.isStarted()) {
    miniHS2.stop();
  }
  HiveConf conf=new HiveConf();
  conf.set("hive.server2.transport.mode","http");
  conf.setInt("hive.server2.thrift.http.request.header.size",1024);
  conf.setInt("hive.server2.thrift.http.response.header.size",1024);
  miniHS2=new MiniHS2(conf);
  Map<String,String> confOverlay=new HashMap<String,String>();
  miniHS2.start(confOverlay);
  String userName=StringUtils.leftPad("*",100);
  try {
    hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"password");
  }
 catch (  Exception e) {
    fail("Not expecting exception: " + e);
  }
  userName=StringUtils.leftPad("*",2000);
  try {
    hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"password");
  }
 catch (  Exception e) {
    assertTrue("Header exception thrown",e != null);
    assertTrue(e.getMessage().contains("HTTP Response code: 413"));
  }
  if (miniHS2.isStarted()) {
    miniHS2.stop();
  }
  conf.setInt("hive.server2.thrift.http.request.header.size",3000);
  conf.setInt("hive.server2.thrift.http.response.header.size",3000);
  miniHS2=new MiniHS2(conf);
  miniHS2.start(confOverlay);
  try {
    hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"password");
  }
 catch (  Exception e) {
    fail("Not expecting exception: " + e);
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * This method tests whether while creating a new connection, the config
 * variables specified in the JDBC URI are properly set for the connection.
 * This is a test for HiveConnection#configureConnection.
 * @throws Exception
 */
@Test public void testNewConnectionConfiguration() throws Exception {
  String hiveConf="hive.cli.print.header=true;hive.server2.async.exec.shutdown.timeout=20;" + "hive.server2.async.exec.threads=30;hive.server2.thrift.max.worker.threads=15";
  String hiveVar="stab=salesTable;icol=customerID";
  String jdbcUri=miniHS2.getJdbcURL() + "?" + hiveConf+ "#"+ hiveVar;
  Connection con1=DriverManager.getConnection(jdbcUri);
  Statement stmt=con1.createStatement();
  verifyConfProperty(stmt,"hive.cli.print.header","true");
  verifyConfProperty(stmt,"hive.server2.async.exec.shutdown.timeout","20");
  verifyConfProperty(stmt,"hive.server2.async.exec.threads","30");
  verifyConfProperty(stmt,"hive.server2.thrift.max.worker.threads","15");
  verifyConfProperty(stmt,"stab","salesTable");
  verifyConfProperty(stmt,"icol","customerID");
  con1.close();
}

</code></pre>

<pre class="type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void afterTest() throws Exception {
  if (miniHS2.isStarted()) {
    miniHS2.stop();
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests the creation of the 3 scratch dirs: hdfs, local, downloaded resources (which is also local).
 * 1. Test with doAs=false: open a new JDBC session and verify the presence of directories/permissions
 * 2. Test with doAs=true: open a new JDBC session and verify the presence of directories/permissions
 * @throws Exception
 */
@Test public void testSessionScratchDirs() throws Exception {
  if (miniHS2.isStarted()) {
    miniHS2.stop();
  }
  HiveConf conf=new HiveConf();
  String userName;
  Path scratchDirPath;
  conf.setBoolean("hive.server2.enable.doAs",false);
  conf.set("hive.exec.scratchdir",tmpDir + "/hs2");
  String fsPermissionStr="700";
  conf.set("hive.scratch.dir.permission",fsPermissionStr);
  miniHS2=new MiniHS2(conf);
  Map<String,String> confOverlay=new HashMap<String,String>();
  miniHS2.start(confOverlay);
  userName=System.getProperty("user.name");
  hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"password");
  FileSystem fs=miniHS2.getLocalFS();
  FsPermission expectedFSPermission=new FsPermission(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIRPERMISSION));
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR) + "/" + userName);
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,false);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.LOCALSCRATCHDIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,true);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.DOWNLOADED_RESOURCES_DIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,true);
  if (miniHS2.isStarted()) {
    miniHS2.stop();
  }
  conf.setBoolean("hive.server2.enable.doAs",true);
  miniHS2=new MiniHS2(conf);
  miniHS2.start(confOverlay);
  userName="neo";
  hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"the-one");
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR) + "/" + userName);
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,false);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.LOCALSCRATCHDIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,true);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.DOWNLOADED_RESOURCES_DIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,true);
  userName="trinity";
  hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"the-one");
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR) + "/" + userName);
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,false);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.LOCALSCRATCHDIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,true);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.DOWNLOADED_RESOURCES_DIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,true);
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test UDF blacklist overrides whitelist
 * @throws Exception
 */
@Test public void testUdfBlackListOverride() throws Exception {
  HiveConf testConf=new HiveConf();
  Set<String> funcNames=FunctionRegistry.getFunctionNames();
  String funcNameStr="";
  for (  String funcName : funcNames) {
    funcNameStr+="," + funcName;
  }
  funcNameStr=funcNameStr.substring(1);
  testConf.setVar(ConfVars.HIVE_SERVER2_BUILTIN_UDF_WHITELIST,funcNameStr);
  testConf.setVar(ConfVars.HIVE_SERVER2_BUILTIN_UDF_BLACKLIST,"reflect");
  miniHS2=new MiniHS2(testConf);
  miniHS2.start(new HashMap<String,String>());
  hs2Conn=getConnection(miniHS2.getJdbcURL(),System.getProperty("user.name"),"bar");
  Statement stmt=hs2Conn.createStatement();
  try {
    stmt.executeQuery("SELECT reflect('java.lang.String', 'valueOf', 1) ");
    fail("reflect() udf invocation should fail");
  }
 catch (  SQLException e) {
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests the creation of the root hdfs scratch dir, which should be writable by all.
 * @throws Exception
 */
@Test public void testRootScratchDir() throws Exception {
  if (miniHS2.isStarted()) {
    miniHS2.stop();
  }
  HiveConf conf=new HiveConf();
  String userName;
  Path scratchDirPath;
  conf.set("hive.exec.scratchdir",tmpDir + "/hs2");
  miniHS2=new MiniHS2(conf);
  Map<String,String> confOverlay=new HashMap<String,String>();
  miniHS2.start(confOverlay);
  userName=System.getProperty("user.name");
  hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"password");
  FileSystem fs=miniHS2.getLocalFS();
  FsPermission expectedFSPermission=new FsPermission((short)00733);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,false);
  if (miniHS2.isStarted()) {
    miniHS2.stop();
  }
  conf.set("hive.exec.scratchdir",tmpDir + "/level1/level2/level3");
  miniHS2=new MiniHS2(conf);
  miniHS2.start(confOverlay);
  hs2Conn=getConnection(miniHS2.getJdbcURL(),userName,"password");
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,false);
}

</code></pre>

<pre class="type-3 type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test UDF blacklist
 * - verify default value
 * - verify udfs allowed with default blacklist
 * - verify udf disallowed when in blacklist
 * @throws Exception
 */
@Test public void testUdfBlackList() throws Exception {
  HiveConf testConf=new HiveConf();
  assertTrue(testConf.getVar(ConfVars.HIVE_SERVER2_BUILTIN_UDF_BLACKLIST).isEmpty());
  Statement stmt=hs2Conn.createStatement();
  stmt.executeQuery("SELECT substr('foobar', 4) ");
  miniHS2.stop();
  testConf.setVar(ConfVars.HIVE_SERVER2_BUILTIN_UDF_BLACKLIST,"reflect");
  miniHS2=new MiniHS2(testConf);
  miniHS2.start(new HashMap<String,String>());
  hs2Conn=getConnection(miniHS2.getJdbcURL(),System.getProperty("user.name"),"bar");
  stmt=hs2Conn.createStatement();
  try {
    stmt.executeQuery("SELECT reflect('java.lang.String', 'valueOf', 1) ");
    fail("reflect() udf invocation should fail");
  }
 catch (  SQLException e) {
  }
}

</code></pre>

<pre class="type-11 type-4 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConnection() throws Exception {
  String tableName="testTab1";
  Statement stmt=hs2Conn.createStatement();
  stmt.execute("DROP TABLE IF EXISTS " + tableName);
  stmt.execute("CREATE TABLE " + tableName + " (under_col INT COMMENT 'the under column', value STRING) COMMENT ' test table'");
  stmt.execute("load data local inpath '" + kvDataFilePath.toString() + "' into table "+ tableName);
  ResultSet res=stmt.executeQuery("SELECT * FROM " + tableName);
  assertTrue(res.next());
  assertEquals("val_238",res.getString(2));
  res.close();
  stmt.close();
}

</code></pre>

<pre class="type-11 type-6 type-4 type-5 type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test is to connect to any database without using the command "Use <<DB>>"
 * 1)connect to default database.
 * 2) Create a new DB test_default.
 * 3) Connect to test_default database.
 * 4) Connect and create table under test_default_test.
 * 5) Connect and display all tables.
 * 6) Connect to default database and shouldn't find table test_default_test.
 * 7) Connect and drop test_default_test.
 * 8) drop test_default database.
 */
@Test public void testURIDatabaseName() throws Exception {
  String jdbcUri=miniHS2.getJdbcURL().substring(0,miniHS2.getJdbcURL().indexOf("default"));
  hs2Conn=getConnection(jdbcUri + "default",System.getProperty("user.name"),"bar");
  String dbName="test_connection_non_default_db";
  String tableInNonDefaultSchema="table_in_non_default_schema";
  Statement stmt=hs2Conn.createStatement();
  stmt.execute("create database  if not exists " + dbName);
  stmt.close();
  hs2Conn.close();
  hs2Conn=getConnection(jdbcUri + dbName,System.getProperty("user.name"),"bar");
  stmt=hs2Conn.createStatement();
  boolean expected=stmt.execute(" create table " + tableInNonDefaultSchema + " (x int)");
  stmt.close();
  hs2Conn.close();
  hs2Conn=getConnection(jdbcUri + dbName,System.getProperty("user.name"),"bar");
  stmt=hs2Conn.createStatement();
  ResultSet res=stmt.executeQuery("show tables");
  boolean testTableExists=false;
  while (res.next()) {
    assertNotNull("table name is null in result set",res.getString(1));
    if (tableInNonDefaultSchema.equalsIgnoreCase(res.getString(1))) {
      testTableExists=true;
    }
  }
  assertTrue("table name  " + tableInNonDefaultSchema + "   found in SHOW TABLES result set",testTableExists);
  stmt.close();
  hs2Conn.close();
  hs2Conn=getConnection(jdbcUri + "default",System.getProperty("user.name"),"bar");
  stmt=hs2Conn.createStatement();
  res=stmt.executeQuery("show tables");
  testTableExists=false;
  while (res.next()) {
    assertNotNull("table name is null in result set",res.getString(1));
    if (tableInNonDefaultSchema.equalsIgnoreCase(res.getString(1))) {
      testTableExists=true;
    }
  }
  assertFalse("table name " + tableInNonDefaultSchema + "  NOT  found in SHOW TABLES result set",testTableExists);
  stmt.close();
  hs2Conn.close();
  hs2Conn=getConnection(jdbcUri + dbName,System.getProperty("user.name"),"bar");
  stmt=hs2Conn.createStatement();
  stmt.execute("set hive.support.concurrency = false");
  res=stmt.executeQuery("show tables");
  stmt.execute(" drop table if exists table_in_non_default_schema");
  expected=stmt.execute("DROP DATABASE " + dbName);
  stmt.close();
  hs2Conn=getConnection(jdbcUri + "default",System.getProperty("user.name"),"bar");
  stmt=hs2Conn.createStatement();
  res=stmt.executeQuery("show tables");
  testTableExists=false;
  while (res.next()) {
    assertNotNull("table name is null in result set",res.getString(1));
    if (tableInNonDefaultSchema.equalsIgnoreCase(res.getString(1))) {
      testTableExists=true;
    }
  }
  hs2Conn=getConnection(jdbcUri,System.getProperty("user.name"),"bar");
  verifyCurrentDB("default",hs2Conn);
  hs2Conn.close();
  hs2Conn=getConnection(jdbcUri + ";",System.getProperty("user.name"),"bar");
  verifyCurrentDB("default",hs2Conn);
  hs2Conn.close();
  hs2Conn=getConnection(jdbcUri + ";/foo=bar;foo1=bar1",System.getProperty("user.name"),"bar");
  verifyCurrentDB("default",hs2Conn);
  hs2Conn.close();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  hs2Conn=getConnection(miniHS2.getJdbcURL(),System.getProperty("user.name"),"bar");
}

</code></pre>

<pre class="type-11 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Tests that DataNucleus' NucleusContext.classLoaderResolverMap clears cached class objects
 * (& hence doesn't leak classloaders) on closing any session
 * @throws Exception
 */
@Test public void testAddJarDataNucleusUnCaching() throws Exception {
  Path jarFilePath=new Path(dataFileDir,"identity_udf.jar");
  Connection conn=getConnection(miniHS2.getJdbcURL(),"foo","bar");
  String tableName="testAddJar";
  Statement stmt=conn.createStatement();
  stmt.execute("SET hive.support.concurrency = false");
  stmt.execute("DROP TABLE IF EXISTS " + tableName);
  stmt.execute("CREATE TABLE " + tableName + " (key INT, value STRING)");
  stmt.execute("LOAD DATA LOCAL INPATH '" + kvDataFilePath.toString() + "' INTO TABLE "+ tableName);
  ResultSet res=stmt.executeQuery("SELECT * FROM " + tableName);
  assertTrue(res.next());
  int mapSizeBeforeClose;
  int mapSizeAfterClose;
  stmt.execute("ADD JAR " + jarFilePath.toString());
  stmt.execute("CREATE TEMPORARY FUNCTION func AS 'IdentityStringUDF'");
  stmt.execute("SELECT func(value) from " + tableName);
  mapSizeBeforeClose=getNucleusClassLoaderResolverMapSize();
  System.out.println("classLoaderResolverMap size before connection close: " + mapSizeBeforeClose);
  Assert.assertTrue(mapSizeBeforeClose > 0);
  conn.close();
  mapSizeAfterClose=getNucleusClassLoaderResolverMapSize();
  System.out.println("classLoaderResolverMap size after connection close: " + mapSizeAfterClose);
  Assert.assertTrue("Failed; NucleusContext classLoaderResolverMap size: " + mapSizeAfterClose,mapSizeAfterClose == 0);
}

</code></pre>

<pre class="type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown() throws Exception {
  hs2Conn.close();
}

</code></pre>

<pre class="type-3 type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test UDF whitelist
 * - verify default value
 * - verify udf allowed with default whitelist
 * - verify udf allowed with specific whitelist
 * - verify udf disallowed when not in whitelist
 * @throws Exception
 */
@Test public void testUdfWhiteList() throws Exception {
  HiveConf testConf=new HiveConf();
  assertTrue(testConf.getVar(ConfVars.HIVE_SERVER2_BUILTIN_UDF_WHITELIST).isEmpty());
  Statement stmt=hs2Conn.createStatement();
  stmt.executeQuery("SELECT substr('foobar', 4) ");
  hs2Conn.close();
  miniHS2.stop();
  Set<String> funcNames=FunctionRegistry.getFunctionNames();
  funcNames.remove("reflect");
  String funcNameStr="";
  for (  String funcName : funcNames) {
    funcNameStr+="," + funcName;
  }
  funcNameStr=funcNameStr.substring(1);
  testConf.setVar(ConfVars.HIVE_SERVER2_BUILTIN_UDF_WHITELIST,funcNameStr);
  miniHS2=new MiniHS2(testConf);
  miniHS2.start(new HashMap<String,String>());
  hs2Conn=getConnection(miniHS2.getJdbcURL(),System.getProperty("user.name"),"bar");
  stmt=hs2Conn.createStatement();
  stmt.executeQuery("SELECT substr('foobar', 3) ");
  try {
    stmt.executeQuery("SELECT reflect('java.lang.String', 'valueOf', 1) ");
    fail("reflect() udf invocation should fail");
  }
 catch (  SQLException e) {
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
