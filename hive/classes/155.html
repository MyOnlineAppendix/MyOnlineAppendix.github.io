<h3 style="margin:0px">Class: org.apache.hadoop.hive.ql.io.orc.TestInputOutputFormat (22 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(20)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(19)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies values related to public fields."><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >PublicFieldVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-11 type-6 type-12 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testProjectedColumnSize() throws Exception {
  long[] stripeSizes=new long[]{200,200,200,200,100};
  MockFileSystem fs=new MockFileSystem(conf,new MockFile("mock:/a/file",500,createMockOrcFile(stripeSizes),new MockBlock("host1-1","host1-2","host1-3"),new MockBlock("host2-1","host0","host2-3"),new MockBlock("host0","host3-2","host3-3"),new MockBlock("host4-1","host4-2","host4-3"),new MockBlock("host5-1","host5-2","host5-3")));
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMAXSPLITSIZE,300);
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMINSPLITSIZE,200);
  conf.setBoolean(ColumnProjectionUtils.READ_ALL_COLUMNS,false);
  conf.set(ColumnProjectionUtils.READ_COLUMN_IDS_CONF_STR,"0");
  OrcInputFormat.Context context=new OrcInputFormat.Context(conf);
  OrcInputFormat.SplitGenerator splitter=new OrcInputFormat.SplitGenerator(new OrcInputFormat.SplitInfo(context,fs,fs.getFileStatus(new Path("/a/file")),null,true,new ArrayList<AcidInputFormat.DeltaMetaData>(),true,null,null));
  List<OrcSplit> results=splitter.call();
  OrcSplit result=results.get(0);
  assertEquals(3,results.size());
  assertEquals(3,result.getStart());
  assertEquals(400,result.getLength());
  assertEquals(167468,result.getProjectedColumnsUncompressedSize());
  result=results.get(1);
  assertEquals(403,result.getStart());
  assertEquals(400,result.getLength());
  assertEquals(167468,result.getProjectedColumnsUncompressedSize());
  result=results.get(2);
  assertEquals(803,result.getStart());
  assertEquals(100,result.getLength());
  assertEquals(41867,result.getProjectedColumnsUncompressedSize());
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMAXSPLITSIZE,0);
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMINSPLITSIZE,0);
  context=new OrcInputFormat.Context(conf);
  splitter=new OrcInputFormat.SplitGenerator(new OrcInputFormat.SplitInfo(context,fs,fs.getFileStatus(new Path("/a/file")),null,true,new ArrayList<AcidInputFormat.DeltaMetaData>(),true,null,null));
  results=splitter.call();
  assertEquals(5,results.size());
  for (int i=0; i < stripeSizes.length; ++i) {
    assertEquals("checking stripe " + i + " size",stripeSizes[i],results.get(i).getLength());
    if (i == stripeSizes.length - 1) {
      assertEquals(41867,results.get(i).getProjectedColumnsUncompressedSize());
    }
 else {
      assertEquals(83734,results.get(i).getProjectedColumnsUncompressedSize());
    }
  }
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMAXSPLITSIZE,1000);
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMINSPLITSIZE,100000);
  context=new OrcInputFormat.Context(conf);
  splitter=new OrcInputFormat.SplitGenerator(new OrcInputFormat.SplitInfo(context,fs,fs.getFileStatus(new Path("/a/file")),null,true,new ArrayList<AcidInputFormat.DeltaMetaData>(),true,null,null));
  results=splitter.call();
  assertEquals(1,results.size());
  result=results.get(0);
  assertEquals(3,result.getStart());
  assertEquals(900,result.getLength());
  assertEquals(376804,result.getProjectedColumnsUncompressedSize());
}

</code></pre>

<pre class="type-4 type-5 type-7 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEmptyFile() throws Exception {
  Properties properties=new Properties();
  properties.setProperty("columns","x,y");
  properties.setProperty("columns.types","int:int");
  HiveOutputFormat<?,?> outFormat=new OrcOutputFormat();
  org.apache.hadoop.hive.ql.exec.FileSinkOperator.RecordWriter writer=outFormat.getHiveRecordWriter(conf,testFilePath,MyRow.class,true,properties,Reporter.NULL);
  writer.close(true);
  SerDe serde=new OrcSerde();
  SerDeUtils.initializeSerDe(serde,conf,properties,null);
  InputFormat<?,?> in=new OrcInputFormat();
  FileInputFormat.setInputPaths(conf,testFilePath.toString());
  InputSplit[] splits=in.getSplits(conf,1);
  assertTrue(0 == splits.length);
  assertEquals(null,serde.getSerDeStats());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void openFileSystem() throws Exception {
  conf=new JobConf();
  fs=FileSystem.getLocal(conf);
  testFilePath=new Path(workDir,"TestInputOutputFormat." + testCaseName.getMethodName() + ".orc");
  fs.delete(testFilePath,false);
}

</code></pre>

<pre class="type-11 type-6 type-5 type-7 type-16 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testVectorizationWithAcid() throws Exception {
  StructObjectInspector inspector=new BigRowInspector();
  JobConf conf=createMockExecutionEnvironment(workDir,new Path("mock:///"),"vectorizationAcid",inspector,true,1);
  Path partDir=new Path(conf.get("mapred.input.dir"));
  OrcRecordUpdater writer=new OrcRecordUpdater(partDir,new AcidOutputFormat.Options(conf).maximumTransactionId(10).writingBase(true).bucket(0).inspector(inspector).finalDestination(partDir));
  for (int i=0; i < 100; ++i) {
    BigRow row=new BigRow(i);
    writer.insert(10,row);
  }
  WriterImpl baseWriter=(WriterImpl)writer.getWriter();
  writer.close(false);
  ((MockOutputStream)baseWriter.getStream()).setBlocks(new MockBlock("host0","host1"));
  HiveInputFormat<?,?> inputFormat=new HiveInputFormat<WritableComparable,Writable>();
  InputSplit[] splits=inputFormat.getSplits(conf,10);
  assertEquals(1,splits.length);
  conf.set(IOConstants.SCHEMA_EVOLUTION_COLUMNS,BigRow.getColumnNamesProperty());
  conf.set(IOConstants.SCHEMA_EVOLUTION_COLUMNS_TYPES,BigRow.getColumnTypesProperty());
  HiveConf.setBoolVar(conf,HiveConf.ConfVars.HIVE_TRANSACTIONAL_TABLE_SCAN,true);
  org.apache.hadoop.mapred.RecordReader<NullWritable,VectorizedRowBatch> reader=inputFormat.getRecordReader(splits[0],conf,Reporter.NULL);
  NullWritable key=reader.createKey();
  VectorizedRowBatch value=reader.createValue();
  assertEquals(true,reader.next(key,value));
  assertEquals(100,value.count());
  LongColumnVector booleanColumn=(LongColumnVector)value.cols[0];
  LongColumnVector byteColumn=(LongColumnVector)value.cols[1];
  LongColumnVector shortColumn=(LongColumnVector)value.cols[2];
  LongColumnVector intColumn=(LongColumnVector)value.cols[3];
  LongColumnVector longColumn=(LongColumnVector)value.cols[4];
  DoubleColumnVector floatColumn=(DoubleColumnVector)value.cols[5];
  DoubleColumnVector doubleCoulmn=(DoubleColumnVector)value.cols[6];
  BytesColumnVector stringColumn=(BytesColumnVector)value.cols[7];
  DecimalColumnVector decimalColumn=(DecimalColumnVector)value.cols[8];
  LongColumnVector dateColumn=(LongColumnVector)value.cols[9];
  LongColumnVector timestampColumn=(LongColumnVector)value.cols[10];
  for (int i=0; i < 100; i++) {
    assertEquals("checking boolean " + i,i % 2 == 0 ? 1 : 0,booleanColumn.vector[i]);
    assertEquals("checking byte " + i,(byte)i,byteColumn.vector[i]);
    assertEquals("checking short " + i,(short)i,shortColumn.vector[i]);
    assertEquals("checking int " + i,i,intColumn.vector[i]);
    assertEquals("checking long " + i,i,longColumn.vector[i]);
    assertEquals("checking float " + i,i,floatColumn.vector[i],0.0001);
    assertEquals("checking double " + i,i,doubleCoulmn.vector[i],0.0001);
    Text strValue=new Text();
    strValue.set(stringColumn.vector[i],stringColumn.start[i],stringColumn.length[i]);
    assertEquals("checking string " + i,new Text(Long.toHexString(i)),strValue);
    assertEquals("checking decimal " + i,HiveDecimal.create(i),decimalColumn.vector[i].getHiveDecimal());
    assertEquals("checking date " + i,i,dateColumn.vector[i]);
    long millis=(long)i * MILLIS_IN_DAY;
    millis-=LOCAL_TIMEZONE.getOffset(millis);
    assertEquals("checking timestamp " + i,millis * 1000000L,timestampColumn.vector[i]);
  }
  assertEquals(false,reader.next(key,value));
}

</code></pre>

<pre class="type-11 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFileGenerator() throws Exception {
  OrcInputFormat.Context context=new OrcInputFormat.Context(conf);
  MockFileSystem fs=new MockFileSystem(conf,new MockFile("mock:/a/b/part-00",1000,new byte[0]),new MockFile("mock:/a/b/part-01",1000,new byte[0]),new MockFile("mock:/a/b/_part-02",1000,new byte[0]),new MockFile("mock:/a/b/.part-03",1000,new byte[0]),new MockFile("mock:/a/b/part-04",1000,new byte[0]));
  OrcInputFormat.FileGenerator gen=new OrcInputFormat.FileGenerator(context,fs,new MockPath(fs,"mock:/a/b"),false);
  OrcInputFormat.SplitStrategy splitStrategy=createSplitStrategy(context,gen);
  assertEquals(true,splitStrategy instanceof OrcInputFormat.BISplitStrategy);
  conf.set("mapreduce.input.fileinputformat.split.maxsize","500");
  context=new OrcInputFormat.Context(conf);
  fs=new MockFileSystem(conf,new MockFile("mock:/a/b/part-00",1000,new byte[1000]),new MockFile("mock:/a/b/part-01",1000,new byte[1000]),new MockFile("mock:/a/b/_part-02",1000,new byte[1000]),new MockFile("mock:/a/b/.part-03",1000,new byte[1000]),new MockFile("mock:/a/b/part-04",1000,new byte[1000]));
  gen=new OrcInputFormat.FileGenerator(context,fs,new MockPath(fs,"mock:/a/b"),false);
  splitStrategy=createSplitStrategy(context,gen);
  assertEquals(true,splitStrategy instanceof OrcInputFormat.ETLSplitStrategy);
}

</code></pre>

<pre class="type-11 type-6 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInOutFormat() throws Exception {
  Properties properties=new Properties();
  properties.setProperty("columns","x,y");
  properties.setProperty("columns.types","int:int");
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(MyRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  SerDe serde=new OrcSerde();
  HiveOutputFormat<?,?> outFormat=new OrcOutputFormat();
  org.apache.hadoop.hive.ql.exec.FileSinkOperator.RecordWriter writer=outFormat.getHiveRecordWriter(conf,testFilePath,MyRow.class,true,properties,Reporter.NULL);
  writer.write(serde.serialize(new MyRow(1,2),inspector));
  writer.write(serde.serialize(new MyRow(2,2),inspector));
  writer.write(serde.serialize(new MyRow(3,2),inspector));
  writer.close(true);
  serde=new OrcSerde();
  SerDeUtils.initializeSerDe(serde,conf,properties,null);
  assertEquals(OrcSerde.OrcSerdeRow.class,serde.getSerializedClass());
  inspector=(StructObjectInspector)serde.getObjectInspector();
  assertEquals("struct<x:int,y:int>",inspector.getTypeName());
  InputFormat<?,?> in=new OrcInputFormat();
  FileInputFormat.setInputPaths(conf,testFilePath.toString());
  InputSplit[] splits=in.getSplits(conf,1);
  assertEquals(1,splits.length);
  ArrayList<FileStatus> fileList=new ArrayList<FileStatus>();
  assertEquals(false,((InputFormatChecker)in).validateInput(fs,new HiveConf(),fileList));
  fileList.add(fs.getFileStatus(testFilePath));
  assertEquals(true,((InputFormatChecker)in).validateInput(fs,new HiveConf(),fileList));
  fileList.add(fs.getFileStatus(workDir));
  assertEquals(false,((InputFormatChecker)in).validateInput(fs,new HiveConf(),fileList));
  conf.set(IOConstants.SCHEMA_EVOLUTION_COLUMNS,MyRow.getColumnNamesProperty());
  conf.set(IOConstants.SCHEMA_EVOLUTION_COLUMNS_TYPES,MyRow.getColumnTypesProperty());
  org.apache.hadoop.mapred.RecordReader reader=in.getRecordReader(splits[0],conf,Reporter.NULL);
  Object key=reader.createKey();
  Writable value=(Writable)reader.createValue();
  int rowNum=0;
  List<? extends StructField> fields=inspector.getAllStructFieldRefs();
  IntObjectInspector intInspector=(IntObjectInspector)fields.get(0).getFieldObjectInspector();
  while (reader.next(key,value)) {
    assertEquals(++rowNum,intInspector.get(inspector.getStructFieldData(serde.deserialize(value),fields.get(0))));
    assertEquals(2,intInspector.get(inspector.getStructFieldData(serde.deserialize(value),fields.get(1))));
  }
  assertEquals(3,rowNum);
  assertEquals(1.0,reader.getProgress(),0.00001);
  reader.close();
  ColumnProjectionUtils.appendReadColumns(conf,Collections.singletonList(0));
  reader=in.getRecordReader(splits[0],conf,Reporter.NULL);
  key=reader.createKey();
  value=(Writable)reader.createValue();
  rowNum=0;
  fields=inspector.getAllStructFieldRefs();
  while (reader.next(key,value)) {
    assertEquals(++rowNum,intInspector.get(inspector.getStructFieldData(value,fields.get(0))));
    assertEquals(null,inspector.getStructFieldData(value,fields.get(1)));
  }
  assertEquals(3,rowNum);
  reader.close();
  ColumnProjectionUtils.setReadAllColumns(conf);
  reader=in.getRecordReader(splits[0],conf,Reporter.NULL);
  key=reader.createKey();
  value=(Writable)reader.createValue();
  rowNum=0;
  fields=inspector.getAllStructFieldRefs();
  while (reader.next(key,value)) {
    assertEquals(++rowNum,intInspector.get(inspector.getStructFieldData(value,fields.get(0))));
    assertEquals(2,intInspector.get(inspector.getStructFieldData(serde.deserialize(value),fields.get(1))));
  }
  assertEquals(3,rowNum);
  reader.close();
}

</code></pre>

<pre class="type-11 type-6 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMROutput() throws Exception {
  Properties properties=new Properties();
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(NestedRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  SerDe serde=new OrcSerde();
  OutputFormat<?,?> outFormat=new OrcOutputFormat();
  RecordWriter writer=outFormat.getRecordWriter(fs,conf,testFilePath.toString(),Reporter.NULL);
  writer.write(NullWritable.get(),serde.serialize(new NestedRow(1,2,3),inspector));
  writer.write(NullWritable.get(),serde.serialize(new NestedRow(4,5,6),inspector));
  writer.write(NullWritable.get(),serde.serialize(new NestedRow(7,8,9),inspector));
  writer.close(Reporter.NULL);
  serde=new OrcSerde();
  properties.setProperty("columns","z,r");
  properties.setProperty("columns.types","int:struct<x:int,y:int>");
  SerDeUtils.initializeSerDe(serde,conf,properties,null);
  inspector=(StructObjectInspector)serde.getObjectInspector();
  InputFormat<?,?> in=new OrcInputFormat();
  FileInputFormat.setInputPaths(conf,testFilePath.toString());
  InputSplit[] splits=in.getSplits(conf,1);
  assertEquals(1,splits.length);
  ColumnProjectionUtils.appendReadColumns(conf,Collections.singletonList(1));
  conf.set("columns","z,r");
  conf.set("columns.types","int:struct<x:int,y:int>");
  org.apache.hadoop.mapred.RecordReader reader=in.getRecordReader(splits[0],conf,Reporter.NULL);
  Object key=reader.createKey();
  Object value=reader.createValue();
  int rowNum=0;
  List<? extends StructField> fields=inspector.getAllStructFieldRefs();
  StructObjectInspector inner=(StructObjectInspector)fields.get(1).getFieldObjectInspector();
  List<? extends StructField> inFields=inner.getAllStructFieldRefs();
  IntObjectInspector intInspector=(IntObjectInspector)fields.get(0).getFieldObjectInspector();
  while (reader.next(key,value)) {
    assertEquals(null,inspector.getStructFieldData(value,fields.get(0)));
    Object sub=inspector.getStructFieldData(value,fields.get(1));
    assertEquals(3 * rowNum + 1,intInspector.get(inner.getStructFieldData(sub,inFields.get(0))));
    assertEquals(3 * rowNum + 2,intInspector.get(inner.getStructFieldData(sub,inFields.get(1))));
    rowNum+=1;
  }
  assertEquals(3,rowNum);
  reader.close();
}

</code></pre>

<pre class="type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSplitElimination() throws Exception {
  Properties properties=new Properties();
  properties.setProperty("columns","z,r");
  properties.setProperty("columns.types","int:struct<x:int,y:int>");
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(NestedRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  SerDe serde=new OrcSerde();
  OutputFormat<?,?> outFormat=new OrcOutputFormat();
  conf.setInt("mapred.max.split.size",50);
  RecordWriter writer=outFormat.getRecordWriter(fs,conf,testFilePath.toString(),Reporter.NULL);
  writer.write(NullWritable.get(),serde.serialize(new NestedRow(1,2,3),inspector));
  writer.write(NullWritable.get(),serde.serialize(new NestedRow(4,5,6),inspector));
  writer.write(NullWritable.get(),serde.serialize(new NestedRow(7,8,9),inspector));
  writer.close(Reporter.NULL);
  serde=new OrcSerde();
  SearchArgument sarg=SearchArgumentFactory.newBuilder().startAnd().lessThan("z",PredicateLeaf.Type.LONG,new Long(0)).end().build();
  conf.set("sarg.pushdown",toKryo(sarg));
  conf.set("hive.io.file.readcolumn.names","z,r");
  SerDeUtils.initializeSerDe(serde,conf,properties,null);
  inspector=(StructObjectInspector)serde.getObjectInspector();
  InputFormat<?,?> in=new OrcInputFormat();
  FileInputFormat.setInputPaths(conf,testFilePath.toString());
  InputSplit[] splits=in.getSplits(conf,1);
  assertEquals(0,splits.length);
}

</code></pre>

<pre class="type-11 type-6 type-5 type-7 type-16 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Test vectorization, non-acid, non-combine.
 * @throws Exception
 */
@Test public void testVectorization() throws Exception {
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(MyRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  JobConf conf=createMockExecutionEnvironment(workDir,new Path("mock:///"),"vectorization",inspector,true,1);
  Writer writer=OrcFile.createWriter(new Path(conf.get("mapred.input.dir") + "/0_0"),OrcFile.writerOptions(conf).blockPadding(false).bufferSize(1024).inspector(inspector));
  for (int i=0; i < 10; ++i) {
    writer.addRow(new MyRow(i,2 * i));
  }
  writer.close();
  ((MockOutputStream)((WriterImpl)writer).getStream()).setBlocks(new MockBlock("host0","host1"));
  HiveInputFormat<?,?> inputFormat=new HiveInputFormat<WritableComparable,Writable>();
  InputSplit[] splits=inputFormat.getSplits(conf,10);
  assertEquals(1,splits.length);
  org.apache.hadoop.mapred.RecordReader<NullWritable,VectorizedRowBatch> reader=inputFormat.getRecordReader(splits[0],conf,Reporter.NULL);
  NullWritable key=reader.createKey();
  VectorizedRowBatch value=reader.createValue();
  assertEquals(true,reader.next(key,value));
  assertEquals(10,value.count());
  LongColumnVector col0=(LongColumnVector)value.cols[0];
  for (int i=0; i < 10; i++) {
    assertEquals("checking " + i,i,col0.vector[i]);
  }
  assertEquals(false,reader.next(key,value));
}

</code></pre>

<pre class="type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetSearchArgument() throws Exception {
  Reader.Options options=new Reader.Options();
  List<OrcProto.Type> types=new ArrayList<OrcProto.Type>();
  OrcProto.Type.Builder builder=OrcProto.Type.newBuilder();
  builder.setKind(OrcProto.Type.Kind.STRUCT).addAllFieldNames(Arrays.asList("op","otid","bucket","rowid","ctid","row")).addAllSubtypes(Arrays.asList(1,2,3,4,5,6));
  types.add(builder.build());
  builder.clear().setKind(OrcProto.Type.Kind.INT);
  types.add(builder.build());
  types.add(builder.build());
  types.add(builder.build());
  types.add(builder.build());
  types.add(builder.build());
  builder.clear().setKind(OrcProto.Type.Kind.STRUCT).addAllFieldNames(Arrays.asList("url","purchase","cost","store")).addAllSubtypes(Arrays.asList(7,8,9,10));
  types.add(builder.build());
  builder.clear().setKind(OrcProto.Type.Kind.STRING);
  types.add(builder.build());
  builder.clear().setKind(OrcProto.Type.Kind.INT);
  types.add(builder.build());
  types.add(builder.build());
  types.add(builder.build());
  SearchArgument isNull=SearchArgumentFactory.newBuilder().startAnd().isNull("cost",PredicateLeaf.Type.LONG).end().build();
  conf.set(ConvertAstToSearchArg.SARG_PUSHDOWN,toKryo(isNull));
  conf.set(ColumnProjectionUtils.READ_COLUMN_NAMES_CONF_STR,"url,cost");
  options.include(new boolean[]{true,true,false,true,false});
  OrcInputFormat.setSearchArgument(options,types,conf,false);
  String[] colNames=options.getColumnNames();
  assertEquals(null,colNames[0]);
  assertEquals("url",colNames[1]);
  assertEquals(null,colNames[2]);
  assertEquals("cost",colNames[3]);
  assertEquals(null,colNames[4]);
  SearchArgument arg=options.getSearchArgument();
  List<PredicateLeaf> leaves=arg.getLeaves();
  assertEquals("cost",leaves.get(0).getColumnName());
  assertEquals(PredicateLeaf.Operator.IS_NULL,leaves.get(0).getOperator());
}

</code></pre>

<pre class="type-11 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSplitStrategySelection() throws Exception {
  conf.set("mapreduce.input.fileinputformat.split.maxsize","500");
  conf.setLong(HiveConf.ConfVars.HIVE_ORC_CACHE_STRIPE_DETAILS_SIZE.varname,100);
  final int[] counts={1,10,100,256};
  final int[] sizes={100,1000};
  final int[] numSplits={1,9,10,11,99,111};
  final String[] strategyResults=new String[]{"ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","BISplitStrategy","BISplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","BISplitStrategy","BISplitStrategy","BISplitStrategy","BISplitStrategy","BISplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","BISplitStrategy","BISplitStrategy","BISplitStrategy","BISplitStrategy","BISplitStrategy","BISplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy","ETLSplitStrategy"};
  int k=0;
  for (  int c : counts) {
    for (    int s : sizes) {
      final FileSystem fs=generateMockFiles(c,s);
      for (      int n : numSplits) {
        final OrcInputFormat.Context context=new OrcInputFormat.Context(conf,n);
        OrcInputFormat.FileGenerator gen=new OrcInputFormat.FileGenerator(context,fs,new MockPath(fs,"mock:/a/b"),false);
        final SplitStrategy splitStrategy=createSplitStrategy(context,gen);
        assertTrue(String.format("Split strategy for %d files x %d size for %d splits",c,s,n),splitStrategy.getClass().getSimpleName().equals(strategyResults[k++]));
      }
    }
  }
}

</code></pre>

<pre class="type-11 type-6 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCombinationInputFormatWithAcid() throws Exception {
  StructObjectInspector inspector;
  final int PARTITIONS=2;
  final int BUCKETS=3;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(MyRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  JobConf conf=createMockExecutionEnvironment(workDir,new Path("mock:///"),"combinationAcid",inspector,false,PARTITIONS);
  Path[] partDir=new Path[PARTITIONS];
  String[] paths=conf.getStrings("mapred.input.dir");
  for (int p=0; p < PARTITIONS; ++p) {
    partDir[p]=new Path(paths[p]);
  }
  OrcRecordUpdater writer=new OrcRecordUpdater(partDir[0],new AcidOutputFormat.Options(conf).maximumTransactionId(10).writingBase(true).bucket(0).inspector(inspector).finalDestination(partDir[0]));
  for (int i=0; i < 10; ++i) {
    writer.insert(10,new MyRow(i,2 * i));
  }
  WriterImpl baseWriter=(WriterImpl)writer.getWriter();
  writer.close(false);
  MockOutputStream outputStream=(MockOutputStream)baseWriter.getStream();
  outputStream.setBlocks(new MockBlock("host1","host2"));
  writer=new OrcRecordUpdater(partDir[0],new AcidOutputFormat.Options(conf).maximumTransactionId(10).writingBase(true).bucket(1).inspector(inspector).finalDestination(partDir[0]));
  for (int i=10; i < 20; ++i) {
    writer.insert(10,new MyRow(i,2 * i));
  }
  WriterImpl deltaWriter=(WriterImpl)writer.getWriter();
  outputStream=(MockOutputStream)deltaWriter.getStream();
  writer.close(false);
  outputStream.setBlocks(new MockBlock("host1","host2"));
  for (int bucket=0; bucket < BUCKETS; ++bucket) {
    Writer orc=OrcFile.createWriter(new Path(partDir[1],"00000" + bucket + "_0"),OrcFile.writerOptions(conf).blockPadding(false).bufferSize(1024).inspector(inspector));
    orc.addRow(new MyRow(1,2));
    outputStream=(MockOutputStream)((WriterImpl)orc).getStream();
    orc.close();
    outputStream.setBlocks(new MockBlock("host3","host4"));
  }
  conf.setInt(hive_metastoreConstants.BUCKET_COUNT,BUCKETS);
  HiveInputFormat<?,?> inputFormat=new CombineHiveInputFormat<WritableComparable,Writable>();
  InputSplit[] splits=inputFormat.getSplits(conf,1);
  assertEquals(3,splits.length);
  HiveInputFormat.HiveInputSplit split=(HiveInputFormat.HiveInputSplit)splits[0];
  assertEquals("org.apache.hadoop.hive.ql.io.orc.OrcInputFormat",split.inputFormatClassName());
  assertEquals("mock:/combinationAcid/p=0/base_0000010/bucket_00000",split.getPath().toString());
  assertEquals(0,split.getStart());
  assertEquals(607,split.getLength());
  split=(HiveInputFormat.HiveInputSplit)splits[1];
  assertEquals("org.apache.hadoop.hive.ql.io.orc.OrcInputFormat",split.inputFormatClassName());
  assertEquals("mock:/combinationAcid/p=0/base_0000010/bucket_00001",split.getPath().toString());
  assertEquals(0,split.getStart());
  assertEquals(629,split.getLength());
  CombineHiveInputFormat.CombineHiveInputSplit combineSplit=(CombineHiveInputFormat.CombineHiveInputSplit)splits[2];
  assertEquals(BUCKETS,combineSplit.getNumPaths());
  for (int bucket=0; bucket < BUCKETS; ++bucket) {
    assertEquals("mock:/combinationAcid/p=1/00000" + bucket + "_0",combineSplit.getPath(bucket).toString());
    assertEquals(0,combineSplit.getOffset(bucket));
    assertEquals(241,combineSplit.getLength(bucket));
  }
  String[] hosts=combineSplit.getLocations();
  assertEquals(2,hosts.length);
}

</code></pre>

<pre class="type-7 type-1 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=RuntimeException.class) public void testSplitGenFailure() throws IOException {
  Properties properties=new Properties();
  HiveOutputFormat<?,?> outFormat=new OrcOutputFormat();
  org.apache.hadoop.hive.ql.exec.FileSinkOperator.RecordWriter writer=outFormat.getHiveRecordWriter(conf,testFilePath,MyRow.class,true,properties,Reporter.NULL);
  writer.close(true);
  InputFormat<?,?> in=new OrcInputFormat();
  fs.setPermission(testFilePath,FsPermission.createImmutable((short)0333));
  FileInputFormat.setInputPaths(conf,testFilePath.toString());
  try {
    in.getSplits(conf,1);
  }
 catch (  RuntimeException e) {
    assertEquals(true,e.getMessage().contains("Permission denied"));
    throw e;
  }
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOverlap() throws Exception {
  assertEquals(0,OrcInputFormat.SplitGenerator.getOverlap(100,100,200,100));
  assertEquals(0,OrcInputFormat.SplitGenerator.getOverlap(0,1000,2000,100));
  assertEquals(100,OrcInputFormat.SplitGenerator.getOverlap(1000,1000,1500,100));
  assertEquals(250,OrcInputFormat.SplitGenerator.getOverlap(1000,250,500,2000));
  assertEquals(100,OrcInputFormat.SplitGenerator.getOverlap(1000,1000,1900,1000));
  assertEquals(500,OrcInputFormat.SplitGenerator.getOverlap(2000,1000,2500,2000));
}

</code></pre>

<pre class="type-11 type-6 type-4 type-5 type-7 type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCombinationInputFormat() throws Exception {
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(MyRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  JobConf conf=createMockExecutionEnvironment(workDir,new Path("mock:///"),"combination",inspector,false,1);
  Path partDir=new Path(conf.get("mapred.input.dir"));
  Writer writer=OrcFile.createWriter(new Path(partDir,"0_0"),OrcFile.writerOptions(conf).blockPadding(false).bufferSize(1024).inspector(inspector));
  for (int i=0; i < 10; ++i) {
    writer.addRow(new MyRow(i,2 * i));
  }
  writer.close();
  MockOutputStream outputStream=(MockOutputStream)((WriterImpl)writer).getStream();
  outputStream.setBlocks(new MockBlock("host0","host1"));
  int length0=outputStream.file.length;
  writer=OrcFile.createWriter(new Path(partDir,"1_0"),OrcFile.writerOptions(conf).blockPadding(false).bufferSize(1024).inspector(inspector));
  for (int i=10; i < 20; ++i) {
    writer.addRow(new MyRow(i,2 * i));
  }
  writer.close();
  outputStream=(MockOutputStream)((WriterImpl)writer).getStream();
  outputStream.setBlocks(new MockBlock("host1","host2"));
  HiveInputFormat<?,?> inputFormat=new CombineHiveInputFormat<WritableComparable,Writable>();
  InputSplit[] splits=inputFormat.getSplits(conf,1);
  assertEquals(1,splits.length);
  CombineHiveInputFormat.CombineHiveInputSplit split=(CombineHiveInputFormat.CombineHiveInputSplit)splits[0];
  assertEquals(2,split.getNumPaths());
  assertEquals(partDir.toString() + "/0_0",split.getPath(0).toString());
  assertEquals(partDir.toString() + "/1_0",split.getPath(1).toString());
  assertEquals(length0,split.getLength(0));
  assertEquals(outputStream.file.length,split.getLength(1));
  assertEquals(0,split.getOffset(0));
  assertEquals(0,split.getOffset(1));
  assertTrue(3 >= split.getLocations().length);
  org.apache.hadoop.mapred.RecordReader<CombineHiveKey,OrcStruct> reader=inputFormat.getRecordReader(split,conf,Reporter.NULL);
  CombineHiveKey key=reader.createKey();
  OrcStruct value=reader.createValue();
  for (int i=0; i < 20; i++) {
    assertEquals(true,reader.next(key,value));
    assertEquals(i,((IntWritable)value.getFieldValue(0)).get());
  }
  assertEquals(false,reader.next(key,value));
}

</code></pre>

<pre class="type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetInputPaths() throws Exception {
  conf.set("mapred.input.dir","a,b,c");
  assertArrayEquals(new Path[]{new Path("a"),new Path("b"),new Path("c")},OrcInputFormat.getInputPaths(conf));
  conf.set("mapred.input.dir","/a/b/c/d/e");
  assertArrayEquals(new Path[]{new Path("/a/b/c/d/e")},OrcInputFormat.getInputPaths(conf));
  conf.set("mapred.input.dir","/a/b/c\\,d,/e/f\\,g/h");
  assertArrayEquals(new Path[]{new Path("/a/b/c,d"),new Path("/e/f,g/h")},OrcInputFormat.getInputPaths(conf));
}

</code></pre>

<pre class="type-11 type-4 type-5 type-14 type-7 type-8 type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEtlCombinedStrategy() throws Exception {
  conf.set(HiveConf.ConfVars.HIVE_ORC_SPLIT_STRATEGY.varname,"ETL");
  conf.set(HiveConf.ConfVars.HIVE_ORC_SPLIT_DIRECTORY_BATCH_MS.varname,"1000000");
  OrcInputFormat.Context context=new OrcInputFormat.Context(conf);
  MockFileSystem fs=new MockFileSystem(conf,new MockFile("mock:/a/1/part-00",1000,new byte[0]),new MockFile("mock:/a/1/part-01",1000,new byte[0]),new MockFile("mock:/a/2/part-00",1000,new byte[0]),new MockFile("mock:/a/2/part-01",1000,new byte[0]),new MockFile("mock:/a/3/base_0/1",1000,new byte[0]),new MockFile("mock:/a/4/base_0/1",1000,new byte[0]),new MockFile("mock:/a/5/base_0/1",1000,new byte[0]),new MockFile("mock:/a/5/delta_0_25/1",1000,new byte[0]));
  OrcInputFormat.CombinedCtx combineCtx=new OrcInputFormat.CombinedCtx();
  SplitStrategy<?> ss=createOrCombineStrategy(context,fs,"mock:/a/1",combineCtx);
  assertNull(ss);
  assertTrue(combineCtx.combined instanceof OrcInputFormat.ETLSplitStrategy);
  OrcInputFormat.ETLSplitStrategy etlSs=(OrcInputFormat.ETLSplitStrategy)combineCtx.combined;
  assertEquals(2,etlSs.files.size());
  assertTrue(etlSs.isOriginal);
  assertEquals(1,etlSs.dirs.size());
  ss=createOrCombineStrategy(context,fs,"mock:/a/2",combineCtx);
  assertNull(ss);
  assertTrue(combineCtx.combined instanceof OrcInputFormat.ETLSplitStrategy);
  assertEquals(4,etlSs.files.size());
  assertEquals(2,etlSs.dirs.size());
  ss=createOrCombineStrategy(context,fs,"mock:/a/3",combineCtx);
  assertSame(etlSs,ss);
  assertEquals(4,etlSs.files.size());
  assertEquals(2,etlSs.dirs.size());
  assertTrue(combineCtx.combined instanceof OrcInputFormat.ETLSplitStrategy);
  etlSs=(OrcInputFormat.ETLSplitStrategy)combineCtx.combined;
  assertEquals(1,etlSs.files.size());
  assertFalse(etlSs.isOriginal);
  assertEquals(1,etlSs.dirs.size());
  ss=createOrCombineStrategy(context,fs,"mock:/a/1",combineCtx);
  assertTrue(ss instanceof OrcInputFormat.ETLSplitStrategy);
  assertNotSame(etlSs,ss);
  OrcInputFormat.ETLSplitStrategy rejectedEtlSs=(OrcInputFormat.ETLSplitStrategy)ss;
  assertEquals(2,rejectedEtlSs.files.size());
  assertEquals(1,rejectedEtlSs.dirs.size());
  assertTrue(rejectedEtlSs.isOriginal);
  assertEquals(1,etlSs.files.size());
  assertEquals(1,etlSs.dirs.size());
  ss=createOrCombineStrategy(context,fs,"mock:/a/4",combineCtx);
  assertNull(ss);
  assertTrue(combineCtx.combined instanceof OrcInputFormat.ETLSplitStrategy);
  assertEquals(2,etlSs.files.size());
  assertEquals(2,etlSs.dirs.size());
  ss=createOrCombineStrategy(context,fs,"mock:/a/5",combineCtx);
  assertTrue(ss instanceof OrcInputFormat.ETLSplitStrategy);
  assertNotSame(etlSs,ss);
  assertEquals(2,etlSs.files.size());
  assertEquals(2,etlSs.dirs.size());
}

</code></pre>

<pre class="type-11 type-6 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSplitGenerator() throws Exception {
  long[] stripeSizes=new long[]{197,300,600,200,200,100,100,100,100,100};
  MockFileSystem fs=new MockFileSystem(conf,new MockFile("mock:/a/file",500,createMockOrcFile(stripeSizes),new MockBlock("host1-1","host1-2","host1-3"),new MockBlock("host2-1","host0","host2-3"),new MockBlock("host0","host3-2","host3-3"),new MockBlock("host4-1","host4-2","host4-3"),new MockBlock("host5-1","host5-2","host5-3")));
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMAXSPLITSIZE,300);
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMINSPLITSIZE,200);
  OrcInputFormat.Context context=new OrcInputFormat.Context(conf);
  OrcInputFormat.SplitGenerator splitter=new OrcInputFormat.SplitGenerator(new OrcInputFormat.SplitInfo(context,fs,AcidUtils.createOriginalObj(null,fs.getFileStatus(new Path("/a/file"))),null,true,new ArrayList<AcidInputFormat.DeltaMetaData>(),true,null,null));
  List<OrcSplit> results=splitter.call();
  OrcSplit result=results.get(0);
  assertEquals(3,result.getStart());
  assertEquals(497,result.getLength());
  result=results.get(1);
  assertEquals(500,result.getStart());
  assertEquals(600,result.getLength());
  result=results.get(2);
  assertEquals(1100,result.getStart());
  assertEquals(400,result.getLength());
  result=results.get(3);
  assertEquals(1500,result.getStart());
  assertEquals(300,result.getLength());
  result=results.get(4);
  assertEquals(1800,result.getStart());
  assertEquals(200,result.getLength());
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMAXSPLITSIZE,0);
  HiveConf.setLongVar(conf,HiveConf.ConfVars.MAPREDMINSPLITSIZE,0);
  context=new OrcInputFormat.Context(conf);
  splitter=new OrcInputFormat.SplitGenerator(new OrcInputFormat.SplitInfo(context,fs,AcidUtils.createOriginalObj(null,fs.getFileStatus(new Path("/a/file"))),null,true,new ArrayList<AcidInputFormat.DeltaMetaData>(),true,null,null));
  results=splitter.call();
  for (int i=0; i < stripeSizes.length; ++i) {
    assertEquals("checking stripe " + i + " size",stripeSizes[i],results.get(i).getLength());
  }
}

</code></pre>

<pre class="type-11 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDefaultTypes() throws Exception {
  Properties properties=new Properties();
  properties.setProperty("columns","str,str2");
  properties.setProperty("columns.types","string:string");
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(StringRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  SerDe serde=new OrcSerde();
  HiveOutputFormat<?,?> outFormat=new OrcOutputFormat();
  org.apache.hadoop.hive.ql.exec.FileSinkOperator.RecordWriter writer=outFormat.getHiveRecordWriter(conf,testFilePath,StringRow.class,true,properties,Reporter.NULL);
  writer.write(serde.serialize(new StringRow("owen"),inspector));
  writer.write(serde.serialize(new StringRow("beth"),inspector));
  writer.write(serde.serialize(new StringRow("laurel"),inspector));
  writer.write(serde.serialize(new StringRow("hazen"),inspector));
  writer.write(serde.serialize(new StringRow("colin"),inspector));
  writer.write(serde.serialize(new StringRow("miles"),inspector));
  writer.close(true);
  serde=new OrcSerde();
  SerDeUtils.initializeSerDe(serde,conf,properties,null);
  inspector=(StructObjectInspector)serde.getObjectInspector();
  assertEquals("struct<str:string,str2:string>",inspector.getTypeName());
  InputFormat<?,?> in=new OrcInputFormat();
  FileInputFormat.setInputPaths(conf,testFilePath.toString());
  InputSplit[] splits=in.getSplits(conf,1);
  assertEquals(1,splits.length);
  conf.set("columns",StringRow.getColumnNamesProperty());
  conf.set("columns.types",StringRow.getColumnTypesProperty());
  org.apache.hadoop.mapred.RecordReader reader=in.getRecordReader(splits[0],conf,Reporter.NULL);
  Object key=reader.createKey();
  Writable value=(Writable)reader.createValue();
  List<? extends StructField> fields=inspector.getAllStructFieldRefs();
  StringObjectInspector strInspector=(StringObjectInspector)fields.get(0).getFieldObjectInspector();
  assertEquals(true,reader.next(key,value));
  assertEquals("owen",strInspector.getPrimitiveJavaObject(inspector.getStructFieldData(value,fields.get(0))));
  assertEquals(true,reader.next(key,value));
  assertEquals("beth",strInspector.getPrimitiveJavaObject(inspector.getStructFieldData(value,fields.get(0))));
  assertEquals(true,reader.next(key,value));
  assertEquals("laurel",strInspector.getPrimitiveJavaObject(inspector.getStructFieldData(value,fields.get(0))));
  assertEquals(true,reader.next(key,value));
  assertEquals("hazen",strInspector.getPrimitiveJavaObject(inspector.getStructFieldData(value,fields.get(0))));
  assertEquals(true,reader.next(key,value));
  assertEquals("colin",strInspector.getPrimitiveJavaObject(inspector.getStructFieldData(value,fields.get(0))));
  assertEquals(true,reader.next(key,value));
  assertEquals("miles",strInspector.getPrimitiveJavaObject(inspector.getStructFieldData(value,fields.get(0))));
  assertEquals(false,reader.next(key,value));
  reader.close();
}

</code></pre>

<pre class="type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSplitEliminationNullStats() throws Exception {
  Properties properties=new Properties();
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(SimpleRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  SerDe serde=new OrcSerde();
  OutputFormat<?,?> outFormat=new OrcOutputFormat();
  conf.setInt("mapred.max.split.size",50);
  RecordWriter writer=outFormat.getRecordWriter(fs,conf,testFilePath.toString(),Reporter.NULL);
  writer.write(NullWritable.get(),serde.serialize(new SimpleRow(null),inspector));
  writer.write(NullWritable.get(),serde.serialize(new SimpleRow(null),inspector));
  writer.write(NullWritable.get(),serde.serialize(new SimpleRow(null),inspector));
  writer.close(Reporter.NULL);
  serde=new OrcSerde();
  SearchArgument sarg=SearchArgumentFactory.newBuilder().startAnd().lessThan("z",PredicateLeaf.Type.STRING,new String("foo")).end().build();
  conf.set("sarg.pushdown",toKryo(sarg));
  conf.set("hive.io.file.readcolumn.names","z");
  properties.setProperty("columns","z");
  properties.setProperty("columns.types","string");
  SerDeUtils.initializeSerDe(serde,conf,properties,null);
  inspector=(StructObjectInspector)serde.getObjectInspector();
  InputFormat<?,?> in=new OrcInputFormat();
  FileInputFormat.setInputPaths(conf,testFilePath.toString());
  InputSplit[] splits=in.getSplits(conf,1);
  assertEquals(0,splits.length);
}

</code></pre>

<pre class="type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddSplit() throws Exception {
  MockFileSystem fs=new MockFileSystem(conf,new MockFile("mock:/a/file",500,createMockOrcFile(197,300,600,200,200,100,100,100,100,100),new MockBlock("host1-1","host1-2","host1-3"),new MockBlock("host2-1","host0","host2-3"),new MockBlock("host0","host3-2","host3-3"),new MockBlock("host4-1","host4-2","host4-3"),new MockBlock("host5-1","host5-2","host5-3")));
  OrcInputFormat.Context context=new OrcInputFormat.Context(conf);
  OrcInputFormat.SplitGenerator splitter=new OrcInputFormat.SplitGenerator(new OrcInputFormat.SplitInfo(context,fs,AcidUtils.createOriginalObj(null,fs.getFileStatus(new Path("/a/file"))),null,true,new ArrayList<AcidInputFormat.DeltaMetaData>(),true,null,null));
  OrcSplit result=splitter.createSplit(0,200,null);
  assertEquals(0,result.getStart());
  assertEquals(200,result.getLength());
  assertEquals("mock:/a/file",result.getPath().toString());
  String[] locs=result.getLocations();
  assertEquals(3,locs.length);
  assertEquals("host1-1",locs[0]);
  assertEquals("host1-2",locs[1]);
  assertEquals("host1-3",locs[2]);
  result=splitter.createSplit(500,600,null);
  locs=result.getLocations();
  assertEquals(3,locs.length);
  assertEquals("host2-1",locs[0]);
  assertEquals("host0",locs[1]);
  assertEquals("host2-3",locs[2]);
  result=splitter.createSplit(0,2500,null);
  locs=result.getLocations();
  assertEquals(1,locs.length);
  assertEquals("host0",locs[0]);
}

</code></pre>

<pre class="type-11 type-6 type-5 type-7 type-16 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Test vectorization, non-acid, non-combine.
 * @throws Exception
 */
@Test public void testVectorizationWithBuckets() throws Exception {
  StructObjectInspector inspector;
synchronized (TestOrcFile.class) {
    inspector=(StructObjectInspector)ObjectInspectorFactory.getReflectionObjectInspector(MyRow.class,ObjectInspectorFactory.ObjectInspectorOptions.JAVA);
  }
  JobConf conf=createMockExecutionEnvironment(workDir,new Path("mock:///"),"vectorBuckets",inspector,true,1);
  Writer writer=OrcFile.createWriter(new Path(conf.get("mapred.input.dir") + "/0_0"),OrcFile.writerOptions(conf).blockPadding(false).bufferSize(1024).inspector(inspector));
  for (int i=0; i < 10; ++i) {
    writer.addRow(new MyRow(i,2 * i));
  }
  writer.close();
  ((MockOutputStream)((WriterImpl)writer).getStream()).setBlocks(new MockBlock("host0","host1"));
  conf.setInt(hive_metastoreConstants.BUCKET_COUNT,3);
  HiveInputFormat<?,?> inputFormat=new HiveInputFormat<WritableComparable,Writable>();
  InputSplit[] splits=inputFormat.getSplits(conf,10);
  assertEquals(1,splits.length);
  org.apache.hadoop.mapred.RecordReader<NullWritable,VectorizedRowBatch> reader=inputFormat.getRecordReader(splits[0],conf,Reporter.NULL);
  NullWritable key=reader.createKey();
  VectorizedRowBatch value=reader.createValue();
  assertEquals(true,reader.next(key,value));
  assertEquals(10,value.count());
  LongColumnVector col0=(LongColumnVector)value.cols[0];
  for (int i=0; i < 10; i++) {
    assertEquals("checking " + i,i,col0.vector[i]);
  }
  assertEquals(false,reader.next(key,value));
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
