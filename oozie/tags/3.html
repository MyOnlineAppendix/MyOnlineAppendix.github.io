<h3><span class=" glyphicon glyphicon-tag"/>&nbspAPIUtilityVerifier</h3><kbd>Verifies values of objects/variables related to API calls (Java or TPL) </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.oozie.action.hadoop.TestFSPrepareActions </h4><pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testForInvalidScheme() throws Exception {
  Path actionDir=getFsTestCaseDir();
  Path newDir=new Path("hftp:/" + actionDir.toString().substring(5) + "/delete");
  String prepareXML="<prepare>" + "<delete path='" + newDir + "'/>"+ "</prepare>";
  Document doc=PrepareActionsDriver.getDocumentFromXML(prepareXML);
  Node n=doc.getDocumentElement().getChildNodes().item(0);
  try {
    JobConf conf=createJobConf();
    LauncherMapperHelper.setupLauncherURIHandlerConf(conf);
    PrepareActionsDriver.doOperations(prepareXML,conf);
    fail("Expected to catch an exception but did not encounter any");
  }
 catch (  LauncherException le) {
    Path path=new Path(n.getAttributes().getNamedItem("path").getNodeValue().trim());
    assertEquals("Scheme hftp not supported in uri " + path,le.getMessage());
  }
catch (  Exception ex) {
    fail("Expected a LauncherException but received an Exception");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.action.hadoop.TestJavaActionExecutor </h4><pre class="type-3 type-4 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddActionShareLib() throws Exception {
  WorkflowAppService wps=Services.get().get(WorkflowAppService.class);
  Path systemLibPath=new Path(wps.getSystemLibPath(),ShareLibService.SHARE_LIB_PREFIX + new SimpleDateFormat("yyyyMMddHHmmss").format(new Date()).toString());
  Path javaShareLibPath=new Path(systemLibPath,"java");
  getFileSystem().mkdirs(javaShareLibPath);
  Path jar1Path=new Path(javaShareLibPath,"jar1.jar");
  getFileSystem().create(jar1Path).close();
  Path jar2Path=new Path(javaShareLibPath,"jar2.jar");
  getFileSystem().create(jar2Path).close();
  Path hcatShareLibPath=new Path(systemLibPath,"hcat");
  getFileSystem().mkdirs(hcatShareLibPath);
  Path jar3Path=new Path(hcatShareLibPath,"jar3.jar");
  getFileSystem().create(jar3Path).close();
  Path jar4Path=new Path(hcatShareLibPath,"jar4.jar");
  getFileSystem().create(jar4Path).close();
  Path otherShareLibPath=new Path(systemLibPath,"other");
  getFileSystem().mkdirs(otherShareLibPath);
  Path jar5Path=new Path(otherShareLibPath,"jar5.jar");
  getFileSystem().create(jar5Path).close();
  String actionXml="<java>" + "<job-tracker>" + getJobTrackerUri() + "</job-tracker>"+ "<name-node>"+ getNameNodeUri()+ "</name-node>"+ "<job-xml>job.xml</job-xml>"+ "<job-xml>job2.xml</job-xml>"+ "<main-class>MAIN-CLASS</main-class>"+ "</java>";
  Element eActionXml=XmlUtils.parseXml(actionXml);
  Context context=createContext(actionXml,null);
  Services.get().setService(ShareLibService.class);
  WorkflowJobBean workflow=(WorkflowJobBean)context.getWorkflow();
  XConfiguration wfConf=new XConfiguration();
  wfConf.set(WorkflowAppService.HADOOP_USER,getTestUser());
  wfConf.set(OozieClient.APP_PATH,new Path(getAppPath(),"workflow.xml").toString());
  wfConf.setBoolean(OozieClient.USE_SYSTEM_LIBPATH,true);
  workflow.setConf(XmlUtils.prettyPrint(wfConf).toString());
  ConfigurationService.set("oozie.action.sharelib.for.java","java,hcat");
  JavaActionExecutor ae=new JavaActionExecutor();
  Configuration jobConf=ae.createBaseHadoopConf(context,eActionXml);
  ae.setupLauncherConf(jobConf,eActionXml,getAppPath(),context);
  try {
    ae.setLibFilesArchives(context,eActionXml,getAppPath(),jobConf);
    fail();
  }
 catch (  ActionExecutorException aee) {
    assertEquals("EJ001",aee.getErrorCode());
    assertEquals("Could not locate Oozie sharelib",aee.getMessage());
  }
  Path launcherPath=new Path(systemLibPath,"oozie");
  getFileSystem().mkdirs(launcherPath);
  Path jar6Path=new Path(launcherPath,"jar6.jar");
  getFileSystem().create(jar6Path).close();
  Services.get().get(ShareLibService.class).updateShareLib();
  ae.setLibFilesArchives(context,eActionXml,getAppPath(),jobConf);
  URI[] cacheFiles=DistributedCache.getCacheFiles(jobConf);
  String cacheFilesStr=Arrays.toString(cacheFiles);
  assertTrue(cacheFilesStr.contains(jar1Path.toString()));
  assertTrue(cacheFilesStr.contains(jar2Path.toString()));
  assertTrue(cacheFilesStr.contains(jar3Path.toString()));
  assertTrue(cacheFilesStr.contains(jar4Path.toString()));
  assertFalse(cacheFilesStr.contains(jar5Path.toString()));
  assertTrue(cacheFilesStr.contains(jar6Path.toString()));
  workflow=(WorkflowJobBean)context.getWorkflow();
  wfConf=new XConfiguration();
  wfConf.set(WorkflowAppService.HADOOP_USER,getTestUser());
  wfConf.set(OozieClient.APP_PATH,new Path(getAppPath(),"workflow.xml").toString());
  wfConf.setBoolean(OozieClient.USE_SYSTEM_LIBPATH,true);
  wfConf.set("oozie.action.sharelib.for.java","other,hcat");
  workflow.setConf(XmlUtils.prettyPrint(wfConf).toString());
  ConfigurationService.set("oozie.action.sharelib.for.java","java");
  ae=new JavaActionExecutor();
  jobConf=ae.createBaseHadoopConf(context,eActionXml);
  ae.setupLauncherConf(jobConf,eActionXml,getAppPath(),context);
  ae.setLibFilesArchives(context,eActionXml,getAppPath(),jobConf);
  cacheFiles=DistributedCache.getCacheFiles(jobConf);
  cacheFilesStr=Arrays.toString(cacheFiles);
  assertFalse(cacheFilesStr.contains(jar1Path.toString()));
  assertFalse(cacheFilesStr.contains(jar2Path.toString()));
  assertTrue(cacheFilesStr.contains(jar3Path.toString()));
  assertTrue(cacheFilesStr.contains(jar4Path.toString()));
  assertTrue(cacheFilesStr.contains(jar5Path.toString()));
  assertTrue(cacheFilesStr.contains(jar6Path.toString()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.action.hadoop.TestLauncherHCatURIHandler </h4><pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDelete() throws Exception {
  createTestTable();
  String location1=getPartitionDir(db,table,"year=2012;month=12;dt=02;country=us");
  String location2=getPartitionDir(db,table,"year=2012;month=12;dt=03;country=us");
  createPartitionForTestDelete(true,true);
  URI hcatURI=getHCatURI(db,table,"year=2012;month=12;dt=02;country=us");
  URIHandler uriHandler=uriService.getURIHandler(hcatURI);
  assertTrue(uriHandler.exists(hcatURI,conf,getTestUser()));
  LauncherURIHandlerFactory uriHandlerFactory=new LauncherURIHandlerFactory(uriService.getLauncherConfig());
  LauncherURIHandler handler=uriHandlerFactory.getURIHandler(hcatURI);
  handler.delete(hcatURI,conf);
  assertFalse(getFileSystem().exists(new Path(location1)));
  assertTrue(getFileSystem().exists(new Path(location2)));
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=02;country=us").size());
  assertEquals(1,getPartitions(db,table,"year=2012;month=12;dt=03;country=us").size());
  createPartitionForTestDelete(true,false);
  hcatURI=getHCatURI(db,table,"year=2012;month=12");
  handler.delete(hcatURI,conf);
  assertFalse(getFileSystem().exists(new Path(location1)));
  assertFalse(getFileSystem().exists(new Path(location2)));
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=02;country=us").size());
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=03;country=us").size());
  createPartitionForTestDelete(true,true);
  hcatURI=getHCatURI(db,table,"month=12;country=us");
  handler.delete(hcatURI,conf);
  assertFalse(getFileSystem().exists(new Path(location1)));
  assertFalse(getFileSystem().exists(new Path(location2)));
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=02;country=us").size());
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=03;country=us").size());
  createPartitionForTestDelete(true,true);
  hcatURI=getHCatURI(db,table,"country=us");
  handler.delete(hcatURI,conf);
  assertFalse(getFileSystem().exists(new Path(location1)));
  assertFalse(getFileSystem().exists(new Path(location2)));
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=02;country=us").size());
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=03;country=us").size());
  createPartitionForTestDelete(true,true);
  hcatURI=getHCatURI(db,table,"dt=03");
  handler.delete(hcatURI,conf);
  assertTrue(getFileSystem().exists(new Path(location1)));
  assertFalse(getFileSystem().exists(new Path(location2)));
  assertEquals(1,getPartitions(db,table,"year=2012;month=12;dt=02;country=us").size());
  assertEquals(0,getPartitions(db,table,"year=2012;month=12;dt=03;country=us").size());
  createPartitionForTestDelete(false,true);
  hcatURI=getHCatURI(db,table,"dt=09");
  handler.delete(hcatURI,conf);
  assertTrue(getFileSystem().exists(new Path(location1)));
  assertTrue(getFileSystem().exists(new Path(location2)));
  assertEquals(1,getPartitions(db,table,"year=2012;month=12;dt=02;country=us").size());
  assertEquals(1,getPartitions(db,table,"year=2012;month=12;dt=03;country=us").size());
  dropTestTable();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.command.coord.TestCoordActionUpdatePushMissingDependency </h4><pre class="type-3 type-1 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateCoordTableBasic() throws Exception {
  String newHCatDependency="hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us";
  HCatURI hcatUri=new HCatURI(newHCatDependency);
  String actionId=addInitRecords(newHCatDependency);
  checkCoordAction(actionId,newHCatDependency,CoordinatorAction.Status.WAITING);
  PartitionDependencyManagerService pdms=Services.get().get(PartitionDependencyManagerService.class);
  pdms.addMissingDependency(hcatUri,actionId);
  pdms.partitionAvailable("hcat.server.com:5080","mydb","clicks",getPartitionMap("src=search;datastamp=12;region=us"));
  Collection<String> availableURIs=pdms.getAvailableDependencyURIs(actionId);
  assertEquals(availableURIs.size(),1);
  assertTrue(availableURIs.contains(newHCatDependency));
  new CoordActionUpdatePushMissingDependency(actionId).call();
  checkCoordAction(actionId,"",CoordinatorAction.Status.READY);
  assertNull(pdms.getAvailableDependencyURIs(actionId));
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateCoordTableAdvanced() throws Exception {
  String newHCatDependency1="hcat://hcat.server.com:5080/mydb/clicks/datastamp=11;region=us";
  String newHCatDependency2="hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us";
  HCatURI hcatUri1=new HCatURI(newHCatDependency1);
  HCatURI hcatUri2=new HCatURI(newHCatDependency2);
  String fullDeps=newHCatDependency1 + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency2;
  String actionId=addInitRecords(fullDeps);
  checkCoordAction(actionId,fullDeps,CoordinatorAction.Status.WAITING);
  PartitionDependencyManagerService pdms=Services.get().get(PartitionDependencyManagerService.class);
  pdms.addMissingDependency(hcatUri1,actionId);
  pdms.addMissingDependency(hcatUri2,actionId);
  pdms.partitionAvailable("hcat.server.com:5080","mydb","clicks",getPartitionMap("src=search;datastamp=12;region=us"));
  Collection<String> availableURIs=pdms.getAvailableDependencyURIs(actionId);
  assertEquals(1,availableURIs.size());
  assertTrue(availableURIs.contains(newHCatDependency2));
  new CoordActionUpdatePushMissingDependency(actionId).call();
  checkCoordAction(actionId,newHCatDependency1,CoordinatorAction.Status.WAITING);
  pdms.partitionAvailable("hcat.server.com:5080","mydb","clicks",getPartitionMap("src=search;datastamp=11;region=us"));
  availableURIs=pdms.getAvailableDependencyURIs(actionId);
  assertEquals(1,availableURIs.size());
  assertTrue(availableURIs.contains(newHCatDependency1));
  new CoordActionUpdatePushMissingDependency(actionId).call();
  checkCoordAction(actionId,"",CoordinatorAction.Status.READY);
  assertNull(pdms.getAvailableDependencyURIs(actionId));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.command.coord.TestCoordCommandUtils </h4><pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDryRunPullDeps(){
  try {
    CoordinatorJobBean job=addRecordToCoordJobTableForWaiting("coord-job-for-matd-hcat.xml",CoordinatorJob.Status.RUNNING,false,true);
    Path appPath=new Path(getFsTestCaseDir(),"coord");
    String actionXml=getCoordActionXml(appPath,"coord-action-for-action-input-check.xml");
    CoordinatorActionBean actionBean=createCoordinatorActionBean(job);
    String testDir=getTestCaseDir();
    String missDeps=getPullMissingDependencies(testDir);
    actionBean.setMissingDependencies(missDeps);
    Element eAction=createActionElement(actionXml);
    String newactionXml=CoordCommandUtils.dryRunCoord(eAction,actionBean);
    eAction=XmlUtils.parseXml(newactionXml);
    Element configElem=eAction.getChild("action",eAction.getNamespace()).getChild("workflow",eAction.getNamespace()).getChild("configuration",eAction.getNamespace());
    List<?> elementList=configElem.getChildren("property",configElem.getNamespace());
    Element e1=(Element)elementList.get(0);
    Element e2=(Element)elementList.get(1);
    assertEquals("${coord:dataIn('A')}",e1.getChild("value",e1.getNamespace()).getValue());
    assertEquals("${coord:dataOut('LOCAL_A')}",e2.getChild("value",e2.getNamespace()).getValue());
    createDir(testDir + "/2009/29/");
    createDir(testDir + "/2009/22/");
    createDir(testDir + "/2009/15/");
    createDir(testDir + "/2009/08/");
    sleep(1000);
    newactionXml=CoordCommandUtils.dryRunCoord(eAction,actionBean);
    eAction=XmlUtils.parseXml(newactionXml);
    configElem=eAction.getChild("action",eAction.getNamespace()).getChild("workflow",eAction.getNamespace()).getChild("configuration",eAction.getNamespace());
    elementList=configElem.getChildren("property",configElem.getNamespace());
    e1=(Element)elementList.get(0);
    e2=(Element)elementList.get(1);
    assertEquals("file://,testDir/2009/29,file://,testDir/2009/22,file://,testDir/2009/15,file://,testDir/2009/08",e1.getChild("value",e1.getNamespace()).getValue());
    assertEquals("file://,testDir/2009/29",e2.getChild("value",e1.getNamespace()).getValue());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCoordOffset() throws Exception {
  CoordinatorJobBean job=addRecordToCoordJobTableForWaiting("coord-dataset-offset.xml",CoordinatorJob.Status.RUNNING,false,true);
  Path appPath=new Path(getFsTestCaseDir(),"coord");
  String actionXml=getCoordActionXml(appPath,"coord-dataset-offset.xml");
  actionXml=actionXml.replace("-unit-","DAY");
  actionXml=actionXml.replace("-frequency-","1");
  CoordinatorActionBean actionBean=createCoordinatorActionBean(job);
  Configuration jobConf=new XConfiguration(new StringReader(job.getConf()));
  Element eAction=createActionElement(actionXml);
  jobConf.set("startInstance","coord:offset(-4,DAY)");
  jobConf.set("endInstance","coord:offset(0,DAY)");
  String output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-08-20T10:00Z"),DateUtils.parseDateOozieTZ("2009-08-20T10:00Z"),1,jobConf,actionBean);
  eAction=XmlUtils.parseXml(output);
  Element e=(Element)((Element)eAction.getChildren("input-events",eAction.getNamespace()).get(0)).getChildren().get(0);
  assertEquals(e.getChild("uris",e.getNamespace()).getTextTrim(),"hdfs:///tmp/workflows/2009/08/20/01;region=us#hdfs:///tmp/workflows/2009/08/19/01;region=us#" + "hdfs:///tmp/workflows/2009/08/18/01;region=us#hdfs:///tmp/workflows/2009/08/17/01;" + "region=us#hdfs:///tmp/workflows/2009/08/16/01;region=us");
  jobConf.set("startInstance","coord:offset(-4,HOUR)");
  jobConf.set("endInstance","coord:offset(0,HOUR)");
  actionXml=getCoordActionXml(appPath,"coord-dataset-offset.xml");
  actionXml=actionXml.replace("-unit-","MINUTE");
  actionXml=actionXml.replace("-frequency-","60");
  eAction=createActionElement(actionXml);
  output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-08-20T01:00Z"),DateUtils.parseDateOozieTZ("2009-08-20T01:00Z"),1,jobConf,actionBean);
  eAction=XmlUtils.parseXml(output);
  e=(Element)((Element)eAction.getChildren("input-events",eAction.getNamespace()).get(0)).getChildren().get(0);
  assertEquals(e.getChild("uris",e.getNamespace()).getTextTrim(),"hdfs:///tmp/workflows/2009/08/20/01;region=us#hdfs:///tmp/workflows/2009/08/20/00;region=us#" + "hdfs:///tmp/workflows/2009/08/19/23;region=us#hdfs:///tmp/workflows/2009/08/19/22;region=us#" + "hdfs:///tmp/workflows/2009/08/19/21;region=us");
}

</code></pre>

<br>
<pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDryRunPushDependencies(){
  try {
    CoordinatorJobBean job=addRecordToCoordJobTableForWaiting("coord-job-for-action-input-check.xml",CoordinatorJob.Status.RUNNING,false,true);
    Path appPath=new Path(getFsTestCaseDir(),"coord");
    String actionXml=getCoordActionXml(appPath,"coord-action-for-action-input-check.xml");
    CoordinatorActionBean actionBean=createCoordinatorActionBean(job);
    String db="default";
    String table="tablename";
    String hcatDependency=getPushMissingDependencies(db,table);
    actionBean.setPushMissingDependencies(hcatDependency);
    Element eAction=createActionElement(actionXml);
    String newactionXml=CoordCommandUtils.dryRunCoord(eAction,actionBean);
    eAction=XmlUtils.parseXml(newactionXml);
    Element configElem=eAction.getChild("action",eAction.getNamespace()).getChild("workflow",eAction.getNamespace()).getChild("configuration",eAction.getNamespace());
    List<?> elementList=configElem.getChildren("property",configElem.getNamespace());
    Element e1=(Element)elementList.get(0);
    Element e2=(Element)elementList.get(1);
    assertEquals("${coord:dataIn('A')}",e1.getChild("value",e1.getNamespace()).getValue());
    assertEquals("${coord:dataOut('LOCAL_A')}",e2.getChild("value",e2.getNamespace()).getValue());
    populateTable(db,table);
    newactionXml=CoordCommandUtils.dryRunCoord(eAction,actionBean);
    eAction=XmlUtils.parseXml(newactionXml);
    configElem=eAction.getChild("action",eAction.getNamespace()).getChild("workflow",eAction.getNamespace()).getChild("configuration",eAction.getNamespace());
    elementList=configElem.getChildren("property",configElem.getNamespace());
    e1=(Element)elementList.get(0);
    e2=(Element)elementList.get(1);
    assertEquals("file://,testDir/2009/29,file://,testDir/2009/22,file://,testDir/2009/15,file://,testDir/2009/08",e1.getChild("value",e1.getNamespace()).getValue());
    assertEquals("file://,testDir/2009/29",e2.getChild("value",e1.getNamespace()).getValue());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDryRunPullAndPushDeps(){
  try {
    CoordinatorJobBean job=addRecordToCoordJobTableForWaiting("coord-job-for-matd-hcat.xml",CoordinatorJob.Status.RUNNING,false,true);
    Path appPath=new Path(getFsTestCaseDir(),"coord");
    String actionXml=getCoordActionXml(appPath,"coord-action-for-action-input-check.xml");
    CoordinatorActionBean actionBean=createCoordinatorActionBean(job);
    String testDir=getTestCaseDir();
    String missDeps=getPullMissingDependencies(testDir);
    actionBean.setMissingDependencies(missDeps);
    String db="default";
    String table="tablename";
    String hcatDependency=getPushMissingDependencies(db,table);
    actionBean.setPushMissingDependencies(hcatDependency);
    createDir(getTestCaseDir() + "/2009/29/");
    createDir(getTestCaseDir() + "/2009/22/");
    createDir(getTestCaseDir() + "/2009/15/");
    createDir(getTestCaseDir() + "/2009/08/");
    sleep(1000);
    Element eAction=createActionElement(actionXml);
    String newactionXml=CoordCommandUtils.dryRunCoord(eAction,actionBean);
    eAction=XmlUtils.parseXml(newactionXml);
    Element configElem=eAction.getChild("action",eAction.getNamespace()).getChild("workflow",eAction.getNamespace()).getChild("configuration",eAction.getNamespace());
    List<?> elementList=configElem.getChildren("property",configElem.getNamespace());
    Element e1=(Element)elementList.get(0);
    Element e2=(Element)elementList.get(1);
    assertEquals("${coord:dataIn('A')}",e1.getChild("value",e1.getNamespace()).getValue());
    assertEquals("${coord:dataOut('LOCAL_A')}",e2.getChild("value",e2.getNamespace()).getValue());
    populateTable(db,table);
    newactionXml=CoordCommandUtils.dryRunCoord(eAction,actionBean);
    eAction=XmlUtils.parseXml(newactionXml);
    configElem=eAction.getChild("action",eAction.getNamespace()).getChild("workflow",eAction.getNamespace()).getChild("configuration",eAction.getNamespace());
    elementList=configElem.getChildren("property",configElem.getNamespace());
    e1=(Element)elementList.get(0);
    e2=(Element)elementList.get(1);
    assertEquals("file://,testDir/2009/29,file://,testDir/2009/22,file://,testDir/2009/15,file://,testDir/2009/08",e1.getChild("value",e1.getNamespace()).getValue());
    assertEquals("file://,testDir/2009/29",e2.getChild("value",e1.getNamespace()).getValue());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCoordAbsolute() throws Exception {
  CoordinatorJobBean job=addRecordToCoordJobTableForWaiting("coord-dataset-absolute.xml",CoordinatorJob.Status.RUNNING,false,true);
  Path appPath=new Path(getFsTestCaseDir(),"coord");
  String actionXml=getCoordActionXml(appPath,"coord-dataset-absolute.xml");
  CoordinatorActionBean actionBean=createCoordinatorActionBean(job);
  Configuration jobConf=new XConfiguration(new StringReader(job.getConf()));
  Element eAction=createActionElement(actionXml);
  jobConf.set("startInstance","coord:absolute(2009-08-20T01:00Z)");
  jobConf.set("endInstance","coord:current(2)");
  String output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-08-20T01:00Z"),DateUtils.parseDateOozieTZ("2009-08-20T01:00Z"),1,jobConf,actionBean);
  eAction=XmlUtils.parseXml(output);
  List<?> elementList=((Element)eAction.getChildren("input-events",eAction.getNamespace()).get(0)).getChildren();
  Element e1=(Element)elementList.get(0);
  Element e2=(Element)elementList.get(1);
  assertEquals(e1.getChild("uris",e1.getNamespace()).getTextTrim(),"hdfs:///tmp/workflows/2009/09/03;region=us#hdfs:///tmp/workflows/2009/08/27;" + "region=us#hdfs:///tmp/workflows/2009/08/20;region=us");
  assertEquals(e2.getChild("uris",e1.getNamespace()).getTextTrim(),"hdfs:///tmp/workflows/2009/09/03;region=us#hdfs:///tmp/workflows/2009/08/27;" + "region=us#hdfs:///tmp/workflows/2009/08/20;region=us");
  jobConf.set("startInstance","coord:absolute(2009-08-20T01:00Z)");
  jobConf.set("endInstance","coord:current(2)");
  eAction=createActionElement(actionXml);
  output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-09-10T01:00Z"),DateUtils.parseDateOozieTZ("2009-09-08T01:00Z"),1,jobConf,actionBean);
  eAction=XmlUtils.parseXml(output);
  elementList=((Element)eAction.getChildren("input-events",eAction.getNamespace()).get(0)).getChildren();
  e1=(Element)elementList.get(1);
  assertEquals(e1.getChild("uris",e1.getNamespace()).getTextTrim(),"hdfs:///tmp/workflows/2009/09/24;region=us#hdfs:///tmp/workflows/2009/09/17;region=us#" + "hdfs:///tmp/workflows/2009/09/10;region=us#hdfs:///tmp/workflows/2009/09/03;region=us#" + "hdfs:///tmp/workflows/2009/08/27;region=us#hdfs:///tmp/workflows/2009/08/20;region=us");
  jobConf.set("startInstance","coord:absolute(2009-08-20T01:00Z)");
  jobConf.set("endInstance","coord:current(2)");
  eAction=createActionElement(actionXml);
  output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-08-14T01:00Z"),DateUtils.parseDateOozieTZ("2009-08-14T01:00Z"),1,jobConf,actionBean);
  eAction=XmlUtils.parseXml(output);
  elementList=((Element)eAction.getChildren("input-events",eAction.getNamespace()).get(0)).getChildren();
  e1=(Element)elementList.get(1);
  assertEquals(e1.getChild("uris",e1.getNamespace()).getTextTrim(),"hdfs:///tmp/workflows/2009/08/27;region=us#hdfs:///tmp/workflows/2009/08/20;region=us");
  try {
    jobConf.set("startInstance","coord:absolute(2009-08-27T01:00Z)");
    jobConf.set("endInstance","coord:current(2)");
    eAction=createActionElement(actionXml);
    output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-08-06T01:00Z"),DateUtils.parseDateOozieTZ("2009-08-16T01:00Z"),1,jobConf,actionBean);
    eAction=XmlUtils.parseXml(output);
    fail("Should throw exception. Start-instance > end-instance ");
  }
 catch (  Exception e) {
    assertTrue(e.getCause().getMessage().contains("start-instance should be equal or earlier than the end-instance"));
  }
  try {
    jobConf.set("startInstance","coord:absolute(2009-07-01T01:00Z)");
    jobConf.set("endInstance","coord:current(2)");
    eAction=createActionElement(actionXml);
    output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-08-06T01:00Z"),DateUtils.parseDateOozieTZ("2009-08-16T01:00Z"),1,jobConf,actionBean);
    eAction=XmlUtils.parseXml(output);
    fail("Should throw exception. Start-instance > end-instance ");
  }
 catch (  Exception e) {
    assertTrue(e.getCause().getMessage().contains("intial-instance should be equal or earlier than the start-instance"));
  }
  try {
    jobConf.set("startInstance","coord:absolute(2009-08-20T01:00Z)");
    jobConf.set("endInstance","coord:latest(2)");
    eAction=createActionElement(actionXml);
    output=CoordCommandUtils.materializeOneInstance("jobId",true,eAction,DateUtils.parseDateOozieTZ("2009-08-20T01:00Z"),DateUtils.parseDateOozieTZ("2009-08-20T01:00Z"),1,jobConf,actionBean);
    eAction=XmlUtils.parseXml(output);
    fail("Should throw exception. Start-instance is absolute and end-instance is latest");
  }
 catch (  Exception e) {
    assertTrue(e.getMessage().contains("Only start-instance as absolute and end-instance as current is supported"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.command.coord.TestCoordPushDependencyCheckXCommand </h4><pre class="type-3 type-4 type-1 type-2 type-8 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimeOutWithException2() throws Exception {
  String db="default";
  String table="tablename";
  String newHCatDependency1="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=brazil";
  String newHCatDependency2="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=usa";
  String newHCatDependency=newHCatDependency1 + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency2;
  populateTable(db,table);
  String actionId=addInitRecords(newHCatDependency);
  checkCoordAction(actionId,newHCatDependency,CoordinatorAction.Status.WAITING);
  new CoordPushDependencyCheckXCommand(actionId,true).call();
  checkCoordAction(actionId,newHCatDependency1,CoordinatorAction.Status.WAITING);
  PartitionDependencyManagerService pdms=Services.get().get(PartitionDependencyManagerService.class);
  HCatAccessorService hcatService=Services.get().get(HCatAccessorService.class);
  assertTrue(pdms.getWaitingActions(new HCatURI(newHCatDependency1)).contains(actionId));
  assertTrue(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
  long timeOutCreationTime=System.currentTimeMillis() - (12 * 60 * 1000);
  setCoordActionCreationTime(actionId,timeOutCreationTime);
  dropTable(db,table,true);
  try {
    new CoordPushDependencyCheckXCommand(actionId).call();
    fail();
  }
 catch (  Exception e) {
    assertTrue(e.getMessage().contains("NoSuchObjectException"));
  }
  Thread.sleep(100);
  checkCoordAction(actionId,newHCatDependency1,CoordinatorAction.Status.TIMEDOUT);
  assertNull(pdms.getWaitingActions(new HCatURI(newHCatDependency1)));
  assertFalse(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-8 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimeOut() throws Exception {
  String db="default";
  String table="tablename";
  String newHCatDependency1="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=brazil";
  String newHCatDependency2="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=usa";
  String newHCatDependency=newHCatDependency1 + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency2;
  populateTable(db,table);
  String actionId=addInitRecords(newHCatDependency);
  checkCoordAction(actionId,newHCatDependency,CoordinatorAction.Status.WAITING);
  new CoordPushDependencyCheckXCommand(actionId,true).call();
  checkCoordAction(actionId,newHCatDependency1,CoordinatorAction.Status.WAITING);
  PartitionDependencyManagerService pdms=Services.get().get(PartitionDependencyManagerService.class);
  HCatAccessorService hcatService=Services.get().get(HCatAccessorService.class);
  assertTrue(pdms.getWaitingActions(new HCatURI(newHCatDependency1)).contains(actionId));
  assertTrue(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
  long timeOutCreationTime=System.currentTimeMillis() - (12 * 60 * 1000);
  setCoordActionCreationTime(actionId,timeOutCreationTime);
  new CoordPushDependencyCheckXCommand(actionId).call();
  Thread.sleep(100);
  checkCoordAction(actionId,newHCatDependency1,CoordinatorAction.Status.TIMEDOUT);
  assertNull(pdms.getWaitingActions(new HCatURI(newHCatDependency1)));
  assertFalse(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
}

</code></pre>

<br>
<pre class="type-3 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testLogMessagePrefix() throws Exception {
  Logger logger=Logger.getLogger(DependencyChecker.class);
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  Layout layout=new SimpleLayout();
  Appender appender=new WriterAppender(layout,out);
  logger.addAppender(appender);
  String db="default";
  String table="tablename";
  populateTable(db,table);
  String newHCatDependency="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=brazil";
  String actionId1=addInitRecords(newHCatDependency);
  new CoordPushDependencyCheckXCommand(actionId1).call();
  assertTrue(out.toString().contains("ACTION[" + actionId1 + "]"));
  out.reset();
  String actionId2=addInitRecords(newHCatDependency);
  new CoordPushDependencyCheckXCommand(actionId2).call();
  assertFalse(out.toString().contains("ACTION[" + actionId1 + "]"));
  assertTrue(out.toString().contains("ACTION[" + actionId2 + "]"));
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-8 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateCoordTableMultipleDepsV3() throws Exception {
  String db="default";
  String table="tablename";
  String newHCatDependency1="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=brazil";
  String newHCatDependency2="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=usa";
  String newHCatDependency=newHCatDependency1 + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency2;
  populateTable(db,table);
  String actionId=addInitRecords(newHCatDependency);
  checkCoordAction(actionId,newHCatDependency,CoordinatorAction.Status.WAITING);
  new CoordPushDependencyCheckXCommand(actionId,true).call();
  checkCoordAction(actionId,newHCatDependency1,CoordinatorAction.Status.WAITING);
  PartitionDependencyManagerService pdms=Services.get().get(PartitionDependencyManagerService.class);
  HCatAccessorService hcatService=Services.get().get(HCatAccessorService.class);
  assertTrue(pdms.getWaitingActions(new HCatURI(newHCatDependency1)).contains(actionId));
  assertTrue(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
  assertNull(pdms.getWaitingActions(new HCatURI(newHCatDependency2)));
  addPartition(db,table,"dt=20120430;country=brazil");
  new CoordPushDependencyCheckXCommand(actionId).call();
  checkCoordAction(actionId,"",CoordinatorAction.Status.READY);
  assertNull(pdms.getWaitingActions(new HCatURI(newHCatDependency1)));
  assertFalse(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testResolveCoordConfiguration() throws Exception {
  String db="default";
  String table="tablename";
  String newHCatDependency1="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120412;country=brazil";
  String newHCatDependency2="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=usa";
  String newHCatDependency=newHCatDependency1 + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency2;
  populateTable(db,table);
  CoordinatorJobBean job=addRecordToCoordJobTableForWaiting("coord-job-for-action-input-check.xml",CoordinatorJob.Status.RUNNING,false,true);
  CoordinatorActionBean action=addRecordToCoordActionTableForWaiting(job.getId(),1,CoordinatorAction.Status.WAITING,"coord-action-for-action-push-check.xml",null,newHCatDependency,"Z");
  String actionId=action.getId();
  checkCoordAction(actionId,newHCatDependency,CoordinatorAction.Status.WAITING);
  new CoordPushDependencyCheckXCommand(actionId).call();
  CoordinatorActionBean caBean=checkCoordAction(actionId,"",CoordinatorAction.Status.READY);
  Element eAction=XmlUtils.parseXml(caBean.getActionXml());
  Element configElem=eAction.getChild("action",eAction.getNamespace()).getChild("workflow",eAction.getNamespace()).getChild("configuration",eAction.getNamespace());
  List<?> elementList=configElem.getChildren("property",configElem.getNamespace());
  Element e1=(Element)elementList.get(0);
  Element e2=(Element)elementList.get(1);
  assertEquals("hcat://dummyhcat:1000/db1/table1/ds=/2009-29,hcat://dummyhcat:1000/db1/table1/ds=/2009-29," + "hcat://dummyhcat:1000/db1/table1/ds=/2009-29",e1.getChild("value",e1.getNamespace()).getValue());
  assertEquals("hcat://dummyhcat:1000/db1/table1/ds=/2009-29",e2.getChild("value",e1.getNamespace()).getValue());
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-8 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimeOutWithUnresolvedMissingDependencies() throws Exception {
  String db="default";
  String table="tablename";
  String newHCatDependency1="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=brazil";
  String newHCatDependency2="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=usa";
  String newHCatDependency3="hcat://" + server + "/"+ db+ "/"+ table+ "/dt=20120430;country=uk";
  String newHCatDependency=newHCatDependency1 + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency2;
  populateTable(db,table);
  String actionId=addInitRecords(newHCatDependency);
  checkCoordAction(actionId,newHCatDependency,CoordinatorAction.Status.WAITING);
  new CoordPushDependencyCheckXCommand(actionId,true).call();
  checkCoordAction(actionId,newHCatDependency1,CoordinatorAction.Status.WAITING);
  PartitionDependencyManagerService pdms=Services.get().get(PartitionDependencyManagerService.class);
  HCatAccessorService hcatService=Services.get().get(HCatAccessorService.class);
  assertTrue(pdms.getWaitingActions(new HCatURI(newHCatDependency1)).contains(actionId));
  assertTrue(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
  long timeOutCreationTime=System.currentTimeMillis() - (12 * 60 * 1000);
  setCoordActionCreationTime(actionId,timeOutCreationTime);
  setMissingDependencies(actionId,newHCatDependency + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency3);
  addPartition(db,table,"dt=20120430;country=brazil");
  checkDependencies(actionId,newHCatDependency + CoordELFunctions.INSTANCE_SEPARATOR + newHCatDependency3,newHCatDependency1);
  new CoordPushDependencyCheckXCommand(actionId).call();
  Thread.sleep(1300);
  checkDependencies(actionId,newHCatDependency3,"");
  assertNull(pdms.getWaitingActions(new HCatURI(newHCatDependency1)));
  assertFalse(hcatService.isRegisteredForNotification(new HCatURI(newHCatDependency1)));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.compression.TestCodecFactory </h4><pre class="type-3 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCompression() throws IOException {
  byte[] headerBytes=CodecFactory.getHeaderBytes();
  byte[] compressedBytes=CodecFactory.getCompressionCodec().compressString(headerBytes,"dummmmyyyy");
  DataInputStream dais=new DataInputStream(new ByteArrayInputStream(compressedBytes));
  String uncompressed=CodecFactory.getDeCompressionCodec(dais).decompressToString(dais);
  assertEquals("dummmmyyyy",uncompressed);
  dais.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.coord.TestHCatELFunctions </h4><pre class="type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test dataInPartitionMax EL function (phase 3) which returns the maximum
 * value of a partition to be used as maximum in a range of input data to
 * load
 * @throws Exception
 */
@Test public void testDataInPartitionMax() throws Exception {
  init("coord-action-start");
  eval.setVariable(".datain.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=20;region=us," + "hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us," + "hcat://hcat.server.com:5080/mydb/clicks/datastamp=13;region=us,"+ "hcat://hcat.server.com:5080/mydb/clicks/datastamp=10;region=us");
  eval.setVariable(".datain.ABC.unresolved",Boolean.FALSE);
  String expr="${coord:dataInPartitionMax('ABC','datastamp')}";
  String res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("20"));
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test dataOutPartitionsPig EL function (phase 3) which returns the partition
 * to be used as output to store data into
 * @throws Exception
 */
@Test public void testDataOutPartitions() throws Exception {
  init("coord-action-start");
  String expr="${coord:dataOutPartitions('ABC')}";
  eval.setVariable(".dataout.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=20120230;region=us");
  eval.setVariable(".dataout.ABC.unresolved",Boolean.FALSE);
  String res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("'datastamp=20120230,region=us'"));
  init("coord-sla-create");
  eval.setVariable(".dataout.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=20130230;region=euro");
  eval.setVariable(".dataout.ABC.unresolved",Boolean.FALSE);
  res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("'datastamp=20130230,region=us'") || res.equals("'datastamp=20130230,region=euro'"));
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test dataOutPartitionValue EL function (phase 3) which returns the value
 * of a particular partition to be used as output to store data into
 * @throws Exception
 */
@Test public void testDataOutPartitionValue() throws Exception {
  init("coord-action-start");
  String expr="${coord:dataOutPartitionValue('ABC','datastamp')}";
  eval.setVariable(".dataout.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=20120230;region=US");
  eval.setVariable(".dataout.ABC.unresolved",Boolean.FALSE);
  String res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("20120230"));
  expr="${coord:dataOutPartitionValue('ABC','region')}";
  res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("US"));
  init("coord-sla-create");
  eval.setVariable(".dataout.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=20120230;region=US");
  eval.setVariable(".dataout.ABC.unresolved",Boolean.FALSE);
  expr="${coord:dataOutPartitionValue('ABC','datastamp')}";
  res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("20120230"));
  expr="${coord:dataOutPartitionValue('ABC','region')}";
  res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("US"));
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test dataInPartitionPigFilter EL function (phase 3) which returns the
 * partition filter to be used as input to load data from
 * @throws Exception
 */
@Test public void testdataInPartitionFilter() throws Exception {
  init("coord-action-start");
  eval.setVariable(".datain.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us");
  eval.setVariable(".datain.ABC.unresolved",Boolean.FALSE);
  String expr="${coord:dataInPartitionFilter('ABC', 'pig')}";
  String res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("(datastamp=='12' AND region=='us')") || res.equals("(region=='us' AND datastamp=='12')"));
  eval.setVariable(".datain.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us," + "hcat://hcat.server.com:5080/mydb/clicks/datastamp=13;region=us");
  eval.setVariable(".datain.ABC.unresolved",Boolean.FALSE);
  expr="${coord:dataInPartitionFilter('ABC', 'pig')}";
  res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("(datastamp=='12' AND region=='us') OR (datastamp=='13' AND region=='us')") || res.equals("(datastamp=='12' AND region=='us') OR (region=='us' AND datastamp=='13')") || res.equals("(region=='us' AND datastamp=='12') OR (datastamp=='13' AND region=='us')")|| res.equals("(region=='us' AND datastamp=='12') OR (region=='us' AND datastamp=='13')"));
  eval.setVariable(".datain.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us");
  eval.setVariable(".datain.ABC.unresolved",Boolean.FALSE);
  expr="${coord:dataInPartitionFilter('ABC', 'java')}";
  res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("(datastamp='12' AND region='us')") || res.equals("(region='us' AND datastamp='12')"));
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test dataInPartitionMin EL function (phase 3) which returns the minimum
 * value of a partition to be used as minimum in a range of input data to
 * load
 * @throws Exception
 */
@Test public void testDataInPartitionMin() throws Exception {
  init("coord-action-start");
  eval.setVariable(".datain.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us," + "hcat://hcat.server.com:5080/mydb/clicks/datastamp=13;region=us," + "hcat://hcat.server.com:5080/mydb/clicks/datastamp=10;region=us");
  eval.setVariable(".datain.ABC.unresolved",Boolean.FALSE);
  String expr="${coord:dataInPartitionMin('ABC','datastamp')}";
  String res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("10"));
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test dataInPartitions EL function (phase 3) which returns the complete partition value string of a single partition
 * in case of hive-export type.
 * @throws Exception
 */
@Test public void testDataInPartitions() throws Exception {
  init("coord-action-start");
  String expr="${coord:dataInPartitions('ABC', 'hive-export')}";
  eval.setVariable(".datain.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=20120230;region=us");
  eval.setVariable(".datain.ABC.unresolved",Boolean.FALSE);
  String res=CoordELFunctions.evalAndWrap(eval,expr);
  assertTrue(res.equals("datastamp='20120230',region='us'") || res.equals("region='us',datastamp='20120230'"));
  try {
    expr="${coord:dataInPartitions('ABC', 'invalid-type')}";
    eval.setVariable(".datain.ABC","hcat://hcat.server.com:5080/mydb/clicks/datastamp=20120230;region=us");
    eval.setVariable(".datain.ABC.unresolved",Boolean.FALSE);
    res=CoordELFunctions.evalAndWrap(eval,expr);
    fail("EL function should throw exception because of invalid type");
  }
 catch (  Exception e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.dependency.TestHCatURIHandler </h4><pre class="type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testExists() throws Exception {
  createTestTable();
  addPartition(db,table,"year=2012;month=12;dt=02;country=us");
  URI hcatURI=getHCatURI(db,table,"country=us;year=2012;month=12;dt=02");
  URIHandler handler=uriService.getURIHandler(hcatURI);
  assertTrue(handler.exists(hcatURI,conf,getTestUser()));
  hcatURI=getHCatURI(db,table,"year=2012;month=12");
  assertTrue(handler.exists(hcatURI,conf,getTestUser()));
  addPartition(db,table,"year=2012;month=12;dt=03;country=us");
  hcatURI=getHCatURI(db,table,"country=us;month=12");
  assertTrue(handler.exists(hcatURI,conf,getTestUser()));
  hcatURI=getHCatURI(db,table,"country=us");
  assertTrue(handler.exists(hcatURI,conf,getTestUser()));
  hcatURI=getHCatURI(db,table,"dt=02");
  assertTrue(handler.exists(hcatURI,conf,getTestUser()));
  hcatURI=getHCatURI(db,table,"dt=05");
  assertFalse(handler.exists(hcatURI,conf,getTestUser()));
  hcatURI=getHCatURI(db,table,"month=02;dt=02");
  assertFalse(handler.exists(hcatURI,conf,getTestUser()));
  addPartition(db,table,"year=2012;month=12;dt=04;country=us");
  hcatURI=getHCatURI(db,table,"country=us;year=2012;month=12;dt=04");
  assertTrue(handler.exists(hcatURI,conf,getTestUser()));
  ((HCatURIHandler)handler).delete(hcatURI,conf,getTestUser());
  assertFalse(handler.exists(hcatURI,conf,getTestUser()));
  dropTestTable();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.event.TestEventGeneration </h4><pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCoordinatorActionEvent() throws Exception {
  ehs.setAppTypes(new HashSet<String>(Arrays.asList("coordinator_action")));
  assertEquals(queue.size(),0);
  Date startTime=DateUtils.parseDateOozieTZ("2013-01-01T10:00Z");
  Date endTime=DateUtils.parseDateOozieTZ("2013-01-01T10:01Z");
  CoordinatorJobBean coord=addRecordToCoordJobTable(CoordinatorJob.Status.RUNNING,startTime,endTime,false,false,0);
  modifyCoordForRunning(coord);
  new CoordMaterializeTransitionXCommand(coord.getId(),3600).call();
  final CoordActionGetJPAExecutor coordGetCmd=new CoordActionGetJPAExecutor(coord.getId() + "@1");
  CoordinatorActionBean action=jpaService.execute(coordGetCmd);
  assertEquals(CoordinatorAction.Status.WAITING,action.getStatus());
  assertEquals(1,queue.size());
  JobEvent event=(JobEvent)queue.poll();
  assertNotNull(event);
  assertEquals(EventStatus.WAITING,event.getEventStatus());
  assertEquals(AppType.COORDINATOR_ACTION,event.getAppType());
  assertEquals(action.getId(),event.getId());
  assertEquals(action.getJobId(),event.getParentId());
  assertEquals(action.getNominalTime(),((CoordinatorActionEvent)event).getNominalTime());
  assertNull(event.getStartTime());
  assertEquals(coord.getUser(),event.getUser());
  assertEquals(coord.getAppName(),event.getAppName());
  assertEquals(0,queue.size());
  new CoordActionInputCheckXCommand(action.getId(),coord.getId()).call();
  action=jpaService.execute(coordGetCmd);
  assertEquals(CoordinatorAction.Status.RUNNING,action.getStatus());
  event=(JobEvent)queue.poll();
  assertEquals(EventStatus.STARTED,event.getEventStatus());
  assertEquals(AppType.COORDINATOR_ACTION,event.getAppType());
  assertEquals(action.getId(),event.getId());
  assertEquals(action.getJobId(),event.getParentId());
  assertEquals(action.getNominalTime(),((CoordinatorActionEvent)event).getNominalTime());
  WorkflowJobBean wfJob=jpaService.execute(new WorkflowJobGetJPAExecutor(action.getExternalId()));
  assertEquals(wfJob.getStartTime(),event.getStartTime());
  assertEquals(coord.getUser(),event.getUser());
  assertEquals(coord.getAppName(),event.getAppName());
  sleep(2000);
  wfJob.setStatus(WorkflowJob.Status.SUCCEEDED);
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_MODTIME,wfJob);
  action.setStatus(CoordinatorAction.Status.RUNNING);
  CoordActionQueryExecutor.getInstance().executeUpdate(CoordActionQuery.UPDATE_COORD_ACTION_STATUS_PENDING_TIME,action);
  new CoordActionCheckXCommand(action.getId(),0).call();
  action=jpaService.execute(coordGetCmd);
  assertEquals(CoordinatorAction.Status.SUCCEEDED,action.getStatus());
  List<Event> list=queue.pollBatch();
  event=(JobEvent)list.get(list.size() - 1);
  assertEquals(EventStatus.SUCCESS,event.getEventStatus());
  assertEquals(AppType.COORDINATOR_ACTION,event.getAppType());
  assertEquals(action.getId(),event.getId());
  assertEquals(action.getJobId(),event.getParentId());
  assertEquals(action.getNominalTime(),((CoordinatorActionEvent)event).getNominalTime());
  assertEquals(wfJob.getStartTime(),event.getStartTime());
  assertEquals(coord.getUser(),event.getUser());
  assertEquals(coord.getAppName(),event.getAppName());
  wfJob.setStatus(WorkflowJob.Status.FAILED);
  action.setStatus(CoordinatorAction.Status.RUNNING);
  CoordActionQueryExecutor.getInstance().executeUpdate(CoordActionQuery.UPDATE_COORD_ACTION_STATUS_PENDING_TIME,action);
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_MODTIME,wfJob);
  new CoordActionCheckXCommand(action.getId(),0).call();
  action=jpaService.execute(coordGetCmd);
  assertEquals(CoordinatorAction.Status.FAILED,action.getStatus());
  event=(JobEvent)queue.poll();
  assertEquals(EventStatus.FAILURE,event.getEventStatus());
  assertEquals(AppType.COORDINATOR_ACTION,event.getAppType());
  assertEquals(action.getId(),event.getId());
  assertEquals(action.getJobId(),event.getParentId());
  assertEquals(action.getNominalTime(),((CoordinatorActionEvent)event).getNominalTime());
  assertEquals(wfJob.getStartTime(),event.getStartTime());
  assertEquals(coord.getUser(),event.getUser());
  assertEquals(coord.getAppName(),event.getAppName());
  coord.setStatus(CoordinatorJobBean.Status.SUSPENDED);
  CoordJobQueryExecutor.getInstance().executeUpdate(CoordJobQuery.UPDATE_COORD_JOB_STATUS,coord);
  action.setStatus(CoordinatorAction.Status.SUSPENDED);
  CoordActionQueryExecutor.getInstance().executeUpdate(CoordActionQuery.UPDATE_COORD_ACTION_STATUS_PENDING_TIME,action);
  wfJob.setStatus(WorkflowJob.Status.SUSPENDED);
  WorkflowInstance wfInstance=wfJob.getWorkflowInstance();
  ((LiteWorkflowInstance)wfInstance).setStatus(WorkflowInstance.Status.SUSPENDED);
  wfJob.setWorkflowInstance(wfInstance);
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_INSTANCE_MODIFIED,wfJob);
  queue.clear();
  new CoordResumeXCommand(coord.getId()).call();
  waitForEventGeneration(1000);
  CoordinatorActionEvent cevent=(CoordinatorActionEvent)queue.poll();
  assertEquals(EventStatus.STARTED,cevent.getEventStatus());
  assertEquals(AppType.COORDINATOR_ACTION,cevent.getAppType());
  assertEquals(action.getId(),cevent.getId());
  assertEquals(action.getJobId(),cevent.getParentId());
  assertEquals(action.getNominalTime(),cevent.getNominalTime());
  coord=CoordJobQueryExecutor.getInstance().get(CoordJobQuery.GET_COORD_JOB,coord.getId());
  assertEquals(coord.getLastModifiedTime(),cevent.getStartTime());
  action.setStatus(CoordinatorAction.Status.KILLED);
  CoordActionQueryExecutor.getInstance().executeUpdate(CoordActionQuery.UPDATE_COORD_ACTION_STATUS_PENDING_TIME,action);
  queue.clear();
  new CoordRerunXCommand(coord.getId(),RestConstants.JOB_COORD_SCOPE_ACTION,"1",false,true,false,null).call();
  waitFor(3 * 100,new Predicate(){
    @Override public boolean evaluate() throws Exception {
      return jpaService.execute(coordGetCmd).getStatus() == CoordinatorAction.Status.WAITING;
    }
  }
);
  cevent=(CoordinatorActionEvent)queue.poll();
  assertEquals(EventStatus.WAITING,cevent.getEventStatus());
  assertEquals(AppType.COORDINATOR_ACTION,cevent.getAppType());
  assertEquals(action.getId(),cevent.getId());
  assertEquals(action.getJobId(),cevent.getParentId());
  assertEquals(action.getNominalTime(),cevent.getNominalTime());
  assertEquals(wfJob.getStartTime(),event.getStartTime());
  assertNotNull(cevent.getMissingDeps());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWorkflowActionEvent() throws Exception {
  assertEquals(queue.size(),0);
  ehs.setAppTypes(new HashSet<String>(Arrays.asList("workflow_action")));
  WorkflowJobBean job=this.addRecordToWfJobTable(WorkflowJob.Status.RUNNING,WorkflowInstance.Status.RUNNING);
  WorkflowActionBean action=this.addRecordToWfActionTable(job.getId(),"1",WorkflowAction.Status.PREP,true);
  action.setExternalChildIDs(null);
  WorkflowActionQueryExecutor.getInstance().executeUpdate(WorkflowActionQuery.UPDATE_ACTION_START,action);
  new ActionStartXCommand(action.getId(),"map-reduce").call();
  WorkflowActionGetJPAExecutor wfActionGetCmd=new WorkflowActionGetJPAExecutor(action.getId());
  action=jpaService.execute(wfActionGetCmd);
  assertEquals(WorkflowAction.Status.RUNNING,action.getStatus());
  assertEquals(1,queue.size());
  WorkflowActionEvent event=(WorkflowActionEvent)queue.poll();
  assertNotNull(event);
  assertEquals(EventStatus.STARTED,event.getEventStatus());
  assertEquals(AppType.WORKFLOW_ACTION,event.getAppType());
  assertEquals(action.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(action.getName(),event.getAppName());
  assertEquals(action.getStartTime(),event.getStartTime());
  assertEquals(0,queue.size());
  ActionExecutor.Context context=new ActionXCommand.ActionExecutorContext(job,action,false,false);
  ActionExecutor executor=Services.get().get(ActionService.class).getExecutor(action.getType());
  ActionCheckXCommandForTest dac=new ActionCheckXCommandForTest(context,executor,action.getId());
  dac.execute();
  action=dac.getAction();
  assertEquals(WorkflowAction.Status.START_MANUAL,action.getStatus());
  assertEquals(1,queue.size());
  event=(WorkflowActionEvent)queue.poll();
  assertNotNull(event);
  assertEquals(EventStatus.SUSPEND,event.getEventStatus());
  assertEquals(AppType.WORKFLOW_ACTION,event.getAppType());
  assertEquals(action.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(action.getName(),event.getAppName());
  assertEquals(0,queue.size());
  action.setStatus(WorkflowAction.Status.KILLED);
  action.setPendingOnly();
  action.setEndTime(null);
  WorkflowActionQueryExecutor.getInstance().executeUpdate(WorkflowActionQuery.UPDATE_ACTION_END,action);
  new ActionKillXCommand(action.getId()).call();
  action=jpaService.execute(wfActionGetCmd);
  assertEquals(WorkflowAction.Status.KILLED,action.getStatus());
  assertEquals(1,queue.size());
  event=(WorkflowActionEvent)queue.poll();
  assertNotNull(event);
  assertEquals(EventStatus.FAILURE,event.getEventStatus());
  assertEquals(AppType.WORKFLOW_ACTION,event.getAppType());
  assertEquals(action.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(action.getName(),event.getAppName());
  assertEquals(action.getStartTime(),event.getStartTime());
  assertNotNull(action.getEndTime());
  assertNotNull(event.getEndTime());
  assertEquals(action.getEndTime(),event.getEndTime());
  assertEquals(0,queue.size());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWorkflowJobEvent() throws Exception {
  assertEquals(0,queue.size());
  WorkflowApp app=new LiteWorkflowApp("testApp","<workflow-app/>",new StartNodeDef(LiteWorkflowStoreService.LiteControlNodeHandler.class,"fs-node")).addNode(new ActionNodeDef("fs-node","",TestLiteWorkflowLib.TestActionNodeHandler.class,"end","end")).addNode(new EndNodeDef("end",LiteWorkflowStoreService.LiteControlNodeHandler.class));
  WorkflowJobBean job=addRecordToWfJobTable(app,WorkflowJob.Status.PREP,WorkflowInstance.Status.PREP);
  new StartXCommand(job.getId()).call();
  WorkflowJobGetJPAExecutor wfJobGetCmd=new WorkflowJobGetJPAExecutor(job.getId());
  job=jpaService.execute(wfJobGetCmd);
  assertEquals(WorkflowJob.Status.RUNNING,job.getStatus());
  assertEquals(1,queue.size());
  JobEvent event=(JobEvent)queue.poll();
  assertNotNull(event);
  assertEquals(EventStatus.STARTED,event.getEventStatus());
  assertEquals(AppType.WORKFLOW_JOB,event.getAppType());
  assertEquals(job.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(job.getAppName(),event.getAppName());
  assertEquals(job.getStartTime(),event.getStartTime());
  assertEquals(0,queue.size());
  new SuspendXCommand(job.getId()).call();
  job=jpaService.execute(wfJobGetCmd);
  assertEquals(WorkflowJob.Status.SUSPENDED,job.getStatus());
  assertEquals(1,queue.size());
  event=(JobEvent)queue.poll();
  assertNotNull(event);
  assertEquals(EventStatus.SUSPEND,event.getEventStatus());
  assertEquals(AppType.WORKFLOW_JOB,event.getAppType());
  assertEquals(job.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(job.getAppName(),event.getAppName());
  assertEquals(0,queue.size());
  new ResumeXCommand(job.getId()).call();
  job=jpaService.execute(wfJobGetCmd);
  assertEquals(WorkflowJob.Status.RUNNING,job.getStatus());
  assertEquals(1,queue.size());
  event=(JobEvent)queue.poll();
  assertNotNull(event);
  assertEquals(AppType.WORKFLOW_JOB,event.getAppType());
  assertEquals(job.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(job.getAppName(),event.getAppName());
  assertEquals(job.getStartTime(),event.getStartTime());
  assertEquals(0,queue.size());
  new KillXCommand(job.getId()).call();
  job=jpaService.execute(wfJobGetCmd);
  assertEquals(WorkflowJob.Status.KILLED,job.getStatus());
  assertEquals(1,queue.size());
  event=(JobEvent)queue.poll();
  assertNotNull(event);
  assertEquals(EventStatus.FAILURE,event.getEventStatus());
  assertEquals(AppType.WORKFLOW_JOB,event.getAppType());
  assertEquals(job.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(job.getAppName(),event.getAppName());
  assertEquals(job.getStartTime(),event.getStartTime());
  assertEquals(job.getEndTime(),event.getEndTime());
  assertEquals(0,queue.size());
  job=_createWorkflowJob();
  LiteWorkflowInstance wfInstance=(LiteWorkflowInstance)job.getWorkflowInstance();
  wfInstance.start();
  job.setWorkflowInstance(wfInstance);
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_INSTANCE_MODIFIED,job);
  WorkflowActionBean wfAction=jpaService.execute(new WorkflowActionGetJPAExecutor(job.getId() + "@one"));
  new SignalXCommand(job.getId(),wfAction.getId()).call();
  job=jpaService.execute(new WorkflowJobGetJPAExecutor(job.getId()));
  assertEquals(WorkflowJob.Status.SUCCEEDED,job.getStatus());
  assertEquals(1,queue.size());
  event=(JobEvent)queue.poll();
  assertNotNull(event);
  assertEquals(AppType.WORKFLOW_JOB,event.getAppType());
  assertEquals(job.getId(),event.getId());
  assertEquals(job.getUser(),event.getUser());
  assertEquals(job.getAppName(),event.getAppName());
  assertEquals(job.getStartTime(),event.getStartTime());
  assertEquals(job.getEndTime(),event.getEndTime());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testForNoDuplicates() throws Exception {
  Reader reader=IOUtils.getResourceAsReader("wf-no-op.xml",-1);
  Writer writer=new FileWriter(getTestCaseDir() + "/workflow.xml");
  IOUtils.copyCharStream(reader,writer);
  final DagEngine engine=new DagEngine(getTestUser());
  Configuration conf=new XConfiguration();
  conf.set(OozieClient.APP_PATH,getTestCaseFileUri("workflow.xml"));
  conf.set(OozieClient.USER_NAME,getTestUser());
  final String jobId1=engine.submitJob(conf,true);
  final WorkflowJobGetJPAExecutor readCmd=new WorkflowJobGetJPAExecutor(jobId1);
  waitFor(1 * 100,new Predicate(){
    @Override public boolean evaluate() throws Exception {
      return jpaService.execute(readCmd).getStatus() == WorkflowJob.Status.SUCCEEDED;
    }
  }
);
  assertEquals(2,queue.size());
  assertEquals(EventStatus.STARTED,((JobEvent)queue.poll()).getEventStatus());
  assertEquals(EventStatus.SUCCESS,((JobEvent)queue.poll()).getEventStatus());
  queue.clear();
  Date startTime=DateUtils.parseDateOozieTZ("2009-02-01T23:59Z");
  Date endTime=DateUtils.parseDateOozieTZ("2009-02-02T23:59Z");
  CoordinatorJobBean coord=addRecordToCoordJobTable(CoordinatorJob.Status.RUNNING,startTime,endTime,false,false,0);
  _modifyCoordForFailureAction(coord,"wf-invalid-fork.xml");
  new CoordMaterializeTransitionXCommand(coord.getId(),3600).call();
  final CoordJobGetJPAExecutor readCmd1=new CoordJobGetJPAExecutor(coord.getId());
  waitFor(1 * 100,new Predicate(){
    @Override public boolean evaluate() throws Exception {
      CoordinatorJobBean bean=jpaService.execute(readCmd1);
      return bean.getStatus() == CoordinatorJob.Status.SUCCEEDED || bean.getStatus() == CoordinatorJob.Status.KILLED;
    }
  }
);
  assertEquals(2,queue.size());
  assertEquals(EventStatus.WAITING,((JobEvent)queue.poll()).getEventStatus());
  assertEquals(EventStatus.FAILURE,((JobEvent)queue.poll()).getEventStatus());
  ehs.getAppTypes().add("workflow_action");
  coord=addRecordToCoordJobTable(CoordinatorJob.Status.RUNNING,startTime,endTime,false,false,0);
  CoordinatorActionBean action=addRecordToCoordActionTable(coord.getId(),1,CoordinatorAction.Status.RUNNING,"coord-action-sla1.xml",0);
  WorkflowJobBean wf=addRecordToWfJobTable(WorkflowJob.Status.RUNNING,WorkflowInstance.Status.RUNNING,action.getId());
  action.setExternalId(wf.getId());
  CoordActionQueryExecutor.getInstance().executeUpdate(CoordActionQuery.UPDATE_COORD_ACTION,action);
  String waId=_createWorkflowAction(wf.getId(),"wf-action");
  new ActionStartXCommand(waId,action.getType()).call();
  final WorkflowJobGetJPAExecutor readCmd2=new WorkflowJobGetJPAExecutor(jobId1);
  waitFor(1 * 100,new Predicate(){
    @Override public boolean evaluate() throws Exception {
      return jpaService.execute(readCmd2).getStatus() == WorkflowJob.Status.KILLED;
    }
  }
);
  assertEquals(3,queue.size());
  JobEvent wfActionEvent=(JobEvent)queue.poll();
  assertEquals(EventStatus.FAILURE,wfActionEvent.getEventStatus());
  assertEquals(waId,wfActionEvent.getId());
  assertEquals(AppType.WORKFLOW_ACTION,wfActionEvent.getAppType());
  JobEvent wfJobEvent=(JobEvent)queue.poll();
  assertEquals(EventStatus.FAILURE,wfJobEvent.getEventStatus());
  assertEquals(wf.getId(),wfJobEvent.getId());
  assertEquals(AppType.WORKFLOW_JOB,wfJobEvent.getAppType());
  JobEvent coordActionEvent=(JobEvent)queue.poll();
  assertEquals(EventStatus.FAILURE,coordActionEvent.getEventStatus());
  assertEquals(action.getId(),coordActionEvent.getId());
  assertEquals(AppType.COORDINATOR_ACTION,coordActionEvent.getAppType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.jms.TestDefaultConnectionContext </h4><pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testThreadLocalSession() throws JMSException {
  String jmsProps=services.getConf().get(JMSJobEventListener.JMS_CONNECTION_PROPERTIES);
  JMSConnectionInfo connInfo=new JMSConnectionInfo(jmsProps);
  ConnectionContext jmsContext=Services.get().get(JMSAccessorService.class).createConnectionContext(connInfo);
  Thread th=new Thread(new SessionThread(jmsContext));
  th.start();
  try {
    th.join();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  assertEquals(session1,session2);
  Session session3=jmsContext.createThreadLocalSession(Session.AUTO_ACKNOWLEDGE);
  Session session4=jmsContext.createThreadLocalSession(Session.AUTO_ACKNOWLEDGE);
  assertTrue(session3.equals(session4));
  assertFalse(session1.equals(session3));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.jms.TestJMSJobEventListener </h4><pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWorkflowJobSelectorsOr(){
  JMSJobEventListener wfEventListener=new JMSJobEventListener();
  wfEventListener.init(conf);
  WorkflowJobEvent wfe=new WorkflowJobEvent("wfId1","caId1",WorkflowJob.Status.FAILED,"user1","wf-app-name1",new Date(),new Date());
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    String selector=JMSHeaderConstants.USER + "='Non_matching_user' OR " + JMSHeaderConstants.APP_NAME+ "='wf-app-name1'";
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListener.getTopic(wfe),selector);
    wfEventListener.onWorkflowJobEvent(wfe);
    TextMessage message=(TextMessage)consumer.receive(5000);
    WorkflowJobMessage wfFailMessage=JMSMessagingUtils.getEventMessage(message);
    Assert.assertEquals(WorkflowJob.Status.FAILED,wfFailMessage.getStatus());
    assertEquals("user1",wfFailMessage.getUser());
    assertEquals(MessageType.JOB,wfFailMessage.getMessageType());
    wfEventListener.destroy();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnWorkflowJobSuccessEvent() throws ParseException {
  JMSJobEventListener wfEventListener=new JMSJobEventListener();
  wfEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  Date endDate=new Date();
  WorkflowJobEvent wfe=new WorkflowJobEvent("wfId1","caId1",WorkflowJob.Status.SUCCEEDED,"user1","wf-app-name1",startDate,endDate);
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListener.getTopic(wfe));
    wfEventListener.onWorkflowJobEvent(wfe);
    TextMessage message=(TextMessage)consumer.receive(5000);
    WorkflowJobMessage wfSuccMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(WorkflowJob.Status.SUCCEEDED,wfSuccMessage.getStatus());
    assertEquals(startDate,wfSuccMessage.getStartTime());
    assertEquals(endDate,wfSuccMessage.getEndTime());
    assertEquals("wfId1",wfSuccMessage.getId());
    assertEquals("caId1",wfSuccMessage.getParentId());
    assertEquals(MessageType.JOB,wfSuccMessage.getMessageType());
    assertEquals(AppType.WORKFLOW_JOB,wfSuccMessage.getAppType());
    assertEquals(EventStatus.SUCCESS,wfSuccMessage.getEventStatus());
    assertEquals("user1",wfSuccMessage.getUser());
    assertEquals("wf-app-name1",wfSuccMessage.getAppName());
    wfEventListener.destroy();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnWorkflowJobSuspendEvent() throws ParseException {
  JMSJobEventListener wfEventListener=new JMSJobEventListener();
  wfEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  WorkflowJobEvent wfe=new WorkflowJobEvent("wfId1","caId1",WorkflowJob.Status.SUSPENDED,"user1","wf-app-name1",startDate,null);
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListener.getTopic(wfe));
    wfEventListener.onWorkflowJobEvent(wfe);
    TextMessage message=(TextMessage)consumer.receive(5000);
    assertFalse(message.getText().contains("endTime"));
    WorkflowJobMessage wfFailMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(WorkflowJob.Status.SUSPENDED,wfFailMessage.getStatus());
    assertEquals(startDate,wfFailMessage.getStartTime());
    assertEquals("wfId1",wfFailMessage.getId());
    assertEquals("caId1",wfFailMessage.getParentId());
    assertEquals(MessageType.JOB,wfFailMessage.getMessageType());
    assertEquals(AppType.WORKFLOW_JOB,wfFailMessage.getAppType());
    assertEquals(EventStatus.SUSPEND,wfFailMessage.getEventStatus());
    assertEquals("user1",wfFailMessage.getUser());
    assertEquals("wf-app-name1",wfFailMessage.getAppName());
    assertNull(wfFailMessage.getErrorCode());
    assertNull(wfFailMessage.getErrorMessage());
    wfEventListener.destroy();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnWorkflowJobFailureEvent() throws ParseException {
  JMSJobEventListener wfEventListener=new JMSJobEventListener();
  wfEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  Date endDate=new Date();
  WorkflowJobEvent wfe=new WorkflowJobEvent("wfId1","caId1",WorkflowJob.Status.FAILED,"user1","wf-app-name1",startDate,endDate);
  wfe.setErrorCode("dummyErrorCode");
  wfe.setErrorMessage("dummyErrorMessage");
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListener.getTopic(wfe));
    wfEventListener.onWorkflowJobEvent(wfe);
    TextMessage message=(TextMessage)consumer.receive(5000);
    WorkflowJobMessage wfFailMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(WorkflowJob.Status.FAILED,wfFailMessage.getStatus());
    assertEquals(startDate,wfFailMessage.getStartTime());
    assertEquals(endDate,wfFailMessage.getEndTime());
    assertEquals("wfId1",wfFailMessage.getId());
    assertEquals("caId1",wfFailMessage.getParentId());
    assertEquals(MessageType.JOB,wfFailMessage.getMessageType());
    assertEquals(AppType.WORKFLOW_JOB,wfFailMessage.getAppType());
    assertEquals(EventStatus.FAILURE,wfFailMessage.getEventStatus());
    assertEquals("user1",wfFailMessage.getUser());
    assertEquals("wf-app-name1",wfFailMessage.getAppName());
    assertEquals("dummyErrorCode",wfFailMessage.getErrorCode());
    assertEquals("dummyErrorMessage",wfFailMessage.getErrorMessage());
    wfEventListener.destroy();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnCoordinatorActionStartEvent() throws ParseException {
  JMSJobEventListener coordEventListener=new JMSJobEventListener();
  coordEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  Date nominalTime=DateUtils.parseDateUTC("2011-07-11T00:00Z");
  CoordinatorActionEvent cae=new CoordinatorActionEvent("caId1","caJobId1",CoordinatorAction.Status.RUNNING,"user1","wf-app-name1",nominalTime,startDate,null);
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,coordEventListener.getTopic(cae));
    coordEventListener.onCoordinatorActionEvent(cae);
    TextMessage message=(TextMessage)consumer.receive(5000);
    assertFalse(message.getText().contains("endTime"));
    assertFalse(message.getText().contains("errorCode"));
    assertFalse(message.getText().contains("errorMessage"));
    assertFalse(message.getText().contains("missingDependency"));
    CoordinatorActionMessage coordActionStartMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(CoordinatorAction.Status.RUNNING,coordActionStartMessage.getStatus());
    assertEquals(startDate,coordActionStartMessage.getStartTime());
    assertEquals("caJobId1",coordActionStartMessage.getParentId());
    assertEquals("caId1",coordActionStartMessage.getId());
    assertEquals(MessageType.JOB,coordActionStartMessage.getMessageType());
    assertEquals(AppType.COORDINATOR_ACTION,coordActionStartMessage.getAppType());
    assertEquals(EventStatus.STARTED,coordActionStartMessage.getEventStatus());
    assertEquals("user1",coordActionStartMessage.getUser());
    assertEquals("wf-app-name1",coordActionStartMessage.getAppName());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWorkflowJobSelectorsAnd(){
  JMSJobEventListener wfEventListener=new JMSJobEventListener();
  wfEventListener.init(conf);
  WorkflowJobEvent wfe=new WorkflowJobEvent("wfId1","caId1",WorkflowJob.Status.FAILED,"user1","wf-app-name1",new Date(),new Date());
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    String selector=JMSHeaderConstants.EVENT_STATUS + "='FAILURE' AND " + JMSHeaderConstants.APP_TYPE+ "='WORKFLOW_JOB' AND "+ JMSHeaderConstants.MESSAGE_TYPE+ "='JOB'";
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListener.getTopic(wfe),selector);
    wfEventListener.onWorkflowJobEvent(wfe);
    TextMessage message=(TextMessage)consumer.receive(5000);
    WorkflowJobMessage wfFailMessage=JMSMessagingUtils.getEventMessage(message);
    Assert.assertEquals(WorkflowJob.Status.FAILED,wfFailMessage.getStatus());
    assertEquals("user1",wfFailMessage.getUser());
    assertEquals(MessageType.JOB,wfFailMessage.getMessageType());
    wfEventListener.destroy();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCoordinatorActionSelectors() throws ParseException {
  JMSJobEventListener coordEventListener=new JMSJobEventListener();
  coordEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  Date nominalTime=DateUtils.parseDateUTC("2011-07-11T00:00Z");
  CoordinatorActionEvent cae=new CoordinatorActionEvent("caId1","caJobId1",CoordinatorAction.Status.FAILED,"user1","wf-app-name1",nominalTime,startDate,null);
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    String selector=JMSHeaderConstants.USER + "='user1'";
    MessageConsumer consumer=jmsContext.createConsumer(session,coordEventListener.getTopic(cae),selector);
    coordEventListener.onCoordinatorActionEvent(cae);
    TextMessage message=(TextMessage)consumer.receive(5000);
    CoordinatorActionMessage coordActionFailMessage=JMSMessagingUtils.getEventMessage(message);
    Assert.assertEquals(CoordinatorAction.Status.FAILED,coordActionFailMessage.getStatus());
    assertEquals("user1",coordActionFailMessage.getUser());
    assertEquals(MessageType.JOB,coordActionFailMessage.getMessageType());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWorkflowJobSelectors() throws ParseException {
  JMSJobEventListener wfEventListener=new JMSJobEventListener();
  wfEventListener.init(conf);
  WorkflowJobEvent wfe=new WorkflowJobEvent("wfId1","caId1",WorkflowJob.Status.FAILED,"user_1","wf-app-name1",new Date(),new Date());
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    String selector=JMSHeaderConstants.USER + "='user_1'";
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListener.getTopic(wfe),selector);
    wfEventListener.onWorkflowJobEvent(wfe);
    TextMessage message=(TextMessage)consumer.receive(5000);
    WorkflowJobMessage wfFailMessage=JMSMessagingUtils.getEventMessage(message);
    Assert.assertEquals(WorkflowJob.Status.FAILED,wfFailMessage.getStatus());
    assertEquals("user_1",wfFailMessage.getUser());
    assertEquals(MessageType.JOB,wfFailMessage.getMessageType());
    wfEventListener.destroy();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnWorkflowJobStartedEvent() throws ParseException {
  JMSJobEventListener wfEventListener=new JMSJobEventListener();
  wfEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  WorkflowJobEvent wfe=new WorkflowJobEvent("wfId1","caId1",WorkflowJob.Status.RUNNING,"user1","wf-app-name1",startDate,null);
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListener.getTopic(wfe));
    wfEventListener.onWorkflowJobEvent(wfe);
    TextMessage message=(TextMessage)consumer.receive(5000);
    assertFalse(message.getText().contains("endTime"));
    WorkflowJobMessage wfStartMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(WorkflowJob.Status.RUNNING,wfStartMessage.getStatus());
    assertEquals(startDate,wfStartMessage.getStartTime());
    assertEquals("wfId1",wfStartMessage.getId());
    assertEquals("caId1",wfStartMessage.getParentId());
    assertEquals(MessageType.JOB,wfStartMessage.getMessageType());
    assertEquals(AppType.WORKFLOW_JOB,wfStartMessage.getAppType());
    assertEquals(EventStatus.STARTED,wfStartMessage.getEventStatus());
    assertEquals("user1",wfStartMessage.getUser());
    assertEquals("wf-app-name1",wfStartMessage.getAppName());
    wfEventListener.destroy();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnCoordinatorJobSuccessEvent() throws ParseException {
  JMSJobEventListener coordEventListener=new JMSJobEventListener();
  coordEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  Date nominalTime=DateUtils.parseDateUTC("2011-07-11T00:00Z");
  Date endDate=new Date();
  CoordinatorActionEvent cae=new CoordinatorActionEvent("caId1","caJobId1",CoordinatorAction.Status.SUCCEEDED,"user1","wf-app-name1",nominalTime,startDate,null);
  cae.setEndTime(endDate);
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,coordEventListener.getTopic(cae));
    coordEventListener.onCoordinatorActionEvent(cae);
    TextMessage message=(TextMessage)consumer.receive(5000);
    assertFalse(message.getText().contains("errorCode"));
    assertFalse(message.getText().contains("errorMessage"));
    assertFalse(message.getText().contains("missingDependency"));
    CoordinatorActionMessage coordActionSuccessMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(CoordinatorAction.Status.SUCCEEDED,coordActionSuccessMessage.getStatus());
    assertEquals(startDate,coordActionSuccessMessage.getStartTime());
    assertEquals(endDate,coordActionSuccessMessage.getEndTime());
    assertEquals("caJobId1",coordActionSuccessMessage.getParentId());
    assertEquals("caId1",coordActionSuccessMessage.getId());
    assertEquals(MessageType.JOB,coordActionSuccessMessage.getMessageType());
    assertEquals(AppType.COORDINATOR_ACTION,coordActionSuccessMessage.getAppType());
    assertEquals(EventStatus.SUCCESS,coordActionSuccessMessage.getEventStatus());
    assertEquals("user1",coordActionSuccessMessage.getUser());
    assertEquals("wf-app-name1",coordActionSuccessMessage.getAppName());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnCoordinatorActionWaitingEvent() throws ParseException {
  JMSJobEventListener wfEventListner=new JMSJobEventListener();
  wfEventListner.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  Date nominalTime=DateUtils.parseDateUTC("2011-07-11T00:00Z");
  CoordinatorActionEvent cae=new CoordinatorActionEvent("caId1","caJobId1",CoordinatorAction.Status.WAITING,"user1","wf-app-name1",nominalTime,startDate,"missingDep1");
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,wfEventListner.getTopic(cae));
    wfEventListner.onCoordinatorActionEvent(cae);
    TextMessage message=(TextMessage)consumer.receive(5000);
    assertFalse(message.getText().contains("endTime"));
    assertFalse(message.getText().contains("errorCode"));
    assertFalse(message.getText().contains("errorMessage"));
    CoordinatorActionMessage coordActionWaitingMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(CoordinatorAction.Status.WAITING,coordActionWaitingMessage.getStatus());
    assertEquals(startDate,coordActionWaitingMessage.getStartTime());
    assertEquals(nominalTime,coordActionWaitingMessage.getNominalTime());
    assertEquals("caJobId1",coordActionWaitingMessage.getParentId());
    assertEquals("caId1",coordActionWaitingMessage.getId());
    assertEquals(MessageType.JOB,coordActionWaitingMessage.getMessageType());
    assertEquals(AppType.COORDINATOR_ACTION,coordActionWaitingMessage.getAppType());
    assertEquals(EventStatus.WAITING,coordActionWaitingMessage.getEventStatus());
    assertEquals("user1",coordActionWaitingMessage.getUser());
    assertEquals("wf-app-name1",coordActionWaitingMessage.getAppName());
    assertEquals("missingDep1",coordActionWaitingMessage.getMissingDependency());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnCoordinatorJobFailureEvent() throws ParseException {
  JMSJobEventListener coordEventListener=new JMSJobEventListener();
  coordEventListener.init(conf);
  Date startDate=DateUtils.parseDateUTC("2012-07-22T00:00Z");
  Date nominalTime=DateUtils.parseDateUTC("2011-07-11T00:00Z");
  Date endDate=new Date();
  CoordinatorActionEvent cae=new CoordinatorActionEvent("caId1","caJobId1",CoordinatorAction.Status.FAILED,"user1","wf-app-name1",nominalTime,startDate,null);
  cae.setEndTime(endDate);
  cae.setErrorCode("E0101");
  cae.setErrorMessage("dummyError");
  ConnectionContext jmsContext=getConnectionContext();
  try {
    Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer=jmsContext.createConsumer(session,coordEventListener.getTopic(cae));
    coordEventListener.onCoordinatorActionEvent(cae);
    TextMessage message=(TextMessage)consumer.receive(5000);
    assertFalse(message.getText().contains("missingDependency"));
    CoordinatorActionMessage coordActionFailMessage=JMSMessagingUtils.getEventMessage(message);
    assertEquals(CoordinatorAction.Status.FAILED,coordActionFailMessage.getStatus());
    assertEquals(startDate,coordActionFailMessage.getStartTime());
    assertEquals(endDate,coordActionFailMessage.getEndTime());
    assertEquals("caJobId1",coordActionFailMessage.getParentId());
    assertEquals("caId1",coordActionFailMessage.getId());
    assertEquals(MessageType.JOB,coordActionFailMessage.getMessageType());
    assertEquals(AppType.COORDINATOR_ACTION,coordActionFailMessage.getAppType());
    assertEquals(EventStatus.FAILURE,coordActionFailMessage.getEventStatus());
    assertEquals("user1",coordActionFailMessage.getUser());
    assertEquals("wf-app-name1",coordActionFailMessage.getAppName());
    assertEquals("E0101",coordActionFailMessage.getErrorCode());
    assertEquals("dummyError",coordActionFailMessage.getErrorMessage());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.jms.TestJMSSLAEventListener </h4><pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSLAJobSelectors() throws Exception {
  JMSSLAEventListener slaListener=new JMSSLAEventListener();
  slaListener.init(conf);
  String id="0000000-000000000000001-oozie-wrkf-C@1";
  SLACalcStatus startMiss=_createSLACalcStatus(id);
  SLARegistrationBean startMissBean=startMiss.getSLARegistrationBean();
  startMiss.setId(id);
  startMissBean.setAppName("Test-SLA-Start-Miss");
  startMissBean.setAppType(AppType.COORDINATOR_ACTION);
  startMissBean.setUser("dummyuser");
  startMiss.setEventStatus(EventStatus.START_MISS);
  startMiss.setSLAStatus(SLAStatus.NOT_STARTED);
  startMiss.setMsgType(MessageType.SLA);
  ConnectionContext jmsContext=getConnectionContext();
  Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
  String selector=JMSHeaderConstants.EVENT_STATUS + "='START_MISS'";
  MessageConsumer consumer=jmsContext.createConsumer(session,slaListener.getTopic(startMiss),selector);
  slaListener.onStartMiss(startMiss);
  TextMessage message=(TextMessage)consumer.receive(5000);
  System.out.println("\n Text " + message.getText());
  SLAMessage startMissMsg=(SLAMessage)JMSMessagingUtils.getEventMessage(message);
  assertEquals("dummyuser",startMissMsg.getUser());
  assertEquals(EventStatus.START_MISS,startMissMsg.getEventStatus());
  assertEquals(MessageType.SLA,startMissMsg.getMessageType());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOnSLAStartMissEvent() throws Exception {
  JMSSLAEventListener slaListener=new JMSSLAEventListener();
  slaListener.init(conf);
  String id="0000000-000000000000001-oozie-wrkf-C@1";
  SLACalcStatus startMiss=_createSLACalcStatus(id);
  SLARegistrationBean startMissBean=startMiss.getSLARegistrationBean();
  Date startDate=DateUtils.parseDateUTC("2013-01-01T00:00Z");
  startMiss.setId(id);
  startMissBean.setParentId("0000000-000000000000001-oozie-wrkf-C");
  startMissBean.setAppName("Test-SLA-Start-Miss");
  startMissBean.setUser("dummyuser");
  startMissBean.setExpectedStart(startDate);
  startMissBean.setNotificationMsg("notification of start miss");
  startMissBean.setJobData("random job data");
  startMiss.setEventStatus(EventStatus.START_MISS);
  startMiss.setSLAStatus(SLAStatus.NOT_STARTED);
  startMissBean.setAppType(AppType.COORDINATOR_ACTION);
  startMiss.setActualStart(DateUtils.parseDateUTC("2013-01-01T01:00Z"));
  ConnectionContext jmsContext=getConnectionContext();
  Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
  MessageConsumer consumer=jmsContext.createConsumer(session,slaListener.getTopic(startMiss));
  slaListener.onStartMiss(startMiss);
  TextMessage message=(TextMessage)consumer.receive(5000);
  SLAMessage slaStartMissMsg=(SLAMessage)JMSMessagingUtils.getEventMessage(message);
  assertEquals(EventStatus.START_MISS,slaStartMissMsg.getEventStatus());
  assertEquals(SLAStatus.NOT_STARTED,slaStartMissMsg.getSLAStatus());
  assertEquals(AppType.COORDINATOR_ACTION,slaStartMissMsg.getAppType());
  assertEquals(MessageType.SLA,slaStartMissMsg.getMessageType());
  assertEquals("Test-SLA-Start-Miss",slaStartMissMsg.getAppName());
  assertEquals("dummyuser",slaStartMissMsg.getUser());
  assertEquals("0000000-000000000000001-oozie-wrkf-C@1",slaStartMissMsg.getId());
  assertEquals("0000000-000000000000001-oozie-wrkf-C",slaStartMissMsg.getParentId());
  assertEquals(startDate,slaStartMissMsg.getExpectedStartTime());
  assertEquals("notification of start miss",slaStartMissMsg.getNotificationMessage());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOnSLAStartMetEvent() throws Exception {
  JMSSLAEventListener slaListener=new JMSSLAEventListener();
  slaListener.init(conf);
  String id="0000000-000000000000001-oozie-wrkf-C@1";
  SLACalcStatus startMet=_createSLACalcStatus(id);
  SLARegistrationBean startMetBean=startMet.getSLARegistrationBean();
  Date expectedStartDate=DateUtils.parseDateUTC("2013-01-01T10:00Z");
  Date actualStartDate=DateUtils.parseDateUTC("2013-01-01T09:55Z");
  startMetBean.setAppName("Test-SLA-Start-Met");
  startMet.setEventStatus(EventStatus.START_MET);
  startMet.setSLAStatus(SLAStatus.IN_PROCESS);
  startMetBean.setAppType(AppType.COORDINATOR_ACTION);
  startMet.setId(id);
  startMetBean.setParentId("0000000-000000000000001-oozie-wrkf-C");
  startMetBean.setUser("dummyuser");
  startMetBean.setNotificationMsg("notification of start miss");
  startMetBean.setJobData("random job data");
  startMetBean.setExpectedStart(expectedStartDate);
  startMet.setActualStart(actualStartDate);
  ConnectionContext jmsContext=getConnectionContext();
  Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
  MessageConsumer consumer=jmsContext.createConsumer(session,slaListener.getTopic(startMet));
  slaListener.onStartMet(startMet);
  TextMessage message=(TextMessage)consumer.receive(5000);
  SLAMessage slaStartMissMsg=(SLAMessage)JMSMessagingUtils.getEventMessage(message);
  assertEquals(EventStatus.START_MET,slaStartMissMsg.getEventStatus());
  assertEquals(SLAStatus.IN_PROCESS,slaStartMissMsg.getSLAStatus());
  assertEquals(AppType.COORDINATOR_ACTION,slaStartMissMsg.getAppType());
  assertEquals(MessageType.SLA,slaStartMissMsg.getMessageType());
  assertEquals("Test-SLA-Start-Met",slaStartMissMsg.getAppName());
  assertEquals("dummyuser",slaStartMissMsg.getUser());
  assertEquals("0000000-000000000000001-oozie-wrkf-C@1",slaStartMissMsg.getId());
  assertEquals("0000000-000000000000001-oozie-wrkf-C",slaStartMissMsg.getParentId());
  assertEquals(expectedStartDate,slaStartMissMsg.getExpectedStartTime());
  assertEquals(actualStartDate,slaStartMissMsg.getActualStartTime());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testSLAJobSelectorsNegative() throws Exception {
  JMSSLAEventListener slaListener=new JMSSLAEventListener();
  slaListener.init(conf);
  String id="0000000-000000000000001-oozie-wrkf-C@1";
  SLACalcStatus startMiss=_createSLACalcStatus(id);
  SLARegistrationBean startMissBean=startMiss.getSLARegistrationBean();
  startMiss.setId(id);
  startMissBean.setAppName("Test-SLA-Start-Miss");
  startMissBean.setAppType(AppType.COORDINATOR_ACTION);
  startMissBean.setUser("dummyuser");
  startMiss.setEventStatus(EventStatus.START_MISS);
  startMiss.setSLAStatus(SLAStatus.NOT_STARTED);
  startMiss.setMsgType(MessageType.SLA);
  ConnectionContext jmsContext=getConnectionContext();
  Session session=jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
  String selector=JMSHeaderConstants.EVENT_STATUS + "='SLA_END_MISS'";
  MessageConsumer consumer=jmsContext.createConsumer(session,slaListener.getTopic(startMiss),selector);
  slaListener.onStartMiss(startMiss);
  TextMessage message=(TextMessage)consumer.receive(5000);
  assertNull(message);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.service.TestEventHandlerService </h4><pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEventLogging() throws Exception {
  EventHandlerService ehs=_testEventHandlerService();
  WorkflowJobEvent event=new WorkflowJobEvent("jobid","parentid",WorkflowJob.Status.RUNNING,getTestUser(),"myapp",null,null);
  TestLogAppender appender=null;
  Logger logger=null;
  try {
    appender=getTestLogAppender();
    logger=Logger.getLogger(EventHandlerService.class);
    logger.addAppender(appender);
    logger.setLevel(Level.DEBUG);
    ehs.queueEvent(event);
    List<LoggingEvent> log=appender.getLog();
    LoggingEvent logEntry=log.get(0);
    assertEquals(Level.DEBUG,logEntry.getLevel());
    assertTrue(logEntry.getMessage().toString().contains("APP[myapp] JOB[jobid] ACTION[-] Queueing event : ID: jobid"));
    assertEquals("org.apache.oozie.service.EventHandlerService",logEntry.getLoggerName());
    ehs.new EventWorker().run();
    log=appender.getLog();
    logEntry=log.get(1);
    assertEquals(Level.DEBUG,logEntry.getLevel());
    assertTrue(logEntry.getMessage().toString().contains("APP[myapp] JOB[jobid] ACTION[-] Processing event : ID: jobid"));
    CoordinatorActionEvent event2=new CoordinatorActionEvent("jobid2@1","parentid",CoordinatorAction.Status.WAITING,getTestUser(),"myapp",null,null,null);
    ehs.queueEvent(event2);
    log=appender.getLog();
    logEntry=log.get(2);
    assertTrue(logEntry.getMessage().toString().contains("APP[myapp] JOB[jobid2] ACTION[jobid2@1] Queueing event : ID: jobid2@1"));
    WorkflowJobEvent event3=new WorkflowJobEvent("jobid-other","parentid",WorkflowJob.Status.RUNNING,getTestUser(),"myapp-other",null,null);
    ehs.queueEvent(event3);
    log=appender.getLog();
    logEntry=log.get(3);
    assertTrue(logEntry.getMessage().toString().contains("APP[myapp-other] JOB[jobid-other] ACTION[-] Queueing event : ID: jobid-other"));
  }
  finally {
    logger.removeAppender(appender);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.service.TestShareLibService </h4><pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPurgeLauncherJar() throws Exception {
  services=new Services();
  setSystemProps();
  Configuration conf=services.get(ConfigurationService.class).getConf();
  conf.set(ShareLibService.SHIP_LAUNCHER_JAR,"true");
  FileSystem fs=getFileSystem();
  long expiryTime=System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(services.get(ConfigurationService.class).getConf().getInt(ShareLibService.LAUNCHERJAR_LIB_RETENTION,7),TimeUnit.DAYS);
  String expireTs=dt.format(new Date(expiryTime - TimeUnit.MILLISECONDS.convert(1,TimeUnit.DAYS)));
  String noexpireTs=dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(1,TimeUnit.DAYS)));
  String noexpireTs1=dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(2,TimeUnit.DAYS)));
  Path basePath=new Path(services.get(ConfigurationService.class).getConf().get(WorkflowAppService.SYSTEM_LIB_PATH));
  Path expirePath=new Path(basePath,ShareLibService.LAUNCHER_LIB_PREFIX + expireTs);
  Path noexpirePath=new Path(basePath,ShareLibService.LAUNCHER_LIB_PREFIX + noexpireTs);
  Path noexpirePath1=new Path(basePath,ShareLibService.LAUNCHER_LIB_PREFIX + noexpireTs1);
  createDirs(fs,expirePath,noexpirePath,noexpirePath1);
  try {
    services.init();
    assertEquals(4,fs.listStatus(basePath).length);
    assertTrue(fs.exists(noexpirePath));
    assertTrue(fs.exists(noexpirePath1));
    assertTrue(fs.exists(expirePath));
  }
  finally {
    services.destroy();
  }
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPurgeShareLib() throws Exception {
  services=new Services();
  setSystemProps();
  Configuration conf=services.get(ConfigurationService.class).getConf();
  conf.set(ShareLibService.SHIP_LAUNCHER_JAR,"true");
  FileSystem fs=getFileSystem();
  long expiryTime=System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(services.get(ConfigurationService.class).getConf().getInt(ShareLibService.LAUNCHERJAR_LIB_RETENTION,7),TimeUnit.DAYS);
  String expireTs=dt.format(new Date(expiryTime - TimeUnit.MILLISECONDS.convert(1,TimeUnit.DAYS)));
  String noexpireTs=dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(1,TimeUnit.DAYS)));
  String noexpireTs1=dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(2,TimeUnit.DAYS)));
  Path basePath=new Path(services.get(ConfigurationService.class).getConf().get(WorkflowAppService.SYSTEM_LIB_PATH));
  Path expirePath=new Path(basePath,ShareLibService.SHARE_LIB_PREFIX + expireTs);
  Path noexpirePath=new Path(basePath,ShareLibService.SHARE_LIB_PREFIX + noexpireTs);
  Path noexpirePath1=new Path(basePath,ShareLibService.SHARE_LIB_PREFIX + noexpireTs1);
  createDirs(fs,expirePath,noexpirePath,noexpirePath1);
  try {
    services.init();
    assertEquals(4,fs.listStatus(basePath).length);
    assertTrue(fs.exists(noexpirePath));
    assertTrue(fs.exists(noexpirePath1));
    assertTrue(fs.exists(expirePath));
  }
  finally {
    services.destroy();
  }
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPurgeJar() throws Exception {
  services=new Services();
  setSystemProps();
  Configuration conf=services.get(ConfigurationService.class).getConf();
  conf.set(ShareLibService.SHIP_LAUNCHER_JAR,"true");
  final FileSystem fs=getFileSystem();
  long expiryTime=System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(services.get(ConfigurationService.class).getConf().getInt(ShareLibService.LAUNCHERJAR_LIB_RETENTION,7),TimeUnit.DAYS);
  String expireTs=dt.format(new Date(expiryTime - TimeUnit.MILLISECONDS.convert(1,TimeUnit.DAYS)));
  String expireTs1=dt.format(new Date(expiryTime - TimeUnit.MILLISECONDS.convert(2,TimeUnit.DAYS)));
  String noexpireTs=dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(1,TimeUnit.DAYS)));
  String noexpireTs1=dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(2,TimeUnit.DAYS)));
  final Path basePath=new Path(services.get(ConfigurationService.class).getConf().get(WorkflowAppService.SYSTEM_LIB_PATH));
  Path expirePath=new Path(basePath,ShareLibService.LAUNCHER_LIB_PREFIX + expireTs);
  Path expirePath1=new Path(basePath,ShareLibService.LAUNCHER_LIB_PREFIX + expireTs1);
  Path noexpirePath=new Path(basePath,ShareLibService.LAUNCHER_LIB_PREFIX + noexpireTs);
  Path noexpirePath1=new Path(basePath,ShareLibService.LAUNCHER_LIB_PREFIX + noexpireTs1);
  createDirs(fs,expirePath,expirePath1,noexpirePath,noexpirePath1);
  try {
    services.init();
    waitFor(20 * 1000,new Predicate(){
      @Override public boolean evaluate() throws Exception {
        return (fs.listStatus(basePath).length == 4);
      }
    }
);
    assertEquals(4,fs.listStatus(basePath).length);
    assertTrue(fs.exists(noexpirePath));
    assertTrue(fs.exists(noexpirePath1));
    assertTrue(fs.exists(expirePath));
    assertFalse(fs.exists(expirePath1));
  }
  finally {
    services.destroy();
  }
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConfFileAddedToDistributedCache() throws Exception {
  try {
    Properties prop=new Properties();
    prop.put("oozie.hive_conf","/user/test/" + sharelibPath + "/hive-site.xml#hive-site.xml");
    setupSharelibConf("hive-site.xml","oozie.hive_conf",prop);
    String actionXml="<pig>" + "<job-tracker>" + getJobTrackerUri() + "</job-tracker>"+ "<name-node>"+ getNameNodeUri()+ "</name-node>"+ "<script>test</script>"+ "</pig>";
    Element eActionXml=XmlUtils.parseXml(actionXml);
    XConfiguration protoConf=new XConfiguration();
    protoConf.set(WorkflowAppService.HADOOP_USER,getTestUser());
    WorkflowJobBean wfj=new WorkflowJobBean();
    protoConf.setBoolean(OozieClient.USE_SYSTEM_LIBPATH,true);
    wfj.setProtoActionConf(XmlUtils.prettyPrint(protoConf).toString());
    wfj.setConf(XmlUtils.prettyPrint(protoConf).toString());
    Context context=new TestJavaActionExecutor().new Context(wfj,new WorkflowActionBean());
    PigActionExecutor ae=new PigActionExecutor();
    Configuration jobConf=ae.createBaseHadoopConf(context,eActionXml);
    jobConf.set("oozie.action.sharelib.for.pig","hive_conf");
    ae.setLibFilesArchives(context,eActionXml,new Path("hdfs://dummyAppPath"),jobConf);
    URI[] cacheFiles=DistributedCache.getCacheFiles(jobConf);
    String cacheFilesStr=Arrays.toString(cacheFiles);
    assertEquals(jobConf.get("oozie.hive_conf-sharelib-test"),null);
    assertTrue(URLDecoder.decode(cacheFilesStr).contains("hive-site.xml#hive-site.xml"));
    setupSharelibConf("hbase-site.xml","oozie.hbase_conf");
    jobConf=ae.createBaseHadoopConf(context,eActionXml);
    jobConf.set("oozie.action.sharelib.for.pig","hbase_conf");
    ae.setLibFilesArchives(context,eActionXml,new Path("hdfs://dummyAppPath"),jobConf);
    cacheFiles=DistributedCache.getCacheFiles(jobConf);
    cacheFilesStr=Arrays.toString(cacheFiles);
    assertTrue(cacheFilesStr.contains("hbase-site.xml"));
  }
  finally {
    getFileSystem().delete(new Path(sharelibPath),true);
    services.destroy();
  }
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConfFileAddedToActionConf() throws Exception {
  try {
    XConfiguration protoConf=new XConfiguration();
    protoConf.set(WorkflowAppService.HADOOP_USER,getTestUser());
    WorkflowJobBean wfj=new WorkflowJobBean();
    protoConf.setBoolean(OozieClient.USE_SYSTEM_LIBPATH,true);
    wfj.setProtoActionConf(XmlUtils.prettyPrint(protoConf).toString());
    wfj.setConf(XmlUtils.prettyPrint(protoConf).toString());
    Context context=new TestJavaActionExecutor().new Context(wfj,new WorkflowActionBean());
    setupSharelibConf("hive-site.xml","oozie.hive_conf");
    ShareLibService shareLibService=services.get(ShareLibService.class);
    assertEquals(shareLibService.getShareLibConfigMap().get("hive_conf").values().size(),1);
    assertEquals(shareLibService.getShareLibConfigMap().get("hive_conf").keySet().toArray(new Path[]{})[0].getName(),"hive-site.xml");
    setupSharelibConf("hive-site.xml","oozie.hive_conf");
    String actionXml="<hive>" + "<job-tracker>" + getJobTrackerUri() + "</job-tracker>"+ "<name-node>"+ getNameNodeUri()+ "</name-node>"+ "<script>test</script>"+ "</hive>";
    Element eActionXml=XmlUtils.parseXml(actionXml);
    HiveActionExecutor ae=new HiveActionExecutor();
    Configuration jobConf=ae.createBaseHadoopConf(context,eActionXml);
    Configuration actionConf=ae.createBaseHadoopConf(context,eActionXml);
    jobConf.set("oozie.action.sharelib.for.hive","hive_conf");
    ae.setLibFilesArchives(context,eActionXml,new Path("hdfs://dummyAppPath"),jobConf);
    URI[] cacheFiles=DistributedCache.getCacheFiles(actionConf);
    String cacheFilesStr=Arrays.toString(cacheFiles);
    assertFalse(cacheFilesStr.contains("hive-site.xml"));
    jobConf=ae.createBaseHadoopConf(context,eActionXml);
    Properties prop=new Properties();
    actionConf=ae.createBaseHadoopConf(context,eActionXml);
    prop.put("oozie.hive_conf","/user/test/" + sharelibPath + "/hive-site.xml#hive-site.xml");
    setupSharelibConf("hive-site.xml","oozie.hive_conf",prop);
    jobConf.set("oozie.action.sharelib.for.hive","hive_conf");
    ae.setLibFilesArchives(context,eActionXml,new Path("hdfs://dummyAppPath"),jobConf);
    assertEquals(jobConf.get("oozie.hive_conf-sharelib-test"),"test");
  }
  finally {
    getFileSystem().delete(new Path(sharelibPath),true);
    services.destroy();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.sla.TestSLACalculationJPAExecutor </h4><pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test simple insert
 * @throws Exception
 */
@Test public void testInsert() throws Exception {
  JPAService jpaService=Services.get().get(JPAService.class);
  assertNotNull(jpaService);
  String wfId="workflow-1";
  cal.setTime(new Date());
  cal.add(Calendar.DAY_OF_MONTH,-2);
  Date expStart=cal.getTime();
  cal.add(Calendar.DAY_OF_MONTH,-1);
  Date expEnd=cal.getTime();
  Date actStart=new Date();
  cal.add(Calendar.DAY_OF_MONTH,2);
  Date actEnd=cal.getTime();
  SLASummaryBean bean2=_createSLASummaryBean(wfId,"RUNNING",EventStatus.START_MISS,expStart,expEnd,1000,actStart,actEnd,2000,(byte)1,actEnd);
  List<JsonBean> insertList=new ArrayList<JsonBean>();
  insertList.add(bean2);
  BatchQueryExecutor.getInstance().executeBatchInsertUpdateDelete(insertList,null,null);
  SLASummaryBean sBean=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,wfId);
  assertEquals(wfId,sBean.getId());
  assertEquals("RUNNING",sBean.getJobStatus());
  assertEquals(EventStatus.START_MISS,sBean.getEventStatus());
  assertEquals(expStart,sBean.getExpectedStart());
  assertEquals(expEnd,sBean.getExpectedEnd());
  assertEquals(1000,sBean.getExpectedDuration());
  assertEquals(actStart,sBean.getActualStart());
  assertEquals(actEnd,sBean.getActualEnd());
  assertEquals(2000,sBean.getActualDuration());
  assertEquals(actEnd,sBean.getLastModifiedTime());
}

</code></pre>

<br>
<pre class="type-3 type-4 type-8 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test inserts and updates rollback
 * @throws Exception
 */
@Test public void testRollback() throws Exception {
  JPAService jpaService=Services.get().get(JPAService.class);
  assertNotNull(jpaService);
  String wfId1="workflow-1";
  String wfId2="workflow-2";
  SLASummaryBean bean1=_createSLASummaryBean(wfId1,"RUNNING",EventStatus.START_MISS,new Date(),new Date(),1000,null,null,2000,0,null);
  List<JsonBean> list=new ArrayList<JsonBean>();
  list.add(bean1);
  BatchQueryExecutor.getInstance().executeBatchInsertUpdateDelete(list,null,null);
  Date newDate=new Date();
  bean1=new SLASummaryBean();
  bean1.setId(wfId1);
  bean1.setActualEnd(newDate);
  List<UpdateEntry> updateList=new ArrayList<UpdateEntry>();
  updateList.add(new UpdateEntry<SLASummaryQuery>(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,bean1));
  SLASummaryBean bean2=_createSLASummaryBean(wfId2,"RUNNING",EventStatus.END_MISS,new Date(),new Date(),1000,null,null,2000,0,null);
  List<JsonBean> insertList=new ArrayList<JsonBean>();
  insertList.add(bean2);
  setSystemProperty(FaultInjection.FAULT_INJECTION,"true");
  setSystemProperty(SkipCommitFaultInjection.ACTION_FAILOVER_FAULT_INJECTION,"true");
  try {
    BatchQueryExecutor.getInstance().executeBatchInsertUpdateDelete(insertList,updateList,null);
    fail("Expected exception due to commit failure but didn't get any");
  }
 catch (  Exception e) {
  }
  FaultInjection.deactivate("org.apache.oozie.command.SkipCommitFaultInjection");
  SLASummaryBean sBean=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,wfId1);
  assertNull(sBean.getActualEnd());
  sBean=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,wfId2);
  assertNull(sBean);
}

</code></pre>

<br>
<pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test insert + update
 * @throws Exception
 */
@Test public void testInsertUpdate() throws Exception {
  JPAService jpaService=Services.get().get(JPAService.class);
  assertNotNull(jpaService);
  String wfId="workflow-1";
  cal.setTime(new Date());
  cal.add(Calendar.DAY_OF_MONTH,-2);
  Date expStart=cal.getTime();
  cal.add(Calendar.DAY_OF_MONTH,-1);
  Date expEnd=cal.getTime();
  Date actStart=new Date();
  SLASummaryBean bean2=_createSLASummaryBean(wfId,"RUNNING",EventStatus.START_MISS,expStart,expEnd,1000,actStart,null,2000,(byte)0,actStart);
  List<JsonBean> insertList=new ArrayList<JsonBean>();
  insertList.add(bean2);
  BatchQueryExecutor.getInstance().executeBatchInsertUpdateDelete(insertList,null,null);
  Date newDate=new Date();
  bean2=_createSLASummaryBean(wfId,"RUNNING",EventStatus.DURATION_MISS,expStart,expEnd,1000,actStart,newDate,2000,(byte)1,newDate);
  bean2.setAppType(AppType.WORKFLOW_ACTION);
  List<UpdateEntry> updateList=new ArrayList<UpdateEntry>();
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,bean2);
  SLASummaryBean sBean=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,wfId);
  assertEquals(wfId,sBean.getId());
  assertEquals(EventStatus.DURATION_MISS,sBean.getEventStatus());
  assertEquals(expStart,sBean.getExpectedStart());
  assertEquals(expEnd,sBean.getExpectedEnd());
  assertEquals(1000,sBean.getExpectedDuration());
  assertEquals(actStart,sBean.getActualStart());
  assertEquals(newDate,sBean.getActualEnd());
  assertEquals(2000,sBean.getActualDuration());
  assertEquals(newDate,sBean.getLastModifiedTime());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.sla.TestSLACalculatorMemory </h4><pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLoadOnRestart() throws Exception {
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  SLARegistrationBean slaRegBean1=_createSLARegistration("job-1",AppType.WORKFLOW_JOB);
  String jobId1=slaRegBean1.getId();
  SLARegistrationBean slaRegBean2=_createSLARegistration("job-2",AppType.WORKFLOW_JOB);
  String jobId2=slaRegBean2.getId();
  SLARegistrationBean slaRegBean3=_createSLARegistration("job-3",AppType.WORKFLOW_JOB);
  String jobId3=slaRegBean3.getId();
  List<String> idList=new ArrayList<String>();
  idList.add(slaRegBean1.getId());
  idList.add(slaRegBean2.getId());
  idList.add(slaRegBean3.getId());
  createWorkflow(idList);
  SimpleDateFormat sdf=new SimpleDateFormat("yyyy-mm-dd");
  slaRegBean1.setAppName("app-name");
  slaRegBean1.setExpectedDuration(123);
  slaRegBean1.setExpectedEnd(sdf.parse("2012-02-07"));
  slaRegBean1.setExpectedStart(sdf.parse("2011-02-07"));
  slaRegBean1.setNominalTime(sdf.parse("2012-01-06"));
  slaRegBean1.setUser("user");
  slaRegBean1.setParentId("parentId");
  slaRegBean1.setUpstreamApps("upstreamApps");
  slaRegBean1.setNotificationMsg("notificationMsg");
  slaRegBean1.setAlertContact("a@abc.com");
  slaRegBean1.setAlertEvents("MISS");
  slaRegBean1.setJobData("jobData");
  slaCalcMemory.addRegistration(jobId1,slaRegBean1);
  slaCalcMemory.addRegistration(jobId2,slaRegBean2);
  slaCalcMemory.addRegistration(jobId3,slaRegBean3);
  SLACalcStatus calc1=slaCalcMemory.get(jobId1);
  SLACalcStatus calc2=slaCalcMemory.get(jobId2);
  SLACalcStatus calc3=slaCalcMemory.get(jobId3);
  calc1.setEventProcessed(5);
  calc2.setEventProcessed(6);
  calc3.setEventProcessed(7);
  calc1.setEventStatus(SLAEvent.EventStatus.END_MISS);
  calc1.setSLAStatus(SLAEvent.SLAStatus.MISS);
  calc1.setJobStatus(WorkflowJob.Status.FAILED.toString());
  Date lastModifiedTime=new Date(System.currentTimeMillis() - 5 * 24 * 60* 60* 1000);
  calc1.setLastModifiedTime(lastModifiedTime);
  List<UpdateEntry> updateList=new ArrayList<UpdateEntry>();
  SLASummaryBean bean=new SLASummaryBean(calc1);
  bean.setActualStart(sdf.parse("2011-03-09"));
  bean.setActualEnd(sdf.parse("2011-03-10"));
  bean.setActualDuration(456);
  updateList.add(new UpdateEntry<SLASummaryQuery>(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,bean));
  updateList.add(new UpdateEntry<SLASummaryQuery>(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,new SLASummaryBean(calc2)));
  updateList.add(new UpdateEntry<SLASummaryQuery>(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,new SLASummaryBean(calc3)));
  BatchQueryExecutor.getInstance().executeBatchInsertUpdateDelete(null,updateList,null);
  slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  assertEquals(2,slaCalcMemory.size());
  SLACalcStatus calc=slaCalcMemory.get(jobId1);
  assertEquals("job-1",calc.getId());
  assertEquals(AppType.WORKFLOW_JOB,calc.getAppType());
  assertEquals("app-name",calc.getAppName());
  assertEquals(123,calc.getExpectedDuration());
  assertEquals(sdf.parse("2012-02-07"),calc.getExpectedEnd());
  assertEquals(sdf.parse("2011-02-07"),calc.getExpectedStart());
  assertEquals(sdf.parse("2012-01-06"),calc.getNominalTime());
  assertEquals("user",calc.getUser());
  assertEquals("parentId",calc.getParentId());
  assertEquals("upstreamApps",calc.getUpstreamApps());
  assertEquals("notificationMsg",calc.getNotificationMsg());
  assertEquals("a@abc.com",calc.getAlertContact());
  assertEquals("MISS",calc.getAlertEvents());
  assertEquals("jobData",calc.getJobData());
  assertEquals(sdf.parse("2011-03-09"),calc.getActualStart());
  assertEquals(sdf.parse("2011-03-10"),calc.getActualEnd());
  assertEquals(456,calc.getActualDuration());
  assertEquals(SLAEvent.EventStatus.END_MISS,calc1.getEventStatus());
  assertEquals(SLAEvent.SLAStatus.MISS,calc1.getSLAStatus());
  assertEquals(WorkflowJob.Status.FAILED.toString(),calc1.getJobStatus());
  assertEquals(lastModifiedTime,calc1.getLastModifiedTime());
  assertEquals(5,calc.getEventProcessed());
  assertEquals(6,slaCalcMemory.get(jobId2).getEventProcessed());
  assertEquals(2,slaCalcMemory.size());
  slaCalcMemory.addJobStatus(jobId3,WorkflowJob.Status.SUCCEEDED.toString(),EventStatus.SUCCESS,sdf.parse("2011-03-09"),sdf.parse("2011-04-09"));
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId3);
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(sdf.parse("2011-03-09"),slaSummary.getActualStart());
  assertEquals(sdf.parse("2011-04-09"),slaSummary.getActualEnd());
  assertEquals(WorkflowJob.Status.SUCCEEDED.toString(),slaSummary.getJobStatus());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCoordinatorActionSLAStatusOnRestart() throws Exception {
  SimpleDateFormat sdf=new SimpleDateFormat("yyyy-mm-dd");
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  SLARegistrationBean slaRegBean1=_createSLARegistration("job@1",AppType.COORDINATOR_ACTION);
  String jobId1=slaRegBean1.getId();
  slaRegBean1.setExpectedEnd(sdf.parse("2013-03-07"));
  slaRegBean1.setExpectedStart(sdf.parse("2012-03-07"));
  slaCalcMemory.addRegistration(jobId1,slaRegBean1);
  SLACalcStatus calc1=slaCalcMemory.get(jobId1);
  calc1.setEventProcessed(1);
  calc1.setSLAStatus(SLAEvent.SLAStatus.IN_PROCESS);
  calc1.setJobStatus(WorkflowAction.Status.RUNNING.name());
  calc1.setLastModifiedTime(new Date());
  SLASummaryBean slaSummaryBean=new SLASummaryBean(calc1);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,slaSummaryBean);
  CoordinatorActionBean cab=new CoordinatorActionBean();
  cab.setId(jobId1);
  cab.setStatus(CoordinatorAction.Status.FAILED);
  cab.setLastModifiedTime(sdf.parse("2013-02-07"));
  cab.setExternalId("wf_job");
  CoordActionInsertJPAExecutor caInsertCmd=new CoordActionInsertJPAExecutor(cab);
  jpaService.execute(caInsertCmd);
  WorkflowJobBean wjb=new WorkflowJobBean();
  wjb.setId("wf_job");
  wjb.setStartTime(sdf.parse("2012-02-07"));
  wjb.setLastModifiedTime(new Date());
  WorkflowJobQueryExecutor.getInstance().insert(wjb);
  slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  assertEquals(0,slaCalcMemory.size());
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId1);
  assertEquals("job@1",slaSummary.getId());
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(AppType.COORDINATOR_ACTION,slaSummary.getAppType());
  assertEquals("FAILED",slaSummary.getJobStatus());
  assertEquals(SLAEvent.SLAStatus.MISS,slaSummary.getSLAStatus());
  assertEquals(sdf.parse("2012-02-07"),slaSummary.getActualStart());
  assertEquals(sdf.parse("2013-02-07"),slaSummary.getActualEnd());
  assertEquals(sdf.parse("2013-02-07").getTime() - sdf.parse("2012-02-07").getTime(),slaSummary.getActualDuration());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDuplicateStartMiss() throws Exception {
  EventHandlerService ehs=Services.get().get(EventHandlerService.class);
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  WorkflowJobBean job1=addRecordToWfJobTable(WorkflowJob.Status.PREP,WorkflowInstance.Status.PREP);
  SLARegistrationBean slaRegBean=_createSLARegistration(job1.getId(),AppType.WORKFLOW_JOB);
  Date startTime=new Date(System.currentTimeMillis() - 1 * 1 * 3600* 1000);
  slaRegBean.setExpectedStart(startTime);
  slaRegBean.setExpectedDuration(3600 * 1000);
  slaRegBean.setExpectedEnd(new Date(System.currentTimeMillis() + 1 * 1 * 3600* 1000));
  String jobId=slaRegBean.getId();
  slaCalcMemory.addRegistration(slaRegBean.getId(),slaRegBean);
  slaCalcMemory.updateJobSla(jobId);
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(1,slaSummary.getEventProcessed());
  assertEquals(SLAStatus.NOT_STARTED,slaSummary.getSLAStatus());
  slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.RUNNING.toString(),EventStatus.STARTED,new Date(System.currentTimeMillis()),null);
  slaCalcMemory.updateJobSla(jobId);
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(1,slaSummary.getEventProcessed());
  assertEquals(SLAStatus.IN_PROCESS,slaSummary.getSLAStatus());
  assertEquals(WorkflowJob.Status.RUNNING.toString(),slaSummary.getJobStatus());
  assertEquals(1,ehs.getEventQueue().size());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWorkflowJobSLAStatusOnRestart() throws Exception {
  SimpleDateFormat sdf=new SimpleDateFormat("yyyy-mm-dd");
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  SLARegistrationBean slaRegBean1=_createSLARegistration("job-1",AppType.WORKFLOW_JOB);
  String jobId1=slaRegBean1.getId();
  slaRegBean1.setExpectedEnd(sdf.parse("2013-03-07"));
  slaRegBean1.setExpectedStart(sdf.parse("2012-03-07"));
  slaCalcMemory.addRegistration(jobId1,slaRegBean1);
  SLACalcStatus calc1=slaCalcMemory.get(jobId1);
  calc1.setEventProcessed(1);
  calc1.setSLAStatus(SLAEvent.SLAStatus.IN_PROCESS);
  calc1.setJobStatus(WorkflowJob.Status.RUNNING.name());
  calc1.setLastModifiedTime(new Date());
  SLASummaryBean slaSummaryBean=new SLASummaryBean(calc1);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,slaSummaryBean);
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId1);
  WorkflowJobBean wjb=new WorkflowJobBean();
  wjb.setId(jobId1);
  wjb.setStatus(WorkflowJob.Status.SUCCEEDED);
  wjb.setStartTime(sdf.parse("2012-02-07"));
  wjb.setEndTime(sdf.parse("2013-02-07"));
  wjb.setLastModifiedTime(new Date());
  WorkflowJobQueryExecutor.getInstance().insert(wjb);
  slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  assertEquals(0,slaCalcMemory.size());
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId1);
  assertEquals("job-1",slaSummary.getId());
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(AppType.WORKFLOW_JOB,slaSummary.getAppType());
  assertEquals("SUCCEEDED",slaSummary.getJobStatus());
  assertEquals(SLAEvent.SLAStatus.MET,slaSummary.getSLAStatus());
  assertEquals(sdf.parse("2012-02-07"),slaSummary.getActualStart());
  assertEquals(sdf.parse("2013-02-07"),slaSummary.getActualEnd());
  assertEquals(sdf.parse("2013-02-07").getTime() - sdf.parse("2012-02-07").getTime(),slaSummary.getActualDuration());
  wjb.setStatus(WorkflowJob.Status.FAILED);
  wjb.setLastModifiedTime(new Date());
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_MODTIME,wjb);
  calc1.setEventProcessed(1);
  calc1.setSLAStatus(SLAEvent.SLAStatus.IN_PROCESS);
  calc1.setJobStatus(WorkflowJob.Status.RUNNING.name());
  slaSummaryBean=new SLASummaryBean(calc1);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,slaSummaryBean);
  slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  assertEquals(0,slaCalcMemory.size());
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId1);
  assertEquals("FAILED",slaSummary.getJobStatus());
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(sdf.parse("2012-02-07"),slaSummary.getActualStart());
  assertEquals(sdf.parse("2013-02-07"),slaSummary.getActualEnd());
  assertEquals(SLAEvent.SLAStatus.MISS,slaSummary.getSLAStatus());
  wjb.setStatus(WorkflowJob.Status.RUNNING);
  wjb.setLastModifiedTime(new Date());
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_MODTIME,wjb);
  calc1.setEventProcessed(0);
  calc1.setSLAStatus(SLAEvent.SLAStatus.NOT_STARTED);
  calc1.setJobStatus(null);
  slaSummaryBean=new SLASummaryBean(calc1);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,slaSummaryBean);
  slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  assertEquals(1,slaCalcMemory.size());
  SLACalcStatus calc=slaCalcMemory.get(jobId1);
  assertEquals(1,calc.getEventProcessed());
  assertEquals("RUNNING",calc.getJobStatus());
  assertEquals(sdf.parse("2012-02-07"),calc.getActualStart());
  assertNull(calc.getActualEnd());
  assertEquals(-1,calc.getActualDuration());
  assertEquals(SLAEvent.SLAStatus.IN_PROCESS,calc.getSLAStatus());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSLAEvents2() throws Exception {
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  EventHandlerService ehs=Services.get().get(EventHandlerService.class);
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  WorkflowJobBean job1=addRecordToWfJobTable(WorkflowJob.Status.PREP,WorkflowInstance.Status.PREP);
  SLARegistrationBean slaRegBean=_createSLARegistration(job1.getId(),AppType.WORKFLOW_JOB);
  slaRegBean.setExpectedStart(new Date(System.currentTimeMillis() - 1 * 1 * 3600* 1000));
  slaRegBean.setExpectedEnd(new Date(System.currentTimeMillis() + 2 * 1 * 3600* 1000));
  String jobId=slaRegBean.getId();
  slaCalcMemory.addRegistration(jobId,slaRegBean);
  assertEquals(1,slaCalcMemory.size());
  slaCalcMemory.updateJobSla(jobId);
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(3,slaSummary.getEventProcessed());
  assertEquals(1,ehs.getEventQueue().size());
  ehs.getEventQueue().clear();
  slaSummary.setEventProcessed(1);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,slaSummary);
  SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd");
  slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.SUCCEEDED.toString(),EventStatus.SUCCESS,sdf.parse("2012-01-01"),sdf.parse("2012-01-02"));
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(1,ehs.getEventQueue().size());
  ehs.getEventQueue().clear();
  slaSummary.setEventProcessed(1);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,slaSummary);
  slaRegBean=_createSLARegistration("job-2",AppType.WORKFLOW_JOB);
  slaRegBean.setExpectedStart(new Date(System.currentTimeMillis() - 1 * 1 * 3600* 1000));
  slaRegBean.setExpectedEnd(new Date(System.currentTimeMillis() + 2 * 1 * 3600* 1000));
  jobId=slaRegBean.getId();
  slaCalcMemory.addRegistration(jobId,slaRegBean);
  assertEquals(1,slaCalcMemory.size());
  slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.KILLED.toString(),EventStatus.FAILURE,null,sdf.parse("2012-01-02"));
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(1,ehs.getEventQueue().size());
  assertNull(slaSummary.getActualStart());
  assertEquals(sdf.parse("2012-01-02"),slaSummary.getActualEnd());
  assertEquals(SLAStatus.MISS,slaSummary.getSLAStatus());
  assertEquals(SLAEvent.EventStatus.END_MISS,slaSummary.getEventStatus());
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDuplicateEndMiss() throws Exception {
  EventHandlerService ehs=Services.get().get(EventHandlerService.class);
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  WorkflowJobBean job1=addRecordToWfJobTable(WorkflowJob.Status.RUNNING,WorkflowInstance.Status.RUNNING);
  SLARegistrationBean slaRegBean=_createSLARegistration(job1.getId(),AppType.WORKFLOW_JOB);
  Date startTime=new Date(System.currentTimeMillis() + 1 * 1 * 3600* 1000);
  slaRegBean.setExpectedStart(startTime);
  slaRegBean.setExpectedDuration(3600 * 1000);
  slaRegBean.setExpectedEnd(new Date(System.currentTimeMillis() - 1 * 1 * 3600* 1000));
  String jobId=slaRegBean.getId();
  slaCalcMemory.addRegistration(slaRegBean.getId(),slaRegBean);
  slaCalcMemory.updateJobSla(jobId);
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  slaRegBean=SLARegistrationQueryExecutor.getInstance().get(SLARegQuery.GET_SLA_REG_ALL,jobId);
  assertNotNull(slaRegBean.getCreatedTimestamp());
  assertEquals(slaRegBean.getCreatedTimestamp(),slaSummary.getCreatedTimestamp());
  assertEquals(4,slaSummary.getEventProcessed());
  slaCalcMemory.updateJobSla(jobId);
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(4,slaSummary.getEventProcessed());
  assertEquals(SLAStatus.MISS,slaSummary.getSLAStatus());
  slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.SUCCEEDED.toString(),EventStatus.SUCCESS,new Date(System.currentTimeMillis()),new Date(System.currentTimeMillis() + 1 * 1 * 3600* 1000));
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(6,slaSummary.getEventProcessed());
  assertEquals(SLAStatus.MISS,slaSummary.getSLAStatus());
  assertTrue(slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.RUNNING.toString(),EventStatus.STARTED,new Date(System.currentTimeMillis()),new Date(System.currentTimeMillis() + 1 * 1 * 3600* 1000)));
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(SLAStatus.MISS,slaSummary.getSLAStatus());
  assertEquals(0,slaCalcMemory.size());
  assertEquals(3,ehs.getEventQueue().size());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSLAEvents1() throws Exception {
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  EventHandlerService ehs=Services.get().get(EventHandlerService.class);
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  WorkflowJobBean job1=addRecordToWfJobTable(WorkflowJob.Status.PREP,WorkflowInstance.Status.PREP);
  SLARegistrationBean slaRegBean=_createSLARegistration(job1.getId(),AppType.WORKFLOW_JOB);
  slaRegBean.setExpectedStart(new Date(System.currentTimeMillis() - 1 * 1 * 3600* 1000));
  slaRegBean.setExpectedDuration(2 * 3600 * 1000);
  slaRegBean.setExpectedEnd(new Date(System.currentTimeMillis() - 1 * 1 * 3600* 1000));
  String jobId=slaRegBean.getId();
  slaCalcMemory.addRegistration(jobId,slaRegBean);
  assertEquals(1,slaCalcMemory.size());
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(SLAStatus.NOT_STARTED,slaSummary.getSLAStatus());
  assertEquals("PREP",slaSummary.getJobStatus());
  slaCalcMemory.updateJobSla(jobId);
  assertEquals(2,ehs.getEventQueue().size());
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(5,slaSummary.getEventProcessed());
  assertEquals(SLAEvent.EventStatus.END_MISS,slaSummary.getEventStatus());
  assertEquals(SLAStatus.MISS,slaSummary.getSLAStatus());
  SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd");
  assertEquals(SLAStatus.MISS,slaSummary.getSLAStatus());
  slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.RUNNING.toString(),EventStatus.STARTED,sdf.parse("2012-01-01"),null);
  slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.SUSPENDED.toString(),EventStatus.SUSPEND,sdf.parse("2012-01-01"),null);
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(WorkflowJob.Status.SUSPENDED.toString(),slaSummary.getJobStatus());
  assertEquals(5,slaSummary.getEventProcessed());
  slaCalcMemory.addJobStatus(jobId,WorkflowJob.Status.SUCCEEDED.toString(),EventStatus.SUCCESS,sdf.parse("2012-01-01"),sdf.parse("2012-01-02"));
  assertEquals(3,ehs.getEventQueue().size());
  slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(SLAStatus.MISS,slaSummary.getSLAStatus());
  assertEquals(WorkflowJob.Status.SUCCEEDED.toString(),slaSummary.getJobStatus());
  assertEquals(SLAEvent.EventStatus.DURATION_MISS,slaSummary.getEventStatus());
  assertEquals(sdf.parse("2012-01-01").getTime(),slaSummary.getActualStart().getTime());
  assertEquals(sdf.parse("2012-01-02").getTime(),slaSummary.getActualEnd().getTime());
  assertEquals(sdf.parse("2012-01-02").getTime() - sdf.parse("2012-01-01").getTime(),slaSummary.getActualDuration());
  assertEquals(0,slaCalcMemory.size());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testWorkflowActionSLAStatusOnRestart() throws Exception {
  SimpleDateFormat sdf=new SimpleDateFormat("yyyy-mm-dd");
  SLACalculatorMemory slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  SLARegistrationBean slaRegBean1=_createSLARegistration("job@1",AppType.WORKFLOW_ACTION);
  String jobId1=slaRegBean1.getId();
  slaRegBean1.setExpectedEnd(sdf.parse("2013-03-07"));
  slaRegBean1.setExpectedStart(sdf.parse("2012-03-07"));
  slaCalcMemory.addRegistration(jobId1,slaRegBean1);
  SLACalcStatus calc1=slaCalcMemory.get(jobId1);
  calc1.setEventProcessed(1);
  calc1.setSLAStatus(SLAEvent.SLAStatus.IN_PROCESS);
  calc1.setJobStatus(WorkflowAction.Status.RUNNING.name());
  calc1.setLastModifiedTime(new Date());
  SLASummaryBean slaSummaryBean=new SLASummaryBean(calc1);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_ALL,slaSummaryBean);
  WorkflowActionBean wab=new WorkflowActionBean();
  wab.setId(jobId1);
  wab.setStatus(WorkflowAction.Status.OK);
  wab.setStartTime(sdf.parse("2012-02-07"));
  wab.setEndTime(sdf.parse("2013-02-07"));
  WorkflowActionInsertJPAExecutor wfInsertCmd=new WorkflowActionInsertJPAExecutor(wab);
  jpaService.execute(wfInsertCmd);
  slaCalcMemory=new SLACalculatorMemory();
  slaCalcMemory.init(Services.get().get(ConfigurationService.class).getConf());
  assertEquals(0,slaCalcMemory.size());
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId1);
  assertEquals("job@1",slaSummary.getId());
  assertEquals(8,slaSummary.getEventProcessed());
  assertEquals(AppType.WORKFLOW_ACTION,slaSummary.getAppType());
  assertEquals("OK",slaSummary.getJobStatus());
  assertEquals(SLAEvent.SLAStatus.MET,slaSummary.getSLAStatus());
  assertEquals(sdf.parse("2012-02-07"),slaSummary.getActualStart());
  assertEquals(sdf.parse("2013-02-07"),slaSummary.getActualEnd());
  assertEquals(sdf.parse("2013-02-07").getTime() - sdf.parse("2012-02-07").getTime(),slaSummary.getActualDuration());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.sla.TestSLAEventGeneration </h4><pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLA Events generated through wf rerun
 * @throws Exception
 */
@Test public void testWorkflowJobSLARerun() throws Exception {
  SLAService slas=services.get(SLAService.class);
  String wfXml=IOUtils.getResourceAsString("wf-job-sla.xml",-1);
  Path appPath=getFsTestCaseDir();
  writeToFile(wfXml,appPath,"workflow.xml");
  Configuration conf=new XConfiguration();
  conf.set(OozieClient.APP_PATH,appPath.toString());
  conf.set(OozieClient.USER_NAME,getTestUser());
  cal.setTime(new Date());
  cal.add(Calendar.MINUTE,-40);
  Date nominal=cal.getTime();
  String nominalTime=DateUtils.formatDateOozieTZ(nominal);
  conf.set("nominal_time",nominalTime);
  cal.setTime(nominal);
  cal.add(Calendar.MINUTE,10);
  String expectedStart=DateUtils.formatDateOozieTZ(cal.getTime());
  cal.setTime(nominal);
  cal.add(Calendar.MINUTE,30);
  String expectedEnd=DateUtils.formatDateOozieTZ(cal.getTime());
  SubmitXCommand sc=new SubmitXCommand(conf);
  String jobId=sc.call();
  SLACalcStatus slaEvent=slas.getSLACalculator().get(jobId);
  assertEquals(jobId,slaEvent.getId());
  assertEquals("test-wf-job-sla",slaEvent.getAppName());
  assertEquals(AppType.WORKFLOW_JOB,slaEvent.getAppType());
  assertEquals(nominalTime,DateUtils.formatDateOozieTZ(slaEvent.getNominalTime()));
  assertEquals(expectedStart,DateUtils.formatDateOozieTZ(slaEvent.getExpectedStart()));
  assertEquals(expectedEnd,DateUtils.formatDateOozieTZ(slaEvent.getExpectedEnd()));
  slas.runSLAWorker();
  slaEvent=(SLACalcStatus)ehs.getEventQueue().poll();
  assertEquals(SLAStatus.NOT_STARTED,slaEvent.getSLAStatus());
  assertEquals(EventStatus.START_MISS,slaEvent.getEventStatus());
  slas.getSLACalculator().clear();
  JPAService jpaService=Services.get().get(JPAService.class);
  WorkflowJobBean wfBean=jpaService.execute(new WorkflowJobGetJPAExecutor(jobId));
  wfBean.setStatus(WorkflowJob.Status.SUCCEEDED);
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_MODTIME,wfBean);
  cal.setTime(new Date());
  cal.add(Calendar.MINUTE,-20);
  nominalTime=DateUtils.formatDateOozieTZ(cal.getTime());
  conf.set("nominal_time",nominalTime);
  nominal=cal.getTime();
  cal.add(Calendar.MINUTE,10);
  expectedStart=DateUtils.formatDateOozieTZ(cal.getTime());
  cal.setTime(nominal);
  cal.add(Calendar.MINUTE,30);
  expectedEnd=DateUtils.formatDateOozieTZ(cal.getTime());
  ReRunXCommand rerun=new ReRunXCommand(jobId,conf);
  rerun.call();
  slaEvent=slas.getSLACalculator().get(jobId);
  assertNotNull(slaEvent);
  assertEquals(jobId,slaEvent.getId());
  assertEquals("test-wf-job-sla",slaEvent.getAppName());
  assertEquals(AppType.WORKFLOW_JOB,slaEvent.getAppType());
  assertEquals(nominalTime,DateUtils.formatDateOozieTZ(slaEvent.getNominalTime()));
  assertEquals(expectedStart,DateUtils.formatDateOozieTZ(slaEvent.getExpectedStart()));
  assertEquals(expectedEnd,DateUtils.formatDateOozieTZ(slaEvent.getExpectedEnd()));
  SLASummaryBean slaSummary=SLASummaryQueryExecutor.getInstance().get(SLASummaryQuery.GET_SLA_SUMMARY,jobId);
  assertEquals(0,slaSummary.getEventProcessed());
  assertEquals(-1,slaSummary.getActualDuration());
  assertNull(slaSummary.getActualStart());
  assertNull(slaSummary.getActualEnd());
  assertEquals("PREP",slaSummary.getJobStatus());
  assertEquals(SLAStatus.NOT_STARTED,slaSummary.getSLAStatus());
  assertNull(slaEvent.getEventStatus());
  ehs.getEventQueue().clear();
  slas.runSLAWorker();
  slaEvent=(SLACalcStatus)ehs.getEventQueue().poll();
  assertEquals(SLAStatus.IN_PROCESS,slaEvent.getSLAStatus());
  assertEquals(EventStatus.START_MISS,slaEvent.getEventStatus());
}

</code></pre>

<br>
<pre class="type-3 type-1 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLA Events generated through Coordinator Action commands
 * CoordSubmitX and CoordStartX
 * @throws Exception
 */
@Test public void testCoordinatorActionCommandsSubmitAndStart() throws Exception {
  ehs.setAppTypes(new HashSet<String>(Arrays.asList(new String[]{"coordinator_action"})));
  ehs.getEventQueue().clear();
  SLAService slas=services.get(SLAService.class);
  String coordXml=IOUtils.getResourceAsString("coord-action-sla.xml",-1);
  Path appPath=getFsTestCaseDir();
  writeToFile(coordXml,appPath,"coordinator.xml");
  Configuration conf=new XConfiguration();
  conf.set(OozieClient.COORDINATOR_APP_PATH,appPath.toString());
  String wfXml=IOUtils.getResourceAsString("wf-credentials.xml",-1);
  writeToFile(wfXml,appPath,"workflow.xml");
  conf.set("wfAppPath",appPath.toString());
  conf.set(OozieClient.USER_NAME,getTestUser());
  cal.setTime(new Date());
  cal.add(Calendar.MINUTE,-20);
  Date nominal=cal.getTime();
  String nominalTime=DateUtils.formatDateOozieTZ(nominal);
  conf.set("nominal_time",nominalTime);
  conf.set("start","2009-01-02T08:01Z");
  conf.set("frequency","coord:days(1)");
  conf.set("end","2009-01-03T08:00Z");
  cal.setTime(nominal);
  cal.add(Calendar.MINUTE,10);
  String expectedStart=DateUtils.formatDateOozieTZ(cal.getTime());
  cal.setTime(nominal);
  cal.add(Calendar.MINUTE,30);
  String expectedEnd=DateUtils.formatDateOozieTZ(cal.getTime());
  String appName="test-coord-sla";
  String jobId=new CoordSubmitXCommand(conf).call();
  Thread.sleep(500);
  final CoordActionGetJPAExecutor getCmd=new CoordActionGetJPAExecutor(jobId + "@1");
  CoordinatorActionBean action=jpa.execute(getCmd);
  String actionId=action.getId();
  SLACalcStatus slaEvent=slas.getSLACalculator().get(actionId);
  assertEquals(actionId,slaEvent.getId());
  assertEquals(appName,slaEvent.getAppName());
  assertEquals(AppType.COORDINATOR_ACTION,slaEvent.getAppType());
  assertEquals(nominalTime,DateUtils.formatDateOozieTZ(slaEvent.getNominalTime()));
  assertEquals(expectedStart,DateUtils.formatDateOozieTZ(slaEvent.getExpectedStart()));
  assertEquals(expectedEnd,DateUtils.formatDateOozieTZ(slaEvent.getExpectedEnd()));
  assertEquals(30 * 60 * 1000,slaEvent.getExpectedDuration());
  assertEquals(alert_events,slaEvent.getAlertEvents());
  slas.runSLAWorker();
  slaEvent=skipToSLAEvent();
  assertTrue(SLAStatus.NOT_STARTED == slaEvent.getSLAStatus());
  assertEquals(EventStatus.START_MISS,slaEvent.getEventStatus());
  ehs.getEventQueue().clear();
  action.setStatus(CoordinatorAction.Status.SUBMITTED);
  CoordActionQueryExecutor.getInstance().executeUpdate(CoordActionQuery.UPDATE_COORD_ACTION_STATUS_PENDING_TIME,action);
  new CoordActionStartXCommand(actionId,getTestUser(),appName,jobId).call();
  slaEvent=slas.getSLACalculator().get(actionId);
  slaEvent.setEventProcessed(0);
  SLASummaryBean suBean=new SLASummaryBean();
  suBean.setId(actionId);
  suBean.setEventProcessed(0);
  SLASummaryQueryExecutor.getInstance().executeUpdate(SLASummaryQuery.UPDATE_SLA_SUMMARY_EVENTPROCESSED,suBean);
  ehs.new EventWorker().run();
  slaEvent=skipToSLAEvent();
  assertEquals(actionId,slaEvent.getId());
  assertNotNull(slaEvent.getActualStart());
  assertEquals(SLAStatus.IN_PROCESS,slaEvent.getSLAStatus());
  assertEquals(CoordinatorAction.Status.RUNNING.name(),slaEvent.getJobStatus());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLA Events generated through wf action rerun
 * @throws Exception
 */
@Test public void testWorkflowActionSLARerun() throws Exception {
  SLAService slas=services.get(SLAService.class);
  String wfXml=IOUtils.getResourceAsString("wf-action-sla.xml",-1);
  Path appPath=getFsTestCaseDir();
  writeToFile(wfXml,appPath,"workflow.xml");
  Configuration conf=new XConfiguration();
  conf.set(OozieClient.APP_PATH,appPath.toString());
  conf.set(OozieClient.USER_NAME,getTestUser());
  cal.setTime(new Date());
  cal.add(Calendar.MINUTE,-20);
  Date nominal=cal.getTime();
  String nominalTime=DateUtils.formatDateOozieTZ(nominal);
  conf.set("nominal_time",nominalTime);
  SubmitXCommand sc=new SubmitXCommand(conf);
  String jobId=sc.call();
  String actionId=jobId + "@grouper";
  slas.getSLACalculator().clear();
  JPAService jpaService=Services.get().get(JPAService.class);
  WorkflowJobBean wfBean=jpaService.execute(new WorkflowJobGetJPAExecutor(jobId));
  wfBean.setStatus(WorkflowJob.Status.SUCCEEDED);
  WorkflowJobQueryExecutor.getInstance().executeUpdate(WorkflowJobQuery.UPDATE_WORKFLOW_STATUS_MODTIME,wfBean);
  cal.setTime(new Date());
  nominalTime=DateUtils.formatDateOozieTZ(cal.getTime());
  conf.set("nominal_time",nominalTime);
  nominal=cal.getTime();
  cal.add(Calendar.MINUTE,10);
  String expectedStart=DateUtils.formatDateOozieTZ(cal.getTime());
  cal.setTime(nominal);
  cal.add(Calendar.MINUTE,30);
  String expectedEnd=DateUtils.formatDateOozieTZ(cal.getTime());
  ReRunXCommand rerun=new ReRunXCommand(jobId,conf);
  rerun.call();
  SLACalcStatus slaEvent=slas.getSLACalculator().get(actionId);
  assertNotNull(slaEvent);
  assertEquals(actionId,slaEvent.getId());
  assertEquals("test-wf-action-sla",slaEvent.getAppName());
  assertEquals(AppType.WORKFLOW_ACTION,slaEvent.getAppType());
  assertEquals(nominalTime,DateUtils.formatDateOozieTZ(slaEvent.getNominalTime()));
  assertEquals(expectedStart,DateUtils.formatDateOozieTZ(slaEvent.getExpectedStart()));
  assertEquals(expectedEnd,DateUtils.formatDateOozieTZ(slaEvent.getExpectedEnd()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.util.TestDateUtils </h4><pre class="type-3 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOozieInOtherTZ() throws Exception {
  Configuration conf=new XConfiguration();
  conf.set(DateUtils.OOZIE_PROCESSING_TIMEZONE_KEY,"GMT-0300");
  DateUtils.setConf(conf);
  String s1="2012-08-08T12:42-0300";
  Date d=DateUtils.parseDateOozieTZ(s1);
  Assert.assertNotNull(d);
  String s2=DateUtils.formatDateOozieTZ(d);
  Assert.assertEquals(s1,s2);
}

</code></pre>

<br>
<pre class="type-3 type-8 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOozieInUTC() throws Exception {
  Configuration conf=new XConfiguration();
  conf.set(DateUtils.OOZIE_PROCESSING_TIMEZONE_KEY,DateUtils.OOZIE_PROCESSING_TIMEZONE_DEFAULT);
  DateUtils.setConf(conf);
  String s1="2012-08-08T12:42Z";
  Date d=DateUtils.parseDateOozieTZ(s1);
  Assert.assertNotNull(d);
  String s2=DateUtils.formatDateOozieTZ(d);
  Assert.assertEquals(s1,s2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.oozie.util.TestHCatURI </h4><pre class="type-3 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetHCatUri(){
  Map<String,String> partitions=new LinkedHashMap<String,String>();
  partitions.put("datastamp","12");
  partitions.put("region","us");
  String hcatUri=HCatURI.getHCatURI("hcat","hcat.server.com:5080","mydb","clicks",partitions);
  assertEquals("hcat://hcat.server.com:5080/mydb/clicks/datastamp=12;region=us",hcatUri);
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
