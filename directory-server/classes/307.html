<h3 style="margin:0px">Class: org.apache.directory.server.ppolicy.PasswordPolicyIT (26 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(22)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(19)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(17)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(2)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void closeConnections(){
  IntegrationUtils.closeConnections();
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the pwdMaxAge configuration with a grace period. We should be able to bind for a 
 * period of time when the password has expired. 
 */
@Test public void testPwdMaxAgeWithGraceExpire() throws Exception {
  policyConfig.setPwdMaxAge(5);
  policyConfig.setPwdGraceExpire(2);
  policyConfig.setPwdGraceAuthNLimit(2);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userMaxAgeWithGraceExpire,ou=system");
  String password="12345";
  addUser(adminConnection,"userMaxAgeWithGraceExpire",password);
  BindRequest bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials(password.getBytes());
  bindReq.addControl(PP_REQ_CTRL);
  try (LdapConnection userCon=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort())){
    userCon.setTimeOut(0);
    Thread.sleep(1000);
    BindResponse bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    PasswordPolicy respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertTrue(respCtrl.getResponse().getTimeBeforeExpiration() > 0);
    Thread.sleep(4500);
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertEquals(1,respCtrl.getResponse().getGraceAuthNRemaining());
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertEquals(0,respCtrl.getResponse().getGraceAuthNRemaining());
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.INVALID_CREDENTIALS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertEquals(PASSWORD_EXPIRED,respCtrl.getResponse().getPasswordPolicyError());
  }
   adminConnection.close();
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-1 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that we can't inject a hashed password when the ChekcQuality is CHECK_REJECT,
 * and that we can when the CheckQuality is CHECK_ACCEPT
 * Ignored because if an admin can avoid password policy anyway, and add's are 
 * performed by an admin, then this case would not get caught.  If there is a case
 * where a user adds another user then we should put that case here.
 */
@Ignore @Test public void testAddUserWithHashedPwd() throws Exception {
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  byte[] password=PasswordUtil.createStoragePassword("12345",LdapSecurityConstants.HASH_METHOD_CRYPT);
  Entry userEntry=new DefaultEntry("cn=hashedpwd,ou=system","ObjectClass: top","ObjectClass: person","cn: hashedpwd","sn: hashedpwd_sn","userPassword",password);
  AddRequest addRequest=new AddRequestImpl();
  addRequest.setEntry(userEntry);
  addRequest.addControl(PP_REQ_CTRL);
  AddResponse addResp=adminConnection.add(addRequest);
  assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,addResp.getLdapResult().getResultCode());
  PasswordPolicy respCtrl=getPwdRespCtrl(addResp);
  assertNotNull(respCtrl);
  assertEquals(INSUFFICIENT_PASSWORD_QUALITY,respCtrl.getResponse().getPasswordPolicyError());
  policyConfig.setPwdCheckQuality(CheckQualityEnum.CHECK_ACCEPT);
  Attribute pwdAt=userEntry.get(SchemaConstants.USER_PASSWORD_AT);
  pwdAt.clear();
  pwdAt.add(password);
  addResp=adminConnection.add(addRequest);
  assertEquals(ResultCodeEnum.SUCCESS,addResp.getLdapResult().getResultCode());
  respCtrl=getPwdRespCtrl(addResp);
  assertNull(respCtrl);
  LdapConnection userConnection=getNetworkConnectionAs(getLdapServer(),"cn=hashedpwd,ou=system","12345");
  assertNotNull(userConnection);
  assertTrue(userConnection.isAuthenticated());
  adminConnection.close();
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verifies that the admin user is exempt from pwdHistory checks.
 * <a href="https://issues.apache.org/jira/browse/DIRSERVER-2084">DIRSERVER-
 * 2084</>
 */
@Test public void testAdminExemptPwdHistoryWithHashingInterceptor() throws Exception {
  String user="adminexempthashedpwdhistory";
  String password="12345";
  List<Interceptor> interceptors=getService().getInterceptors();
  List<Interceptor> newInterceptors=new ArrayList<Interceptor>();
  for (  Interceptor interceptor : interceptors) {
    newInterceptors.add(interceptor);
    if (InterceptorEnum.EXCEPTION_INTERCEPTOR.getName().equals(interceptor.getName())) {
      interceptor=new SshaPasswordHashingInterceptor();
      interceptor.init(getService());
      newInterceptors.add(interceptor);
    }
  }
  try {
    getService().setInterceptors(newInterceptors);
    try (LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer())){
      policyConfig.setPwdCheckQuality(CheckQualityEnum.CHECK_ACCEPT);
      Entry userEntry=adminConnection.lookup(addUser(adminConnection,user,password),"*","+");
      Dn userDn=userEntry.getDn();
      ModifyResponse response=changePassword(userDn,password,password);
      assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,response.getLdapResult().getResultCode());
      PasswordPolicy respCtrl=getPwdRespCtrl(response);
      assertNotNull(respCtrl);
      assertEquals(PasswordPolicyErrorEnum.PASSWORD_IN_HISTORY,respCtrl.getResponse().getPasswordPolicyError());
      ModifyRequest modifyRequest=new ModifyRequestImpl();
      modifyRequest.setName(userDn);
      modifyRequest.replace("userPassword",password);
      response=adminConnection.modify(modifyRequest);
      assertEquals(ResultCodeEnum.SUCCESS,response.getLdapResult().getResultCode());
      respCtrl=getPwdRespCtrl(response);
      assertNull(respCtrl);
      LdapConnection userConnection=getNetworkConnectionAs(getLdapServer(),userDn.getName(),password);
      assertNotNull(userConnection);
      assertTrue(userConnection.isAuthenticated());
    }
   }
  finally {
    getService().setInterceptors(interceptors);
  }
}

</code></pre>

<pre class="type-10 type-6 type-11 type-15 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGraceAuth() throws Exception {
  policyConfig.setPwdMaxFailure(2);
  policyConfig.setPwdLockout(true);
  policyConfig.setPwdLockoutDuration(0);
  policyConfig.setPwdGraceAuthNLimit(2);
  policyConfig.setPwdFailureCountInterval(60);
  policyConfig.setPwdMaxAge(1);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userGrace,ou=system");
  addUser(adminConnection,"userGrace","12345");
  BindRequest bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials("12345");
  bindReq.addControl(PP_REQ_CTRL);
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
  Thread.sleep(2000);
  BindResponse bindResp=userConnection.bind(bindReq);
  assertTrue(userConnection.isAuthenticated());
  PasswordPolicy ppolicy=getPwdRespCtrl(bindResp);
  assertEquals(1,ppolicy.getResponse().getGraceAuthNRemaining());
  Entry userEntry=adminConnection.lookup(userDn,"+");
  Attribute pwdGraceAuthUseTime=userEntry.get(PasswordPolicySchemaConstants.PWD_GRACE_USE_TIME_AT);
  assertNotNull(pwdGraceAuthUseTime);
  Attribute pwdChangedTime=userEntry.get(PasswordPolicySchemaConstants.PWD_CHANGED_TIME_AT);
  ModifyRequest modReq=new ModifyRequestImpl();
  modReq.setName(userDn);
  modReq.replace(SchemaConstants.USER_PASSWORD_AT,"secret1");
  ModifyResponse modResp=userConnection.modify(modReq);
  assertEquals(ResultCodeEnum.SUCCESS,modResp.getLdapResult().getResultCode());
  userEntry=adminConnection.lookup(userDn,"+");
  pwdGraceAuthUseTime=userEntry.get(PasswordPolicySchemaConstants.PWD_GRACE_USE_TIME_AT);
  assertNull(pwdGraceAuthUseTime);
  Attribute latestPwdChangedTime=userEntry.get(PasswordPolicySchemaConstants.PWD_CHANGED_TIME_AT);
  assertNotSame(pwdChangedTime.getString(),latestPwdChangedTime.getString());
  userConnection.close();
  adminConnection.close();
}

</code></pre>

<pre class="type-13 type-6 type-11 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that we can't try more than N times to login with a wrong password before
 * being locked. Also check that we have a delay before we can log again.
 */
@Test public void testPwdLockoutWithNAttemptsAndLockoutDelay() throws Exception {
  policyConfig.setPwdLockout(true);
  policyConfig.setPwdMaxFailure(3);
  policyConfig.setPwdLockoutDuration(5);
  Dn userDn=new Dn("cn=userLockout2,ou=system");
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  addUser(adminConnection,"userLockout2","12345");
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
  userConnection.setTimeOut(0L);
  checkBind(userConnection,userDn,"badPassword",3,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout2,ou=system");
  boolean success=false;
  int t=0;
  for (t=0; t < 10; t++) {
    try {
      userConnection.bind(userDn,"12345");
      success=true;
      break;
    }
 catch (    LdapException le) {
      Entry userEntry=adminConnection.lookup(userDn,"+");
      Attribute pwdAccountLockedTime=userEntry.get(PasswordPolicySchemaConstants.PWD_ACCOUNT_LOCKED_TIME_AT);
      assertNotNull(pwdAccountLockedTime);
      Thread.sleep(1000);
    }
  }
  assertTrue(success);
  assertTrue(t >= 5);
  userConnection.close();
  Entry userEntry=adminConnection.lookup(userDn,"+");
  Attribute pwdAccountLockedTime=userEntry.get(PasswordPolicySchemaConstants.PWD_ACCOUNT_LOCKED_TIME_AT);
  assertNull(pwdAccountLockedTime);
  adminConnection.close();
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Check the maxIdle : if the user does not bind for more than this delay,
 * the password is locked.
 */
@Test public void testPwMaxIdle() throws Exception {
  policyConfig.setPwdMaxIdle(5);
  Dn userDn=new Dn("cn=userLockout4,ou=system");
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  addUser(adminConnection,"userLockout4","12345");
  checkBindSuccess(userDn,"12345");
  Thread.sleep(5000);
  checkBindFailure(userDn,"12345");
  adminConnection.close();
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testModifyUserWithHashedPwd() throws Exception {
  Dn userDn=new Dn("cn=hashedpwdm,ou=system");
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Entry userEntry=new DefaultEntry(userDn.toString(),"ObjectClass: top","ObjectClass: person","cn: hashedpwdm","sn: hashedpwdm_sn","userPassword","set4now");
  adminConnection.add(userEntry);
  byte[] password=PasswordUtil.createStoragePassword("12345",LdapSecurityConstants.HASH_METHOD_CRYPT);
  assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,changePassword(userDn,"set4now",password).getLdapResult().getResultCode());
  checkBindFailure(userDn,"12345");
  adminConnection.close();
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check the pwdAllowUserChange
 */
@Test public void testPwdAllowUserChange() throws Exception {
  policyConfig.setPwdAllowUserChange(false);
  Dn userDn=new Dn("cn=userAllowUserChange,ou=system");
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  addUser(adminConnection,"userAllowUserChange","12345");
  try (LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort())){
    userConnection.setTimeOut(0L);
    checkBindSuccess(userDn,"12345");
  }
   try (LdapConnection userConnection=getNetworkConnectionAs(getLdapServer(),userDn.getName(),"12345")){
    ModifyRequest modReq=new ModifyRequestImpl();
    modReq.setName(userDn);
    modReq.addControl(PP_REQ_CTRL);
    modReq.replace("userPassword","67890");
    userConnection.setTimeOut(0L);
    ModifyResponse modifyResponse=userConnection.modify(modReq);
    assertEquals(ResultCodeEnum.INSUFFICIENT_ACCESS_RIGHTS,modifyResponse.getLdapResult().getResultCode());
    policyConfig.setPwdAllowUserChange(true);
    modifyResponse=userConnection.modify(modReq);
    assertEquals(ResultCodeEnum.SUCCESS,modifyResponse.getLdapResult().getResultCode());
    checkBindSuccess(userDn,"67890");
  }
   adminConnection.close();
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * Check that we can't try more than N times to login with a wrong password before
 * being locked.
 * @throws Exception
 */
@Test public void testPwdLockoutWithNAttempts() throws Exception {
  policyConfig.setPwdMaxFailure(3);
  policyConfig.setPwdLockout(true);
  Dn userDn=new Dn("cn=userLockout,ou=system");
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  addUser(adminConnection,"userLockout","12345");
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
  userConnection.setTimeOut(0L);
  checkBind(userConnection,userDn,"badPassword",3,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout,ou=system");
  checkBind(userConnection,userDn,"12345",1,"INVALID_CREDENTIALS: Bind failed: account was permanently locked");
  userConnection.close();
  Entry userEntry=adminConnection.lookup(userDn,"+");
  Attribute pwdAccountLockedTime=userEntry.get(PasswordPolicySchemaConstants.PWD_ACCOUNT_LOCKED_TIME_AT);
  assertNotNull(pwdAccountLockedTime);
  adminConnection.close();
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verifies that the admin user is exempt from pwdHistory checks.
 * <a href="https://issues.apache.org/jira/browse/DIRSERVER-2084">DIRSERVER-
 * 2084</>
 */
@Test public void testAdminExemptPwdHistory() throws Exception {
  String user="adminexemptpwdhistory";
  String password="12345";
  try (LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer())){
    policyConfig.setPwdCheckQuality(CheckQualityEnum.CHECK_ACCEPT);
    Entry userEntry=adminConnection.lookup(addUser(adminConnection,user,password),"*","+");
    Dn userDn=userEntry.getDn();
    ModifyResponse response=changePassword(userDn,password,password);
    assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,response.getLdapResult().getResultCode());
    PasswordPolicy respCtrl=getPwdRespCtrl(response);
    assertNotNull(respCtrl);
    assertEquals(PasswordPolicyErrorEnum.PASSWORD_IN_HISTORY,respCtrl.getResponse().getPasswordPolicyError());
    ModifyRequest modifyRequest=new ModifyRequestImpl();
    modifyRequest.setName(userDn);
    modifyRequest.replace("userPassword",password);
    response=adminConnection.modify(modifyRequest);
    assertEquals(ResultCodeEnum.SUCCESS,response.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(response);
    assertNull(respCtrl);
    LdapConnection userConnection=getNetworkConnectionAs(getLdapServer(),userDn.getName(),password);
    assertNotNull(userConnection);
    assertTrue(userConnection.isAuthenticated());
  }
 }

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
/** 
 * Set a default PaswordPolicy configuration
 */
@Before public void setPwdPolicy() throws LdapException {
  policyConfig=new PasswordPolicyConfiguration();
  policyConfig.setPwdMaxAge(110);
  policyConfig.setPwdFailureCountInterval(30);
  policyConfig.setPwdMaxFailure(2);
  policyConfig.setPwdLockout(true);
  policyConfig.setPwdLockoutDuration(0);
  policyConfig.setPwdMinLength(5);
  policyConfig.setPwdInHistory(5);
  policyConfig.setPwdExpireWarning(600);
  policyConfig.setPwdGraceAuthNLimit(5);
  policyConfig.setPwdCheckQuality(CheckQualityEnum.CHECK_REJECT);
  PpolicyConfigContainer policyContainer=new PpolicyConfigContainer();
  Dn defaultPolicyDn=new Dn(ldapServer.getDirectoryService().getSchemaManager(),"cn=default");
  policyContainer.addPolicy(defaultPolicyDn,policyConfig);
  policyContainer.setDefaultPolicyDn(defaultPolicyDn);
  customPolicyDn=new Dn(ldapServer.getDirectoryService().getSchemaManager(),"cn=custom");
  policyContainer.addPolicy(customPolicyDn,policyConfig);
  AuthenticationInterceptor authenticationInterceptor=(AuthenticationInterceptor)getService().getInterceptor(InterceptorEnum.AUTHENTICATION_INTERCEPTOR.getName());
  authenticationInterceptor.setPwdPolicies(policyContainer);
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the pwdMaxAge configuration. The password should expire when the pwdMaxAge is reached, and
 * the password should be locked as we don't have a grace limit. 
 */
@Test public void testPwdMaxAgeNoGraceAuthNLimit() throws Exception {
  policyConfig.setPwdMaxAge(5);
  policyConfig.setPwdGraceAuthNLimit(0);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userMaxAgeNoGraceAuthNLimit,ou=system");
  String password="12345";
  addUser(adminConnection,"userMaxAgeNoGraceAuthNLimit",password);
  BindRequest bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials(password.getBytes());
  bindReq.addControl(PP_REQ_CTRL);
  try (LdapConnection userCon=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort())){
    userCon.setTimeOut(0);
    Thread.sleep(1000);
    BindResponse bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    PasswordPolicy respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertTrue(respCtrl.getResponse().getTimeBeforeExpiration() > 0);
    Thread.sleep(4500);
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.INVALID_CREDENTIALS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertEquals(PASSWORD_EXPIRED,respCtrl.getResponse().getPasswordPolicyError());
  }
   adminConnection.close();
}

</code></pre>

<pre class="type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Check that we are delayed between each attempt
 * @throws Exception
 */
@Test @Ignore public void testPwdAttempsDelayed() throws Exception {
  policyConfig.setPwdMinDelay(200);
  policyConfig.setPwdMaxDelay(400);
  policyConfig.setPwdLockout(true);
  Dn userDn=new Dn("cn=userLockout,ou=system");
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  addUser(adminConnection,"userLockout","12345");
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
  checkBind(userConnection,userDn,"badPassword",1,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout,ou=system");
  Thread.sleep(1000L);
  checkBind(userConnection,userDn,"12345",1,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout,ou=system");
  Thread.sleep(1200L);
  userConnection.bind(userDn,"12345");
  userConnection.close();
  adminConnection.close();
}

</code></pre>

<pre class="type-6 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that we can add a user with a pwdChangedTime as would be the case 
 * when importing from an ldif that already contained ppolicy information.
 * Tests the resolution to 
 * <a href="https://issues.apache.org/jira/browse/DIRSERVER-1978">DIRSERVER-1978</a>
 */
@Test public void testAddUserWithPwdChangedTime() throws Exception {
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  String userDn="cn=hashedpwd,ou=system";
  String pwdChangedTime="20130913012307.296Z";
  Entry userEntry=new DefaultEntry("cn=hashedpwd,ou=system","ObjectClass: top","ObjectClass: person","cn: hashedpwd","sn: hashedpwd_sn","userPassword: set4now",PasswordPolicySchemaConstants.PWD_CHANGED_TIME_AT,pwdChangedTime);
  AddRequest addRequest=new AddRequestImpl();
  addRequest.setEntry(userEntry);
  addRequest.addControl(PP_REQ_CTRL);
  AddResponse addResp=adminConnection.add(addRequest);
  assertEquals(ResultCodeEnum.SUCCESS,addResp.getLdapResult().getResultCode());
  userEntry=adminConnection.lookup(userDn,SchemaConstants.ALL_ATTRIBUTES_ARRAY);
  Attribute pwdChangedTimeAt=userEntry.get(PasswordPolicySchemaConstants.PWD_CHANGED_TIME_AT);
  assertNotNull(pwdChangedTimeAt);
  assertEquals(pwdChangedTime,pwdChangedTimeAt.getString());
  adminConnection.close();
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testModifyPwdSubentry() throws Exception {
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=ppolicySubentry,ou=system");
  String password="12345";
  Entry userEntry=new DefaultEntry(userDn.toString(),"ObjectClass: top","ObjectClass: person","cn: ppolicySubentry","sn: ppolicySubentry_sn","userPassword: " + password,"pwdPolicySubEntry:" + customPolicyDn.getName());
  AddRequest addRequest=new AddRequestImpl();
  addRequest.setEntry(userEntry);
  addRequest.addControl(PP_REQ_CTRL);
  AddResponse addResp=adminConnection.add(addRequest);
  assertEquals(ResultCodeEnum.SUCCESS,addResp.getLdapResult().getResultCode());
  userEntry=adminConnection.lookup(userDn,"*","+");
  assertEquals(customPolicyDn.getName(),userEntry.get("pwdPolicySubEntry").getString());
  ModifyRequest modReq=new ModifyRequestImpl();
  modReq.setName(userDn);
  String modSubEntryDn="cn=policy,ou=system";
  modReq.replace("pwdPolicySubEntry",modSubEntryDn);
  ModifyResponse modResp=adminConnection.modify(modReq);
  assertEquals(ResultCodeEnum.SUCCESS,modResp.getLdapResult().getResultCode());
  userEntry=adminConnection.lookup(userDn,"*","+");
  assertEquals(modSubEntryDn,userEntry.get("pwdPolicySubEntry").getString());
  adminConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),getLdapServer().getPort());
  adminConnection.bind(userDn.getName(),password);
  modResp=adminConnection.modify(modReq);
  modReq.replace("pwdPolicySubEntry",userDn.getName());
  assertEquals(ResultCodeEnum.INSUFFICIENT_ACCESS_RIGHTS,modResp.getLdapResult().getResultCode());
  adminConnection.close();
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check the pwdExpireWarning
 */
@Test public void testPwdExpireWarning() throws Exception {
  policyConfig.setPwdGraceAuthNLimit(0);
  policyConfig.setPwdMaxAge(3600);
  policyConfig.setPwdExpireWarning(600);
  LdapConnection adminConnection=null;
  LdapConnection userConnection=null;
  LdapConnection userConnection2=null;
  try {
    String userCn="userExpireWarningToo";
    Dn userDn=new Dn("cn=" + userCn + ",ou=system");
    String password="12345";
    adminConnection=getAdminNetworkConnection(getLdapServer());
    userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
    userConnection.setTimeOut(0L);
    userConnection2=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
    userConnection2.setTimeOut(0L);
    addUser(adminConnection,userCn,password);
    BindRequest bindReq=new BindRequestImpl();
    bindReq.setDn(userDn);
    bindReq.setCredentials("12345");
    bindReq.addControl(PP_REQ_CTRL);
    BindResponse bindResponse=userConnection2.bind(bindReq);
    PasswordPolicy respCtrl=getPwdRespCtrl(bindResponse);
    assertNotNull(respCtrl);
    assertNull(respCtrl.getResponse());
    ModifyRequest modifyRequest=new ModifyRequestImpl();
    modifyRequest.setName(userDn);
    modifyRequest.replace("pwdChangedTime",DateUtils.getGeneralizedTime(new Date().getTime() - 3100000));
    adminConnection.modify(modifyRequest);
    BindRequest bindReq2=new BindRequestImpl();
    bindReq2.setDn(userDn);
    bindReq2.setCredentials("12345");
    bindReq2.addControl(new PasswordPolicyImpl());
    bindResponse=userConnection.bind(bindReq2);
    respCtrl=getPwdRespCtrl(bindResponse);
    assertNotNull(respCtrl);
    assertNotNull(respCtrl.getResponse());
    assertTrue(respCtrl.getResponse().getTimeBeforeExpiration() > 0);
    modifyRequest=new ModifyRequestImpl();
    modifyRequest.setName(userDn);
    modifyRequest.replace("pwdChangedTime",DateUtils.getGeneralizedTime(new Date().getTime() - 3700000));
    adminConnection.modify(modifyRequest);
    BindRequest bindReq3=new BindRequestImpl();
    bindReq3.setDn(userDn);
    bindReq3.setCredentials("12345");
    bindReq3.addControl(new PasswordPolicyImpl());
    bindResponse=userConnection.bind(bindReq3);
    assertEquals(ResultCodeEnum.INVALID_CREDENTIALS,bindResponse.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResponse);
    assertNotNull(respCtrl);
    assertNotNull(respCtrl.getResponse());
    assertEquals(PasswordPolicyErrorEnum.PASSWORD_EXPIRED,respCtrl.getResponse().getPasswordPolicyError());
  }
  finally {
    safeCloseConnections(userConnection,userConnection2,adminConnection);
  }
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that we can't change the password before a given delay
 */
@Test public void testPwdMinAge() throws Exception {
  policyConfig.setPwdMinAge(5);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userMinAge,ou=system");
  Entry userEntry=new DefaultEntry(userDn.toString(),"ObjectClass: top","ObjectClass: person","cn: userMinAge","sn: userMinAge_sn","userPassword: 12345");
  adminConnection.add(userEntry);
  assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,changePassword(userDn,"12345","123456").getLdapResult().getResultCode());
  Thread.sleep(5000);
  assertEquals(ResultCodeEnum.SUCCESS,changePassword(userDn,"12345","123456").getLdapResult().getResultCode());
  checkBindSuccess(userDn,"123456");
  adminConnection.close();
}

</code></pre>

<pre class="type-6 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * According to the <a href=
 * "http://tools.ietf.org/html/draft-behera-ldap-password-policy-10#section-7.8"
 * >rfc</a>:
 * <pre>
 * <b>7.8 Password Too Young Check</b>
 * If the Section 7.2 check returned true then this check will return
 * false, to allow the password to be changed.
 * ...
 * </pre>
 * <pre>
 * <b>7.2 Password Must be Changed Now Check</b>
 * A status of true is returned to indicate that the password must be
 * changed if all of these conditions are met:
 * o  The pwdMustChange attribute is set to TRUE.
 * o  The pwdReset attribute is set to TRUE.
 * Otherwise a status of false is returned.
 * </pre>
 * Therefore, if the admin sets the password, the user should be allowed
 * to change it even if pwdMinAge has not expired.
 */
@Test public void testPwdMinAgeWithMustChange() throws Exception {
  policyConfig.setPwdMustChange(true);
  policyConfig.setPwdMinAge(1);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userMinAgeMustChange,ou=system");
  Entry userEntry=new DefaultEntry(userDn.toString(),"ObjectClass: top","ObjectClass: person","cn: userMinAgeMustChange","sn: userMinAgeMustChange_sn","userPassword: 12345");
  adminConnection.add(userEntry);
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),getLdapServer().getPort());
  BindRequest bindRequest=new BindRequestImpl();
  bindRequest.setDn(userDn);
  bindRequest.setCredentials("12345");
  bindRequest.addControl(PP_REQ_CTRL);
  BindResponse bindResponse=userConnection.bind(bindRequest);
  assertEquals(ResultCodeEnum.SUCCESS,bindResponse.getLdapResult().getResultCode());
  assertEquals(PasswordPolicyErrorEnum.CHANGE_AFTER_RESET,getPwdRespCtrl(bindResponse).getResponse().getPasswordPolicyError());
  Entry mustbeNull=userConnection.lookup("ou=system");
  assertNull(mustbeNull);
  ModifyRequest modifyRequest=new ModifyRequestImpl();
  modifyRequest.setName(userDn);
  modifyRequest.replace("userPassword","123456");
  modifyRequest.addControl(PP_REQ_CTRL);
  ModifyResponse modifyResponse=userConnection.modify(modifyRequest);
  assertEquals(ResultCodeEnum.SUCCESS,modifyResponse.getLdapResult().getResultCode());
  modifyRequest=new ModifyRequestImpl();
  modifyRequest.setName(userDn);
  modifyRequest.replace("userPassword","1234567");
  modifyRequest.addControl(PP_REQ_CTRL);
  modifyResponse=userConnection.modify(modifyRequest);
  assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,modifyResponse.getLdapResult().getResultCode());
  assertEquals(PasswordPolicyErrorEnum.PASSWORD_TOO_YOUNG,getPwdRespCtrl(modifyResponse).getResponse().getPasswordPolicyError());
  Thread.sleep(1000);
  modifyResponse=userConnection.modify(modifyRequest);
  assertEquals(ResultCodeEnum.SUCCESS,modifyResponse.getLdapResult().getResultCode());
  userConnection.close();
  adminConnection.close();
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the pwdMaxAge configuration with a grace limit. We should be able to bind two
 * times when the password has expired. 
 */
@Test public void testPwdMaxAgeWithGraceAuthNLimit() throws Exception {
  policyConfig.setPwdMaxAge(5);
  policyConfig.setPwdGraceAuthNLimit(2);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userMaxAgeWithGraceAuthNLimit,ou=system");
  String password="12345";
  addUser(adminConnection,"userMaxAgeWithGraceAuthNLimit",password);
  BindRequest bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials(password.getBytes());
  bindReq.addControl(PP_REQ_CTRL);
  try (LdapConnection userCon=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort())){
    userCon.setTimeOut(0);
    Thread.sleep(1000);
    BindResponse bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    PasswordPolicy respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertTrue(respCtrl.getResponse().getTimeBeforeExpiration() > 0);
    Thread.sleep(4500);
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertEquals(1,respCtrl.getResponse().getGraceAuthNRemaining());
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertEquals(0,respCtrl.getResponse().getGraceAuthNRemaining());
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.INVALID_CREDENTIALS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertEquals(PASSWORD_EXPIRED,respCtrl.getResponse().getPasswordPolicyError());
  }
   adminConnection.close();
}

</code></pre>

<pre class="type-10 type-6 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the number of password we keep in history
 */
@Test public void testPwdInHistory() throws Exception {
  policyConfig.setPwdInHistory(2);
  try (LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer())){
    Dn userDn=addUser(adminConnection,"userPwdHist","12345");
    checkBindSuccess(userDn,"12345");
    Entry entry=adminConnection.lookup(userDn,"*","+");
    Attribute pwdHistAt=entry.get(PasswordPolicySchemaConstants.PWD_HISTORY_AT);
    assertNotNull(pwdHistAt);
    assertEquals(1,pwdHistAt.size());
    Thread.sleep(1000);
    ModifyResponse response=changePassword(userDn,"12345","67891");
    assertEquals(ResultCodeEnum.SUCCESS,response.getLdapResult().getResultCode());
    checkBindSuccess(userDn,"67891");
    entry=adminConnection.lookup(userDn,"*","+");
    pwdHistAt=entry.get(PasswordPolicySchemaConstants.PWD_HISTORY_AT);
    assertNotNull(pwdHistAt);
    assertEquals(2,pwdHistAt.size());
    Thread.sleep(1000);
    response=changePassword(userDn,"67891","abcde");
    assertEquals(ResultCodeEnum.SUCCESS,response.getLdapResult().getResultCode());
    checkBindSuccess(userDn,"abcde");
    entry=adminConnection.lookup(userDn,"*","+");
    pwdHistAt=entry.get(PasswordPolicySchemaConstants.PWD_HISTORY_AT);
    assertNotNull(pwdHistAt);
    assertEquals(2,pwdHistAt.size());
    response=changePassword(userDn,"abcde","67891");
    assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,response.getLdapResult().getResultCode());
    PasswordPolicy respCtrl=getPwdRespCtrl(response);
    assertNotNull(respCtrl);
    assertEquals(PasswordPolicyErrorEnum.PASSWORD_IN_HISTORY,respCtrl.getResponse().getPasswordPolicyError());
    checkBindSuccess(userDn,"abcde");
    response=changePassword(userDn,"abcde","12345");
    assertEquals(ResultCodeEnum.SUCCESS,response.getLdapResult().getResultCode());
  }
 }

</code></pre>

<pre class="type-6 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that the failure attempts are removed from the entry when the 
 * pwdFailureCountInterval attribute is set.
 */
@Test public void testPwdLockoutFailureCountInterval() throws Exception {
  policyConfig.setPwdLockout(true);
  policyConfig.setPwdMaxFailure(5);
  policyConfig.setPwdFailureCountInterval(2);
  Dn userDn=new Dn("cn=userLockout3,ou=system");
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  addUser(adminConnection,"userLockout3","12345");
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
  userConnection.setTimeOut(0L);
  checkBind(userConnection,userDn,"badPassword",1,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout3,ou=system");
  Entry userEntry=adminConnection.lookup(userDn,"+");
  Attribute pwdFailureTime=userEntry.get(PasswordPolicySchemaConstants.PWD_FAILURE_TIME_AT);
  assertNotNull(pwdFailureTime);
  assertEquals(1,pwdFailureTime.size());
  Thread.sleep(1000);
  checkBind(userConnection,userDn,"badPassword",1,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout3,ou=system");
  userEntry=adminConnection.lookup(userDn,"+");
  pwdFailureTime=userEntry.get(PasswordPolicySchemaConstants.PWD_FAILURE_TIME_AT);
  assertNotNull(pwdFailureTime);
  assertEquals(2,pwdFailureTime.size());
  Thread.sleep(1000);
  checkBind(userConnection,userDn,"badPassword",1,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout3,ou=system");
  userEntry=adminConnection.lookup(userDn,"+");
  pwdFailureTime=userEntry.get(PasswordPolicySchemaConstants.PWD_FAILURE_TIME_AT);
  assertNotNull(pwdFailureTime);
  assertEquals(2,pwdFailureTime.size());
  Thread.sleep(1000);
  checkBind(userConnection,userDn,"badPassword",1,"INVALID_CREDENTIALS: Bind failed: ERR_229 Cannot authenticate user cn=userLockout3,ou=system");
  userEntry=adminConnection.lookup(userDn,"+");
  pwdFailureTime=userEntry.get(PasswordPolicySchemaConstants.PWD_FAILURE_TIME_AT);
  assertNotNull(pwdFailureTime);
  assertEquals(2,pwdFailureTime.size());
  userConnection.close();
  adminConnection.close();
}

</code></pre>

<pre class="type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the pwdMaxAge configuration. The password should expire when the pwdMaxAge is reached.
 * @throws Exception
 */
@Test public void testPwdMaxAgeAndGraceAuth() throws Exception {
  policyConfig.setPwdMaxAge(5);
  policyConfig.setPwdExpireWarning(4);
  policyConfig.setPwdGraceAuthNLimit(2);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userMaxAgeAndGraceAuth,ou=system");
  String password="12345";
  addUser(adminConnection,"userMaxAgeAndGraceAuth",password);
  BindRequest bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials(password.getBytes());
  bindReq.addControl(PP_REQ_CTRL);
  try (LdapConnection userCon=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort())){
    userCon.setTimeOut(0);
    Thread.sleep(1000);
    BindResponse bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    PasswordPolicy respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertTrue(respCtrl.getResponse().getTimeBeforeExpiration() > 0);
    Thread.sleep(4000);
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertNotNull(respCtrl);
    assertEquals(1,respCtrl.getResponse().getGraceAuthNRemaining());
    Thread.sleep(1000);
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.SUCCESS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertEquals(0,respCtrl.getResponse().getGraceAuthNRemaining());
    bindResp=userCon.bind(bindReq);
    assertEquals(ResultCodeEnum.INVALID_CREDENTIALS,bindResp.getLdapResult().getResultCode());
    respCtrl=getPwdRespCtrl(bindResp);
    assertEquals(PASSWORD_EXPIRED,respCtrl.getResponse().getPasswordPolicyError());
  }
   adminConnection.close();
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPwdLength() throws Exception {
  policyConfig.setPwdMinLength(5);
  policyConfig.setPwdMaxLength(7);
  policyConfig.setPwdCheckQuality(CheckQualityEnum.CHECK_REJECT);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userLen,ou=system");
  Entry userEntry=new DefaultEntry(userDn.toString(),"ObjectClass: top","ObjectClass: person","cn: userLen","sn: userLen_sn","userPassword: set4now");
  adminConnection.add(userEntry);
  assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,changePassword(userDn,"set4now","1234").getLdapResult().getResultCode());
  checkBindFailure(userDn,"1234");
  assertEquals(ResultCodeEnum.CONSTRAINT_VIOLATION,changePassword(userDn,"set4now","12345678").getLdapResult().getResultCode());
  checkBindFailure(userDn,"12345678");
  assertEquals(ResultCodeEnum.SUCCESS,changePassword(userDn,"set4now","123456").getLdapResult().getResultCode());
  checkBindSuccess(userDn,"123456");
  adminConnection.close();
}

</code></pre>

<pre class="type-13 type-6 type-11 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPwdLockoutWithDuration() throws Exception {
  policyConfig.setPwdMaxFailure(2);
  policyConfig.setPwdLockout(true);
  policyConfig.setPwdLockoutDuration(5);
  policyConfig.setPwdGraceAuthNLimit(2);
  policyConfig.setPwdFailureCountInterval(0);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=userLockoutWithDuration,ou=system");
  addUser(adminConnection,"userLockoutWithDuration","12345");
  BindRequest bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials("1234");
  bindReq.addControl(PP_REQ_CTRL);
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
  for (int i=0; i < 4; i++) {
    userConnection.bind(bindReq);
    assertFalse(userConnection.isAuthenticated());
  }
  Entry userEntry=adminConnection.lookup(userDn,"+");
  Attribute pwdAccountLockedTime=userEntry.get(PasswordPolicySchemaConstants.PWD_ACCOUNT_LOCKED_TIME_AT);
  assertNotNull(pwdAccountLockedTime);
  Thread.sleep(10000);
  bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials("12345");
  bindReq.addControl(PP_REQ_CTRL);
  userConnection.setTimeOut(Long.MAX_VALUE);
  userConnection.bind(bindReq);
  assertTrue(userConnection.isAuthenticated());
  userConnection.close();
  adminConnection.close();
}

</code></pre>

<pre class="type-13 type-10 type-6 type-11 type-4 type-5 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPwdLockoutForever() throws Exception {
  policyConfig.setPwdMaxFailure(2);
  policyConfig.setPwdLockout(true);
  policyConfig.setPwdLockoutDuration(0);
  policyConfig.setPwdGraceAuthNLimit(2);
  policyConfig.setPwdFailureCountInterval(30);
  LdapConnection adminConnection=getAdminNetworkConnection(getLdapServer());
  Dn userDn=new Dn("cn=user2,ou=system");
  Entry userEntry=new DefaultEntry(userDn.toString(),"ObjectClass: top","ObjectClass: person","cn: user2","sn: user_sn","userPassword: 12345");
  AddRequest addRequest=new AddRequestImpl();
  addRequest.setEntry(userEntry);
  addRequest.addControl(PP_REQ_CTRL);
  AddResponse addResp=adminConnection.add(addRequest);
  assertEquals(ResultCodeEnum.SUCCESS,addResp.getLdapResult().getResultCode());
  PasswordPolicy respCtrl=getPwdRespCtrl(addResp);
  assertNull(respCtrl);
  BindRequest bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials("1234");
  bindReq.addControl(PP_REQ_CTRL);
  LdapConnection userConnection=new LdapNetworkConnection(InetAddress.getLocalHost().getHostName(),ldapServer.getPort());
  for (int i=0; i < 3; i++) {
    userConnection.bind(bindReq);
    assertFalse(userConnection.isAuthenticated());
  }
  Thread.sleep(2000);
  userEntry=adminConnection.lookup(userDn,SchemaConstants.ALL_ATTRIBUTES_ARRAY);
  Attribute pwdAccountLockedTime=userEntry.get(PasswordPolicySchemaConstants.PWD_ACCOUNT_LOCKED_TIME_AT);
  assertNotNull(pwdAccountLockedTime);
  assertEquals("000001010000Z",pwdAccountLockedTime.getString());
  bindReq=new BindRequestImpl();
  bindReq.setDn(userDn);
  bindReq.setCredentials("12345");
  bindReq.addControl(PP_REQ_CTRL);
  userConnection.bind(bindReq);
  assertFalse(userConnection.isAuthenticated());
  userConnection.close();
  ModifyRequest modReq=new ModifyRequestImpl();
  modReq.setName(userDn);
  modReq.addControl(PP_REQ_CTRL);
  modReq.remove(userEntry.get(SchemaConstants.USER_PASSWORD_AT));
  ModifyResponse modResp=adminConnection.modify(modReq);
  assertEquals(ResultCodeEnum.SUCCESS,modResp.getLdapResult().getResultCode());
  userEntry=adminConnection.lookup(userDn,"+");
  assertNull(userEntry.get(PWD_FAILURE_TIME_AT));
  assertNull(userEntry.get(PWD_GRACE_USE_TIME_AT));
  assertNull(userEntry.get(PWD_HISTORY_AT));
  assertNull(userEntry.get(PWD_CHANGED_TIME_AT));
  assertNull(userEntry.get(PWD_ACCOUNT_LOCKED_TIME_AT));
  adminConnection.close();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
